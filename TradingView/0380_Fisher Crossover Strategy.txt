//@version=5
strategy("Fisher Crossover Strategy",
     overlay=true,
     default_qty_type=strategy.cash,
     default_qty_value=20000,
     calc_on_every_tick=false)

// Fisher Transform parameters
length = input.int(9, "Fisher Length")

// Calculate the raw value
value = 0.33 * 2 * ((close - ta.lowest(low, length)) / (ta.highest(high, length) - ta.lowest(low, length)) - 0.5)
value := value + 0.67 * nz(value[1])

// Fisher transform
fisher = 0.5 * math.log((1 + value) / (1 - value))
fisher := fisher + 0.5 * nz(fisher[1])

// Trigger line is previous Fisher value
trigger = nz(fisher[1])

// Conditions
longCondition  = ta.crossover(fisher, trigger) and fisher < 1
exitCondition  = ta.crossunder(fisher, trigger) and fisher > 1

// Ensure one trade at a time
inTrade = strategy.position_size != 0

// Entry and exit only at candle close
if barstate.isconfirmed
    if (longCondition and not inTrade)
        strategy.entry("Long", strategy.long, comment="Buy")
    if (exitCondition and inTrade)
        strategy.close("Long", comment="Exit")

// Plot Fisher & Trigger
plot(fisher, color=color.new(color.green, 0), title="Fisher")
plot(trigger, color=color.new(color.red, 0), title="Trigger")

// Reference line at 1 for clarity
hline(1, "Level 1", color=color.red)