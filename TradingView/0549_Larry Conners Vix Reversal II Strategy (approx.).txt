// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © EdgeTools

//@version=5
strategy("Larry Conners Vix Reversal II Strategy (approx.)", overlay=false)

// Input parameters
vixSymbol = input.symbol("CBOE:VIX", "VIX Symbol")  // VIX symbol input
rsiPeriod = input.int(25, title="RSI Period", minval=1)  // RSI period for the VIX
overboughtLevel = input.int(61, title="RSI Overbought Level", minval=1)  // RSI level to signal overbought
oversoldLevel = input.int(42, title="RSI Oversold Level", minval=1)  // RSI level to signal oversold
minHoldingDays = input.int(7, title="Minimum Holding Days", minval=1)  // Minimum holding period
maxHoldingDays = input.int(12, title="Maximum Holding Days", minval=1)  // Maximum holding period

// Colors for visualization (RGB)
buyColor = color.rgb(0, 255, 0)  // Green for buy signals
sellColor = color.rgb(255, 0, 0)  // Red for sell signals
vixLineColor = color.rgb(0, 0, 255)  // Blue for VIX plot

// Get VIX data
vixClose = request.security(vixSymbol, "D", close)

// Calculate RSI of VIX
vixRSI = ta.rsi(vixClose, rsiPeriod)

// Conditions
isOverbought = vixRSI >= overboughtLevel
isOversold = vixRSI <= oversoldLevel

// Detect RSI downtick after being overbought (Buy Condition)
rsiDowntick = isOverbought and ta.crossover(vixRSI, overboughtLevel)

// Detect RSI uptick after being oversold (Sell Condition)
rsiUptick = isOversold and ta.crossunder(vixRSI, oversoldLevel)

// Track holding days
var int holdingDays = 0

// Buy when RSI downtick after overbought condition
if (rsiDowntick and holdingDays == 0)
    strategy.entry("Buy", strategy.long)
    holdingDays := 1

// Sell when RSI uptick after oversold condition
if (rsiUptick and holdingDays == 0)
    strategy.entry("Sell", strategy.short)
    holdingDays := 1

// Exit after 5 to 8 days
if (holdingDays > 0)
    holdingDays += 1
    if (holdingDays >= minHoldingDays and holdingDays <= maxHoldingDays)
        strategy.close("Buy")
        strategy.close("Sell")
        holdingDays := 0

// Plot VIX close and RSI for reference
plot(vixRSI, color=vixLineColor, title="VIX Close")
hline(overboughtLevel, "Overbought Level", color=color.new(buyColor, 0))
hline(oversoldLevel, "Oversold Level", color=color.new(sellColor, 0))

// Highlight buy and sell conditions using color.new() for transparency
bgcolor(rsiDowntick ? color.new(buyColor, 90) : na, title="Buy Condition Background")
bgcolor(rsiUptick ? color.new(sellColor, 90) : na, title="Sell Condition Background")