// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © omar_elliot

//@version=6
strategy('Supertrend TP SL (PRO)',
 overlay = true,
 default_qty_type = strategy.percent_of_equity,
 default_qty_value = 500,
 max_labels_count = 500)

// Moving Average Input
// showMA = input.bool(true, 'Show Moving Average', group = 'Moving Average')
// maLength = input.int(20, 'MA Length', group = 'Moving Average')
// maType = input.string('EMA', 'MA Type', options = ['SMA', 'EMA'], group = 'Moving Average')

// Calculate Moving Average
//ma = maType == 'EMA' ? ta.ema(close, maLength) : ta.sma(close, maLength)

// Plot Moving Average with style
//plot(showMA ? ma : na, 'Moving Average', color = color.new(#2196F3, 0), linewidth = 2, style = plot.style_line)

// Supertrend Settings
atrPeriod      = input.int(10, 'ATR Length',             group = 'Supertrend')
factor         = input.float(3.0, 'Factor', step = 0.01, group = 'Supertrend')
showSupertrend = input.bool(true, 'Show Supertrend',     group = 'Supertrend')
// Trade Settings
TPPoints = input.float(1000, 'Take Profit Points',            group = 'Risk Management',  inline = "1")
var isLongEnabled = input.bool(true, ' BUY Trades',    group = 'Risk Management' , inline = "1")
var isStopLossEnabled = input.bool(true, ' Stop Loss', group = 'Risk Management',  inline = "1")
SLPoints = input.float(2000, 'Stop Loss Points',                  group = 'Risk Management' , inline = "2")
var isShortEnabled = input.bool(true, ' SELL Trades',      group = 'Risk Management' , inline = "2")
var isTakeProfitEnabled = input.bool(true, ' Take Profit', group = 'Risk Management' , inline = "2")
// Style Settings
var lineStyle = input.string('Dashed', 'Line Style', options = ['Solid', 'Dashed', 'Dotted'], group = 'Style')
var lineWidth = input.int(2, 'Line Width', minval = 1, maxval = 4, group = 'Style')
var labelSize = input.string('Normal', 'Label Size', options = ['Small', 'Normal', 'Large'], group = 'Style')
// Convert style settings
var lineStyleValue = lineStyle == 'Solid' ? line.style_solid : lineStyle == 'Dashed' ? line.style_dashed : line.style_dotted
var labelStyleValue = labelSize == 'Small' ? size.small : labelSize == 'Large' ? size.large : size.small
// Colors
bullColor = input.color(#00e676, 'Bullish Color', group = 'Colors'  , inline = "1")
bearColor = input.color(#e60400, 'Bearish Color', group = 'Colors', inline = "1")
tpColor = input.color(#00e676, 'Take Profit Color', group = 'Colors', inline = "2")
slColor = input.color(#e60400, 'Stop Loss Color', group = 'Colors', inline = "2")
// Calculate Supertrend
[supertrendValue, direction] = ta.supertrend(factor, atrPeriod)
// Plot Supertrend with style
supertrendColor = direction < 0 ? #00e676 : #e60400
plot(showSupertrend ? supertrendValue : na, 'Supertrend', color = supertrendColor, linewidth = 3, style = plot.style_line)

// Dynamic Candle Colors
barcolor(direction < 0 ? bullColor : bearColor)

// Trading Logic
if ta.change(direction) < 0 and isLongEnabled
    strategy.entry('Long', strategy.long)
    if isStopLossEnabled
        sl = close - SLPoints * syminfo.mintick
        strategy.exit('Long SL', 'Long', stop = sl)
        line.new(bar_index, sl, bar_index + 10, sl,
                 color = slColor,
                 width = lineWidth,
                 style = lineStyleValue)
        label.new(bar_index + 10, sl, 'SL',
                     style = label.style_label_left,
                     color = color.new(slColor, 0),
                     textcolor = color.white,
                     size = labelStyleValue)

    if isTakeProfitEnabled
        tp = close + TPPoints * syminfo.mintick
        strategy.exit('Long TP', 'Long', limit = tp)
        line.new(bar_index, tp, bar_index + 10, tp,
                 color = tpColor,
                 width = lineWidth,
                 style = lineStyleValue)
        label.new(bar_index + 10, tp, 'TP',
                 style = label.style_label_left,
                 color = color.new(tpColor, 0),
                 textcolor = color.white,
                 size = labelStyleValue)

if ta.change(direction) > 0 and isShortEnabled
    strategy.entry('Short', strategy.short)
    if isStopLossEnabled
        sl = close + SLPoints * syminfo.mintick
        strategy.exit('Short SL', 'Short', stop = sl)
        line.new(bar_index, sl, bar_index + 10, sl,
                 color = slColor,
                 width = lineWidth,
                 style = lineStyleValue)
        label.new(bar_index + 10, sl, 'SL',
                 style = label.style_label_left,
                 color = color.new(slColor, 0),
                 textcolor = color.white,
                 size = labelStyleValue)

    if isTakeProfitEnabled
        tp = close - TPPoints * syminfo.mintick
        strategy.exit('Short TP', 'Short', limit = tp)
        line.new(bar_index, tp, bar_index + 10, tp,
                 color = tpColor,
                 width = lineWidth,
                 style = lineStyleValue)
        label.new(bar_index + 10, tp, 'TP',
                 style = label.style_label_left,
                 color = color.new(tpColor, 0),
                 textcolor = color.white,
                 size = labelStyleValue)

// Plot buy/sell signals
plotshape(ta.change(direction) < 0 and isLongEnabled ? low : na, 'Buy Signal', style = shape.triangleup, location = location.belowbar, color = bullColor, size = size.small)
plotshape(ta.change(direction) > 0 and isShortEnabled ? high : na, 'Sell Signal', style = shape.triangledown, location = location.abovebar, color = bearColor, size = size.small)