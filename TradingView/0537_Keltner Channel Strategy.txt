//@version=5
strategy("Keltner Channel Strategy", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// Keltner Channel Settings
length = 20
mult = 1.5
emaBasis = ta.ema(close, length)
atrVal = ta.atr(length)

upperKC = emaBasis + (mult * atrVal)
lowerKC = emaBasis - (mult * atrVal)

// Entry Conditions for Different Strategies
longEntryKC = ta.crossunder(close, lowerKC)
shortEntryKC = ta.crossover(close, upperKC)

longEntryTrend = ta.crossover(ta.ema(close, 9), ta.ema(close, 21)) and close > ta.ema(close, 50)
shortEntryTrend = ta.crossunder(ta.ema(close, 9), ta.ema(close, 21)) and close < ta.ema(close, 50)

// Stop-Loss and Take-Profit Levels
atrMultiplier = 1.5
stopLossLong = close - (atrMultiplier * atrVal)
stopLossShort = close + (atrMultiplier * atrVal)
takeProfitLong = close + (2 * atrMultiplier * atrVal)
takeProfitShort = close - (2 * atrMultiplier * atrVal)

// Exit Conditions
exitLongKC = ta.crossover(close, emaBasis)
exitShortKC = ta.crossunder(close, emaBasis)
exitLongTrend = ta.crossunder(ta.ema(close, 9), ta.ema(close, 21))
exitShortTrend = ta.crossover(ta.ema(close, 9), ta.ema(close, 21))

// Plot Keltner Channels
plot(upperKC, title="Upper Keltner Band", color=color.blue)
plot(lowerKC, title="Lower Keltner Band", color=color.red)
plot(emaBasis, title="Mid Keltner Band", color=color.gray)

// Execute Trades
strategy.entry("Long_KC", strategy.long, when=longEntryKC)
strategy.close("Long_KC", when=exitLongKC)
strategy.entry("Short_KC", strategy.short, when=shortEntryKC)
strategy.close("Short_KC", when=exitShortKC)

strategy.entry("Long_Trend", strategy.long, when=longEntryTrend)
strategy.close("Long_Trend", when=exitLongTrend)
strategy.entry("Short_Trend", strategy.short, when=shortEntryTrend)
strategy.close("Short_Trend", when=exitShortTrend)

// Stop-Loss and Take-Profit Implementation
strategy.exit("Long_KC_Exit", from_entry="Long_KC", stop=stopLossLong, limit=takeProfitLong)
strategy.exit("Short_KC_Exit", from_entry="Short_KC", stop=stopLossShort, limit=takeProfitShort)
strategy.exit("Long_Trend_Exit", from_entry="Long_Trend", stop=stopLossLong, limit=takeProfitLong)
strategy.exit("Short_Trend_Exit", from_entry="Short_Trend", stop=stopLossShort, limit=takeProfitShort)

// Alerts
alertcondition(longEntryKC, title="Long Entry KC Alert", message="Price touched Lower Keltner Band - Possible Long Setup")
alertcondition(shortEntryKC, title="Short Entry KC Alert", message="Price touched Upper Keltner Band - Possible Short Setup")
alertcondition(longEntryTrend, title="Long Entry Trend Alert", message="9 EMA crossed above 21 EMA - Possible Long Setup")
alertcondition(shortEntryTrend, title="Short Entry Trend Alert", message="9 EMA crossed below 21 EMA - Possible Short Setup")