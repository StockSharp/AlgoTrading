//@version=5
strategy("RSI Crossover Strategy with Compounding (Monthly)", overlay=true)

// Initial capital settings
var float initialCapital = 100000 // Starting capital of 1 lakh
var float capital = initialCapital // Current capital
var float investedCapital = 0.0 // Track capital invested in current trade

// Parameters for RSI
rsiLength = 14

// Get the RSI and the RSI SMA on the monthly time frame
rsiMonthly = request.security(syminfo.tickerid, "M", ta.rsi(close, rsiLength))
rsiSmaMonthly = request.security(syminfo.tickerid, "M", ta.sma(rsiMonthly, rsiLength))

// Define conditions for entry and exit based on monthly time frame
rsiMonthlyHigher = rsiMonthly > rsiSmaMonthly
rsiMonthlyLower = rsiMonthly < rsiSmaMonthly

// Calculate the maximum number of shares we can buy with the current capital
maxQuantity = capital > 0 ? math.floor(capital / close) : 0

// Entry Condition: RSI > RSI SMA on the monthly time frame
if (rsiMonthlyHigher and strategy.position_size == 0 and maxQuantity > 0)
    strategy.entry("Long", strategy.long, qty=maxQuantity)
    investedCapital := maxQuantity * close  // Update invested capital

// Exit Condition: RSI < RSI SMA on the monthly time frame
if (rsiMonthlyLower and strategy.position_size > 0)
    strategy.close("Long")
    // Update capital after closing the trade
    capital := capital + (strategy.netprofit) // Update capital with net profit only
    investedCapital := 0.0  // Reset invested capital

// Plot the RSI and RSI SMA on the chart for visualization
plot(rsiMonthly, color=color.blue, title="RSI (Monthly)")
plot(rsiSmaMonthly, color=color.red, title="RSI SMA (Monthly)")