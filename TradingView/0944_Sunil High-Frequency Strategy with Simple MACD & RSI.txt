//@version=6
strategy('Sunil High-Frequency Strategy with Simple MACD & RSI', overlay = true)

// Define Parameters
fastLength = input.int(6, title = 'MACD Fast Length') // Shorter MACD fast length
slowLength = input.int(12, title = 'MACD Slow Length')
signalSmoothing = input.int(9, title = 'MACD Signal Length')
rsiLength = input.int(7, title = 'RSI Length') // Shorter RSI length
rsiOverbought = input.int(70, title = 'RSI Overbought Level')
rsiOversold = input.int(30, title = 'RSI Oversold Level')
atrLength = input.int(14, title = 'ATR Length')
atrMultiplierSL = input.float(0.5, title = 'Stop Loss Multiplier (ATR)', minval = 0.1) // Tighter Stop Loss
atrMultiplierTP = input.float(1.5, title = 'Take Profit Multiplier (ATR)', minval = 0.1) // Moderate Take Profit
atrMultiplierTrailingStop = input.float(0.5, title = 'Trailing Stop Multiplier (ATR)', minval = 0.1) // Trailing stop ATR multiplier

// Calculate MACD
[macdLine, signalLine, _] = ta.macd(close, fastLength, slowLength, signalSmoothing)

// Calculate RSI
rsiValue = ta.rsi(close, rsiLength)

// Calculate ATR for dynamic SL/TP
atr = ta.atr(atrLength)

// Plot MACD and Signal Line
plot(macdLine, color = color.blue, title = 'MACD Line')
plot(signalLine, color = color.orange, title = 'Signal Line')
hline(0, 'Zero Line', color = color.gray)

// Entry Conditions
longCondition = ta.crossover(macdLine, signalLine) and rsiValue < rsiOverbought
shortCondition = ta.crossunder(macdLine, signalLine) and rsiValue > rsiOversold

// Exit Conditions
longStopLoss = close - atrMultiplierSL * atr
longTakeProfit = close + atrMultiplierTP * atr
shortStopLoss = close + atrMultiplierSL * atr
shortTakeProfit = close - atrMultiplierTP * atr

// Trailing Stop Logic
longTrailingStop = strategy.position_avg_price + atrMultiplierTrailingStop * atr
shortTrailingStop = strategy.position_avg_price - atrMultiplierTrailingStop * atr

// Enter Long Position
if longCondition
    strategy.entry('Long', strategy.long)

// Enter Short Position
if shortCondition
    strategy.entry('Short', strategy.short)

// Exit Conditions: Based on stop loss, take profit, or trailing stop
if strategy.position_size > 0
    strategy.exit('Sell', 'Long', stop = longStopLoss, limit = longTakeProfit, trail_price = longTrailingStop, trail_offset = atrMultiplierTrailingStop * atr)

if strategy.position_size < 0
    strategy.exit('Cover', 'Short', stop = shortStopLoss, limit = shortTakeProfit, trail_price = shortTrailingStop, trail_offset = atrMultiplierTrailingStop * atr)

// Plot Stop Loss and Take Profit levels
plot(longStopLoss, color = color.red, title = 'Stop Loss', linewidth = 1, style = plot.style_line)
plot(longTakeProfit, color = color.green, title = 'Take Profit', linewidth = 1, style = plot.style_line)
plot(shortStopLoss, color = color.red, title = 'Short Stop Loss', linewidth = 1, style = plot.style_line)
plot(shortTakeProfit, color = color.green, title = 'Short Take Profit', linewidth = 1, style = plot.style_line)

// Plot Buy and Sell Signals
plotshape(series = longCondition, location = location.belowbar, color = color.green, style = shape.labelup, title = 'Buy Signal')
plotshape(series = shortCondition, location = location.abovebar, color = color.red, style = shape.labeldown, title = 'Sell Signal')