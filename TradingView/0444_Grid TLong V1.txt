// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © manorz
//@version=6
strategy('Grid TLong V1', overlay = true, default_qty_type = strategy.percent_of_equity, default_qty_value = 5, initial_capital = 1000, commission_value = 0.01, calc_on_every_tick = true)
//Inputs
percent = input.float(1.00, title = '(%) Grid:', minval = 0.1, step = 0.1)
order = input.int(0, title = 'Orders: Market [0] Limit [1]', options = [0, 1])
entry = strategy.closedtrades.exit_price(strategy.closedtrades - 1)
//Functions
fun1(close) =>
    if order == 0
        strategy.close_all()
        strategy.entry('Long', strategy.long)
    else if order == 1
        strategy.exit('Exit Long', limit = close)
        strategy.entry('Long', strategy.long, limit = close)
fun2(close) =>
    if order == 0
        strategy.close_all()
        strategy.entry('Short', strategy.short, qty = 0.0001)
    else if order == 1
        strategy.exit('Exit Long', limit = close)
        strategy.entry('Short', strategy.short, qty = 0.0001, limit = close)
fun3(close) =>
    if order == 0
        strategy.close_all()
        strategy.entry('Short', strategy.short, qty = 0.0001)
    else if order == 1
        strategy.exit('Exit Short', limit = close)
        strategy.entry('Short', strategy.short, qty = 0.0001, limit = close)
fun4(close) =>
    if order == 0
        strategy.close_all()
        strategy.entry('Long', strategy.long)
    else if order == 1
        strategy.exit('Exit Short', limit = close)
        strategy.entry('Long', strategy.long, limit = close)
//Script
if strategy.position_size == 0
    strategy.entry('Long', strategy.long)
else if strategy.position_size > 0
    if strategy.opentrades.profit_percent(strategy.opentrades - 1) >= percent
        fun1(close)
    else if strategy.opentrades.profit_percent(strategy.opentrades - 1) <= -percent
        fun2(close)
else if strategy.position_size < 0
    if strategy.opentrades.profit_percent(strategy.opentrades - 1) >= percent
        fun3(close)
    else if strategy.opentrades.profit_percent(strategy.opentrades - 1) <= -percent
        fun4(close)
//Plot
plot(entry, title = 'Close', color = color.gray, linewidth = 1, style = plot.style_circles)