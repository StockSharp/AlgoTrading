// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © EdgeTools

//@version=5
strategy("Ultimate Oscillator Trading Strategy", overlay=false, commission_type=strategy.commission.cash_per_contract, commission_value=0.05, slippage=1)

// Input settings for the UO periods
period1 = input.int(6, title="Short-term Period", minval=2, maxval=10, step=2)
period2 = input.int(14, title="Medium-term Period", minval=6, maxval=14, step=2)
period3 = input.int(20, title="Long-term Period", minval=10, maxval=20, step=2)

// Calculate the Ultimate Oscillator (UO)
buyingPressure = close - math.min(low, close[1])

// Calculate the True Range manually
trueRange = math.max(high - low, math.max(math.abs(high - close[1]), math.abs(low - close[1])))

// Averages for each period
avgBP1 = ta.sma(buyingPressure, period1)
avgTR1 = ta.sma(trueRange, period1)

avgBP2 = ta.sma(buyingPressure, period2)
avgTR2 = ta.sma(trueRange, period2)

avgBP3 = ta.sma(buyingPressure, period3)
avgTR3 = ta.sma(trueRange, period3)

// Calculate the weighted average of the three periods
UO = 100 * ((4 * avgBP1 / avgTR1) + (2 * avgBP2 / avgTR2) + (avgBP3 / avgTR3)) / (4 + 2 + 1)

// Entry and exit conditions
buyThreshold = 30
buyCondition = UO < buyThreshold
sellCondition = close > high[1]

// Entry logic
if (buyCondition)
    strategy.entry("Long", strategy.long)

// Exit logic
if (sellCondition)
    strategy.close("Long")

// Define alert conditions
alertcondition(buyCondition, title="Buy Signal", message="Buy Alert: Ultimate Oscillator below 30")
alertcondition(sellCondition, title="Sell Signal", message="Sell Alert: Price exceeds the previous high")

// RGB Colors
uoColor = color.new(#0000FF, 0)  // Blue
buyThresholdColor = color.new(#00FF00, 0)  // Green
neutralLevelColor = color.new(#808080, 0)  // Gray

// Plot the Ultimate Oscillator
plot(UO, title="Ultimate Oscillator", color=uoColor)
hline(buyThreshold, "Buy Threshold", color=buyThresholdColor)
hline(50, "Neutral Level", color=neutralLevelColor)