// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © traderhub

//@version=5
strategy("Trend Following ADX + Parabolic SAR", overlay=true)

// Strategy parameters
adxLength = input(14, title="ADX Period")
adxThreshold = input(25, title="ADX Threshold")
adxSmoothing = input(14, title="ADX Smoothing")
sarStart = input(0.02, title="Parabolic SAR Start")  // Starting acceleration factor
sarIncrement = input(0.02, title="Parabolic SAR Increment")  // Increment step
sarMax = input(0.2, title="Parabolic SAR Max")  // Maximum acceleration factor

// Calculate ADX, DI+, and DI-
[diPlus, diMinus, adx] = ta.dmi(adxLength, adxSmoothing)

// Parabolic SAR calculation
sar = ta.sar(sarStart, sarIncrement, sarMax)

// Conditions for a long position
longCondition = adx > adxThreshold and diPlus > diMinus and close > sar

// Conditions for a short position
shortCondition = adx > adxThreshold and diMinus > diPlus and close < sar

// Enter a long position
if (longCondition)
    strategy.entry("Long", strategy.long)

// Enter a short position
if (shortCondition)
    strategy.entry("Short", strategy.short)

// Close position on reverse signal
if (strategy.position_size > 0 and shortCondition)
    strategy.close("Long")
if (strategy.position_size < 0 and longCondition)
    strategy.close("Short")

// Plot indicators on the chart
plot(sar, color=color.blue, style=plot.style_circles, linewidth=2, title="Parabolic SAR")
plot(adx, color=color.red, title="ADX")
hline(adxThreshold, "ADX Threshold", color=color.green)