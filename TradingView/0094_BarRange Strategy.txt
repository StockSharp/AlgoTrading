//@version=5
strategy("BarRange Strategy", overlay=true, margin_long=100, margin_short=100)

// Define bar range (high - low for each bar).
barRange = high[0] - low[0]

// Define the lookback period.
lookbackPeriod = 50

// Define percent rank
percentRank = ta.percentrank(barRange, lookbackPeriod)

// Percent rank threshold
highrange = percentRank >= 95

longcondition = highrange and close[0] < open[0] // percent rank must be >= 95 and last bar must close down.
//longcondition = highrange // enter long regardless, whether last bar closed up or down.

exitcondition = bar_index[0] + 1 // exit after 1 bar, by adjusting "1", you can control after how many bars you can exit.
//exitcondition = close[0] > high[1] // exit when current bar's close is higher than last bar's high.

// Entry & exit.
strategy.entry("long", strategy.long, when = longcondition)
strategy.close("long", when = exitcondition)

// Display entry & exit arrows.
bgcolor(longcondition ? color.new(color.green, 90) : na, transp=90)
bgcolor(exitcondition ? color.new(color.red, 90) : na, transp=90)