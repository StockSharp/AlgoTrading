//@version=6
strategy("VWAP + EMA Trend + ATR Pullback", overlay=true)

// === Inputs ===
emaFastLen   = input.int(30, "Fast EMA Length")
emaSlowLen   = input.int(200, "Slow EMA Length")
atrLen       = input.int(14, "ATR Length")
atrMult      = input.float(1.5, "ATR Multiplier")
vwapSource   = input.source(close, "VWAP Source")

// === Indicators ===
emaFast = ta.ema(close, emaFastLen)
emaSlow = ta.ema(close, emaSlowLen)
atrVal  = ta.atr(atrLen)

// === Trend Filter ===
uptrend   = emaFast > emaSlow and (emaFast - emaSlow) > atrVal * atrMult
downtrend = emaFast < emaSlow and (emaSlow - emaFast) > atrVal * atrMult

// === VWAP (resets daily) ===
vwap = ta.vwap(vwapSource)

// === Entry Conditions ===
longEntry  = uptrend and close < vwap
shortEntry = downtrend and close > vwap

if longEntry
    strategy.entry("Long", strategy.long)

if shortEntry
    strategy.entry("Short", strategy.short)

// === Exit Rules ===
longTakeProfit  = vwap + atrVal * atrMult
shortTakeProfit = vwap - atrVal * atrMult

if strategy.position_size > 0
    strategy.exit("TP Long", "Long", limit=longTakeProfit)
else if strategy.position_size < 0
    strategy.exit("TP Short", "Short", limit=shortTakeProfit)

// === Plotting ===
plot(vwap, color=color.orange,  title="VWAP")
plot(emaFast, color=color.blue, title="EMA Fast")
plot(emaSlow, color=color.red,  title="EMA Slow")