//@version=5
strategy("THE NQ 9:50 AM Candle Strategy v3 (Trade at 9:55AM) - 1 Contract", overlay=true, initial_capital=50000, default_qty_type=strategy.fixed, default_qty_value=1, currency=currency.USD)

// Input parameters
tickSize = 0.25  // NQ tick size
pointValue = 20  // NQ point value per contract
profitTarget = 750  // $750 profit target (150 ticks * $5/tick)
stopLoss = 1000     // $1000 stop loss (200 ticks * $5/tick)
targetTicks = 150    // Target in ticks
stopTicks = 200      // Stop loss in ticks

// Define time range for 9:50 AM to 9:55 AM EST
exchangeTimezone = "America/New_York"

// 9:50 AM to 9:55 AM time window
nineFiftyAM = timestamp("America/New_York", year, month, dayofmonth, 9, 50)
nineFiftyFiveAM = timestamp("America/New_York", year, month, dayofmonth, 9, 55)

// Detect if we're in the right timeframe
is_9_50_candle = (time >= nineFiftyAM and time < nineFiftyFiveAM)
is_entry_time = (time >= nineFiftyAM and time < nineFiftyAM + (5 * 60 * 1000))  // Changed to 9:50 AM

// Function to calculate target and stop price based on entry price and direction
calculate_target_price(entry_price, is_long) =>
    is_long ? entry_price + (targetTicks * tickSize) : entry_price - (targetTicks * tickSize)

calculate_stop_price(entry_price, is_long) =>
    is_long ? entry_price - (stopTicks * tickSize) : entry_price + (stopTicks * tickSize)

// Track the 9:50 AM candle and determine the direction (bullish or bearish)
var float candle_open = na
var float candle_close = na
var bool candle_direction = na

if is_9_50_candle
    candle_open := open
    candle_close := close
    candle_direction := candle_close > candle_open  // Bullish if close > open, otherwise bearish

// Entry conditions: Wait until 9:50 AM (instead of 9:55 AM)
longCondition = is_entry_time and candle_direction
shortCondition = is_entry_time and not candle_direction

// Execute strategy entries at 9:50 AM based on the 9:50 AM candle direction
if longCondition
    strategy.entry("Long", strategy.long)

if shortCondition
    strategy.entry("Short", strategy.short)

// Set profit targets and stop losses
if strategy.position_size > 0
    strategy.exit("Long Exit", "Long", limit=calculate_target_price(strategy.position_avg_price, true), stop=calculate_stop_price(strategy.position_avg_price, true))

if strategy.position_size < 0
    strategy.exit("Short Exit", "Short", limit=calculate_target_price(strategy.position_avg_price, false), stop=calculate_stop_price(strategy.position_avg_price, false))

// Plot entry signals on the chart
plotshape(series=longCondition, title="Long Entry", style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)
plotshape(series=shortCondition, title="Short Entry", style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)