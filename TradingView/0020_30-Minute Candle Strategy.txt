//@version=5
strategy("30-Minute Candle Strategy", overlay=true)

// Define Global Variables
var float PreviousCandleClose = na
var float StopLoss = na

// Get Previous Candle's Close (1 bar ago)
if (bar_index > 1)
    PreviousCandleClose := close[1]

// Check for Buy Setup: If the current candle opens above the previous candle close
if (open > PreviousCandleClose)
    // Execute Buy Trade
    strategy.entry("Buy", strategy.long)
    // Set Stop Loss for Buy (StopLoss is stored for reference but not used directly)
    StopLoss := PreviousCandleClose

// Check for Sell Setup (if Buy Trade Stop-Loss is hit and market moves below previous close)
if (strategy.position_size > 0 and open < PreviousCandleClose)
    // Execute Sell Trade
    strategy.entry("Sell", strategy.short)
    // Set Stop Loss for Sell (StopLoss is stored for reference but not used directly)
    StopLoss := PreviousCandleClose

// Close Trades 1 Minute Before the Current Candle Closes (for 30-minute strategy)
if (time_close - time >= 29 * 60 * 1000)  // 1 minute before candle close
    // Close Buy Trade
    strategy.close("Buy")
    // Close Sell Trade
    strategy.close("Sell")