//@version=5
strategy("Dual Momentum Strategy", overlay=false, precision=2, calc_on_every_tick=true, initial_capital=20000, currency=currency.USD, slippage=1, commission_type=strategy.commission.cash_per_order, commission_value=0.05)

// Custom Inputs
period = input.int(12, title="Momentum Period (Months)", minval=1)
safe_asset = input.symbol("TLT", title="Safe Asset (Bonds)")
risky_asset = input.symbol("SPY", title="Risky Asset (Stocks)")

// Monthly Return Calculation
getMomentum(symbol) =>
    src = request.security(symbol, "M", close)  // Monthly close prices
    momentum = (src - src[period]) / src[period]  // Relative return over the historical period
    momentum

// Momentum Calculations
momentum_risky = getMomentum(risky_asset)
momentum_safe = getMomentum(safe_asset)

// Dual Momentum Decision
// Absolute Momentum: Only select risky asset if its momentum is positive
is_risky_positive = momentum_risky > 0
is_risky_higher = momentum_risky > momentum_safe

// Strategy Rules: Buy risky asset only if both conditions are met, otherwise allocate to the safe asset
if (is_risky_positive and is_risky_higher)
    strategy.entry("Long Risky Asset", strategy.long)
    strategy.close("Long Safe Asset")
else
    strategy.entry("Long Safe Asset", strategy.long)
    strategy.close("Long Risky Asset")

// Plot Information
plot(momentum_risky, color=color.blue, title="Momentum Risky Asset")
plot(momentum_safe, color=color.red, title="Momentum Safe Asset")