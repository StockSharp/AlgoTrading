//@version=5
strategy("High/Low Breakout Strategy", overlay=true, precision=2, calc_on_every_tick=true, initial_capital=20000, currency=currency.USD, slippage=1, commission_type=strategy.commission.percent, commission_value=0.01)

// Dropdown for selecting the entry strategy
entry_option = input.string(defval="Long at High", title="Entry Strategy", options=["Long at High", "Short at High", "Long at Low", "Short at Low"])

// Dropdown for selecting the timeframe
timeframe_option = input.string(defval="Daily", title="Choose Timeframe", options=["Daily", "Weekly", "Monthly"])

// Holding period of the position in bars
holding_period = input.int(defval=5, title="Holding Period", minval=1)

// Colors for the lines (RGB)
high_color = color.rgb(193, 205, 193)  // Color for High
low_color = color.rgb(193, 205, 193)   // Color for Low

// Calculating highs and lows for all timeframes
daily_high = request.security(syminfo.tickerid, "D", high)
daily_low = request.security(syminfo.tickerid, "D", low)

weekly_high = request.security(syminfo.tickerid, "W", high)
weekly_low = request.security(syminfo.tickerid, "W", low)

monthly_high = request.security(syminfo.tickerid, "M", high)
monthly_low = request.security(syminfo.tickerid, "M", low)

// Selecting the correct values based on the dropdown selection
var float high_level = na
var float low_level = na

if (timeframe_option == "Daily")
    high_level := daily_high
    low_level := daily_low
else if (timeframe_option == "Weekly")
    high_level := weekly_high
    low_level := weekly_low
else if (timeframe_option == "Monthly")
    high_level := monthly_high
    low_level := monthly_low

// Drawing lines for High and Low
plot(high_level, color=high_color, linewidth=1, title="High Level")
plot(low_level, color=low_color, linewidth=1, title="Low Level")

// Trading logic based on the selected strategy
if (entry_option == "Long at High" and ta.crossover(close, high_level))
    strategy.entry("Long at High", strategy.long)

if (entry_option == "Short at High" and ta.crossunder(close, high_level))
    strategy.entry("Short at High", strategy.short)

if (entry_option == "Long at Low" and ta.crossover(close, low_level))
    strategy.entry("Long at Low", strategy.long)

if (entry_option == "Short at Low" and ta.crossunder(close, low_level))
    strategy.entry("Short at Low", strategy.short)

// Close positions after the set holding period
if (strategy.opentrades > 0)
    if (bar_index >= strategy.opentrades.entry_bar_index(0) + holding_period)
        strategy.close(strategy.opentrades.entry_id(0))