//@version=6
strategy("VWAP PRO V21 - Final Ultimate Edition", overlay=true, initial_capital=100000)

// === Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===
emaFast  = input.int(9, "EMA Fast")
emaSlow  = input.int(21, "EMA Slow")
atrLen   = input.int(14, "ATR Length")
tpMult   = input.float(0.7, "TP ATR Multiplier")
slMult   = input.float(1.4, "SL ATR Multiplier")

// === Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===
emaF = ta.ema(close, emaFast)
emaS = ta.ema(close, emaSlow)
vwapLine = ta.vwap
atr = ta.atr(atrLen)

// === ÙÙ„ØªØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø°ÙƒÙŠ Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ… Ø§Ù„Ø£ÙƒØ¨Ø± (1H) ===
trendHTF = request.security(syminfo.tickerid, "60", ta.ema(close, 50))
trendOK  = close > trendHTF ? 1 : close < trendHTF ? -1 : 0

// === Ø´Ø±ÙˆØ· Ø§Ù„Ø¯Ø®ÙˆÙ„ ===
longCond  = close > emaF and emaF > emaS and close > vwapLine and trendOK == 1
shortCond = close < emaF and emaF < emaS and close < vwapLine and trendOK == -1

// === Ù…Ø³ØªÙˆÙŠØ§Øª TP / SL (Ù‚ÙŠÙ… ÙÙ‚Ø·) ===
tpL = close + atr * tpMult
slL = close - atr * slMult
tpS = close - atr * tpMult
slS = close + atr * slMult

// === ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø§Øª ===
if (longCond)
    strategy.entry("CALL", strategy.long)
    strategy.exit("EXIT CALL", "CALL", stop=slL, limit=tpL)

if (shortCond)
    strategy.entry("PUT", strategy.short)
    strategy.exit("EXIT PUT", "PUT", stop=slS, limit=tpS)

// âœ… âœ… âœ… ÙˆØ§Ø¬Ù‡Ø© Ø¨ØµØ±ÙŠØ© Ù…Ø­Ø³Ù‘Ù†Ø©

// ðŸ”¹ Box Ø®ÙÙŠÙ ÙŠØ­ÙŠØ· Ø¨Ø§Ù„Ø´Ù…Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„ØµÙÙ‚Ø©
boxColor = longCond ? color.new(color.green, 90) : shortCond ? color.new(color.red, 90) : na
bgcolor(boxColor)

// ðŸ”¹ Ø³Ù‡Ù… Ø¯Ø®ÙˆÙ„ Ø¨Ø³ÙŠØ·
plotshape(longCond, title="CALL ENTRY", location=location.belowbar, color=color.new(color.lime, 0), style=shape.triangleup, size=size.small, text="CALL")
plotshape(shortCond, title="PUT ENTRY", location=location.abovebar, color=color.new(color.red, 0), style=shape.triangledown, size=size.small, text="PUT")

// ðŸ”¹ Ø¹Ù„Ø§Ù…Ø§Øª TP/SL Ø£Ù†ÙŠÙ‚Ø© ÙÙ‚Ø· ÙˆÙ‚Øª Ø§Ù„ØµÙÙ‚Ø©
plotshape(longCond, title="TP CALL", location=location.abovebar, color=color.new(color.green, 20), style=shape.circle, size=size.tiny, text="ðŸŽ¯")
plotshape(longCond, title="SL CALL", location=location.belowbar, color=color.new(color.red, 20), style=shape.circle, size=size.tiny, text="â›”")
plotshape(shortCond, title="TP PUT", location=location.belowbar, color=color.new(color.green, 20), style=shape.circle, size=size.tiny, text="ðŸŽ¯")
plotshape(shortCond, title="SL PUT", location=location.abovebar, color=color.new(color.red, 20), style=shape.circle, size=size.tiny, text="â›”")

// === ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ===
alertcondition(longCond, title="ðŸš€ CALL Alert", message="âœ… Ø¯Ø®ÙˆÙ„ ØµÙÙ‚Ø© CALL - VWAP PRO V21")
alertcondition(shortCond, title="ðŸ”¥ PUT Alert", message="âŒ Ø¯Ø®ÙˆÙ„ ØµÙÙ‚Ø© PUT - VWAP PRO V21")

// === ØªÙ†Ø¨ÙŠÙ‡ Pre-Signal Ù‚Ø¨Ù„ Ø§Ù„ØµÙÙ‚Ø© Ø¨Ø´Ù…Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© ===
preLong  = ta.crossover(emaF, emaS) and trendOK == 1
preShort = ta.crossunder(emaF, emaS) and trendOK == -1
alertcondition(preLong, title="ðŸ”” Pre CALL", message="ðŸ“¢ ØµÙÙ‚Ø© CALL Ù…Ø­ØªÙ…Ù„Ø© Ù‚Ø±ÙŠØ¨Ø©!")
alertcondition(preShort, title="ðŸ”” Pre PUT", message="ðŸ“¢ ØµÙÙ‚Ø© PUT Ù…Ø­ØªÙ…Ù„Ø© Ù‚Ø±ÙŠØ¨Ø©!")