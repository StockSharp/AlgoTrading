//@version=6
strategy('Test Bot: Bearish Buy / Bullish Sell', overlay = true, default_qty_type = strategy.fixed, default_qty_value = 1)

// Candle direction
isBullish = close > open
isBearish = close < open

// Persistent state to track if we're in a position
var bool inTrade = false

// Entry logic — buy only on the **first bearish candle** if NOT already in a trade
if not inTrade and isBearish
    strategy.entry('Long', strategy.long)
    inTrade := true
    inTrade

// Exit logic — sell only on the **first bullish candle** if we ARE in a trade
if inTrade and isBullish
    strategy.close('Long')
    inTrade := false
    inTrade

// Plot markers for visual debug
plotshape(not inTrade and isBearish, title = 'Buy Signal', location = location.belowbar, color = color.green, style = shape.labelup, text = 'BUY')
plotshape(inTrade and isBullish, title = 'Sell Signal', location = location.abovebar, color = color.red, style = shape.labeldown, text = 'SELL')