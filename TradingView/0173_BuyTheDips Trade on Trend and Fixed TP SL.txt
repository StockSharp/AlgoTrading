// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © reject6

//@version=6
strategy('BuyTheDips Trade on Trend and Fixed TP/SL', overlay = true)

// Input Parameters
fastLength = input.int(50, title = 'Fast EMA Length', minval = 1)
slowLength = input.int(200, title = 'Slow EMA Length', minval = 1)
takeProfitPerc = input.float(0.7, title = 'Take Profit (%)', step = 0.1)
stopLossPerc = input.float(2.0, title = 'Stop Loss (%)', step = 0.1)

// Calculate EMAs
fastEMA = ta.ema(close, fastLength)
slowEMA = ta.ema(close, slowLength)

// Trend Detection
isBullishTrend = fastEMA > slowEMA
isBearishTrend = fastEMA < slowEMA

// Entry Signals
longSignal = ta.crossover(fastEMA, slowEMA) and isBullishTrend
shortSignal = ta.crossunder(fastEMA, slowEMA) and isBearishTrend

// Convert TP/SL percentages into price levels
longTakeProfit = close * (1 + takeProfitPerc / 100)
longStopLoss = close * (1 - stopLossPerc / 100)
shortTakeProfit = close * (1 - takeProfitPerc / 100)
shortStopLoss = close * (1 + stopLossPerc / 100)

// Execute Trades
if longSignal
    strategy.entry('Long', strategy.long)
    strategy.exit('Take Profit/Stop Loss', 'Long', limit = longTakeProfit, stop = longStopLoss)

if shortSignal
    strategy.entry('Short', strategy.short)
    strategy.exit('Take Profit/Stop Loss', 'Short', limit = shortTakeProfit, stop = shortStopLoss)

// Plot EMAs
plot(fastEMA, title = 'Fast EMA', color = color.green, linewidth = 2)
plot(slowEMA, title = 'Slow EMA', color = color.red, linewidth = 2)

// Plot Buy and Sell Labels
plotshape(series = longSignal, title = 'Buy Signal', location = location.belowbar, color = color.green, style = shape.labelup, text = 'BUY')
plotshape(series = shortSignal, title = 'Sell Signal', location = location.abovebar, color = color.red, style = shape.labeldown, text = 'SELL')