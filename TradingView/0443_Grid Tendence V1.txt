// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © morzns
//@version=6
strategy('Grid Tendence V1', overlay = true, default_qty_type = strategy.percent_of_equity, default_qty_value = 5, initial_capital = 1000, commission_value = 0.01, calc_on_every_tick = true)
//Inputs
percent = input.float(1.00, title = '(%) Grid:', minval = 0.1, step = 0.1)
entry = strategy.closedtrades.exit_price(strategy.closedtrades - 1)
//Functions
fun1(close) =>
    strategy.close_all()
    strategy.entry('Long', strategy.long)
fun2(close) =>
    strategy.close_all()
    strategy.entry('Short', strategy.short)
fun3(close) =>
    strategy.close_all()
    strategy.entry('Short', strategy.short)
fun4(close) =>
    strategy.close_all()
    strategy.entry('Long', strategy.long)
//Script
if strategy.position_size == 0
    strategy.entry('Long', strategy.long)
else if strategy.position_size > 0
    if strategy.opentrades.profit_percent(strategy.opentrades - 1) >= percent
        fun1(close)
    else if strategy.opentrades.profit_percent(strategy.opentrades - 1) <= -percent
        fun2(close)
else if strategy.position_size < 0
    if strategy.opentrades.profit_percent(strategy.opentrades - 1) >= percent
        fun3(close)
    else if strategy.opentrades.profit_percent(strategy.opentrades - 1) <= -percent
        fun4(close)
//Plot
plot(entry, title = 'Close', color = color.gray, linewidth = 1, style = plot.style_circles)