//@version=6
strategy("8/30 SMA Pullback + ATR Exits (Crypto)", overlay=true,
         default_qty_type=strategy.percent_of_equity,
         default_qty_value=100, initial_capital=200)

// === Inputs === //
smaFastLen   = input.int(8,  "Fast SMA",  minval=1)
smaSlowLen   = input.int(30, "Slow SMA",  minval=1)
atrMultSL    = input.float(1.2, "ATR Multiplier SL", step=0.1)
atrMultTP    = input.float(2.0, "ATR Multiplier TP", step=0.1)

// === Core Series === //
smaFast = ta.sma(close, smaFastLen)
smaSlow = ta.sma(close, smaSlowLen)
atr     = ta.atr(14)

// === Entry Conditions === //
longCond  = close < smaFast and smaFast > smaSlow
shortCond = close > smaFast and smaFast < smaSlow

if longCond
    strategy.entry("Long", strategy.long)

if shortCond
    strategy.entry("Short", strategy.short)

// === ATR-based TP / SL === //
if strategy.position_size > 0
    longSL = strategy.position_avg_price - atr * atrMultSL
    longTP = strategy.position_avg_price + atr * atrMultTP
    strategy.exit(id="Exit Long", from_entry="Long",
                  stop=longSL, limit=longTP)

if strategy.position_size < 0
    shortSL = strategy.position_avg_price + atr * atrMultSL
    shortTP = strategy.position_avg_price - atr * atrMultTP
    strategy.exit(id="Exit Short", from_entry="Short",
                  stop=shortSL, limit=shortTP)

// === Visuals === //
plot(smaFast, "Fast SMA",  color=color.blue)
plot(smaSlow, "Slow SMA",  color=color.gray)