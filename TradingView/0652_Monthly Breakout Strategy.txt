// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© EdgeTools

//@version=5
strategy("Monthly Breakout Strategy", overlay=true, precision=2, calc_on_every_tick=true, initial_capital=20000, currency=currency.USD, slippage=1, commission_type=strategy.commission.percent, commission_value=0.01)

// Dropdown for selecting the entry strategy
entry_option = input.string(defval="Long at High", title="Entry Strategy", options=["Long at High", "Short at High", "Long at Low", "Short at Low"])

// Checkboxes for selecting multiple months
jan_selected = input.bool(false, title="January")
feb_selected = input.bool(false, title="February")
mar_selected = input.bool(false, title="March")
apr_selected = input.bool(false, title="April")
may_selected = input.bool(false, title="May")
jun_selected = input.bool(false, title="June")
jul_selected = input.bool(false, title="July")
aug_selected = input.bool(false, title="August")
sep_selected = input.bool(false, title="September")
oct_selected = input.bool(false, title="October")
nov_selected = input.bool(false, title="November")
dec_selected = input.bool(false, title="December")

// Holding period of the position in bars
holding_period = input.int(defval=5, title="Holding Period", minval=1)

// Colors for the lines (RGB)
high_color = color.rgb(193, 205, 193)  // Color for High
low_color = color.rgb(193, 205, 193)   // Color for Low

// Calculating highs and lows for monthly timeframe
monthly_high = request.security(syminfo.tickerid, "M", high)
monthly_low = request.security(syminfo.tickerid, "M", low)

// Drawing lines for High and Low
plot(monthly_high, color=high_color, linewidth=1, title="Monthly High Level")
plot(monthly_low, color=low_color, linewidth=1, title="Monthly Low Level")

// Only allow trades during the selected months
is_selected_month = ((month == 1 and jan_selected) or (month == 2 and feb_selected) or (month == 3 and mar_selected) or (month == 4 and apr_selected) or (month == 5 and may_selected) or (month == 6 and jun_selected) or (month == 7 and jul_selected) or (month == 8 and aug_selected) or (month == 9 and sep_selected) or (month == 10 and oct_selected) or (month == 11 and nov_selected) or (month == 12 and dec_selected))

// Pre-calculate crossover and crossunder conditions
long_at_high_condition = ta.crossover(close, monthly_high)
short_at_high_condition = ta.crossunder(close, monthly_high)
long_at_low_condition = ta.crossover(close, monthly_low)
short_at_low_condition = ta.crossunder(close, monthly_low)

// Trading logic based on the selected strategy and month filter
if (is_selected_month)
    if (entry_option == "Long at High" and long_at_high_condition)
        strategy.entry("Long at High", strategy.long)

    if (entry_option == "Short at High" and short_at_high_condition)
        strategy.entry("Short at High", strategy.short)

    if (entry_option == "Long at Low" and long_at_low_condition)
        strategy.entry("Long at Low", strategy.long)

    if (entry_option == "Short at Low" and short_at_low_condition)
        strategy.entry("Short at Low", strategy.short)

// Close positions after the set holding period
if (strategy.opentrades > 0)
    if (bar_index >= strategy.opentrades.entry_bar_index(0) + holding_period)
        strategy.close(strategy.opentrades.entry_id(0))