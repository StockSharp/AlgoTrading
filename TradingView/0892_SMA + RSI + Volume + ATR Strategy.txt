// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © jbdorji
//@version=5
strategy("SMA + RSI + Volume + ATR Strategy", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// Input parameters
smaLength = input.int(50, title="SMA Length")
rsiLength = input.int(14, title="RSI Length")
rsiOverbought = input.int(70, title="RSI Overbought Level")
rsiOversold = input.int(30, title="RSI Oversold Level")
volumeThreshold = input.float(1.5, title="Volume Threshold (Multiple of Average Volume)")
atrLength = input.int(14, title="ATR Length")
atrMultiplier = input.float(1.5, title="ATR Multiplier for Stop Loss/Take Profit")
takeProfitPerc = input.float(1.5, title="Take Profit (%)")
stopLossPerc = input.float(0.5, title="Stop Loss (%)")

// Calculate indicators
sma = ta.sma(close, smaLength)
rsi = ta.rsi(close, rsiLength)
atr = ta.atr(atrLength)
avgVolume = ta.sma(volume, 20) // 20-period average volume

// Buy condition: Price above SMA, RSI below oversold, volume above threshold, and volatility filter
buyCondition = close > sma and rsi < rsiOversold and volume > avgVolume * volumeThreshold and atr > atr[1]

// Sell condition: Price below SMA, RSI above overbought, volume above threshold, and volatility filter
sellCondition = close < sma and rsi > rsiOverbought and volume > avgVolume * volumeThreshold and atr > atr[1]

// Execute trades
if (buyCondition)
    strategy.entry("Buy", strategy.long)
    strategy.exit("Take Profit/Stop Loss", "Buy", limit=close * (1 + takeProfitPerc / 100), stop=close * (1 - stopLossPerc / 100))

if (sellCondition)
    strategy.entry("Sell", strategy.short)
    strategy.exit("Take Profit/Stop Loss", "Sell", limit=close * (1 - takeProfitPerc / 100), stop=close * (1 + stopLossPerc / 100))

// Plot indicators
plot(sma, color=color.blue, title="50 SMA")
hline(rsiOverbought, "Overbought", color=color.red)
hline(rsiOversold, "Oversold", color=color.green)
plot(rsi, color=color.purple, title="RSI")
plot(atr, color=color.orange, title="ATR")

// Plot buy and sell arrows on the chart
plotarrow(buyCondition ? 1 : na, colorup=color.green, offset=-1)  // Green up arrow for buy
plotarrow(sellCondition ? -1 : na, colordown=color.red, offset=-1)  // Red down arrow for sell