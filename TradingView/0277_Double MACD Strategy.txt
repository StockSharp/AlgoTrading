//@version=5
strategy("Double MACD Strategy", overlay=false, pyramiding=1, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// First MACD settings (fast)
fast_len1   = input.int(12, "Fast Length 1", minval=1)
slow_len1   = input.int(26, "Slow Length 1", minval=1)
signal_len1 = input.int(9,  "Signal Length 1", minval=1)
ma_type1    = input.string("EMA", "MA Type for MACD 1", options=["EMA", "SMA"])

// Second MACD settings (slow)
fast_len2   = input.int(24, "Fast Length 2", minval=1)
slow_len2   = input.int(52, "Slow Length 2", minval=1)
signal_len2 = input.int(9,  "Signal Length 2", minval=1)
ma_type2    = input.string("EMA", "MA Type for MACD 2", options=["EMA", "SMA"])

// MA selector function
ma(src, len, type) => type == "EMA" ? ta.ema(src, len) : ta.sma(src, len)

// MACD calculation function
macdCalc(src, fast_length, slow_length, signal_length, ma_type) =>
    fastMA     = ma(src, fast_length, ma_type)
    slowMA     = ma(src, slow_length, ma_type)
    macdLine   = fastMA - slowMA
    signalLine = ma(macdLine, signal_length, ma_type)
    [macdLine, signalLine]

// Calculate both MACDs
[macd1, signal1] = macdCalc(close, fast_len1, slow_len1, signal_len1, ma_type1)
[macd2, signal2] = macdCalc(close, fast_len2, slow_len2, signal_len2, ma_type2)

// Entry and exit signals
longSignal   = (macd1 > signal1) and (macd2 > signal2)
shortSignal  = (macd1 < signal1) and (macd2 < signal2)

// Execute entries and flips
if (longSignal)
    strategy.entry("Long", strategy.long)
    strategy.close("Short")

if (shortSignal)
    strategy.entry("Short", strategy.short)
    strategy.close("Long")

// Plot MACD lines and signals
plot(macd1,   color=color.blue,   title="MACD 1")
plot(signal1, color=color.orange, title="Signal 1")
plot(macd2,   color=color.green,  title="MACD 2")
plot(signal2, color=color.red,    title="Signal 2")

// Background shading
bgcolor(longSignal  ? color.new(color.green, 90) : na, title="Buy Background")
bgcolor(shortSignal ? color.new(color.red,   90) : na, title="Sell Background")