//@version=5
strategy(title="Range Filter Strategy [Real Backtest]", shorttitle="RF Strategy", overlay=true,
         process_orders_on_close = false,     // Ø­Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±
         calc_on_every_tick = true,           // Ø­Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±
         use_bar_magnifier = true,            // Ø­Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±
         fill_orders_on_standard_ohlc = false, // Ø­Ù„ Ø§Ù„ØªØ£Ø®ÙŠØ±
         max_lines_count = 500, max_labels_count = 500, max_boxes_count = 500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ›ï¸ CORE RANGE FILTER SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var g_CORE = "ğŸ¯ Range Filter Core"
src = input(defval=close, title="Ø§Ù„Ù…ØµØ¯Ø±", group = g_CORE)
per = input.int(defval=100, minval=1, title="ÙØªØ±Ø© Ø§Ù„Ø¹ÙŠÙ†Ø©", tooltip="100 Ù„Ù„Ø¨ØªÙƒÙˆÙŠÙ† 5Ø¯ØŒ Ø¹Ø¯Ù„ Ù„Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ø£Ø®Ø±Ù‰", group = g_CORE)
mult = input.float(defval=3.0, minval=0.1, title="Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ù…Ø¯Ù‰", tooltip="3.0 Ù„Ù„Ø¨ØªÙƒÙˆÙŠÙ†ØŒ Ù‚Ù„Ù„ Ù„Ù„Ø£Ø³ÙˆØ§Ù‚ Ø£Ù‚Ù„ ØªÙ‚Ù„Ø¨Ø§Ù‹", group = g_CORE)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ REALISTIC EXECUTION SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var g_REAL = "ğŸ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ"

// Entry Execution
use_realistic_entry = input.bool(true, "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù‚Ø¹ÙŠ", tooltip="Ø§Ø³ØªØ®Ø¯Ø§Ù… HL2 Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Close", group = g_REAL)
spread_buffer = input.float(2.0, "Ù‡Ø§Ù…Ø´ Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯ (Ù†Ù‚Ø§Ø·)", minval=0, tooltip="Ø³Ø¨Ø±ÙŠØ¯ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©", group = g_REAL)
enable_slippage = input.bool(true, "Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠ", tooltip="Ø¥Ø¶Ø§ÙØ© Ø§Ù†Ø²Ù„Ø§Ù‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„ÙˆØ§Ù‚Ø¹ÙŠØ©", group = g_REAL)
max_slippage = input.float(1.0, "Ø£Ù‚ØµÙ‰ Ø§Ù†Ø²Ù„Ø§Ù‚ (Ù†Ù‚Ø§Ø·)", minval=0, group = g_REAL)

// Market Conditions
enable_volume_filter = input.bool(false, "ÙÙ„ØªØ± Ø§Ù„Ø­Ø¬Ù…", group = g_REAL)
min_volume_ratio = input.float(1.2, "Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£Ø¯Ù†Ù‰", tooltip="Ø§Ù„Ø­Ø¬Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø·", group = g_REAL)

// Confirmation
require_confirmation = input.bool(false, "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©", group = g_REAL)
confirmation_bars = input.int(1, "Ø´Ù…ÙˆØ¹ Ø§Ù„ØªØ£ÙƒÙŠØ¯", minval=0, maxval=3, group = g_REAL)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”” ALERT SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var g_ALERTS = "ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª"
enable_alerts = input.bool(true, "ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª", group = g_ALERTS)
enable_entry_alerts = input.bool(true, "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„", group = g_ALERTS)
enable_setup_alerts = input.bool(false, "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯", tooltip="ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø¥Ø´Ø§Ø±Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯", group = g_ALERTS)
enable_exit_alerts = input.bool(true, "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø®Ø±ÙˆØ¬", group = g_ALERTS)
enable_status_alerts = input.bool(false, "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©", tooltip="ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªØºÙŠÙŠØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø±Ø´Ø­", group = g_ALERTS)

// Alert message customization
custom_symbol = input.string("", "Ø±Ù…Ø² Ù…Ø®ØµØµ", tooltip="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±Øº Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„ÙŠ", group = g_ALERTS)
include_price = input.bool(true, "ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø³Ø¹Ø±", group = g_ALERTS)
include_time = input.bool(true, "ØªØ¶Ù…ÙŠÙ† Ø§Ù„ÙˆÙ‚Øª", group = g_ALERTS)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’° RISK MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var g_RISK = "ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±"
use_fixed_rr = input.bool(true, "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø³Ø¨Ø© Ø«Ø§Ø¨ØªØ©", group = g_RISK)
risk_points = input.float(50, "ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© (Ù†Ù‚Ø§Ø·)", group = g_RISK)
reward_points = input.float(100, "Ù‡Ø¯Ù Ø§Ù„Ø±Ø¨Ø­ (Ù†Ù‚Ø§Ø·)", group = g_RISK)
max_trades_per_day = input.int(5, "Ø£Ù‚ØµÙ‰ ØµÙÙ‚Ø§Øª ÙÙŠ Ø§Ù„ÙŠÙˆÙ…", minval=1, group = g_RISK)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ VISUAL SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var g_VIS = "ğŸ¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ©"
show_filter = input.bool(true, "Ø¹Ø±Ø¶ Range Filter", group = g_VIS)
show_bands = input.bool(true, "Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª", group = g_VIS)
show_signals = input.bool(true, "Ø¹Ø±Ø¶ Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„", group = g_VIS)
show_dashboard = input.bool(true, "Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", group = g_VIS)

// Enhanced Colors - ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù‡Ù†Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
upColor = color.new(#00ff88, 0)          // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ù…Ù…ÙŠØ²
downColor = color.new(#ff4444, 0)        // Ø£Ø­Ù…Ø± Ø¬Ø°Ø§Ø¨
midColor = color.new(#4a90e2, 50)        // Ø£Ø²Ø±Ù‚ Ù…ØªÙˆØ³Ø·
signal_up_color = color.new(#00ff88, 20)     // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ù„Ù„Ø¥Ø´Ø§Ø±Ø§Øª
signal_down_color = color.new(#ff4444, 20)   // Ø£Ø­Ù…Ø± Ù„Ù„Ø¥Ø´Ø§Ø±Ø§Øª
band_up_color = color.new(#00ff88, 70)       // Ø£Ø®Ø¶Ø± Ø´ÙØ§Ù Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù„ÙˆÙŠ
band_down_color = color.new(#ff4444, 70)     // Ø£Ø­Ù…Ø± Ø´ÙØ§Ù Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ
fill_up_color = color.new(#00ff88, 90)       // ØªØ¹Ø¨Ø¦Ø© Ø®Ø¶Ø±Ø§Ø¡
fill_down_color = color.new(#ff4444, 90)     // ØªØ¹Ø¨Ø¦Ø© Ø­Ù…Ø±Ø§Ø¡

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§® RANGE FILTER CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Smooth Average Range
smoothrng(x, t, m) =>
    wper = t * 2 - 1
    avrng = ta.ema(math.abs(x - x[1]), t)
    smoothrng = ta.ema(avrng, wper) * m
    smoothrng

smrng = smoothrng(src, per, mult)

// Range Filter
rngfilt(x, r) =>
    rngfilt = x
    rngfilt := x > nz(rngfilt[1]) ? x - r < nz(rngfilt[1]) ? nz(rngfilt[1]) : x - r :
       x + r > nz(rngfilt[1]) ? nz(rngfilt[1]) : x + r
    rngfilt

filt = rngfilt(src, smrng)

// Filter Direction
upward = 0.0
upward := filt > filt[1] ? nz(upward[1]) + 1 : filt < filt[1] ? 0 : nz(upward[1])
downward = 0.0
downward := filt < filt[1] ? nz(downward[1]) + 1 : filt > filt[1] ? 0 : nz(downward[1])

// Target Bands
hband = filt + smrng
lband = filt - smrng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ REALISTIC ENTRY PRICE CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

get_realistic_price(is_long, signal_price) =>
    // Use HL2 if enabled, otherwise use signal price
    base_price = use_realistic_entry ? (high + low) / 2 : signal_price

    // Add spread
    spread_adj = spread_buffer

    // Add random slippage if enabled
    if enable_slippage
        random_slip = math.random(0, max_slippage)
        spread_adj += random_slip

    // Apply adjustment
    final_price = is_long ? base_price + spread_adj : base_price - spread_adj
    final_price

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š SIGNAL GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Basic Conditions
longCond = src > filt and src > src[1] and upward > 0 or src > filt and src < src[1] and upward > 0
shortCond = src < filt and src < src[1] and downward > 0 or src < filt and src > src[1] and downward > 0

// State Management
CondIni = 0
CondIni := longCond ? 1 : shortCond ? -1 : CondIni[1]

// Base Signals
longSignal = longCond and CondIni[1] == -1
shortSignal = shortCond and CondIni[1] == 1

// Volume Filter
volume_ok = not enable_volume_filter or volume > ta.sma(volume, 20) * min_volume_ratio

// Confirmation Filter
var int long_setup_bar = na
var int short_setup_bar = na
var bool long_waiting = false
var bool short_waiting = false

// Reset setup tracking
if not require_confirmation
    long_setup_bar := na
    short_setup_bar := na
    long_waiting := false
    short_waiting := false

// Track setup signals
if longSignal and volume_ok and not long_waiting
    if require_confirmation
        long_setup_bar := bar_index
        long_waiting := true
    else
        long_setup_bar := bar_index  // For immediate execution

if shortSignal and volume_ok and not short_waiting
    if require_confirmation
        short_setup_bar := bar_index
        short_waiting := true
    else
        short_setup_bar := bar_index  // For immediate execution

// Check confirmation
long_confirmed = false
short_confirmed = false

if not na(long_setup_bar)
    if require_confirmation
        if bar_index >= long_setup_bar + confirmation_bars
            long_confirmed := true
            long_waiting := false
    else
        long_confirmed := true

if not na(short_setup_bar)
    if require_confirmation
        if bar_index >= short_setup_bar + confirmation_bars
            short_confirmed := true
            short_waiting := false
    else
        short_confirmed := true

// Daily Trade Limit
var int daily_trades = 0
var int last_trade_day = 0

if dayofweek != dayofweek[1]
    daily_trades := 0
    last_trade_day := dayofweek

can_trade = daily_trades < max_trades_per_day

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’¹ STRATEGY EXECUTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Entry Conditions
longCondition = long_confirmed and can_trade and strategy.position_size == 0
shortCondition = short_confirmed and can_trade and strategy.position_size == 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”” ALERT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Helper function to build alert messages
get_alert_message(action, entry_price, sl_price, tp_price) =>
    symbol_name = custom_symbol != "" ? custom_symbol : syminfo.ticker
    price_info = include_price ? " | Ø§Ù„Ø³Ø¹Ø±: " + str.tostring(entry_price, "#.##") : ""
    time_info = include_time ? " | Ø§Ù„ÙˆÙ‚Øª: " + str.format_time(timenow, "HH:mm") : ""
    sl_info = not na(sl_price) ? " | ÙˆÙ‚Ù: " + str.tostring(sl_price, "#.##") : ""
    tp_info = not na(tp_price) ? " | Ù‡Ø¯Ù: " + str.tostring(tp_price, "#.##") : ""

    symbol_name + " - " + action + price_info + sl_info + tp_info + time_info

// Track previous states for alerts
var bool prev_upward_state = na
var bool prev_downward_state = na
var float prev_entry_price = na

// Current states
current_upward = upward > 0
current_downward = downward > 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸš¨ REAL-TIME ALERTS (No Delay)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. SETUP ALERTS (Before confirmation)
if enable_alerts and enable_setup_alerts
    if longSignal and volume_ok
        setup_price = get_realistic_price(true, close)
        sl_price = setup_price - risk_points
        tp_price = setup_price + reward_points
        message = get_alert_message("ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯ Ø´Ø±Ø§Ø¡ Ù…Ø­ØªÙ…Ù„", setup_price, sl_price, tp_price)
        alert(message, alert.freq_once_per_bar)

    if shortSignal and volume_ok
        setup_price = get_realistic_price(false, close)
        sl_price = setup_price + risk_points
        tp_price = setup_price - reward_points
        message = get_alert_message("ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¹ Ù…Ø­ØªÙ…Ù„", setup_price, sl_price, tp_price)
        alert(message, alert.freq_once_per_bar)

// 2. ENTRY ALERTS (Exact same logic as strategy)
if enable_alerts and enable_entry_alerts
    if longCondition
        entry_price = get_realistic_price(true, close)
        sl_price = entry_price - risk_points
        tp_price = entry_price + reward_points
        message = get_alert_message("ğŸŸ¢ Ø¯Ø®ÙˆÙ„ Ø´Ø±Ø§Ø¡", entry_price, sl_price, tp_price)
        alert(message, alert.freq_once_per_bar)

    if shortCondition
        entry_price = get_realistic_price(false, close)
        sl_price = entry_price + risk_points
        tp_price = entry_price - reward_points
        message = get_alert_message("ğŸ”´ Ø¯Ø®ÙˆÙ„ Ø¨ÙŠØ¹", entry_price, sl_price, tp_price)
        alert(message, alert.freq_once_per_bar)

// 3. EXIT ALERTS
if enable_alerts and enable_exit_alerts and strategy.position_size != 0
    // Track position changes for exit alerts
    if strategy.position_size[1] != 0 and strategy.position_size == 0
        exit_price = close
        if strategy.position_size[1] > 0
            message = get_alert_message("ğŸ“¤ Ø®Ø±ÙˆØ¬ Ø´Ø±Ø§Ø¡", exit_price, float(na), float(na))
            alert(message, alert.freq_once_per_bar)
        else
            message = get_alert_message("ğŸ“¤ Ø®Ø±ÙˆØ¬ Ø¨ÙŠØ¹", exit_price, float(na), float(na))
            alert(message, alert.freq_once_per_bar)

// 4. STATUS ALERTS (Filter direction changes)
if enable_alerts and enable_status_alerts
    if current_upward and not prev_upward_state
        message = get_alert_message("ğŸ“ˆ Ø§Ù„Ù…Ø±Ø´Ø­ ØµØ§Ø¹Ø¯", filt, float(na), float(na))
        alert(message, alert.freq_once_per_bar)

    if current_downward and not prev_downward_state
        message = get_alert_message("ğŸ“‰ Ø§Ù„Ù…Ø±Ø´Ø­ Ù‡Ø§Ø¨Ø·", filt, float(na), float(na))
        alert(message, alert.freq_once_per_bar)

// Update previous states
prev_upward_state := current_upward
prev_downward_state := current_downward

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“± ALERT CONDITIONS (For TradingView Alert System)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// These can be used to create alerts in TradingView alert panel
alertcondition(longCondition, title="ğŸŸ¢ Range Filter - Ø´Ø±Ø§Ø¡", message="Ø¥Ø´Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ Ù…Ù† Range Filter")
alertcondition(shortCondition, title="ğŸ”´ Range Filter - Ø¨ÙŠØ¹", message="Ø¥Ø´Ø§Ø±Ø© Ø¨ÙŠØ¹ Ù…Ù† Range Filter")
alertcondition(longCondition or shortCondition, title="ğŸ¯ Range Filter - Ø£ÙŠ Ø¥Ø´Ø§Ø±Ø©", message="Ø¥Ø´Ø§Ø±Ø© Ø¯Ø®ÙˆÙ„ Ù…Ù† Range Filter")

// Setup alerts (before confirmation)
alertcondition(longSignal and volume_ok, title="ğŸ¯ Range Filter - Ø¥Ø¹Ø¯Ø§Ø¯ Ø´Ø±Ø§Ø¡", message="Ø¥Ø¹Ø¯Ø§Ø¯ Ø´Ø±Ø§Ø¡ Ù…Ø­ØªÙ…Ù„")
alertcondition(shortSignal and volume_ok, title="ğŸ¯ Range Filter - Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¹", message="Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ¹ Ù…Ø­ØªÙ…Ù„")

// Filter direction alerts
alertcondition(current_upward and not prev_upward_state, title="ğŸ“ˆ Range Filter - Ø§ØªØ¬Ø§Ù‡ ØµØ§Ø¹Ø¯", message="Ø§Ù„Ù…Ø±Ø´Ø­ Ø£ØµØ¨Ø­ ØµØ§Ø¹Ø¯")
alertcondition(current_downward and not prev_downward_state, title="ğŸ“‰ Range Filter - Ø§ØªØ¬Ø§Ù‡ Ù‡Ø§Ø¨Ø·", message="Ø§Ù„Ù…Ø±Ø´Ø­ Ø£ØµØ¨Ø­ Ù‡Ø§Ø¨Ø·")

// Execute Trades
if longCondition
    real_entry_price = get_realistic_price(true, close)
    strategy.entry("Long", strategy.long, comment="Long @ " + str.tostring(real_entry_price, "#.##"))
    daily_trades += 1
    // Reset setup tracking after entry
    long_setup_bar := na
    long_waiting := false

if shortCondition
    real_entry_price = get_realistic_price(false, close)
    strategy.entry("Short", strategy.short, comment="Short @ " + str.tostring(real_entry_price, "#.##"))
    daily_trades += 1
    // Reset setup tracking after entry
    short_setup_bar := na
    short_waiting := false

// Exit Strategy
if use_fixed_rr and strategy.position_size != 0
    if strategy.position_size > 0
        strategy.exit("Long Exit", "Long", profit=reward_points, loss=risk_points, comment="Long Exit")
    if strategy.position_size < 0
        strategy.exit("Short Exit", "Short", profit=reward_points, loss=risk_points, comment="Short Exit")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ VISUAL ELEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Colors
filtcolor = upward > 0 ? upColor : downward > 0 ? downColor : midColor

// Plots
filtplot = plot(show_filter ? filt : na, color=filtcolor, linewidth=3, title="Range Filter")
hbandplot = plot(show_bands ? hband : na, color=band_up_color, linewidth=1, title="High Target")
lbandplot = plot(show_bands ? lband : na, color=band_down_color, linewidth=1, title="Low Target")

// Fills
fill(hbandplot, filtplot, color=fill_up_color, title="High Target Range")
fill(lbandplot, filtplot, color=fill_down_color, title="Low Target Range")

// Signals
plotshape(show_signals and longCondition, title="Buy Signal", text="BUY", textcolor=color.white,
         style=shape.labelup, size=size.normal, location=location.belowbar, color=signal_up_color)
plotshape(show_signals and shortCondition, title="Sell Signal", text="SELL", textcolor=color.white,
         style=shape.labeldown, size=size.normal, location=location.abovebar, color=signal_down_color)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if show_dashboard and barstate.islast
    var table dashboard = table.new(position.top_right, 3, 15, bgcolor = color.new(color.white, 5), border_width = 2, frame_color = color.new(#4a90e2, 0))

    // Header
    table.cell(dashboard, 0, 0, "ğŸ›ï¸ Range Filter Strategy", text_color = color.white, bgcolor = color.new(#4a90e2, 0), text_size = size.small)
    table.cell(dashboard, 1, 0, "Ø§Ù„Ø­Ø§Ù„Ø©", text_color = color.white, bgcolor = color.new(#4a90e2, 0), text_size = size.small)
    table.cell(dashboard, 2, 0, "Ø§Ù„Ù‚ÙŠÙ…Ø©", text_color = color.white, bgcolor = color.new(#4a90e2, 0), text_size = size.small)

    row = 1

    // Timing Settings
    table.cell(dashboard, 0, row, "âš¡ ØªÙ†ÙÙŠØ° ÙÙˆØ±ÙŠ", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, "âœ…", text_color = #00ff88, text_size = size.small)
    table.cell(dashboard, 2, row, "Ù†Ø´Ø·", text_color = color.black, text_size = size.small)
    row += 1

    // Core Settings
    table.cell(dashboard, 0, row, "ğŸ“Š ÙØªØ±Ø© Ø§Ù„Ø¹ÙŠÙ†Ø©", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, "âœ…", text_color = color.green, text_size = size.small)
    table.cell(dashboard, 2, row, str.tostring(per), text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "âš–ï¸ Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ù…Ø¯Ù‰", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, "âœ…", text_color = color.green, text_size = size.small)
    table.cell(dashboard, 2, row, str.tostring(mult), text_color = color.black, text_size = size.small)
    row += 1

    // Realistic Settings
    table.cell(dashboard, 0, row, "ğŸ¯ Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù‚Ø¹ÙŠ", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, use_realistic_entry ? "âœ…" : "âŒ", text_color = use_realistic_entry ? color.green : color.red, text_size = size.small)
    table.cell(dashboard, 2, row, use_realistic_entry ? "HL2" : "Close", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "ğŸ’° Ø§Ù„Ø³Ø¨Ø±ÙŠØ¯", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, "âœ…", text_color = color.green, text_size = size.small)
    table.cell(dashboard, 2, row, str.tostring(spread_buffer) + " Ù†Ù‚Ø·Ø©", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "ğŸ“ˆ Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, enable_slippage ? "âœ…" : "âŒ", text_color = enable_slippage ? color.green : color.red, text_size = size.small)
    table.cell(dashboard, 2, row, enable_slippage ? "0-" + str.tostring(max_slippage) : "Ø¨Ø¯ÙˆÙ†", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "ğŸŒŠ ÙÙ„ØªØ± Ø§Ù„Ø­Ø¬Ù…", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, enable_volume_filter ? "âœ…" : "âŒ", text_color = enable_volume_filter ? color.green : color.red, text_size = size.small)
    table.cell(dashboard, 2, row, enable_volume_filter ? str.tostring(min_volume_ratio) + "x" : "Ù…Ø¹Ø·Ù„", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "ğŸ”„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, require_confirmation ? "âœ…" : "âŒ", text_color = require_confirmation ? color.green : color.red, text_size = size.small)
    table.cell(dashboard, 2, row, require_confirmation ? str.tostring(confirmation_bars) + " Ø´Ù…Ø¹Ø©" : "ÙÙˆØ±ÙŠ", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, (long_waiting or short_waiting) ? "â³" : "âœ…", text_color = (long_waiting or short_waiting) ? color.orange : color.green, text_size = size.small)
    table.cell(dashboard, 2, row, long_waiting ? "Ø´Ø±Ø§Ø¡" : short_waiting ? "Ø¨ÙŠØ¹" : "Ø¬Ø§Ù‡Ø²", text_color = color.black, text_size = size.small)
    row += 1

    // Risk Management
    table.cell(dashboard, 0, row, "ğŸ’° Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, use_fixed_rr ? "âœ…" : "âŒ", text_color = use_fixed_rr ? color.green : color.red, text_size = size.small)
    table.cell(dashboard, 2, row, use_fixed_rr ? str.tostring(risk_points) + ":" + str.tostring(reward_points) : "ÙŠØ¯ÙˆÙŠ", text_color = color.black, text_size = size.small)
    row += 1

    // Current Status
    table.cell(dashboard, 0, row, "ğŸ“Š Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø±Ø´Ø­", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, upward > 0 ? "ğŸ“ˆ" : downward > 0 ? "ğŸ“‰" : "â¡ï¸", text_color = upward > 0 ? color.green : downward > 0 ? color.red : color.gray, text_size = size.small)
    table.cell(dashboard, 2, row, upward > 0 ? "ØµØ§Ø¹Ø¯" : downward > 0 ? "Ù‡Ø§Ø¨Ø·" : "Ø¬Ø§Ù†Ø¨ÙŠ", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "ğŸ”” Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, enable_alerts ? "âœ…" : "âŒ", text_color = enable_alerts ? color.green : color.red, text_size = size.small)
    table.cell(dashboard, 2, row, enable_alerts ? "Ù†Ø´Ø·" : "Ù…Ø¹Ø·Ù„", text_color = color.black, text_size = size.small)
    row += 1

    table.cell(dashboard, 0, row, "ğŸ”¢ ØµÙÙ‚Ø§Øª Ø§Ù„ÙŠÙˆÙ…", text_color = color.black, text_size = size.small)
    table.cell(dashboard, 1, row, daily_trades < max_trades_per_day ? "âœ…" : "âš ï¸", text_color = daily_trades < max_trades_per_day ? color.green : color.orange, text_size = size.small)
    table.cell(dashboard, 2, row, str.tostring(daily_trades) + "/" + str.tostring(max_trades_per_day), text_color = color.black, text_size = size.small)