//@version=5
strategy("Doji Trading Strategy", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

ema_length = input.int(60,'EMA Length', group = 'DOJI + EMA Settings')
ema = ta.ema(close,ema_length)
plot(ema, "EMA", color.aqua)

// Doji Calculations
tolerance= input.float(defval=0.05, title="Tolerance(%) for DOJI", group = 'DOJI + EMA Settings') / 100
is_doji= (open > close and open < close*(1+tolerance)) or (open < close and open > close*(1-tolerance))
plotshape(is_doji,text='D')

// Entry Order
if is_doji and close > ema
    strategy.entry ('Long', strategy.long, comment = 'Long')

// Stop Loss Conditions
sl_length = input.int(450, "# Bars to calculate SL", group="Normal Stop Loss")
sl_price = ta.lowest (low, sl_length)
tp_pct = input.float(1,   step=0.5, title= "Trailing theshold (%)", group="Trailing Stop")
to_pct = input.float(0.5, step=0.5, title= "Trailing offset (%)",   group="Trailing Stop")
tp_ticks = tp_pct * close/100
to_ticks = to_pct * close/100

strategy.exit("Stop Exit", 'Long', stop=sl_price, trail_points=tp_ticks, trail_offset=to_ticks,comment_loss= "Stop Loss",comment_trailing = "Trail Profit")