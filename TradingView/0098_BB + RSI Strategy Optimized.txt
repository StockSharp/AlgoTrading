//+------------------------------------------------------------------+
//|      TradingView BB + RSI Strategy Optimized for Profit         |
//|      Author: Adapted by ChatGPT                                  |
//+------------------------------------------------------------------+

//@version=5
strategy("BB + RSI Strategy Optimized", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// === INPUTS === //
bbLength     = input.int(30, title="BB Period")
bbDev        = input.float(2.0, title="BB Deviation")
rsiLength    = input.int(13, title="RSI Period")
rsiBuyLevel  = input.float(30.0, title="RSI Buy Threshold")
rsiExitLevel = input.float(70.0, title="RSI Exit Threshold")
trailingTP   = input.float(5.0, title="Initial TP %")
trailingStep = input.float(1.0, title="Trailing Step %")

// === INDICATORS === //
basis = ta.sma(close, bbLength)
dev   = bbDev * ta.stdev(close, bbLength)
upper = basis + dev
lower = basis - dev
rsi = ta.rsi(close, rsiLength)

// === STRATEGY LOGIC === //
buySignal = (close < lower) and (rsi < rsiBuyLevel)
exitSignal = (rsi > rsiExitLevel)

var float entryPrice = na
var float peakPrice = na
var bool inTrade = false

if (buySignal and not inTrade)
    strategy.entry("Long", strategy.long)
    entryPrice := close
    peakPrice := close
    inTrade := true

// Update peak price while in trade
if (inTrade)
    peakPrice := math.max(peakPrice, close)

// Trailing exit: price drops by trailingStep % from peak
trailingDrop = peakPrice * (1 - trailingStep / 100)
sellCondition = inTrade and (close <= trailingDrop or exitSignal)

if (sellCondition)
    strategy.close("Long")
    entryPrice := na
    peakPrice := na
    inTrade := false

// === PLOTTING === //
plot(upper, color=color.red, title="Upper BB")
plot(lower, color=color.green, title="Lower BB")
plot(basis, color=color.blue, title="Middle BB")
plotshape(buySignal, title="Buy Signal", location=location.belowbar, color=color.lime, style=shape.triangleup)
plotshape(sellCondition, title="Sell Signal", location=location.abovebar, color=color.orange, style=shape.triangledown)