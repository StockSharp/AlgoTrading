// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© eykpunter

//@version=4
study(title="Faith Indicator", shorttitle="Faith") //Buyers or Sellers Dominance or Faith of the Market

per = input(type=input.integer , title="periods for averaging" , defval=10)
up = high>high[1] and volume>volume[1]   //Buyers volume when both higher high and more volume
down = low<low[1] and volume>volume[1]   //Sellers volume when both lower low and more volume

vproc=volume/highest(volume, 30)*200     //Used for calculation of volume expansion in a kind of percentage
volup = up ? vproc : 0                   //Entered in the series of Buyers volume
voldown = down ? vproc : 0               //Entered in the series of Sellers volume

maup = sma(volup, per)                   //Average Buyers volume, sma and 10 periods seem to work best
madown = sma(voldown, per)               //Average Sellers volume

difvol = maup - madown                     //Faith of the market, i.e. buyers dominate the volume or sellers dominate it
u1 = difvol>60 ? 8 : 0                     //Very high faith graduated as 8
u2 = difvol>40 and difvol<=60 ? 6 : 0      //High faith as 6
u3 = difvol>20 and difvol<=40 ? 4 : 0      //Good faith as 4
u4 = difvol>10 and difvol<=20 ? 2 : 0      //Some Faith as 2
u5 = difvol>0 and difvol<=10 ? 1 : 0       //Little Faith as 1
d1 = difvol<-60 ? -8 : 0                   //Very High mistrust graduated as -8
d2 = difvol<-40 and difvol >=-60 ? -6 : 0  //High Mistrust as -6
d3 = difvol<-20 and difvol >=-40 ? -4 : 0  //Bad Mistrust as -4
d4 = difvol<-10 and difvol >=-20 ? -2 : 0  //Some Mistrust as -2
d5 = difvol<0 and difvol>=-10 ? -1 : 0     //Little Mistrust as -1
dif = u1+u2+u3+u4+u5+d1+d2+d3+d4+d5        //Grades are either zero or something, adding them all up gives the grade in this instance

plot(dif , "Grade of Faith" , dif > 0 ? color.blue : color.red , style=plot.style_histogram , transp=0 , linewidth=5)

//Backgroud colors taken from Hull Moving Average Agreement Indicator (Hullag)
fhl=20                                     //number of periods for fast Hull ma
shl=25                                     //number of periods for slow Hull ma
trnd=0.1                                   //minimum ATR difference required to call the ma a trend
istrend=trnd*atr(30)                       //Calculate minimum ATR as a kind of tangent

fh=hma(close, fhl)                         //fast Hull Moving Average
fangle=fh[0]-fh[1]                         //angle of fast hull slope calculated as a kind of tangent
var ftrend= 0                              //initialise fast trend graduation
ftrend:= fangle>istrend? 1:fangle<-istrend?-1:0 //fast trend either 1, 0 or -1 meaning uptrend, no trend, down trend

sh=hma(close, shl)                         //slow Hull Moving Average
sangle=sh[0]-sh[1]                         //angle of slow hull slope as a kind of tangent
var strend=0                               // initialise slow trend graduation
strend:= sangle>istrend? 1:sangle<-istrend? -1:0 //slow trend either 1, 0 or -1 meaning uptrend, no trend, down trend

hullag= ftrend+strend                      //possible graduations are 2, 1, 0, -1, -2
bg2 = color.new(color.blue,65)             //color when both hma agree on up trend, i.e. grade 2
bg1 = color.new(color.green,75)            //color when one hma has up trend, one no trend, i.e. grade 1
bg0 = color.new(color.silver,85)           //color when either both hma have no trend or have opposite trend, i.e. grad zero
bgm1 = color.new(color.maroon,80)          //color when one hma has down trend, one no trend, i.e. grade -1
bgm2 = color.new(color.red,65)             // color when both hma agree on down trend, i.e. grade -2
bgcolor(hullag==2?bg2: hullag==1?bg1: hullag==0?bg0: hullag==-1?bgm1: bgm2)