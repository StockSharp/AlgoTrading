//@version=5
strategy("Scalping 15min: EMA + MACD + RSI + ATR-based SL/TP", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// === INPUTURI ===
emaLength      = input.int(50, title="EMA Length")
macdFast       = input.int(12, title="MACD Fast Length")
macdSlow       = input.int(26, title="MACD Slow Length")
macdSignal     = input.int(9, title="MACD Signal Smoothing")
rsiLength      = input.int(14, title="RSI Length")
rsiOB          = input.int(70, title="RSI Overbought")
rsiOS          = input.int(30, title="RSI Oversold")
atrLength      = input.int(14, title="ATR Length")
slATRmult      = input.float(1.0, title="SL Multiplier (ATR)")
tpATRmult      = input.float(2.0, title="TP Multiplier (ATR)")

// === CALCULE ===
ema = ta.ema(close, emaLength)
[macdLine, signalLine, _] = ta.macd(close, macdFast, macdSlow, macdSignal)
macdHist = macdLine - signalLine
rsi = ta.rsi(close, rsiLength)
atr = ta.atr(atrLength)

// === CONDIÈšII DE INTRARE ===
longCond  = close > ema and macdHist > 0 and rsi > 50 and rsi < rsiOB
shortCond = close < ema and macdHist < 0 and rsi < 50 and rsi > rsiOS

// === EXECUTARE TRADE ===
if (longCond)
    strategy.entry("Long", strategy.long)
if (shortCond)
    strategy.entry("Short", strategy.short)

// === TP & SL DINAMIC PRIN ATR ===
float stopLevel = na
float takeLevel = na

if (strategy.position_size > 0)
    stopLevel := close - slATRmult * atr
    takeLevel := close + tpATRmult * atr
if (strategy.position_size < 0)
    stopLevel := close + slATRmult * atr
    takeLevel := close - tpATRmult * atr

strategy.exit("Exit", from_entry="", stop=stopLevel, limit=takeLevel)

// === DESENARE ===
plot(ema, color=color.orange, title="EMA 50")
plotshape(longCond, location=location.belowbar, color=color.green, style=shape.triangleup, title="Long Signal", size=size.small)
plotshape(shortCond, location=location.abovebar, color=color.red, style=shape.triangledown, title="Short Signal", size=size.small)