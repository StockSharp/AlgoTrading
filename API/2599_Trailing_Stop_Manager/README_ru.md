# Менеджер трейлинг-стопа
[English](README.md) | [中文](README_cn.md)

Порт советника MetaTrader **Exp_TrailingStop**. Стратегия управляет трейлинг-стопами по уже открытым позициям и не генерирует сигналы на вход самостоятельно.

## Логика работы

- Подписывается на поток Level1 и отслеживает лучшие цены Bid и Ask.
- При длинной позиции и росте Ask на `TrailingStartPoints` шагов цены рассчитывается новый стоп: `Ask - StopLossPoints * PriceStep`.
- Длинный трейлинг-стоп сдвигается только когда новая цена выше предыдущей минимум на `TrailingStepPoints` шагов.
- При короткой позиции и снижении Bid на `TrailingStartPoints` шагов цены рассчитывается новый стоп: `Bid + StopLossPoints * PriceStep`.
- Короткий трейлинг-стоп подтягивается, только если он уменьшается минимум на `TrailingStepPoints` шагов по сравнению с прошлым значением.
- При пробое лучшей ценой активного трейлинг-стопа позиция закрывается рыночной заявкой, после чего внутреннее состояние сбрасывается.
- Вся логика трейлинга обнуляется при закрытии позиции или смене направления (из long в short и наоборот).

## Параметры

- `StopLossPoints` (по умолчанию **1000**) – расстояние в шагах цены между рынком и уровнем защитного стопа.
- `TrailingStartPoints` (по умолчанию **1000**) – прибыль в шагах цены, необходимая для включения трейлинга.
- `TrailingStepPoints` (по умолчанию **200**) – минимальное улучшение в шагах цены для очередного сдвига стопа.
- `PriceDeviationPoints` (по умолчанию **10**) – параметр, сохранённый для совместимости с MQL-версией. В реализации StockSharp не используется, так как проскальзывание обрабатывается иначе.

Все параметры оформлены через `StrategyParam<T>`, поэтому доступны в интерфейсе и оптимизаторе.

## Дополнительные замечания

- Требуется настроенный инструмент с положительным `PriceStep` и подписка на Level1.
- Работает на любом таймфрейме, поскольку опирается исключительно на поток котировок.
- Предназначена для совместного использования с другими стратегиями входа или для сопровождения ручных сделок.
- Хранит только актуальные уровни трейлинга, без коллекций истории, повторяя компактную логику исходного MQL-советника.
- Закрытие происходит через `SellMarket`/`BuyMarket`, поэтому в StockSharp нет необходимости отправлять отдельные запросы на модификацию ордеров с допусками.
