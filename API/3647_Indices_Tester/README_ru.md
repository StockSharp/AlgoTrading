# Стратегия Indices Tester

## Общее описание
**Indices Tester** — порт экспертного советника MetaTrader 5 с тем же названием. Стратегия ориентирована на дневную торговлю индексами и ищет одну возможность для входа в очень узком временном окне. Все решения принимаются на основе временных фильтров и операционных ограничений:

- Один настраиваемый поток свечей управляет внутренними событиями стратегии.
- Входы разрешены только между заданным временем начала и окончания сессии.
- Количество сделок в сутки ограничено, что предотвращает повторные входы.
- После наступления заданного времени закрытия все открытые позиции ликвидируются.
- Стратегия работает только в длинную сторону, полностью повторяя оригинальный алгоритм.

Реализация использует высокоуровневый API StockSharp: подписка на свечи производится через `SubscribeCandles`, а торговая логика размещена в обработчике `ProcessCandle`. Индикаторы не требуются, поэтому код остаётся компактным и сфокусированным на контроле времени и рисков.

## Логика работы
1. **Суточный сброс** — стратегия отслеживает текущую дату. При смене дня счётчики сбрасываются, позволяя снова совершить разрешённое число сделок.
2. **Окно входа** — рассматриваются только свечи, чьё время закрытия строго попадает в интервал `[SessionStart, SessionEnd)`, что соответствует проверкам `TimeStart` и `TimeEnd` в исходном советнике.
3. **Ограничения по позициям** — новая заявка не отправляется, если суточный лимит `DailyTradeLimit` уже исчерпан или количество одновременно открытых позиций превышает `MaxOpenPositions`.
4. **Размещение ордера** — при выполнении условий выставляется рыночная заявка на покупку объёмом `TradeVolume`, после чего счётчик сделок увеличивается.
5. **Принудительное закрытие** — если свеча закрылась позже `CloseTime`, а позиция всё ещё открыта, выполняется рыночная продажа, что повторяет процедуру `ClosePos()` из MQL-версии.

В стандартной конфигурации стратегия делает одну попытку входа в сутки. При необходимости параметры позволяют увеличить частоту торгов и масштабировать позицию.

## Параметры
| Название | Описание |
| --- | --- |
| `CandleType` | Основной поток свечей, задающий временную сетку (по умолчанию 1 минута). |
| `SessionStart` | Время начала окна, в течение которого допускаются новые входы. |
| `SessionEnd` | Время окончания приёма новых сделок. |
| `CloseTime` | Момент закрытия всех оставшихся позиций. |
| `DailyTradeLimit` | Максимальное число сделок в сутки, после которого входы блокируются. |
| `MaxOpenPositions` | Максимальное количество одновременно открытых длинных позиций (в единицах объёма сделки). |
| `TradeVolume` | Объём рыночной заявки на каждую новую позицию. |

## Особенности и отличия
- В StockSharp отсутствует прямой доступ к таблицам торговых сессий MetaTrader, поэтому контроль времени реализован через метки закрытия свечей и проверку `IsFormedAndOnlineAndAllowTrading()`.
- Вместо секундного таймера из MQL используется завершение свечи, что достаточно для минутных торговых окон и упрощает структуру кода.
- Счётчики сделок обнуляются при появлении первой свечи нового дня, поэтому важно, чтобы источник данных использовал правильное биржевое время.

## Рекомендации по применению
- Убедитесь, что выбранный `CandleType` соответствует торгуемому рынку, иначе временные фильтры могут не совпасть с фактической сессией.
- При необходимости увеличить количество попыток входа в течение дня повысьте значение `DailyTradeLimit`.
- Значение `MaxOpenPositions` лучше оставлять равным 1 для точного воспроизведения оригинального советника; увеличивайте его только при планируемом добавлении к позиции.
