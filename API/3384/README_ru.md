# Refresh28ChartsV3Strategy

## Обзор
Refresh28ChartsV3Strategy переносит утилиту MetaTrader 4 *Refresh28Charts v3.mq4* на высокоуровневый API StockSharp. В оригинале эксперт открывал по очереди 28 валютных пар на девяти таймфреймах и заставлял терминал подгружать заданное число свечей. Перевод использует подписки на свечи: стратегия отслеживает каждую комбинацию инструмент/таймфрейм и сообщает, когда необходимое количество завершённых свечей поступило.

## Логика исходного MQL
- Список из 28 форекс-пар и девяти таймфреймов (M1, M5, M15, M30, H1, H4, D1, W1, MN1).
- Для каждой комбинации открывается график, отключается автопрокрутка, выполняется навигация влево до тех пор, пока не будет загружено `BarsToRefresh` свечей.
- Если после множества попыток данных недостаточно, в журнал выводится предупреждение.
- Как только история подготовлена, временный график закрывается.

## Особенности реализации StockSharp
- Метод `SubscribeCandles` обеспечивает запрос истории и последующего потока без открытия графиков.
- Для каждой подписки создаётся внутреннее состояние, которое считает количество завершённых свечей и каждые 20% пути пишет прогресс в журнал.
- При достижении требуемого объёма по конкретной комбинации выводится сообщение; после обработки всех комбинаций появляется итоговое уведомление.
- Инструменты разрешаются через подключённый `SecurityProvider`. По умолчанию используется тот же набор, что и в MQL, при необходимости список задаётся параметром `Symbols`.
- Таймфреймы W1 и MN1 представлены как `TimeSpan.FromDays(7)` и `TimeSpan.FromDays(30)` ввиду того, что в StockSharp таймфреймы задаются длительностью.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `BarsToRefresh` | Минимальное число завершённых свечей, которое должно быть загружено для каждой пары инструмент/таймфрейм. Параметр допускает оптимизацию. | `50` |
| `Symbols` | Список идентификаторов инструментов, разделённых запятыми или точками с запятой. Если пусто, используется `Strategy.Security`. | `EURGBP,GBPAUD,...,EURJPY` |

## Использование
1. Подключите источник данных, поддерживающий нужные инструменты, и передайте его стратегии.
2. Оставьте `Symbols` без изменений, чтобы обновить стандартные 28 пар, или задайте собственный перечень.
3. Установите `BarsToRefresh` равным числу свечей, которое требуется иметь в кэше перед запуском торговых алгоритмов.
4. Запустите стратегию и следите за логом: в нём отображаются промежуточные и финальные сообщения о готовности данных.

## Дополнительные замечания
- Стратегия не создаёт заявок и предназначена исключительно для подготовки исторических данных.
- Если источник данных выдаёт историю постепенно, подписка остаётся активной и журнал продолжает фиксировать прогресс.
- Решение удобно включать в сценарии инициализации торговой инфраструктуры, чтобы подготовить кеш перед запуском основных стратегий.
