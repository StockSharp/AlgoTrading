# Refresh28ChartsV3Strategy

## 概述
Refresh28ChartsV3Strategy 将 MetaTrader 4 工具 *Refresh28Charts v3.mq4* 迁移到 StockSharp 高级策略 API。原始脚本通过依次打开 28 个主要货币对的多个时间框图，强制平台提前缓存指定数量的历史数据。移植版本改为直接订阅蜡烛数据，在每个品种/周期组合累积到足够数量的收盘蜡烛后给出提示。

## 原始 MQL 逻辑
- 列出 28 个主要外汇货币对和 9 个时间框（M1、M5、M15、M30、H1、H4、D1、W1、MN1）。
- 为每个组合打开图表，关闭自动滚动，反复向历史左移直到 `BarsToRefresh` 根蜡烛可用。
- 如果多次尝试后仍不足指定数量，则写入警告日志。
- 一旦数据准备完成便关闭临时图表。

## StockSharp 实现
- 使用 `SubscribeCandles` 请求历史和实时蜡烛，而无需创建图表窗口。
- 通过内部状态对象跟踪每个订阅，统计已完成的蜡烛数量，并按照 20% 的进度间隔写入日志。
- 当某个组合达到目标数量时记录完成信息，并在全部组合满足条件时发布汇总消息。
- 通过已连接的 `SecurityProvider` 解析标的代码。默认列表与 MQL 版本一致，也可以在 `Symbols` 参数中自定义。
- 由于 StockSharp 以 `TimeSpan` 表示时间框，周线和月线分别使用 `TimeSpan.FromDays(7)` 与 `TimeSpan.FromDays(30)` 近似表示。

## 参数
| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `BarsToRefresh` | 为每个标的/时间框组合缓存的最小收盘蜡烛数，可优化的正整数。 | `50` |
| `Symbols` | 需要刷新的证券标识，支持用逗号或分号分隔；为空时使用 `Strategy.Security`。 | `EURGBP,GBPAUD,...,EURJPY` |

## 使用步骤
1. 连接能提供目标品种的行情源，并将其绑定到策略。
2. 保持 `Symbols` 参数不变即可刷新默认的 28 个货币对，或者填写自定义的符号列表。
3. 根据需求设置 `BarsToRefresh`，确定每个组合需要加载的历史数量。
4. 启动策略，观察日志输出以获取进度和全部完成的提示。

## 注意事项
- 策略不会下单，仅用于在启动其他策略前刷新历史缓存。
- 如果行情源无法立即返回全部历史，订阅会持续保持并在新蜡烛到来时继续汇报进度。
- 可将该策略集成到自动化启动脚本中，在交易策略运行前完成数据预热。
