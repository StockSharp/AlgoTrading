# Стратегия Close All MT5

**Close All MT5** — это адаптация утилиты MQL, которая закрывает позиции при достижении
заданной плавающей прибыли. Стратегия постоянно отслеживает портфель, вычисляет прибыль
в деньгах, пунктах или пипсах и закрывает длинные либо короткие позиции, как только
пороговое значение превышено. Дополнительный ручной триггер имитирует кнопку на графике
оригинального советника и позволяет мгновенно закрыть выбранные сделки и удалить
ожидающие ордера.

## Как работает

* Подписывается на тиковые данные для всех инструментов с открытыми позициями.
* Сохраняет последнюю цену сделки и сравнивает её со средней ценой входа каждой позиции.
* Оценивает плавающую прибыль в выбранной метрике: деньги, пункты или пипсы.
* При достижении порога отправляет рыночные заявки для закрытия соответствующих позиций.
* Предоставляет ручной триггер, позволяющий закрыть позиции по требованию в одном из
  режимов (все, только покупки, только продажи, по инструменту и т. д.).

## Параметры

| Имя | Описание |
| --- | -------- |
| `Position Filter` | Определяет, участвуют ли в автоматических проверках длинные позиции, короткие или оба типа. |
| `Profit Mode` | Единица измерения плавающей прибыли (`Money`, `Points`, `Pips`). |
| `Profit Threshold` | Целевая прибыль (положительное значение) или убыток (отрицательное значение), при котором позиции закрываются. |
| `Close Mode` | Поведение ручного закрытия, повторяющее кнопку из MQL-версии. |
| `Comment Filter` | Необязательная подстрока, которая должна содержаться в идентификаторе стратегии перед обработкой позиции. |
| `Currency Filter` | Символ, используемый в режиме `CloseCurrency`. Если оставить пустым, применяется текущий инструмент стратегии. |
| `Magic Number` | Идентификатор стратегии для режима `CloseMagic` (аналог magic number). |
| `Ticket Number` | Идентификатор позиции, обрабатываемый в режиме `CloseTicket`. |
| `Max Slippage` | Максимально допустимое проскальзывание в шагах цены. Зарезервировано для будущего использования. |
| `Trigger Close` | Установите в `true`, чтобы выполнить ручное закрытие; после выполнения значение автоматически сбрасывается. |

## Примечания

* Для вычисления прибыли используется значение из портфеля, а при его отсутствии —
  расчёт по шагу цены.
* `Comment Filter` и `Magic Number` сопоставляются с идентификатором стратегии,
  что соответствует проверкам комментария и magic number в исходном советнике.
* В режиме `CloseAllAndPending` после закрытия позиций отменяются активные ордера,
  чьи комментарии содержат указанную подстроку.
