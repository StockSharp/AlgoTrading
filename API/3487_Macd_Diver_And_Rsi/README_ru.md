# Стратегия MACD Diver and RSI

## Общее описание

Стратегия является портом MetaTrader 5 советника **«Macd diver and rsi»** на платформу StockSharp. Сохранена исходная двухэтапная логика сигналов: RSI определяет области перекупленности или перепроданности, а гистограмма MACD подтверждает разворот импульса. Длинные и короткие сигналы настраиваются раздельно, что позволяет тонко адаптировать поведение под направление тренда.

Работа ведётся по одному потоку свечей (таймфрейм задаётся параметром). Сделки открываются рыночными заявками по инструменту стратегии. Обработка индикаторов выполнена через высокоуровневый API `BindEx` в соответствии с требованиями репозитория.

## Логика торговли

1. **Подготовка индикаторов**
   - Создаются два экземпляра RSI — для длинных и коротких сценариев с собственными периодами и порогами.
   - Создаются два индикатора `MovingAverageConvergenceDivergenceSignal`, повторяющие настройки MACD для лонгов и шортов. Для подтверждения используется компонент гистограммы.
2. **Условия входа**
   - **Лонг**: если значение «длинного» RSI меньше либо равно порогу перепроданности и гистограмма MACD переходит из отрицательной зоны в положительную, открывается покупка. При наличии короткой позиции она закрывается и разворот выполняется той же заявкой.
   - **Шорт**: если значение «короткого» RSI больше либо равно порогу перекупленности и гистограмма MACD переходит из положительной зоны в отрицательную, открывается продажа. Активный лонг сначала закрывается.
3. **Управление риском**
   - После входа запоминается цена закрытия сигнальной свечи.
   - Уровни стоп-лосса и тейк-профита рассчитываются от этой цены по заданным значениям в пунктах для каждого направления.
   - Пересчёт пунктов выполняется через `PriceStep` инструмента; для инструментов с 3 или 5 знаками после запятой шаг умножается на 10, что соответствует привычной для MT5 трактовке «пункта».
   - На каждой завершённой свече проверяется, достигнут ли стоп или тейк. При пробое позиция закрывается рыночной заявкой.
4. **Сопровождение позиции**
   - Состояние позиции очищается, когда объём становится нулевым (по стопу/тейку или при развороте).
   - Дополнительное сопровождение (частичные фиксации, трейлинг) не используется — только фиксированные уровни.

## Параметры

- `CandleType` — таймфрейм свечей, по которым строятся сигналы.
- `LongRsiPeriod` / `ShortRsiPeriod` — периоды RSI для длинных и коротких сценариев.
- `LongRsiThreshold` / `ShortRsiThreshold` — пороги RSI, разрешающие вход (перепроданность для лонга, перекупленность для шорта).
- `LongMacdFastLength`, `LongMacdSlowLength`, `LongMacdSignalLength` — периоды EMA в MACD для длинной стороны.
- `ShortMacdFastLength`, `ShortMacdSlowLength`, `ShortMacdSignalLength` — параметры MACD для короткой стороны.
- `LongVolume`, `ShortVolume` — объём сделки. При развороте к объёму добавляется абсолютная величина текущей позиции, чтобы одной заявкой закрыть старую и открыть новую.
- `LongStopLossPips`, `LongTakeProfitPips`, `ShortStopLossPips`, `ShortTakeProfitPips` — расстояния до стоп-лосса и тейк-профита в пунктах (0 отключает уровень).

## Дополнительные замечания

- Для корректной работы нужен ненулевой `PriceStep`. При отсутствии шага используется запасное значение 0.0001, чтобы избежать деления на ноль.
- Раздельные индикаторы для лонга и шорта позволяют использовать асимметричную фильтрацию — например, ужесточить условия для шорта и оставить лонг более чувствительным.
- В код добавлены комментарии на английском языке, разъясняющие этапы работы стратегии и соответствующие требованиям проекта.
