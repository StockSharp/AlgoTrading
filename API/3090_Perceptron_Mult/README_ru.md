# Стратегия Perceptron Mult

Стратегия является портом советника **Peceptron_Mult.mq5** на высокоуровневый API StockSharp. Она одновременно отслеживает до трёх инструментов и использует осциллятор Acceleration/Deceleration (AC) в перцептроне с четырьмя входами. Для каждого инструмента задаются собственные веса, объём позиций и уровни защиты, благодаря чему логика многосимвольного советника сохраняется без изменений.

## Логика работы

1. Для каждого выбранного инструмента создаётся подписка на одинаковый тип свечей (по умолчанию — минутные).
2. После закрытия свечи вычисляется осциллятор Acceleration/Deceleration:
   - Сначала считается Awesome Oscillator (AO) по максимумам и минимумам свечи (скользящие средние 5 и 34).
   - Затем от значения AO отнимается 5-периодная простая скользящая средняя AO.
3. Для каждого инструмента поддерживается кольцевой буфер из 22 последних значений AC.
4. Перцептрон формирует сигнал из четырёх отложенных значений AC (`0`, `7`, `14`, `21`), умножая их на веса `w - 100`, как в оригинале на MQL.
5. Правила входа:
   - Сумма больше нуля ⇒ открывается длинная позиция, если по инструменту нет позиции.
   - Сумма меньше нуля ⇒ открывается короткая позиция при отсутствии открытой позиции.
6. Правила выхода:
   - Стоп-лосс и тейк-профит задаются в пунктах и пересчитываются в абсолютное смещение цены с учётом шага цены инструмента.
   - На каждой завершённой свече проверяется, достигла ли цена уровней защиты. Для лонга свеча закрывает позицию, если минимум опустился ниже стопа или максимум превысил тейк; для шорта условия зеркальные.
7. По каждому инструменту может быть только одна позиция. Пока позиция активна, новые сигналы игнорируются, что полностью повторяет поведение MQL-советника.

## Параметры

| Параметр | Описание |
| --- | --- |
| `FirstSecurity`, `SecondSecurity`, `ThirdSecurity` | Инструменты для расчёта. Параметр можно оставить пустым, чтобы отключить слот. |
| `FirstOrderVolume`, `SecondOrderVolume`, `ThirdOrderVolume` | Объём рыночной заявки для соответствующего инструмента. |
| `FirstWeight1`…`FirstWeight4` и аналоги | Веса перцептрона (параметры `x1…x12` в MQL). Внутри стратегии из каждого веса вычитается 100 перед умножением. |
| `FirstStopLossPoints`, `SecondStopLossPoints`, `ThirdStopLossPoints` | Дистанция стоп-лосса в пунктах. Ноль — отключение. |
| `FirstTakeProfitPoints`, `SecondTakeProfitPoints`, `ThirdTakeProfitPoints` | Дистанция тейк-профита в пунктах. Ноль — отключение. |
| `CandleType` | Общий тип свечей для всех инструментов. |

## Особенности реализации

- Используются штатные индикаторы StockSharp `AwesomeOscillator` и `SimpleMovingAverage`, которые полностью воспроизводят расчёт AC без ручных формул.
- Буфер из 22 элементов хранится только ради имитации выборок `[0, 7, 14, 21]`, присутствующих в исходном советнике.
- Уровни защиты не выставляются отдельными заявками: стратегия контролирует экстремумы свечей и закрывает позиции рыночными ордерами при достижении стопа или цели, что аналогично срабатыванию стопов в MT5 на новом тике.
- Для каждого инструмента поддерживаются независимые индикаторы, параметры объёма и риск-менеджмента, что соответствует трём символам в оригинальном коде.

## Рекомендации по использованию

1. Укажите до трёх инструментов. Любой слот можно оставить пустым (`null`).
2. Подберите значения стопов и тейков в пунктах так, чтобы они соответствовали шагу цены выбранных инструментов.
3. При необходимости оптимизации изменяйте веса перцептрона — они определяют вклад лагов AC в итоговый сигнал.
4. Так как все инструменты используют один и тот же тип свечей, убедитесь, что исторические данные доступны для каждого из них.
