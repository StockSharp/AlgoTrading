# FXF Safe Trend Scalp V1 (C#)

Стратегия FXF Safe Trend Scalp V1 воспроизводит оригинального советника MetaTrader 4 и торгует от динамических линий тренда, построенных по крайним точкам ZigZag. Когда цена вплотную подходит к сопротивлению или поддержке и направление подтверждается парой скользящих средних, на следующей завершенной свече открывается позиция. Сразу после входа выставляются стоп‑лосс, тейк‑профит и контроль общей плавающей прибыли, как и в исходном коде.

## Логика торговли

1. **Трендовые линии ZigZag**
   - Ручной детектор ZigZag с параметрами глубины, отклонения и шага назад ищет чередующиеся экстремумы.
   - Последние четыре максимума формируют текущую линию сопротивления, последние четыре минимума — линию поддержки. Линии экстраполируются в текущую свечу.
   - Сигнал фиксируется, когда цена оказывается ближе заданного отступа (по умолчанию 10 пунктов) от соответствующей линии.
2. **Фильтр скользящих средних**
   - Быстрая SMA с периодом 2 и медленная SMA с периодом 50 задают направление сделок.
   - Для продаж требуется, чтобы быстрая SMA была ниже медленной, для покупок — выше.
3. **Исполнение ордеров**
   - Сигналы активируются на следующей завершенной свече, что соответствует функции `isNewBar()` из MQL.
   - Перед входом проверяется отсутствие открытых позиций и соответствие текущего спрэда допустимому максимуму.
4. **Управление рисками**
   - Стоп‑лосс и тейк‑профит задаются в пунктах и устанавливаются сразу после сделки.
   - Позиция закрывается, если плавающая прибыль (разница цены × объем) превышает настроенное значение на один лот.

## Параметры

| Название | Описание |
| --- | --- |
| `Candle Type` | Таймфрейм, используемый для расчетов. |
| `Volume` | Объем каждой сделки. |
| `ZigZag Depth` | Минимальное число свечей между экстремумами. |
| `ZigZag Deviation (pts)` | Минимальное изменение цены (в пунктах) перед сменой направления. |
| `ZigZag Backstep` | Число свечей, которые нужно подождать перед противоположным экстремумом. |
| `Trend Offset (pts)` | Допустимое расстояние до трендовой линии для формирования сигнала. |
| `Fast MA Length` | Период быстрой SMA. |
| `Slow MA Length` | Период медленной SMA. |
| `Max Spread (pts)` | Максимально разрешенный спрэд в пунктах. |
| `Stop Loss (pts)` | Размер стоп‑лосса от цены входа. |
| `Take Profit (pts)` | Размер тейк‑профита от цены входа. |
| `Profit Target per Lot` | Требуемая плавающая прибыль на один лот для досрочного закрытия. |

## Особенности

- Открывается не более одной позиции одновременно; новые сигналы игнорируются, пока позиция не закрыта.
- Для работы фильтра по спрэду необходимы котировки уровня Level 1 (лучшая цена Bid/Ask).
- По заданию Python-версия не создается, папка `PY` отсутствует.

## Файлы

- `CS/FXFSafeTrendScalpV1Strategy.cs` — реализация стратегии на StockSharp.

