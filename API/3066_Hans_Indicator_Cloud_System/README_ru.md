# Стратегия Hans Indicator Cloud System

## Обзор
Стратегия является портом советника MQL5 `Exp_Hans_Indicator_Cloud_System` на высокоуровневый API StockSharp. Она восстанавливает
индикаторные «облака» Hans, которые делят торговый день на две сессии и отслеживают пробои выше или ниже сформированных диапазонов.
Обработка ведётся по настраиваемым свечам (по умолчанию M30), анализируются только закрытые свечи, а сигналы исполняются на
следующем баре после смены цвета, полностью повторяя задержку оригинального кода.

## Воссоздание индикатора Hans
Индикатор сдвигает временные метки из часового пояса брокера (`LocalTimeZone`) в целевой часовой пояс (`DestinationTimeZone`).
Порт StockSharp применяет тот же сдвиг, а затем разбивает сутки на две сессии:

1. **Сессия 1 (04:00–08:00 целевого времени)** – фиксируются максимумы и минимумы всех свечей внутри интервала. После завершения
   окна диапазон считается сформированным.
2. **Сессия 2 (08:00–12:00 целевого времени)** – аналогичный процесс для второй сессии. После её окончания диапазон второй
   сессии заменяет первый до конца дня.

К верхней и нижней границе активного диапазона добавляется буфер `PipsForEntry`, измеряемый в шагах цены. Цвета индикатора
воспроизводятся следующим образом:

- `0` – закрытие выше верхней границы, свеча бычья.
- `1` – закрытие выше верхней границы, свеча медвежья.
- `3` – закрытие ниже нижней границы, свеча бычья.
- `4` – закрытие ниже нижней границы, свеча медвежья.
- `2` – пробоя нет (нейтральное состояние).

Полученные значения сохраняются, что имитирует обращения `CopyBuffer` из оригинального советника.

## Торговая логика
- Ведётся скользящая история цветовых кодов. Анализируются `SignalBar` баров назад (по умолчанию 1) плюс ещё один бар, что
  соответствует вызову `CopyBuffer(..., SignalBar, 2, ...)` в MQL5.
- **Открыть long**: более старый бар (`SignalBar + 1`) имеет цвет `0` или `1`, а ближайший бар (`SignalBar`) уже не имеет этого
  цвета. Перед покупкой закрываются все короткие позиции.
- **Открыть short**: более старый бар имеет цвет `3` или `4`, а ближайший бар уже не равен `3`/`4`. Перед продажей закрываются все
  длинные позиции.
- **Закрыть long**: если более старый бар окрашен в `3` или `4`, а закрытие длинных включено.
- **Закрыть short**: если более старый бар окрашен в `0` или `1`, а закрытие коротких включено.

Выходы обрабатываются раньше входов, как и в функциях `TradeAlgorithms.mqh`, поэтому противоположные позиции закрываются до подачи
новых заявок.

## Параметры
- **Тип свечей** (`CandleType`) – таймфрейм обрабатываемых свечей.
- **Сигнальный бар** (`SignalBar`) – количество закрытых свечей назад для оценки смены цвета.
- **Часовой пояс брокера** (`LocalTimeZone`) – смещение сервера в часах.
- **Целевой часовой пояс** (`DestinationTimeZone`) – смещение, задающее границы сессий.
- **Буфер пробоя** (`PipsForEntry`) – число шагов цены, добавляемых к верхней/нижней границе диапазона.
- **Включить открытия/закрытия long** (`BuyPosOpen`, `BuyPosClose`) – переключатели управления длинными позициями.
- **Включить открытия/закрытия short** (`SellPosOpen`, `SellPosClose`) – переключатели управления короткими позициями.
- **Объём сделки** (`TradeVolume`) – размер ордера для каждой новой позиции, дополнительно синхронизируется со `Strategy.Volume` при запуске.

## Примечания
- Python-версия намеренно не создавалась согласно запросу.
- Функции манименеджмента из `TradeAlgorithms.mqh` (режимы маржи, динамический объём, стоп-лоссы/тейк-профиты) заменены на фиксированный
  объём и явные правила выхода.
- Если инструмент не предоставляет `PriceStep`, буфер пробоя трактуется как абсолютное изменение цены – это лучшая возможная аппроксимация
  без информации о минимальном шаге.
