# Hans Indicator Cloud System 策略

## 概述
该策略将 MQL5 智能交易系统 `Exp_Hans_Indicator_Cloud_System` 迁移到 StockSharp 的高级 API。它重新构建 Hans 指标的
“云区”范围，把交易日划分为两个参考时段，并在价格向上或向下突破时段区间时执行交易。策略订阅可配置的 K 线
（默认 M30），只处理收盘 K 线，并在颜色发生变化后的下一根 K 线上下单，以保持与原始脚本相同的延迟逻辑。

## Hans 指标的复现方式
原指标会把时间从经纪商时区 (`LocalTimeZone`) 转换到目标时区 (`DestinationTimeZone`)。移植版本使用相同的偏移，
然后将每天拆分为两个时段：

1. **时段 1（目标时间 04:00–08:00）** – 统计该区间内所有 K 线的最高价和最低价，区间结束后得到第一组范围。
2. **时段 2（目标时间 08:00–12:00）** – 对第二个区间重复上述过程。该时段完成后，其高低点将在当日余下时间内
   取代第一时段的范围。

在活动范围的高点和低点上分别加上以价格步长计量的缓冲 `PipsForEntry`。指标颜色映射如下：

- `0` – 收盘价突破上沿且 K 线实体为阳线。
- `1` – 收盘价突破上沿且 K 线实体为阴线。
- `3` – 收盘价跌破下沿且 K 线实体为阳线。
- `4` – 收盘价跌破下沿且 K 线实体为阴线。
- `2` – 未发生突破（中性状态）。

这些颜色值被保存下来，以模拟原策略中对 `CopyBuffer` 的访问。

## 交易逻辑
- 策略维护一个颜色历史序列，回看 `SignalBar` 根（默认 1）以及再往前的一根 K 线，对应 MQL5 中的
  `CopyBuffer(..., SignalBar, 2, ...)` 调用。
- **开多头**：更早的那根 K 线（`SignalBar + 1`）颜色为 `0` 或 `1`，而最近的 K 线（`SignalBar`）已经不是 `0`/`1`。
  在建仓前会平掉所有空头仓位，并以 `TradeVolume` 的固定数量买入。
- **开空头**：更早的 K 线颜色为 `3` 或 `4`，最近的 K 线不再是 `3`/`4`。在做空之前会平掉所有多头仓位。
- **平多头**：当更早的 K 线颜色为 `3` 或 `4` 且允许平多时触发。
- **平空头**：当更早的 K 线颜色为 `0` 或 `1` 且允许平空时触发。

平仓逻辑优先于开仓逻辑，与 `TradeAlgorithms.mqh` 中的辅助函数一致，确保在发送新委托前关闭对向仓位。

## 参数
- **K 线类型** (`CandleType`)：用于计算的时间框架。
- **信号 K 线** (`SignalBar`)：回看多少根已收盘 K 线来判断颜色变化。
- **本地时区** (`LocalTimeZone`)：经纪商/服务器的小时偏移。
- **目标时区** (`DestinationTimeZone`)：定义两个交易时段的小时偏移。
- **突破缓冲** (`PipsForEntry`)：在区间上下沿额外添加的价格步数。
- **允许多头开/平仓** (`BuyPosOpen`, `BuyPosClose`)：管理多头仓位的开仓与离场开关。
- **允许空头开/平仓** (`SellPosOpen`, `SellPosClose`)：管理空头仓位的开仓与离场开关。
- **交易量** (`TradeVolume`)：每次新仓位使用的下单数量，并在启动时同步到 `Strategy.Volume`。

## 说明
- 根据要求未提供 Python 版本。
- `TradeAlgorithms.mqh` 中的资金管理功能（保证金模式、动态手数、止损/止盈）被简化为固定下单量和显式退出规则。
- 如果标的没有提供 `PriceStep`，突破缓冲将按绝对价格理解，这是在缺少最小跳动信息时最合理的近似处理。
