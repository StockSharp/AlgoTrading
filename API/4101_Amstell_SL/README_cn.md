# Amstell SL 平均策略
[English](README.md) | [Русский](README_ru.md)

基于 MetaTrader 顾问 `exp_Amstell-SL` 的移植版本。策略启动后立即同时开出一笔买单和卖单，当价格相对于最近一次进场逆向移动到达设定的点数时继续加仓，并通过程序化的虚拟止盈与止损来逐笔平仓。

## 策略逻辑

- **初始建仓**：启动时若没有持仓，立即以市价在卖价（Ask）买入一单，同时在买价（Bid）卖出一单。
- **逆势加仓**：
  - 多头方向：当当前卖价比最后一次买入价低 `ReentryPoints`（默认 10 点）时，再买入同样手数。
  - 空头方向：当当前买价比最后一次卖出价高 `ReentryPoints` 时，再卖出同样手数。
- **退出规则（虚拟管理）**：
  - 对每笔买入单同时监控最优买价与卖价。当买价较开仓价上升 `TakeProfitPoints` 点，或卖价较开仓价下降 `StopLossPoints` 点时，通过市价卖出平仓。
  - 对每笔卖出单，当卖价比开仓价低 `TakeProfitPoints` 点，或买价比开仓价高 `StopLossPoints` 点时，通过市价买入回补。
- **处理顺序**：优先检查平仓条件，只要有订单被关闭，本次数据处理即结束，不再考虑新的入场，完全复制原始 EA 在每个 tick 上的行为。

## 参数

- `TakeProfitPoints` – 止盈距离（以价格最小变动单位计）。默认值：`30`。
- `StopLossPoints` – 止损距离（价格最小变动单位）。默认值：`30`。
- `Volume` – 每次开仓的手数。默认值：`0.01`。
- `ReentryPoints` – 逆势加仓所需的点数距离。默认值：`10`。

## 额外说明

- 点值来自 `Security.PriceStep`；如果交易所未提供，则使用 `1` 作为最小价位变动。
- 策略独立跟踪多头与空头仓位，因此可以同时持有多单与空单，符合原始顾问的对冲模式。
- 止盈与止损并不会在交易所挂出真实委托，而是通过市价单虚拟执行。
- 若市场单边趋势延续，仓位会持续加码，风险暴露增长迅速，应谨慎控制最大仓位与资金使用。
- 更适合用于点值等于最小价格跳动的品种，例如多数基于 MetaTrader 报价的外汇品种。
