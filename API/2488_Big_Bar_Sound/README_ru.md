# Стратегия Big Bar Sound

## Общее описание
**Big Bar Sound Strategy** воспроизводит работу экспертного советника MetaTrader «BigBarSound». Стратегия отслеживает завершённые свечи выбранного таймфрейма и сообщает, когда диапазон свечи становится достаточно большим. Вместо воспроизведения WAV-файла стратегия записывает подробные сообщения в журнал, откуда их можно направить в любую систему уведомлений StockSharp.

Стратегия носит исключительно информационный характер – она не выставляет заявки и не управляет позицией. Её удобно использовать как вспомогательный модуль оповещений в составе автоматических или ручных торговых схем.

## Логика работы
1. Стратегия подписывается на поток свечей, указанный в параметре **Candle Type**.
2. Для каждой закрывшейся свечи рассчитывается её размер в соответствии с параметром **Difference Mode**:
   - **OpenClose** – абсолютная разница между ценами закрытия и открытия.
   - **HighLow** – абсолютный диапазон между максимумом и минимумом свечи.
3. Полученное значение сравнивается с порогом, вычисленным как произведение **Point Threshold** и шага цены инструмента (`PriceStep`). Если размер свечи больше или равен порогу, стратегия записывает в лог сообщение о «проигрывании» выбранного звукового файла.
4. При включённом флаге **Show Alert** дополнительно записывается отдельное уведомление, имитирующее всплывающее окно `Alert` из оригинала.

Обработка только завершённых свечей гарантирует, что каждая свеча вызовет оповещение не более одного раза, как и в изначальном MQL-скрипте с одноразовым триггером.

## Параметры
- **Point Threshold (`BarPoint`)** – минимальное количество шагов цены, необходимое для срабатывания сигнала. Значение по умолчанию 200 соответствует исходному советнику. Для удобства задан диапазон оптимизации 50–500 с шагом 50.
- **Difference Mode (`DifferenceMode`)** – способ измерения размера свечи: по разнице цены открытия/закрытия или по диапазону high/low.
- **Sound File (`SoundFile`)** – имя WAV-файла, который должен проигрываться. В портированной версии значение выводится только в лог, чтобы сохранить кроссплатформенность.
- **Show Alert (`ShowAlert`)** – при активации в лог добавляется дополнительное сообщение-напоминание.
- **Candle Type (`CandleType`)** – тип (таймфрейм) свечей, на которые оформляется подписка. По умолчанию используются минутные свечи.

## Уведомления и журналирование
Для основного сообщения используется `LogInfo`, а для дополнительного предупреждения – `AddInfoLog`. Логи содержат идентификатор инструмента, время свечи и фактический размер диапазона, что упрощает интеграцию с просмоторщиком логов StockSharp или внешними системами уведомлений.

Если подключённый источник данных не передаёт корректный `PriceStep`, стратегия применяет резервное значение `1`. В этом случае скорректируйте **Point Threshold** так, чтобы он соответствовал реальному минимальному изменению цены.

## Рекомендации по применению
- Подключайте стратегию к любому инструменту, для которого доступен поток свечей: валютные пары, фьючерсы, акции или криптовалюты.
- Используйте логи стратегии в комплексных торговых решениях или расширяйте класс, чтобы передавать события в собственные обработчики.
- Так как стратегия не совершает сделок, параметры объёма и управления позицией не используются.
- Для воспроизведения реального звука подключите к логам StockSharp аудио-уведомитель или добавьте в код обращение к аудио-API операционной системы.

## Отличия от оригинального советника MQL
- В оригинале отслеживались тики и самостоятельно определялся момент начала новой свечи. В StockSharp-версии анализируются уже завершённые свечи, поэтому дополнительный флаг одноразового срабатывания не требуется.
- Проигрывание звука заменено логами, что делает поведение одинаковым на любых платформах.
- Названия параметров приведены к стилю StockSharp, но полностью сохраняют смысл оригинала: порог в пунктах, режим расчёта, опциональное уведомление и название звукового файла.

## Требования
Дополнительные индикаторы не нужны. Главное – убедиться, что выбранный `CandleType` поддерживается подключённым источником данных и стратегия получает завершённые свечи для анализа.
