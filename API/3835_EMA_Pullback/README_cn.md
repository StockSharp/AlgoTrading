# EMA回调策略

## 概述
EMA回调策略是MetaTrader "Ema" 专家顾问的高层移植版本。策略在设定的K线周期（默认5分钟）上计算5周期与10周期的指数移动平均线（EMA），使用中价 `(最高价 + 最低价) / 2` 作为输入。当出现快慢EMA金叉或死叉后，策略等待价格回撤到前一根K线的极值附近再入场，并在持仓后应用固定的止盈和止损距离。

## 交易逻辑
1. 订阅配置的K线数据并基于中价更新两条EMA。
2. 当快线从下向上穿越慢线时记录看多信号；当快线从上向下穿越慢线时记录看空信号。
3. 交叉出现后进入等待模式：
   - 多头：要求快EMA至少领先慢EMA两个价格点，同时收盘价回撤到上一根K线最高价减去 `MoveBackPoints` 转换后的距离。
   - 空头：要求慢EMA至少领先快EMA两个价格点，同时收盘价回调到上一根K线最低价加上 `MoveBackPoints` 转换后的距离。
4. 条件满足时按照 `TradeVolume` 发送市价单建立仓位。
5. 建仓后根据 `TakeProfitPoints` 与 `StopLossPoints` 将点数距离转换成绝对价格，设置静态止盈和止损水平。
6. 每根完整K线检查一次，若最高价或最低价触及止盈/止损水平则立即平仓。

## 参数
| 参数 | 默认值 | 说明 |
|------|--------|------|
| `TradeVolume` | `0.1` | 每次下单使用的交易量。|
| `FastLength` | `5` | 快速EMA的周期。|
| `SlowLength` | `10` | 慢速EMA的周期。|
| `MoveBackPoints` | `3` | 入场所需的回撤距离（价格点），相对上一根K线的极值计算。|
| `TakeProfitPoints` | `5` | 止盈距离（价格点）。|
| `StopLossPoints` | `20` | 止损距离（价格点）。|
| `CandleType` | `5m` | 指标与信号使用的K线周期。|

## 说明
- 仅处理 `Finished` 状态的K线，避免尚未收盘的数据导致假信号。
- 启动时自动将策略的 `Volume` 属性同步到 `TradeVolume` 参数。
- 点值转换依赖标的物的 `PriceStep`，请确保交易品种设置正确。
- 策略同一时间只保持一个净头寸，平仓后需要新的EMA交叉信号才能再次触发。
