# Стратегия EMA Pullback

## Обзор
EMA Pullback — порт оригинального MetaTrader-советника «Ema». Стратегия анализирует экспоненциальные скользящие средние (EMA) с периодами 5 и 10, рассчитанные по медианной цене свечи. После появления бычьего или медвежьего пересечения она ожидает возврата цены к экстремуму предыдущей свечи и входит по рынку в сторону сигнала. Управление риском реализовано с помощью фиксированных уровней тейк-профита и стоп-лосса в пунктах.

## Логика торговли
1. Подписаться на выбранный тип свечей (по умолчанию 5-минутные) и обновлять две EMA по медианной цене `(High + Low) / 2`.
2. Зафиксировать бычий сигнал при пересечении fast EMA выше slow EMA и медвежий сигнал при обратном пересечении.
3. После пересечения ожидать отката:
   - Для покупок цена должна откатить к максимуму предыдущей свечи минус расстояние `MoveBackPoints`, при этом fast EMA должна быть выше slow EMA минимум на два пункта.
   - Для продаж цена должна вернуться к минимуму предыдущей свечи плюс `MoveBackPoints`, при условии что slow EMA выше fast EMA минимум на два пункта.
4. При выполнении условий отправить рыночную заявку объёмом `TradeVolume`.
5. После входа вычислить уровни тейк-профита и стоп-лосса, умножив параметры `TakeProfitPoints` и `StopLossPoints` на минимальный шаг цены.
6. На каждой завершённой свече проверять достижение тейк-профита или стоп-лосса по значениям High/Low и закрывать позицию при срабатывании.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|------------------------|----------|
| `TradeVolume` | `0.1` | Объём каждой рыночной заявки. |
| `FastLength` | `5` | Период быстрой EMA по медианной цене. |
| `SlowLength` | `10` | Период медленной EMA по медианной цене. |
| `MoveBackPoints` | `3` | Требуемая глубина отката в пунктах относительно экстремума предыдущей свечи. |
| `TakeProfitPoints` | `5` | Расстояние до тейк-профита в пунктах. |
| `StopLossPoints` | `20` | Расстояние до стоп-лосса в пунктах. |
| `CandleType` | `5m` | Таймфрейм свечей для расчётов. |

## Дополнительные замечания
- Обрабатываются только завершённые свечи (`CandleStates.Finished`).
- При старте `Strategy.Volume` синхронизируется с параметром `TradeVolume`.
- Для пересчёта пунктов в абсолютные цены используется `PriceStep` инструмента. Убедитесь, что спецификация актива задана корректно.
- Стратегия держит не более одной позиции. Для новой сделки требуется очередное пересечение EMA.
