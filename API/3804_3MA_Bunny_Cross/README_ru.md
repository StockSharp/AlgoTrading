# Стратегия 3MA Bunny Cross

## Обзор
**ThreeMaBunnyCrossStrategy** — это конвертация советника MetaTrader 4 «3MA Bunny Cross». Стратегия торгует развороты тренда по пересечению двух линейно-взвешенных скользящих средних (LWMA), рассчитанных по ценам закрытия выбранного таймфрейма. Версия для StockSharp сохраняет исходную идею моментального реверса позиции при пересечении и дополняет её удобствами высокоуровневого API: привязкой индикаторов и встроенной защитой позиции.

## Описание оригинального MQL-советника
Исходный советник использует две LWMA с периодами 5 и 20. Когда быстрая средняя пересекает медленную, советник закрывает противоположную позицию (если она есть) и сразу открывает новую сделку в сторону пересечения. В любой момент времени допускается только одна позиция. В коде также есть проверки на минимальное количество баров и достаточное свободное обеспечение перед входом в сделку.

## Особенности реализации в StockSharp
- Стратегия подписывается на свечи, задаваемые параметром `CandleType` (по умолчанию 15-минутный интервал), и привязывает к ним два индикатора `LinearWeightedMovingAverage`.
- Значения индикаторов передаются напрямую в обработчик через `Bind`, поэтому нет необходимости управлять буферами вручную.
- Предыдущие значения быстрой и медленной средних кешируются для определения пересечений по той же логике, что и в MQL (быстрая пересекает медленную сверху или снизу).
- При бычьем пересечении и отсутствии длинной позиции стратегия отправляет рыночную заявку на покупку объёмом `Volume + |Position|`, чтобы закрыть возможный шорт и открыть новый лонг. Медвежий сигнал зеркально работает на продажу.
- `StartProtection()` вызывается один раз при запуске для активации встроенных механизмов защиты позиции.
- На графике отображаются свечи исходной подписки, обе скользящие средние и собственные сделки стратегии.

## Параметры
- **CandleType** – тип данных свечей для подписки (по умолчанию таймфрейм 15 минут).
- **FastPeriod** – период быстрой LWMA. Значение по умолчанию: 5. Допускает оптимизацию.
- **SlowPeriod** – период медленной LWMA. Значение по умолчанию: 20. Допускает оптимизацию.

## Индикаторы
- `LinearWeightedMovingAverage` (быстрый, период по умолчанию 5).
- `LinearWeightedMovingAverage` (медленный, период по умолчанию 20).

## Правила торговли
1. Дожидаемся формирования свечи и проверяем, что стратегия сформирована, находится онлайн и разрешено выставлять заявки.
2. Фиксируем бычье пересечение, если на предыдущей свече быстрая LWMA была ниже или равна медленной, а на текущей стала выше или равна. В этом случае закрываем шорт (если есть) и открываем лонг.
3. Фиксируем медвежье пересечение, если ранее быстрая LWMA была выше или равна медленной, а теперь опустилась ниже или равна. В этом случае закрываем лонг (если есть) и открываем шорт.
4. Объём каждой новой заявки вычисляется как `Volume + |Position|`, что позволяет полностью развернуть позицию и поддерживать только одно направление одновременно.
