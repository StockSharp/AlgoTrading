# Стратегия Exp Blau CSI

Данная стратегия представляет собой перенос советника MetaTrader 5 `Exp_BlauCSI` на платформу StockSharp. В основе лежит индикатор Blau Candle Stochastic Index (CSI), рассчитываемый по выбранному потоку свечей. Стратегия может работать по пробоям уровня ноль либо по разворотам индикатора и поддерживает фиксированные уровни стоп-лосса и тейк-профита в шагах цены.

## Логика работы

Blau CSI сравнивает моментум цены с диапазоном High-Low последних свечей. Обе серии проходят через три последовательных сглаживания.

* **Режим Breakdown** — открывает длинную позицию при пробое уровня ноль вниз и закрывает все короткие позиции, если предыдущее значение было положительным. При пробое вверх открывает шорт и закрывает лонги, если предыдущее значение было отрицательным.
* **Режим Twist** — открывает длинную позицию при смене направления вверх (значение растёт после снижения) и закрывает шорт. При смене направления вниз открывает короткую позицию и закрывает лонг. Предыдущая свеча всегда используется для выхода из противоположных позиций.

Сигналы рассчитываются по заданному сдвигу `Signal Bar`, что гарантирует использование полностью сформированных свечей.

## Параметры

| Параметр | Описание |
|----------|----------|
| `Entry Mode` | Выбор логики `Breakdown` или `Twist`. |
| `Smoothing Method` | Тип сглаживания в расчёте Blau CSI (Simple, Exponential, Smoothed, LinearWeighted, Jurik). |
| `Momentum Length` | Количество свечей для расчёта моментума и диапазона. |
| `First/Second/Third Smoothing` | Периоды трёх стадий сглаживания. |
| `Smoothing Phase` | Параметр фазы для Jurik (игнорируется другими методами). |
| `Momentum Price` / `Reference Price` | Типы цен для ведущего и запаздывающего значений (close, open, high, low, median, typical, weighted, simple, quarter, trend-following, Demark). |
| `Signal Bar` | Сдвиг по истории при оценке индикатора. Значение `1` означает предыдущую закрытую свечу. |
| `Stop Loss (pts)` | Размер стоп-лосса в шагах цены (0 отключает). |
| `Take Profit (pts)` | Размер тейк-профита в шагах цены (0 отключает). |
| `Allow Long/Short Entries` | Разрешение на открытие длинных/коротких позиций. |
| `Allow Long/Short Exits` | Разрешение на закрытие длинных/коротких позиций по сигналам. |
| `Candle Type` | Тип подписки на данные (по умолчанию свечи 4H). |
| `Start Date` / `End Date` | Ограничение по датам торговли. |
| `Order Volume` | Объём рыночных заявок. |

## Управление риском

При открытии позиции рассчитываются уровни стоп-лосса и тейк-профита на основе `PriceStep`. Если инструмент не предоставляет шаг цены, защитные уровни отключаются. Трейлинг-стоп не используется — уровень остаётся неизменным до закрытия позиции сигналом или достижением цели.

## Рекомендации по использованию

1. Подключите стратегию к инструменту, предоставляющему свечи выбранного типа.
2. Настройте режим сигналов и параметры сглаживания в соответствии с торговой идеей.
3. Убедитесь, что инструмент имеет корректный `PriceStep`, если задействованы стоп-лосс/тейк-профит.
4. Ограничьте период торговли с помощью `Start Date` и `End Date`, если это необходимо.

## Отличия от версии MT5

* Используются индикаторы и торговые методы StockSharp вместо функций MetaTrader.
* Управление размером позиции упрощено: объём берётся из параметра `Order Volume`.
* Реализованы только доступные в StockSharp типы сглаживания (Simple, Exponential, Smoothed, LinearWeighted, Jurik). Остальные варианты MT5 автоматически заменяются на экспоненциальное сглаживание.
* Флаги разрешения на вход и выход, а также логика стопов соответствуют оригинальному советнику.

Стратегию можно запускать в StockSharp Designer, Shell, Runner или в любом приложении, использующем библиотеку StockSharp.