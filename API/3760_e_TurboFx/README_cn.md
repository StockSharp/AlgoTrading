# e-TurboFx Classic 策略

## 概述
**e-TurboFx Classic** 策略将 `MQL/7262/e-TurboFx.mq4` 中的 MetaTrader 4 智能交易系统完整移植到 StockSharp。策略寻找一连串实体不断扩大的强势 K 线，并在动能衰竭时反向入场。移植版本使用 StockSharp 的高级策略 API、K 线订阅以及内置的保护性订单管理。

## 交易逻辑
1. 订阅所选的 K 线类型，只处理已经收盘的 K 线。
2. 计算 K 线实体大小（`|close - open|`），用于判断实体是否继续扩大。
3. 维护两个计数器：
   - **空头序列**：统计连续收阴并且实体大于前一根阴线的数量。
   - **多头序列**：统计连续收阳并且实体大于前一根阳线的数量。
4. 出现十字星（开盘价等于收盘价）或策略已经持仓时，立即重置两个计数器，保持与原始 EA 同样的「一次只持有一笔交易」规则。
5. **做多：** 当空头序列长度达到参数 `SequenceLength` 时，发送市价买单，并重置计数器。
6. **做空：** 当多头序列长度达到 `SequenceLength` 时，发送市价卖单，并重置计数器。
7. 可选的止盈、止损以点数表示，并在 StockSharp 中转换为价格步长。

策略等待单方向的极端冲刺，每一根新 K 线的实体都在扩大，随后尝试在动能耗尽时捕捉反转。

## 实现细节
- 通过 `SubscribeCandles().Bind(ProcessCandle)` 处理收盘 K 线，无需手动管理指标。
- `StartProtection` 将止盈和止损从点数转换为价格步长（`UnitTypes.Step`）。
- 所有参数都通过 `Param(...)` 注册，便于界面调整和参数优化。
- 仅在交易品种提供有效的 `PriceStep` 时启用止盈止损，否则建议将其保持为 `0`。
- 持仓期间会暂停信号检测并清空计数器，避免重复开仓，完全符合原始脚本的逻辑。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `SequenceLength` | 触发交易所需的连续扩张 K 线数量。 | `3` |
| `TakeProfitSteps` | 以价格步长表示的止盈距离，`0` 表示不使用止盈。 | `120` |
| `StopLossSteps` | 以价格步长表示的止损距离，`0` 表示不使用止损。 | `70` |
| `TradeVolume` | 每次市价单的下单数量，并同步到 `Volume` 属性。 | `0.1` |
| `CandleType` | 分析所用的 K 线周期，默认为 1 小时。 | `1 hour` |

## 使用建议
- 确保订阅的 K 线数据连续无缺失，切换品种或周期后需等待新数据重新构建序列。
- 在噪声较大的周期上，实体扩张很容易被打断，可适当降低 `SequenceLength`。
- 建议在回测或模拟环境中验证不同参数组合，评估滑点与交易成本的影响。
- 实盘前务必进行充分测试，确认保护性订单与经纪商规则兼容。
