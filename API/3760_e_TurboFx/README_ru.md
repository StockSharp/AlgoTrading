# Стратегия e-TurboFx Classic

## Общее описание
**e-TurboFx Classic** — это точный перенос советника MetaTrader 4 из файла `MQL/7262/e-TurboFx.mq4` на платформу StockSharp. Алгоритм отслеживает серии сильных свечей с увеличивающимся телом и пытается входить в противоположную сторону, когда импульс выдыхается. В версии для StockSharp используется высокоуровневый API стратегий, подписки на свечи и встроенные защитные ордера.

## Торговая логика
1. Подписываемся на выбранный тип свечей и анализируем только закрытые свечи.
2. Рассчитываем размер тела свечи (`|close - open|`) для отслеживания расширения.
3. Ведём два счётчика:
   - **Медвежья последовательность** — количество подряд идущих медвежьих свечей, тело которых больше, чем у предыдущей медвежьей свечи.
   - **Бычья последовательность** — количество подряд идущих бычьих свечей, тело которых больше, чем у предыдущей бычьей свечи.
4. Сбрасываем оба счётчика, если появляется доджи (открытие равно закрытию) или уже открыта позиция. Это повторяет поведение оригинального советника, который держит только одну сделку.
5. **Покупка:** при достижении длины `SequenceLength` медвежьей последовательности отправляется рыночный ордер на покупку, после чего счётчики обнуляются.
6. **Продажа:** при достижении длины `SequenceLength` бычьей последовательности отправляется рыночный ордер на продажу и счётчики обнуляются.
7. По желанию можно задать уровни стоп-лосса и тейк-профита в шагах цены.

Таким образом стратегия ждёт «капитуляционного» движения, когда каждая новая свеча усиливает тренд, и затем пытается отработать разворот.

## Особенности реализации
- Используется `SubscribeCandles().Bind(ProcessCandle)` для обработки закрытых свечей без ручной работы с индикаторами.
- Вызов `StartProtection` переводит стоп-лосс и тейк-профит из пунктов в шаги цены (`UnitTypes.Step`).
- Параметры оформлены через `Param(...)`, поэтому доступны в интерфейсе и готовы к оптимизации.
- Стратегия корректно работает на инструментах с заданным `PriceStep`; при отсутствии шага цены стоп и таргет лучше оставить равными `0`.
- Пока позиция открыта, поиск сигналов приостанавливается и внутренние счётчики очищаются, что повторяет логику исходного MQL-советника.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `SequenceLength` | Количество закрытых свечей с расширяющимся телом, необходимое для входа. | `3` |
| `TakeProfitSteps` | Дистанция тейк-профита в шагах цены. `0` отключает тейк-профит. | `120` |
| `StopLossSteps` | Дистанция стоп-лосса в шагах цены. `0` отключает стоп. | `70` |
| `TradeVolume` | Объём рыночных ордеров, автоматически передаётся в свойство `Volume`. | `0.1` |
| `CandleType` | Тип (таймфрейм) анализируемых свечей. По умолчанию — часовые свечи. | `1 hour` |

## Рекомендации по использованию
- Убедитесь, что свечные данные приходят без пропусков. После смены инструмента или таймфрейма дайте стратегии получить новую историю.
- На шумных таймфреймах последовательности часто сбрасываются. При необходимости уменьшайте `SequenceLength`.
- Протестируйте разные инструменты и настройки, чтобы найти баланс между частотой сигналов и торговыми издержками.
- Перед боевой торговлей обязательно прогоните стратегию в тестере или на демо-счёте.
