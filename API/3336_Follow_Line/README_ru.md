# Стратегия Follow Line

## Описание
Стратегия Follow Line является переносом советника MetaTrader `FollowLineEA_v1.0`. Она использует связку индикаторов Bollinger Bands, ATR и набора простых скользящих средних, чтобы построить динамическую линию тренда. Линия скользит только в направлении прорыва, поэтому образует ступенчатую структуру и помогает удерживать позицию до завершения импульса.

## Логика торговли
1. **Цепочка индикаторов**
   - Полосы Боллинджера с параметрами `BollingerPeriod` и `BollingerDeviations` определяют факт выхода цены за диапазон.
   - ATR (`AtrPeriod`) опционально расширяет линию, если активирован флаг `UseAtrFilter`.
   - Набор SMA (`MovingAveragePeriod`) по High, Low, Open, Close и медиане формирует подтверждение сигналов в режимах `OpenCloseMedian` и `HighLowOpenClose`.
2. **Обновление линии**
   - Закрытие выше верхней полосы поднимает линию под минимум свечи (с учётом ATR), но не позволяет ей опуститься ниже предыдущего значения.
   - Закрытие ниже нижней полосы опускает линию над максимум свечи и тоже не даёт ей подняться выше предыдущего уровня.
   - Знак приращения линии определяет состояние тренда: >0 — бычий, <0 — медвежий.
3. **Сигналы**
   - Переключение линии из отрицательного наклона в положительный даёт стрелку на покупку при выполнении фильтра по стрелкам.
   - Переключение из положительного наклона в отрицательный формирует стрелку на продажу.
   - Параметр `IndicatorsShift` задерживает исполнение сигнала на указанное число свечей, что повторяет обращение к буферу индикатора в MQL.
4. **Фильтры**
   - Временной фильтр (`UseTimeFilter`, `TimeStartTrade`, `TimeEndTrade`). Окно может пересекать полуночь.
   - Контроль спреда (`MaxSpread`) и максимального объёма (`MaxOrders`).

## Управление рисками
- **Закрытие по встречному сигналу** (`CloseInSignal`).
- **Баскетные ограничения**: `CloseInProfit`, `CloseInLoss`, `UseBasketClose`, `PipsCloseProfit`, `PipsCloseLoss` — повторяют поведение советника.
- **Стопы**: стоп-лосс, тейк-профит, трейлинг и безубыток (`UseStopLoss`, `UseTakeProfit`, `UseTrailingStop`, `UseBreakEven`). Все расстояния указываются в шагах цены.
- **Лотность**: `AutoLotSize` распределяет долю капитала (`RiskFactor`), иначе используется фиксированный `ManualLotSize`. Объём нормируется по шагу и биржевым ограничениям.

## Параметры
Сохранены все настройки оригинала: таймфрейм (`CandleType`), глубина истории (`BarsCount`), параметры индикаторов, фильтры времени и спреда, блок управления позицией и денежным менеджментом.

## Примечания по использованию
- Стратегия работает по закрытым свечам, поэтому результаты тестов и реальной торговли совпадают при одинаковой компрессии данных.
- `TypeOfArrows = HideArrows` полностью отключает торговлю, оставляя только индикацию.
- Визуализация сделок включена через `CreateChartArea()` и `DrawOwnTrades()`.

## Особенности конвертации
- Реализация выполнена на высокоуровневом API StockSharp без обращения к индикаторным буферам через `GetValue`.
- Управление ордерами повторяет оригинальные вызовы `BuyMarket`/`SellMarket` и защитные стопы.
- Все комментарии в коде на английском языке согласно требованиям репозитория.
