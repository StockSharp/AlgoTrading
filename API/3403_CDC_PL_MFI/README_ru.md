# Стратегия CDC PL MFI

## Обзор
**CDC PL MFI** — перенос на StockSharp советника MetaTrader `Expert_ADC_PL_MFI` (MQL/299). Стратегия отслеживает разворотные свечные модели **Dark Cloud Cover** и **Piercing Line** и подтверждает каждую из них осциллятором **Money Flow Index (MFI)**. Реализованы исходные периоды индикаторов и пороги, добавлены опциональные стоп-лосс и тейк-профит в пунктах, а выход из позиции происходит при пересечении MFI заданных уровней разворота.

## Логика торговли
1. Подписка на выбранный тип свечей (по умолчанию часовые) и расчёт Money Flow Index с заданным периодом. Дополнительно поддерживаются простые скользящие средние для размера тела свечей и цен закрытия, что воспроизводит фильтры тренда и импульса оригинала.
2. При формировании бычьей модели **Piercing Line** (гэп ниже минимума предыдущей свечи, закрытие выше середины тела медвежьей свечи, обе свечи длиннее среднего тела, а предыдущее закрытие ниже трендовой средней) и значении MFI ниже **LongEntryLevel** (по умолчанию `40`) стратегия открывает или переворачивает позицию в лонг.
3. При появлении медвежьей модели **Dark Cloud Cover** (гэп выше максимума предыдущей свечи, закрытие ниже середины тела бычьей свечи, обе свечи длиннее среднего тела, а предыдущее закрытие выше трендовой средней) и значении MFI выше **ShortEntryLevel** (по умолчанию `60`) стратегия открывает или переворачивает позицию в шорт.
4. MFI контролирует выходы:
   - Шорты закрываются, когда MFI пересекает снизу вверх **ExitLowerLevel** (`30`) или **ExitUpperLevel** (`70`).
   - Лонги закрываются, когда MFI пересекает сверху вниз **ExitUpperLevel** (`70`) или **ExitLowerLevel** (`30`).
5. Защитные ордера опциональны. Если **TakeProfitPips** или **StopLossPips** больше нуля, вызывается `StartProtection`, а расстояние переводится из пунктов в цену (пункт умножается на шаг цены инструмента).

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `CandleType` | Тип свечей для поиска моделей. | Таймфрейм `1 час` |
| `MfiPeriod` | Период расчёта Money Flow Index. | `49` |
| `BodyAveragePeriod` | Количество свечей для среднего размера тела. | `11` |
| `LongEntryLevel` | Уровень MFI, подтверждающий бычью модель. | `40` |
| `ShortEntryLevel` | Уровень MFI, подтверждающий медвежью модель. | `60` |
| `ExitLowerLevel` | Нижний уровень MFI для закрытия шортов. | `30` |
| `ExitUpperLevel` | Верхний уровень MFI для закрытия лонгов. | `70` |
| `StopLossPips` | Стоп-лосс в пунктах (0 — отключено). | `50` |
| `TakeProfitPips` | Тейк-профит в пунктах (0 — отключено). | `50` |

## Примечания
- Базовый объём — `1` лот. При перевороте позиции отправляется один рыночный ордер, перекрывающий текущий объём и открывающий новую позицию, как в оригинальном советнике.
- Распознавание моделей повторяет логику MetaTrader: анализируются только завершённые свечи, гэпы должны выходить за пределы предыдущего максимума/минимума, а простая скользящая средняя подтверждает преобладающий тренд.
- Значения Money Flow Index получаются напрямую от индикатора, стратегия хранит только последние значения для отслеживания пересечений порогов.
- Версия на Python отсутствует, представлен только C#-код.
