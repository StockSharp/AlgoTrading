# Стратегия Expert ADC PL Stoch

## Описание

**Expert ADC PL Stoch** — это конвертация экспертной системы *Expert_ADC_PL_Stoch* с платформы MQL5. Стратегия анализирует свечные комбинации Piercing Line и Dark Cloud Cover, а также использует линию %D индикатора Stochastic для подтверждения входов и выхода из позиций. Таким образом воспроизводится исходная «голосующая» логика оригинального эксперта.

## Алгоритм работы

1. Стратегия подписывается на свечи указанного таймфрейма (по умолчанию 1 час).
2. Для каждой закрытой свечи сохраняются последние значения свечей и %D Stochastic.
3. **Открытие длинной позиции**
   - Свечи *t-1* и *t-2* формируют модель Piercing Line:
     - Свеча *t-1* — длинная бычья, её тело больше среднего тела.
     - Свеча *t-2* — длинная медвежья, её тело также больше среднего.
     - Бычья свеча открывается с гэпом вниз и закрывается внутри тела предыдущей свечи, а скользящее среднее по закрытиям указывает на нисходящий тренд.
   - Значение %D на свече *t-1* ниже порога для лонга (30).
4. **Открытие короткой позиции**
   - Свечи *t-2* и *t-1* формируют модель Dark Cloud Cover:
     - Свеча *t-2* — длинная бычья.
     - Свеча *t-1* открывается выше максимума предыдущей свечи и закрывается внутри её тела.
     - Среднее значение цены свечи *t-1* выше среднего закрытия, что подтверждает предыдущий восходящий тренд.
   - Значение %D на свече *t-1* выше порога для шорта (70).
5. **Закрытие позиций**
   - Лонг закрывается, если %D на свече *t-1* пересекает сверху вниз уровни 80 или 20 относительно свечи *t-2*.
   - Шорт закрывается, если %D на свече *t-1* пересекает снизу вверх уровни 20 или 80 относительно свечи *t-2*.
6. Все расчёты выполняются только по завершённым свечам, без внутрисессионных сигналов.

## Параметры

| Параметр | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `CandleType` | Таймфрейм свечей для анализа. | 1 час |
| `StochasticLength` | Базовый период индикатора Stochastic. | 47 |
| `StochasticKPeriod` | Период сглаживания линии %K. | 9 |
| `StochasticDPeriod` | Период сглаживания линии %D. | 13 |
| `StochasticSlow` | Дополнительное сглаживание Stochastic. | 3 |
| `AverageBodyPeriod` | Количество свечей для расчёта среднего тела и среднего закрытия. | 5 |
| `LongEntryThreshold` | Максимальное значение %D перед входом в лонг. | 30 |
| `ShortEntryThreshold` | Минимальное значение %D перед входом в шорт. | 70 |
| `ExitLowerThreshold` | Нижний уровень для выхода. | 20 |
| `ExitUpperThreshold` | Верхний уровень для выхода. | 80 |

## Управление рисками

- Сделки исполняются рыночными ордерами с базовым объёмом (по умолчанию 1 лот).
- Защитные ордера не выставляются автоматически; при необходимости можно добавить `StartProtection`.
- Одновременно удерживается только одна позиция; при смене сигнала текущая позиция закрывается и открывается новая в противоположную сторону.

## Дополнительные замечания

- Средние значения по телам свечей и закрытиям рассчитываются по истории, чтобы повторить логику MQL5-версии.
- Значения %D хранятся для каждой закрытой свечи и используются с теми же смещениями, что и в оригинальном коде.
- Торговля разрешена только после полной инициализации стратегии и прохождения стандартных проверок `IsFormedAndOnlineAndAllowTrading()`.
