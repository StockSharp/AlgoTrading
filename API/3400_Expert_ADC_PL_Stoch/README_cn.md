# Expert ADC PL Stoch 策略

## 概述

**Expert ADC PL Stoch 策略** 源自 MQL5 系统 *Expert_ADC_PL_Stoch*，通过识别两烛形态与随机指标（Stochastic）组合进行交易。策略在检测到 Piercing Line（曙光初现）或 Dark Cloud Cover（乌云盖顶）形态后，仅当随机指标 %D 线位于极值区域时才允许开仓，退出条件同样基于 %D 线穿越关键阈值，从而尽可能还原原始 EA 的投票逻辑。

## 交易流程

1. 订阅可配置的蜡烛类型（默认 1 小时）。
2. 对每根完成的蜡烛缓存最近的蜡烛数据和 Stochastic %D 数值。
3. **做多条件**
   - *t-1* 与 *t-2* 两根蜡烛形成 Piercing Line 形态：
     - *t-1* 为大阳线，实体大于平均实体长度。
     - *t-2* 为大阴线，实体大于平均实体长度。
     - *t-1* 低开并在前一根实体内部收盘，同时收盘均线显示此前处于下行趋势。
   - *t-1* 的 %D 数值低于多头阈值（默认 30）。
4. **做空条件**
   - *t-2* 与 *t-1* 两根蜡烛形成 Dark Cloud Cover 形态：
     - *t-2* 为大阳线。
     - *t-1* 高开后收盘落在前一根实体内部。
     - *t-1* 的中间价高于收盘均线，表明此前处于上升趋势。
   - *t-1* 的 %D 数值高于空头阈值（默认 70）。
5. **平仓条件**
   - 多单：当 *t-1* 的 %D 相比 *t-2* 向下穿越 80 或 20。
   - 空单：当 *t-1* 的 %D 相比 *t-2* 向上穿越 20 或 80。
6. 所有判断均基于已完成蜡烛，不在蜡烛形成过程中下单。

## 参数

| 参数 | 说明 | 默认值 |
| ---- | ---- | ------ |
| `CandleType` | 用于形态识别的蜡烛类型/周期。 | 1 小时 |
| `StochasticLength` | 随机指标的基础长度。 | 47 |
| `StochasticKPeriod` | %K 线平滑周期。 | 9 |
| `StochasticDPeriod` | %D 线平滑周期。 | 13 |
| `StochasticSlow` | 额外平滑因子。 | 3 |
| `AverageBodyPeriod` | 计算平均实体长度和收盘均线所用的蜡烛数量。 | 5 |
| `LongEntryThreshold` | 做多前允许的 %D 最大值。 | 30 |
| `ShortEntryThreshold` | 做空前要求的 %D 最小值。 | 70 |
| `ExitLowerThreshold` | 平仓使用的下阈值。 | 20 |
| `ExitUpperThreshold` | 平仓使用的上阈值。 | 80 |

## 风险控制

- 策略使用基础交易量（默认 1 手）发送市价单。
- 未启用自动止损/止盈，可根据需要在 `StartProtection` 中补充。
- 同一时间只维护一个方向的持仓，新信号会先平仓再反向进场。

## 注意事项

- 平均实体长度和收盘均线由历史蜡烛计算，以贴合原策略的判定方式。
- 随机指标的 %D 数值按完成蜡烛存储，确保与 MQL5 中的索引一致。
- 仅在策略准备完毕且允许交易时才会执行下单操作。
