# ExpICustomV1 策略

## 概述

**ExpICustomV1 策略** 是 MetaTrader 专家顾问 `exp_iCustom_v1` 的 StockSharp 版本。策略从可配置的指标实例中读取信号，并在指定缓冲区出现非零值时开仓：买入缓冲区非零时做多，卖出缓冲区非零时做空。通过止损、止盈、移动止损以及保本锁定，复刻了原始专家的风险管理逻辑。

> **提示：** 当前仅提供 C# 实现，暂不包含 Python 版本。

## 交易逻辑

1. 订阅 **蜡烛类型** 指定的主要周期，仅处理收盘蜡烛。
2. 根据 **指标名称** 创建指标实例，并应用斜杠分隔的 **指标参数**（支持 `Name=Value` 和纯数字序列）。
3. 将指标最终输出缓存起来，以便在后续蜡烛上按 **指标位移** 读取历史值。
4. 当买入缓冲区在指定位移上得到非零值时开/持多仓；卖出缓冲区非零时开/持空仓。
5. 若买入和卖出信号同时为真，则互相抵消，避免出现不确定的指令。
6. 启用 **反向平仓** 时，会在出现反向信号后先平掉当前仓位再执行新方向。
7. 睡眠逻辑确保同方向入场之间至少间隔指定数量的蜡烛，可通过 **取消睡眠** 在反向信号出现时重置计时器。
8. 所有距离均以点值表示，可同时启用止损、止盈、移动止损与保本锁定。

## 指标配置

* **指标名称**：指标类型的全名或 StockSharp 中的简写（如 `SMA`、`MACD`、`BollingerBands`）。
* **指标参数**：斜杠分隔的参数列表，既支持 `Length=14/Width=2` 这类命名形式，也支持 `14/2/0.7` 这类位置参数。
* **参数替换模块**：最多五组，按照索引替换指定位置的参数值，对应原版中的 `Opt_X` 选项，索引从零开始。

## 风险与资金管理

* **基础手数**：每次市价委托的交易量。
* **止损 / 止盈**：距离入场价的绝对点值。
* **移动止损**：达到指定盈利后启动，保持设定的回撤距离。
* **保本锁定**：达到指定盈利后将止损移动至入场价附近，并可锁定额外点数。

## 参数一览

| 参数 | 说明 |
|------|------|
| 蜡烛类型 | 指标与信号评估所使用的时间框架。 |
| 指标名称 | 指标实例的类型名称。 |
| 指标参数 | 斜杠分隔的指标参数列表。 |
| 买入/卖出缓冲区 | 存放买卖信号的缓冲区索引。 |
| 指标位移 | 读取指标值时使用的历史偏移。 |
| 参数替换模块 | 在运行时替换指定位置的参数值。 |
| 睡眠蜡烛数 | 同方向再次入场前需要等待的蜡烛数量。 |
| 取消睡眠 | 反向信号出现时是否重置睡眠计时。 |
| 反向平仓 | 反向信号出现时是否先平掉现有仓位。 |
| 最大订单/最大买单/最大卖单 | 限制同一时间的仓位数量。 |
| 止损/止盈 | 以点值表示的保护距离。 |
| 移动止损参数 | 控制移动止损触发与距离的设置。 |
| 保本参数 | 控制保本触发与锁定距离的设置。 |
| 基础手数 | 每次市价入场的交易量。 |

## 使用步骤

1. 将策略添加到容器中，并设置好 **标的** 与 **投资组合**。
2. 根据目标自定义指标配置 **指标名称** 与 **指标参数**。
3. 按需调整风险参数（止损、止盈、移动止损、保本）以及基础手数。
4. 启动策略后，它会订阅指定周期的蜡烛，评估指标缓冲区，并在条件满足时发送市价单。

## 限制说明

* 只能使用已在 StockSharp 中实现的指标类型，无法直接加载 MetaTrader 二进制指标。
* 依赖账户余额或保证金的资金管理模式被简化为固定手数模型。
