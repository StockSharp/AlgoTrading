# FitFul 13

## Общее описание
FitFul 13 рассчитывает недельные пивот-уровни на основе предыдущей недели и наблюдает, как текущая свеча рабочего таймфрейма (по умолчанию H1) взаимодействует с этими уровнями. Если тело свечи пересекает конкретный пивот и условия подтверждаются двумя более старыми свечами подтверждающего таймфрейма (по умолчанию M15), стратегия открывает сделку с заранее определёнными целями по стопу и профиту. Дополнительно используется виртуальный трейлинг-стоп, который фиксирует часть прибыли, когда цена проходит достаточное расстояние.

## Логика оригинала
1. Рассчитать `PriceTypical`, уровни `R1`, `S1`, промежуточные уровни (`R0.5`, `S0.5`, `R1.5` и т.д.), а также расширения `R2`, `S2`, `R3`, `S3` по данным предыдущей недели.
2. Если последняя свеча H1 закрылась бычьей, анализируется тело предыдущей свечи: при пересечении одного из пивотов формируются параметры для покупки (стоп ниже соответствующей поддержки, тейк выше зеркального сопротивления). При медвежьем закрытии выполняется зеркальная логика для коротких позиций.
3. Если по H1 сигнал не найден, проверяются две старые свечи подтверждающего M15. Два минимума, которые протыкают один и тот же уровень и закрываются выше него, подтверждают покупку; два максимума, которые закрываются ниже уровня, подтверждают продажу. Каждая комбинация сопоставляется со своими уровнями стопа и профита.
4. На основании сигналов отправляется рыночный ордер заданного объёма. В версии StockSharp используется неттинг, поэтому перед открытием позиции противоположная экспозиция закрывается.
5. Трейлинг-стоп включается, когда текущая прибыль превышает сумму `TrailingStopPips + TrailingStepPips`. Для лонга стоп переносится на `Close - TrailingStopPips`, для шорта — на `Close + TrailingStopPips`. Стоп никогда не отдаляется от цены и подтягивается только при достаточном продвижении.
6. Новые сигналы игнорируются, если модуль нетто-позиции уже равен `Volume × MaxPositions`.

## Параметры
| Параметр | Тип | Значение по умолчанию | Описание |
|----------|-----|-----------------------|----------|
| `CandleType` | `DataType` | H1 | Рабочий таймфрейм для поиска реакций на пивоты. |
| `ConfirmationCandleType` | `DataType` | M15 | Подтверждающий таймфрейм для проверки двух свечей. |
| `Volume` | `decimal` | 0.1 | Объём рыночного ордера. |
| `MaxPositions` | `int` | 3 | Лимит нетто-позиции в кратных `Volume`. |
| `IndentPips` | `decimal` | 3 | Отступ (в пунктах) при расчёте стопа и профита от базовых уровней. |
| `TrailingStopPips` | `decimal` | 150 | Дистанция трейлинг-стопа в пунктах. Значение 0 отключает трейлинг. |
| `TrailingStepPips` | `decimal` | 5 | Минимальное дополнительное движение цены (в пунктах) для подтягивания трейлинг-стопа. |

## Особенности порта
- Реализация работает с одной суммарной позицией. Появление сигнала противоположного направления приводит к закрытию текущей экспозиции.
- Стоп-лосс, тейк-профит и трейлинг реализованы виртуально: закрытие выполняется при появлении новой свечи, если цена пересекает сохранённый уровень.
- Пивоты пересчитываются по мере поступления новых недельных свечей. При необходимости можно изменить рабочий и подтверждающий таймфреймы.
- Все комментарии в коде перевода написаны на английском языке согласно требованиям.
