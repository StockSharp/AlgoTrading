# Стратегия Ten Points 3

## Кратко
- Конвертация эксперта MetaTrader 4 **10p3v004 ("10points 3")** на высокоуровневый API StockSharp.
- Воссоздаёт сеточную систему на основе наклона MACD, включая мартингейл, трейлинг и защиту по прибыли.
- Для каждого параметра добавлены подробные пояснения, что позволяет точно повторить поведение оригинальной системы либо безопасно его настроить.

## Логика работы
1. **Определение сигнала.** После закрытия каждой свечи выбранного таймфрейма вычисляется MACD с настраиваемыми периодами. Рост главной линии относительно предыдущего значения формирует сигнал на покупку, падение — на продажу. Флаг `ReverseSignals` меняет интерпретацию.
2. **Построение сетки.** В любой момент может существовать только одна сетка в одном направлении.
   - Первый ордер выставляется сразу после появления сигнала.
   - Дополнительные ордера добавляются, если направление соответствует сигналу, цена отошла не менее чем на `GridSpacingPoints * PriceStep` от последней сделки и количество ордеров меньше `MaxTrades`.
   - Объём очередного ордера увеличивается по мартингейлу: `2^n` при сетке до 12 шагов и `1.5^n` при более длинной сетке. Объём округляется по шагу инструмента и ограничивается как биржевыми лимитами, так и параметром `MaxVolumeCap`.
3. **Управление капиталом.** При включённом `UseMoneyManagement` базовый объём рассчитывается из текущей стоимости портфеля и параметра `RiskPerTenThousand`. Опция `IsStandardAccount` повторяет особые правила округления объёма для стандартных/мини счетов. При отключении используется фиксированный `BaseVolume`.
4. **Выход из позиции.**
   - **Начальный стоп** закрывает сетку при неблагоприятном движении на `InitialStopPoints`.
   - **Тейк-профит** ликвидирует позицию при достижении `TakeProfitPoints` в нужную сторону.
   - **Трейлинг-стоп** активируется, когда цена отходит от средней цены на `TrailingStopPoints + GridSpacingPoints`, и далее удерживает запас `TrailingStopPoints`.
   - **Защита счёта** контролирует нереализованную прибыль (в пунктах × объём). При достижении `SecureProfit` и количестве ордеров не менее `OrdersToProtect` сетка закрывается полностью.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `CandleType` | Таймфрейм, на котором рассчитывается MACD и принимаются решения. | Свечи 30 минут |
| `MacdFastPeriod` / `MacdSlowPeriod` / `MacdSignalPeriod` | Периоды MACD, совпадают с оригинальным советником. | 14 / 26 / 9 |
| `BaseVolume` | Стартовый объём первой сделки при отключённом управлении капиталом. | 0.01 |
| `GridSpacingPoints` | Минимальная дистанция между ордерами сетки (в шагах цены). | 15 |
| `TakeProfitPoints` | Расстояние до тейк-профита, `0` — отключено. | 40 |
| `InitialStopPoints` | Расстояние начального стопа, `0` — отключено. | 0 |
| `TrailingStopPoints` | Размер трейлинг-буфера, активируется после движения на `TrailingStopPoints + GridSpacingPoints`. | 20 |
| `MaxTrades` | Максимальное число ордеров в сетке. | 9 |
| `OrdersToProtect` | Минимальное число ордеров для срабатывания защиты счёта. | 3 |
| `SecureProfit` | Порог нереализованной прибыли (пункты × объём) для принудительного закрытия. | 8 |
| `AccountProtectionEnabled` | Включает/выключает защиту счёта. | `true` |
| `ReverseSignals` | Инвертирует сигналы MACD. | `false` |
| `UseMoneyManagement` | Включает расчёт объёма по капиталу. | `false` |
| `RiskPerTenThousand` | Риск на каждые 10 000 единиц капитала при включённом управлении. | 12 |
| `IsStandardAccount` | Логика округления объёма (стандартные/мини лоты). | `true` |
| `MaxVolumeCap` | Жёсткий предел итогового объёма после мартингейла. | 100 |

## Особенности конвертации
- В MT4 стопы задавались на уровне каждого ордера. В StockSharp позиция ведётся агрегировано, поэтому стопы и трейлинг рассчитываются от средней цены входа.
- В исходнике прибыль переводилась в валюту счёта через `TickValue`. В новой версии защита счёта работает с величиной «пункты × объём», что соответствует исходным расчётам в пунктах.
- Функции `AccountFreeMarginCheck` и другие брокерские проверки недоступны в StockSharp. Вместо них используются биржевые ограничения инструмента и дополнительный параметр `MaxVolumeCap`.
- Комментарии ордеров, magic number и графические элементы из MT4 не переносятся, так как в StockSharp им нет прямого аналога.

## Рекомендации по использованию
1. Добавьте стратегию в проект, назначьте `Security` и `Portfolio`.
2. Подберите `CandleType` под нужный таймфрейм (обычно такой же, как в MT4).
3. Настройте объём: либо фиксированный `BaseVolume`, либо включите `UseMoneyManagement` с нужными параметрами риска.
4. Выберите, какие защитные механизмы использовать, и задайте соответствующие пороги.
5. Запустите стратегию и контролируйте сделки через встроенные графики (свечи, MACD, собственные сделки).

## Идеи для развития
- Заменить фиксированный шаг сетки динамическим (например, на основе ATR).
- Разделить настройки трейлинг-стопа или множителя мартингейла для длинных и коротких позиций.
- Добавить фильтры тренда (МА, анализ старшего таймфрейма), чтобы сократить работу против тенденции.

> **Важно:** По требованию Python-версия стратегии не создавалась, папка `PY` отсутствует.
