# Стратегия Multi Indicator Optimizer

Стратегия воспроизводит голосующую логику советника MetaTrader **MultiIndicatorOptimizer** на высокоуровневом API StockSharp. Пять классических осцилляторов анализируют завершившуюся свечу и вносят взвешённый вклад в суммарный индикатор настроения. Полученное значение сравнивается с заданными пользователем порогами, после чего стратегия принимает решение открыть длинную позицию, короткую позицию либо закрыть имеющиеся сделки.

## Логика торговли

1. **Блок MACD** — проверяет знак гистограммы и соотношение основной и сигнальной линий (данные берутся по предыдущей завершённой свече). Сумма двух сигналов усредняется и умножается на `MacdWeight`.
2. **Блок Awesome Oscillator** — определяет, находится ли осциллятор выше либо ниже нуля и усиливается ли импульс относительно бара ранее. Средний сигнал масштабируется коэффициентом `AoWeight`.
3. **Блок OsMA** — анализирует знак гистограммы MACD предыдущей свечи и умножает его на `OsmaWeight`.
4. **Блок Williams %R** — отслеживает пробои зон перепроданности/перекупленности, заданных `WilliamsLowerLevel` и `WilliamsUpperLevel`. Выход из нижней зоны даёт бычий сигнал, вход из верхней зоны — медвежий. Результат умножается на `WilliamsWeight`.
5. **Блок Stochastic** — объединяет два критерия: пересечение %K порогов `StochasticLowerLevel`/`StochasticUpperLevel` и взаимное положение %K и %D. Среднее значение обоих под-сигналов умножается на `StochasticWeight`.

Суммарный показатель сохраняется в журнале (колонка `Signal`) и доступен через поле `_lastSignal`. Торговый движок реагирует на величину следующим образом:

- `signal >= EntryThreshold` — закрыть шорты и открыть/поддерживать длинную позицию.
- `signal <= -EntryThreshold` — закрыть лонги и открыть/поддерживать короткую позицию.
- `abs(signal) <= ExitThreshold` — выйти в кэш, чтобы не торговать во флэтовой зоне.

Все расчёты ведутся по данным предыдущей завершённой свечи, что соответствует оригинальной MQL-реализации, использовавшей обращения сдвигами (`shift = 1/2`).

## Параметры

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Основной таймфрейм для расчёта индикаторов. | Свечи H1 |
| `MacdFast` / `MacdSlow` / `MacdSignal` | Периоды EMA для блока MACD. | 12 / 26 / 9 |
| `MacdWeight` | Вес голоса блока MACD (отрицательное значение инвертирует вклад). | 1 |
| `AoShortPeriod` / `AoLongPeriod` | Периоды скользящих средних осциллятора Awesome. | 5 / 34 |
| `AoWeight` | Вес голоса блока Awesome. | 1 |
| `OsmaFastPeriod` / `OsmaSlowPeriod` / `OsmaSignalPeriod` | Настройки MACD для расчёта гистограммы OsMA. | 12 / 26 / 9 |
| `OsmaWeight` | Вес голоса блока OsMA. | 1 |
| `WilliamsPeriod` | Длина окна для Williams %R. | 14 |
| `WilliamsLowerLevel` / `WilliamsUpperLevel` | Границы перепроданности/перекупленности (в процентах). | -80 / -20 |
| `WilliamsWeight` | Вес голоса блока Williams. | 1 |
| `StochasticKPeriod` / `StochasticDPeriod` / `StochasticSlowing` | Параметры стохастика и сглаживания %K. | 5 / 3 / 3 |
| `StochasticLowerLevel` / `StochasticUpperLevel` | Пороги перепроданности/перекупленности для %K. | 20 / 80 |
| `StochasticWeight` | Вес голоса блока Stochastic. | 1 |
| `EntryThreshold` | Минимальный модуль голоса для открытия или разворота позиции. | 0.5 |
| `ExitThreshold` | Ширина нейтральной зоны: позиции закрываются, когда модуль сигнала падает ниже порога. | 0.1 |

Каждый вес может быть отрицательным, что позволяет выключить или инвертировать вклад соответствующего блока и облегчает оптимизацию параметров.

## Особенности

- Используется только высокоуровневый API: `SubscribeCandles`, привязка индикаторов и готовые методы `BuyMarket`/`SellMarket`.
- Все сигналы формируются по завершённым свечам, поэтому решения принимаются на подтверждённых данных.
- Размер позиции задаётся базовым свойством `Volume`. При необходимости стопы и тейки можно подключить отдельным вызовом `StartProtection`.
- В коде добавлены подробные комментарии на английском языке, что облегчает поддержку и дальнейшие модификации.
