# Стратегия «Morning/Evening Star + MFI»

## Обзор
Стратегия воспроизводит логику советника MetaTrader `Expert_AMS_ES_MFI`, сочетая свечные разворотные модели и подтверждение импульса индикатором Money Flow Index (MFI). На выбранном таймфрейме анализируются трехсвечные фигуры «Morning Star» и «Evening Star», после чего сигнал фильтруется порогами MFI, чтобы подтвердить исчерпанность текущего движения. Пересечения уровней MFI также используются для выхода из позиции.

## Логика торговли

- **Источник данных**: закрытые свечи заданного таймфрейма и рассчитанные значения MFI.
- **Индикаторы**:
  - Money Flow Index (MFI) с настраиваемым периодом (по умолчанию 49).
- **Правила входа**:
  - **Покупка**: обнаружить модель «Morning Star» (сильная медвежья свеча, маленькая центральная свеча, сильная бычья свеча, закрывающаяся выше середины тела первой) и убедиться, что значение MFI на предыдущей свече ниже порога подтверждения (по умолчанию 40).
  - **Продажа**: обнаружить модель «Evening Star» (сильная бычья свеча, маленькая центральная свеча, сильная медвежья свеча, закрывающаяся ниже середины тела первой) и убедиться, что значение MFI на предыдущей свече выше порога подтверждения (по умолчанию 60).
  - При смене направления стратегия сначала закрывает противоположную позицию и только затем открывает новую.
- **Правила выхода**:
  - **Выход из лонга**: зафиксировать позицию, если MFI пересекает сверху уровень перекупленности (по умолчанию 70) или опускается ниже уровня перепроданности (по умолчанию 30), что сигнализирует о перегреве импульса или срыве разворота.
  - **Выход из шорта**: зафиксировать позицию, если MFI пробивает вверх уровень перепроданности (30) либо продолжает рост выше перекупленности (70), что указывает на усиление быков.
- **Тип заявок**: рыночные ордера с объемом, заданным в настройках StockSharp.

## Параметры
| Название | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `CandleType` | Таймфрейм анализируемых свечей. | Свечи 1 часа |
| `MfiPeriod` | Период индикатора MFI. | 49 |
| `BullishMfiThreshold` | Порог MFI для подтверждения сигналов Morning Star. | 40 |
| `BearishMfiThreshold` | Порог MFI для подтверждения сигналов Evening Star. | 60 |
| `UpperExitLevel` | Уровень MFI для фиксации перекупленности. | 70 |
| `LowerExitLevel` | Уровень MFI для фиксации перепроданности. | 30 |

Все параметры можно оптимизировать в StockSharp Designer или Optimizer.

## Рекомендации по использованию
1. Подключите стратегию к нужному инструменту и выставьте `CandleType`, соответствующий таймфрейму исходного MQL-советника.
2. Настройте риск-параметры (объем, кредитное плечо, ограничения брокера) в интерфейсе StockSharp.
3. Запустите стратегию — она автоматически подпишется на свечи, рассчитает значения MFI и начнет управление позицией по описанным правилам.

## Происхождение
Стратегия является прямой конверсией советника из каталога `MQL/323`, сохраняет его логику на основе свечных моделей и MFI, но реализована средствами высокоуровневого API StockSharp.
