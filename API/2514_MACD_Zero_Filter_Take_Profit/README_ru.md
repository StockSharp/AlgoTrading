# Стратегия MACD с фильтром нулевой линии и фиксированным тейк-профитом

## Описание
Стратегия повторяет логику советника MetaTrader 5 "Robot_MACD": сигналы формируются на пересечениях линий MACD и Signal с обязательной проверкой расположения относительно нулевой линии. Работает с одним инструментом, фиксирует прибыль через заранее заданное количество пунктов и не применяет стоп-лосс, полностью копируя исходный алгоритм.

## Используемые данные и индикаторы
- **Источники данных** — одна серия свечей (по умолчанию таймфрейм 5 минут). Параметр `CandleType` позволяет выбрать любой другой формат свечей.
- **Индикаторы** — `MovingAverageConvergenceDivergenceSignal` с периодами 12/26 EMA и 9 для сигнальной линии (стандартные значения из MQL).

## Логика работы
1. Дождаться формирования текущих значений MACD и сигнальной линии, а также их предыдущих значений.
2. Определить факт пересечения:
   - **Бычье** — предыдущий MACD ≤ предыдущий Signal и текущий MACD > текущего Signal.
   - **Медвежье** — предыдущий MACD ≥ предыдущего Signal и текущий MACD < текущего Signal.
3. **Управление позицией**:
   - Закрыть длинную позицию при медвежьем пересечении.
   - Закрыть короткую позицию при бычьем пересечении.
4. **Открытие позиции** (только при отсутствии позиции и достаточном капитале):
   - Покупка, если есть бычье пересечение и обе линии находятся ниже нуля.
   - Продажа, если есть медвежье пересечение и обе линии находятся выше нуля.
5. При старте стратегия вызывает `StartProtection`, устанавливая тейк-профит в абсолютном выражении: `TakeProfitPoints` умножается на шаг цены инструмента. Это отражает настройку `InpTakeProfit` из MQL.

## Управление рисками
- Каждая сделка сопровождается тейк-профитом. Стоп-лосс отсутствует, что соответствует оригинальному роботу.
- Перед выставлением заявки проверяется условие `Portfolio.CurrentValue ≥ MinimumCapitalPerVolume * VolumePerTrade`, моделирующее MQL-проверку `FreeMargin() < 1000 * Lots`.

## Параметры
| Параметр | Назначение | Значение по умолчанию |
|----------|------------|------------------------|
| `MacdFast` | Период быстрой EMA для MACD | 12 |
| `MacdSlow` | Период медленной EMA для MACD | 26 |
| `MacdSignal` | Период сигнальной линии | 9 |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах | 300 |
| `VolumePerTrade` | Объём сделки (лоты) | 1 |
| `MinimumCapitalPerVolume` | Минимальная величина капитала на один лот | 1000 |
| `CandleType` | Тип свечей для расчётов | 5-минутные свечи |

## Дополнительные замечания
- Заявки отправляются рыночными ордерами с помощью `BuyMarket`/`SellMarket`.
- Фильтр нулевой линии предотвращает входы против текущей стороны гистограммы MACD.
- Если брокер или тестер не заполняет `Portfolio.CurrentValue`, проверка капитала проходит автоматически, что делает стратегию совместимой с бэктестингом.
- При наличии графика отображаются свечи, индикатор MACD и точки сделок для наглядного анализа.
