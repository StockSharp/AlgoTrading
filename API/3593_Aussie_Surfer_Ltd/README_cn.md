# Aussie Surfer Ltd 策略

## 概述
**Aussie Surfer Ltd 策略** 是将 MetaTrader 5 专家顾问 “Aussie Surfer Ltd”（位于 MQL 目录 `43278`）完整移植到 StockSharp 高层 API 的版本。策略结合了快速的布林带反弹信号与 Alligator 趋势过滤器，自动化原 EA 的主观交易思路。默认在 15 分钟 K 线序列上评估并在所选交易品种上执行市价单。

## 指标与数据
- **布林带（收盘价，长度 5，标准差 2.5）**：捕捉价格短暂冲出带外后迅速回归的形态。
- **平滑移动平均（长度 21）**：重建 Alligator 的“牙齿”线用于判断趋势是否减速。
- **K 线中值 ((High + Low) / 2)**：作为 Alligator 计算的输入，确保斜率与原版 EA 保持一致。

策略仅订阅一条 K 线序列，所有信号都基于已完成的 K 线生成，从而避免未完成数据带来的噪音。

## 交易逻辑
1. **入场条件**
   - 如果上一根 K 线开盘价高于其下轨，而当前 K 线开盘价跌破两根之前记录的下轨，则在平掉空头后开多头。这还原了原策略中“刺破下轨后立即回到带内”的做多逻辑。
   - 如果上一根 K 线开盘价低于其上轨，而当前 K 线开盘价突破两根之前记录的上轨，则在平掉多头后开空头。
2. **Alligator 退出**
   - 追踪 Alligator 牙齿线在前两根 K 线的取值。当两根之前的数值大于一根之前的数值时说明斜率转为向下，此时平多；相反当斜率转为向上时平空。
3. **风控层**
   - 入场时应用固定的止损和止盈（以点数表示），将点值转换为价格差。如果参数为零则禁用对应功能。
   - 可选的移动止损在止损激活时启动，以前一根完成 K 线的最高价/最低价减去或加上点差距离来更新止损价位。

## 风险管理
- **止损**：根据合约的 `PriceStep` 将点数转换为价格并记录初始止损。
- **止盈**：在入场时计算一次并保持不变，直到触发或被其他规则提前退出。
- **移动止损**：当上一根 K 线创出更高高点（多头）或更低低点（空头）时，提高或降低止损位。
- **反向处理**：若出现反向信号，会发送足够的市价单一次性平掉旧方向并建立新仓位。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `OrderVolume` | 每次交易的基础手数或合约数。 | `0.30` |
| `StopLossPips` | 止损点数，`0` 表示禁用。 | `46` |
| `TakeProfitPips` | 止盈点数，`0` 表示禁用。 | `0` |
| `EnableTrailingStop` | 止损启用时是否跟随移动。 | `true` |
| `BollingerPeriod` | 布林带计算长度。 | `5` |
| `BollingerDeviation` | 布林带标准差倍数。 | `2.5` |
| `TeethPeriod` | Alligator 牙齿线的平滑平均长度。 | `21` |
| `CandleType` | 使用的 K 线类型（默认 15 分钟）。 | `15m` K 线 |

所有数值型参数都附带优化范围，可在策略分析器中微调。

## 实现说明
- 仅处理完成的 K 线，以模拟原 EA 在新 K 线开始时才执行的行为。
- 如果启用移动止损但未设置正数止损距离，初始化阶段会抛出异常，提醒用户修正配置。
- 若图表区域可用，策略会自动绘制 K 线、布林带和 Alligator 牙齿线，便于对照验证移植效果。

## 使用步骤
1. 在 StockSharp 终端或回测环境中加载该策略。
2. 设置交易品种，并根据经纪商合约细则调整手数与点数参数。
3. 启动策略后，它会订阅指定的 K 线序列，在每根完成的 K 线上评估信号并按上述规则管理持仓。

在实盘使用时，请确认经纪商支持市价单，并且品种的 `PriceStep` 信息完整，以确保点值转换准确。
