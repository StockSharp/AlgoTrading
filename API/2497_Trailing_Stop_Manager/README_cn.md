# 跟踪止损管理策略
[English](README.md) | [Русский](README_ru.md)

该策略重现了 `MQL/17263/TrailingStop.mq5` 专家的止损管理逻辑，用于在持仓建立后自动调整止损价位。

## 原始思路
- **来源**：Vladimir Karputov 编写的 MetaTrader 对冲账户专家。
- **做法**：在首个行情到来时同时买入和卖出，然后分别根据预设的点数距离移动多头和空头的止损。
- **目的**：展示如何通过“激活距离 + 调整步长”的配置实现动态跟踪止损。

## StockSharp 实现
- **净头寸模型**：StockSharp 默认使用净头寸，因此本移植版本一次只管理一个方向。如需同时维护多、空两个方向，可并行运行两份策略实例。
- **基于成交的更新**：策略订阅成交数据（`DataType.Ticks`），以便像原始 EA 一样在每个 tick 上更新止损。
- **点值换算**：参数中的“点”会乘以 `Security.PriceStep`（若无报价步长信息则退化为 1），转化为绝对价格差。
- **可选自动入场**：提供 `Initial Direction` 参数，可在启动时立即发送市价单，用于演示或手动测试。

## 交易逻辑
1. **初始化**
   - 读取品种的最小报价步长并订阅 tick 数据。
   - 根据 `Initial Direction` 参数（如不为 `None`）发送一笔市价单。
2. **入场记录**
   - 每当产生自己的成交，都会重置跟踪状态，并把实际成交价作为新的参考价。
3. **激活条件**
   - 多头仓位只有在价格上涨 `Trailing Stop (pips)` 所指定的距离后才启用跟踪止损；空头则要求价格下跌同样的距离。
4. **止损更新**
   - 激活后，止损价 = 当前 tick 价格 ± 激活距离。
   - 只有当新的止损价相对旧值前进至少 `Trailing Step (pips)` 指定的距离时才会移动，步长为 0 时表示每个有利 tick 都会更新。
5. **离场**
   - 当价格回落至跟踪止损价（多头）或反弹至止损价（空头）时，以市价单平仓。

## 参数说明
| 名称 | 说明 |
| --- | --- |
| **Trailing Stop (pips)** | 激活距离，单位为点，必须大于 0。 |
| **Trailing Step (pips)** | 每次调整止损所需的最小前进距离，可为 0。 |
| **Initial Direction** | 启动时是否自动下单（`None`、`Long`、`Short`）。 |

## 使用提示
- 原 EA 使用买价/卖价，本移植版本使用最近成交价作为近似值，对大多数流动性良好的品种足够精确。
- 策略不包含获利了结或再次入场逻辑，可与其他信号模块组合，也可以在手动建仓后单独运行。
- 若交易所提供的是“迷你点”，请确认 `PriceStep` 是否准确，或直接在参数中填入合适的点数。
- 本策略没有自动化测试，请先在模拟或历史数据上验证再投入真实资金。
