# Стратегия BSS Triple EMA Separation

## Общее описание

Стратегия **BSS Triple EMA Separation** — это порт эксперта MetaTrader 5 «BSS 1_0» (MQL ID 20591) на платформу StockSharp. Алгоритм отслеживает три скользящие средние с возрастающими периодами и ждёт момента, когда они разойдутся как минимум на заданную дистанцию. При выполнении условий стратегия входит в сторону преобладающего тренда, одновременно соблюдая паузу между входами и ограничение на максимальный совокупный объём позиции.

Поведение оригинального робота сохранено, все параметры вынесены в объекты `StrategyParam`. Комментарии в коде и документация приведены на английском языке в соответствии с требованием задания.

## Логика торговли

1. Стратегия подписывается на поток свечей, заданный параметром `CandleType`, и рассчитывает три скользящие средние (быструю, среднюю и медленную). Для каждой средней можно выбрать тип сглаживания (простое, экспоненциальное, сглаженное, линейно-взвешенное).
2. Условия для **покупки** на закрывшейся свече:
   - `Медленная MA – Средняя MA >= MinimumDistance`.
   - `Средняя MA – Быстрая MA >= MinimumDistance`.
3. Условия для **продажи** зеркальны:
   - `Быстрая MA – Средняя MA >= MinimumDistance`.
   - `Средняя MA – Медленная MA >= MinimumDistance`.
4. Перед открытием сделки проверяется, что:
   - Все индикаторы сформированы, стратегия готова и разрешена к торговле (`IsFormedAndOnlineAndAllowTrading`).
   - С момента последнего входа прошло не менее `MinimumPauseSeconds` секунд.
   - Добавление нового лота не превысит лимит `MaxPositions`.
5. При возникновении сигнала сначала закрываются сделки противоположного направления. Это повторяет поведение исходного советника, который сначала ликвидировал существующие позиции и только затем открывал новые в другом направлении.
6. После открытия или донаращивания позиции фиксируется время сделки, чтобы соблюсти интервал между входами.

Стоп-лосс и тейк-профит не используются — риск контролируется дистанцией между средними, паузой между входами и ограничением по количеству лотов.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `OrderVolume` | 0.1 | Объём одной заявки. Совокупная позиция ограничена произведением `OrderVolume * MaxPositions`. |
| `MaxPositions` | 2 | Максимальное количество лотов (в одном направлении), которое допускается держать одновременно. |
| `MinimumDistance` | 0.0005 | Минимальная ценовая дистанция между соседними средними. Значение подбирается под инструмент (для пары EURUSD с точностью 5 знаков 0.0005 соответствует 5 пунктам). |
| `MinimumPauseSeconds` | 600 | Пауза между новыми входами в секундах. Закрытие позиции таймер не сбрасывает — учитываются только входы. |
| `FirstMaPeriod` | 5 | Период быстрой скользящей средней. Должен быть строго меньше `SecondMaPeriod`. |
| `FirstMaMethod` | Exponential | Тип сглаживания быстрой средней (Simple, Exponential, Smoothed, LinearWeighted). |
| `SecondMaPeriod` | 25 | Период средней скользящей средней. Должен быть строго меньше `ThirdMaPeriod`. |
| `SecondMaMethod` | Exponential | Тип сглаживания средней средней. |
| `ThirdMaPeriod` | 125 | Период медленной скользящей средней. |
| `ThirdMaMethod` | Exponential | Тип сглаживания медленной средней. |
| `CandleType` | Таймфрейм 1 минута | Источник свечных данных для расчётов и сигналов. |

## Особенности реализации

- Использован высокоуровневый API StockSharp: через `SubscribeCandles` получается поток свечей, а `Bind` одновременно подаёт значения на индикаторы и обработчик сигналов.
- Скользящие средние создаются при запуске стратегии в соответствии с выбранными типами. Конфигурация по умолчанию соответствует оригиналу (три экспоненциальные средние по цене закрытия).
- В методе `OnStarted` вызывается `StartProtection()`, чтобы активировать встроенный механизм контроля позиции.
- Переопределён `OnPositionChanged`: при увеличении абсолютной позиции сохраняется время сделки, что позволяет реализовать паузу между входами аналогично версии на MetaTrader.
- Прежде чем открыть новую сделку, стратегия закрывает противоположные позиции, поэтому чистая позиция никогда не меняет знак без перехода через ноль.

## Рекомендации по использованию

1. Подберите значение `MinimumDistance` в соответствии с шагом цены инструмента:
   - EURUSD (5 знаков): `0.0005` соответствует 5 пунктам.
   - USDJPY (3 знака): `0.05` соответствует 5 пунктам.
2. Настройте периоды и типы средних под выбранный таймфрейм и рыночную фазу.
3. На старших таймфреймах увеличьте `MinimumPauseSeconds`, чтобы избежать избыточных сделок; на младших таймфреймах паузу можно уменьшить.
4. Совместно с параметром `OrderVolume` подберите `MaxPositions`, чтобы итоговый размер позиции соответствовал вашему риск-плану.

## Ограничения относительно оригинала

- В MQL-версии можно было выбирать тип цены (open, high, low и т. д.). В данном порте используется цена закрытия, как и в стандартной конфигурации исходного эксперта.
- Стратегия работает в модели чистой позиции: положительное значение `Position` соответствует лонгу, отрицательное — шорту. При достижении лимита `MaxPositions` дополнительные лоты не добавляются до сокращения позиции, что соответствует подсчёту открытых сделок в MetaTrader.

Следуя этим рекомендациям, вы сможете воспроизвести торговую идею BSS в инфраструктуре StockSharp и дополнить её собственными фильтрами или модулями управления рисками.
