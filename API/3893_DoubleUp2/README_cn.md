# DoubleUp2 马丁格尔策略

## 概述
DoubleUp2 马丁格尔策略复刻了原始的 MetaTrader 智能交易系统，通过组合商品通道指数（CCI）和 MACD 振荡器来筛选极端动量。只有当两个指标同时到达同方向的极值时才开仓。仓位规模遵循马丁格尔原则：每次亏损后加倍，赢利后重置。策略还会在价格相对入场价达到设定点数时平仓，以部分锁定收益。

## 工作流程
1. 订阅单一周期（默认 1 分钟）K 线，在每根完成的蜡烛上计算 CCI 与 MACD。
2. 识别极端动量：
   * 当 CCI 与 MACD 同时高于正阈值时做空。
   * 当 CCI 与 MACD 同时低于负阈值时做多。
3. 反向开仓前先平掉当前持仓，根据模拟盈亏更新马丁格尔级别。
4. 交易手数等于账户权益除以余额除数得到的基础手数，再乘以马丁格尔乘数的当前次方。
5. 当价格相对最近入场价移动到指定点数时平仓。与原始 EA 一样，盈利出场会让马丁格尔级别增加 2 步。

## 参数
| 名称 | 描述 | 默认值 |
|------|------|--------|
| `CciPeriod` | CCI 指标的回溯周期。 | 8 |
| `MacdFastPeriod` | MACD 快速 EMA 长度。 | 13 |
| `MacdSlowPeriod` | MACD 慢速 EMA 长度。 | 33 |
| `MacdSignalPeriod` | MACD 信号线 EMA 长度。 | 2 |
| `Threshold` | 触发开仓所需的绝对阈值。 | 230 |
| `ExitDistancePoints` | 盈利平仓的点数距离。 | 120 |
| `BalanceDivisor` | 用于由权益计算基础手数的除数。 | 50001 |
| `MinimumVolume` | 计算得到的最小手数下限。 | 0.1 |
| `MartingaleMultiplier` | 每次亏损后应用的加仓倍数。 | 2 |
| `CandleType` | 指标使用的 K 线周期。 | 1 分钟 |

## 说明
* 马丁格尔逻辑在亏损后放大仓位，在盈利反向时归零，保持与原 MQL 程序一致。
* 当证券提供最小报价步长时，会将点数转换为绝对价格距离；否则使用 1 作为单位步长。
* 策略仅针对单一标的执行，不会同时持有多空仓位。
