# Стратегия DoubleUp2 Martingale

## Описание
DoubleUp2 Martingale — портированная версия эксперта MetaTrader, использующая индикаторы Commodity Channel Index (CCI) и MACD. Сделки открываются только при совпадении экстремальных показаний обоих индикаторов. Объём позиции управляется по принципу мартингейла: после убыточной сделки объём увеличивается, после прибыльной — сбрасывается. Дополнительно стратегия фиксирует прибыль, когда цена проходит заданное количество пунктов от точки входа.

## Логика работы
1. Подписка на один поток свечей (по умолчанию 1 минута) и расчёт CCI и MACD на закрытии каждой свечи.
2. Входы по экстремумам:
   * Открытие короткой позиции, когда CCI и MACD одновременно превышают положительный порог.
   * Открытие длинной позиции, когда оба индикатора опускаются ниже отрицательного порога.
3. Перед разворотом текущая позиция закрывается, а шаг мартингейла обновляется в зависимости от результата последней сделки.
4. Торговый объём = базовый объём (портфель / делитель баланса, но не меньше минимума) × множитель мартингейла в степени текущего шага.
5. Прибыль фиксируется закрытием позиции после прохождения ценой заданного количества пунктов. При таком выходе шаг мартингейла увеличивается на две единицы, как и в оригинальном советнике.

## Параметры
| Имя | Описание | Значение по умолчанию |
|-----|----------|-----------------------|
| `CciPeriod` | Период расчёта CCI. | 8 |
| `MacdFastPeriod` | Быстрый период EMA для MACD. | 13 |
| `MacdSlowPeriod` | Медленный период EMA для MACD. | 33 |
| `MacdSignalPeriod` | Период сигнальной EMA MACD. | 2 |
| `Threshold` | Абсолютный порог для сигналов входа. | 230 |
| `ExitDistancePoints` | Дистанция в пунктах для фиксации прибыли. | 120 |
| `BalanceDivisor` | Делитель капитала для расчёта базового объёма. | 50001 |
| `MinimumVolume` | Минимально допустимый объём сделки. | 0.1 |
| `MartingaleMultiplier` | Множитель объёма после убыточной сделки. | 2 |
| `CandleType` | Таймфрейм свечей для расчётов. | 1 минута |

## Дополнительно
* Логика мартингейла полностью повторяет MQL-реализацию: убытки увеличивают шаг, прибыльные развороты сбрасывают его.
* Для пересчёта пунктов в абсолютную цену используется шаг цены инструмента. При его отсутствии берётся значение 1.
* Стратегия работает с одним инструментом и не открывает разнонаправленных позиций одновременно.
