# Стратегия Check Execution

## Обзор
Стратегия Check Execution воспроизводит логику исходного эксперта MQL, который многократно изменяет брокерскую заявку для оценки качества исполнения. Алгоритм умеет тестировать либо отложенный Buy Stop, либо защитный Sell Stop, который страхует длинную позицию, открытую рыночным ордером. Каждое изменение фиксирует наблюдаемый спред и время, необходимое площадке для подтверждения модификации, что позволяет быстро оценить чувствительность брокера к задержкам.

## Основные шаги
1. Подписка на лучшие цены Bid/Ask через высокоуровневый метод `SubscribeLevel1`.
2. Размещение начальной тестовой заявки в зависимости от выбранного режима:
   - **Pending** – отправить Buy Stop выше текущего Ask.
   - **Market** – купить по рынку и выставить защитный Sell Stop ниже последнего Ask.
3. При каждом обновлении котировки:
   - Обновлять скользящее среднее спреда с помощью индикатора `SimpleMovingAverage`.
   - Перерегистрировать отслеживаемую заявку на новую цену, когда требуется смещение и отсутствует ожидающее подтверждение.
   - Измерять задержку исполнения, когда заявка снова переходит в состояние `Active`, и передавать значение во второй `SimpleMovingAverage`, чтобы получить среднюю задержку в миллисекундах.
4. Повторять цикл модификаций до достижения заданного количества итераций. После этого стратегия отменяет оставшиеся отложенные/стоп-заявки, закрывает тестовую позицию (если она открыта) и выводит сводную статистику по спреду и задержке.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Volume` | Объём торговли для каждой заявки. | `0.01` |
| `Iterations` | Количество попыток модификации (ограничено диапазоном 1–500). | `30` |
| `Order Mode` | Выбор режима работы: `Pending` или `Market`. | `Pending` |
| `Pending Offset` | Смещение в шагах цены выше Ask для тестового Buy Stop. | `100` |
| `Stop Offset` | Смещение в шагах цены ниже Ask для защитного Sell Stop. | `100` |

## Особенности
- Объём заявок нормализуется относительно `VolumeStep`, `MinVolume` и `MaxVolume` инструмента, чтобы исключить отклонённые заявки.
- Смещения переводятся в реальные цены через `PriceStep`. Если шаг цены не задан, используется значение `0.0001`.
- Модификация засчитывается только после того, как площадка переведёт заявку в состояние `Active` или `Done`. Каждое подтверждение обновляет таймер исполнения и счётчик итераций.
- После выполнения заданного числа итераций стратегия прекращает изменения, отменяет защитные заявки, закрывает тестовую позицию и пишет в журнал итоги измерений.

## Отличия от версии на MQL
- Средние значения по спреду и задержке рассчитываются индикаторами `SimpleMovingAverage`, а не вручную через массивы.
- Управление заявками построено на высокоуровневых методах `BuyMarket`, `BuyStop`, `SellStop` и `ReRegisterOrder`, характерных для StockSharp.
- Информационные сообщения выводятся в журнал стратегии вместо графических объектов и комментариев на графике.
