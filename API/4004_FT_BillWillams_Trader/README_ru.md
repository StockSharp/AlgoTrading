# Стратегия FT Bill Williams Trader

## Обзор

**FT Bill Williams Trader Strategy** — это высокоуровневая портированная версия эксперта MetaTrader «FT_BillWillams_Trader». Стратегия объединяет фракталы Билла Вильямса и индикатор Alligator для работы на пробоях тренда. Алгоритм отслеживает появление новых фракталов, проверяет согласованность линий Alligator в сторону пробоя и, при необходимости, накладывает фильтры по расстоянию, выравниванию и обратным сигналам перед открытием позиции.

## Логика торговли

1. **Определение фракталов**. Буфер последних `FractalPeriod` максимумов и минимумов используется для поиска центральной свечи — если она выше (или ниже) остальных, фиксируется новый уровень пробоя. К уровню прибавляется отступ `IndentPoints`, чтобы избежать ложных срабатываний.
2. **Подтверждение пробоя**. Параметр `EntryConfirmation` определяет тип подтверждения:
   - `PriceBreakout` реагирует, когда диапазон свечи пересекает уровень пробоя.
   - `CloseBreakout` дожидается, пока закрытие предыдущей свечи окажется за уровнем.
3. **Проверка расстояния**. Если уровень пробоя находится дальше, чем `MaxDistancePoints` пунктов от линии губ Alligator (значение на предыдущей свече), вход игнорируется. Значение `0` отключает фильтр.
4. **Фильтр зубов**. При включённом `UseTeethFilter` закрытие предыдущей свечи должно быть выше зубов (для покупок) или ниже (для продаж).
5. **Выравнивание тренда**. Если `UseTrendAlignment = true`, линии губ, зубов и челюсти должны быть разнесены минимум на `TeethLipsDistancePoints` и `JawTeethDistancePoints` пунктов, подтверждая трендовую фазу.
6. **Обратные выходы**. При `ReverseExit = OppositeFractal` появление нового противоположного фрактала немедленно закрывает позицию. При `OppositePosition` стратегия сначала закрывает текущую позицию и только затем открывает противоположную.
7. **Выход по челюсти**. Параметр `JawExit` задаёт, закрывать ли позицию при возврате цены к челюсти Alligator (по экстремуму свечи или по закрытию).
8. **Трейлинг-стоп**. Когда `EnableTrailing` включён и позиция прибыльна, стоп двигается к губам или зубам в зависимости от наклона губ относительно SMA с периодом `SlopeSmaPeriod`. Стартовые защитные уровни задаются параметрами `StopLossPoints` и `TakeProfitPoints`.

## Параметры

| Свойство | Описание | По умолчанию |
|----------|----------|--------------|
| `OrderVolume` | Объём позиции при отправке рыночных заявок. | `0.1` |
| `FractalPeriod` | Размер окна для поиска фракталов (желательно нечётное значение). | `5` |
| `IndentPoints` | Отступ от уровня фрактала в пунктах. | `1` |
| `EntryConfirmation` | Тип подтверждения пробоя (`PriceBreakout`, `CloseBreakout`). | `CloseBreakout` |
| `UseTeethFilter` | Требовать закрытие выше/ниже зубов Alligator. | `true` |
| `MaxDistancePoints` | Максимальное расстояние до линии губ (в пунктах). | `1000` |
| `UseTrendAlignment` | Проверять правильный порядок линий Alligator. | `false` |
| `JawTeethDistancePoints` | Минимальный зазор между челюстью и зубами. | `10` |
| `TeethLipsDistancePoints` | Минимальный зазор между зубами и губами. | `10` |
| `JawExit` | Поведение при возврате к челюсти (`Disabled`, `PriceCross`, `CloseCross`). | `CloseCross` |
| `ReverseExit` | Реакция на противоположные сигналы (`Disabled`, `OppositeFractal`, `OppositePosition`). | `OppositePosition` |
| `EnableTrailing` | Включить трейлинг по линиям Alligator. | `true` |
| `SlopeSmaPeriod` | Период SMA, сравниваемой с наклоном губ. | `5` |
| `StopLossPoints` | Дистанция стоп-лосса (0 — без стопа). | `50` |
| `TakeProfitPoints` | Дистанция тейк-профита (0 — без цели). | `50` |
| `JawPeriod`, `TeethPeriod`, `LipsPeriod` | Периоды линий Alligator. | `13`, `8`, `5` |
| `JawShift`, `TeethShift`, `LipsShift` | Смещение каждой линии вперёд. | `8`, `5`, `3` |
| `MaMethod` | Тип скользящей средней (`Simple`, `Exponential`, `Smoothed`, `Weighted`). | `Simple` |
| `AppliedPrice` | Цена свечи, подаваемая на Alligator. | `CandlePrice.Median` |
| `CandleType` | Тип свечей, на которых работает стратегия. | `15 минут` |

## Дополнительная информация

- На график выводятся линии Alligator и собственные сделки стратегии.
- Для корректного определения фрактала параметр `FractalPeriod` должен быть нечётным; значение по умолчанию соответствует исходному советнику.
- Дистанционные параметры (`IndentPoints`, `MaxDistancePoints`, `JawTeethDistancePoints`, `TeethLipsDistancePoints`, `StopLossPoints`, `TakeProfitPoints`) выражены в пунктах (`Security.PriceStep`).
- Управление трейлинг-стопом и выход по челюсти выполняются только по завершённым свечам, как и в оригинальной реализации на MQL4.
