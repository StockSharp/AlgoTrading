# Стратегия Exp XFisher org v1

## Обзор
Стратегия представляет собой перенос советника MetaTrader 5 **Exp_XFisher_org_v1**. Она торгует разворотами, которые обнаруживаются
по показаниям преобразования Фишера, сглаженного выбранным средним. Поведение остаётся контртрендовым: после восходящего импульса
и последующего разворота индикатора открывается длинная позиция, после нисходящего импульса и разворота вверх открывается короткая
позиция. Когда индикатор снова меняет направление, активная позиция закрывается.

Индикатор `XFisherOrgIndicator`, реализованный в файле `CS/ExpXFisherOrgV1Strategy.cs`, полностью повторяет шаги MT5:

1. Для последних `Length` завершённых свечей вычисляются максимумы и минимумы.
2. Выбранный источник цен (см. параметр *Applied Price*) нормализуется в диапазон 0–1 с использованием этих экстремумов.
3. Применяется рекурсивный фильтр `value = (wpr - 0.5) + 0.67 * value[prev]`, затем преобразование Фишера
   `fish = 0.5 * ln((1 + value) / (1 - value)) + 0.5 * fish[prev]`.
4. Полученный ряд сглаживается выбранной средней. Главная линия — это сглаженный Fisher, сигнальная линия — его значение на
   предыдущей свече (как в оригинале, где второй буфер сдвинут на бар назад).

Конверсия сохраняет стандартные настройки (`Length = 7`, сглаживание Jurik длиной 5 и фазой 15, свечи H4) и оставляет отдельные
переключатели для открытия/закрытия длинных и коротких сделок.

## Правила торговли
- **Открытие лонга** — если `SignalBar + 1` свечей назад Fisher рос (`Fisher[SignalBar+1] > Fisher[SignalBar+2]`), а значение на
  `SignalBar` пересекло вниз свою задержанную копию (`Fisher[SignalBar] <= Fisher[SignalBar+1]`).
- **Открытие шорта** — если `SignalBar + 1` свечей назад Fisher падал, а значение на `SignalBar` пересекло вверх задержанную
  копию.
- **Закрытие** — противоположный сигнал закрывает текущую позицию перед рассмотрением нового входа. Условия симметричны для
  длинных и коротких сделок.
- **Объём** — задаётся параметром `OrderVolume`. При смене направления стратегия отправляет одну рыночную заявку с объёмом,
  достаточным для закрытия старой позиции и одновременного открытия новой, что соответствует поведению функций
  `BuyPositionOpen`/`SellPositionOpen` из MT5.

Расчёты выполняются **только на закрытых свечах**. При `SignalBar = 0` используется последняя закрытая свеча; положительные
значения сдвигают чтение буферов назад на указанное число баров.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | -------- | --------------------- |
| `OrderVolume` | Объём каждой рыночной заявки. | `1` |
| `BuyOpenAllowed` / `SellOpenAllowed` | Разрешение на открытие длинных / коротких позиций. | `true` |
| `BuyCloseAllowed` / `SellCloseAllowed` | Разрешение на закрытие длинных / коротких позиций. | `true` |
| `SignalBar` | Сдвиг (в закрытых свечах) для чтения буферов Fisher. | `1` |
| `Length` | Длина поиска максимумов и минимумов. | `7` |
| `SmoothingLength` | Период сглаживающего среднего. | `5` |
| `Phase` | Параметр фазы для Jurik (игнорируется другими методами). | `15` |
| `SmoothingMethod` | Тип среднего, применяемого к Fisher. | `Jjma` |
| `PriceType` | Источник цен (close, open, median и т.д.). | `Close` |
| `CandleType` | Тип свечей для расчёта (по умолчанию H4). | `H4` |

## Сопоставление методов сглаживания
В оригинале доступно много фильтров. В StockSharp они отображены на устойчивые реализации библиотеки:

- `Jjma`, `Jurx`, `T3` → `JurikMovingAverage` (фаза применяется, если свойство доступно).
- `Sma`, `Ema`, `Smma`, `Lwma` → соответствующие скользящие средние StockSharp.
- `Parabolic` → аппроксимация через `ExponentialMovingAverage` (наиболее близкая динамика).
- `Vidya`, `Ama` → `KaufmanAdaptiveMovingAverage`, передающий адаптивное поведение VIDYA/AMA.

Такой маппинг совпадает с другими конверсиями Николая Косицинa в репозитории и обеспечивает сопоставимую форму кривой Fisher.

## Отличия от MT5-версии
- **Управление капиталом** — параметры `MM` и `MarginMode` заменены на один `OrderVolume`, т.к. в StockSharp объёмы задаются
  напрямую.
- **Исполнение** — сигналы рассчитываются на закрытых свечах через высокоуровневую подписку, поэтому отпадает необходимость в
  проверке `IsNewBar` и исключены повторные заявки внутри свечи.
- **Источник цен** — поддержаны все режимы из `SmoothAlgorithms.mqh`, включая TrendFollow и Demark.
- **Визуализация** — на стандартном графике отображаются свечи, сглаженный Fisher и совершённые сделки.

## Состав репозитория
- `CS/ExpXFisherOrgV1Strategy.cs` — класс стратегии, индикатор и контейнер для значений Fisher.

