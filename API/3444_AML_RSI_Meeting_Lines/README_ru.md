# Стратегия AML RSI Meeting Lines

## Обзор
**AML RSI Meeting Lines Strategy** — порт на StockSharp советника MetaTrader 5 `Expert_AML_RSI.mq5`. Исходная система сочетает распознавание японских свечных моделей «Meeting Lines» и индикатор RSI. В процессе конвертации сохранены ключевые торговые правила, а выполнение перенесено на высокоуровневый API StockSharp с подписками на свечи и встроенными индикаторами.

## Логика торговли
- Подписка на выбранный тип свечей и обработка только завершённых баров.
- Расчёт скользящего среднего по размерам тел свечей позволяет определить «длинные» свечи, необходимые для модели Meeting Lines.
- Хранение значений RSI на двух предыдущих свечах обеспечивает подтверждение и выход из позиции.
- **Бычий сигнал**: две свечи формируют модель Meeting Lines, а RSI ниже порогового уровня — открывается длинная позиция.
- **Медвежий сигнал**: зеркальная конфигурация и RSI выше порога — открывается короткая позиция.
- **Выход**: пересечение RSI настроенных уровней 30 и 70 в противоположную сторону закрывает текущую позицию.
- Для сделок используются методы `BuyMarket`, `SellMarket` и `ClosePosition`, что позволяет автоматически переворачиваться при появлении противоположного сигнала.

## Параметры
| Имя | Назначение | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Таймфрейм для анализа свечных моделей. | Часовые свечи |
| `RsiPeriod` | Период расчёта RSI. | 11 |
| `BodyAveragePeriod` | Количество свечей для усреднения тел. | 3 |
| `BullishRsiLevel` | Максимальное значение RSI для подтверждения бычьей модели. | 40 |
| `BearishRsiLevel` | Минимальное значение RSI для подтверждения медвежьей модели. | 60 |
| `LowerExitLevel` | Уровень RSI, при пробое вверх закрывающий шорты. | 30 |
| `UpperExitLevel` | Уровень RSI, при пробое вниз закрывающий лонги. | 70 |

Все параметры реализованы через `StrategyParam<T>` и доступны для оптимизации в дизайнере StockSharp.

## Управление рисками
- В `OnStarted` вызывается `StartProtection()`, что задействует встроенный мониторинг позиций.
- Перед открытием новой сделки стратегия проверяет, не требуется ли закрытие текущей позиции по сигналам RSI.
- Рыночные ордера учитывают текущий объём позиции, чтобы переворот выполнялся одним вызовом.

## Особенности конвертации
- Усреднение тел свечей реализовано индикатором `SimpleMovingAverage`, который получает модуль разницы `Open` и `Close`, аналогично функции `AvgBody` в MQL5.
- Проверка RSI повторяет оригинальные условия `RSI(1)` и `RSI(2)` — используются значения двух предыдущих свечей.
- Комментарии переписаны на английском языке, а код оформлен в соответствии с требованиями репозитория (tab-отступы и file-scoped namespace).

## Как использовать
1. Запустите стратегию на нужном инструменте и выберите соответствующий тип свечей.
2. При необходимости скорректируйте уровни RSI и период усреднения под специфику рынка.
3. Перед реальной торговлей протестируйте стратегию на истории и в симуляции.
4. Для тонкой настройки используйте оптимизацию параметров в Designer или в бэктестере StockSharp.

## Дисклеймер
Стратегия предоставляется исключительно в учебных целях. Перед использованием на реальном счёте необходимо провести всестороннее тестирование.
