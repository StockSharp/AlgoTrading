# Стратегия Easiest RSI (ID 4204)

Конверсия из эксперта MetaTrader 4 **"Easiest RSI"** (`MQL/9827/Easiest_RSI.mq4`).

## Обзор

Исходный советник открывает сделки, когда RSI выходит из зон перепроданности/перекупленности, и может добавить до двух дополнительных ордеров по мере движения цены в прибыльную сторону. Все ордера имеют одинаковый объём, фиксированный стоп-лосс и подтягиваемый трейлинг-стоп с небольшим шагом.

В портированной версии для StockSharp сохранены ключевые элементы:

- RSI(14), рассчитанный на выбранных свечах, остаётся главным сигналом.
- Лонг открывается при пробое уровня перепроданности снизу вверх, шорт — при пробое уровня перекупленности сверху вниз.
- Добавление позиций реализовано через `StepPips`: каждый раз, когда цена проходит указанное количество пунктов в прибыльном направлении, отправляется новая заявка объёмом `LotSize`, но общее число входов ограничено `MaxEntries`.
- Стоп-лоссы и трейлинг рассчитываются в пунктах с автоматической корректировкой под 4/5-значные котировки.
- Внутреннее состояние (значения RSI, цены последнего входа, уровни стопов) хранится в простых полях, как требует гайд.

## Параметры

| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `LotSize` | `1` | Объём каждого рыночного ордера. |
| `StopLossPips` | `50` | Начальный стоп-лосс в пунктах (0 отключает). |
| `TrailingStopPips` | `50` | Дистанция трейлинг-стопа в пунктах (0 отключает). |
| `StepPips` | `20` | Минимальный прогресс цены для добавления ордера. |
| `RsiPeriod` | `14` | Период RSI. |
| `OversoldLevel` | `30` | Граница перепроданности для входа в лонг. |
| `OverboughtLevel` | `70` | Граница перекупленности для входа в шорт. |
| `MaxEntries` | `3` | Максимальное число последовательных входов в одном направлении (как в MT4). |
| `CandleType` | `TimeFrame(5m)` | Тип/таймфрейм свечей для расчёта RSI. |

Параметры, заданные в пунктах, переводятся в абсолютные цены через `Security.Step`. Для 5-значных форекс-котировок шаг автоматически умножается на 10, поэтому, например, `50` по-прежнему соответствует 5.0 пунктам — так же, как советовал автор оригинала.

## Торговые правила

1. **Отбор сигналов.** Обрабатываются только закрывшиеся свечи. Стратегия хранит два последних значения RSI, повторяя вызовы `iRSI(...,1)` и `iRSI(...,2)` из MT4. Сигнал появляется, когда индикатор пересекает порог.
2. **Первичный вход.** При отсутствии позиции бычий пробой открывает покупку, медвежий — продажу.
3. **Усреднение по тренду.** Пока позиция открыта, сравниваются последняя цена закрытия/максимум (для лонга) или закрытия/минимум (для шорта) с ценой последнего входа. При движении не менее чем на `StepPips` и если количество ордеров меньше `MaxEntries`, размещается ещё один рыночный ордер тем же объёмом.
4. **Стоп-лосс.** После каждого исполнения пересчитывается общий уровень стопа: цена позиции минус/плюс `StopLossPips`. Хранится наиболее «дальний» уровень, чтобы вся корзина оставалась защищённой.
5. **Трейлинг.** Когда позиция уходит в прибыль, стоп подтягивается к максимуму (для лонга) или минимуму (для шорта) текущей свечи. Дополнительный зазор в пять минимальных шагов имитирует условие `OrderStopLoss() + 5*Point` из MT4.
6. **Выход.** При достижении управляемого стопа позиция закрывается рыночной заявкой. Отдельного тейк-профита нет — используется только трейлинг.

## Особенности реализации

- Используется высокоуровневый API: подписка на свечи через `SubscribeCandles().Bind(...)`, отправка сделок через `BuyMarket`/`SellMarket`.
- Флаги `_longOrderPending` / `_shortOrderPending` и признаки выхода предотвращают повторные заявки, пока предыдущий ордер ещё исполняется.
- Метод `StartProtection()` не вызывается, поскольку защита реализована вручную для точного соответствия MQL-логике.
- Из-за неттингового учёта в StockSharp трейлинг применяется к суммарной позиции. Поэтому при нескольких входах вся серия закроется одновременно при срабатывании общего стопа. В оригинале стопы двигались отдельно для каждого ордера — это отличие явно описано.

## Рекомендации по использованию

1. Назначьте инструмент и подключение, затем установите `CandleType` на нужный таймфрейм (например, 5 минут по EURUSD, как в исходном коде).
2. Настройте параметры в пунктах под волатильность инструмента. Для пятого знака можно умножить значения на 10, чтобы воспроизвести рекомендации автора.
3. Изменяя `MaxEntries` и `StepPips`, можно управлять частотой и агрессивностью добавления позиций.
4. Перед запуском на реальном счёте протестируйте стратегию на истории или демо, чтобы убедиться в корректности пересчёта пунктов и работы трейлинга.

## Файлы

- `CS/EasiestRsiStrategy.cs` — реализация стратегии.
- `README.md` — описание на английском.
- `README_cn.md` — описание на китайском.
- `README_ru.md` — текущий файл.

Версия на Python не создавалась по требованию.
