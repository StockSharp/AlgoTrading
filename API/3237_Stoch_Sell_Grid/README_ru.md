# Стратегия Stoch Sell

## Общее описание
Стратегия повторяет логику советника **stochSell** для MetaTrader. Она анализирует один поток свечей, ожидает тройного подтверждения по стохастикам и фильтра по волатильности, после чего открывает короткую позицию по рынку и выставляет сетку отложенных sell stop заявок для наращивания позиции при дальнейшем падении цены.

## Логика входа
- **Фильтр волатильности** — ATR с настраиваемым периодом должен находиться ниже заданного порога.
- **Подтверждение медленного стохастика** — самый длинный стохастик должен оставаться ниже уровня долгосрочной перепроданности.
- **Подтверждение пересечения** — средний и быстрый стохастики должны на одной и той же закрытой свече пробить уровень перепроданности сверху вниз.
- **Контроль позиции** — сделка открывается только при отсутствии открытых позиций и активных заявок.

При выполнении условий стратегия продаёт указанный объём по рынку и тут же размещает сетку sell stop ордеров согласно настройкам сетки. Чтобы отключить усреднение, достаточно установить число ордеров сетки равным нулю.

## Логика выхода
- **Цель по прибыли** — когда совокупная короткая позиция даёт запланированное количество пунктов (рассчитывается от средневзвешенной цены входа), стратегия закрывает весь объём покупкой и удаляет все оставшиеся заявки.
- **Истечение ордеров** — для каждой заявки сетки задаётся срок жизни; по истечении времени неисполнённые ордера отменяются.
- **Полный выход** — любая покупка, приводящая позицию к нулю, сбрасывает внутреннюю статистику входа и очищает сетку.

## Управление сеткой
- Цены ордеров вычисляются как стартовая цена плюс смещение и шаг, заданные в пунктах.
- Каждый ордер использует собственный коэффициент объёма, что позволяет отличать сетку от начального объёма.
- Тайм-аут сетки задаётся в минутах; ноль означает бессрочные ордера.

## Параметры
| Параметр | Значение |
| --- | --- |
| `CandleType` | Таймфрейм, на основе которого строятся индикаторы и принимаются решения. |
| `AtrPeriod` / `AtrThreshold` | Период и порог ATR для фильтрации волатильности. |
| `FastKPeriod`, `FastDPeriod`, `FastSlowing` | Настройки быстрого стохастика. |
| `MediumKPeriod`, `MediumDPeriod`, `MediumSlowing` | Настройки среднего стохастика. |
| `SlowKPeriod`, `SlowDPeriod`, `SlowSlowing` | Настройки медленного стохастика. |
| `OversoldLevel` | Уровень, через который должны пробить быстрый и средний стохастики. |
| `LongTermOversoldLevel` | Максимально допустимое значение медленного стохастика при входе. |
| `ProfitTargetPips` | Цель по прибыли в пунктах для закрытия корзины. |
| `GridOrdersCount` | Количество отложенных sell stop ордеров после входа. |
| `GridStartOffsetPips` | Смещение первой заявки относительно текущей цены в пунктах. |
| `GridStepPips` | Расстояние между заявками сетки. |
| `GridVolume` | Объём каждой заявки сетки. |
| `GridExpirationMinutes` | Время жизни отложенных ордеров сетки (минуты). |
| `MarketVolume` | Объём начальной рыночной продажи. |

## Примечания
- Индикаторы подключаются через высокоуровневый метод `BindEx`; торговые решения принимаются только на закрытых свечах.
- Для перевода целевой прибыли из пунктов в цену используется средневзвешенная цена входа, которая пересчитывается после каждого исполнения.
- Чтобы оставаться в формате одиночных сделок, установите число ордеров сетки в ноль — при этом фильтрация по ATR и стохастикам сохранится.
