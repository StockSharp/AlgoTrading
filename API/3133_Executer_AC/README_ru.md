# Стратегия Executer AC

**Executer AC** — точный порт оригинального советника MetaTrader 5, использующего индикатор Билла Вильямса *Accelerator Oscillator (AC)*. Реализация на StockSharp полностью повторяет структуру сигналов MQL5-версии и добавляет удобные параметры для управления риском и визуализации на графике.

## Логика работы

Стратегия обрабатывает только закрытые свечи выбранного таймфрейма и анализирует четыре последних значения AC:

- `AC[0]` — значение на только что закрывшейся свече (в исходном коде это `ac[1]`).
- `AC[1]`, `AC[2]`, `AC[3]` — более старые значения, используемые для определения последовательности столбиков.

Последовательность действий полностью соответствует MQL5-советнику:

1. **Управление открытой позицией**
   - Длинная позиция закрывается, если `AC[0] < AC[1]` (ускорение снижается).
   - Короткая позиция закрывается, если `AC[0] > AC[1]` (ускорение растёт).
   - Активируется трейлинг-стоп, который подтягивает защитный стоп после прохождения `TrailingStop + TrailingStep` пунктов прибыли.
2. **Поиск входа при отсутствии позиции**
   - **Рост выше нулевой линии:** при `AC[0] > 0`, `AC[1] > 0` и `AC[0] > AC[1] > AC[2]` открывается покупка.
   - **Падение выше нулевой линии:** при `AC[0] > 0`, `AC[1] > 0` и `AC[0] < AC[1] < AC[2] < AC[3]` открывается продажа.
   - **Рост ниже нулевой линии:** при `AC[0] < 0`, `AC[1] < 0` и `AC[0] > AC[1] > AC[2] > AC[3]` открывается покупка.
   - **Падение ниже нулевой линии:** при `AC[0] < 0`, `AC[1] < 0` и `AC[0] < AC[1] < AC[2]` открывается продажа.
   - **Пересечения нуля:** переход сверху вниз (`AC[0] > 0`, `AC[1] < 0`) приводит к покупке, переход снизу вверх (`AC[0] < 0`, `AC[1] > 0`) — к продаже.

Все проверки выполняются только после подтверждения, что индикатор сформирован и торговля разрешена.

## Управление рисками

- **Стоп-лосс и тейк-профит** задаются в пунктах и автоматически переводятся в ценовые единицы с учётом шага цены инструмента. Нулевое значение отключает уровень.
- **Трейлинг-стоп** реализован аналогично оригиналу: после прохождения прибыли, превышающей сумму `TrailingStop` и `TrailingStep`, стоп переносится к текущей цене на расстояние `TrailingStop` (для покупок вниз, для продаж вверх) и требует дальнейшего улучшения не меньше шага `TrailingStep`.
- **Защита позиции**: метод `StartProtection()` активирует штатные механизмы StockSharp для контроля разрыва соединения.

## Настраиваемые параметры

| Параметр | Описание |
|----------|----------|
| `TradeVolume` | Объём сделки. Приводится к допустимому шагу и ограничениям инструмента. |
| `StopLossPips` | Дистанция стоп-лосса в пунктах. `0` — стоп отключён. |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах. `0` — цель отключена. |
| `TrailingStopPips` | Базовая дистанция трейлинг-стопа в пунктах. |
| `TrailingStepPips` | Минимальное дополнительное движение в пунктах перед следующим подтягиванием трейлинга. |
| `CandleType` | Таймфрейм свечей, на которых рассчитывается индикатор AC. |

## Особенности реализации

- Для трёх- и пятизнаковых форекс-инструментов размер пункта корректируется (шаг цены умножается на 10), как и в MetaTrader.
- История AC хранится в массиве фиксированного размера, что позволяет точно повторить сравнения `ac[1]…ac[4]` без запросов к истории сделок или свечей.
- После закрытия позиции обработчик немедленно выходит, поэтому на той же свече не выполняются новые входы — как и в исходном советнике.
- Перемещение трейлинг-стопа одновременно обновляет внутреннее состояние и фактический уровень стоп-лосса, имитируя вызов `PositionModify`.

## Рекомендации по применению

1. Выбирайте таймфрейм, соответствующий рабочему стилю (изначально стратегия применялась на внутридневных графиках Forex).
2. Подбирайте параметры стопов и трейлинга под волатильность инструмента: слишком малые значения приведут к частым выбиваниям.
3. Сочетайте стратегию с внешними ограничениями риска (например, брокерскими стопами или контролем по счёту).
4. При одновременном запуске нескольких стратегий учитывайте совокупную загрузку депозита и лимиты по инструменту.
