# Стратегия Two MA Other TimeFrame Correct Intersection

## Обзор
Эта стратегия представляет собой порт MetaTrader 5 советника «Two MA Other TimeFrame Correct Intersection» на платформу StockSharp. В оригинале используются две скользящие средние, каждая из которых рассчитывается на собственном таймфрейме (например, H1 и D1), а торговые решения принимаются на таймфрейме графика. Конверсия полностью сохраняет мульти-таймфреймовую логику: длинные позиции открываются при пересечении быстрой средней выше медленной, короткие — когда быстрая опускается ниже медленной. Все сделки исполняются рыночными ордерами, перед открытием новой позиции стратегия закрывает противоположную, что соответствует работе торгового движка MQL5.

## Торговая логика
- Подписка на три потока свечей: основной торговый таймфрейм, таймфрейм быстрой средней и таймфрейм медленной средней.
- Расчет быстрой и медленной скользящих средних на их собственных таймфреймах. Доступны те же методы сглаживания и источники цены, что и в исходном индикаторе `iCustom`.
- При необходимости к значениям индикаторов применяется горизонтальный сдвиг, полностью повторяющий параметр `ma_shift` оригинального эксперта.
- После закрытия каждой свечи основного таймфрейма проверяется факт пересечения между текущими и предыдущими значениями скользящих средних:
  - Если ранее быстрая средняя была ниже медленной, а теперь стала выше, закрываются шорты и открывается (или разворачивается в) длинная позиция.
  - Если ранее быстрая средняя была выше медленной, а теперь оказалась ниже, закрываются лонги и открывается (или разворачивается в) короткая позиция.
- Все ордера используют заданный объем. При развороте позиции стратегия увеличивает размер заявки на величину противоположной позиции, чтобы переворот произошёл одним рыночным ордером.

## Параметры
| Параметр | Описание |
|----------|----------|
| `TradeVolume` | Базовый объем рыночных сделок для длинных и коротких входов. |
| `CandleType` | Основной торговый таймфрейм. Сигналы оцениваются при закрытии свечи этого типа. |
| `FastTimeFrame` | Таймфрейм, на котором считается быстрая скользящая средняя. |
| `SlowTimeFrame` | Таймфрейм, на котором считается медленная скользящая средняя. |
| `FastLength` | Количество свечей в расчете быстрой средней. |
| `SlowLength` | Количество свечей в расчете медленной средней. |
| `FastShift` | Горизонтальный сдвиг значения быстрой средней перед сравнением. |
| `SlowShift` | Горизонтальный сдвиг значения медленной средней перед сравнением. |
| `FastMethod` | Метод сглаживания быстрой средней (простая, экспоненциальная, сглаженная, линейно-взвешенная). |
| `SlowMethod` | Метод сглаживания медленной средней. |
| `FastAppliedPrice` | Цена свечи, используемая в быстрой средней (open, high, low, close, median, typical, weighted). |
| `SlowAppliedPrice` | Цена свечи, используемая в медленной средней. |

## Особенности реализации
- Скользящие средние рассчитываются через высокоуровневые подписки StockSharp (`SubscribeCandles().Bind(...)`) и продолжают работу, даже если их таймфрейм отличается от торгового.
- Параметры сдвига реализованы с помощью небольших очередей, которые задерживают выход индикатора на заданное число баров, полностью повторяя поведение `ma_shift`.
- В `OnStarted` вызывается `StartProtection()`, что обеспечивает базовую защиту позиции, аналогичную защитным блокам оригинального движка.
- В режиме бэктеста на график выводятся свечи основного таймфрейма и обе скользящие средние, что упрощает визуальный контроль пересечений.
- В исходном советнике отсутствуют стоп-лосс, тейк-профит или трейлинг-стоп; при необходимости риск-менеджмент можно добавить отдельными модулями StockSharp.
