# Стратегия StellarLite ICT EA

## Обзор
StellarLite ICT EA переносит правила проп-фирменной стратегии "Stellar Lite" на платформу StockSharp. Алгоритм объединяет два шаблона Inner Circle Trader (ICT) — Silver Bullet и модель 2022 года — и повторяет частичное фиксирование прибыли, перемещение стопа в безубыток и трейлинг-стоп, присутствующие в оригинальном советнике MetaTrader.

## Основной алгоритм
1. **Определение направления по старшему таймфрейму.** Скользящая средняя на выбранном старшем таймфрейме должна наклоняться в сторону сделки, а цена закрытия — находиться по соответствующую сторону от средней. Только после этого анализируется младший таймфрейм.
2. **Подтверждение выброса ликвидности.** В заданном окне просматриваются максимумы и минимумы. Для Silver Bullet требуется выбивание ликвидности в сторону сделки, для модели 2022 — предварительный ложный выброс в противоположную сторону.
3. **Смена структуры (MSS).** Три последние завершённые свечи должны подтвердить пробой структуры: для покупок текущая свеча закрывается выше предыдущего максимума, для продаж — ниже предыдущего минимума.
4. **Поиск fair value gap (FVG).** Анализируются последние десять свечей на наличие разрывов, сформированных импульсными барами. Вход возможен только если текущая цена закрытия находится внутри найденного разрыва.
5. **Фильтр NDOG/NWOG.** Диапазон текущей свечи обязан быть меньше `AtrThreshold × ATR`, что указывает на сжатие волатильности.
6. **Расчёт входа, стопа и целей.** Точка входа располагается в середине разрыва либо по уровню OTE (Optimal Trade Entry) в соответствии с параметром Фибо. Защитный стоп устанавливается за локальной ликвидностью, три цели вычисляются по заданным коэффициентам риск/прибыль.
7. **Управление позицией.** Объём рассчитывается исходя из процента риска или использует параметр `Volume`. При достижении TP1, TP2 и TP3 закрывается 50%, 25% и 25% позиции, после TP1 стоп переносится в безубыток (с учётом смещения), после TP2 активируется трейлинг-стоп, остаток закрывается на TP3 или при срабатывании стопа.

## Параметры
- **Entry Candle (`CandleType`)** — таймфрейм для сигналов.
- **Higher Timeframe (`HigherTimeframeType`)** — таймфрейм для определения направления.
- **Higher MA Period (`HigherMaPeriod`)** — период скользящей средней на старшем таймфрейме.
- **ATR Period (`AtrPeriod`)** — длина ATR для фильтра волатильности.
- **Liquidity Lookback (`LiquidityLookback`)** — глубина поиска ликвидности.
- **ATR Threshold (`AtrThreshold`)** — максимально допустимый диапазон свечи относительно ATR.
- **TP1/TP2/TP3 Risk Reward (`Tp1Ratio`, `Tp2Ratio`, `Tp3Ratio`)** — коэффициенты риск/прибыль для целей.
- **TP1/TP2/TP3 Close % (`Tp1Percent`, `Tp2Percent`, `Tp3Percent`)** — доли позиции, закрываемые на целях.
- **Break Even After TP1 (`MoveToBreakEven`)** — переносить ли стоп в безубыток после TP1.
- **Break Even Offset (`BreakEvenOffset`)** — добавочный шаг цены при переносе стопа.
- **Trailing Distance (`TrailingDistance`)** — расстояние трейлинг-стопа после TP2.
- **Use Silver Bullet / Use 2022 Model (`UseSilverBullet`, `Use2022Model`)** — включение конкретных шаблонов.
- **Use OTE Entry (`UseOteEntry`)** — использовать ли зону OTE для входа.
- **Risk % (`RiskPercent`)** — процент риска от капитала.
- **OTE Lower (`OteLowerLevel`)** — коэффициент Фибо для нижней границы OTE.

## Практические рекомендации
- Стратегия работает только по завершённым свечам; необходимо, чтобы поставщик данных передавал шаг цены и шаг объёма.
- Если сведения о стоимости шага или размере портфеля недоступны, позиция определяется параметром `Volume`.
- Логика ликвидности и MSS использует буфер последних 20 свечей, поэтому после запуска требуется накопить историю.
- Частичное закрытие учитывает минимальный шаг объёма. Если рассчитанный объём меньше шага, частичное закрытие пропускается.
- Трейлинг-стоп смещается только в сторону уменьшения риска и никогда не расширяет его.

## Файлы
- `CS/StellarLiteIctEaStrategy.cs` — реализация стратегии на C#.
- `README.md` — документация на английском языке.
- `README_cn.md` — документация на китайском языке.
- `README_ru.md` — документация на русском языке.
