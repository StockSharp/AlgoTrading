# Стратегия The MasterMind Reversal (порт StockSharp)

## Общее описание
- Перенос советника MetaTrader 4 "TheMasterMind", сочетающего стохастик и индекс Williams %R для поиска разворотов.
- Используется высокоуровневый API StockSharp: подписка на свечи, привязка индикаторов через `BindEx`, обработка только закрытых баров.
- Одновременно удерживается только одна позиция: при появлении противоположного сигнала текущая позиция закрывается и открывается новая в обратном направлении.

## Логика торговли
1. **Подготовка индикаторов**
   - `StochasticOscillator` выдаёт сигнальную линию %D с настраиваемой сглаживающей длиной %K и %D.
   - `WilliamsR` измеряет положение цены закрытия внутри диапазона последних максимумов/минимумов.
2. **Условия входа**
   - **Покупка**: `%D <= 3` и `Williams %R <= -99.5` — экстремальное перепроданное состояние.
   - **Продажа**: `%D >= 97` и `Williams %R >= -0.5` — экстремальное перекупленное состояние.
   - Если открыта позиция противоположного направления, она закрывается рыночным ордером, затем открывается новая позиция базовым объёмом.
3. **Условия выхода**
   - Противоположный сигнал одновременно закрывает текущую позицию и переворачивает стратегию.
   - Защитные приказы (стоп-лосс, тейк-профит и трейлинг) запускаются однократно через `StartProtection`, когда заданы соответствующие параметры.

## Управление рисками
- Параметры `StopLoss`, `TakeProfit`, `UseTrailingStop`, `TrailingStop`, `TrailingStep` повторяют логику оригинального советника.
- Расстояния задаются в абсолютных ценовых единицах, поэтому стратегия универсальна для разных инструментов; значение `0` отключает конкретный фильтр.
- Если задан хотя бы один защитный параметр, `StartProtection` активируется автоматически при запуске.

## Параметры стратегии
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `TradeVolume` | Базовый объём (в лотах) для новой позиции. | `1` |
| `StochasticPeriod` | Общий период расчёта стохастика. | `100` |
| `KPeriod` | Длина сглаживания %K. | `3` |
| `DPeriod` | Длина сигнальной линии %D. | `3` |
| `WilliamsPeriod` | Период индикатора Williams %R. | `100` |
| `StochasticBuyThreshold` | Порог %D для открытия длинных позиций. | `3` |
| `StochasticSellThreshold` | Порог %D для открытия коротких позиций. | `97` |
| `WilliamsBuyLevel` | Уровень перепроданности Williams %R. | `-99.5` |
| `WilliamsSellLevel` | Уровень перекупленности Williams %R. | `-0.5` |
| `StopLoss` | Расстояние до стоп-лосса. | `0` |
| `TakeProfit` | Расстояние до тейк-профита. | `0` |
| `UseTrailingStop` | Включение трейлинг-стопа. | `false` |
| `TrailingStop` | Расстояние трейлинг-стопа. | `0` |
| `TrailingStep` | Шаг подтягивания стопа. | `0` |
| `CandleType` | Таймфрейм основной свечной подписки (по умолчанию 15 минут). | `15 минут` |

## Особенности реализации
- Для торговых решений используются только закрытые свечи и состояние `IsFormedAndOnlineAndAllowTrading()`.
- Привязка `BindEx` позволяет работать с `StochasticOscillatorValue` и значением Williams %R без прямого обращения к историческим данным.
- При наличии графического сервиса стратегия выводит на график свечи, оба индикатора и сделки (`DrawCandles`, `DrawIndicator`, `DrawOwnTrades`).
- Журнал `LogInfo` повторяет смысл оригинальных оповещений и помогает отслеживать работу алгоритма в тестах и на реальном счёте.
