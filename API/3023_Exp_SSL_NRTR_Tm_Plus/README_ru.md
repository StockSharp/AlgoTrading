# Стратегия Exp SSL NRTR Tm Plus

## Обзор

Стратегия воспроизводит работу советника MetaTrader "Exp_SSL_NRTR_Tm_Plus" в инфраструктуре StockSharp. Используется одна
таймфреймная подписка, рассчитывается канал SSL NRTR с настраиваемым методом сглаживания, и торговые решения принимаются по
смене его цвета. Лонг открывается при переходе канала в бычье состояние, шорт — при медвежьем сигнале. Сохраняются исходные
фильтры, стоп-параметры и таймер принудительного выхода.

## Параметры

| Группа | Параметр | Описание |
| --- | --- | --- |
| Trading | Money Management | Доля капитала (или прямой размер позиции при отрицательном значении/режиме `Lot`). |
| Trading | Margin Mode | Способ преобразования значения Money Management в объём заявки. Режимы отличные от `Lot` приближённо рассчитываются по стоимости портфеля. |
| Trading | Allow Long/Short Entries | Разрешение на открытие позиций в соответствующем направлении. |
| Trading | Allow Long/Short Exits | Разрешение на закрытие позиций по сигналу в соответствующем направлении. |
| Risk | Stop Loss | Дистанция стоп-лосса в ценовых шагах (контролируется внутри стратегии). |
| Risk | Take Profit | Дистанция тейк-профита в ценовых шагах. |
| Risk | Slippage | Информационный параметр из оригинального советника. |
| Risk | Use Time Exit | Включить таймер принудительного закрытия позиции. |
| Risk | Exit Minutes | Время удержания позиции в минутах. |
| Data | Candle Type | Рабочий таймфрейм для расчётов и торговли. |
| Indicator | Smoothing Method | Метод сглаживания SSL NRTR. Неподдерживаемые методы автоматически заменяются на EMA. |
| Indicator | Length | Базовый период сглаживания. |
| Indicator | Phase | Вспомогательный параметр адаптивных усреднений (T3, VIDYA, AMA). |
| Indicator | Signal Bar | Количество закрытых баров для анализа сигнала. |

## Логика торговли

1. Подписка на свечи выбранного таймфрейма и обработка только закрытых баров.
2. Расчёт скользящих средних SSL NRTR и определение текущего цвета канала.
3. При смене цвета на бычий (`0`) — опциональное закрытие шорта и открытие лонга при разрешении.
4. При смене цвета на медвежий (`2`) — опциональное закрытие лонга и открытие шорта при разрешении.
5. Контроль стоп-лосса/тейк-профита относительно цены входа и закрытие позиции при достижении уровней.
6. При включенном таймере позиция закрывается по истечении `Exit Minutes`.
7. Защита от повторных входов на одной свече с помощью «временного уровня», как в оригинальном советнике.

## Управление капиталом

- Режим `Lot` трактует Money Management как прямой размер позиции в лотах/контрактах.
- `FreeMargin` и `Balance` приближённо делят выделенную сумму на текущую цену инструмента.
- `LossFreeMargin` и `LossBalance` рассчитывают объём исходя из допустимого убытка по стоп-лоссу.
- Отрицательные значения Money Management всегда конвертируются в абсолютный размер позиции.

## Примечания

- Реализованы только методы сглаживания, доступные в StockSharp. Для `Jurx` и `Parma` используется замена на экспоненциальное усреднение (указано в комментариях к коду).
- Стоп-лосс и тейк-профит контролируются внутри стратегии, что обеспечивает независимость от типа подключения.
- Параметр Slippage носит исключительно информационный характер — заявки отправляются как рыночные.
- На графике по умолчанию отображаются свечи и собственные сделки.
