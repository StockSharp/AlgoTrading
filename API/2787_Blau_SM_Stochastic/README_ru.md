# Стратегия Blau SM Stochastic
[English](README.md) | [中文](README_cn.md)

## Обзор
Стратегия представляет собой перенос советника MetaTrader 5 `Exp_BlauSMStochastic` на C#. В основе лежит осциллятор Blau SM Stochastic, измеряющий расстояние цены от недавнего торгового диапазона. Значение проходит несколько ступеней сглаживания и сравнивается с дополнительно сглаженной опорной линией. Расчёты выполняются по закрытым свечам (по умолчанию таймфрейм 4 часа) и позволяют торговать в обе стороны.

## Логика индикатора
1. Рассчитываются максимум и минимум за последние `LookbackLength` баров.
2. Формируется детрендированный ряд: `sm = price - (HH + LL) / 2`, где `price` — выбранный тип цены.
3. Ряд `sm` последовательно сглаживается тремя средними с периодами `FirstSmoothingLength`, `SecondSmoothingLength`, `ThirdSmoothingLength` и типом `SmoothMethod` (SMA, EMA, SMMA или LWMA).
4. Половина диапазона `(HH - LL) / 2` проходит через те же три этапа сглаживания для нормализации волатильности.
5. Основная линия осциллятора вычисляется как `100 * smoothed(sm) / smoothed(range)`.
6. Основная линия дополнительно сглаживается периодом `SignalLength`, образуя сигнальную линию.

Параметр `Phase` сохранён для совместимости с MQL-версией, но в упрощённой реализации сглаживания не используется.

## Торговые режимы
- **Breakdown** – отслеживает пересечения основной линии через ноль. Переход из положительной области в неположительную открывает покупку и закрывает продажи. Обратное пересечение открывает продажу и закрывает покупки.
- **Twist** – ловит развороты наклона. Локальный минимум основной линии (значение растёт после падения) формирует сигнал на покупку; локальный максимум (значение падает после роста) даёт сигнал на продажу. Позиции противоположного направления закрываются.
- **CloudTwist** – анализирует пересечения основной линии и сигнальной. Пересечение основной линии сверху вниз через сигнальную открывает покупку и закрывает продажи. Пересечение снизу вверх открывает продажу и закрывает покупки.

Флаги `EnableLongEntry`, `EnableShortEntry`, `EnableLongExit`, `EnableShortExit` позволяют отключать отдельные действия без остановки расчётов индикатора.

## Управление рисками
`TakeProfitPoints` и `StopLossPoints` переводятся в абсолютное расстояние по цене с учётом шага цены инструмента и передаются в `StartProtection`. Значение 0 отключает соответствующий лимит.

## Параметры
- `CandleType` *(DataType, по умолчанию 4 часа)* – таймфрейм свечей и расчёта индикатора.
- `Mode` *(BlauSmStochasticModes, по умолчанию Twist)* – режим генерации сигналов (Breakdown, Twist, CloudTwist).
- `SignalBar` *(int, по умолчанию 1)* – сдвиг по барам при анализе значений индикатора, соответствует параметру `SignalBar` в оригинале.
- `LookbackLength` *(int, по умолчанию 5)* – количество баров для поиска максимумов и минимумов.
- `FirstSmoothingLength` *(int, по умолчанию 20)* – период первого сглаживания.
- `SecondSmoothingLength` *(int, по умолчанию 5)* – период второго сглаживания.
- `ThirdSmoothingLength` *(int, по умолчанию 3)* – период третьего сглаживания.
- `SignalLength` *(int, по умолчанию 3)* – период сглаживания сигнальной линии.
- `SmoothMethod` *(BlauSmSmoothMethods, по умолчанию EMA)* – тип скользящих средних для всех этапов (SMA, EMA, SMMA, LWMA).
- `PriceType` *(BlauSmAppliedPrices, по умолчанию Close)* – тип цены для расчётов (close, open, high, low, median, typical, weighted, simple, quarter, два варианта trend-follow и Demark).
- `EnableLongEntry` *(bool, по умолчанию true)* – разрешить открытие длинных позиций.
- `EnableShortEntry` *(bool, по умолчанию true)* – разрешить открытие коротких позиций.
- `EnableLongExit` *(bool, по умолчанию true)* – разрешить закрытие длинных позиций.
- `EnableShortExit` *(bool, по умолчанию true)* – разрешить закрытие коротких позиций.
- `TakeProfitPoints` *(int, по умолчанию 2000)* – дистанция тейк-профита в пунктах инструмента.
- `StopLossPoints` *(int, по умолчанию 1000)* – дистанция стоп-лосса в пунктах инструмента.

## Примечания
- Доступны только классические типы скользящих средних (SMA, EMA, SMMA, LWMA). Экзотические методы из MQL-библиотеки (JMA, JurX и др.) отсутствуют в StockSharp.
- Параметр `Phase` оставлен для полноты, изменение носит справочный характер.
- Стратегия применима к любым инструментам, поддерживаемым StockSharp. Рекомендуется подбирать таймфрейм, длины сглаживания и защитные уровни под волатильность актива.
