# Стратегия Trading Criteria

## Описание

Trading Criteria Strategy — это порт оригинального советника MQL4 «Trading Criteria» на инфраструктуру StockSharp. Стратегия сочетает линейно-взвешенные скользящие средние, фильтр по отклонению Momentum и подтверждение тренда по MACD на двух таймфреймах (рабочем и медленном). Блок управления риском включает трейлинг-стоп, перевод в безубыток и настраиваемые уровни стоп-лосса и тейк-профита.

## Условия входа

1. **Базовый таймфрейм** — быстрые и медленные LWMA. Для покупок требуется, чтобы быстрая средняя находилась выше медленной, для продаж — наоборот.
2. **Фильтр Momentum** — рассчитывает отклонение |Momentum-100| на трендовом таймфрейме и проверяет три последних значения относительно порогов для покупки/продажи.
3. **MACD трендового таймфрейма** — сравнивает основную линию и сигнал. Новые сделки разрешены только при соответствии текущего и предыдущего соотношений, что уменьшает количество ложных переворотов.
4. **MACD медленного таймфрейма** — подтверждает глобальное направление (по умолчанию используется месячный период, но параметр можно изменить).
5. **Контроль объёма** — общий объём позиции ограничивается `MaxPositions * Volume`. При появлении сигнала в противоположную сторону стратегия сначала закрывает старую позицию, если она есть.

## Выход и защита позиции

- **Стоп-лосс и тейк-профит** задаются параметрами `StopLossPoints` и `TakeProfitPoints` и переводятся в абсолютные цены с учётом шага цены инструмента.
- **Трейлинг-стоп** активируется параметрами `EnableTrailing` и `TrailingStopPoints`. Для лонгов стоп подтягивается к максимуму, для шортов — к минимуму.
- **Перевод в безубыток** (`EnableBreakEven`) переносит стоп к цене входа (с учётом `BreakEvenOffsetPoints`), когда цена проходит расстояние `BreakEvenTriggerPoints` в прибыльную сторону.
- **Принудительное закрытие** — если свеча достигает уровня стопа или тейк-профита, позиция закрывается на этой же свече.

## Основные параметры

| Параметр | Назначение |
|----------|------------|
| `CandleType` | Таймфрейм для сигналов и скользящих средних. |
| `TrendCandleType` | Таймфрейм для Momentum и MACD фильтров. |
| `MonthlyCandleType` | Медленный таймфрейм для долгосрочного фильтра MACD. |
| `FastMaPeriod` / `SlowMaPeriod` | Периоды быстрых и медленных LWMA. |
| `MomentumPeriod` | Длина расчёта Momentum на трендовом таймфрейме. |
| `MomentumBuyThreshold` / `MomentumSellThreshold` | Минимальное отклонение Momentum для открытия лонга/шорта. |
| `MaxPositions` | Максимальное количество базовых лотов в позиции. |
| `StopLossPoints` / `TakeProfitPoints` | Расстояние до стоп-лосса и тейк-профита в пунктах. |
| `EnableTrailing` / `TrailingStopPoints` | Включение трейлинга и дистанция подтягивания стопа. |
| `EnableBreakEven` | Включение перевода в безубыток. |
| `BreakEvenTriggerPoints` / `BreakEvenOffsetPoints` | Порог активации безубытка и смещение стопа после срабатывания. |

## Рекомендации

- Подключайте стратегию к инструментам, которые поддерживают все выбранные таймфреймы свечей.
- Следите за корректностью шага цены: реализована нормализация для инструментов с дробным пунктом (3 или 5 знаков после запятой).
- Перевод в безубыток и трейлинг выполняются на закрытии свечей, поэтому при гэпах возможно закрытие на следующей свече.
- Базовые параметры повторяют исходный советник, но при необходимости их можно оптимизировать через интерфейс StockSharp.
