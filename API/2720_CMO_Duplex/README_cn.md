# CMO Duplex 策略
[English](README.md) | [Русский](README_ru.md)

该策略是 MetaTrader 5 专家顾问 `Exp_CMO_Duplex.mq5` 在 StockSharp 平台上的移植版本。策略被划分为彼此独立的多头
和空头两条“腿”，它们都基于 Chande 动量振荡指标（CMO）穿越零轴的行为做出决策。每条腿都可以订阅不同的蜡烛
数据、使用独立的指标周期与信号柱偏移，从而在同一标的上构建不对称的配置。

## 工作原理

- 根据多头与空头腿是否使用同一 `DataType`，策略会创建一条或两条蜡烛订阅。
- 每条腿拥有自己的 CMO 指标实例，所有计算都只在收盘完成的蜡烛上执行。
- `SignalBar` 参数用于指定需要回看多少根已完成的蜡烛来判断交叉：`0` 表示使用最新收盘柱，`1` 表示上一柱，`2`
  表示上上一柱，依此类推。
- **多头腿：** 当所选的 CMO 数值从零上方跌至零或以下时（即穿越零轴向下），在允许开仓的情况下建立或反转为多
  头头寸。若较老的指标值位于零下，或达到止损 / 止盈水平，则退出多头。
- **空头腿：** 与多头逻辑完全对称。CMO 自零下穿越至零或零上会触发空头开仓，指标值恢复为零上或触发止损 / 止盈
  将平仓。
- 当需要反向时，提交的市价单数量等于 `Volume + |Position|`，因此可以在一次下单动作中关闭旧头寸并开立新方向。
- 启动时调用 `StartProtection()`，保留 StockSharp 内置的风险保护机制。

## 参数

| 参数 | 说明 |
|------|------|
| `LongCandleType` | 多头腿使用的蜡烛数据类型。 |
| `LongCmoPeriod` | 多头 CMO 指标的周期。 |
| `LongSignalBar` | 多头信号所使用的历史偏移柱数（0 = 最新收盘柱）。 |
| `EnableLongEntries` | 是否允许开立新的多头头寸。 |
| `EnableLongExits` | 是否允许依据指标信号平掉多头头寸。 |
| `LongStopLossPoints` | 多头止损的距离（以价格步长为单位，0 表示关闭止损）。 |
| `LongTakeProfitPoints` | 多头止盈的距离（以价格步长为单位，0 表示关闭止盈）。 |
| `ShortCandleType` | 空头腿使用的蜡烛数据类型。 |
| `ShortCmoPeriod` | 空头 CMO 指标的周期。 |
| `ShortSignalBar` | 空头信号所使用的历史偏移柱数。 |
| `EnableShortEntries` | 是否允许开立新的空头头寸。 |
| `EnableShortExits` | 是否允许依据指标信号平掉空头头寸。 |
| `ShortStopLossPoints` | 空头止损的距离（以价格步长为单位，0 表示关闭止损）。 |
| `ShortTakeProfitPoints` | 空头止盈的距离（以价格步长为单位，0 表示关闭止盈）。 |

基础的 `Strategy.Volume` 属性决定默认下单量。当策略需要反向时，会提交一笔数量为 `Volume + |Position|` 的市价单，以
完成平旧开新的操作。

## 风险控制

- 每根完成的蜡烛都会检测止损和止盈。多头头寸的止损位于入场价下方，止盈位于入场价上方；空头则反向设置。
- 当价格触及止损或止盈时，策略立即通过市价单平仓；若指标值持续保持错误的符号（多头时 CMO 低于零，空头时高于
  零），同样会触发平仓。
- 将距离设置为 0 可以关闭对应的保护，此时头寸完全由振荡器信号管理。

## 使用提示

- 策略适用于 CMO 在触及零轴附近经常反转的标的，`SignalBar` 偏移保持了原始专家顾问的延迟特性。
- 多头与空头腿可以共享同一蜡烛序列，也可以运行在不同的时间框架上；若二者 `DataType` 相同，策略会复用单一订阅
  以提升效率。
- 由于逻辑完全基于已完成的蜡烛，建议提供连续的蜡烛流（历史回测或实时数据），避免因数据缺失而漏掉信号。
