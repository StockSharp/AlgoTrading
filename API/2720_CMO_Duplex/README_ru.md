# Стратегия CMO Duplex
[English](README.md) | [中文](README_cn.md)

Стратегия представляет собой портирование советника MetaTrader 5 `Exp_CMO_Duplex.mq5` на StockSharp. Логика разделена на две
независимые «ноги» (длинную и короткую), которые реагируют на пересечения нулевой линии индикатора Chande Momentum Oscillator
(CMO). Каждая нога может подписываться на собственный поток свечей, использовать свою длину индикатора и сдвиг бара, что позволяет
строить асимметричные конфигурации на одном инструменте.

## Как это работает

- Стратегия оформляет одну или две подписки на свечи в зависимости от того, совпадают ли типы данных у длинной и короткой ног.
- У каждой ноги свой экземпляр индикатора CMO; расчёты выполняются только по завершённым свечам.
- Параметр `SignalBar` задаёт, сколько завершённых свечей назад используется для анализа пересечения. Значение `0` означает
  «использовать последнюю закрытую свечу», `1` — предыдущую, `2` — ещё более раннюю и т. д.
- **Длинная нога:** когда выбранное значение CMO переходит из положительной области к нулю или ниже, при разрешённых входах
  открывается (или разворачивается) длинная позиция. Выход выполняется, если предыдущее значение CMO ниже нуля либо срабатывают
  уровни стоп-лосса / тейк-профита.
- **Короткая нога:** зеркалирует лонговую логику. Пересечение снизу вверх инициирует короткую позицию, а противоположный знак CMO
  или защитные уровни закрывают её.
- При развороте позиции используется объём `Volume` плюс противоположная текущая позиция, поэтому один рыночный ордер закрывает
  прежнее направление и открывает новое.
- При запуске вызывается `StartProtection()`, что сохраняет активными встроенные механизмы риск-менеджмента StockSharp.

## Параметры

| Параметр | Описание |
|----------|----------|
| `LongCandleType` | Тип свечей, используемых длинной ногой. |
| `LongCmoPeriod` | Период индикатора CMO для длинных сигналов. |
| `LongSignalBar` | Количество закрытых свечей между текущим моментом и анализируемой свечой (0 = последняя закрытая). |
| `EnableLongEntries` | Разрешение на открытие длинных позиций. |
| `EnableLongExits` | Разрешение на закрытие длинных позиций по сигналу индикатора. |
| `LongStopLossPoints` | Размер стоп-лосса в шагах цены для длинных сделок (0 — отключить). |
| `LongTakeProfitPoints` | Размер тейк-профита в шагах цены для длинных сделок (0 — отключить). |
| `ShortCandleType` | Тип свечей, используемых короткой ногой. |
| `ShortCmoPeriod` | Период индикатора CMO для коротких сигналов. |
| `ShortSignalBar` | Количество закрытых свечей между текущим моментом и анализируемой свечой для шорта. |
| `EnableShortEntries` | Разрешение на открытие коротких позиций. |
| `EnableShortExits` | Разрешение на закрытие коротких позиций по сигналу индикатора. |
| `ShortStopLossPoints` | Размер стоп-лосса в шагах цены для коротких сделок (0 — отключить). |
| `ShortTakeProfitPoints` | Размер тейк-профита в шагах цены для коротких сделок (0 — отключить). |

Базовый параметр `Strategy.Volume` задаёт стандартный размер заявки. При развороте направление меняется одним ордером объёма
`Volume + |Position|`, что одновременно закрывает старую позицию и открывает новую.

## Управление рисками

- Стоп-лосс и тейк-профит проверяются на каждой завершённой свече. Для длинных позиций стоп размещается ниже входа, цель — выше;
  для коротких уровни зеркальны.
- Срабатывание стопа или цели немедленно приводит к закрытию позиции рыночным ордером. Та же процедура выполняется, если значение
  CMO сохраняет «неправильный» знак (ниже нуля для лонга, выше нуля для шорта).
- Нулевое значение параметра отключает соответствующую защиту и оставляет управление позицией только за сигналами индикатора.

## Практические замечания

- Стратегия ориентирована на инструменты, где CMO склонен к развороту возле нулевой линии. Сдвиг `SignalBar` намеренно сохраняет
  задержку сигналов в соответствии с оригинальным экспертом.
- Длинная и короткая ноги могут работать по одному потоку свечей или по разным таймфреймам. При совпадении `DataType` используется
  одна подписка, что уменьшает нагрузку.
- Поскольку логика опирается на закрытые свечи, важно обеспечить непрерывный поток данных (например, в тестере или в реальном
  времени), иначе есть риск пропуска сигналов.
