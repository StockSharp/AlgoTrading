# DVD 100-50 Cent 策略

## 概述
DVD 100-50 cent 是一个从 MT4 专家顾问移植而来的逆势限价策略。算法同时观察 M1、M30、H1、D1 四个周期，对潜在交易机会打分，然后在最近的“100 价位”附近挂出买入或卖出限价单。当挂单成交后，策略会按照预先计算好的止损与止盈水平管理仓位。

## 指标与数据
- **RAVI（Range Action Verification Index）**：在 H1 和 D1 周期使用 SMA(2) 与 SMA(24) 对开盘价计算得到。
- **原始 K 线数据**：在 M1、M30、H1 周期用于检测瞬时尖峰、盘整区间以及短期动量特征。
- **价格栅格**：将最新价格四舍五入到两个小数位，并用 `PointFromLevelGoPips`（0.1 点单位）偏移以构建“100 价位”网格。

## 入场逻辑
1. 根据最新的 M1 收盘价，取两位小数并加上 `PointFromLevelGoPips`（默认 50 ⇒ 5 点）得到目标 100 价位。
2. 初始化内部评分 BAL=0，然后根据下列条件累加或扣减分数：
   - **趋势过滤**：当 H1 RAVI 小于 0（做多）或大于 0（做空）时加 10 分。
   - **小时级尖峰确认**：若前两根 H1 K 线高点/低点突破网格 `RiseFilterPips`，加 7 分。
   - **结构确认**：若当前 M1 收盘重新站回目标价位，且最近三根 H1 的低点/高点一直位于安全缓冲区（`PointFromLevelGoPips ± 30 * 0.1 点`）之外，加 45 分。
   - **波动性保护**：若近期 M1 的高点/低点超过 `HighLevelPips`（默认 600 ⇒ 60 点），或在 D1 RAVI 强趋势背景下出现快速动量爆发，则减 50 分。
   - **突破过滤**：若过去 15 根 H1 K 线都未触及 `LowLevel2Pips`，减 50 分。
   - **盘整过滤**：若最近 8 根 M30 K 线全部位于 `LowLevelPips` 区间内，减 50 分。
3. 仅当最终得分 ≥ 50 且当前没有持仓或挂单时才会提交新的限价单。

## 挂单规则
- **买入限价单**：在最新 M1 收盘价下方 10 点处挂单。止损位于限价价位下 `StopLossPips` 点，止盈位于其上 `TakeProfitPips` 点。如果 D1 RAVI 在过去四天内呈现 -1 到 +5 区间的阶梯式上涨，则额外延长止盈 25 点。
- **卖出限价单**：在最新 M1 收盘价上方 7 点处挂单，止损与止盈规则完全对称。当 D1 RAVI 在 -5 到 -1 区间持续下降时，同样延长止盈 25 点。
- 挂单的有效期为 `OrderExpiryMinutes` 分钟（默认 20 分钟），超时未成交会自动撤单并清空对应的保护水平。

## 仓位管理
- 挂单成交后，策略会保存对应的止损/止盈价格，并在价格触及时发送市价单平仓。
- 本移植版本不启用追踪止损——原始 EA 默认关闭该功能。
- 只要存在持仓或挂单，就不会生成新的交易信号。

## 资金管理
- 当 `UseMoneyManagement` 为真时，仓位规模按照 MT4 原始公式计算：以 `TradeSizePercent` 为基础，结合账户类型（迷你或标准）并限制在 `[0.1, MaxVolume]`（迷你）或 `[1, MaxVolume]`（标准）范围内。
- 关闭资金管理时，使用参数 `FixedVolume` 指定的固定手数。
- 当账户权益低于 `MarginCutoff` 时暂停开仓。

## 参数
| 参数 | 说明 | 默认值 |
| ---- | ---- | ------ |
| `AccountIsMini` | 是否按迷你账户规则四舍五入仓位 | `true` |
| `UseMoneyManagement` | 启用资金管理 | `true` |
| `TradeSizePercent` | 每笔交易使用的权益百分比 | `10` |
| `FixedVolume` | 关闭资金管理时的固定手数 | `0.01` |
| `MaxVolume` | 最大可下单手数 | `4` |
| `StopLossPips` | 止损距离（点） | `210` |
| `TakeProfitPips` | 止盈距离（点） | `18` |
| `PointFromLevelGoPips` | 100 价位基准偏移（0.1 点单位） | `50` |
| `RiseFilterPips` | H1 尖峰过滤阈值（0.1 点单位） | `700` |
| `HighLevelPips` | M1 尖峰过滤阈值（0.1 点单位） | `600` |
| `LowLevelPips` | M30 盘整区间阈值（0.1 点单位） | `250` |
| `LowLevel2Pips` | H1 突破确认阈值（0.1 点单位） | `450` |
| `MarginCutoff` | 停止开仓的最低权益 | `300` |
| `OrderExpiryMinutes` | 挂单有效期（分钟） | `20` |

## 使用提示
- 策略依赖四个周期的完结 K 线，请确保数据源同时提供 M1、M30、H1、D1 的同步历史数据。
- 止损和止盈通过市价单执行，以模拟 MT4 中挂单附带 SL/TP 的行为。
- 算法对点值设置较为敏感，请确认交易品种的 `PriceStep` 与 `Decimals` 属性配置正确。
