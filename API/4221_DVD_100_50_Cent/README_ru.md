# Стратегия DVD 100-50 Cent

## Обзор
DVD 100-50 cent — это контртрендовая лимитная система, портированная с оригинального советника MT4. Алгоритм анализирует рынок на четырёх таймфреймах (M1, M30, H1, D1), рассчитывает оценку (BAL) и только после этого выставляет лимитные заявки около ближайшего ценового «уровня 100». После исполнения ордера стратегия управляет позицией заранее вычисленными уровнями стоп-лосса и тейк-профита.

## Индикаторы и данные
- **RAVI (Range Action Verification Index)** на H1 и D1, рассчитывается как разница SMA(2) и SMA(24) от цены открытия.
- **Свечной поток** на M1, M30 и H1 для фильтров всплесков, консолидации и импульса.
- **Округление цены** до сетки «100 уровней» с точностью до двух знаков и смещением, задаваемым в 0.1 пункта (`PointFromLevelGoPips`).

## Логика входа
1. Рассчитать округлённый уровень 100, взяв последнюю цену закрытия M1, округлив её до двух знаков и сместив на `PointFromLevelGoPips` (по умолчанию 50 ⇒ 5 пунктов).
2. Инициализировать счётчик BAL значением 0 и добавлять/вычитать баллы согласно условиям:
   - **Фильтр тренда:** +10 баллов, если RAVI на H1 < 0 (для покупок) или > 0 (для продаж).
   - **Подтверждение всплеска на H1:** +7 баллов, если два предыдущих максимума/минимума H1 превышают уровень на `RiseFilterPips`.
   - **Структурное подтверждение:** +45 баллов, если текущая свеча M1 пересекает уровень в нужную сторону, а три последних минимума/максимума H1 остаются выше/ниже защитной зоны (`PointFromLevelGoPips ± 30 * 0.1 пункта`).
   - **Защита от волатильности:** −50 баллов, если последние экстремумы M1 превышают `HighLevelPips` (по умолчанию 600 ⇒ 60 пунктов) или если обнаружены импульсные скачки при подтверждённом тренде по RAVI D1.
   - **Фильтр пробоя:** −50 баллов, если за последние 15 свечей H1 уровень `LowLevel2Pips` ни разу не пересекался.
   - **Фильтр консолидации:** −50 баллов, если восемь последних свечей M30 полностью находятся внутри диапазона `LowLevelPips`.
3. Лимитный ордер выставляется только при BAL ≥ 50 и отсутствии активной позиции/ордеров.

## Выставление ордеров
- **Buy Limit:** на 10 пунктов ниже текущего закрытия M1. Стоп-лосс отстоит на `StopLossPips` пунктов, тейк-профит — на `TakeProfitPips`. Если RAVI D1 находится в коридоре от +1 до +5 и каждый из четырёх последних значений выше предыдущего, тейк-профит дополнительно увеличивается на 25 пунктов.
- **Sell Limit:** на 7 пунктов выше текущего закрытия M1 с зеркальными параметрами стопа и цели. При падающей лестнице RAVI D1 (от −1 до −5) тейк-профит сдвигается ещё на 25 пунктов.
- Заявки автоматически снимаются через `OrderExpiryMinutes` минут (по умолчанию 20). При отмене соответствующие стоп/тейк очищаются.

## Управление позицией
- После исполнения хранятся рассчитанные уровни стоп-лосса и тейк-профита, и при их достижении выставляются рыночные заявки на закрытие.
- Трейлинг-стоп не используется — как и в исходном советнике параметр был выключен.
- Новые сделки блокируются при наличии позиции или активной лимитной заявки.

## Управление капиталом
- При включённом `UseMoneyManagement` размер лота повторяет логику MT4: рассчитывается доля капитала `TradeSizePercent`, корректируется под мини-счёт и ограничивается диапазоном `[0.1, MaxVolume]` (мини) или `[1, MaxVolume]` (стандарт).
- При выключении money-management используется фиксированный объём `FixedVolume`.
- Торговля прекращается, если текущая стоимость портфеля опускается ниже `MarginCutoff`.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `AccountIsMini` | Применять правила округления для мини-счёта | `true` |
| `UseMoneyManagement` | Включить адаптивный расчёт лота | `true` |
| `TradeSizePercent` | Процент капитала на сделку | `10` |
| `FixedVolume` | Фиксированный объём при отключённом MM | `0.01` |
| `MaxVolume` | Максимально допустимый лот | `4` |
| `StopLossPips` | Стоп-лосс в пунктах | `210` |
| `TakeProfitPips` | Тейк-профит в пунктах | `18` |
| `PointFromLevelGoPips` | Смещение базового уровня (0.1 пункта) | `50` |
| `RiseFilterPips` | Порог всплеска на H1 (0.1 пункта) | `700` |
| `HighLevelPips` | Порог всплеска на M1 (0.1 пункта) | `600` |
| `LowLevelPips` | Диапазон консолидации M30 (0.1 пункта) | `250` |
| `LowLevel2Pips` | Порог подтверждения пробоя H1 (0.1 пункта) | `450` |
| `MarginCutoff` | Минимальный уровень капитала | `300` |
| `OrderExpiryMinutes` | Время жизни отложенного ордера (мин) | `20` |

## Особенности использования
- Нужны синхронизированные потоки свечей M1, M30, H1 и D1 — стратегия реагирует только на завершённые бары.
- Стоп и тейк исполняются рыночными заявками, что имитирует работу с прикреплёнными SL/TP в MT4.
- Алгоритм чувствителен к размеру пункта: убедитесь, что свойства инструмента `PriceStep` и `Decimals` корректно настроены.
