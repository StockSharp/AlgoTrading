# Polish Layer Expert Advisor System Efficient

## Обзор
Стратегия представляет собой перенос советника MQL4 «Polish Layer Expert Advisor System Efficient». Автор рекомендовал использовать 5- или 15-минутные графики, поэтому алгоритм ориентирован на внутридневную торговлю и допускает лишь одну позицию одновременно. Направление тренда определяется сочетанием быстрой и медленной скользящих средних по цене, а также двух сглаженных RSI. Вход подтверждается тремя индикаторами — стохастиком, DeMarker и Williams %R — что позволяет ловить развороты из крайних зон только в сторону основного тренда.

## Логика торговли
1. **Фильтр тренда.** Для покупок 9-периодная SMA закрытий должна располагаться выше 45-периодной LWMA, а 9-периодная SMA от значений RSI — выше 45-периодной SMA RSI. Для продаж условия зеркальны. Любое расхождение между фильтрами запрещает новые сделки.
2. **Триггер стохастика.** При бычьем тренде стратегия ждёт, когда линия %K пересечёт уровень перепроданности (по умолчанию 19) снизу вверх и одновременно поднимется выше %D. Для продаж %K должна опуститься ниже уровня перекупленности (81) и пересечь %D сверху вниз. Сглаживание полностью повторяет параметры оригинала.
3. **Подтверждение импульса.** Длинный сигнал требует, чтобы DeMarker пересёк уровень 0.35 снизу вверх, а Williams %R — уровень −81. Короткий сигнал фиксируется при пересечении вниз уровней 0.63 и −19 соответственно. Все условия проверяются между предыдущей и текущей завершённой свечой.
4. **Управление позицией.** Открытие происходит рыночными ордерами. Новые входы возможны только в отсутствии позиции. Защитные уровни пересчитываются из параметров в пипсах через минимальный шаг цены; при отсутствии шага защита отключается.

## Управление рисками
* **Стоп-лосс / тейк-профит.** Параметры задаются в пипсах. При положительных значениях расстояние переводится в цену через `Security.PriceStep` (1 пип = 1 шаг) и выставляется сразу после входа. Ноль отключает соответствующий уровень.
* **Одна позиция.** Как и оригинальный советник, стратегия не усредняется и не переворачивается, пока сделка не закрыта.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `Volume` | `0.1` | Объём заявки в лотах. Настройте в соответствии с требованиями брокера. |
| `CandleType` | `TimeSpan.FromMinutes(15).TimeFrame()` | Тип свечей для расчётов. Для повторения оригинала используйте 5- или 15-минутные таймфреймы. |
| `RsiPeriod` | `14` | Период базового RSI. |
| `ShortPricePeriod` | `9` | Период быстрой ценовой SMA в трендовом фильтре. |
| `LongPricePeriod` | `45` | Период медленной ценовой LWMA в трендовом фильтре. |
| `ShortRsiPeriod` | `9` | Период быстрой SMA, применяемой к значениям RSI. |
| `LongRsiPeriod` | `45` | Период медленной SMA, применяемой к значениям RSI. |
| `StochasticKPeriod` | `5` | Базовый период %K стохастика. |
| `StochasticDPeriod` | `3` | Период сглаживания линии %D. |
| `StochasticSlowing` | `3` | Дополнительное сглаживание %K. |
| `DemarkerPeriod` | `14` | Период усреднения индикатора DeMarker. |
| `WilliamsPeriod` | `14` | Длина окна для Williams %R. |
| `StochasticOversoldLevel` | `19` | Граница перепроданности для подтверждения длинных входов. |
| `StochasticOverboughtLevel` | `81` | Граница перекупленности для подтверждения коротких входов. |
| `DemarkerBuyLevel` | `0.35` | Уровень DeMarker, который должен быть пробит вверх для покупок. |
| `DemarkerSellLevel` | `0.63` | Уровень DeMarker, который должен быть пробит вниз для продаж. |
| `WilliamsBuyLevel` | `-81` | Уровень Williams %R, подтверждающий покупки. |
| `WilliamsSellLevel` | `-19` | Уровень Williams %R, подтверждающий продажи. |
| `StopLossPips` | `7777` | Расстояние до стоп-лосса в пипсах. Большое значение по умолчанию фактически отключает стоп. |
| `TakeProfitPips` | `17` | Расстояние до тейк-профита в пипсах. Ноль отключает фиксированную цель. |

## Примечания
* Убедитесь, что заданы корректные `Security.PriceStep`, `Security.MinVolume` и `Security.VolumeStep` — стратегия предполагает соответствие 1 пип = 1 минимальный шаг цены.
* Все условия основаны на сравнении двух последовательных завершённых свечей, поэтому при тестировании важно использовать идентичную структуру баров и точное время закрытия.
