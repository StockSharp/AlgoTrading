# Стратегия Donchain Counter

## Обзор
Donchain Counter — перенос эксперта MQL5 «Donchain counter» (Michal Rutka) на StockSharp. Алгоритм отслеживает расширения канала Дончиана, чтобы фиксировать пробои, и после входа переносит защитный стоп вдоль противоположной границы канала, когда цена уходит достаточно далеко. Как и в оригинале, открыть новую позицию разрешается не чаще одного раза в сутки.

## Логика торговли
### Вход в лонг
- Сигналы анализируются только по завершённым свечам выбранного таймфрейма (по умолчанию **H1**).
- Если верхняя граница канала Дончиана на свече *t-1* выше, чем на свече *t-2*, значит произошёл пробой максимума — открывается рыночная покупка.
- Первоначальный стоп помещается на текущую нижнюю границу канала.

### Вход в шорт
- Если нижняя граница канала Дончиана на свече *t-1* ниже, чем на свече *t-2*, фиксируется пробой минимума — отправляется рыночная продажа.
- Первоначальный стоп выставляется на текущую верхнюю границу канала.

### Ограничение частоты сделок
- После каждой новой позиции фиксируется время входа. Пока не пройдёт `TradeCooldown` (по умолчанию **24 часа**), новые сделки не открываются. Это повторяет правило «не более одной сделки в день» из MQL-версии.

### Сопровождение и выход
- Трейлинг активируется только после того, как цена уйдёт минимум на `BufferSteps` шагов цены от противоположной границы канала. В оригинале требовалось 50 пунктов.
- Лонг: после активации стоп переносится на текущую нижнюю границу. Если минимум свечи касается этого уровня, позиция закрывается рыночной продажей.
- Шорт: после активации стоп следует за текущей верхней границей. Если максимум свечи достигает уровня, позиция закрывается покупкой.
- После закрытия по стопу стратегия ждёт следующего сигнала и окончания периода ожидания, прежде чем открывать новую позицию.

### Управление рисками
- Торговый объём задаётся параметром `Volume`; одновременно открыта только одна позиция.
- Цели по прибыли не используются — выход осуществляется исключительно по правилам канала Дончиана.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Volume` | Объём заявки. | `1` |
| `ChannelPeriod` | Период расчёта канала Дончиана. | `20` |
| `BufferSteps` | Количество шагов цены, на которое цена должна уйти за пределы противоположной границы до активации трейлинга. | `50` |
| `TradeCooldown` | Минимальный интервал между входами. | `1 день` |
| `CandleType` | Тип свечей для анализа (по умолчанию часовые). | `1h` |

## Индикаторы
- **Donchian Channels** — верхняя и нижняя границы задают сигналы на вход и уровни защитных стопов.

## Особенности
- Желательно использовать инструменты с корректно заданным `PriceStep`, чтобы буфер `BufferSteps` соответствовал реальному расстоянию. При отсутствии шага по инструменту стратегия использует значение 0.0001.
- Одновременные разнонаправленные позиции не допускаются — перед сменой направления текущая позиция полностью закрывается.
- Если доступна область графика, стратегия автоматически добавляет свечи, канал Дончиана и собственные сделки.
