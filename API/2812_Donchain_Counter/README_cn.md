# Donchain Counter 策略

## 概述
Donchain Counter 策略是将 MQL5 专家顾问 “Donchain counter”（作者 Michal Rutka）迁移到 StockSharp 的实现。策略关注 Donchian 通道的扩张来捕捉突破行情，并在价格离开通道一定距离后，把止损沿着相反的通道边界进行跟踪。为了与原始脚本保持一致，每 24 小时只能开仓一次。

## 交易逻辑
### 多头开仓
- 只在所选周期（默认 **H1**）的完整 K 线收盘后评估信号。
- 如果上一根 K 线 (*t-1*) 的 Donchian 上轨高于前一根 K 线 (*t-2*) 的上轨，说明通道向上突破，立即以市价买入。
- 初始止损设置在当前的 Donchian 下轨。

### 空头开仓
- 如果上一根 K 线 (*t-1*) 的 Donchian 下轨低于前一根 K 线 (*t-2*) 的下轨，说明通道向下突破，立即以市价卖出。
- 初始止损设置在当前的 Donchian 上轨。

### 交易冷却
- 每次新开仓都会记录时间，在 `TradeCooldown`（默认 **24 小时**）过去之前禁止再次开仓，从而复现原策略“一天最多一笔交易”的限制。

### 跟踪与平仓
- 只有当价格至少离相反的通道边界 `BufferSteps` 个最小价格步长时，才激活跟踪止损（MQL 中使用 50 点）。
- 多头：激活后将止损移动到当前的 Donchian 下轨；若后续某根 K 线的最低价触及该水平，则以市价卖出平仓。
- 空头：激活后将止损移动到当前的 Donchian 上轨；若某根 K 线的最高价到达该水平，则以市价买入平仓。
- 被止损平仓后，策略会等待下一次信号并检查冷却时间，再决定是否重新入场。

### 风险控制
- 始终只持有一个仓位，仓位大小由 `Volume` 参数决定。
- 没有固定的止盈目标，所有离场动作都由 Donchian 通道的跟踪规则触发。

## 参数
| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `Volume` | 每次下单的数量。 | `1` |
| `ChannelPeriod` | Donchian 通道的回溯周期。 | `20` |
| `BufferSteps` | 价格在相反通道之外需要移动的最小步长数，达到后才启动跟踪止损。 | `50` |
| `TradeCooldown` | 连续开仓之间的最短时间。 | `1 天` |
| `CandleType` | 用于分析的 K 线类型（默认 1 小时）。 | `1h` |

## 指标
- **Donchian Channels** —— 上下轨既提供突破信号，也作为跟踪止损的参考水平。

## 注意事项
- 请使用具有合理 `PriceStep` 的品种，保证 `BufferSteps` 对应的价格距离有效；若未提供价格步长，策略默认使用 0.0001。
- 策略不会同时持有多头与空头仓位，反向交易前必须平掉原有仓位。
- 如果环境支持图表渲染，将自动绘制价格 K 线、Donchian 通道以及策略成交点位。
