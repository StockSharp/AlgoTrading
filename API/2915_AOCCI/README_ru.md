# Стратегия AOCCI

## Общая информация
- Конвертация экспертного советника MetaTrader 5 `AOCCI` на высокоуровневый API StockSharp.
- Сочетает осциллятор Awesome Oscillator и Commodity Channel Index с фильтром по простому пивоту.
- Содержит защиту от резких ценовых скачков через фильтры "большого" и "двойного" гэпа по открытиям свечей.
- Полностью повторяет исходную логику MQL5, в которой условия для коротких сделок совпадают с условиями для длинных.

## Данные и индикаторы
- Основной рабочий таймфрейм задаётся параметром `CandleType` и используется для расчёта сигналов.
- Дополнительно запрашивается старший таймфрейм (`HigherCandleType`, по умолчанию 1 час) для чтения закрытия предыдущей свечи.
- Индикаторы:
  - `AwesomeOscillator` определяет направление импульса.
  - `CommodityChannelIndex` с настраиваемым периодом и смещением считывания буфера.
- Пивот рассчитывается по свече со смещением `SignalCandleShift + 1` относительно текущей: `(High + Low + Close) / 3`.

## Логика входа
1. Ожидание, пока индикаторы сформируют значения и накопится минимум шесть завершённых свечей.
2. Считывание значения CCI со смещением `SignalCandleShift` и предыдущего значения (`SignalCandleShift + 1`).
3. Отбраковка свечи при срабатывании любого фильтра скачков:
   - `BigJumpPips` проверяет подряд идущие значения цен открытия последних пяти интервалов.
  - `DoubleJumpPips` сравнивает открытия через одну свечу.
4. Длинная позиция открывается при отсутствии текущих сделок и выполнении условий:
   - Текущее значение Awesome Oscillator больше нуля.
   - Сдвинутое значение CCI не ниже нуля.
   - Цена закрытия находится выше пивота.
   - Выполнено хотя бы одно из подтверждений: предыдущее значение AO < 0, предыдущее сдвинутое значение CCI ≤ 0 или закрытие старшего таймфрейма ниже пивота.
5. Короткая позиция использует те же самые проверки, что и длинная (особенность исходного советника).

## Выход и управление рисками
- При открытии сделки рассчитываются уровни стоп-лосса и тейк-профита на основе заданных расстояний в пунктах с учётом размера пункта инструмента.
- На каждой завершённой свече проверяется достижение тейк-профита или стоп-лосса по экстремумам свечи, после чего позиция закрывается рыночной заявкой.
- Трейлинг активируется, если `TrailingStopPips` и `TrailingStepPips` больше нуля:
  - Для покупок стоп переносится на `Close - TrailingStopPips`, когда цена ушла от входа минимум на `TrailingStopPips + TrailingStepPips`.
  - Для продаж стоп перемещается на `Close + TrailingStopPips` при снижении на ту же суммарную величину.
- После закрытия позиции (по стопу, тейку или трейлингу) стратегия ждёт следующую свечу перед повторной оценкой условий входа.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `TradeVolume` | 1 | Базовый объём рыночной сделки. |
| `StopLossPips` | 50 | Расстояние защитного стопа в пунктах. 0 — без стопа. |
| `TakeProfitPips` | 50 | Расстояние тейк-профита в пунктах. 0 — без тейка. |
| `TrailingStopPips` | 5 | Дистанция трейлинг-стопа в пунктах. Требует `TrailingStepPips` > 0. |
| `TrailingStepPips` | 5 | Дополнительный шаг перед переносом трейлинг-стопа. |
| `CciPeriod` | 55 | Период индикатора CCI. |
| `SignalCandleShift` | 0 | Смещение при чтении значений CCI и выборе свечи для пивота. |
| `BigJumpPips` | 100 | Максимально допустимая разница между последовательными открытиями свечей. |
| `DoubleJumpPips` | 100 | Максимально допустимая разница между открытиями через одну свечу. |
| `CandleType` | 15-минутные свечи | Рабочий таймфрейм для сигналов. |
| `HigherCandleType` | Часовые свечи | Старший таймфрейм для фильтрации по закрытию. |

## Примечания
- Размер пункта определяется из `Security.PriceStep` с поправкой для инструментов с 3 или 5 десятичными знаками.
- Из-за совпадения условий длинных и коротких сделок короткие позиции возможны только при выполнении тех же фильтров, что и для покупок.
- Для работы фильтров скачков необходимо накопить минимум шесть завершённых свечей.
