# 趋势 RDS 策略

## 概述
趋势 RDS 最初是 MetaTrader 平台上的一个会话型反转策略。它会在指定的开盘时间开始扫描最近的 100 根已收盘 K 线，寻找连续三根同向动量结构，并逆向建仓。移植到 StockSharp 后保留了原始的资金管理功能，包括可选的信号反向、固定止损与止盈、保本移动以及带步长的追踪止损。

## 交易逻辑
1. **信号窗口**：到达 `Start Time` 后，策略检查最多 100 根最近收盘的 K 线。
2. **形态识别**：寻找第一个满足以下任一条件的三根 K 线组合：
   - 高点连续上移且低点连续上移（`High[n] < High[n+1] < High[n+2]` 且 `Low[n] > Low[n+1] > Low[n+2]`）。
   - 高点连续下移且低点连续下移（`High[n] > High[n+1] > High[n+2]` 且 `Low[n] < Low[n+1] < Low[n+2]`）。
   如果同时出现高点上移和低点下移（内外包结构），则视为冲突信号并忽略。当 `Reverse Signals` 为真时，买卖方向会被反向处理。
3. **入场**：若当前没有持仓，则按 `Trade Volume` 下市价单；如持有反向仓位，会先平仓再重新判断信号。
4. **强制平仓窗口**：`Close Time` 起的 15 分钟内，若还有持仓将被全部平仓。
5. **风控组件**：
   - 按参数下达止损与止盈委托，可在成交量变化时自动刷新。
   - 达到 `Break-Even (pips)` 所设阈值后，止损上移至开仓价实现保本。
   - 追踪止损始终保持 `Trailing Stop (pips)` 的距离，只有当价格继续移动超过 `Trailing Step (pips)` 时才会再次推进。

## 参数说明
| 名称 | 说明 |
| ---- | ---- |
| **Trade Volume** | 每次下单的合约或手数。 |
| **Stop Loss (pips)** | 止损距离，设为 0 表示关闭。 |
| **Take Profit (pips)** | 止盈距离，设为 0 表示关闭。 |
| **Start Time** | 开始扫描形态的时间（交易所时间）。 |
| **Close Time** | 强制平仓时间（交易所时间），策略会在之后 15 分钟内平掉仓位。 |
| **Reverse Signals** | 反向处理买卖信号。 |
| **Trailing Stop (pips)** | 追踪止损的基础距离，为 0 则不启用。 |
| **Trailing Step (pips)** | 追踪止损再次推进所需的额外价格移动。 |
| **Break-Even (pips)** | 触发保本移动的利润阈值，为 0 则关闭功能。 |
| **Candle Type** | 用于分析的蜡烛图类型。 |

## 使用建议
- 策略基于合约的 `PriceStep` 或 `MinPriceStep` 计算点值，请确保交易品种提供正确的最小跳动。
- 仅处理已收盘的 K 线，因此每个时间框架每天最多触发一次信号。
- 当仓位数量发生变化时，止损/止盈委托会同步调整，确保保护水平一致。
- 追踪止损与保本逻辑只在存在有效入场价时生效。

## 文件结构
- `CS/TrendRdsStrategy.cs`：策略的 C# 实现。
- `README.md`：英文说明。
- `README_ru.md`：俄文说明。
