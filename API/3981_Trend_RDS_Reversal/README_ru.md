# Стратегия Trend RDS

## Общее описание
Trend RDS — сессионная контртрендовая стратегия, изначально написанная для MetaTrader. В момент заданного старта она анализирует до 100 последних закрытых свечей, ищет последовательность из трёх баров с направленным импульсом и открывает позицию в противоположную сторону. Порт на StockSharp сохраняет исходное управление рисками: опцию инверсии сигналов, фиксированные уровни стоп-лосса и тейк-профита, перевод в безубыток и трейлинг-стоп с настраиваемым шагом.

## Логика торговли
1. **Окно сигналов** – начиная с `Start Time` стратегия обрабатывает только завершённые свечи.
2. **Поиск паттерна** – выбирается первая тройка свечей, удовлетворяющая одному из условий:
   - Максимумы растут, минимумы растут (`High[n] < High[n+1] < High[n+2]` и `Low[n] > Low[n+1] > Low[n+2]`).
   - Максимумы падают, минимумы падают (`High[n] > High[n+1] > High[n+2]` и `Low[n] < Low[n+1] < Low[n+2]`).
   Если одновременно расширяются и максимум, и минимум (внутренний/внешний бар), сигнал игнорируется. При включённом параметре `Reverse Signals` направления сделок меняются местами.
3. **Вход** – при отсутствии открытой позиции выставляется рыночный ордер объёмом `Trade Volume`. Если удерживается противоположная позиция, она закрывается перед формированием нового входа.
4. **Окно принудительного выхода** – с момента `Close Time` и в течение последующих 15 минут все оставшиеся позиции закрываются по рынку.
5. **Защита позиции** – после открытия сделки регистрируются:
   - Стоп-лосс и тейк-профит на заданной дистанции.
   - Перевод стопа в точку входа при достижении профита `Break-Even (pips)`.
   - Трейлинг-стоп, который держит расстояние `Trailing Stop (pips)` и обновляется только при дополнительном движении на `Trailing Step (pips)`.

## Параметры
| Имя | Описание |
| --- | -------- |
| **Trade Volume** | Объём рыночной заявки (лоты или контракты). |
| **Stop Loss (pips)** | Дистанция защитного стопа; 0 — отключить. |
| **Take Profit (pips)** | Дистанция тейк-профита; 0 — отключить. |
| **Start Time** | Время начала поиска паттернов (по времени биржи). |
| **Close Time** | Время принудительного закрытия позиций (инструмент закрывается в течение 15 минут). |
| **Reverse Signals** | Инвертировать направления сигналов. |
| **Trailing Stop (pips)** | Базовое расстояние трейлинг-стопа, 0 — отключить. |
| **Trailing Step (pips)** | Дополнительный ход цены для обновления трейлинг-стопа. |
| **Break-Even (pips)** | Порог прибыли для перевода стопа в безубыток, 0 — отключить. |
| **Candle Type** | Тип свечей, используемых в расчётах. |

## Практические замечания
- Для вычисления расстояний по пунктам используется `PriceStep` или `MinPriceStep` инструмента. Убедитесь, что у бумаги задан корректный шаг цены.
- Стратегия обрабатывает только закрытые свечи, поэтому сигнал может появиться не чаще одного раза в день на выбранном таймфрейме.
- При изменении объёма позиции защитные заявки переставляются, сохраняя актуальные уровни.
- Трейлинг и безубыток работают только при наличии валидной цены входа.

## Состав репозитория
- `CS/TrendRdsStrategy.cs` — реализация стратегии на C#.
- `README.md` — документация на английском языке.
- `README_cn.md` — документация на китайском языке.
