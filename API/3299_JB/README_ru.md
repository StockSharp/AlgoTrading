# Стратегия JB

## Описание

JB — это стратегия, перенесённая из советника fxDreema, которая сочетает фильтры тренда, подтверждение импульса и пробой волатильности:

- **Фильтр тренда.** Предыдущая свеча должна закрыться выше (для покупок) либо ниже (для продаж) 100-периодной простой скользящей средней.
- **Фильтр импульса.** Подтверждение направления осуществляется индикатором Force Index с периодом 100 (положительное значение — лонг, отрицательное — шорт).
- **Триггер волатильности.** Вход происходит, когда предыдущая свеча закрывается за пределами соответствующей полосы Боллинджера (период 20, отклонение 2.0).
- **Управление позицией.** Объём сделки увеличивается по принципу мартингейла после убыточного цикла и возвращается к базовому уровню после прибыльного цикла.
- **Выход.** Все позиции закрываются, когда средняя нереализованная прибыль на контракт достигает заданного порога.

## Параметры

| Имя | Описание |
| --- | --- |
| `SmaPeriod` | Период SMA для фильтра тренда (по умолчанию 100). |
| `ForcePeriod` | Период индикатора Force Index (по умолчанию 100). |
| `BollingerPeriod` | Период полос Боллинджера (по умолчанию 20). |
| `BollingerDeviation` | Множитель стандартного отклонения полос Боллинджера (по умолчанию 2.0). |
| `BaseVolume` | Базовый объём заявки до применения мартингейла (по умолчанию 0.1). |
| `LossMultiplier` | Множитель объёма после убыточного цикла (по умолчанию 1.55). |
| `AverageProfitTarget` | Целевой уровень средней нереализованной прибыли на контракт для закрытия позиций (по умолчанию 2.8). |
| `CandleType` | Тип свечей, используемых для расчётов (по умолчанию минутные). |

## Сигналы

### Покупка
1. Предыдущая свеча закрылась на уровне нижней полосы Боллинджера или ниже.
2. Предыдущая цена закрытия выше 100-периодной SMA.
3. Force Index положителен.

### Продажа
1. Предыдущая свеча закрылась на уровне верхней полосы Боллинджера или выше.
2. Предыдущая цена закрытия ниже 100-периодной SMA.
3. Force Index отрицателен.

### Выходы
- При достижении параметра `AverageProfitTarget` по средней нереализованной прибыли на контракт стратегия закрывает всю позицию.
- После возврата позиции к нулю объём следующей сделки увеличивается по множителю `LossMultiplier`, если последний цикл убыточен, и сбрасывается к `BaseVolume`, если цикл прибыльный.

## Примечания

- Мартингейловое управление объёмом основано на реализованном PnL, поэтому используйте стратегию только на инструментах, где допустимо наращивание объёма.
- В StockSharp используется нетто-позиция, поэтому возможные встречные сделки из оригинального MQL решены через агрегированную позицию.
