# Стратегия Semilong WWW Forex Instruments Info

## Обзор
Стратегия повторяет логику советника MetaTrader «Semilong». Она отслеживает расстояние между текущей ценой Bid и двумя историческими закрытиями, разделёнными настраиваемыми сдвигами. Когда рынок уходит достаточно далеко ниже (или выше) свежего закрытия, а само закрытие при этом заметно удалилось от ещё более старого значения, открывается длинная или короткая позиция. Управление позицией воспроизводит оригинал: настраиваемые тейк‑профит и стоп‑лосс, опциональный трейлинг и модуль автолота, уменьшающий объём после серии убытков.

## Формирование сигналов
- **Сдвиги** – `ShiftOne` указывает, на сколько завершённых свечей назад берётся первое закрытие, `ShiftTwo` добавляет дополнительный сдвиг для второго закрытия.
- **Порог отклонения** – `MoveOnePoints` задаёт, насколько текущий Bid должен отклониться от первого закрытия, `MoveTwoPoints` измеряет расстояние между двумя историческими закрытиями.
- **Покупка** – когда текущий Bid как минимум на `MoveOnePoints` пунктов ниже первого закрытия, а первое закрытие не менее чем на `MoveTwoPoints` пунктов выше второго.
- **Продажа** – когда текущий Bid как минимум на `MoveOnePoints` пунктов выше первого закрытия, а первое закрытие не менее чем на `MoveTwoPoints` пунктов ниже второго.
- Сигналы проверяются только после формирования свечи. Если есть активные заявки или не хватает свободной маржи, новые сделки не открываются.

## Управление позицией
- **Имитируемые стопы** – вместо регистрации защитных заявок стратегия отслеживает цену входа и закрывает позицию, когда движение достигает:
  - `ProfitPoints` (с учётом текущего спреда) в прибыльную сторону;
  - `LossPoints` в убыточную сторону.
- **Трейлинг‑стоп** – при `TrailingPoints > 0` фиксируется лучший результат после входа. Откат на расстояние трейлинга приводит к закрытию позиции.
- **Одна позиция** – одновременно может существовать только одна открытая позиция; сигналы игнорируются, пока позиция не закрыта и нет активных заявок на выход.

## Управление объёмом
- **Фиксированный объём** – при выключенном `UseAutoLot` каждая сделка использует `FixedVolume` (корректируется под шаг и ограничения инструмента).
- **Автолот** – свободная маржа делится на `AutoMarginDivider * 1000` и округляется до ближайшего целого лота. Если подряд зафиксировано не менее двух убыточных сделок, объём уменьшается пропорционально `lossStreak / DecreaseFactor`, повторяя механику оригинального робота.
- Итоговый объём ограничивается диапазоном от `FixedVolume` до 99 лотов и приводится к допустимому шагу инструмента.

## Дополнительные детали
- Спред берётся из текущих лучших котировок и добавляется к тейк‑профиту, как в исходном МТ4‑советнике.
- Свободная маржа оценивается по `CurrentValue - BlockedValue`; при отсутствии данных используется текущая стоимость портфеля.
- Стратегия не добавляет собственных визуализаций и готова к запуску в конструкторе или напрямую в проекте API StockSharp.
