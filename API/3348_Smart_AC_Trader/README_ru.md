# Стратегия Smart AC Trader

## Обзор
Smart AC Trader переносит одноимённого эксперта MetaTrader в экосистему StockSharp. В исходном советнике рассчитывалась относительная сила валют в каждой паре и открывались сделки, когда базовая валюта становилась сильнее котируемой. В StockSharp мы сохраняем идею торговли по силе, но применяем её к одному инструменту, используя комбинацию экспоненциальных скользящих средних (EMA) и индикатора скорости изменения (ROC):

- Быстрая EMA отражает краткосрочное направление.
- Медленная EMA показывает основную тенденцию.
- ROC подтверждает наличие импульса в сторону тренда, прежде чем стратегия разрешит вход.

После открытия позиции стратегия управляет сделкой с помощью стоп-лосса, тейк-профита, трейлинг-стопа и логики перевода в безубыток, что перекликается с широкой системой управления капиталом оригинального эксперта.

## Логика торговли
1. Подписка на выбранный тип свечей и расчёт быстрой EMA, медленной EMA и ROC по закрытию свечи.
2. Открытие длинной позиции, когда быстрая EMA находится выше медленной и значение ROC не ниже порога для покупок. При наличии короткой позиции она закрывается перед разворотом.
3. Открытие короткой позиции, когда быстрая EMA находится ниже медленной и значение ROC не выше отрицательного порога для продаж. При наличии длинной позиции она закрывается перед разворотом.
4. Управление открытой позицией на каждой завершённой свече:
   - Закрытие по тейк-профиту или стоп-лоссу, выраженным в шагах цены.
   - При необходимости перевод в безубыток: после достижения заданной прибыли стратегия запоминает смещённый уровень и закрывает позицию при возврате цены.
   - При необходимости использование трейлинг-стопа с заданной дистанцией от максимума (для лонга) или минимума (для шорта), достигнутых после входа.

## Параметры
| Параметр | Описание |
|----------|----------|
| **Fast EMA** | Период быстрой EMA. |
| **Slow EMA** | Период медленной EMA. |
| **ROC Period** | Длина окна для индикатора ROC. |
| **Buy Momentum** | Минимальное положительное значение ROC для открытия лонга. |
| **Sell Momentum** | Минимальное отрицательное значение ROC (по модулю) для открытия шорта. |
| **Stop Loss** | Дистанция стоп-лосса в шагах цены. |
| **Take Profit** | Дистанция тейк-профита в шагах цены. |
| **Use Trailing** | Включение трейлинг-стопа. |
| **Trailing** | Дистанция трейлинг-стопа в шагах цены. |
| **Use Break Even** | Включение перевода в безубыток. |
| **Break Even Trigger** | Прибыль в шагах цены, необходимая для активации безубытка. |
| **Break Even Offset** | Смещение, сохраняемое после активации безубытка. |
| **Candle Type** | Тип свечей, используемых в расчётах. |

## Примечания
- При запуске вызывается `Strategy.StartProtection()`, что соответствует требованиям проекта по защите позиций.
- Размер позиции определяется через свойство `Strategy.Volume`. При смене направления учитывается текущая позиция, поэтому противоположные сигналы закрывают старую сделку и открывают новую.
- Все расстояния заданы в шагах цены — это аналог пунктов (pip) из MetaTrader. Перед использованием убедитесь, что у инструмента задан корректный `PriceStep`.
