# Стратегия ADX System DI Cross

## Обзор
Стратегия ADX System — это порт на StockSharp советника MetaTrader 4 `ADX_System.mq4`. Исходный эксперт сравнивает значение
Average Directional Index (ADX) с компонентами +DI и -DI на двух последних завершённых свечах. Когда линия +DI поднимается
выше значения ADX, система стремится открыть длинную позицию; когда линия -DI оказывается выше ADX, стратегия переходит в шорт.
Перенос на StockSharp сохраняет эту логику: значения индикатора из двух последних закрытых свечей сохраняются во внутренних
переменных, что полностью повторяет вызовы `iADX(..., shift=1/2)` в MetaTrader.

Одновременно может существовать только одна позиция. Вход и выход выполняются рыночными ордерами — это соответствует
«одному тикету» в неттинговом режиме MetaTrader. Управление рисками копирует оригинальный советник: фиксированные уровни
тейк-профита и стоп-лосса задаются в пунктах относительно средней цены входа, а опциональный трейлинг-стоп позволяет
зафиксировать прибыль при благоприятном движении цены.

## Торговая логика
1. Подписаться на выбранный таймфрейм (`CandleType`) и обрабатывать только закрытые свечи, исключая решения внутри бара.
2. Передавать данные свечей в индикатор `AverageDirectionalIndex` и ждать, пока станут доступны значения ADX, +DI и -DI.
3. Кэшировать показания индикатора по двум последним закрытым свечам, чтобы имитировать пары значений со сдвигом `shift = 1/2`
   из оригинального советника.
4. **Открытие лонга**: если более старый ADX (`shift = 2`) ниже более свежего (`shift = 1`), старое значение +DI находится ниже
   старого ADX, а новое значение +DI — выше нового ADX, отправить рыночную заявку на покупку.
5. **Открытие шорта**: при аналогичных условиях для компоненты -DI (старое -DI ниже старого ADX, новое -DI выше нового ADX)
   отправить рыночную заявку на продажу.
6. **Закрытие лонга**: закрыть позицию, если ADX начинает снижаться и +DI опускается обратно ниже него, либо срабатывает тейк-
   профит, стоп-лосс или трейлинг-стоп.
7. **Закрытие шорта**: зеркально повторяет логику выхода из лонга, используя компоненту -DI и настройки управления риском.
8. Обновлять историю индикатора после каждой свечи, чтобы на следующем шаге использовать актуальную пару `shift = 1/2`.

## Управление рисками
- `TakeProfitPoints` и `StopLossPoints` задают расстояния в пунктах по аналогии с MetaTrader. При наличии `Security.PriceStep`
  значения переводятся в цену; если шаг неизвестен, параметр трактуется как абсолютное изменение цены.
- Трейлинг-стоп (`TrailingStopPoints`) активируется только после того, как прибыль превышает заданное расстояние от цены входа.
  После активации уровень переносится вслед за ценой и закрывает позицию при пробое трейлинга.
- Все выходы (разворот по индикатору, тейк-профит, стоп-лосс, трейлинг-стоп) исполняются рыночными ордерами, что эквивалентно
  вызову `OrderClose` в оригинальном эксперте.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `CandleType` | `DataType` | Таймфрейм 1 минута | Основной таймфрейм, используемый стратегией. |
| `AdxPeriod` | `int` | `14` | Количество свечей для расчёта ADX и линий +DI/-DI. |
| `TradeVolume` | `decimal` | `1` | Объём рыночных заявок. |
| `TakeProfitPoints` | `decimal` | `100` | Дистанция тейк-профита в пунктах от цены входа. |
| `StopLossPoints` | `decimal` | `30` | Дистанция стоп-лосса в пунктах от цены входа. |
| `TrailingStopPoints` | `decimal` | `0` | Дистанция трейлинг-стопа в пунктах. Ноль отключает трейлинг. |

## Отличия от оригинального советника MetaTrader
- В MetaTrader позиции ведутся по отдельным тикетам, тогда как StockSharp работает с суммарной позицией. Поэтому перед открытием
  новой сделки стратегия сначала закрывает текущую позицию.
- В исходном коде использовалась переменная `Point` для перевода пунктов в цену. В версии на StockSharp используется
  `Security.PriceStep`, если он известен; иначе значение воспринимается как абсолютный шаг цены, и параметры стоит подбирать
  вручную для инструментов с нестандартными шагами.
- В MetaTrader трейлинг реализован через модификацию существующего ордера. Здесь позиция закрывается рыночной заявкой при
  пробое трейлинг-уровня, что проще в условиях неттинга и даёт аналогичный результат.

## Практические рекомендации
- Убедитесь, что объём (`TradeVolume`) соответствует шагу лота выбранного инструмента. Конструктор также присваивает это значение
  свойству `Strategy.Volume`, поэтому вспомогательные методы сразу используют правильный размер заявки.
- При торговле волатильными инструментами увеличивайте `TakeProfitPoints` и `StopLossPoints`, чтобы адаптировать уровни риска.
- Добавьте стратегию на график, чтобы визуально наблюдать свечи, индикатор ADX и сделки — так проще убедиться, что сигналы
  возникают при пересечении линий +DI/-DI с ADX.

## Индикаторы
- `AverageDirectionalIndex` (индекс направленного движения с компонентами +DI и -DI).
