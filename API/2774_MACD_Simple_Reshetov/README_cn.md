# MACD Simple Reshetov 策略

## 概述
该策略在 StockSharp 框架中复刻了 Yury Reshetov 的 “MACDSimple” MetaTrader 智能交易系统。策略只处理一个交易品种，通过两个偏移参数对经典 MACD 信号进行调整。算法仅在每根 K 线收盘后做出决策，确保所有判断都基于确认过的行情，从而避免分时噪声。

## 指标与计算
- **MACD（指数平滑移动平均线差值）** – MACD 主线与信号线的周期根据以下公式计算：
  - 快速 EMA 周期 = `SignalPeriod + DF`
  - 慢速 EMA 周期 = `SignalPeriod + DS + DF`
  - 信号线周期 = `SignalPeriod`
其中 `DF` 与 `DS` 延续了原始 EA 的输入参数，可以在保持结构关系的同时整体放大或压缩 MACD 组件。

## 参数
| 参数 | 说明 | 默认值 |
| ---- | ---- | ------ |
| `Volume` | 每次市价建仓使用的手数。 | 2 |
| `DF` | 加到 MACD 快速 EMA 长度上的偏移量，必须大于等于 0。 | 1 |
| `DS` | 加到 MACD 慢速 EMA 长度上的额外偏移量，必须大于等于 0。 | 2 |
| `SignalPeriod` | 生成快、慢 EMA 周期的基础周期。 | 10 |
| `CandleType` | 用于分析与交易的 K 线周期。 | 30 分钟 |

## 交易逻辑
### 仓位管理
1. 每根已完成的 K 线都会更新 MACD 指标；若指标尚未形成则跳过本根 K 线。
2. 持有**多单**时，一旦 MACD 主线跌破 0，立即以市价平掉全部多头仓位。
3. 持有**空单**时，一旦 MACD 主线上穿 0，立即以市价平掉全部空头仓位。
4. 在某根 K 线上完成平仓后，该根 K 线不再继续评估入场信号，与原始 EA 的处理方式一致。

### 入场规则
1. 仅当 MACD 主线与信号线同号（同为正或同为负）时才考虑入场，否则不交易。
2. 当两条线同为**正值**且主线高于信号线时，开多单。
3. 当两条线同为**负值**且主线低于信号线时，开空单。
4. 所有市价单的数量由 `Volume` 参数确定，任意时刻最多只持有一个方向的仓位。

### 离场规则
- 离场完全由 MACD 主线与 0 轴的反向穿越触发，不包含分批止盈、止损或移动止损等附加逻辑。

## 补充说明
- 策略在调用 `IsFormedAndOnlineAndAllowTrading()` 为真时才会进行新的开仓，确保有实时行情且允许交易。
- 默认不包含风控措施，用户可根据需要加入 `StartProtection()` 等保护机制或在组合层面设置风险控制。
- 由于 MACD 各项周期都由一个基础周期配合偏移量生成，调节 `SignalPeriod`、`DF` 或 `DS` 会同步影响所有组成部分，保持原策略预期的相对距离。

## 实现细节
- 指标绑定使用 StockSharp 的高阶 `SubscribeCandles().Bind()` 接口，实现事件驱动的处理流程。
- 转换遵循 `AGENTS.md` 中的要求：代码采用制表符缩进，在回调中直接消费指标数值，并通过 `BuyMarket`/`SellMarket` 完成下单。
- 代码结构简洁，可在不偏离原始 MetaTrader 策略逻辑的前提下进一步添加过滤器或风险控制模块。
