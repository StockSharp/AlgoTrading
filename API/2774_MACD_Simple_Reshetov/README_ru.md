# Стратегия MACD Simple Reshetov

## Общее описание
Стратегия переносит логику советника «MACDSimple» Юрия Решетова из MetaTrader в инфраструктуру StockSharp. Она работает с одним инструментом и использует классические сигналы MACD, модифицированные двумя параметрами-сдвигами. Анализ выполняется только после закрытия свечи, поэтому решения принимаются по подтверждённым данным без внутрибара шумов.

## Индикаторы и расчёты
- **MACD (Moving Average Convergence Divergence)** – главная линия и линия сигнала рассчитываются по формулам:
  - Период быстрой EMA = `SignalPeriod + DF`
  - Период медленной EMA = `SignalPeriod + DS + DF`
  - Период сигнальной линии = `SignalPeriod`
Параметры `DF` и `DS` сохранены из оригинального советника и позволяют растягивать или сжимать компоненты MACD, сохраняя их взаимное расположение.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `Volume` | Объём каждой рыночной сделки. | 2 |
| `DF` | Сдвиг для периода быстрой EMA MACD. Значение не может быть отрицательным. | 1 |
| `DS` | Дополнительный сдвиг для периода медленной EMA MACD. Значение не может быть отрицательным. | 2 |
| `SignalPeriod` | Базовый период, от которого рассчитываются обе EMA и сигнальная линия. | 10 |
| `CandleType` | Таймфрейм свечей, по которым ведётся анализ и торговля. | 30 минут |

## Правила торговли
### Управление позицией
1. На каждой завершённой свече стратегия обновляет MACD и пропускает обработку, если индикатор ещё не сформирован.
2. При открытой **длинной** позиции и значении MACD ниже нуля стратегия полностью закрывает лонг рыночной заявкой.
3. При открытой **короткой** позиции и значении MACD выше нуля стратегия полностью закрывает шорт рыночной заявкой.
4. После закрытия позиции на текущей свече дальнейшая обработка этой свечи прекращается – так работает исходный советник.

### Условия входа
1. Сделки рассматриваются только тогда, когда главная линия MACD и сигнальная линия имеют один знак (обе положительные или обе отрицательные).
2. Если обе линии **положительные** и главная линия выше сигнальной, открывается длинная позиция.
3. Если обе линии **отрицательные** и главная линия ниже сигнальной, открывается короткая позиция.
4. Все рыночные заявки выставляются объёмом `Volume`. Одновременно может быть открыта только одна позиция.

### Условия выхода
- Выход из рынка осуществляется исключительно при пересечении нулевого уровня линией MACD против открытой позиции. Дополнительные стопы или тейк-профиты не применяются.

## Дополнительные замечания
- Перед входом стратегия проверяет `IsFormedAndOnlineAndAllowTrading()`, чтобы убедиться в наличии данных и разрешении на торговлю.
- Защита капитала по умолчанию отсутствует. При необходимости можно добавить `StartProtection()` или внешние механизмы риск-менеджмента.
- Поскольку периоды MACD вычисляются от одного базового значения с учётом сдвигов, изменение `SignalPeriod`, `DF` или `DS` синхронно изменяет все компоненты, сохраняя пропорции оригинального советника.

## Реализация
- Используется высокоуровневый API StockSharp: подписка на свечи и привязка индикатора через `SubscribeCandles().Bind()`.
- При переносе соблюдены требования `AGENTS.md`: табуляция, работа с индикатором напрямую в обработчике, использование `BuyMarket` и `SellMarket` для сделок.
- Код легко расширить дополнительными фильтрами или блоками риск-менеджмента без нарушения исходной логики MetaTrader.
