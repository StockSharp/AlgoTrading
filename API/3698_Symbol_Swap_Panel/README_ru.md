# Стратегия «Symbol Swap Panel»

## Обзор
**Symbol Swap Panel Strategy** — это конвертация панели *«Symbol Swap Panel»* из MQL в среду StockSharp. Оригинальная панель позволяла вводить тикер, мгновенно переключать график и наблюдать в реальном времени цены открытия, максимума, минимума, закрытия, тиковый объём и спред. В новой реализации стратегия запускается на любом инструменте и выводит те же данные через логи, сохраняя возможность быстро переключаться на другую бумагу.

## Основное поведение
- Оформляет подписку на свечи и Level1 для активного инструмента.
- По каждой завершённой свече публикует подробный лог с ценами OHLC, суммарным объёмом и актуальным спредом.
- Кеширует котировки Bid/Ask и пересчитывает спред, как это делала исходная панель.
- Обрабатывает ручные запросы на смену инструмента и перестраивает подписки без перезапуска стратегии.
- Запоминает последний применённый символ, чтобы игнорировать повторные бессмысленные переключения.

## Параметры
| Название | Тип | Описание |
| --- | --- | --- |
| `TargetSecurityId` | `string` | Идентификатор инструмента, на который нужно переключиться при запросе. Пустая строка приводит к предупреждению и игнорируется. |
| `CandleType` | `DataType` | Тип свечей, используемый для периодических обновлений (по умолчанию часовые свечи — аналог исходного таймфрейма). |
| `SwapRequested` | `bool` | Флаг ручного переключения. Установка в `true` инициирует смену инструмента, после обработки автоматически возвращается в `false`. |

## Подписки на данные
- Свечи по текущему инструменту согласно параметру `CandleType`.
- Поток Level1 для отслеживания лучших цен и расчёта спреда.
- При смене инструмента старые подписки корректно останавливаются и заменяются новыми.

## Последовательность работы
1. При запуске стратегия использует `Strategy.Security`, либо пытается разрешить символ из `TargetSecurityId`.
2. Создаются подписки на свечи и Level1 для выбранного инструмента.
3. Каждая завершённая свеча генерирует лог с текстом, соответствующим оригинальным меткам панели.
4. Обновления Level1 поддерживают актуальные значения Bid/Ask и спреда.
5. Установка `SwapRequested = true` при валидном `TargetSecurityId` мгновенно переключает стратегию на новый инструмент и перезапускает подписки.

## Рекомендации по использованию
- Стратегия предназначена для мониторинга и не подаёт торговых заявок.
- Спред рассчитывается только при наличии положительных значений Bid и Ask.
- Невалидные или неизвестные тикеры вызывают предупреждение в логах, при этом текущие подписки не прерываются.
- Если требуется более частое обновление, уменьшите таймфрейм в параметре `CandleType`.

## Сохранённые возможности MQL-версии
- Ручное переключение инструмента по текстовому идентификатору.
- Отображение цен OHLC, объёма и спреда выбранного символа в реальном времени.
- Защита от пустых вводов и несуществующих символов (в StockSharp это предупреждения).

## Отличия от исходной реализации
- Вместо панельных надписей вся информация выводится в логах, что ближе к типичному сценарию использования StockSharp.
- Переключение реализовано через переназначение `Strategy.Security` и пересоздание подписок, а не через управление окном терминала.
- Таймер в MQL заменён обработкой закрытия свечей, чтобы использовать высокоуровневый API StockSharp.

## Требования
- Соединение StockSharp с доступом к нужным инструментам.
- Источник данных Level1 для вычисления спреда.
