# Стратегия Grid EA Pro

## Описание
**Grid EA Pro** реализует ключевые идеи одноимённого эксперта для MT4. Стратегия совмещает сеточное наращивание позиции с входами по RSI или таймеру и использует виртуальные уровни стоп-лосса, тейк-профита, перевода в безубыток и трейлинга. Реализация ориентирована на неттинг, поэтому одновременно поддерживается только одна совокупная позиция, а открытие сделки в противоположную сторону автоматически закрывает прежние ордера.

## Логика работы
- **Режим входа** – выбор между порогами RSI, таймером с фиксированной дистанцией или полностью ручным управлением (в этом случае стратегия только сопровождает позиции).
- **Фильтр направлений** – возможность торговать только в лонг, только в шорт или в обе стороны.
- **Сеточное наращивание** – после базового входа новые ордера выставляются при откате цены на заданное количество пунктов. Шаг сетки и объём заявок могут увеличиваться геометрически.
- **Управление рисками** – виртуальные уровни стоп-лосса, тейк-профита, перевода в безубыток и трейлинг-стоп повторяют поведение оригинального советника. Также доступен фильтр по времени торговой сессии.
- **Перекрытие позиций** – параметры оставлены для совместимости, но из-за неттинга одновременное удержание разнонаправленных позиций невозможно, поэтому логика перекрытия отключена.

## Параметры
| Имя | Описание |
| --- | --- |
| `Mode` | Разрешённое направление торговли (Buy, Sell, Both). |
| `EntryMode` | Источник сигналов (RSI, FixedPoints, Manual). |
| `RsiPeriod`, `RsiUpper`, `RsiLower` | Настройки RSI в режиме RSI. |
| `CandleType` | Тип свечей для сигналов и контроля риска. |
| `Distance`, `TimerSeconds` | Дистанция и интервал обновления уровней во временном режиме. |
| `InitialVolume`, `FromBalance`, `Risk %` | Блок управления объёмом. При ненулевом `Risk %` объём рассчитывается по капиталу и стоп-лоссу, иначе используется фиксированный или балансный лот. |
| `LotMultiplier`, `MaxLot` | Множитель и ограничение объёма сеточных ордеров. |
| `Step`, `StepMultiplier`, `MaxStep` | Настройки шага сетки в пунктах. |
| `OverlapOrders`, `OverlapPips` | Резерв под хеджевую логику (в текущей версии не применяется). |
| `Stop Loss`, `Take Profit` | Начальные уровни стоп-лосса и тейк-профита (`-1` отключает). |
| `Break Even Stop`, `Break Even Step` | Перевод в безубыток после прохождения указанного числа пунктов. |
| `Trailing Stop`, `Trailing Step` | Параметры трейлинг-стопа. |
| `Start Time`, `End Time` | Допустимое торговое окно в формате HH:mm. |

## Визуализация
При наличии области графика стратегия отображает свечи, линию RSI и собственные сделки, что облегчает сопоставление с оригинальным экспертом.

## Примечания
- Уровни для таймерного входа автоматически сбрасываются после исполнения или отключения направления.
- В неттинговой модели StockSharp новые сделки противоположного направления закрывают текущую позицию.
- Убедитесь, что свойства инструмента (`PriceStep`, `StepPrice`) соответствуют значениям, использовавшимся в MT4, чтобы пункты совпадали.
