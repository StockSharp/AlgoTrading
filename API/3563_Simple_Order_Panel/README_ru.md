# Стратегия Simple Order Panel

Порт утилиты MetaTrader 5 **SimpleOrderPanel**. Версия для StockSharp сохраняет логику ручного трейдинга и дополняет её возможностями высокоуровневого API: расчётом объёма по риску, быстрыми кнопками управления позицией и контролем защитных уровней.

## Основные возможности

- Ручные команды Buy/Sell с объёмом по фиксированной величине или по проценту от баланса счёта.
- Настраиваемый стоп-лосс и тейк-профит, задаваемые в абсолютных ценах или в «пунктах» MetaTrader.
- Быстрые кнопки: перенос стопа в безубыток, частичное закрытие, полное закрытие позиции.
- Эмуляция отложенных ордеров (limit/stop): указываем цену, и стратегия отправляет рыночный ордер при достижении уровня.
- Постоянный мониторинг входящих котировок Level1/сделок и автоматическое закрытие позиции при срабатывании стопа или цели.

## Параметры

| Имя | Описание | Значение по умолчанию |
| --- | -------- | --------------------- |
| `RiskCalculation` | `FixedVolume` использует значение `RiskValue` как есть. `BalancePercent` рассчитывает объём по проценту риска и дистанции до стопа. | `FixedVolume` |
| `RiskValue` | Объём в лотах либо процент от баланса (в зависимости от режима). | `0.1` |
| `StopTakeCalculation` | `PriceLevels` трактует значения как цены. `PointOffsets` умножает на размер пункта инструмента. | `PointOffsets` |
| `StopLossValue` | Значение стоп-лосса (цена или пункты). Ноль отключает защиту. | `300` |
| `TakeProfitValue` | Значение тейк-профита (цена или пункты). Ноль отключает цель. | `300` |
| `BuyMarketRequest` | Переключатель для открытия длинной позиции. | `false` |
| `SellMarketRequest` | Переключатель для открытия короткой позиции. | `false` |
| `BreakEvenRequest` | Переносит стоп в точку входа. | `false` |
| `ModifyStopRequest` | Повторно применяет настройки стоп-лосса. | `false` |
| `ModifyTakeRequest` | Повторно применяет настройки тейк-профита. | `false` |
| `CloseAllRequest` | Закрывает позицию любого направления. | `false` |
| `CloseBuyRequest` | Закрывает только длинную позицию. | `false` |
| `CloseSellRequest` | Закрывает только короткую позицию. | `false` |
| `PartialCloseRequest` | Закрывает часть позиции в объёме `PartialVolume`. | `false` |
| `PartialVolume` | Лоты для частичного закрытия. | `0.05` |
| `PlaceBuyPendingRequest` | Включает отложенный вход на покупку. | `false` |
| `PlaceSellPendingRequest` | Включает отложенный вход на продажу. | `false` |
| `PendingPrice` | Цена срабатывания отложенного входа. | `0` |
| `CancelPendingRequest` | Отменяет все активные отложенные заявки. | `false` |

Все булевы параметры следует переводить в `true` только на время исполнения команды. Стратегия автоматически возвращает их в `false` после обработки.

## Логика работы

1. **Расчёт риска.** При поступлении команды вычисляется объём: либо фиксированное значение, либо процент от капитала исходя из расстояния до стопа и `StepPrice` инструмента.
2. **Рыночные входы.** `BuyMarketRequest` и `SellMarketRequest` отправляют ордера, если рассчитанный объём проходит проверку и позиция ещё не открыта в том же направлении.
3. **Отложенные входы.** При активации сохраняется цена, объём и тип (stop/limit). Как только котировка удовлетворяет условию, отправляется рыночный ордер.
4. **Защитные уровни.** После открытия позиции сохраняется цена входа и рассчитываются уровни стопа/тейка. Обновления bid/ask (или последняя сделка) проверяют условия и при необходимости закрывают позицию.
5. **Утилиты управления.** Дополнительные переключатели закрывают позицию полностью, только длинную, только короткую или указанную долю. Кнопки безубытка и повторного применения стопа/тейка просто обновляют сохранённые уровни.

## Рекомендации

- Требуются котировки Level1: без них отложенные заявки не сработают.
- Для полного соответствия оригинальной панели используйте те же значения параметров и режим интерпретации стопа/тейка.
- Отложенные заявки эмулируются и не появляются в стакане до момента исполнения.
- Все действия журналируются, поэтому отслеживать работу стратегии удобно через окно логов StockSharp.
