# Exp Highs Lows Signal

## Обзор
Exp Highs Lows Signal — порт советника MetaTrader 5 `Exp_HighsLowsSignal`. Стратегия использует детектор последовательностей, который на выбранном таймфрейме ищет несколько подряд идущих свечей с более высокими максимумами и минимумами (бычья последовательность) или более низкими максимумами и минимумами (медвежья последовательность). После появления сигнала стратегия ждет заданное число закрытых баров, закрывает позицию в противоположном направлении и при необходимости открывает сделку по сигналу. Уровни стоп-лосса и тейк-профита задаются в шагах цены, что полностью повторяет точечную модель управления капиталом оригинального советника.

## Логика стратегии
### Детектор Highs/Lows
* Анализируются только завершенные свечи.
* **Бычий сигнал** возникает, если в `SequenceLength` последовательных сравнениях максимум и минимум каждой свечи строго выше, чем у предыдущей.
* **Медвежий сигнал** возникает, если в `SequenceLength` последовательных сравнениях максимум и минимум каждой свечи строго ниже, чем у предыдущей.
* Сигналы помещаются в очередь и исполняются после `SignalBarDelay` закрытых свечей — это эквивалент параметра `SignalBar` в версии для MT5.

### Правила входа
* **Покупка**
  * Срабатывает при появлении бычьей последовательности и включенном параметре `AllowLongEntry`.
  * При наличии короткой позиции она закрывается (если разрешен `AllowShortExit`), затем выставляется рыночная покупка объемом `OrderVolume + |Position|`, чтобы покрыть шорт и открыть требуемый лонг.
* **Продажа**
  * Срабатывает при появлении медвежьей последовательности и включенном параметре `AllowShortEntry`.
  * При наличии длинной позиции она закрывается (если разрешен `AllowLongExit`), затем выставляется рыночная продажа объемом `OrderVolume + |Position|`, чтобы покрыть лонг и открыть требуемый шорт.

### Правила выхода
* Бычий сигнал всегда инициирует `AllowShortExit` для закрытия коротких позиций.
* Медвежий сигнал всегда инициирует `AllowLongExit` для закрытия длинных позиций.
* Если соответствующий флаг отключен, позиция сохраняется — это позволяет вести одностороннюю торговлю или использовать стратегию в качестве индикатора.

### Управление рисками
* `StopLossTicks` и `TakeProfitTicks` задают расстояние в шагах цены. Значение `0` отключает соответствующий уровень.
* Метод `StartProtection` переводит расстояние в абсолютные цены, поэтому к каждой сделке автоматически привязываются стоп-лосс и тейк-профит.

## Параметры
* **OrderVolume** – базовый объем сделки при открытии позиции.
* **AllowLongEntry / AllowShortEntry** – разрешение на вход в лонг или шорт по сигналу.
* **AllowLongExit / AllowShortExit** – разрешение на закрытие противоположных позиций при появлении обратного сигнала.
* **StopLossTicks / TakeProfitTicks** – расстояние стоп-лосса и тейк-профита в шагах цены; `0` отключает уровень.
* **SequenceLength** – число последовательных сравнений, необходимое для подтверждения бычьей или медвежьей последовательности (аналог `HowManyCandles`).
* **SignalBarDelay** – количество закрытых свечей, на которое откладывается реакция на сигнал (аналог `SignalBar`).
* **CandleType** – таймфрейм, на котором рассчитывается детектор (по умолчанию 4 часа).

## Дополнительные замечания
* Стратегия хранит только минимальный объем истории, необходимый для детектора, поэтому поведение совпадает с оригинальным индикатором MT5.
* Все защитные заявки выставляются через `StartProtection`, что обеспечивает единообразное управление рисками в тестах и на реальном счете.
* Отключение соответствующих флагов `Allow` позволяет превратить стратегию в фильтр направлений или чисто сигнальный модуль.
* В данном пакете представлена только реализация на C#; Python-версия не поставляется.
