# AIS1 EURUSD Breakout 策略
[English](README.md) | [Русский](README_ru.md)

本策略将 AIS1 “A System: EURUSD Daily Metrics” 专家顾问迁移到 StockSharp 高级 API。它关注 EURUSD 对前一日区间的突破，并结合自适应仓位管理与 4 小时追踪止损。

## 策略概览

- **标的**：EURUSD 外汇现货/差价合约。
- **主时间框架**：日线蜡烛用于计算上一交易日的高、低、收盘价。
- **副时间框架**：4 小时蜡烛负责触发进场与更新追踪止损。
- **方向**：可做多亦可做空。
- **风格**：顺势突破，目标与止损均按波动性缩放。

## 交易逻辑

1. 每当新的日线收盘时，记录该日的最高价、最低价与收盘价，通过 `StopFactor` 与 `TakeFactor` 计算止损和止盈距离。
2. 对每根完成的 4 小时蜡烛进行检查：
   - **做多**：上一日收盘价位于上一日区间中值之上，并且当前 4 小时蜡烛的最高价突破上一日最高价。
   - **做空**：上一日收盘价低于区间中值，并且当前 4 小时蜡烛的最低价跌破上一日最低价。
3. 仓位规模依据账户当前权益与 `OrderReserve` 风险份额计算，再按交易品种的最小步长进行调整；若无法达到最小成交量，则放弃该信号。
4. 开仓后同时应用三个退出机制：
   - 按 `StopFactor` 倍数放置固定止损，位置在上一日区间的另一侧。
   - 按 `TakeFactor` 倍数设置固定止盈目标。
   - 通过上一根 4 小时蜡烛的波幅乘以 `TrailFactor` 计算追踪止损，仅在浮动盈利时生效。
5. 每次开仓或平仓后都会等待 5 秒再处理新的操作，从而与原始 MQL 逻辑保持一致并避免频繁改单。

## 风险管理

- `OrderReserve` 表示单笔交易可承受的最大权益比例，直接决定止损距离对应的资金风险。
- `AccountReserve` 记录账户历史最高权益，一旦当前权益回撤超过 `AccountReserve - OrderReserve`（默认约为 16%），策略将暂停新的交易及追踪操作，直至权益恢复。
- 即使触发了暂停，已有仓位仍会按照止损、止盈或追踪止损规则在蜡烛内执行市价离场。

## 参数说明

| 参数 | 含义 |
|------|------|
| `AccountReserve` | 用于计算允许回撤的权益占比，超过该阈值后停止交易。 |
| `OrderReserve` | 单笔交易可投入的权益比例，用于推导仓位大小。 |
| `TakeFactor` | 上一日波幅的倍数，用于设置固定止盈距离。 |
| `StopFactor` | 上一日波幅的倍数，用于设置固定止损距离。 |
| `TrailFactor` | 上一根 4 小时波幅的倍数，用于更新追踪止损。 |
| `EntryCandleType` | 用于计算突破水平的蜡烛类型（默认日线）。 |
| `TrailCandleType` | 用于检查信号与追踪的蜡烛类型（默认 4 小时）。 |

## 转换说明

- 原始 EA 在每个报价上执行逻辑；此实现改为在 4 小时蜡烛收盘时触发，符合 StockSharp 高级 API 的推荐用法并提升稳定性。
- 止损、止盈与追踪止损在检测到价格穿越目标水平后，通过市价单完成平仓。
- MQL 版本基于保证金的检查被统一替换为权益驱动的风险计算，以便在不同券商/账户环境下保持一致表现。
