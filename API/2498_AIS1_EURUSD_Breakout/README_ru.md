# Стратегия AIS1 EURUSD Breakout
[English](README.md) | [中文](README_cn.md)

Эта стратегия переносит эксперт-советник AIS1 «A System: EURUSD Daily Metrics» на платформу StockSharp. Сделки открываются по пробою диапазона предыдущего дня, при этом используется адаптивный расчёт объёма позиции и трейлинг-стоп на четырёхчасовом таймфрейме.

## Общее описание

- **Инструмент**: EURUSD (форекс, CFD).
- **Основной таймфрейм**: дневные свечи определяют ориентиры (high/low/close).
- **Вспомогательный таймфрейм**: четырёхчасовые свечи задают момент входа и обновление трейлинг-стопа.
- **Направление**: допускаются длинные и короткие позиции.
- **Тип стратегии**: пробойная с волатильностными целями и защитой прибыли.

## Логика торговли

1. После закрытия каждой дневной свечи сохраняются максимум, минимум и цена закрытия. На их основе вычисляется средняя цена, диапазон и расстояния до стоп-лосса/тейк-профита через множители `StopFactor` и `TakeFactor`.
2. Каждая завершённая четырёхчасовая свеча анализируется на предмет пробоя:
   - **Лонг**: цена закрытия предыдущего дня выше средней, а максимум текущей Н4 свечи превышает максимум предыдущего дня.
   - **Шорт**: цена закрытия предыдущего дня ниже средней, а минимум текущей Н4 свечи опускается ниже минимума предыдущего дня.
3. Объём позиции рассчитывается от текущей стоимости портфеля и доли риска `OrderReserve`. Объём корректируется по шагу торгового инструмента; если минимальный объём недостижим, вход пропускается.
4. Для открытых сделок действует тройной механизм выхода:
   - Фиксированный стоп-лосс на противоположной границе дневного диапазона (`StopFactor`).
   - Фиксированный тейк-профит на расстоянии `TakeFactor` × дневной диапазон.
   - Динамический трейлинг-стоп: используется диапазон предыдущей Н4 свечи, умноженный на `TrailFactor`, и активируется только при положительной плавающей прибыли.
5. Пятисекундная задержка после любой сделки или модификации повторяет поведение MQL-версии и предотвращает избыточные заявки.

## Управление рисками

- `OrderReserve` задаёт долю капитала, которую можно потерять в одной сделке. Значение автоматически ограничивается минимальным и максимальным объёмом инструмента.
- `AccountReserve` отслеживает пиковую стоимость портфеля. Когда просадка превышает `AccountReserve - OrderReserve` (по умолчанию 16%), стратегия перестаёт открывать и сопровождать позиции до восстановления капитала.
- Даже при остановке из-за просадки существующие позиции закрываются по стоп-лоссу, тейк-профиту или трейлинг-стопу.

## Параметры

| Параметр | Описание |
|----------|----------|
| `AccountReserve` | Доля капитала, исключаемая из расчёта и определяющая допустимую просадку. |
| `OrderReserve` | Максимальная доля капитала, рискуемая в одной сделке. |
| `TakeFactor` | Множитель дневного диапазона для вычисления тейк-профита. |
| `StopFactor` | Множитель дневного диапазона для вычисления стоп-лосса. |
| `TrailFactor` | Множитель диапазона предыдущей Н4 свечи для расчёта трейлинг-стопа. |
| `EntryCandleType` | Тип свечей для расчёта уровней пробоя (по умолчанию дневные). |
| `TrailCandleType` | Тип свечей для трейлинга и контроля условий (по умолчанию четырёхчасовые). |

## Особенности конверсии

- В MQL версия реагировала на каждый тик. В StockSharp входы и обновления трейлинга выполняются по завершению Н4 свечей, что соответствует рекомендациям high-level API и упрощает тестирование.
- Стоп-лосс, тейк-профит и трейлинг реализованы рыночным выходом при достижении уровня внутри обработанной свечи.
- Проверки маржи заменены на расчёт риска через текущую стоимость портфеля, что делает стратегию независимой от конкретного брокера.
