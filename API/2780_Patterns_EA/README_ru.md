# Стратегия Patterns EA

## Обзор
Patterns EA Strategy — это прайс-экшен система, которая анализирует три последние закрытые свечи и ищет широкий набор одно-, двух- и трёхсвечных формаций. Логика представляет собой порт оригинального советника MQL5 «Patterns_EA» и сохраняет его настраиваемый каталог из 30 свечных моделей. Каждую фигуру можно включать или отключать отдельно, а также назначать ей направление сделки (покупка или продажа), что позволяет воспроизвести дискреционные правила исходного скрипта.

## Группы паттернов
Детектор оценивает текущую свечу и до двух предыдущих в зависимости от выбранной группы:

- **Группа 1 – одно-свечные паттерны:** Neutral Bar, Force Bar Up, Force Bar Down, Hammer, Shooting Star.
- **Группа 2 – двухсвечные паттерны:** Inside, Outside, Double Bar High Lower Close, Double Bar Low Higher Close, Mirror Bar, Bearish Harami, Bearish Harami Cross, Bullish Harami, Bullish Harami Cross, Dark Cloud Cover, Doji Star, Engulfing Bearish Line, Engulfing Bullish Line, Two Neutral Bars.
- **Группа 3 – трёхсвечные паттерны:** Double Inside, Pin Up, Pin Down, Pivot Point Reversal Up, Pivot Point Reversal Down, Close Price Reversal Up, Close Price Reversal Down, Evening Star, Morning Star, Evening Doji Star, Morning Doji Star.

Параметр «Equality Pips» задаёт допустимое расхождение цен для проверки равенства и полностью повторяет настройку максимального расстояния в пунктах из исходного советника.

## Параметры
- **Candle Type** – таймфрейм свечей, по которым ведётся поиск.
- **Opened Mode** – режим управления позицией (Any, Swing, Buy One, Buy Many, Sell One, Sell Many), перенесённый из MQL-версии.
- **Equality Pips** – расстояние в пунктах, при котором цены считаются равными; масштабируется согласно шагу цены инструмента.
- **Enable One/Two/Three-Bar Patterns** – включение соответствующих групп паттернов.
- **Enable {Pattern}** – индивидуальные переключатели для каждой из 30 фигур.
- **{Pattern} Order** – направление сделки (покупка или продажа), привязанное к конкретному паттерну.

Все параметры реализованы через `StrategyParam`, поэтому их можно оптимизировать или выводить в пользовательский интерфейс StockSharp.

## Логика торговли
1. Стратегия подписывается на выбранную свечную серию и ждёт закрытия баров.
2. После появления новой закрытой свечи кешируются три последних бара и запускается проверка включённых групп паттернов.
3. Каждая фигура проверяется по тем же условиям, что и в MQL5-версии, включая допускаемые отклонения и соотношения тел/теней.
4. При подтверждении паттерна метод `TriggerPattern` проверяет, что группа и сам паттерн активны, оценивает выбранное направление и применяет заданный режим управления позицией.
5. В результате отправляется рыночная заявка в указанную сторону. В режиме Swing перед входом стратегия закрывает позицию противоположного знака.

## Режимы позиций
- **Any:** допускает сигналы в обе стороны без ограничений.
- **Swing:** поддерживает только одну чистую позицию; противоположный сигнал закрывает текущую позицию и открывает новую.
- **Buy One / Sell One:** разрешают только одну длинную или короткую позицию соответственно.
- **Buy Many / Sell Many:** позволяют многократные входы в выбранном направлении и игнорируют противоположные сигналы.

## Примечания
- Для пересчёта допустимого отклонения используется `Security.PriceStep`. Если шаг цены не задан, применяется значение по умолчанию 0.0001.
- Дополнительные индикаторы не требуются — логика полностью основана на геометрии свечей, что соответствует замыслу оригинального советника.
