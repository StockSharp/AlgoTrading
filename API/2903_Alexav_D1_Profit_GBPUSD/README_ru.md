# Стратегия Alexav D1 Profit GBPUSD
[English](README.md) | [中文](README_cn.md)

Дневная стратегия по GBP/USD, сочетающая EMA по максимумам свечи, фильтр RSI, подтверждение импульса MACD и управление риском через ATR. Реализация повторяет оригинальный советник MetaTrader с четырьмя частичными фиксингами прибыли и переводом стопа в безубыток.

## Основные сведения

- **Рынок**: пара GBP/USD (спот или CFD)
- **Таймфрейм**: дневные свечи (настраивается)
- **Направление**: длинные и короткие позиции
- **Стиль управления**: пакет из четырёх ордеров с общим стопом
- **Используемые индикаторы**: EMA по High, RSI, основная линия MACD, ATR

## Настройка индикаторов

1. **EMA по максимумам** – период 6, служит линией пробоя.
2. **RSI** – период 10, задаёт диапазоны допустимого импульса.
3. **MACD (главная линия)** – fast 5, slow 21, signal 14; используется наклон основной линии.
4. **ATR** – период 28, вычисляет волатильностные стопы и цели.

## Логика входа

### Длинные позиции

1. Предыдущая дневная свеча открылась ниже EMA(High) и закрылась выше – факт пробоя вверх.
2. RSI находится между **60** и **80**, что исключает слабый импульс и перекупленность.
3. Выполнено одно из условий по MACD:
   - Значение MACD две свечи назад отрицательное (тренд только что сменился вверх); или
   - Относительное снижение |MACD| за последние две свечи превышает порог **MacdDiffBuy** (0.5 по умолчанию).

При выполнении условий стратегия закрывает шорты и выставляет четыре одинаковых рыночных ордера на покупку (по умолчанию 0.1 лота каждый).

### Короткие позиции

1. Свеча открылась выше EMA(High) и закрылась ниже неё.
2. RSI находится между **25** и **39** – зеркальный фильтр для шортов.
3. MACD две свечи назад положительный либо относительное изменение |MACD| превышает **MacdDiffSell** (0.15 по умолчанию).

После подтверждения закрываются лонги и выставляются четыре равных рыночных ордера на продажу.

## Управление позицией

- **Стоп-лосс**: общий для пакета, рассчитывается как `entry ± ATR * StopLossMultiplier` (1.6 по умолчанию, знак зависит от направления).
- **Частичное закрытие**: четыре цели по ATR с коэффициентами `1.0`, `1.5`, `2.0`, `2.5`, умноженными на `TakeProfitMultiplier` (по умолчанию 1). При достижении каждая цель закрывает четверть исходного объёма.
- **Перевод в безубыток**: после каждого тейк-профита стоп переносится на цену сработавшего тейка, что полностью повторяет логику оригинального советника.
- **Отработка стопа**: если максимум/минимум свечи пересекает уровень защиты, остаток позиции закрывается рыночным ордером.

## Особенности контроля риска

- Стратегия не наращивает позицию сверх четырёх стартовых ордеров; новые сигналы игнорируются, пока сохраняется позиция в том же направлении.
- Сигналы появляются только после формирования ATR и MACD (значение ATR должно быть > 0).
- Изменение параметров во время работы влияет лишь на будущие сделки; объём каждой доли фиксируется при входе для корректного выхода.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `OrderVolume` | Объём одной рыночной заявки | `0.1` |
| `EmaPeriod` | Период EMA по максимумам | `6` |
| `RsiPeriod` | Период RSI | `10` |
| `AtrPeriod` | Период ATR | `28` |
| `StopLossMultiplier` | Множитель ATR для стоп-лосса | `1.6` |
| `TakeProfitMultiplier` | Базовый множитель ATR для целей | `1.0` |
| `MacdFastPeriod` | Быстрый период MACD | `5` |
| `MacdSlowPeriod` | Медленный период MACD | `21` |
| `MacdSignalPeriod` | Период сигнальной линии MACD | `14` |
| `MacdDiffBuyThreshold` | Минимальный прирост наклона MACD для лонга | `0.5` |
| `MacdDiffSellThreshold` | Минимальный прирост наклона MACD для шорта | `0.15` |
| `RsiUpperLimit` | Верхняя граница RSI для входа в лонг | `80` |
| `RsiUpperLevel` | Нижняя граница RSI для входа в лонг | `60` |
| `RsiLowerLevel` | Верхняя граница RSI для входа в шорт | `39` |
| `RsiLowerLimit` | Нижняя граница RSI для входа в шорт | `25` |
| `CandleType` | Тип подписываемых свечей | `1 Day` |

## Практические рекомендации

- Оптимизируйте фильтры RSI и MACD совместно: чрезмерное расширение диапазона RSI без корректировки MACD приводит к шуму.
- Точность исторических максимумов/минимумов критична для реалистичных бэктестов, так как выходы зависят от экстремумов свечи.
- Учтите, что на каждое срабатывание создаётся до четырёх одновременных ордеров — требуется соответствующий размер депозита.
