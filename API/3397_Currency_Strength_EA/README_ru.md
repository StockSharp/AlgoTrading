# Стратегия Currency Strength EA

## Обзор

Стратегия является портом MetaTrader "Currency Strength EA" на платформу StockSharp. Она отслеживает корзину основных форекс-пар, вычисляет относительную силу каждой валюты и торгует выбранным инструментом, когда базовая валюта сильная, а котируемая слабая (или наоборот). Реализация использует высокоуровневые API StockSharp и рассчитана на дальнейшую адаптацию.

## Логика торговли

1. Подписка на свечи всех пар из корзины и на основной торгуемый инструмент.
2. После закрытия каждой свечи корзины рассчитывается отношение цены закрытия к диапазону максимум/минимум за окно наблюдения. При необходимости применяется треугольное или простое сглаживание.
3. Отношение переводится в шкалу силы от 0 до 9 (значение 9 соответствует сильнейшему движению).
4. Суммарная сила по каждой валюте определяется усреднением вкладов всех пар.
5. Когда сила базовой валюты превышает верхний порог, а сила котируемой опускается ниже нижнего порога — открывается длинная позиция. При обратных условиях открывается короткая позиция.
6. Защитные стопы, тейк-профиты и опциональный трейлинг рассчитываются на основе ATR или пунктов.

Позиции закрываются либо разворачиваются при появлении противоположного сигнала. Трейлинг-стоп подтягивается по мере роста прибыли.

## Параметры

| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Тип свечей для торговых сигналов. | 30-минутные свечи |
| `StrengthCandleType` | Тип свечей для расчёта силы. | 4-часовые свечи |
| `CurrencyPairs` | Список валютных пар корзины. | Основные пары и кроссы |
| `NumberOfCandles` | Длина окна расчёта диапазона. | 55 |
| `ApplySmoothing` | Включает сглаживание коэффициента. | `true` |
| `TriangularWeighting` | Использует линейное взвешивание при сглаживании. | `true` |
| `UpperLimit` | Порог, при котором валюта считается сильной. | `7.2` |
| `LowerLimit` | Порог, при котором валюта считается слабой. | `3.3` |
| `AtrPeriod` | Период ATR для управления рисками. | `14` |
| `StopMode` | Режим расчёта дистанций (ATR или пункты). | `InAtr` |
| `StopLossFactor` | Множитель стоп-лосса (`0` отключает). | `0` |
| `TakeProfitFactor` | Множитель тейк-профита (`0` отключает). | `1` |
| `TrailingStop` | Размер трейлинг-стопа в пунктах. | `30` |
| `TrailingStep` | Минимальное движение для обновления трейлинга. | `5` |
| `StartTime` / `EndTime` | Торговая сессия (HH:mm). | `10:00` / `16:00` |
| `TimeMode` | Часы для контроля сессии (серверные, GMT, локальные). | `Server` |
| `BaseCurrency` | Код базовой валюты торгуемого инструмента. | `EUR` |
| `QuoteCurrency` | Код котируемой валюты торгуемого инструмента. | `USD` |

## Управление рисками

- Стоп-лосс и тейк-профит рассчитываются по ATR или размеру шага цены в зависимости от режима.
- Трейлинг-стоп работает независимо от фиксированного стопа.
- При отключенных защитных уровнях выход выполняется по встречному сигналу.

## Ограничения и особенности

- Стратегия торгует только установленным инструментом `Security`. Для нескольких инструментов запустите дополнительные экземпляры.
- Функции усреднения и агрессивного мани-менеджмента из оригинала не перенесены намеренно.
- При включённом сглаживании новые значения силы появляются только после формирования индикатора.
- Убедитесь, что все пары корзины доступны у брокера; отсутствующие инструменты выводятся в лог.

## Рекомендации по использованию

1. Перед запуском задайте инструмент и портфель стратегии.
2. При необходимости добавьте префиксы/суффиксы в строку `CurrencyPairs`, чтобы она совпадала с обозначениями брокера.
3. На этапе тестирования подберите пороги силы и параметры ATR под вашу торговую модель.
