# 货币强度 EA 策略

## 概览

该策略是 MetaTrader "Currency Strength EA" 的 StockSharp 版本。它订阅一篮子主要外汇货币对，计算每种货币的相对强弱，并在基准货币强、报价货币弱（或相反）时对指定标的进行交易。实现基于高层级 StockSharp API，便于阅读和扩展。

## 交易逻辑

1. 订阅强度篮子中的所有货币对以及用于交易的标的。
2. 在每根强度 K 线收盘后，计算收盘价相对于近期高低区间的比例，并可选地对比例进行线性或简单平滑处理。
3. 将比例转换为 0-9 的强度评分（9 表示最强）。
4. 对所有货币对的评分进行汇总，得到每种货币的平均强度。
5. 当基准货币强度高于上限且报价货币强度低于下限时开多单；当条件反向出现时开空单。
6. 使用 ATR 或点值距离设置止损、止盈，并可配置跟踪止损。

当出现反向信号时策略会平仓或反向入场。跟踪止损会在走势有利时逐步收紧保护。

## 参数

| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `CandleType` | 交易信号使用的 K 线类型。 | 30 分钟 K 线 |
| `StrengthCandleType` | 计算强度所用的 K 线类型。 | 4 小时 K 线 |
| `CurrencyPairs` | 强度篮子中的货币对列表。 | 主要货币对与交叉盘 |
| `NumberOfCandles` | 强度窗口长度。 | 55 |
| `ApplySmoothing` | 是否对比例进行平滑。 | `true` |
| `TriangularWeighting` | 平滑时是否使用线性权重。 | `true` |
| `UpperLimit` | 判定货币“强势”的阈值。 | `7.2` |
| `LowerLimit` | 判定货币“弱势”的阈值。 | `3.3` |
| `AtrPeriod` | ATR 风险管理窗口。 | `14` |
| `StopMode` | 风险距离基于 ATR 还是点值。 | `InAtr` |
| `StopLossFactor` | 止损倍数，为 `0` 表示关闭止损。 | `0` |
| `TakeProfitFactor` | 止盈倍数，为 `0` 表示关闭止盈。 | `1` |
| `TrailingStop` | 跟踪止损距离（点）。 | `30` |
| `TrailingStep` | 更新跟踪止损所需的最小价格移动（点）。 | `5` |
| `StartTime` / `EndTime` | 交易时段（HH:mm）。 | `10:00` / `16:00` |
| `TimeMode` | 使用的时钟（服务器、GMT、本地）。 | `Server` |
| `BaseCurrency` | 交易标的的基准货币代码。 | `EUR` |
| `QuoteCurrency` | 交易标的的报价货币代码。 | `USD` |

## 风险管理

- 止损和止盈可基于 ATR 或价格步长计算。
- 跟踪止损与固定止损独立，可单独启用。
- 当未设置止损/止盈时，策略依靠反向信号退出。

## 注意事项

- 策略仅在设置的 `Security` 上下单，如需交易多个品种请运行多个实例。
- 原 EA 中的马丁增仓和资金管理功能未移植，目的是保持策略清晰。
- 启用平滑时，只有当平滑指标完成计算后才会生成强度值。
- 请确保篮子中的所有货币对都能在连接中订阅，否则日志会提示缺失的标的。

## 使用建议

1. 启动前设置好交易标的与投资组合。
2. 如经纪商使用前后缀，请在 `CurrencyPairs` 中进行调整。
3. 在回测中调节强度阈值和 ATR 参数，以匹配所需的交易风格。
