# Стратегия Cycle Lines

## Обзор

Cycle Lines — порт советника MetaTrader "Cycle Lines" на платформу StockSharp. В оригинале скрипт совмещал отрисовку объектов на графике и ручные кнопки для открытия сделок. При переносе сохранена автоматическая логика сопровождения позиций: торговля ведётся по пересечениям линии MACD и сигнальной линии с обязательным контролем риска через фиксированные стоп-лосс/тейк-профит, защиту безубыточностью и скользящий стоп.

Когда линия MACD пересекает сигнальную линию снизу вверх, стратегия открывает длинную позицию. Пересечение сверху вниз приводит к открытию короткой позиции. Любой противоположный сигнал индикатора или срабатывание защитных правил немедленно закрывает активную позицию.

## Правила торговли

1. **Вход в рынок**
   - Лонг: MACD пересекает сигнальную линию вверх на выбранной серии свечей.
   - Шорт: MACD пересекает сигнальную линию вниз.
   - Сигналы анализируются только после формирования индикатора и при разрешении торговли.
2. **Выход из рынка**
   - Обратное пересечение MACD и сигнальной линии.
   - Достижение стоп-лосса.
   - Достижение тейк-профита.
   - Возврат к уровню безубытка.
   - Срабатывание трейлинг-стопа.

## Параметры

| Имя | Описание | Значение по умолчанию | Примечание |
| --- | -------- | --------------------- | ---------- |
| `Volume` | Объём заявки. | `1` | Должен быть больше нуля. |
| `MacdFastPeriod` | Быстрая EMA в MACD. | `12` | Можно оптимизировать. |
| `MacdSlowPeriod` | Медленная EMA в MACD. | `26` | Можно оптимизировать. |
| `MacdSignalPeriod` | Период сигнальной линии MACD. | `9` | Можно оптимизировать. |
| `StopLoss` | Абсолютная дистанция стоп-лосса. | `0` | 0 — отключено. |
| `TakeProfit` | Абсолютная дистанция тейк-профита. | `0` | 0 — отключено. |
| `TrailingOffset` | Отступ трейлинг-стопа от лучшей цены. | `0` | 0 — отключено. |
| `BreakEvenTrigger` | Прибыль, необходимая для перевода в безубыток. | `0` | 0 — отключено. |
| `BreakEvenOffset` | Дополнительный отступ при переводе в безубыток. | `0` | Позволяет зафиксировать часть прибыли. |
| `CandleType` | Тип свечей для расчёта индикаторов. | Свечи 15 минут | Поддерживает любой `DataType`. |

## Сопровождение позиции

- **Стоп-лосс / тейк-профит.** Уровни проверяются по экстремумам завершённой свечи, чтобы сохранять заданную дистанцию от цены входа.
- **Безубыток.** После движения цены на `BreakEvenTrigger` пунктов стоп переносится к `вход ± BreakEvenOffset`. Обратное движение, коснувшись уровня, закрывает позицию.
- **Трейлинг-стоп.** Для лонгов отслеживается максимум, для шортов — минимум. Стоп следует за экстремумом с отступом `TrailingOffset`.

## Рекомендации по использованию

- Стратегия всегда имеет не более одной позиции. Новые сигналы не добавляют объём к существующей сделке.
- Все параметры представлены через `StrategyParam<T>`, поэтому их можно оптимизировать стандартными инструментами StockSharp.
- Для воссоздания поведения оригинального советника используйте периоды MACD `12 / 26 / 9` и подберите риск-параметры в абсолютных ценовых величинах.

## Отличия от MQL-версии

- Убраны графические объекты и ручные кнопки — реализация сосредоточена на автоматическом сопровождении позиций.
- Защитные механизмы переведены на работу с завершёнными свечами и высокоуровневым API StockSharp.
- Логика безубытка и трейлинг-стопа симметрична для покупок и продаж для повышения устойчивости и прозрачности.
