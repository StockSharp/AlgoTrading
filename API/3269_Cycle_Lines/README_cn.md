# Cycle Lines 策略

## 概述

Cycle Lines 策略是 MetaTrader "Cycle Lines" 专家顾问在 StockSharp 平台上的移植版本。原始脚本除了下单逻辑外，还负责在图表上绘制循环线并提供手动买卖按钮。本移植版本保留并强化了其中的自动化交易思想：通过 MACD 线与信号线的交叉来生成方向信号，同时使用绝对止损、止盈、保本和追踪止损来保护仓位。

当 MACD 主线向上穿越信号线时，策略建立多头；当 MACD 主线向下穿越信号线时，策略建立空头。若指标反向或者任一保护规则触发，持仓会被立即平仓。

## 交易规则

1. **入场条件**
   - 多头：MACD 主线向上交叉信号线。
   - 空头：MACD 主线向下交叉信号线。
   - 仅在指标完成计算且策略处于连接、允许交易状态时评估信号。
2. **离场条件**
   - MACD 与信号线发生反向交叉。
   - 触发止损距离。
   - 触发止盈距离。
   - 触发保本线。
   - 触发追踪止损线。

## 参数说明

| 名称 | 描述 | 默认值 | 备注 |
| ---- | ---- | ------ | ---- |
| `Volume` | 每次下单的交易量。 | `1` | 必须为正数。 |
| `MacdFastPeriod` | MACD 快速 EMA 周期。 | `12` | 支持优化。 |
| `MacdSlowPeriod` | MACD 慢速 EMA 周期。 | `26` | 支持优化。 |
| `MacdSignalPeriod` | MACD 信号线周期。 | `9` | 支持优化。 |
| `StopLoss` | 绝对价格止损距离。 | `0` | 为 `0` 时禁用。 |
| `TakeProfit` | 绝对价格止盈距离。 | `0` | 为 `0` 时禁用。 |
| `TrailingOffset` | 追踪止损相对最佳价的距离。 | `0` | 为 `0` 时禁用。 |
| `BreakEvenTrigger` | 启动保本保护所需的盈利距离。 | `0` | 为 `0` 时禁用。 |
| `BreakEvenOffset` | 保本位移的额外偏移量。 | `0` | 可用于锁定额外利润。 |
| `CandleType` | 指标使用的 K 线类型。 | 15 分钟时间框 | 可配置为任意 `DataType`。 |

## 仓位管理

- **止损 / 止盈：** 依据完结 K 线的最高价和最低价进行检查，确保与入场价的绝对距离满足设定值。
- **保本：** 当价格朝有利方向运行达到 `BreakEvenTrigger` 时，将保本线设置在 `入场价 ± BreakEvenOffset`，回撤触及即平仓。
- **追踪止损：** 多头跟踪最高价减去 `TrailingOffset`，空头跟踪最低价加上 `TrailingOffset`，形成对称的保护。

## 使用提示

- 策略一次只持有一个方向的仓位，不会加仓或金字塔式建仓。
- 全部参数通过 `StrategyParam<T>` 暴露，可在 StockSharp 优化器中直接调整。
- 若想接近原始 EA 的默认配置，可使用 `12 / 26 / 9` 的 MACD 周期，并将风险参数换算为所需的点值后填入。

## 与 MQL 版本的差异

- 去除了图表绘图和手动按钮，改为纯粹的自动化策略。
- 所有保护逻辑改为基于完结 K 线的高低价进行计算，以便与 StockSharp 的高级 API 协作。
- 追踪止损与保本逻辑针对多空方向实现完全对称，提升稳健性与易读性。
