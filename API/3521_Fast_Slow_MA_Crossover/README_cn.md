# 快慢均线交叉策略

## 概述

**快慢均线交叉策略** 复刻了 MetaTrader 4 专家顾问 `_HPCS_FastSlowMACrosssover_MT4_EA_V01_WE` 的核心思想。策略订阅所选的K线类型，并对两条指数移动平均线 (EMA) 进行比较：当较快均线在允许的交易时间窗口内上穿或下穿较慢均线时，策略开仓交易。止盈和止损距离以点值（pip）定义，从而与依赖报价小数位的原始 MQL 逻辑保持一致。

## 交易逻辑

1. 订阅配置的K线类型（默认：1分钟K线）。
2. 计算两条EMA：
   - 快速EMA周期（默认 **14**）。
   - 慢速EMA周期（默认 **21**）。
3. 在每根已完成的K线上执行以下检查：
   - 判断K线收盘时间是否位于允许的交易时间窗口内。
   - 当快速EMA上穿慢速EMA时识别出 **看涨交叉**。
   - 当快速EMA下穿慢速EMA时识别出 **看跌交叉**。
4. 执行交易：
   - 如果存在反向仓位，先行平仓。
   - 按照 **Trade Volume** 参数规定的数量发送市价单。
   - 使用K线收盘价作为入场价格，用于计算风险控制水平。
5. 使用K线的最高价和最低价管理持仓：
   - 多头仓位下穿入场价 **Stop Loss (pips)** 距离时立即平仓。
   - 多头仓位上穿入场价 **Take Profit (pips)** 距离时立即平仓。
   - 空头仓位按照对称逻辑处理（止损在入场价上方，止盈在入场价下方）。

## 参数

| 参数 | 说明 |
|------|------|
| **Fast MA Period** | 快速EMA的周期长度，用于判定交叉。 |
| **Slow MA Period** | 慢速EMA的周期长度。 |
| **Take Profit (pips)** | 以点值表示的止盈距离，用于计算多空目标价。 |
| **Stop Loss (pips)** | 以点值表示的止损距离。 |
| **Start Time** | 每日交易窗口的起始时间（包含）。 |
| **Stop Time** | 每日交易窗口的结束时间（包含）。 |
| **Candle Type** | 用于计算指标的K线类型。 |
| **Trade Volume** | 每次信号使用的下单数量。 |

## 说明

- 点值根据标的的最小报价步长和小数位数计算。如果品种带有5位或3位小数，策略会将步长乘以 **10**，以匹配MetaTrader中的点值定义。
- 时间过滤器支持跨越午夜的会话。当 **Start Time** 晚于 **Stop Time** 时，策略会从开始时间交易到午夜，并在午夜之后继续运行直到结束时间。
- 每根K线只允许触发一次信号，与原始EA在同一根K线上仅提交一次订单的保护机制保持一致。
- 止盈和止损由策略逻辑主动执行，而不是在交易所挂出等待成交的委托，这与原始EA在提交订单时直接设置止盈止损的方式相呼应。
