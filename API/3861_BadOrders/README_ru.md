# Стратегия BadOrders

## Общее описание
**BadOrders Strategy** — это точный перенос советника MetaTrader 4 `BadOrders.mq4`. Первоначальный скрипт задумывался как демонстрация неправильной работы с заявками и специально провоцирует ошибки брокера:

1. На каждом новом тике принудительно закрывается недавно открытая позиция по текущей цене Bid.
2. Сразу после этого выставляется заявка Buy Stop на расстоянии 100 пунктов выше Bid.
3. Затем эта же заявка мгновенно переносится на 100 пунктов *ниже* Bid, что нарушает минимально допустимую дистанцию и приводит к отказу во исполнении.

Перенос на StockSharp реализован исключительно средствами высокоуровневого API. Стратегия подписывается на поток лучших цен (Level 1) и повторяет оригинальный цикл «закрыть позицию — выставить стоп — переместить стоп в запрещённую зону» при каждом обновлении котировок.

## Детали реализации
- **Источники данных**: используется `SubscribeLevel1()`, поскольку MT4-версия работает по каждому тику, а не по закрытию свечи.
- **Управление заявками**: закрытие позиций выполняется через `ClosePosition()`. Стоп-заявка создаётся методом `BuyStop()`, а её мгновенная «порча» реализована через `ReRegisterOrder()`, полностью имитируя логику исходного файла.
- **Нормализация цен**: все уровни проходят через `Security.ShrinkPrice()`. Понятие `Point` из MetaTrader воспроизводится с помощью `PriceStep`, а при отсутствии данных используется запасное значение `0.0001`.
- **Защита от дублирования**: перед вызовом `ClosePosition()` проверяется, нет ли уже активной встречной заявки, чтобы не отправлять несколько одинаковых приказов на закрытие.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | -------- | --------------------- |
| `DistancePoints` | Расстояние в «пунктах» MetaTrader, добавляемое к текущему Bid при выставлении и изменении стоп-заявки. | `100` |

## Логика работы
- При каждом обновлении Bid стратегия пытается закрыть открытую позицию.
- После закрытия выставляется Buy Stop на цене `Bid + DistancePoints * PointValue`.
- Немедленно эта заявка переносится на `Bid - DistancePoints * PointValue`, то есть в зону, запрещённую правилами площадки. Ошибка при регистрации ожидаема и полностью соответствует обучающей цели исходного скрипта.

> **Важно**: пример создан исключительно для демонстрации некорректной работы с заявками и не предназначен для использования на реальном рынке.
