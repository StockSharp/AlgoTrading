# Стратегия RRS Randomness

## Описание

**RRS Randomness Strategy** — порт советника «RRS Randomness in Nature EA» из MetaTrader 4 на платформу StockSharp.  
Стратегия случайным образом открывает длинные или короткие рыночные позиции, задаёт уровни стоп-лосса и тейк-профита, при необходимости сопровождает сделки трейлинг-стопом и закрывает их при превышении допустимого риска по плавающему убытку.

Из-за неттинговой модели StockSharp одновременное удержание длинной и короткой позиции по одному инструменту недоступно. Поэтому режим «DoubleSide» чередует направления сделок, а не держит одновременно две хеджевые позиции, как в MetaTrader.

## Логика торговли

1. По завершении каждой свечи стратегия получает актуальную цену из потока сделок или котировок Level1.  
2. При наличии открытой позиции выполняются проверки стоп-лосса, тейк-профита и трейлинг-стопа, а также оценивается риск по плавающему результату.  
3. При отсутствии позиции контролируются спред и допустимый объём перед открытием сделки:
   - В режиме **DoubleSide** направления сделок чередуются последовательно.  
   - В режиме **OneSide** используется оригинальное правило: случайное число из диапазона `[0,5]` открывает покупку при значениях `1` и `4`, продажу — при `0` и `3`.
4. Объём сделки выбирается равновероятно в пределах заданного диапазона и приводится к шагу объёма инструмента.

## Параметры

| Группа | Имя | Описание |
|--------|-----|----------|
| General | `Mode` | Режим выбора направления: чередование (`DoubleSide`) или случайный отбор (`OneSide`). |
| Lot Settings | `MinVolume` / `MaxVolume` | Диапазон случайного объёма сделок. |
| Protection | `TakeProfitPoints` | Дистанция тейк-профита в шагах цены. |
| Protection | `StopLossPoints` | Дистанция стоп-лосса в шагах цены. |
| Protection | `TrailingStartPoints` | Прибыль, необходимая для активации трейлинг-стопа. |
| Protection | `TrailingGapPoints` | Отступ трейлинг-стопа от текущей цены. |
| Filters | `MaxSpreadPoints` | Максимально допустимый спред (в шагах цены) для открытия позиции. |
| Filters | `SlippagePoints` | Ожидаемое проскальзывание, используется как справочная величина. |
| Risk Management | `MoneyRiskMode` | Тип риска: фиксированная сумма или процент от стоимости портфеля. |
| Risk Management | `RiskValue` | Величина риска в валюте счёта или в процентах (в зависимости от режима). |
| General | `TradeComment` | Информационный комментарий, передаваемый в заявки. |
| General | `CandleType` | Тип свечей, на основе которых выполняются расчёты. |

## Примечания

- Для работы стратегии необходимы подписки на свечи, котировки Level1 и поток сделок. Убедитесь, что выбранный инструмент предоставляет эти данные.  
- Логика трейлинг-стопа соответствует MQL-версии: активация происходит после роста на `TrailingStartPoints + TrailingGapPoints` шагов, затем стоп следует за ценой на расстоянии `TrailingGapPoints`.  
- Риск-менеджмент сравнивает плавающий результат с допустимым убытком и закрывает позицию при превышении порога.

