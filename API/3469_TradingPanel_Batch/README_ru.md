# Trading Panel Batch Strategy

## Обзор
`TradingPanelBatchStrategy` — порт советника MetaTrader 4 **EA_TradingPanel** на платформу StockSharp. В оригинале пользователю показывалась ручная панель: задавались количество сделок в серии, объём каждой заявки и расстояния до стоп-лосса/тейк-профита, после чего нажималась кнопка **BUY** или **SELL**. В StockSharp тот же сценарий реализован параметрами: достаточно установить `Direction`, и стратегия на следующей закрывшейся свече отправит пакет рыночных заявок, затем автоматически вернёт направление к значению `None`.

Логика намеренно упрощена, чтобы модуль легко комбинировался с внешними сигналами или ручным контролем. Все ордера наследуют опциональные стопы и тейки в пипсах — это полностью повторяет инструменты управления рисками из MQL-версии.

## Алгоритм работы
1. При старте стратегия вычисляет размер пипса из `Security.PriceStep`. Для инструментов с 1/3/5 знаками после запятой шаг дополнительно умножается на 10, как и в MetaTrader при переходе от point к pip.
2. Если заданы ненулевые отступы для стопа или тейка, вызывается `StartProtection`, которая сопровождает позиции рыночными заявками.
3. Подписывается свечной поток, указанный в `CandleType`. После формирования каждой свечи проверяется текущее значение `Direction`.
4. Если задано направление и торговля разрешена, стратегия отправляет `NumberOfOrders` рыночных ордеров объёмом `OrderVolume`.
5. После рассылки заявок событие логируется, а `Direction` автоматически сбрасывается в `None`, готовя стратегию к следующему запросу.

Таким образом, между сериями сделок стратегия не хранит состояние. Трейдер может в любой момент выставить `Direction = Buy` или `Direction = Sell`, и при закрытии ближайшей свечи будет сформирована новая партия заявок — это позволяет избежать решений по незавершённым данным.

## Параметры
| Название | Тип | Значение по умолчанию | Описание |
| -------- | --- | --------------------- | -------- |
| `NumberOfOrders` | `int` | `1` | Количество рыночных ордеров в очередной серии. |
| `OrderVolume` | `decimal` | `0.01` | Объём каждого рыночного ордера. |
| `StopLossPips` | `decimal` | `2` | Дистанция стоп-лосса в пипсах, преобразуется в абсолютную цену по данным инструмента. Значение `0` отключает стоп. |
| `TakeProfitPips` | `decimal` | `10` | Дистанция тейк-профита в пипсах. Значение `0` отключает тейк. |
| `Direction` | `TradeDirection` | `None` | Направление для следующего исполнения; после отправки заявок параметр сбрасывается. |
| `CandleType` | `DataType` | `TimeFrameCandle(1m)` | Свечной поток, по закрытию которого срабатывает стратегия. |

## Примечания
- Стратегии необходим инструмент с корректно настроенными `PriceStep` и (желательно) `Decimals`. При отсутствии этих данных размер пипса падает к значению `1`.
- `StartProtection` использует рыночные ордера для закрытия, что отражает механику MQL-панели при срабатывании стопов и тейков.
- Исполнение привязано к закрытым свечам, поэтому можно заранее установить нужное направление и синхронизировать пакетные сделки с аналитикой или ручными сигналами.
