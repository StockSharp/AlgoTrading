# Стратегия Inverse Reaction

## Обзор
Inverse Reaction — это стратегия возврата к среднему, перенесённая с MetaTrader-советника "IREA". Она реагирует на аномально крупные колебания отдельной свечи и ожидает обратное движение на следующей свече. Стратегия рассчитывает динамический порог уверенности по недавним изменениям цены и открывает сделки только тогда, когда импульс превышает порог, но остаётся в пределах заданных границ. Одновременно удерживается не более одной позиции.

## Логика торговли
1. **Индикатор обратной реакции** — для каждой закрытой свечи вычисляется разница между ценой открытия и закрытия. Абсолютное значение разницы подаётся на простое скользящее среднее длиной `MaPeriod`. Полученный средний диапазон умножается на коэффициент `Coefficient`, формируя динамический порог (аналог Dynamic Confidence Level оригинального индикатора).
2. **Фильтр сигнала** — абсолютная разница открытия/закрытия текущей свечи должна быть больше динамического порога, больше `MinCriteriaPoints * PriceStep` и меньше `MaxCriteriaPoints * PriceStep`. Если предыдущая свеча уже удовлетворяла тем же условиям, сигнал игнорируется — таким образом повторные срабатывания подавляются так же, как в оригинальном советнике.
3. **Направление сделки** — отрицательное изменение (медвежья свеча) трактуется как шанс на отскок вверх, поэтому открывается покупка. Положительное изменение предполагает разворот вниз и приводит к продаже. Новая сделка возможна только при отсутствии открытых позиций.
4. **Управление риском** — после входа стратегия следит за последующими свечами. При достижении расчётных уровней стоп-лосса или тейк-профита (переведённых из пунктов через `PriceStep`) позиция закрывается рыночным ордером. Дополнительно вызывается `StartProtection()` для подключения встроенной защиты StockSharp.

## Параметры
| Параметр | Описание |
|----------|----------|
| `StopLossPoints` | Размер стоп-лосса в пунктах (умножается на `PriceStep`). |
| `TakeProfitPoints` | Размер тейк-профита в пунктах. |
| `TradeVolume` | Объём каждой сделки. |
| `SlippagePoints` | Информационный параметр, сохранённый для совместимости с версией MQL; непосредственно не применяется. |
| `MinCriteriaPoints` | Минимально допустимый размер свечи (в пунктах) для сигнала. |
| `MaxCriteriaPoints` | Максимально допустимый размер свечи (в пунктах). |
| `Coefficient` | Множитель динамического порога уверенности. |
| `MaPeriod` | Период скользящего среднего внутри индикатора (не менее 3). |
| `CandleType` | Тип/таймфрейм свечей (по умолчанию 1 час). |

## Рекомендации по использованию
- Убедитесь, что у инструмента задан корректный `PriceStep`. Если шаг цены отсутствует, стратегия использует значение 1.0, что может исказить пороги.
- Подбирайте `MinCriteriaPoints` и `MaxCriteriaPoints` под волатильность выбранного таймфрейма. Слишком узкий диапазон отсечёт большинство сигналов, слишком широкий пропустит экстремальные движения.
- Значение `Coefficient` по умолчанию (1.618) повторяет золотое сечение, использованное в исходном индикаторе. При увеличении коэффициента стратегия будет реагировать только на более редкие аномальные свечи.
- Закрытие по стопу/профиту выполняется рыночными ордерами на следующей свече, достигшей уровня. Фактическая цена исполнения может отличаться от целевого уровня — учитывайте это в тестах и при работе в реальном времени.
- Стратегия никогда не усредняет и не накапливает позиции. Сигнал рассматривается только после закрытия текущей сделки.

## Примечания
- Перед реальной торговлей обязательно протестируйте стратегию на исторических данных. Оригинальная версия проектировалась для валютного рынка, поэтому для других активов потребуется подстройка параметров.
- Параметр `SlippagePoints` сохранён для полноты, но не влияет на регистрацию заявок, поскольку механизм проскальзывания в StockSharp отличается от MetaTrader.
- Значение `MaPeriod` должно оставаться ≥ 3. В оригинальном коде меньшие значения запрещались, чтобы предотвратить нестабильное поведение индикатора.
