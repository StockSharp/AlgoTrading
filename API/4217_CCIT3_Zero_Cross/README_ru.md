# Стратегия CCIT3 Zero Cross

## Обзор
CCIT3 Zero Cross — порт стратегии MetaTrader 5, которая торгует развороты осциллятора CCIT3 относительно нулевой линии. Индикатор строится путём применения цепочки сглаживания Tillson T3 к индексу товарного канала (CCI). Когда сглаженное значение меняет знак, стратегия открывает новую позицию по направлению разворота либо, при включённой опции реверса, закрывает текущую и открывает противоположную.

## Логика торговли
- Рассчитывается CCI с заданным периодом и выбранным типом цены.
- Осциллятор сглаживается фильтром Tillson T3. Доступны два режима вычисления:
  - **Simple** — классическое шестиступенчатое сглаживание с накоплением состояния, полностью повторяющее оригинальный индикатор с пересчётом истории.
  - **NoRecalc** — вычисляет полином T3 только для последнего бара, что соответствует облегчённой версии «без пересчёта» из исходного MQL-кода.
- Переход CCIT3 из положительной области в отрицательную открывает длинную позицию (или переворачивает короткую при активном `Trade Overturn`).
- Переход CCIT3 из отрицательной области в положительную открывает короткую позицию (или переворачивает длинную при активном `Trade Overturn`).
- Тейк-профит, стоп-лосс и трейлинг-стоп управляются через помощник `StartProtection` платформы StockSharp.

## Индикаторы и расчёты
- **CCI** — использует настраиваемый тип цены (close, open, high, low, median, typical, weighted) и период.
- **Tillson T3** — реализован по формуле оригинального индикатора с коэффициентом `B`. В режиме Simple цепочка EMA хранит состояние между барами, в режиме NoRecalc полином пересчитывается только по текущему значению CCI.
- **Контроль пересечения нуля** — сигналы формируются только на закрытых свечах, как и в исходном советнике.

## Управление рисками и позицией
- Параметры `Take Profit (pts)` и `Stop Loss (pts)` переводятся в абсолютные цены с учётом `PriceStep` инструмента.
- `Trailing Stop (pts)` активирует встроенный трейлинг с указанной дистанцией.
- `Max Drawdown Target` масштабирует базовый объём заявки пропорционально текущей или начальной стоимости портфеля (`volume = OrderVolume * balance / target`). Значение 0 отключает адаптивное масштабирование.
- `Trade Overturn` включает полный реверс: текущая позиция закрывается перед открытием противоположной.

## Параметры
| Имя | По умолчанию | Описание |
| --- | --- | --- |
| `Volume` | 1 | Базовый объём заявки до учёта ограничения просадки. |
| `Take Profit (pts)` | 1750 | Дистанция тейк-профита в пунктах. |
| `Stop Loss (pts)` | 0 | Дистанция стоп-лосса в пунктах. |
| `Trailing Stop (pts)` | 0 | Дистанция трейлинг-стопа в пунктах (0 — без трейлинга). |
| `Trade Overturn` | false | Разворот позиции при противоположном сигнале CCIT3. |
| `CCI Period` | 285 | Период расчёта индекса товарного канала. |
| `CCI Price` | Typical | Тип цены, подаваемой на вход CCI. |
| `T3 Period` | 60 | Длина сглаживания Tillson T3. |
| `T3 Volume Factor` | 0.618 | Коэффициент `B` фильтра Tillson T3. |
| `Mode` | Simple | Режим расчёта CCIT3 (`Simple` или `NoRecalc`). |
| `Candle Type` | ТФ 1 час | Тип свечей, используемый в расчётах. |
| `Max Drawdown Target` | 0 | Делитель баланса для адаптивного объёма (0 — без масштабирования). |

## Особенности реализации
- Подписка ведётся на одну свечную серию, заданную параметром `Candle Type`, и обрабатываются только завершённые свечи.
- Объём заявок нормируется по шагу объёма инструмента и ограничивается `VolumeMin`/`VolumeMax`.
- Настройки по умолчанию повторяют опубликованную конфигурацию MT5: режим Simple, период CCI 285, T3 60 и коэффициент 0.618.
- Режим NoRecalc сохраняет реакцию на знак «сырого» CCI, но всё равно возвращает положительные/отрицательные значения для определения направления.
