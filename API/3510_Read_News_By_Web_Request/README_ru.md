# Стратегия ReadNewsByWebRequest

## Общее описание
**ReadNewsByWebRequestStrategy** — это портированная версия советника MetaTrader «ReadNewsByWebRequest.mq4».
Стратегия регулярно загружает недельный экономический календарь Forex Factory и заранее готовит «стреддл»
перед каждым предстоящим релизом с высокой важностью. Пара отложенных стоп-заявок создаётся за заданное количество минут
до публикации, чтобы поймать импульс в любом направлении.

## Внешние данные
* **Источник**: `https://nfs.faireconomy.media/ff_calendar_thisweek.xml` (XML-календарь Forex Factory).
* **Период обновления**: настраиваемый (по умолчанию 1 минута). Выполняется HTTP GET-запрос и последующий разбор XML.
* **Фильтрация**: учитываются только события с уровнем влияния `High` и временем релиза, которое ещё не наступило.
* **Часовой пояс**: календарь публикует время в формате GMT/UTC. Сравнение выполняется с использованием серверного времени
  (поле `Level1ChangeMessage.ServerTime`). События типа *All Day*, *Tentative*, *Holiday* и без точного времени игнорируются.

## Последовательность работы
1. Запустите стратегию и выберите валютный инструмент. Шаг цены и объёма используются для перевода «пунктов» в абсолютные значения.
2. При старте стратегия сразу загружает календарь и запускает таймер с периодом `RefreshMinutes`.
3. Поток котировок уровня 1 нужен для отслеживания текущего лучшего бид/аск.
4. Когда до релиза остаётся `LeadMinutes`, выставляются стоп-ордера Buy Stop и Sell Stop на заданном расстоянии от рынка.
5. После исполнения заявок защита позиции (stop-loss / take-profit) активируется через `StartProtection` на основе параметров `StopLossPoints` и `TakeProfitPoints`.
6. Отложенные ордера автоматически снимаются по истечении `PendingExpirationMinutes` или по достижении времени релиза/истечения события.
7. После деактивации обоих ордеров событие удаляется из внутренней очереди.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `Volume` | `0.01` | Объём сделки в лотах. Приводится к шагу объёма и ограничивается мин./макс. значениями инструмента. |
| `StopLossPoints` | `300` | Расстояние стоп-лосса в пунктах. Значение `0` отключает стоп. |
| `TakeProfitPoints` | `900` | Расстояние тейк-профита в пунктах. Значение `0` отключает цель по прибыли. |
| `BuyDistancePoints` | `200` | Смещение buy-stop относительно текущего ask (в пунктах). |
| `SellDistancePoints` | `200` | Смещение sell-stop относительно текущего bid (в пунктах). |
| `LeadMinutes` | `5` | За сколько минут до новости размещать отложенные ордера. |
| `PendingExpirationMinutes` | `10` | Время жизни отложенных заявок. `0` — не ограничивать. |
| `RefreshMinutes` | `1` | Интервал между запросами к календарю Forex Factory. |
| `ShowNewsLog` | `false` | При включении в лог выводится количество отслеживаемых событий высокой важности. |

## Управление ордерами
* Заявки отправляются только если стратегия в онлайне, торговля разрешена, а у инструмента корректно задан шаг цены/объёма.
* Цена buy-stop рассчитывается как `Ask + BuyDistancePoints * PriceStep`, sell-stop — как `Bid - SellDistancePoints * PriceStep`.
* Если после округления объёма получается ноль, ордера не выставляются, а в лог записывается предупреждение.
* Просроченные заявки снимаются методом `CancelOrder`. Защитные приказы создаются механизмом `StartProtection`.

## Управление рисками
* `StartProtection` активируется автоматически, если задан stop-loss или take-profit в пунктах.
* Стратегия не использует усреднение или мартингейл — только одиночные заявки вокруг новости.
* На одно событие создаётся только одна пара стоп-ордеров. После выхода новости событие помечается как завершённое.

## Особенности и ограничения
* Требуется сетевой доступ к серверу Forex Factory. Ошибки подключения отражаются в логах.
* Игнорируются события со средним/низким влиянием и новости без точного времени.
* События без минутного тайминга (например, «Tentative») пропускаются, так как невозможно выставить ордера по расписанию.
* Предполагается, что календарь предоставляет время в UTC. При необходимости скорректируйте параметр `LeadMinutes` под часовой пояс брокера.
* Желательно работать с инструментами, где заданы `PriceStep`, `Decimals`, `VolumeStep`, `MinVolume` и `MaxVolume`.

## Особенности конвертации
* Таймер MQL с периодом 60 секунд перенесён в `Timer.Start`, интервал теперь задаётся параметром `RefreshMinutes`.
* В оригинале XML разбирался вручную через `StringFind`; в портированной версии используется `XDocument`.
* Проверка объёма (`CheckVolumeValue`) заменена на `RoundVolume`, учитывающую параметры инструмента в StockSharp.
* Вывод комментариев на график MT4 заменён на опциональные записи в лог (`ShowNewsLog`).
* Время истечения отложенных ордеров воспроизведено параметром `PendingExpirationMinutes` (по умолчанию 10 минут, как в MQL).
