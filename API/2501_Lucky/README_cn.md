# Lucky 策略
[English](README.md) | [Русский](README_ru.md)

Lucky 策略是一种突破型剥头皮系统，专注于最优买价和卖价之间的快速跳动。当卖价（Ask）相对上一笔报价上跳超过设定的点数时做多；当买价（Bid）下跌超过同样的点数时做空。只要头寸转为盈利，或价格回撤超过保护阈值，仓位会立即平仓。

## 数据与执行

- **数据来源**：需要 Level 1 行情，以持续获取最优买卖价。
- **订单类型**：所有进出场均使用市价单，以保证对报价突变的快速响应。
- **持仓模式**：原策略针对对冲账户设计，但在净头寸账户中同样适用，会自动累计净头寸。

## 参数

- **Shift points** – 触发交易所需的最小点数跳动。数值越大越能过滤噪音，数值越小反应越敏感。
- **Limit points** – 容许的最大不利波动（点数）。达到该阈值时将强制平仓，计算时会结合合约的最小报价步长。
- **Reverse mode** – 反向开仓模式。启用后，卖价上跳触发做空，买价下跌触发做多。

## 交易逻辑

1. **初始化**
   - 根据合约报价步长，把点数参数转换为实际价格距离。
   - 订阅 Level 1 数据，并清空上一笔 bid/ask 缓存。
2. **入场规则**
   - Ask 相对上一笔 Ask 上涨超过阈值时买入（反向模式下改为卖出）。
   - Bid 相对上一笔 Bid 下跌超过阈值时卖出（反向模式下改为买入）。
3. **头寸规模**
   - 默认使用策略自身的 `Volume` 作为下单数量。
   - 如果能获取到组合资产价值，会模仿 MetaTrader 的做法：按照 `FreeMargin / 10,000` 估算手数，并保留一位小数，使资金规模更大的账户自动放大下单量。
4. **离场规则**
   - 多头在 Bid 超过平均开仓价时立即平仓；若 Ask 跌破开仓价并达到 Limit points，也会止损离场。
   - 空头在 Ask 跌破开仓价时获利平仓；若 Bid 向上突破开仓价且超过 Limit points，则止损离场。

## 使用建议

- 最适合流动性充足且报价跳动明显的外汇或指数差价合约。
- 实盘前建议额外配置组合级别的风控，例如总权益回撤止损。
- 开启 **Reverse mode** 可以快速将策略转变为反向做单模式，无需修改其他参数。
- 策略会对每一次满足条件的报价更新作出响应，如行情噪音较大，可适当增大 shift 参数或过滤数据频率。
