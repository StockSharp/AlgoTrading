# Стратегия Lucky
[English](README.md) | [中文](README_cn.md)

Стратегия Lucky — это скальпер на пробой, который отслеживает резкие изменения между лучшими ценами спроса и предложения. Покупка выполняется, когда цена ask подпрыгивает вверх минимум на заданное количество пунктов, а продажа — когда цена bid падает на ту же величину. Позиции закрываются сразу после появления прибыли или при достижении допустимого неблагоприятного отклонения.

## Данные и исполнение

- **Тип данных**: необходим поток котировок Level 1 для получения лучших bid/ask.
- **Тип заявок**: используются только рыночные ордера, чтобы успевать на быстрые импульсы.
- **Режим позиции**: стратегия создавалась под хеджинговые счета, но работает и с неттингом, суммируя чистую позицию.

## Параметры

- **Shift points** – минимальное количество пунктов между последовательными котировками, которое запускает новую сделку. Большое значение отсекает шум, малое реагирует даже на мелкие скачки.
- **Limit points** – максимально допустимый неблагоприятный ход (в пунктах) перед принудительным закрытием позиции. Автоматически масштабируется с учетом шага цены инструмента.
- **Reverse mode** – инвертирует направление сделок. При включении рост ask приводит к продаже, а падение bid — к покупке.

## Логика торговли

1. **Инициализация**
   - Переводит параметр «в пунктах» в абсолютные ценовые расстояния с учетом шага цены инструмента.
   - Подписывается на поток Level 1 и обнуляет буферы предыдущих bid/ask.
2. **Вход**
   - Если ask вырос как минимум на величину shift относительно предыдущего значения, открывается длинная позиция (или короткая при включенном реверсе).
   - Если bid упал на ту же величину, открывается короткая позиция (или длинная в режиме реверса).
3. **Размер позиции**
   - Базовый объем берётся из свойства `Volume` стратегии.
   - Если доступна стоимость портфеля, имитирует логику MetaTrader: выделяет примерно `FreeMargin / 10 000`, округляя до десятых лота, чтобы большие счета торговали большим объёмом.
4. **Выход**
   - Лонг закрывается при превышении bid средней цены входа или если ask опустился ниже неё на величину Limit.
   - Шорт закрывается при падении ask ниже цены входа либо при росте bid выше неё на Limit.

## Примечания и рекомендации

- Лучше всего работает на ликвидных валютных парах и индексных CFD с заметными скачками котировок.
- Добавьте дополнительные правила риск-менеджмента (например, общепортфельный стоп) перед торговлей на реальном счёте.
- Переключатель **Reverse mode** позволяет быстро превратить пробойную систему в контртрендовую без изменений других настроек.
- Из-за реакции на каждое подходящее обновление котировок стоит ограничить поток данных или увеличить параметр shift на «шумных» инструментах.
