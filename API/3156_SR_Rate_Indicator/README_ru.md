# Стратегия SR Rate Indicator

## Обзор

Стратегия представляет собой перенос советника MetaTrader 5 **Exp_SR-RateIndicator** на платформу StockSharp. В коде используетс
я высокоуровневый API и собственная реализация осциллятора SR Rate. Индикатор измеряет положение сглаженной взвешенной цены внут
ри динамического диапазона поддержки/сопротивления и выдаёт пять цветовых состояний, подсвечивающих экстремальные зоны.

Алгоритм обрабатывает только завершённые свечи выбранного таймфрейма. Когда цвет осциллятора переходит в бычий или медвежий экст
ремум, стратегия закрывает противоположную позицию и при необходимости открывает сделку в сторону сигнала. Стоп-лосс и тейк-проф
ит рассчитываются в тех же пунктах, что и в оригинальном советнике, и автоматически переводятся в абсолютные цены через шаг цен
ы инструмента.

## Осциллятор SR Rate

Расчёт индикатора выполняется по следующему алгоритму:

1. Для каждой свечи максимумы, минимумы и взвешенные цены закрытия сглаживаются односторонними гауссовыми весами длиной шесть.
2. Внутри заданного окна определяется максимум сглаженных максимумов и минимум сглаженных минимумов, формируя динамический кан
ал.
3. Текущее сглаженное взвешенное закрытие нормируется относительно полученного диапазона и проецируется в интервал `[-100, 100]`.
4. Значение осциллятора сопоставляется с цветовым кодом: `0` — сильный медвежий сигнал, `1` — мягкий медвежий, `2` — нейтральный, `3`
 — мягкий бычий, `4` — сильный бычий.

Цвет `4` означает достижение верхней границы диапазона, цвет `0` — тест его нижней границы.

## Правила торговли

1. Подписаться на свечи выбранного типа и вычислять SR Rate на каждой закрытой свече.
2. Смещать оценку сигнала на `SignalBar` закрытых свечей назад (по умолчанию на одну свечу) для полного соответствия оригиналу.
3. Если смещённый цвет становится `4`, а предыдущий цвет меньше `4`:
   - Закрыть имеющиеся короткие позиции, если разрешено закрытие шортов.
   - Открыть длинную позицию при разрешённых входах и отсутствии активных сделок.
4. Если смещённый цвет становится `0`, а предыдущий больше `0`:
   - Закрыть длинные позиции, если разрешено закрытие лонгов.
   - Открыть короткую позицию при разрешённых входах и отсутствии активных сделок.
5. Одновременно поддерживается только одна позиция; новые сигналы игнорируются до её закрытия.
6. Стоп-лосс и тейк-профит задаются в пунктах и переводятся в абсолютные цены через шаг цены инструмента.

## Параметры

| Имя | Описание |
|-----|----------|
| `OrderVolume` | Объём каждой рыночной заявки. |
| `EnableLongEntries` | Разрешение на открытие длинных позиций. |
| `EnableShortEntries` | Разрешение на открытие коротких позиций. |
| `EnableLongExits` | Закрывать лонги при появлении сильного медвежьего цвета. |
| `EnableShortExits` | Закрывать шорты при появлении сильного бычьего цвета. |
| `StopLossPoints` | Дистанция стоп-лосса в пунктах (конвертируется в абсолютное значение). |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах (конвертируется в абсолютное значение). |
| `SlippagePoints` | Допустимое проскальзывание при закрытии позиций. Параметр сохранён для совместимости; высокоуровневый API не управляет проскальзыванием напрямую. |
| `CandleType` | Тип и таймфрейм свечей для расчёта. |
| `SignalBar` | Количество закрытых свечей, на которое смещается сигнал (по умолчанию 1). |
| `WindowSize` | Длина окна нормализации SR Rate. |
| `HighLevel` | Порог верхнего экстремума (по умолчанию +20). |
| `LowLevel` | Порог нижнего экстремума (по умолчанию -20). |

## Примечания

- Стратегия работает с любыми инструментами, предоставляющими стандартные OHLC-свечи.
- Сигналы анализируются только после закрытия свечи, как и в MetaTrader.
- Контроль проскальзывания в исходном советнике зависел от настроек исполнения. В StockSharp рыночные заявки следуют правилам биржи, поэтому параметр `SlippagePoints` носит информационный характер.
- Индикатор хранит только минимально необходимую историю, что исключает лишние затраты памяти.
- По требованиям проекта версия на Python не создаётся.
