# SR Rate Indicator 策略

## 概述

本策略是 MetaTrader 5 专家顾问 **Exp_SR-RateIndicator** 的 C# 复刻版本。它在 StockSharp 高级 API 中重新实现了原始的交易逻辑，并内置了 SR Rate 振荡指标。该指标通过对加权收盘价进行高斯平滑，衡量价格在平滑支撑/阻力通道中的位置，并给出五种颜色信号以识别极端区域。

策略基于可配置周期的已完成 K 线工作。当振荡指标的颜色跳转到看涨或看跌极端值时，算法会平掉反向仓位，并在允许的情况下按照信号方向开仓。止损与止盈距离使用与原始 EA 相同的点数，并自动换算为绝对价格。

## SR Rate 振荡指标

指标使用一个窗口期对价格进行归一化处理：

1. 对每根 K 线的最高价、最低价和加权收盘价应用长度为 6 的单边高斯权重进行平滑。
2. 取窗口内平滑最高价的最大值和平滑最低价的最小值，形成动态通道。
3. 将当前平滑后的加权收盘价按上述通道归一化到 `[-100, 100]` 区间。
4. 最终数值对应五个颜色状态：`0`（强烈看跌）、`1`（弱看跌）、`2`（中性）、`3`（弱看涨）、`4`（强烈看涨）。

当颜色为 `4` 时，意味着价格触及通道上沿；当颜色为 `0` 时，意味着价格靠近通道下沿。

## 交易规则

1. 订阅所选周期的 K 线，并在每根完成的 K 线上计算 SR Rate 振荡指标。
2. 使用 `SignalBar` 参数将信号判定延迟若干根已完成 K 线（默认延迟 1 根），与原始 EA 的行为保持一致。
3. 当延迟后的颜色变为 `4` 且前一根颜色小于 `4` 时：
   - 如果允许，先平掉所有空头仓位。
   - 若允许做多并且当前没有仓位，则开多单。
4. 当延迟后的颜色变为 `0` 且前一根颜色大于 `0` 时：
   - 如果允许，先平掉所有多头仓位。
   - 若允许做空并且当前没有仓位，则开空单。
5. 策略任何时刻仅持有一个方向的仓位，直到平仓信号出现。
6. 止损和止盈以点数输入，并自动乘以品种的最小报价步长。

## 参数

| 名称 | 说明 |
|------|------|
| `OrderVolume` | 每次下单使用的交易量。 |
| `EnableLongEntries` | 是否允许开多单。 |
| `EnableShortEntries` | 是否允许开空单。 |
| `EnableLongExits` | 当出现强烈看跌颜色时是否平掉多头。 |
| `EnableShortExits` | 当出现强烈看涨颜色时是否平掉空头。 |
| `StopLossPoints` | 止损距离（点数，将转换为绝对价格）。 |
| `TakeProfitPoints` | 止盈距离（点数，将转换为绝对价格）。 |
| `SlippagePoints` | 平仓时可接受的最大滑点，保留以兼容原始 EA，高级 API 不会主动控制滑点。 |
| `CandleType` | 用于计算指标的 K 线类型与周期。 |
| `SignalBar` | 信号偏移的已完成 K 线数量（默认 1）。 |
| `WindowSize` | SR Rate 归一化窗口的长度。 |
| `HighLevel` | 定义看涨极端区域的阈值（默认 +20）。 |
| `LowLevel` | 定义看跌极端区域的阈值（默认 -20）。 |

## 说明

- 适用于提供标准 OHLC 数据的任意品种。
- 仅在 K 线收盘后处理信号，与 MetaTrader 原版的行为一致。
- 原始 EA 的滑点控制依赖于撮合设置，StockSharp 市价单遵循交易所规则，因此 `SlippagePoints` 仅用于文档说明。
- 指标内部仅保存计算所需的最小历史数据，以避免无意义的内存占用。
- 按项目要求，本策略暂不提供 Python 版本。
