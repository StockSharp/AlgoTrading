# Стратегия Hoop Master

## Обзор

Hoop Master — это стратегия пробоя на отложенных ордерах. Она одновременно поддерживает два стоп-ордера вокруг текущей цены: buy stop выше рынка и sell stop ниже рынка. При срабатывании одного из ордеров противоположная заявка снимается, после чего обе стороны переустанавливаются с увеличенным объёмом. Перенос в StockSharp повторяет исходную логику, управляя стоп-заявками и опциональным мартингейлом внутри одного класса стратегии.

После открытия позиции стратегия может добавлять защитные ордера стоп-лосс и тейк-профит. Модуль трейлинга постепенно подтягивает стоп по мере движения цены в нужную сторону.

## Логика торговли

1. После завершения каждой свечи пересчитываются уровни для отложенных стопов.
2. При отсутствии позиции стратегия размещает buy stop и sell stop на заданном расстоянии в пунктах от лучшего ask и bid.
3. При исполнении одного стоп-ордера противоположная заявка отменяется. Новые стопы выставляются немедленно с объёмом вдвое больше базового.
4. Для открытой позиции создаются независимые защитные ордера. При включенном трейлинг-стопе защитный стоп двигается вслед за ценой при достаточном ценовом прогрессе.
5. После закрытия позиции все защитные заявки снимаются, а на следующем сигнале выставляются исходные пробойные стопы с базовым объёмом.

## Параметры

| Параметр | Описание |
| --- | --- |
| **Candle Type** | Тип свечей, который используется в расчётах. |
| **Order Volume** | Базовый объём пробойных стоп-ордеров. Мартингейл использует удвоенное значение. |
| **Stop Loss (pips)** | Расстояние от входа до защитного стоп-ордера в пунктах. 0 — выключено. |
| **Take Profit (pips)** | Расстояние от входа до защитного тейк-профита в пунктах. 0 — выключено. |
| **Trailing Stop (pips)** | Дистанция трейлинг-стопа в пунктах. 0 — трейлинг отключён. |
| **Trailing Step (pips)** | Минимальный ценовой прогресс (в пунктах) для переноса трейлинг-стопа. |
| **Indent (pips)** | Отступ в пунктах при размещении пробойных стопов относительно bid/ask. |

## Управление ордерами

- Стратегия отслеживает лучшую цену Bid/Ask и при их отсутствии использует последнюю цену сделки или закрытие свечи.
- Все цены приводятся к шагу цены инструмента, что устраняет ошибки из-за недопустимых значений.
- Защитные ордера создаются при появлении позиции и пересобираются при каждом новом входе.
- Трейлинг активен только при ненулевых параметрах дистанции и шага и двигает стоп в сторону прибыли.

## Примечания

- Убедитесь, что брокер или тестовая среда поддерживает стоп- и лимитные ордера для выбранного инструмента.
- Мартингейл быстро увеличивает риски, поэтому подбирайте базовый объём с осторожностью.
- Для корректной работы стратегии необходимо получать данные Level1 (bid/ask) одновременно с потоком свечей.
