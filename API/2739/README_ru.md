# Стратегия Dealers Trade ZeroLag MACD

## Общее описание
Эта стратегия переносит советник MetaTrader "Dealers Trade v 7.91 ZeroLag MACD" в инфраструктуру StockSharp. Она анализирует наклон линии ZeroLag MACD, чтобы определять направление тренда, и строит адаптивную сетку ордеров с управлением рисками. Рекомендованный таймфрейм — H4, однако можно выбрать любой тип свечей, поддерживаемый StockSharp.

## Логика работы
- **Определение сигнала.** Две нулевые экспоненциальные скользящие средние формируют линию MACD. Если значение MACD растёт относительно предыдущей свечи, стратегия рассматривает рынок как бычий, если падает — как медвежий. Параметр `ReverseCondition` позволяет инвертировать интерпретацию.
- **Построение сетки.** В выбранном направлении стратегия наращивает позицию. Расстояние между входами задаётся в пунктах и умножается после каждого открытия на коэффициент `IntervalCoefficient`. Объём наращивается за счёт коэффициента `LotMultiplier`, повторяя мартингейл-логику оригинала.
- **Контроль объёма.** Если `BaseVolume` больше нуля, он используется как стартовый объём. При `BaseVolume = 0` размер рассчитывается из `RiskPercent`, расстояния до стопа и шагов инструмента. Объём проверяется на минимальные/максимальные ограничения и ограничивается параметром `MaxVolume`.
- **Сопровождение сделок.** Для каждой позиции можно задать стоп-лосс, тейк-профит и трейлинг-стоп (в пунктах). Для последующих входов тейк-профит умножается на `TakeProfitCoefficient`.
- **Защита счёта.** Если количество позиций превышает `PositionsForProtection`, а суммарная прибыль достигла `SecureProfit`, стратегия закрывает самую прибыльную сделку, фиксируя результат. При превышении `MaxPositions` закрывается позиция с худшим результатом.

## Управление позициями
- Все проверки выполняются на закрытых свечах, используя цены закрытия, максимума и минимума.
- Каждая открытая позиция хранит объём, цену входа и параметры трейлинга. Последняя цена входа используется для соблюдения минимального шага между сделками.
- При падении баланса ниже `MinimumBalance` стратегия останавливается, предотвращая работу на слишком маленьком депозите.

## Параметры
- `BaseVolume` — стартовый объём заявки (0 — расчёт от риска).
- `RiskPercent` — процент риска на сделку при расчётном объёме.
- `MaxPositions` — максимальное количество одновременных позиций.
- `IntervalPips` и `IntervalCoefficient` — базовый шаг сетки и мультипликатор шага.
- `StopLossPips`, `TakeProfitPips` — расстояния стопа и тейка в пунктах.
- `TrailingStopPips`, `TrailingStepPips` — параметры трейлинг-стопа.
- `TakeProfitCoefficient` — увеличение тейк-профита для новых входов.
- `SecureProfit`, `AccountProtection`, `PositionsForProtection` — параметры защиты счёта.
- `ReverseCondition` — инверсия направления.
- `FastLength`, `SlowLength`, `SignalLength` — периоды нулевых EMA.
- `MaxVolume`, `LotMultiplier` — ограничения и мультипликатор объёма.
- `MinimumBalance` — минимальный баланс для работы.
- `CandleType` — тип свечей.

## Рекомендации
1. Перед запуском привяжите стратегию к инструменту и портфелю.
2. Проверьте шаг цены и стоимость шага, чтобы корректно преобразовывались пункты.
3. Стандартные настройки повторяют советник MetaTrader, но могут оптимизироваться средствами StockSharp.
4. Версия на Python в рамках данного задания не создавалась.
