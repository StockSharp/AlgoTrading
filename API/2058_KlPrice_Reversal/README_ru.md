# Стратегия KlPrice Reversal

Стратегия представляет собой перевод на C# оригинального эксперта MQL5 **exp_i-KlPrice.mq5**. Она реализует разворотный подход на основе нормализованного ценового осциллятора. Осциллятор сравнивает текущую цену с сглаженной ценовой полосой, построенной по скользящей средней и среднему истинному диапазону (ATR). Пересечение заданных границ формирует торговые сигналы.

## Как работает

1. Простая скользящая средняя (SMA) сглаживает цену закрытия.
2. Индикатор Average True Range (ATR) оценивает волатильность рынка.
3. Осциллятор вычисляется по формуле:
   
   `jres = 100 * (Close - (SMA - ATR)) / (2 * ATR) - 50`
4. Значение осциллятора распределяется по пяти зонам:
   - **4** – выше верхнего уровня
   - **3** – между нулём и верхним уровнем
   - **2** – между верхним и нижним уровнями
   - **1** – между нижним уровнем и нулём
   - **0** – ниже нижнего уровня
5. Длинная позиция открывается, когда осциллятор выходит из зоны 4. Короткая позиция открывается, когда он выходит из зоны 0. Открытые позиции закрываются при пересечении нуля.

## Параметры

| Имя | Описание |
|-----|----------|
| `CandleType` | Таймфрейм ценовых данных. |
| `PriceMaLength` | Период SMA для сглаживания цены. |
| `AtrLength` | Период ATR для оценки диапазона. |
| `UpLevel` | Верхний порог осциллятора. |
| `DownLevel` | Нижний порог осциллятора. |
| `EnableBuy` | Разрешить открытие длинных позиций. |
| `EnableSell` | Разрешить открытие коротких позиций. |

## Использование

1. Создайте экземпляр `KlPriceReversalStrategy`.
2. Установите необходимые параметры.
3. Подключите стратегию к портфелю и инструменту.
4. Запустите стратегию для получения сигналов и регистрации заявок.

Для входа и выхода используются рыночные заявки `BuyMarket` и `SellMarket`. Защита позиции активируется через `StartProtection()`.

## Примечания

- Реализация приближает оригинальный индикатор MQL, используя встроенные индикаторы StockSharp (`SimpleMovingAverage` и `AverageTrueRange`).
- Все расчёты выполняются только по завершённым свечам.
