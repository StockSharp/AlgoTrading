# Стратегия Auto ADX

## Обзор
**Auto ADX** — порт советника MetaTrader `Auto ADX.mq5` на высокоуровневый API StockSharp. Стратегия анализирует силу тренда по индикатору Average Directional Index (ADX) и соотношение направленных линий +DI/-DI для выбора направления сделки. Реализованы все механизмы исходной версии: стоп-лосс, тейк-профит, возможность принудительного разворота и трейлинг-стоп в пунктах, но с использованием инструментов StockSharp: подписки на свечи и привязки индикаторов.

## Логика торговли
- **Источник данных** — подписка на настраиваемый тип свечей (по умолчанию 1 час). Обработка выполняется только после закрытия свечи, что исключает шум внутри бара.
- **Расчёт ADX** — используется единый индикатор `AverageDirectionalIndex`, связанный через `BindEx`, что даёт доступ к сглаженному ADX и значениям +DI/-DI.
- **Условия для входа в лонг**:
  - +DI больше -DI, то есть преобладает восходящее движение;
  - текущее значение ADX выше заданного уровня;
  - ADX растёт относительно предыдущей свечи.
- **Условия для входа в шорт**:
  - -DI больше +DI, что указывает на нисходящий импульс;
  - ADX ниже настроечного порога;
  - ADX падает по сравнению с предыдущей свечой.
- **Режим разворота** — при активном параметре `ReverseSignals` текущие позиции закрываются, если нарушаются условия господства линий DI или меняется наклон ADX.
- **Объём сделки** — использует свойство `Volume`. Перед открытием новой позиции стратегия всегда закрывает существующую через `ClosePosition()`.

## Управление рисками
- **Стоп-лосс и тейк-профит** — значения параметров в пунктах переводятся в абсолютные цены через `PriceStep` и передаются в `StartProtection`, который формирует защитные заявки (при необходимости — по рынку).
- **Трейлинг-стоп** — полностью повторяет логику из MQL:
  - активируется только после достижения прибыли, превышающей заданное расстояние;
  - уровень стопа сдвигается ступенчато на `TrailingStepPips` пунктов;
  - длинная позиция закрывается при пробитии стопа вниз, короткая — при росте выше стопа.
- **Пересчёт пункта** — по аналогии с исходником, за величину пункта берётся `PriceStep`. Для инструментов с 3/5 знаками после запятой размер пункта умножается на 10, чтобы сохранить поведение форекс-символов.

## Параметры
| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `StopLossPips` | 50 | Расстояние до стоп-лосса в пунктах. Ноль отключает стоп. |
| `TakeProfitPips` | 50 | Расстояние до тейк-профита в пунктах. Ноль отключает цель. |
| `TrailingStopPips` | 5 | Размер трейлинг-стопа в пунктах. Ноль отключает трейлинг. |
| `TrailingStepPips` | 5 | Минимальный шаг в пунктах для сдвига трейлинга. Должен быть > 0 при активном трейлинге. |
| `AdxPeriod` | 14 | Период сглаживания индикатора ADX. |
| `AdxLevel` | 30 | Порог силы тренда для фильтрации входов. |
| `ReverseSignals` | true | Закрывать позицию при изменении условий DI или наклона ADX. |
| `CandleType` | 1 час | Используемый таймфрейм свечей. |

## Особенности реализации
- Связка индикатора выполняется через `BindEx`, поэтому доступ к значениям ADX и DI осуществляется без прямого обращения к буферам.
- Логика трейлинг-стопа хранит последний уровень и сдвигает его только при дополнительной прибыли не меньше `TrailingStepPips`, что соответствует «ступенчатому» поведению оригинального эксперта.
- Все комментарии в исходном коде написаны на английском, как требует регламент репозитория.
- Стратегия реализована только на C# (`API/2908_Auto_ADX/CS/AutoAdxStrategy.cs`); Python-версия сознательно не создавалась.

## Рекомендации по использованию
1. Убедитесь, что у инструмента корректно заполнен `PriceStep`, иначе пересчёт пунктов будет неверным.
2. Настройте `AdxLevel` под волатильность актива: высокий порог уменьшает число сделок, но повышает качество трендового фильтра.
3. Для отключения трейлинг-стопа достаточно установить `TrailingStopPips = 0`; параметр шага в этом случае игнорируется, как и в MQL-версии.
4. Проведите бэктесты на разных рынках, чтобы оценить эффективность пунктовых защит и фильтра по наклону ADX.
