# Стратегия Calendar Change Saver

## Обзор
**Calendar Change Saver** — это стратегия StockSharp, повторяющая работу оригинального сервиса MQL5 из пакета `MQL/45592`. В исходном коде сервис подключался к экономическому календарю MetaTrader и сохранял каждый новый набор идентификаторов изменений в файл. В портированной версии стратегия подписывается на новости брокера и сериализует их в журнал для последующего анализа.

Стратегия **не** совершает торговых операций. Её задача — построить постоянный архив новостей, позволяющий исследовать реакцию рынка на публикации и тестировать алгоритмы, чувствительные к календарю.

## Особенности конверсии
- В MQL5 цикл с задержкой постоянно вызывал `CalendarValueLast`, записывал полученный набор идентификаторов в двоичный файл и игнорировал подозрительно большие ответы (более 100 записей).
- В StockSharp используется событийный подход. Стратегия подписывается на `MarketDataTypes.News` выбранного инструмента и кеширует каждое событие `NewsMessage`.
- Периодический таймер с настраиваемым интервалом выгружает накопленные записи на диск. Каждая строка файла содержит время выгрузки, размер пакета и компактное представление новостей.
- Пакеты, превышающие лимит `BulkLimit`, пропускаются — это защищает архив от некорректных данных, как и в MQL5.

## Параметры
| Название | Описание | Значение по умолчанию |
| --- | --- | --- |
| `OutputFileName` | Путь к текстовому файлу, куда записываются пакеты новостей. Отсутствующие каталоги создаются автоматически. | `calendar_changes.log` |
| `FlushIntervalMilliseconds` | Интервал таймера (мс), с которым кеш выгружается на диск. | `1000` |
| `BulkLimit` | Максимальное количество новостей в одном пакете. Более крупные пакеты считаются недостоверными и пропускаются. | `100` |

## Формат выходного файла
```
<flush_time_iso>|<batch_count>|[<event_time_iso>;<source>;<headline>;<story>,...]
```
- `flush_time_iso` — момент выгрузки в формате ISO (UTC).
- `batch_count` — число новостей в пакете.
- `event_time_iso` — время новости в UTC.
- `source`, `headline`, `story` — текстовые поля, очищенные от разделителей.

## Использование
1. Подключите стратегию к коннектору, который поставляет новости.
2. Укажите инструмент и при необходимости скорректируйте параметры (например, путь к файлу или частоту выгрузки).
3. Запустите стратегию — все новые `NewsMessage` будут попадать в очередь и периодически сохраняться в файл.
4. Остановите стратегию, чтобы корректно закрыть файловый поток.

## Ограничения
- Если источник данных не предоставляет новости, файл останется пустым.
- Пакеты, превышающие `BulkLimit`, отбрасываются для сохранения чистоты архива.

