# Стратегия Maybeawo222

## Общее описание
Maybeawo222 — это перенос советника MetaTrader "maybeawo222" на платформу StockSharp. Стратегия работает с одним инструментом, использует пересечение простой скользящей средней предыдущей свечой и ограничивает открытие новых позиций заданным торговым интервалом. Также сохранена двухэтапная логика перевода стоп-лосса в безубыток.

## Логика работы
1. Стратегия подписывается на свечи типа `CandleType` и рассчитывает простую скользящую среднюю длиной `MovingPeriod`.
2. Перед сравнением значение SMA сдвигается на `MovingShift` уже закрытых свечей, что повторяет параметр `shift` функции `iMA` в оригинальном коде.
3. Сигналы на вход анализируются только тогда, когда время закрытия свечи попадает в диапазон `[StartHour, EndHour)`. Вне торговых часов новые заявки не выставляются, но активные позиции продолжают сопровождаться.
4. Сигнал на покупку появляется, когда свеча открылась ниже смещённой SMA и закрылась выше неё. Для продаж требуется обратная ситуация. При необходимости стратегия разворачивает позицию, чтобы остаться только в одном направлении.
5. После закрытия каждой свечи проверяются экстремумы для фиксации попадания в уровни стоп-лосса или тейк-профита. При достижении соответствующий выход выполняется рыночной заявкой.
6. При достижении плавающей прибыли `BreakevenPips1` или `BreakevenPips2` стоп переносится к цене входа на расстояние `DesiredBreakevenDistancePips1` либо `DesiredBreakevenDistancePips2`, что позволяет частично зафиксировать результат.

## Управление рисками
- Стоп-лосс и тейк-профит указываются в пунктах. Конвертация выполняется через `PriceStep`, причём для трёх- и пятизначных котировок шаг умножается на 10, как в MetaTrader.
- Флаги безубыточности сбрасываются при каждом новом входе, что гарантирует максимум два переноса стопа на одну позицию.
- Закрытие выполняется рыночными ордерами — это позволяет выйти из позиции даже при отсутствии стопов на стороне брокера.

## Параметры
| Название | Значение по умолчанию | Диапазон / примечание | Описание |
|----------|-----------------------|-----------------------|----------|
| `MovingPeriod` | `14` | Положительное целое | Длина SMA для определения пересечения. |
| `MovingShift` | `0` | Рекомендуется `0` – `10` | Количество закрытых свечей для смещения SMA. |
| `StopLossPips` | `100` | `0` отключает | Расстояние от входа до стоп-лосса в пунктах. |
| `TakeProfitPips` | `800` | `0` отключает | Расстояние от входа до тейк-профита в пунктах. |
| `BreakevenPips1` | `180` | `0` отключает | Порог прибыли (в пунктах) для первого переноса стопа. |
| `DesiredBreakevenDistancePips1` | `60` | Неотрицательное значение | Новое расстояние стопа от входа после первого переноса. |
| `BreakevenPips2` | `500` | `0` отключает | Порог прибыли для второго переноса стопа. |
| `DesiredBreakevenDistancePips2` | `350` | Неотрицательное значение | Новое расстояние стопа от входа после второго переноса. |
| `StartHour` | `3` | `0` – `23` | Час начала торгового окна (включительно). |
| `EndHour` | `22` | `0` – `23` | Час окончания торгового окна (не включительно). |
| `OrderVolume` | `0.5` | > `0` | Объём рыночной заявки при входе. |
| `CandleType` | `H1` | Любой тип свечей | Ряд свечей, используемый для сигналов и расчёта SMA. |

## Практические замечания
- Проверьте, что у инструмента задан корректный `PriceStep`. Если шаг равен нулю, пересчёт пунктов fallback'ом вернёт `1`, и параметры придётся подбирать вручную.
- Стратегия рассчитана на один инструмент. Перед запуском добавьте нужный актив в подключение и назначьте его стратегии.
- В реальной торговле при необходимости можно дополнить решение брокерскими защитными ордерами или контролем проскальзывания, чтобы учесть особенности конкретной площадки.
