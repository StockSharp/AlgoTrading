# CoensioTrader1 V06 策略

## 概述
CoensioTrader1 V06 最初是一款 MetaTrader 专家顾问（EA），通过识别布林带假突破并结合趋势过滤进行交易。本次 StockSharp 迁移保留了核心形态逻辑，删除了与经纪商、DLL 授权及远程服务器通信相关的全部代码。策略仅针对单一品种与时间框架运行，依靠布林带与双指数移动平均线（DEMA）来捕捉趋势恢复。

原始 EA 支持最多六个货币对的独立参数配置，并会将优化结果上传至作者服务器。迁移版本聚焦于进出场流程，忽略所有外部依赖，以方便回测与进一步定制。

## 策略逻辑
1. **数据订阅**：订阅指定的 K 线类型（默认 1 小时），并绑定布林带与 DEMA 指标。
2. **布林带反弹判定**：所有条件基于最近一根完整收盘 K 线。
   - **多头条件**
     - K 线开盘价位于前一根布林带下轨之下，但收盘价重新站上该下轨（假突破）。
     - 当前 K 线的最低价高于前一根 K 线的最低价，同时前一根 K 线的最低价低于再前一根 K 线（双底结构）。
     - DEMA 三个连续值呈上升状态（当前值 > 前一个值 > 再前一个值）。
   - **空头条件**
     - K 线开盘价位于前一根布林带上轨之上，但收盘价跌回上轨之下（假突破）。
     - 当前 K 线的最高价低于前一根 K 线的最高价，同时前一根 K 线的最高价高于再前一根 K 线（双顶结构）。
     - DEMA 三个连续值呈下降状态。
3. **下单执行**：在条件成立的下一根 K 线开盘时立即发送市价单。若启用 `CloseOnSignal`，则在反向信号出现时会先平掉原有仓位。
4. **风控设置**：通过 `StartProtection` 提供可选的止损与止盈距离，使用绝对价格差。原版 EA 的逐步跟踪止损功能未移植。

## 参数说明
| 参数 | 作用 | 默认值 |
| ---- | ---- | ------ |
| `BollingerPeriod` | 布林带周期长度。 | 30 |
| `BollingerDeviation` | 布林带标准差倍数。 | 1.5 |
| `DemaPeriod` | DEMA 周期，用于趋势判定。 | 20 |
| `StopLossDistance` | 传递给 `StartProtection` 的绝对止损距离，0 表示关闭。 | `0 (绝对值)` |
| `TakeProfitDistance` | 传递给 `StartProtection` 的绝对止盈距离，0 表示关闭。 | `0 (绝对值)` |
| `CloseOnSignal` | 是否在出现反向信号时先行平仓。 | `false` |
| `CandleType` | 使用的 K 线类型/周期。 | `1 小时` |

## 使用提示
- StockSharp 版本仅交易主符号，如需多品种交易，请分别启动多个策略实例并设置不同参数。
- MQL 中的仓位 sizing（`RiskMax`、`LotSize`、`LotBalanceDivider`）未移植，请在策略属性中设置 `Volume` 或结合自定义风控模块。
- 迁移中移除了 DLL 授权检查、HTTP 通讯和图形注释。需要可视化时，可使用 StockSharp 的绘图助手。
- 止损与止盈参数为绝对价格差，请结合标的品种的点值或最小变动单位进行换算。
- 原有的拖尾止损步进机制未实现，如需动态保护可叠加额外的风险管理逻辑。
- 代码内注释全部使用英文，方便与仓库中其他策略保持一致；中文、英文、俄文说明分列于 README。

## 与原始 MQL 版本的差异
- **多品种管理**：改为单品种，实现更清晰的状态管理与测试流程。
- **网络与授权**：全部删除，无外部 HTTP 请求或 DLL 调用。
- **下单手数**：依赖 StockSharp 默认的 `Volume` 处理方式。
- **图形绘制**：未复刻 MetaTrader 中的箭头、文字标签与配色方案。
- **拖尾止损**：未移植，仅提供初始保护单设置。

本文档力求详尽，使读者在不参考原始 MQL 代码的情况下即可理解并扩展该策略。
