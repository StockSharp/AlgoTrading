# Стратегия CoensioTrader1 V06

## Общее описание
CoensioTrader1 V06 — это эксперт MetaTrader, который ищет ложные пробои границ полос Боллинджера и подтверждает сигналы по структуре экстремумов и наклону DEMA. Перенос в StockSharp сохраняет ключевые торговые правила и отказывается от сетевых проверок лицензии, загрузки логов и другой инфраструктуры, присутствовавшей в MQL-коде. Реализация рассчитана на один инструмент и один таймфрейм, что упрощает тестирование и эксплуатацию.

Изначально советник позволял работать с шестью валютными парами, отправлял результаты оптимизации на сервер разработчика и рисовал на графике служебные объекты. В версии для StockSharp оставлена только торговая логика: формирование сигналов, открытие/закрытие позиций и базовое управление рисками через `StartProtection`.

## Логика торговли
1. **Подписка на данные** — стратегия подписывается на выбранный тип свечей (по умолчанию 1 час) и привязывает к потоку свечей индикаторы Bollinger Bands и DEMA.
2. **Анализ закрытой свечи** — сигналы рассчитываются после появления новой полностью сформированной свечи.
   - **Покупка**
     - Свеча открылась ниже предыдущей нижней полосы Боллинджера и закрылась выше неё (ложный пробой вниз).
     - Минимум свечи выше минимума предыдущей свечи, а та, в свою очередь, обновила минимум ещё более ранней свечи (паттерн «двойное дно»).
     - Значение DEMA последовательно растёт в течение трёх отсчётов (текущий > предыдущего > предпредыдущего).
   - **Продажа**
     - Свеча открылась выше предыдущей верхней полосы Боллинджера и закрылась ниже неё (ложный пробой вверх).
     - Максимум свечи ниже максимума предыдущей свечи, при этом предыдущая свеча выше ещё более ранней (паттерн «двойная вершина»).
     - Значение DEMA последовательно снижается.
3. **Исполнение сделок** — при выполнении условий стратегия отправляет рыночные заявки. Опция `CloseOnSignal` позволяет закрыть противоположную позицию перед открытием новой.
4. **Риск-менеджмент** — используются опциональные уровни стоп-лосса и тейк-профита, задаваемые в абсолютных ценовых величинах. Шаговый трейлинг из оригинального MQL-скрипта не реализован.

## Параметры
| Параметр | Назначение | Значение по умолчанию |
| -------- | ---------- | --------------------- |
| `BollingerPeriod` | Период расчёта полос Боллинджера. | 30 |
| `BollingerDeviation` | Множитель стандартного отклонения. | 1.5 |
| `DemaPeriod` | Период двойной экспоненциальной средней (DEMA). | 20 |
| `StopLossDistance` | Абсолютная дистанция стоп-лосса, передаваемая в `StartProtection` (0 отключает стоп). | `0 (абсолют)` |
| `TakeProfitDistance` | Абсолютная дистанция тейк-профита, передаваемая в `StartProtection`. | `0 (абсолют)` |
| `CloseOnSignal` | Закрывать ли текущую позицию при появлении обратного сигнала. | `false` |
| `CandleType` | Тип/таймфрейм свечей. | `1 час` |

## Практические замечания
- Стратегия работает только с инструментом, указанным в `Strategy.Security`. Для обслуживания нескольких инструментов запустите несколько экземпляров с разными настройками.
- Алгоритм расчёта объёма из MQL (`RiskMax`, `LotSize`, `LotBalanceDivider`) не переносился. Используйте свой риск-менеджмент и свойство `Volume` стратегии.
- Весь код, связанный с DLL, сетевыми запросами и отрисовкой объектов на графике, удалён. Для визуализации используйте стандартные средства StockSharp.
- Значения стопов задаются в абсолютных ценовых величинах, поэтому их нужно адаптировать под шаг цены конкретного инструмента.
- Механизм пошагового трейлинга из оригинала отсутствует. При необходимости добавьте собственный модуль сопровождения позиции.
- Комментарии в исходнике приведены на английском языке; к стратегии прилагаются детальные описания на английском, китайском и русском.

## Отличия от MQL-версии
- **Мультивалютность**: стратегия обслуживает только один инструмент, что облегчает контроль состояния.
- **Сетевая активность**: в порте нет HTTP-запросов, файловой телеметрии и проверок лицензии.
- **Размер позиций**: размер сделки определяется общими настройками StockSharp.
- **Графические элементы**: стрелки и подписи с графика MetaTrader не воспроизводятся.
- **Трейлинг**: только начальные стоп/тейк, без автоматического подтягивания.

Документация максимально подробна, чтобы упростить аудит и дальнейшее развитие стратегии без необходимости изучать исходный MQL-код.
