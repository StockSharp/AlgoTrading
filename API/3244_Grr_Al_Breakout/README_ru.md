# Стратегия Grr AL Breakout

## Общее описание
**Grr AL Breakout** — порт советника MetaTrader `grr-al.mq5`. Стратегия фиксирует цену открытия каждой свечи и ожидает, когда рынок отклонится от этой отметки на заданное количество пунктов. Как только это происходит, совершается ровно одна сделка в пределах текущей свечи с возможным разворотом существующей позиции.

Перенос на StockSharp выполнен через высокоуровневую подписку на свечи. Новая свеча задаёт опорную цену, а все обновления той же свечи содержат актуальное значение закрытия, используемое как текущая рыночная цена. Такой подход воспроизводит логику таймера и обработки тиков из оригинального советника без ручного управления событиями.

## Торговая логика
1. **Опорная цена** — в момент появления новой свечи сохраняется её цена открытия (если значение отсутствует, берётся первое закрытие) и сбрасывается флаг срабатывания для текущей свечи.
2. **Проверка пробоя** — пока в данной свече не было сделок, стратегия сравнивает последнюю цену с опорной. Рост выше порога `DeltaPoints` открывает короткую позицию, падение на ту же величину — длинную позицию.
3. **Одна сделка на свечу** — после срабатывания сделки новые заявки в пределах той же свечи не размещаются, что соответствует флагу `br` в MQL-версии.
4. **Защита позиции** — при открытии новой позиции сразу устанавливаются стоп-лосс и тейк-профит. Если ордер лишь сокращает встречную позицию, защитные заявки не выставляются.
5. **Управление объёмом** — можно работать с фиксированным лотом или ограничить объём долей от максимального доступного значения у брокера.

## Параметры
- `Volume` — базовый объём сделки (аналог `BASELOT`). Используется, если `RiskFraction = 0`.
- `RiskFraction` — доля от максимально допустимого объёма (от 0 до 1). При значении больше нуля фактический объём ограничивается минимумом между `Volume` и произведением доли на максимум брокера.
- `DeltaPoints` — величина пробоя в пунктах, необходимая для входа (соответствует `DELTA`).
- `StopLossPoints` — расстояние стоп-лосса в пунктах. Ноль отключает защиту, как и `SL = 0` в оригинале.
- `TakeProfitPoints` — расстояние тейк-профита в пунктах. Ноль отключает цель по прибыли (`TP = 0`).
- `CandleType` — тип свечей StockSharp, определяющий рабочий таймфрейм. По умолчанию используется пятиминутный интервал.

## Отличия от MQL-версии
- В MetaTrader советник работал через таймер и получение тиков, в StockSharp используется автоматическая подписка на свечи без ручной обработки таймера.
- В высокоуровневом API нет разделения bid/ask, поэтому для расчётов применяется цена закрытия свечи. Смещения по стопу и тейк-профиту по-прежнему задаются в пунктах.
- Расчёт объёма по риску упрощён: вместо маржинальных вычислений используется ограничение долей от максимального лота, что делает стратегию независимой от конкретного брокера.
- В StockSharp применяется неттинговый подход: противоположный рыночный ордер может закрыть или развернуть позицию автоматически, аналогично режиму неттинга в MetaTrader 5.

## Использование
1. Выберите инструмент и портфель в Designer, Runner или собственной обёртке StockSharp.
2. Настройте таймфрейм свечей, параметры пробоя, стоп-лосс, тейк-профит и объём.
3. Запустите стратегию — она самостоятельно подпишется на данные и будет открывать сделки при выполнении условий.

## Исходный файл
- MetaTrader 5: `MQL/244/grr-al.mq5`
