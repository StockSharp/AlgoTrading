[English](README.md) | [中文](README_cn.md)

**ASC++ Williams Breakout** — это порт советника "ASC++.mq4" на высокоуровневый API StockSharp. Стратегия отслеживает узкие диапазоны волатильности, подтверждённые осциллятором Williams %R, и выставляет отложенные заявки немного выше/ниже экстремумов свечи. После активации позиции защищаются автоматическим тейк-профитом, стоп-лоссом и при необходимости трейлингом.

## Логика работы

1. **Подготовка индикаторов**
   - Быстрый и медленный Williams %R (по умолчанию 9 и 54 периода) оценивают моментум.
   - ATR с периодом 10 сглаживает «ручной» расчёт диапазона из оригинального эксперта.
   - Пороговые значения `x1 = 67 + RiskLevel` и `x2 = 33 - RiskLevel` повторяют адаптивные зоны перекупленности/перепроданности.
2. **Накопление сигнала**
   - Для каждой завершённой свечи вычисляется `value2 = 100 - |%R_fast|`. Значения ниже `x2` указывают на потенциал пробоя вверх, выше `x1` — на пробой вниз.
   - Пока свечи остаются в той же экстремальной зоне, счётчики подтверждений увеличиваются. Торговля разрешается только после `SignalConfirmation` подряд идущих свечей (аналог `SigVal` в MQL).
3. **Выставление заявок**
   - Если диапазон сжат (`ATR < EntryRange`) и направление моментума подтверждено (`%R_fast` выше или ниже `%R_slow`), выставляются стоп-заявки:
     - Buy Stop на уровне `High + ATR * 0.5 + EntryStopLevel * PriceStep`.
     - Sell Stop на уровне `Low - ATR * 0.5 - EntryStopLevel * PriceStep`.
   - Противоположные отложенные заявки отменяются, чтобы исключить конфликтующие позиции.
4. **Сопровождение позиции**
   - Защита активируется через `StartProtection`: тейк-профит и стоп-лосс указываются в пунктах, трейлинг включается, когда `TrailingStopPoints > 0`.
   - При появлении противоположного сигнала открытая позиция закрывается рыночной заявкой до постановки нового стоп-ордера — как в исходном коде.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | Таймфрейм 15 минут | Источник свечей для расчётов. |
| `FastLength` | 9 | Период быстрого Williams %R. |
| `SlowLength` | 54 | Период медленного Williams %R. |
| `RangeLength` | 10 | Окно сглаживания ATR, заменяющее ручной расчёт диапазона. |
| `EntryStopLevel` | 10 пунктов | Дополнительный отступ (в шагах цены) для отложенных заявок. |
| `EntryRange` | 27 пунктов | Максимальный средний диапазон, допускающий постановку ордера. |
| `RiskLevel` | 3 | Регулирует пороги `x1`/`x2`, сужая или расширяя зоны подтверждения. |
| `SignalConfirmation` | 5 свечей | Минимальное число подряд идущих свечей в экстремальной зоне. |
| `TakeProfitPoints` | 100 пунктов | Дистанция автоматического тейк-профита. |
| `StopLossPoints` | 40 пунктов | Дистанция защитного стоп-лосса. |
| `TrailingStopPoints` | 20 пунктов | Включает трейлинг стопа при значении больше нуля. |

## Особенности конверсии

- В исходнике диапазон рассчитывался вручную с весами; порт использует стандартный `AverageTrueRange` с тем же периодом 10, что избавляет от массивов и совпадает по смыслу.
- Таймеры `SigValBuy` и `SigValSell`, завязанные на минутную метку, заменены на счётчик `SignalConfirmation`, который требует заданное количество последовательных свечей.
- Выставление и отмена отложенных ордеров реализованы через `BuyStop`/`SellStop`, что повторяет логику `OrderSend`/`OrderDelete`.
- Риск-менеджмент полностью отдан `StartProtection`, поэтому тейк-профит, стоп-лосс и трейлинг управляются инфраструктурой StockSharp, упрощая лестницу `TSLevel1/TSLevel2`.
- Все индикаторы подключаются через подписку и `Bind`, без прямого доступа к буферам или методов `GetValue`.

## Рекомендации по использованию

- Убедитесь, что у инструмента задан `PriceStep`. При необходимости скорректируйте `EntryStopLevel`, `EntryRange` и уровни риска под размер тика.
- Уменьшите `SignalConfirmation` для более агрессивной торговли на младших таймфреймах или увеличьте для отбора сильных консолидаций.
- Визуализируйте уровни на графике (через хост-приложение), чтобы проверить расположение стоп-заявок относительно локальных максимумов/минимумов.
- Перед реальной торговлей обязательно прогоните стратегию на исторических данных: чувствительность к спреду, проскальзыванию и особенностям брокера очень высока.
