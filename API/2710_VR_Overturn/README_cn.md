# VR Overturn 策略

## 概述
- 将 MetaTrader 的 “VR---Overturn” 专家顾问迁移到 StockSharp 的高级 API。
- 任意时刻只保持一张仓位，前一笔平仓后立即评估下一次进场。
- 适合希望自动反转并采用马丁或反马丁加仓方式的交易者。

## 交易流程
1. **首次建仓**：按照 `FirstPositionDirection` 参数指定的方向，用 `BaseVolume` 作为基础手数开出第一笔订单。
2. **止损与止盈**：根据 `StopLossPips` 与 `TakeProfitPips` 自动附加保护性订单。程序会读取品种的最小报价步长，将点值转换为绝对价格偏移（对于 3 位和 5 位小数的品种会自动乘以 10，与原始策略一致）。
3. **平仓记录**：当仓位被保护性订单平仓时，策略会保存：
   - 平仓方向（多或空）；
   - 实际成交量；
   - 实现盈亏（开仓价与平仓价的差值）。
4. **下一次进场**：根据记录的结果决定下一笔交易的方向与手数。
   - 盈利后保持原方向，亏损后反向。
   - 马丁模式在亏损后将手数乘以 `LotMultiplier`，盈利后回到基础手数。
   - 反马丁模式在盈利后放大手数，亏损后回到基础手数。
5. **手数校正**：下单前将计算出的数量裁剪到交易所允许的最小手数步长。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `FirstPositionDirection` | 第一笔交易的方向（Buy/Sell）。 | Buy |
| `Mode` | 手数管理模式：Martingale（亏损后放大）或 AntiMartingale（盈利后放大）。 | Martingale |
| `BaseVolume` | 初始仓位手数，也是重置时的手数。 | 0.1 |
| `StopLossPips` | 止损距离（点）。 | 30 |
| `TakeProfitPips` | 止盈距离（点）。 | 90 |
| `LotMultiplier` | 扩仓时使用的乘数（马丁在亏损后使用，反马丁在盈利后使用）。 | 1.6 |

## 风险管理
- 通过 `StartProtection` 为每次进场附加止损与止盈。
- 止损与止盈距离会根据点值转换为绝对价格偏移。
- 没有额外的追踪功能，风险完全由保护性订单与反向规则控制。

## 使用注意
- 策略不依赖任何蜡烛或指标，仅在 `OnOwnTradeReceived` 中响应成交确认。
- 如果保护单被部分成交，会累计剩余仓位，直到全部平仓后才允许下一次进场。
- StockSharp 的成交对象不包含佣金和隔夜利息，因此盈亏判断仅基于价格差。如手续费较高，可适当增加止损距离或乘数。
- 使用前请确认标的提供价格步长与手数步长信息，以保证正确的点值与手数计算。
