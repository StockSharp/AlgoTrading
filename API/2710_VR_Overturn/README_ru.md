# Стратегия VR Overturn

## Общее описание
- Переносит советник MetaTrader «VR---Overturn» на высокоуровневый API StockSharp.
- В любой момент времени удерживает только одну позицию и сразу рассчитывает следующий вход после закрытия предыдущего.
- Подходит трейдерам, которым нужна автоматическая смена направления позиции с режимами мартингейла и анти-мартингейла.

## Логика торговли
1. **Первичный вход** — первая сделка открывается в направлении, заданном параметром `FirstPositionDirection`, базовым объёмом `BaseVolume`.
2. **Стоп и тейк** — защитные ордера выставляются автоматически на основе параметров `StopLossPips` и `TakeProfitPips`. Размер пункта пересчитывается в абсолютное смещение по цене с учётом шага цены инструмента (для 3- и 5-значных котировок применяется умножение на 10, как в оригинальном советнике).
3. **Обработка закрытия** — при закрытии позиции совет фиксирует:
   - направление закрытой сделки;
   - фактический объём;
   - реализованную прибыль/убыток (разницу между ценой входа и выхода).
4. **Расчёт следующего входа** — сохранённый результат определяет направление и объём следующего ордера.
   - Выигрышные сделки продолжают движение в ту же сторону, убыточные — разворачиваются.
   - В режиме мартингейла объём увеличивается после убытка и возвращается к базовому после прибыли.
   - В режиме анти-мартингейла объём увеличивается после прибыли и возвращается к базовому после убытка.
5. **Округление лота** — рассчитанный объём подгоняется под ближайший шаг объёма инструмента перед отправкой рыночного ордера.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `FirstPositionDirection` | Направление первой сделки (Buy/Sell). | Buy |
| `Mode` | Режим управления объёмом: Martingale (рост после убытков) или AntiMartingale (рост после прибыли). | Martingale |
| `BaseVolume` | Базовый объём позиции, используемый при сбросе серии. | 0.1 |
| `StopLossPips` | Расстояние до стоп-лосса в пунктах. | 30 |
| `TakeProfitPips` | Расстояние до тейк-профита в пунктах. | 90 |
| `LotMultiplier` | Множитель, применяемый на шаге увеличения объёма (после убытка для мартингейла, после прибыли для анти-мартингейла). | 1.6 |

## Управление рисками
- Используется `StartProtection` для привязки стоп-лосса и тейк-профита к каждому входу.
- Расстояния стопа и цели пересчитываются в абсолютное смещение цены исходя из заданного количества пунктов.
- Дополнительного трейлинга нет, поэтому риск контролируется защитными ордерами и правилами разворота.

## Эксплуатационные заметки
- Стратегия не использует свечи и индикаторы, вся логика строится на обработке торговых подтверждений (`OnOwnTradeReceived`).
- При частичном исполнении защитного ордера объём суммируется до полного закрытия позиции, после чего разрешается следующий вход.
- Комиссии и свопы в объектах StockSharp недоступны, поэтому сравнение прибыли выполняется только по разнице цен. При высоких комиссиях стоит увеличить стопы или множитель.
- Требуется инструмент с определённым шагом цены и объёма — проверьте эти свойства перед запуском на реальном счёте.
