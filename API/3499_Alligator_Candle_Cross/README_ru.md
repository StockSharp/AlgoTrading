# Стратегия Alligator Candle Cross

Стратегия переносит советники MetaTrader **alligator candle cross up/down** на высокоуровневый API StockSharp. Она отслеживает индикатор Bill Williams Alligator, построенный из сглаженных скользящих средних медианной цены, и реагирует, когда тело завершившейся свечи переходит с одной стороны «пасти» Аллигатора на другую. Через параметр можно ограничить сделки только длинным, только коротким или обоими направлениями, а риск управляется фиксированными стопами и целями в пунктах.

## Логика торговли

### Подготовка индикаторов
- Рассчитываются линии **Jaw**, **Teeth** и **Lips** Аллигатора с классическими периодами 13/8/5.
- Применяются стандартные смещения вперёд (8/5/3 бара по умолчанию), чтобы сравнивать значения линий со свечой, которая формируется перед ними.
- Цены берутся из медианы свечи `(High + Low) / 2`, что повторяет реализацию в MetaTrader.

### Условия для покупок («candle cross up»)
1. Закрытие предыдущей завершённой свечи находится на уровне или ниже минимальной линии Аллигатора (с учётом смещения).
2. Текущее тело свечи открывается на уровне или ниже максимального смещённого значения Аллигатора и закрывается выше него, то есть пересекает «пасть» вверх.
3. Открытых позиций нет, торговля разрешена.
4. При выполнении условий отправляется рыночная заявка **Buy** с заданным объёмом.

### Условия для продаж («candle cross down»)
1. Закрытие предыдущей свечи находится на уровне или выше максимальной смещённой линии Аллигатора.
2. Текущее тело свечи открывается на уровне или выше минимального смещённого значения и закрывается ниже него, подтверждая пересечение вниз.
3. Позиция отсутствует, торговля разрешена.
4. Отправляется рыночная заявка **Sell** на заданный объём.

### Управление позицией
- После открытия позиции стоп-лосс и тейк-профит переводятся из пунктов в абсолютные цены через шаг цены инструмента.
- Длинная позиция закрывается при достижении стоп-лосса, тейк-профита или при закрытии свечи ниже минимума смещённых линий Teeth и Lips.
- Короткая позиция закрывается при срабатывании стоп-лосса, тейк-профита или при закрытии выше максимума смещённых линий Teeth и Lips.
- В начале работы вызывается **StartProtection**, чтобы защитить счёт от нештатных исполнений.

## Параметры

| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --------------------- | -------- |
| `OrderVolume` | `decimal` | `0.1` | Объём сделки в лотах или контрактах. |
| `StopLossPips` | `int` | `50` | Расстояние до защитного стопа в пунктах. Ноль отключает стоп. |
| `TakeProfitPips` | `int` | `50` | Расстояние до фиксированного тейк-профита в пунктах. Ноль отключает цель. |
| `JawPeriod` | `int` | `13` | Период сглаженной средней линии челюсти Аллигатора. |
| `JawShift` | `int` | `8` | Смещение линии челюсти вперёд перед оценкой сигналов. |
| `TeethPeriod` | `int` | `8` | Период сглаженной средней линии зубов Аллигатора. |
| `TeethShift` | `int` | `5` | Смещение линии зубов. |
| `LipsPeriod` | `int` | `5` | Период сглаженной средней линии губ Аллигатора. |
| `LipsShift` | `int` | `3` | Смещение линии губ. |
| `CandleType` | `DataType` | `TimeSpan.FromHours(1).TimeFrame()` | Таймфрейм свечей для расчётов. |
| `EntryMode` | `AlligatorCrossMode` | `Both` | Выбор направления торговли: только покупки, только продажи или оба варианта. |

## Примечания по использованию
- Стратегия подходит для любого инструмента StockSharp; установите `CandleType` в соответствии с таймфреймом оригинального шаблона MetaTrader.
- Пункты вычисляются из шага цены: для котировок с 3 или 5 знаками (например, EURUSD) один пункт равен десяти шагам цены.
- Логика работает только с завершёнными свечами и не использует тиковые данные, что облегчает сопоставление с тестами MetaTrader.
