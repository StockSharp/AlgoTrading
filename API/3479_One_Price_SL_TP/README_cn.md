# 单一价格止损/止盈策略
[English](README.md) | [Русский](README_ru.md)

该实用策略在 StockSharp 中复刻了 MetaTrader 脚本“One Price SL TP”。策略本身不会主动开仓，而是监控选定品种的当前持仓，确保两个保护性订单都被调至用户指定的同一个目标价格。

当参数 **`ZenPrice`** 大于零时，策略会把它与最新的买卖报价进行比较：

- **多头** 持仓：若 `ZenPrice` 高于卖价，则在该价格挂出止盈限价单；若 `ZenPrice` 低于买价，则在该价格挂出止损停止单。
- **空头** 持仓：若 `ZenPrice` 低于买价，则在该价格挂出止盈限价单；若 `ZenPrice` 高于卖价，则在该价格挂出止损停止单。

如果目标价格位于买卖价之间，则不会发送任何新订单，已有的保护单保持不变。一旦仓位被平掉或参数重置为零，所有保护性订单都会被自动撤销。

## 工作流程

1. 订阅 Level1 数据，持续获取做方向检查所需的即时买卖价。
2. 跟踪策略当前的持仓方向与数量，默认这些仓位由人工或其他策略建立。
3. 在每次报价、持仓或自身成交更新时，判断 `ZenPrice` 所处的市场一侧，并选择对应的保护性订单类型。
4. 在发送请求前，将目标价格按照品种的最小报价单位归一化，并把下单量四舍五入到交易所允许的范围。
5. 对已激活的保护单使用 `ReRegisterOrder` 进行修改，避免无谓的撤单，模拟 MetaTrader 直接修改订单的方式。

## 参数

- **`ZenPrice`** – 用作止损或止盈的绝对价格。设置为 `0` 即停用自动化。默认值：`0`。

## 使用说明

- 策略从不提交入场订单，可与手动交易终端或其他自动化策略同时运行。
- 只有在收到包含买价和卖价的首个 Level1 快照后，才会发出保护单。此前策略会静待数据，就像原始 MQL 脚本依赖终端行情一样。
- 当条件只满足一侧（例如 `ZenPrice` 高于卖价但不低于买价）时，会撤销另一侧的保护单，以免遗留过期价格。
- 代码中的注释全部使用英文，文档则按照项目要求提供多语言版本。

## 与 MetaTrader 脚本的差异

- 原脚本直接修改持仓票据中的止损和止盈字段，而 StockSharp 将保护水平表示为独立的止损单和限价单，因此本移植版本改为操作交易所可见的订单。
- MetaTrader 会自动把价格对齐到经纪商精度。本移植通过 `NormalizePrice` 利用品种的价格步长和小数位数实现相同效果。
- 在发送保护单之前，会把下单量四舍五入到合约的最小手数步长，以适配对合约数量有固定要求的交易场所。
