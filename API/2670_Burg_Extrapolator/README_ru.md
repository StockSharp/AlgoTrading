# Стратегия Burg Extrapolator

## Описание

Стратегия Burg Extrapolator — это адаптация эксперт-советника MetaTrader «Burg Extrapolator» на базе высокоуровневого API StockSharp. Алгоритм строит авторегрессионную модель (AR) с оценкой коэффициентов методом Берга и прогнозирует будущие значения цены открытия. Торговые решения принимаются исходя из амплитуды прогнозной траектории: если ожидаемый размах превышает заданные пороги, стратегия открывает или закрывает позиции.

## Логика работы

1. **Подготовка данных**
   - На каждой завершённой свече собирается массив из `PastBars` цен открытия.
   - По желанию данные преобразуются в логарифмический импульс (`log(p[i]/p[i-1])`) или в темп изменения (`p[i]/p[i-1] - 1`).
   - При работе с исходными ценами значения центрируются путём вычитания скользящего среднего.
2. **Авторегрессионная модель**
   - Порядок AR-модели определяется как целая часть от `ModelOrderFraction * PastBars`.
   - Коэффициенты вычисляются методом Берга, что позволяет минимизировать среднеквадратичную ошибку вперёд и назад одновременно.
   - Полученные коэффициенты используются для экстраполяции будущих значений (горизонт = `PastBars - order - 1`).
3. **Формирование сигналов**
   - По прогнозной траектории фиксируются максимум и минимум.
   - Если расстояние между максимумом и минимумом превышает `MinProfitPips`, генерируется сигнал на вход в соответствующую сторону.
   - Если амплитуда достигает `MaxLossPips`, стратегия инициирует выход из текущих позиций.
4. **Исполнение приказов**
   - Сделки открываются рыночными заявками с объёмом, рассчитанным исходя из процента риска и размера стоп-лосса.
   - При появлении противоположного сигнала или срабатывании защитных условий позиции закрываются рыночными приказами.

## Параметры

- `RiskPercent` — доля капитала (в процентах), которая рискуется в одной сделке. Используется для вычисления объёма при наличии стоп-лосса.
- `MaxPositions` — максимальное число условных лотов в одном направлении (в кратных величине заявки).
- `MinProfitPips` — минимальный прогнозируемый профит (в пунктах), необходимый для открытия позиции.
- `MaxLossPips` — максимальный допустимый прогнозируемый убыток (в пунктах), при превышении которого позиция закрывается.
- `TakeProfitPips` — расстояние до тейк-профита (в пунктах). Ноль — отключено.
- `StopLossPips` — расстояние до стоп-лосса (в пунктах). Используется в управлении риском.
- `TrailingStopPips` — расстояние для трейлинг-стопа (в пунктах); работает только при активном стоп-лоссе.
- `PastBars` — количество исторических баров, подаваемых в модель Берга.
- `ModelOrderFraction` — доля от `PastBars`, определяющая порядок AR-модели (дробная часть отбрасывается).
- `UseMomentum` — включение логарифмического импульса в качестве входных данных.
- `UseRateOfChange` — включение темпа изменения (ROC), используется только если `UseMomentum` = false.
- `OrderVolume` — резервный объём заявки, если вычислить объём по риску невозможно.
- `CandleType` — тип свечей/таймфрейм, на которых работает стратегия.

## Правила торговли

- **Вход**: открывать длинную позицию, если сначала достигается прогнозный максимум и размах превышает `MinProfitPips`; короткую — если сначала достигается прогнозный минимум.
- **Выход**: закрывать позиции, когда прогнозный размах превышает `MaxLossPips` или возникает противоположный входной сигнал.
- **Защита**: вызывает `StartProtection` для установки стоп-лосса, тейк-профита и трейлинг-стопа (значения переводятся из пунктов в абсолютную цену автоматически).
- **Размер позиции**: при положительных `StopLossPips` и `RiskPercent` объём равен `Equity * RiskPercent / (100 * StopLossDistance)`. В остальных случаях используется `OrderVolume`.

## Особенности реализации

- Обрабатываются только завершённые свечи (проверка `candle.State == CandleStates.Finished`).
- Значения индикаторов не запрашиваются через `GetValue`, всё вычисляется внутри обработчика `Bind`.
- Подписка на свечи осуществляется через `SubscribeCandles`, что соответствует рекомендациям по использованию высокоуровневого API.
- Трейлинг-стоп реализован средствами движка StockSharp, аналогично оригинальному советнику.

## Рекомендации

- Подбирайте `PastBars` и `ModelOrderFraction` так, чтобы прогнозный горизонт оставался положительным (например, доля порядка < 0.8).
- В режимах импульса и ROC цены должны быть строго положительными; для инструментов, допускающих переход через ноль, лучше использовать исходные цены.
- Следите за актуальностью настроек риска: без корректного `StopLossPips` стратегия не сможет рассчитать объём и будет торговать резервным значением.
- Проверяйте чувствительность модели на длинных участках истории — AR-модели склонны к переобучению в трендовых фазах.

## Состав папки

- `CS/BurgExtrapolatorStrategy.cs` — исходный код стратегии на C#.
- `README.md` — описание на английском языке.
- `README_ru.md` — данное описание на русском языке.
- `README_cn.md` — описание на китайском языке.

Версия на Python преднамеренно не создаётся в рамках задания.
