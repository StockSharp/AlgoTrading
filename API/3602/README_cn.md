# ShowHistoryOnChart 策略

## 概述
**ShowHistoryOnChartStrategy** 会读取由 MetaTrader 导出的成交历史 CSV 文件，并在 StockSharp 环境中按照历史时间表重新开平仓。该策略不计算任何指标，主要用于在实时图表或回放中重现过去的交易轨迹，便于视觉化分析。

## 原始 MQL 思路
原版 MetaTrader 专家顾问 "ShowHistoryOnChart-V1.1" 会从 CSV 文件中读取成交历史，并在图表上绘制箭头与趋势线标记每一笔交易，本身并不会发出订单。移植到 StockSharp 后，通过在记录的时间点发送市价单，并利用内置的 Own Trades 图层显示成交，从而达到与原指标类似的效果。

## 交易逻辑
1. **CSV 解析**：启动时读取 `FileName` 参数指向的 CSV 文件。文件必须以分号分隔，并包含以下字段：开仓时间、交易类型（Buy/Sell）、成交量、符号、开仓价、额外的成交量列、平仓时间、平仓价、手续费、隔夜利息和盈亏。
2. **品种过滤**：只有 `symbol` 字段与所选证券（`Security.Id` 或 `Security.Code`）匹配的记录才会进入计划。
3. **时间排序**：所有记录按照开仓时间排序。任何在策略启动时间之前已经开始的交易都会被跳过，以免重复历史。
4. **回放循环**：策略订阅 `CandleType` 指定的蜡烛。当蜡烛完成时：
   - 所有开仓时间不晚于该蜡烛收盘时间的记录，会通过 `BuyMarket` 或 `SellMarket` 发送市价单开仓。
   - 所有已经在列表中的记录，如果平仓时间不晚于该蜡烛收盘时间，则发送相反方向的市价单平仓。
5. **图表呈现**：因为真实订单被发送，`DrawOwnTrades` 会在图表上展示进出场点位，与原脚本绘制的箭头一致。

## 参数
| 名称 | 说明 | 默认值 |
|------|------|--------|
| `FileName` | CSV 成交历史的绝对或相对路径。 | 空字符串 |
| `CandleType` | 用于驱动时间轴的蜡烛类型（例如 1 分钟）。 | 1 分钟蜡烛 |

## 额外说明
- 时间戳必须能够被 `DateTimeOffset.Parse` 或 `DateTime.Parse` 在不变文化环境中解析（如 `2023.05.01 12:30`）。
- 成交量取自第三列（原 MQL 中的 `volume1`），并自动转换为绝对值。
- 数据缺失、类型错误或平仓时间早于开仓时间的记录会被跳过，并在日志中给出警告。
- 策略只承担调度功能，不会计算任何指标或生成额外信号。
