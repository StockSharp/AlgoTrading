# 神经网络模板策略

## 概述
该策略来源于 MQL5 神经网络模板专家顾问。由于 StockSharp 环境缺少原始项目中的自定义网络加载器，我们使用可解释的得分模型来替代黑盒网络，同时保持原策略的结构、指标和风险控制。目标是在 RSI 与 MACD 指向同一方向且预计波动幅度足够时捕捉动能行情。

## 指标与数据
- **相对强弱指标 RSI（12 周期）** 基于收盘价计算，对应原模板的典型价格输入。
- **MACD 指标（12/48/12）** 利用直方图作为动能与置信度衡量。
- **时间框架** 可配置，默认使用 5 分钟 K 线，与原始专家设置保持一致。

## 交易逻辑
1. 每根收盘的 K 线都会更新 RSI 和 MACD 直方图的滚动队列，队列长度由 `BarsToPattern` 控制。
2. RSI 偏离 50 水平以及 MACD 直方图相对滚动均值的偏差会被组合成置信度分数，并通过双曲正切函数进行压缩，模拟原神经网络的输出。
3. 当置信度绝对值超过 `TradeLevel` 且预测幅度（转换为点数）大于 `MinTargetPoints` 时，策略按照分数指示的方向下市价单。
4. 预测幅度乘以 `ProfitMultiply` 后得到的动态止盈价会被限制在 `MaxTakeProfitPoints` 之内，并与对称的止损点位一起保存，供手动退出管理使用。
5. 持仓期间每根收盘 K 线都会检查价格是否触及止盈或止损，一旦达到即市价平仓并重置内部状态。

## 参数
| 参数 | 说明 |
| --- | --- |
| `BarsToPattern` | 用于计算 RSI 与 MACD 统计的滚动窗口长度。 |
| `TradeLevel` | 开仓前所需的最小置信度（0-1）。 |
| `ProfitMultiply` | 在限制 `MaxTakeProfitPoints` 之前应用于预测幅度的倍数。 |
| `MinTargetPoints` | 进入交易所需的最小预测点数。 |
| `MaxTakeProfitPoints` | 止盈的最大允许点数。 |
| `StopLossPoints` | 相对入场价的固定止损距离。 |
| `TradeVolume` | 每次市价单的下单手数。 |
| `CandleType` | 策略订阅的 K 线类型或时间框架。 |

## 说明
- 采用确定性置信度模型，便于调试与复现，同时保留原神经网络策略的整体结构。
- 为了复刻原模板的动态止盈/止损逻辑，策略使用内部变量管理每笔交易的目标价位与止损价位。
- 策略只在没有持仓时才评估新的入场信号，与原 MQL5 专家顾问的单仓模式一致。
