# TCPivotStop 策略

## 概述

**TCPivotStop 策略** 是对 MetaTrader 智能交易系统 `gpfTCPivotStop` 的移植。策略围绕前一交易日的经典楼层枢轴计算展开。每当新的交易日开始时，策略会：

1. 汇总上一交易日的最高价、最低价和收盘价，计算枢轴点以及前三个支撑/阻力位。
2. 检查最近完成的小时 K 线是否从上方或下方穿越枢轴。
3. 在发生穿越时按照原版 EA 的方式发送市价单，并应用对应的止损和止盈价格。

同一时间仅允许持有一个方向的仓位，可选的日内收盘功能会在新交易日开始前平掉当前仓位。

## 交易规则

- **时间框架** – 默认使用 1 小时 K 线（可配置）。
- **枢轴计算** – 使用前一日的高/低/收数据计算 `Pivot`、`R1`、`R2`、`R3`、`S1`、`S2`、`S3`。
- **入场条件**
  - 当上一根 K 线收在枢轴下方且再前一根 K 线收在枢轴上方时做空。
  - 当上一根 K 线收在枢轴上方且再前一根 K 线收在枢轴下方时做多。
- **仓位大小** – 由 `OrderVolume` 参数定义的固定手数。
- **出场条件**
  - 止损和止盈价格直接映射到枢轴支撑/阻力位。
  - 启用 `CloseAtSessionEnd` 时，会在新交易日开始前强制平仓。
  - 策略根据 K 线的最高价/最低价监控防护水平，一旦被触及即发送市价平仓单。

## 参数

| 参数 | 说明 | 默认值 |
| ---- | ---- | ------ |
| `OrderVolume` | 市价单的交易手数。 | `0.1` |
| `TakeProfitTarget` | 选择使用哪一档枢轴作为止盈目标（`1`=最近，`3`=最远）。 | `1` |
| `CloseAtSessionEnd` | 新交易日开始前是否平仓。 | `false` |
| `CandleType` | 用于计算的时间框架。 | `H1` |

## 备注

- 策略仅在生成新的枢轴数据时（每日一次）评估信号，与原始 EA 在日线开盘第一笔报价触发相同。
- MetaTrader 版本会根据账户保证金动态调整仓位，此移植版本保持固定手数，需要更复杂的资金管理可通过其他组件实现。
- 防护单通过监控 K 线极值并在触发时发送市价指令来模拟。

## 文件结构

- `CS/TcpPivotStopStrategy.cs` – 交易逻辑的 C# 实现。
- `README.md` – 英文文档。
- `README_cn.md` – 简体中文文档（本文件）。
- `README_ru.md` – 俄文文档。
