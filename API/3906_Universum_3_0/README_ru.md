# Стратегия Universum 3.0 Original
[English](README.md) | [中文](README_cn.md)

Стратегия полностью повторяет советник **Universum_3_0** из MQL4, используя высокоуровневый API StockSharp.
Она объединяет простую логику порогов по индикатору DeMarker и адаптивное управление объёмом на основе мартингейла.

## Логика торговли

- **Индикатор**: классический DeMarker с настраиваемым периодом.
- **Правила входа**:
  - Длинная позиция открывается при `DeMarker > 0.5` на закрытии завершённой свечи.
  - Короткая позиция открывается при `DeMarker < 0.5` на закрытии завершённой свечи.
  - Одновременно может быть только одна позиция; сигналы игнорируются, пока сделка не закрыта.
- **Управление выходом**:
  - К позиции автоматически привязываются тейк-профит и стоп-лосс в абсолютных пунктах.
  - Закрытие происходит по защитным уровням, стратегия не переворачивается мгновенно.
- **Управление капиталом**:
  - После прибыльной сделки объём сбрасывается к базовому лоту.
  - После убыточной сделки объём умножается на `(TakeProfitPoints + StopLossPoints) / (TakeProfitPoints - SpreadPoints)`.
  - Значение спрэда берётся из Level1 (лучшая покупка/продажа) и переводится в пункты с учётом точности инструмента.
  - Счётчик последовательных убытков ведётся и при достижении лимита стратегия останавливается, как в оригинале.
  - Параметр `FastOptimize = true` отключает адаптивное увеличение объёма, что ускоряет черновую оптимизацию.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `CandleType` | Таймфрейм свечей для расчёта DeMarker. | Свечи 1 минута |
| `DemarkerPeriod` | Период индикатора DeMarker. | `10` |
| `TakeProfitPoints` | Размер тейк-профита в пунктах (переводится в абсолютное значение). | `50` |
| `StopLossPoints` | Размер стоп-лосса в пунктах. | `50` |
| `BaseVolume` | Исходный объём после прибыльных сделок. | `1` |
| `LossesLimit` | Максимальное число подряд идущих убытков до остановки стратегии. | `1 000 000` |
| `FastOptimize` | При `true` отключает адаптивный объём для быстрой оптимизации. | `true` |

## Особенности реализации

- Для вычисления мультипликатора объёма необходимы данные Level1 со спредом.
- Нормализация объёма учитывает минимальный объём инструмента, шаг и максимально допустимое значение.
- Стопы автоматически подстраиваются под инструменты с 3/5 знаками за счёт корректировки пункта.
- На график выводятся свечи, индикатор DeMarker и совершённые сделки для визуального контроля.

## Практические советы

1. Подайте вместе со свечами котировки Level1, чтобы корректно рассчитывался спред.
2. Используйте `FastOptimize = true` на этапе грубой оптимизации, а затем отключайте для точных прогонов и реальной торговли.
3. Следите за счётчиком убытков при агрессивных настройках, чтобы не выйти за лимиты брокера.
4. Перед реальной торговлей адаптируйте `TakeProfitPoints` и `StopLossPoints` под конкретный инструмент и стиль управления риском.
