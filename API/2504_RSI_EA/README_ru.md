# Стратегия RSI EA
[English](README.md) | [中文](README_cn.md)

Стратегия RSI EA воспроизводит советник MetaTrader 5 «RSI EA». Она отслеживает индекс относительной силы (RSI) на выбранной серии свечей и реагирует на пересечение настраиваемых уровней перекупленности и перепроданности. При конвертации сохранены идеи исходной системы по стоп-лоссу, тейк-профиту, трейлинг-стопу и автоматическому управлению капиталом, но они реализованы через высокоуровневый API стратегий StockSharp.

## Логика стратегии

### Индикаторы
- **RSI** с настраиваемым периодом, рассчитанный на выбранном типе свечей.

### Условия входа
- **Покупка**: RSI пересекает `RsiBuyLevel` снизу вверх (предыдущее значение ниже уровня, текущее выше) и разрешена торговля в лонг.
- **Продажа**: RSI пересекает `RsiSellLevel` сверху вниз (предыдущее значение выше уровня, текущее ниже) и разрешена торговля в шорт.

Стратегия поддерживает только одну неттированную позицию. При наличии открытой позиции дополнительные хеджирующие сделки не создаются.

### Условия выхода
- **Выход по сигналу**: если `CloseBySignal` включён, противоположное пересечение RSI немедленно закрывает текущую позицию.
- **Защитный стоп**: при `StopLoss` больше нуля стратегия контролирует расстояние от средней цены входа и закрывает позицию при достижении указанного убытка.
- **Тейк-профит**: при `TakeProfit` больше нуля позиция закрывается при достижении целевого расстояния.
- **Трейлинг-стоп**: при `TrailingStop` больше нуля уровень стопа следует за ценой. Для покупок стоп переносится на `Close - TrailingStop`, когда цена проходит не менее `TrailingStop` от текущего стопа; для продаж используется зеркальная логика.

### Расчёт объёма
- При `UseAutoVolume = true` объём вычисляется от капитала и риска: `Volume = Equity * RiskPercent / (100 * stopDistance)`, где `stopDistance` берёт `StopLoss`, если он задан, иначе `TrailingStop`. Если защитное расстояние не настроено, стратегия использует ручной объём.
- При `UseAutoVolume = false` для всех сделок используется фиксированное значение `ManualVolume`.

## Параметры
- `CandleType`: тип свечей для расчёта индикатора (по умолчанию минутные свечи).
- `RsiPeriod`: количество баров в окне расчёта RSI (по умолчанию 14).
- `RsiBuyLevel`: уровень перепроданности для открытия лонгов и закрытия шортов (по умолчанию 30).
- `RsiSellLevel`: уровень перекупленности для открытия шортов и закрытия лонгов (по умолчанию 70).
- `EnableLong`: разрешение торговли в лонг (по умолчанию true).
- `EnableShort`: разрешение торговли в шорт (по умолчанию true).
- `CloseBySignal`: закрывать позиции при противоположном пересечении RSI (по умолчанию true).
- `StopLoss`: расстояние стоп-лосса в ценовых единицах (по умолчанию 0 — отключён).
- `TakeProfit`: расстояние тейк-профита в ценовых единицах (по умолчанию 0 — отключён).
- `TrailingStop`: расстояние трейлинг-стопа в ценовых единицах (по умолчанию 0 — отключён).
- `UseAutoVolume`: включить риск-ориентированный расчёт объёма (по умолчанию true).
- `RiskPercent`: доля капитала, которой рискуем при включённом автообъёме (по умолчанию 10).
- `ManualVolume`: фиксированный объём при отключённом автообъёме (по умолчанию 0.1).

## Особенности реализации
- Используется высокоуровневый вызов `SubscribeCandles(...).Bind(...)`, поэтому значения RSI передаются напрямую без ручного копирования буферов.
- При возврате позиции к нулю все защитные уровни сбрасываются, чтобы избежать устаревших значений стопов и тейк-профитов.
- Логика трейлинг-стопа повторяет код MQL: стоп подтягивается только после прохождения ценой расстояния более чем вдвое превышающего текущий трейлинг, что предотвращает раннее срабатывание.
- В среде StockSharp нельзя держать одновременные лонг и шорт, как в исходном хеджинговом советнике. Стратегия ждёт закрытия текущей позиции, прежде чем открывать противоположную.
- Автоматический расчёт объёма требует заданного `StopLoss` или `TrailingStop`. Если расстояние неизвестно, используется ручной объём.

## Конфигурация по умолчанию
- Таймфрейм: минутные свечи.
- RSI: период 14, уровни 30/70.
- Управление капиталом: автообъём включён, риск 10% капитала, резервный ручной объём 0.1.
- Риск-контроль: стоп-лосс, тейк-профит и трейлинг-стоп по умолчанию отключены (их нужно настроить перед реальной торговлей).

## Рекомендации по использованию
- Настройте `CandleType` под ваш инструмент и горизонт, стратегия работает на любом интервале, поддерживаемом свечами StockSharp.
- Перед включением автообъёма задайте реалистичный `StopLoss` или `TrailingStop`, чтобы риск рассчитывался корректно.
- Используйте встроенную защиту `StartProtection()` (уже вызывается в коде), чтобы минимизировать риски разрыва связи и «зависших» позиций.
- Регулярно контролируйте исполнения и корректируйте уровни RSI под конкретный рынок, поскольку оптимальные значения могут отличаться.
