# Exp XPeriod Candle 策略

该策略是 MQL5 专家顾问 `Exp_XPeriodCandle` 的 StockSharp 版本。它在高层 API 中重建了自定义的 XPeriodCandle 指标，通过蜡烛颜色的变化来决定开平仓。

## 核心思路

* 对每根已完成蜡烛的开、高、低、收价格进行平滑处理，平滑方法可配置。
* 根据平滑后的开收关系确定蜡烛颜色（收盘 ≥ 开盘为看涨，否则为看跌）。
* 通过最近两根已完成蜡烛（可配置偏移）的颜色变化来判定反转并产生交易信号。
* 在出现新信号时可选择平掉反向持仓，并支持以价格点数表示的止损/止盈保护。

## 实现细节

* 直接支持的平滑类型：简单、指数、平滑（RMA）以及线性加权。由于 StockSharp 没有 JJMA/JurX/Parabolic/T3/VIDYA/AMA 的原生实现，其余选项退化为指数平滑，并在代码中明确说明。
* 使用队列保存最近 `Period` 个平滑高点与低点，以保持与原始指标一致的价格区间。
* 策略在积累到足够历史数据前不会交易，并在达到条件时设置 `IsFormed` 以兼容回测过滤逻辑。
* 可选的滑点、止损和止盈会优先使用标的的最小报价步长；若步长未知，则直接采用点数值。

## 参数说明

| 参数 | 说明 |
|------|------|
| `CandleType` | 参与计算的蜡烛周期。 |
| `Period` | 平滑窗口深度（对应指标周期）。 |
| `SmoothingMethods` | 用于所有 OHLC 序列的平滑类型，未实现的选项自动回退到 EMA。 |
| `SmoothingLength` | 平滑算法长度参数。 |
| `SmoothingPhase` | 相位参数（保留与原指标一致，在本实现中仅作兼容）。 |
| `SignalBar` | 进行判断的已完成蜡烛编号（1 表示上一根蜡烛，与原策略默认一致）。 |
| `EnableLongEntry` / `EnableShortEntry` | 是否允许做多/做空建仓。 |
| `EnableLongExit` / `EnableShortExit` | 在出现反向信号时是否平掉现有仓位。 |
| `StopLossPoints` / `TakeProfitPoints` | 以价格点数表示的止损/止盈距离，设为 0 则禁用。 |
| `SlippagePoints` | 市价单允许的滑点点数。 |

## 交易规则

1. 对最新完成的蜡烛进行平滑并记录其颜色。
2. 当 `SignalBar` 所需的历史颜色可用时：
   * 若更早一根蜡烛为看涨（颜色 < 1）而较新的蜡烛非看涨（颜色 > 0），允许情况下开多并可选择平空。
   * 若更早一根蜡烛为看跌（颜色 > 1）而较新的蜡烛非看跌（颜色 < 2），允许情况下开空并可选择平多。
3. 仓位大小由策略的 `Volume` 设置决定，反向信号会先平掉已有仓位再反向开仓。
4. 使用 `StartProtection` 按给定点数自动设置止损与止盈。

## 备注

* 原策略依赖 `SmoothAlgorithms.mqh` 中的专有算法。由于 StockSharp 缺乏 JJMA/JurX/T3 等实现，本移植版本以 EMA 近似这些模式，并在代码与说明中明确记录，方便后续优化时调整。
* 默认参数与 MQL 版本保持一致，便于复用已有的优化区间。
