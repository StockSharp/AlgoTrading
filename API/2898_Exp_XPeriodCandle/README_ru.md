# Стратегия Exp XPeriod Candle

Стратегия представляет собой порт MQL5-советника `Exp_XPeriodCandle` на платформу StockSharp. Индикатор XPeriodCandle пересобран средствами высокоуровневого API, а входы и выходы строятся на смене "цвета" свечей.

## Идея

* Выполняется сглаживание открытий, максимумов, минимумов и закрытий каждой завершённой свечи с настраиваемым типом усреднения.
* Цвет свечи определяется по соотношению сглажённых открытия и закрытия: закрытие ≥ открытие — бычья свеча, иначе медвежья.
* Сравнение цветов двух последних завершённых свечей (смещение задаётся параметром) позволяет фиксировать развороты и формировать сигналы.
* При появлении нового сигнала стратегия может закрывать встречные позиции и применять защитные стопы/тейк-профиты, заданные в пунктах.

## Особенности реализации

* Непосредственно поддерживаются усреднения Simple, Exponential, Smoothed (RMA) и Linear Weighted. Для режимов JJMA/JurX/Parabolic/T3/VIDYA/AMA, отсутствующих в StockSharp, используется экспоненциальная аппроксимация, что явно отмечено в коде и документации.
* Очереди последних `Period` сглаженных максимумов и минимумов сохраняют диапазон цен в духе оригинального индикатора.
* До накопления достаточной истории торговля не начинается; при готовности стратегия устанавливает `IsFormed`, что совместимо с фильтрами бэктестера StockSharp.
* Преобразование скользящего допуска по цене, стоп-лосса и тейк-профита выполняется через шаг цены инструмента, при его отсутствии берётся указанное количество пунктов.

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Таймфрейм анализируемых свечей. |
| `Period` | Глубина окна сглаживания (аналог периода индикатора). |
| `SmoothingMethod` | Тип сглаживания для всех OHLC. Неподдерживаемые варианты возвращаются к EMA. |
| `SmoothingLength` | Длина окна для сглаживания. |
| `SmoothingPhase` | Фазовый параметр (оставлен для совместимости с исходным алгоритмом). |
| `SignalBar` | Номер завершённой свечи, участвующей в анализе (1 = предыдущая, как в оригинале). |
| `EnableLongEntry` / `EnableShortEntry` | Разрешение на открытие длинных/коротких позиций. |
| `EnableLongExit` / `EnableShortExit` | Закрытие существующих позиций при противоположных сигналах. |
| `StopLossPoints` / `TakeProfitPoints` | Расстояние защитных стопов в пунктах; 0 отключает защиту. |
| `SlippagePoints` | Допустимое отклонение цены исполнения рыночных ордеров. |

## Правила торговли

1. Сгладить текущую завершённую свечу и обновить историю её цветов.
2. При наличии данных для `SignalBar`:
   * Если более старая свеча была бычьей (цвет < 1), а более новая — небычьей (цвет > 0), открываем лонг (если разрешено) и при необходимости закрываем шорт.
   * Если более старая свеча была медвежьей (цвет > 1), а более новая — немедвежьей (цвет < 2), открываем шорт (если разрешено) и при необходимости закрываем лонг.
3. Размер позиции задаётся параметром `Volume`; при развороте противоположные позиции закрываются прежде, чем открывать новую.
4. `StartProtection` автоматически выставляет стоп-лосс и тейк-профит на основе указанных пунктов.

## Примечания

* Оригинальный код использует библиотеку `SmoothAlgorithms.mqh`. В StockSharp нет прямых аналогов JJMA/JurX/T3 и др., поэтому в портированной версии для этих режимов применяется EMA с соответствующим пояснением.
* Значения по умолчанию полностью повторяют MQL-реализацию, что облегчает перенос оптимизаций и сравнительный анализ.
