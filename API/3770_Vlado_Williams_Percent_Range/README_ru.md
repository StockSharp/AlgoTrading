# Стратегия Vlado Williams %R Threshold

## Общее описание
**Vlado Williams %R Threshold** — перенос советника MetaTrader 4 `Vlado_www_forex-instruments_info.mq4` на платформу StockSharp. Алгоритм использует один индикатор Williams %R и меняет направление торговли при пересечении заданного уровня. В любой момент времени стратегия удерживает лишь одну позицию, полностью повторяя последовательность вызовов `CheckForSignals → CheckForClose → CheckForOpen` из оригинального кода.

### Основные особенности
- Управление позицией основано на сравнении Williams %R с пороговым значением `WprLevel` (по умолчанию `-50`).
- Стратегия не переворачивается мгновенно: сначала закрывает открытую позицию и лишь на следующей свече рассматривает вход в противоположную сторону.
- Встроенная опция money-management рассчитывает объём по формуле `equity × MaximumRiskPercent ÷ 100 ÷ closePrice`, что соответствует исходному правилу `AccountFreeMargin * MaximumRisk / price`.
- Параметр `CandleType` задаёт таймфрейм для сигналов и ордеров; стандартное значение — 15-минутные свечи.

## Логика торговли
1. При старте подписываемся на свечи `CandleType` и вычисляем Williams %R длиной `WprLength`.
2. Когда Williams %R становится **выше** порога `WprLevel`:
   - Фиксируется бычий режим. Если позиции нет и предыдущая сделка не была длинной, отправляется рыночная заявка на покупку.
   - При наличии короткой позиции она закрывается немедленно; открытие лонга переносится на следующий завершённый бар.
3. Когда Williams %R опускается **ниже** `WprLevel`:
   - Включается медвежий режим. Если позиции нет и предыдущая сделка не была короткой, отправляется рыночная заявка на продажу.
   - При наличии лонга он закрывается мгновенно.
4. Метод `CalculateOrderVolume` подбирает размер заявки:
   - При активном флаге `UseRiskMoneyManagement` используется текущая оценка капитала портфеля. При отсутствии данных или выключенном флаге применяется базовое свойство `Volume`.
   - Полученный объём нормализуется по `VolumeStep` инструмента и ограничивается диапазоном `MinVolume`/`MaxVolume`, если он указан биржей.

Тем самым достигнута полная совместимость с MT4-версией: выход из позиции всегда происходит раньше, чем попытка переворота.

## Особенности переноса
- Значение `MaximumRiskPercent` по умолчанию равно `10`, что эквивалентно исходному `MaximumRisk = 10` в советнике.
- Параметр `shift` в исходнике всегда был равен нулю и потому исключён.
- Цветовые константы (`Red`, `Blue`) из вызовов `OrderSend` в StockSharp не нужны и были удалены.
- Параметр проскальзывания больше не требуется: рыночные заявки исполняются по текущей лучшей цене.

## Параметры
| Параметр | Тип | Значение по умолчанию | Описание |
|----------|-----|------------------------|----------|
| `CandleType` | `DataType` | 15-минутные свечи | Таймфрейм для расчёта сигналов и размещения заявок. |
| `WprLength` | `int` | 100 | Глубина расчёта индикатора Williams %R. |
| `WprLevel` | `decimal` | `-50` | Порог между бычьим и медвежьим режимами. |
| `UseRiskMoneyManagement` | `bool` | `false` | Включает динамический расчёт объёма. |
| `MaximumRiskPercent` | `decimal` | `10` | Доля капитала, задействуемая в сделке при включённом money-management. |

> **Важно.** В стратегии отсутствуют стоп-ордера и тейк-профиты. Для ограничения риска рекомендуется использовать `StartProtection()` либо внешние защитные механизмы.

## Рекомендации по использованию
1. Назначайте инструмент с корректными параметрами `PriceStep`, `StepPrice`, `VolumeStep`, а также лимитами `MinVolume`/`MaxVolume`, чтобы функция расчёта объёма работала без ошибок.
2. Свойство `Volume` служит базовым значением на случай отсутствия данных по капиталу или отключённого риск-менеджмента.
3. Для адаптации к различным рынкам оптимизируйте `WprLength` и `WprLevel`. Более крайние уровни (`-20` и `-80`) уменьшают частоту сделок, а значение `-50` делает стратегию почти постоянно инвестированной.
4. Поскольку система является трендовой, в боковике возможны частые ложные сигналы. Добавьте фильтры по волатильности, объёму или старшему таймфрейму при необходимости.

## Отличия от версии MT4
- Реализация основана на высокоуровневых подписках StockSharp; отсутствует ручной перебор ордеров и истории.
- Расчёт лота использует `Portfolio.CurrentValue`. Если значение недоступно, стратегия возвращается к фиксированному объёму, что воспроизводит поведение исходного `mm = 0`.
- Комментарии и описания параметров переведены на английский язык согласно требованиям репозитория.

## Контрольный список
- ✅ Код следует внутреннему стандарту: file-scoped namespace, табуляция, `inheritdoc` в переопределённых методах.
- ✅ Параметры созданы через `Param()` и отмечены `SetCanOptimize(true)` там, где уместно.
- ✅ Значение Williams %R берётся из `Bind`, без использования запрещённых `GetValue()`/`GetCurrentValue()`.
