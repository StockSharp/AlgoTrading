# Стратегия Hammer & Hanging Man с фильтром CCI
[English](README.md) | [中文](README_cn.md)

Стратегия переносит советник MetaTrader «AH HM CCI» на StockSharp. Она отслеживает свечные паттерны «молот» и «висячий человек»,
а вход подтверждает индикатор Commodity Channel Index (CCI). Дополнительная проверка отсекает слабые паттерны и помогает
отрабатывать только те развороты, где импульс действительно меняется.

Обработка ведётся только по завершённым свечам. Короткая простая скользящая средняя (SMA) задаёт тренд: предыдущая свеча должна
быть молотом в нисходящем тренде с перепроданным CCI для входа в лонг либо висячим человеком в восходящем тренде с перекупленным
CCI для входа в шорт. Закрытия позиций происходят при пересечении CCI настроенных уровней, что повторяет «систему голосов»
оригинального эксперта.

## Логика торговли

1. **Трендовый фильтр.** Средняя точка предыдущей свечи должна располагаться ниже (для лонга) или выше (для шорта) SMA по ценам
   закрытия.
2. **Распознавание паттерна.** Анализируется предыдущая свеча:
   - Тело полностью находится в верхней трети диапазона свечи.
   - Есть ценовой разрыв между открытиями/закрытиями двух последних свечей.
   - Контекст соответствует типу паттерна (молот внизу тренда, висячий человек вверху).
3. **Подтверждение CCI.** Значение CCI на предыдущей свече должно быть ниже порога для лонга или выше порога для шорта. По
   умолчанию используются значения 40 и 60 как в шаблоне MetaTrader.
4. **Выход из позиций.** Текущие позиции закрываются, когда CCI пересекает один из уровней выхода. Пересечение снизу вверх
   закрывает лонг, сверху вниз — шорт.

## Параметры

| Имя | Описание | Значение по умолчанию |
| --- | -------- | --------------------- |
| `CandleType` | Тип и таймфрейм свечей для анализа. | `TimeSpan.FromMinutes(15)` |
| `CciPeriod` | Количество баров в расчёте CCI. | `11` |
| `MaPeriod` | Период SMA для трендового фильтра. | `5` |
| `LongConfirmationThreshold` | Максимальное значение CCI для подтверждения молота. | `40` |
| `ShortConfirmationThreshold` | Минимальное значение CCI для подтверждения висячего человека. | `60` |
| `ExitUpperThreshold` | Уровень CCI, при пересечении снизу которого закрывается позиция. | `70` |
| `ExitLowerThreshold` | Дополнительный уровень CCI для раннего выхода. | `30` |

Все параметры доступны для оптимизации, а пороги допускают отрицательные значения, что позволяет адаптировать стратегию под
другие рынки и волатильность.

## Управление заявками

- **Входы** выполняются рыночными ордерами объёмом `Volume + |Position|`, чтобы переворот выполнялся одной сделкой.
- **Выходы** основаны только на пересечениях CCI — так сохраняется близость к оригинальному советнику. При необходимости можно
  добавить `StartProtection` со стопами и тейк-профитами.

## Рекомендации

- Используйте стратегию на ликвидных инструментах с чёткими хвостами свечей и ценовыми разрывами.
- Для старших таймфреймов увеличивайте `CciPeriod` и `MaPeriod`, чтобы сгладить шум.
- Уменьшение `LongConfirmationThreshold` или увеличение `ShortConfirmationThreshold` сократит число входов, но повысит их
  избирательность.
