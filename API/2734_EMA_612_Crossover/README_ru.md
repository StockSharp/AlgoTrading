# Ema612CrossoverStrategy

## Краткое описание
- Порт советника MetaTrader 5 **"EMA 6.12 (barabashkakvn's edition)"** на высокоуровневый API StockSharp.
- Использует пересечение быстрой и медленной простых скользящих средних (в оригинале также применялась MODE_SMA, несмотря на название EMA).
- Реализует необязательные тейк-профит и трейлинг-стоп в абсолютных ценовых единицах, чтобы пользователь мог адаптировать значения под свой инструмент.

## Логика торговли
### Подготовка данных
- Стратегия подписывается на свечи типа `CandleType` (по умолчанию 15-минутные бары).
- Рассчитываются две SMA: быстрая длиной `FastPeriod` и медленная длиной `SlowPeriod`. Значение `SlowPeriod` обязательно должно быть больше `FastPeriod`.

### Условия входа
- Сигналы формируются только после закрытия свечи.
- **Бычье пересечение**: медленная SMA была выше быстрой на предыдущей свече и опустилась ниже на текущей. Любая короткая позиция закрывается, затем открывается длинная позиция объёмом `Volume`.
- **Медвежье пересечение**: медленная SMA была ниже быстрой на предыдущей свече и поднялась выше на текущей. Любая длинная позиция закрывается, затем открывается короткая позиция объёмом `Volume`.

### Условия выхода
- Позиция закрывается при обратном пересечении скользящих средних.
- При `TakeProfitOffset > 0` фиксируется цель: для лонга выход по цене `entry + TakeProfitOffset`, для шорта `entry - TakeProfitOffset`.
- При `TrailingStopOffset > 0` активируется трейлинг-стоп. Он начинает срабатывать только после того, как нереализованная прибыль превысит `TrailingStopOffset + TrailingStepOffset`. Затем стоп подтягивается на расстояние `TrailingStopOffset` от цены закрытия, но лишь если новое значение ближе к цене минимум на `TrailingStepOffset`. Для лонгов используется минимум свечи, для шортов максимум.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | Таймфрейм 15 минут | Таймфрейм свечей для расчётов и сигналов. |
| `FastPeriod` | 6 | Период быстрой SMA. Должен быть > 0 и меньше `SlowPeriod`. |
| `SlowPeriod` | 54 | Период медленной SMA. Должен быть > 0 и больше `FastPeriod`. |
| `Volume` | 1 | Объём заявки при открытии новой позиции. |
| `TakeProfitOffset` | 0.001 | Абсолютное расстояние до тейк-профита от цены входа. Установите 0, чтобы отключить. |
| `TrailingStopOffset` | 0.005 | Абсолютное расстояние между ценой и трейлинг-стопом. 0 — отключение трейлинга. |
| `TrailingStepOffset` | 0.0005 | Дополнительное движение цены в прибыль, необходимое для подтяжки стопа. |

> **Важно:** значения задаются в абсолютных ценовых единицах. Подбирайте их в соответствии с шагом цены инструмента (например, для EURUSD с шагом 0.0001 значения 0.001, 0.005 и 0.0005 соответствуют 10, 50 и 5 пунктам).

## Особенности реализации
- Используется высокоуровневый пайплайн `SubscribeCandles().Bind()` в соответствии с требованиями проекта.
- При наличии графика стратегия отображает обе SMA и сделки.
- Вспомогательные переменные отслеживают цену входа, уровень трейлинг-стопа и тейк-профит аналогично версии на MQL5.
- В конструкторе выполняется проверка `SlowPeriod > FastPeriod`, чтобы избежать некорректной настройки индикаторов.

## Рекомендации по использованию
- Оптимизируйте таймфрейм свечей и периоды SMA под ваш рынок (короче для скальпинга, длиннее для свинговой торговли).
- Переводите значения трейлинга и тейк-профита из пунктов/тиков в абсолютные единицы цены перед запуском.
- Чтобы отключить трейлинг, установите `TrailingStopOffset` в ноль — тогда выход будет происходить только по противоположному пересечению или тейк-профиту.
