# Стратегия Starter V6 Mod (версия для StockSharp)

## Обзор

**Starter V6 Mod** — это перенос советника MetaTrader 5 `Starter_v6mod` на высокоуровневый API StockSharp. В оригинале стратегия комбинирует осциллятор Laguerre RSI, две экспоненциальные скользящие средние, индикатор CCI и сеточное управление позицией. Конверсия сохраняет многоступенчатую фильтрацию сигналов, адаптируя управление капиталом и защиту позиций под архитектуру StockSharp.

## Логика торговли

### Используемые индикаторы

* **Прокси Laguerre RSI** — нормированный RSI с периодом 14, приводимый к диапазону 0–1 для имитации Laguerre RSI. Уровни `LevelDown` и `LevelUp` задают зоны перепроданности и перекупленности.
* **Медленная EMA (120)** и **быстрая EMA (40)** — рассчитываются по медианной цене свечи. Их расхождение определяет направление тренда, порог задаётся параметром `AngleThreshold` в тиках.
* **CCI (14)** — подтверждает импульс: для покупок требуется CCI < 0, для продаж — CCI > 0.

### Условия входа

1. Определить тренд через расхождение EMA:
   * Если `EMA(120) - EMA(40) < -AngleThreshold`, стратегия может открывать только длинные позиции.
   * Если `EMA(120) - EMA(40) > AngleThreshold`, допускаются только короткие позиции.
   * В пределах порога рынок считается боковым и новые позиции не открываются.
2. Дополнительные фильтры для разрешённого направления:
   * Лонг — Laguerre ниже `LevelDown`, обе EMA снижаются относительно предыдущего значения, CCI < 0.
   * Шорт — Laguerre выше `LevelUp`, обе EMA растут, CCI > 0.
3. **Сеточное наращивание** — при наличии открытых ордеров того же направления текущая цена должна быть ниже минимальной цены покупки (или выше максимальной цены продажи) минимум на `GridStepPips`.
4. **Количество сделок** — суммарное число однонаправленных позиций не превышает `MaxOpenTrades`.

### Условия выхода

* **Выход по Laguerre** — длинные позиции закрываются при пересечении уровня `LevelUp`, короткие — при падении ниже `LevelDown`.
* **Стоп-лосс / тейк-профит** — задаются в пунктах и конвертируются в шаг цены с учётом инструментов с 3/5 знаками после запятой.
* **Трейлинг-стоп** — активируется после прохождения `TrailingStopPips + TrailingStepPips` и сопровождает цену на расстоянии `TrailingStopPips`.
* **Пятничная защита** — после 18:00 новые сделки не открываются, после 20:00 все позиции закрываются.

### Управление капиталом

* **Размер позиции** — фиксированный (`UseManualVolume = true`) или рассчитываемый по риску. В режиме риска объём равен `(Equity * RiskPercent) / StopLoss`.
* **Ограничение по капиталу** — новые сделки не открываются, если текущая стоимость портфеля ниже `EquityCutoff`.
* **Дневной лимит убытков** — при достижении `MaxLossesPerDay` убыточных закрытий в текущий день торговля прекращается.
* **Уменьшение лота после убытков** — каждый следующий объём делится на `DecreaseFactor^количество_убытков`, как в оригинале.

## Особенности реализации

* Используется высокоуровневый метод `SubscribeCandles().Bind(...)`, который подаёт готовые свечи и значения индикаторов прямо в обработчик.
* Из-за отсутствия штатного Laguerre RSI применён нормированный RSI; уровни подобраны в соответствии с диапазоном 0–1.
* Фильтр по наклону EMA реализован через разницу между медленной и быстрой EMA в тиках, что повторяет логику пользовательского индикатора `emaangle`.
* Стопы и трейлинг поддерживаются вручную внутри `ProcessCandle`, чтобы соответствовать поэтапной модификации ордеров в MQL.
* Учёт средних цен входа, экстремальных цен и трейлинговых уровней позволяет воспроизвести сеточное поведение при агрегированной позиции StockSharp.

## Параметры

| Параметр | Значение по умолчанию | Описание |
| -------- | --------------------- | -------- |
| `UseManualVolume` | `false` | Использовать ли фиксированный объём. |
| `ManualVolume` | `1` | Объём при ручном режиме. |
| `RiskPercent` | `5` | Доля капитала в риске для автолота. |
| `StopLossPips` | `35` | Размер стоп-лосса в пунктах. |
| `TakeProfitPips` | `10` | Размер тейк-профита в пунктах. |
| `TrailingStopPips` | `0` | Отступ трейлинг-стопа (0 — отключено). |
| `TrailingStepPips` | `5` | Минимальный ход до включения трейлинга. |
| `DecreaseFactor` | `1.6` | Коэффициент уменьшения объёма после убытка. |
| `MaxLossesPerDay` | `3` | Максимальное число убыточных закрытий за день. |
| `EquityCutoff` | `800` | Порог капитала, при котором торговля прекращается. |
| `MaxOpenTrades` | `10` | Предельное количество позиций одного направления. |
| `GridStepPips` | `30` | Минимальный шаг между усредняющими входами. |
| `LongEmaPeriod` | `120` | Период медленной EMA. |
| `ShortEmaPeriod` | `40` | Период быстрой EMA. |
| `CciPeriod` | `14` | Период CCI. |
| `AngleThreshold` | `3` | Порог расхождения EMA в тиках. |
| `LevelUp` | `0.85` | Верхний уровень Laguerre. |
| `LevelDown` | `0.15` | Нижний уровень Laguerre. |
| `CandleType` | `15m` | Таймфрейм свечей. |

## Рекомендации по использованию

1. Настройте `CandleType` под рабочий таймфрейм (в MT5 советник часто запускается на 15-минутных графиках).
2. В режиме автолота контролируйте `StopLossPips`, так как он напрямую влияет на расчёт объёма.
3. Учтите расписание торгов и часовой пояс — пятничные ограничения опираются на серверное время.
4. Включите построение графика (через `CreateChartArea`), чтобы наблюдать EMA, прокси RSI, CCI и совершённые сделки при отладке.
5. При переносе параметров из MT5 допускаются небольшие корректировки уровней Laguerre из-за использования прокси RSI.

## Файлы

* `CS/StarterV6ModStrategy.cs` — реализация стратегии.
* `README.md` — документация на английском языке.
* `README_cn.md` — документация на китайском языке.
* `README_ru.md` — документация на русском языке (этот файл).

