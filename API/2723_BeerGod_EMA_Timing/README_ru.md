# Стратегия BeerGod EMA Timing
[English](README.md) | [中文](README_cn.md)

Эта стратегия переносит эксперта BeerGodEA из MetaTrader в экосистему StockSharp. Торговля ведётся на одном инструменте по
сигналам возврата к среднему. Для фильтра направления используется экспоненциальная скользящая средняя (EMA) с периодом 60, а
сравнение ведётся с ценой закрытия предыдущей свечи. Проверка условий выполняется один раз для каждой свечи через заданное
количество минут после её открытия, что повторяет поведение оригинального советника.

Когда цена отклоняется от EMA, а сама средняя движется навстречу текущему импульсу, стратегия открывает рыночную позицию в
расчёте на возврат цены. Если в данный момент открыта позиция противоположного направления, объём новой заявки увеличивается, и
короткая позиция полностью закрывается перед открытием новой длинной (и наоборот).

## Как работает стратегия

1. Подписывается на свечи выбранного таймфрейма (по умолчанию 5 минут) и рассчитывает EMA(60) по ценам закрытия.
2. Отслеживает текущую свечу в реальном времени. При первом тике новой свечи сохраняются значение EMA и цена закрытия предыдущей
   свечи, чтобы использовать их в дальнейшем сравнении.
3. По истечении заданного числа минут от открытия свечи (по умолчанию 3) проверяются условия входа:
   - **Покупка**: текущая цена ниже EMA, EMA ниже значения предыдущей свечи (средняя снижается), а текущая цена ниже закрытия
     предыдущей свечи.
   - **Продажа**: текущая цена выше EMA, EMA выше значения предыдущей свечи (средняя растёт), а текущая цена выше закрытия
     предыдущей свечи.
4. При выполнении условий и отсутствии позиции соответствующего направления отправляется рыночная заявка. Объём автоматически
   увеличивается на величину текущей позиции, чтобы сначала закрыть противоположную позицию, а затем открыть новую в нужную
   сторону.
5. После срабатывания сигнала для свечи он помечается как обработанный, что предотвращает повторные входы до появления новой
   свечи.

## Параметры

- **Volume** – объём заявки в лотах (по умолчанию 1). При развороте позиции объём заявки увеличивается на модуль текущей
  позиции, что позволяет закрыть старую и открыть новую позицию одной сделкой.
- **EMA Length** – период EMA для фильтра направления (по умолчанию 60).
- **Trigger Minutes** – количество минут после открытия свечи, через которое выполняется проверка условий (по умолчанию 3). Если
  момент пропущен, стратегия ждёт следующую свечу.
- **Candle Type** – тип свечей, используемых для расчётов (по умолчанию пятиминутные свечи).

## Особенности торговли

- Стратегия подходит для любых инструментов, где доступны свечные данные и поток Level1. При необходимости измените длительность
  свечи, чтобы адаптироваться к часовым поясам или торговым сессиям инструмента.
- Одновременно поддерживается только одна позиция. При смене направления размер рыночной заявки автоматически корректируется для
  полного закрытия текущей позиции и открытия новой.
- Оригинальный эксперт не использует стоп-лосс и тейк-профит. При необходимости добавьте внешнее управление рисками.
- Включена защитная функция StartProtection, позволяющая StockSharp контролировать аварийное закрытие позиций при сбоях или
  ручном вмешательстве.
