# Стратегия 1H EUR/USD на MACD
[English](README.md) | [中文](README_cn.md)

Стратегия переносит советник MetaTrader "1H EUR_USD" на высокоуровневый API StockSharp. Торговля ведётся на часовом таймфрейме по EUR/USD (доступно применение к другим инструментам с обычными свечами). Входы формируются сочетанием фильтра тренда (быстрая MA выше/ниже медленной) и свингов MACD в форме двойного дна или двойной вершины, дополненных пробоем предыдущих максимумов или минимумов. Управление риском совпадает с оригиналом: стоп-лосс, тейк-профит и ступенчатый трейлинг указываются в пипсах.

## Подробности

- **Рынок**: базово EUR/USD на H1, при необходимости можно выбрать другой инструмент и тип свечей.
- **Условия входа**:
  - **Покупка**:
    - Быстрая скользящая средняя (настраиваемый тип: SMA, EMA, SMMA, LWMA) располагается выше медленной.
    - Основная линия MACD формирует один из двух вариантов бычьего свинга, полностью ниже нулевой отметки:
      - `MACD[-1] > MACD[-2] < MACD[-3]`, `MACD[-2] < 0`, цена закрытия пробивает максимум предыдущей свечи.
      - `MACD[-2] > MACD[-3] < MACD[-4]`, `MACD[-3] < 0`, цена закрытия пробивает максимум двух свечей назад.
  - **Продажа**:
    - Быстрая MA ниже медленной.
    - MACD образует зеркальные медвежьи свинги полностью выше нуля, а закрытие опускается ниже соответствующего минимума.
- **Выход из позиции**:
  - Стоп-лосс и тейк-профит в пипсах задаются сразу после открытия сделки.
  - Трейлинг-стоп активируется только после прохождения ценой расстояния `TrailingStop + TrailingStep` и затем сопровождает цену на расстоянии `TrailingStop`, повторяя логику модификаций из MQL.
  - Срабатывание защитных уровней проверяется по максимуму/минимуму свечи.
- **Управление позицией**:
  - Объём сделок задаётся параметром `TradeVolume`; при смене направления стратегия сначала закрывает противоположную позицию.
  - Расчёт пипсов автоматически учитывает точность котировки (4/5 знаков и т. п.).
- **Индикаторы**:
  - Быстрая и медленная скользящие со сменой типа и горизонтальным сдвигом.
  - Классический MACD с тремя параметрами EMA.
- **Основные параметры**:
  - `TradeVolume` — базовый объём ордера.
  - `StopLossPips`, `TakeProfitPips` — дистанции стоп-лосса и тейк-профита (0 отключает уровень).
  - `TrailingStopPips`, `TrailingStepPips` — настройки трейлинг-стопа; при включённом трейлинге шаг должен быть > 0.
  - `FastMaLength`, `FastMaShift`, `FastMaType` — параметры быстрой MA.
  - `SlowMaLength`, `SlowMaShift`, `SlowMaType` — параметры медленной MA.
  - `MacdFastLength`, `MacdSlowLength`, `MacdSignalLength` — периоды MACD.
  - `CandleType` — тип используемых свечей (по умолчанию 1 час).
  - `LookbackPeriod` — сохранённый параметр из исходного советника; как и в MQL-версии, на логику не влияет.

## Дополнительные замечания

- Трейлинг модифицируется ступенчато, строго после преодоления ценой комбинации `TrailingStop + TrailingStep`.
- Размер пипса рассчитывается из шага цены; для котировок с 3 или 5 знаками автоматически используется множитель 10.
- В исходном коде C# добавлены подробные комментарии на английском языке, что облегчает сопровождение и дальнейшую доработку.
