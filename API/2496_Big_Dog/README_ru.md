# Стратегия Big Dog — пробой утреннего диапазона

Стратегия **Big Dog** ищет узкий ценовой диапазон в утренние часы Лондона и торгует его пробой. В оригинальном советнике MQL после завершения временного окна между `StartHour` и `StopHour` выставлялись отложенные стоп-заявки. Реализация на StockSharp повторяет ту же логику: сначала формируется дневной диапазон, затем при выходе цены за его пределы отправляется рыночная заявка, а стоп и тейк-профит рассчитываются по границам диапазона.

## Логика торговли

1. В течение каждого дня собираются завершённые свечи между `StartHour` (включительно) и `StopHour` (по умолчанию не включая). По ним фиксируются максимум и минимум сессии.
2. Если высота диапазона превышает `MaxRangePoints` (значение переводится в цену через «скорректированный пункт»), сигнал игнорируется.
3. После закрытия окна стратегия проверяет, насколько текущая лучшая покупка/продажа удалена от уровней пробоя. Сценарий активируется только если расстояние не меньше `DistancePoints`.
4. Когда последующие свечи пробивают верхнюю или нижнюю границу, открывается позиция объёмом `OrderVolume`. При наличии обратной позиции она закрывается тем же ордером.
5. Для каждой сделки назначаются защитные уровни:
   - Лонг: стоп по минимуму диапазона, тейк-профит на `TakeProfitPoints` выше точки входа.
   - Шорт: стоп по максимуму диапазона, тейк-профит на `TakeProfitPoints` ниже входа.
6. По завершении каждой свечи стратегия анализирует экстремумы свечи и закрывает позицию, если были достигнуты стоп или цель.
7. С началом нового календарного дня состояние очищается, чтобы уровни предыдущих дней не влияли на расчёт.

> **Скорректированный пункт.** Значения в пунктах умножаются на `PriceStep`. Если у инструмента 3 или 5 знаков после запятой, дополнительно используется множитель 10 — аналогично тому, как это реализовано в MQL-версии.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `StartHour` | Час (0-23), с которого начинается расчёт диапазона. | `14` |
| `StopHour` | Час (0-23), на котором диапазон перестаёт обновляться. | `16` |
| `MaxRangePoints` | Максимально допустимая высота диапазона в скорректированных пунктах. | `50` |
| `TakeProfitPoints` | Расстояние до тейк-профита от цены входа в скорректированных пунктах. | `50` |
| `DistancePoints` | Минимальное удаление цены от уровней пробоя перед активацией сигнала. | `20` |
| `OrderVolume` | Объём ордера при пробое (также переносится в свойство `Volume`). | `1` |
| `CandleType` | Тип свечей для расчёта диапазона, по умолчанию часовые. | `1h` |

## Особенности реализации

- Стратегия подписывается на свечи и книгу заявок. Если глубина недоступна, для проверки дистанции используется цена закрытия последней свечи.
- Вход выполняется рыночными ордерами, что упрощает перенос логики отложенных стоп-заявок на высокоуровневый API StockSharp.
- Стоп-лосс и тейк-профит контролируются в коде: после закрытия свечи проверяются её минимум и максимум, поэтому нет необходимости регистрировать дополнительные заявки.
- При смене даты отменяются активные заявки и очищаются накопленные значения диапазона — новый день начинается «с чистого листа».

