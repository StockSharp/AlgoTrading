# Big Dog 突破策略

**Big Dog** 策略用于在伦敦早盘寻找窄幅整理区，并在价格向上或向下突破该区间时入场交易。原始的 MQL 专家顾问会在 `StartHour` 与 `StopHour` 之间形成的价格区间足够窄时挂出止损单。本移植版在 StockSharp 框架中保持同样的思路：先确认区间，再在突破时用市价单开仓，同时根据整理区的高低点计算止损与止盈。

## 交易逻辑

1. 在每天 `StartHour`（含）到 `StopHour`（默认不含）之间收集完成的 K 线，构建当天的高低区间。
2. 如果区间高度超过 `MaxRangePoints`（通过“调整点值”转换为价格单位），则忽略该交易日。
3. 区间结束后，比较最新最优买卖价与突破价之间的距离。只有当市场价格距离上沿或下沿至少有 `DistancePoints`（调整点值）时，才认为突破计划有效。
4. 之后的 K 线若向上突破上沿，则按照 `OrderVolume`（自动抵消反向持仓）开多；若向下突破下沿，则开空。
5. 入场后立即设定退出条件：
   - 多单止损放在整理区低点，止盈位于入场价上方 `TakeProfitPoints` 的距离。
   - 空单止损放在整理区高点，止盈位于入场价下方 `TakeProfitPoints` 的距离。
6. 每根完成的 K 线都会检查最高价或最低价是否触及止损 / 止盈，满足条件时立即平仓。
7. 新交易日开始时会重置所有缓存数据，避免上一日的水平影响当日决策。

> **关于调整点值**：策略会将以“点”为单位的参数乘以 `PriceStep`，若标的价格有 3 或 5 位小数，则再乘以 10，以模拟原 EA 中“1 点 = 1 个标准 pip” 的换算。

## 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `StartHour` | 计算整理区的起始小时（0-23）。 | `14` |
| `StopHour` | 计算整理区的结束小时（0-23）。 | `16` |
| `MaxRangePoints` | 整理区允许的最大高度（调整点值）。 | `50` |
| `TakeProfitPoints` | 突破后的止盈距离（调整点值）。 | `50` |
| `DistancePoints` | 触发突破前价格与区间边界的最小距离（调整点值）。 | `20` |
| `OrderVolume` | 每次突破下单的手数（同时赋值给策略 `Volume`）。 | `1` |
| `CandleType` | 用于构建整理区的 K 线类型，默认 1 小时。 | `1h` |

## 实现细节

- 策略同时订阅 K 线与盘口深度。若盘口不可用，则使用最新 K 线收盘价作为距离判断的回退值。
- 入场采用市价单，模拟原策略的挂止损单行为，但实现更贴合 StockSharp 的高层 API。
- 止损与止盈并未额外挂单，而是在 K 线完成时根据最高 / 最低价判断是否触发，以接近原 EA 设置的保护水平。
- 当日期变化时，策略会取消活动委托并重置区间信息，确保新的一天从零开始。

