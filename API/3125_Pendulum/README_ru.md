# Стратегия Pendulum
[English](README.md) | [中文](README_cn.md)

Сеточный мартингейл, который «раскачивается» между двумя ценовыми уровнями. Когда цена достигает верхней границы сетки, стратегия открывает длинную позицию, а при переходе к нижней границе разворачивается в шорт с увеличенным объёмом. Так продолжается до заданного количества слоёв: цели по прибыли расширяются, а защитные уровни сужаются в соответствии с оригинальным советником Pendulum. После фиксации прибыли сетка переносится на новую цену, и запланированный повторный вход позволяет возобновить качание маятника.

## Подробности

- **Логика входов**
  - Привязывает сетку к цене закрытия свечи на основе параметра `StepSize`.
  - **Достижение верхнего уровня** → покупка базовым объёмом.
  - **Достижение нижнего уровня** → продажа базовым объёмом.
  - При движении к противоположному уровню позиция разворачивается, абсолютный объём умножается на `Multiplier`, а цели и стопы пересчитываются так же, как в MQL-версии.
  - После прибыльного выхода создаётся отложенный повторный вход — следующая свеча открывает сделку на том же уровне, когда предыдущая позиция полностью закрыта.
- **Логика выходов**
  - Для первого слоя используется цель в один шаг, для последующих — `Multiplier` шагов.
  - Стоп-лоссы зеркалируют логику советника: на первом слое применяется широкий стоп (`StepSize * Multiplier`), на следующих — один шаг против текущего направления.
  - При достижении максимального числа слоёв стратегия ждёт срабатывания тейк-профита или стопа и только после этого перезапускает сетку.
- **Управление позицией**
  - Используется неттинг: порт в StockSharp закрывает и разворачивает суммарную позицию, а не держит встречные сделки, что делает стратегию совместимой с портфелями StockSharp.
  - Объёмы округляются до шага объёма инструмента (если он известен).
- **Данные**
  - Работает с любым инструментом и таймфреймом. По умолчанию подписывается на минутные свечи и использует цену закрытия.
- **Защита**
  - Активирована `StartProtection()` для обработки зависших позиций при сбоях или ручном вмешательстве.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `StepSize` | `0.001` | Расстояние между уровнями сетки, всегда кратное указанному шагу. |
| `Multiplier` | `2` | Множитель объёма и расширенной цели при переходе к следующему слою (должен быть > 1). |
| `MaxLayers` | `3` | Максимальное количество слоёв, после которого новые развороты не добавляются. |
| `BaseVolume` | `1` | Базовый объём первой сделки; последующие умножаются на `Multiplier`. |
| `CandleType` | `1 Minute TimeFrame` | Тип свечей для подписки, можно заменить на любой доступный таймфрейм. |

## Примечания

- Поведение советника `Pendulum.mq5` воспроизведено без хеджирующих позиций: суммарная позиция разворачивается, что эквивалентно оригинальной сетке в условиях неттинга.
- После исполнения тейк-профита стратегія планирует повторный вход на том же уровне, чтобы продолжить цикл после подтверждения закрытия.
- Рекомендуется выбирать `StepSize` кратным шагу цены инструмента, чтобы избежать чрезмерных округлений уровней сетки.
