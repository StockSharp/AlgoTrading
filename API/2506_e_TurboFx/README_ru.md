# Стратегия e-TurboFx

## Обзор
**e-TurboFx** — это контртрендовая стратегия, ищущая истощение импульса за счёт последовательности свечей с растущими телами. Оригинальная реализация работала в MetaTrader 5 и анализировала последние бары текущего таймфрейма. Порт для StockSharp использует высокоуровневый API: подписку на свечи, параметры стратегии и встроенную защиту позиции.

## Логика торговли
- Анализируются последние `DepthAnalysis` завершённых свечей выбранного типа `CandleType`.
- Подсчитывается количество подряд идущих медвежьих свечей (закрылись ниже открытия) и бычьих свечей (закрылись выше открытия).
- Для каждого направления отслеживается динамика тел: каждая следующая свеча должна иметь большее абсолютное тело, иначе серия обнуляется.
- **Вход в лонг:** как только накоплены `DepthAnalysis` медвежьих свечей с увеличивающимися телами и нет открытой позиции, выставляется рыночная покупка.
- **Вход в шорт:** аналогично, серия из `DepthAnalysis` бычьих свечей с возрастающими телами приводит к рыночной продаже при отсутствии позиции.
- Пока позиция открыта, поиск сигналов временно прекращается, что не позволяет наслаивать сделки. Управление рисками выполняется блоком `StartProtection`.

## Управление позицией
- `StartProtection` регистрирует стоп-лосс и тейк-профит, измеряемые в шагах цены (биржевых тиках). Значение `0` отключает соответствующий ордер.
- Стратегия одновременно держит только одну позицию. После закрытия сделки последовательности свечей пересчитываются заново.
- Параметр `TradeVolume` задаёт торговый объём и немедленно синхронизируется со свойством `Volume` стратегии.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `DepthAnalysis` | Количество последних свечей, используемых для проверки расширяющегося паттерна. | `3` |
| `TakeProfitSteps` | Дистанция тейк-профита в шагах цены. Значение `0` отключает тейк-профит. | `120` |
| `StopLossSteps` | Дистанция стоп-лосса в шагах цены. Значение `0` отключает стоп-лосс. | `70` |
| `TradeVolume` | Объём сделки при рыночном входе. | `0.1` |
| `CandleType` | Тип (таймфрейм) свечей, по которым ведётся расчёт. | Свечи на 1 час |

Все числовые параметры снабжены настройками оптимизации и готовы к использованию в оптимизаторе StockSharp.

## Рекомендации
- В MetaTrader 5 эксперт пересчитывал данные на каждом тике; в StockSharp эквивалентное поведение обеспечивается событиями завершения свечей и внутренними счётчиками.
- Поскольку критерий основан на размере тел, результат чувствителен к таймфрейму: на меньших интервалах сигналов больше, но требуется более плотный риск-менеджмент.
- Убедитесь, что инструмент предоставляет корректный `PriceStep`, чтобы шаги стопов и целей корректно преобразовывались в цены.
- Перед запуском на реальном счёте протестируйте стратегию в Designer или Backtester, чтобы подтвердить соответствие стопов и тейков выбранному инструменту.
