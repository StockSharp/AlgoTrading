# e-TurboFx 策略

## 概述
**e-TurboFx** 是一套寻找动量耗竭的反转策略，最初发表于 MetaTrader 5。它关注最近若干根完成的 K 线，如果同方向的 K 线实体持续放大，则认为行情可能即将反转。本移植版本基于 StockSharp 的高级 API，使用蜡烛图订阅、参数系统以及自动化的仓位保护模块。

## 交易逻辑
- 观察所选 `CandleType` 的最近 `DepthAnalysis` 根完结蜡烛。
- 统计连续收在开盘价之下的蜡烛数量（看跌）以及连续收在开盘价之上的蜡烛数量（看涨）。
- 对每个方向追踪实体大小，只要新蜡烛的绝对实体没有超过前一根蜡烛，当前序列就会被重置。
- **做多条件：** 如果出现 `DepthAnalysis` 根连续的看跌蜡烛且实体逐步增大，并且当前没有持仓，则立即市价买入。
- **做空条件：** 如果出现 `DepthAnalysis` 根连续的看涨蜡烛且实体逐步增大，并且当前没有持仓，则立即市价卖出。
- 当策略持有仓位时不会继续寻找新的信号，从而避免叠加交易；风险控制由 `StartProtection` 统一处理。

## 仓位管理
- `StartProtection` 会按照价格步长（交易所最小跳动）注册止损和止盈。参数为 `0` 表示关闭对应的保护单。
- 策略同一时间只允许存在一笔仓位。平仓之后，内部计数器会重新建立新的序列。
- `TradeVolume` 决定每次市价单的下单数量，修改参数会立即同步到策略的 `Volume` 属性。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `DepthAnalysis` | 需要连续满足条件的完成蜡烛数量。数值越大，触发信号所需的序列越长。 | `3` |
| `TakeProfitSteps` | 止盈距离（以价格步长计）。`0` 表示不设置止盈。 | `120` |
| `StopLossSteps` | 止损距离（以价格步长计）。`0` 表示不设置止损。 | `70` |
| `TradeVolume` | 每次市价单的交易量。 | `0.1` |
| `CandleType` | 用于分析的蜡烛数据类型/时间框架。 | 1 小时蜡烛 |

所有数值参数都包含优化设置，可直接用于 StockSharp 的参数优化流程。

## 使用建议
- 原始 MT5 EA 在每个行情跳动时重新读取历史数据；本实现通过已完成的蜡烛事件和内部状态，实现等效的行为。
- 策略对时间框架较为敏感：较短的周期提供更多信号，但对止损/止盈要求也更紧。
- 请确认交易标的提供有效的 `PriceStep`，以便价格步长正确映射到真实价格。
- 上线实盘之前，建议先在 Designer 或 Backtester 中验证止损/止盈与品种的匹配度。
