# Стратегия Yesterday Today
[English](README.md) | [中文](README_cn.md)

Стратегия Yesterday Today повторяет классическую идею MetaTrader: текущая цена сравнивается с диапазоном предыдущего дня. Алгоритм отслеживает последнюю завершённую дневную свечу и мониторит внутридневные свечи, чтобы оперативно реагировать на выход цены за пределы диапазона. Перед открытием позиции в противоположную сторону стратегия полностью закрывает существующее направление, поэтому одновременно активна только одна позиция.

## Описание

- Хранит максимум и минимум последней завершённой дневной свечи и ждёт пробоя этого диапазона.
- Открывает длинную позицию, когда цена закрытия внутридневной свечи выше вчерашнего максимума; короткую — когда закрытие ниже вчерашнего минимума.
- Использует фиксированные уровни стоп-лосса и тейк-профита в пунктах. Размер пункта автоматически корректируется для инструментов с 3 или 5 знаками после запятой по аналогии с исходным советником.
- На каждой завершённой внутридневной свече проверяет, не были ли достигнуты уровни стопа или тейка (по максимуму/минимуму свечи).
- Включает защитный механизм `StartProtection`, чтобы снизить риски технических проблем с маржой.

## Алгоритм работы

1. Подписывается на дневные свечи и сохраняет максимум/минимум последней завершённой сессии.
2. Подписывается на внутридневные свечи (по умолчанию 15 минут) для поиска сигналов.
3. Для каждой завершённой внутридневной свечи:
   - Сначала проверяет, не сработали ли стоп-лосс или тейк-профит.
   - Если закрытие выше вчерашнего максимума и нет длинной позиции — открывает покупку.
   - Если закрытие ниже вчерашнего минимума и нет короткой позиции — открывает продажу.
   - При развороте увеличивает объём заявки, чтобы закрыть противоположную позицию и сразу открыть новую.
4. После завершения очередной дневной свечи обновляет диапазон, с которым будет сравниваться цена на следующий день.

## Параметры

- `TradeVolume` — объём новой позиции. При развороте автоматически добавляется объём противоположной позиции для её закрытия.
- `StopLossPips` — расстояние от цены входа до стоп-лосса в пунктах. Значение `0` отключает стоп.
- `TakeProfitPips` — расстояние до тейк-профита в пунктах. Значение `0` отключает тейк.
- `SignalCandleType` — тип внутридневных свечей, которые используются для поиска пробоя (по умолчанию 15 минут).

## Детали

- **Условие входа**: закрытие внутридневной свечи выше вчерашнего максимума (лонг) или ниже вчерашнего минимума (шорт).
- **Направление**: обе стороны.
- **Выход**: фиксация по стоп-лоссу или тейк-профиту, когда диапазон свечи затрагивает соответствующий уровень.
- **Стопы**: да, фиксированные расстояния в пунктах.
- **Значения по умолчанию**:
  - `TradeVolume` = 1
  - `StopLossPips` = 50
  - `TakeProfitPips` = 50
  - `SignalCandleType` = `TimeSpan.FromMinutes(15).TimeFrame()`
- **Фильтры**:
  - Категория: Пробой
  - Направление: Обе стороны
  - Индикаторы: Price Action
  - Стопы: Да
  - Сложность: Базовая
  - Таймфрейм: Внутридневный вход, дневной контекст
  - Сезонность: Нет
  - Нейросети: Нет
  - Дивергенция: Нет
  - Уровень риска: Средний

## Дополнительно

- Стратегия рассчитана на работу с одним инструментом. Перед запуском назначьте `Security` и `Portfolio`.
- Размер пункта вычисляется на основе `Security.PriceStep` и корректируется для 3- и 5-знаковых котировок, что позволяет повторить поведение оригинального MQL-советника.
- В `OnStarted` включается защита `StartProtection`, поэтому глобальные ограничения по счёту остаются активными во время торговли.
