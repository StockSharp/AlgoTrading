# Get Trend 策略

## 概述

该策略是 MetaTrader 顾问 **Get trend** 的 StockSharp 版本。核心思想是在 15 分钟图上寻找顺势回调入场，并通过 1 小时图的趋势确认过滤逆势交易。策略同时运用平滑移动平均线与随机指标来确定入场时机。

## 交易逻辑

- **主图周期：** 15 分钟蜡烛负责生成信号并提交订单。
- **确认周期：** 1 小时蜡烛提供平滑移动平均线与收盘价，用于判断更高周期的趋势方向。
- **趋势过滤：** M15 与 H1 的收盘价必须位于各自平滑均线的同一侧；同时 M15 收盘价与均线的距离需小于允许阈值，确保是在回调区域进场。
- **动量触发：** 多头信号要求随机指标 %K 线在超卖区（<20）向上穿越 %D 线；空头信号则要求在超买区（>80）向下穿越。
- **仓位管理：** 入场后设置固定点数的止损与止盈，且可选的移动止损在盈利达到指定距离时逐步跟随价格。

## 入场条件

### 做多
1. M15 收盘价低于其平滑均线。
2. H1 收盘价低于其平滑均线。
3. M15 收盘价与均线的差值不超过 **Price Threshold**（点数）。
4. 随机指标 %K 与 %D 均小于 20。
5. 上一根 %K 低于 %D，当前 %K 上穿 %D。
6. 当前没有多头仓位（若持有空头则先平仓再反向开多）。

### 做空
1. M15 收盘价高于其平滑均线。
2. H1 收盘价高于其平滑均线。
3. M15 收盘价与均线的差值不超过 **Price Threshold**。
4. 随机指标 %K 与 %D 均大于 80。
5. 上一根 %K 高于 %D，当前 %K 下穿 %D。
6. 当前没有空头仓位（若持有多头则先平仓再反向开空）。

## 离场规则

- **止损：** 按点数设定的固定距离，基于入场价格计算。
- **止盈：** 按点数设定的固定距离，基于入场价格计算。
- **移动止损：** 当浮盈超过设定距离时启动，随后按设定偏移紧跟价格移动。

## 参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `M15CandleType` | 主图信号使用的蜡烛类型。 | 15 分钟 |
| `H1CandleType` | 趋势确认使用的蜡烛类型。 | 1 小时 |
| `MaM15Length` | M15 平滑移动平均周期。 | 99 |
| `MaH1Length` | H1 平滑移动平均周期。 | 184 |
| `StochasticLength` | 随机指标 %K 周期。 | 27 |
| `StochasticSignalLength` | 随机指标 %D 平滑周期。 | 3 |
| `ThresholdPoints` | 允许价格偏离均线的最大点数。 | 10 |
| `TakeProfitPoints` | 止盈距离（点数）。 | 540 |
| `StopLossPoints` | 止损距离（点数）。 | 90 |
| `TrailingStopPoints` | 移动止损距离（点数）。 | 20 |
| `TradeVolume` | 开仓的基础手数/数量。 | 0.1 |

所有以点数表示的参数都会乘以品种的 `PriceStep`，转换为绝对价格差值。

## 实现细节

- 使用 StockSharp 高层 API，通过 `BindEx` 将蜡烛订阅与指标连接，避免手动复制指标缓冲区。
- 移动止损逻辑与原始 EA 保持一致：当盈利超出阈值后不断将止损向有利方向推进。
- 反向开仓前先取消未完成订单，防止出现相反方向的挂单冲突。
- 图表展示 M15 蜡烛与平滑均线，并提供单独的随机指标面板，方便回测和监控。

## 使用建议

- 根据数据源调整蜡烛类型（若数据源支持其它周期或成交量蜡烛，可替换为对应的 `DataType`）。
- 不同市场的波动和最小跳动价差不同，请根据实际情况调节阈值、止损和止盈。
- 策略更适合趋势明显且存在均线回踩机会的交易品种。
