# Стратегия Get Trend

## Обзор

Стратегия является портом советника MetaTrader **Get trend** на платформу StockSharp. Алгоритм работает на 15-минутных свечах, а подтверждение тренда берёт с часового таймфрейма. Для поиска точек входа используется сочетание сглаженных скользящих средних и стохастического осциллятора.

## Логика торговли

- **Рабочий таймфрейм:** 15-минутные свечи отвечают за генерацию сигналов и исполнение сделок.
- **Подтверждающий таймфрейм:** Часовые свечи предоставляют сглаженную среднюю и цену закрытия, которые задают направление тренда.
- **Фильтр тренда:** Цена закрытия на обоих таймфреймах должна находиться по одну сторону от соответствующих сглаженных средних. Дополнительно цена на M15 должна подходить к средней ближе указанного порога, чтобы вход осуществлялся от отката.
- **Импульсный триггер:** Для покупок требуется пересечение %K вверх через %D в зоне перепроданности (ниже 20). Для продаж — зеркальное условие в зоне перекупленности (выше 80).
- **Управление позицией:** Стоп-лосс и тейк-профит задаются в пунктах от цены входа. Опциональный трейлинг-стоп подтягивается вслед за ценой при достаточном движении в прибыль.

## Условия входа

### Покупка
1. Закрытие свечи M15 ниже своей сглаженной средней.
2. Закрытие свечи H1 ниже своей сглаженной средней.
3. Расстояние между ценой закрытия M15 и её средней не превышает параметр **Price Threshold**.
4. Стохастические линии %K и %D находятся ниже 20.
5. Предыдущее значение %K было ниже %D, а текущее пересекает %D сверху.
6. Нет открытой длинной позиции (при наличии шорта он закрывается и позиция разворачивается).

### Продажа
1. Закрытие свечи M15 выше своей сглаженной средней.
2. Закрытие свечи H1 выше своей сглаженной средней.
3. Расстояние между ценой закрытия M15 и её средней не превышает **Price Threshold**.
4. Стохастические линии %K и %D находятся выше 80.
5. Предыдущее значение %K было выше %D, а текущее пересекает %D снизу.
6. Нет открытой короткой позиции (при наличии лонга он закрывается и позиция разворачивается).

## Выход из позиции

- **Стоп-лосс:** Фиксированное расстояние в пунктах от цены входа.
- **Тейк-профит:** Фиксированное расстояние в пунктах от цены входа.
- **Трейлинг-стоп:** При достижении заданного профита стоп подтягивается к цене, сохраняя заданный отступ.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `M15CandleType` | Тип свечей для основного расчёта. | 15 минут |
| `H1CandleType` | Тип свечей для подтверждения тренда. | 1 час |
| `MaM15Length` | Период сглаженной средней на M15. | 99 |
| `MaH1Length` | Период сглаженной средней на H1. | 184 |
| `StochasticLength` | Период %K стохастика. | 27 |
| `StochasticSignalLength` | Период сглаживания %D. | 3 |
| `ThresholdPoints` | Допустимое отклонение цены от средней (в пунктах). | 10 |
| `TakeProfitPoints` | Дистанция тейк-профита (в пунктах). | 540 |
| `StopLossPoints` | Дистанция стоп-лосса (в пунктах). | 90 |
| `TrailingStopPoints` | Дистанция трейлинг-стопа (в пунктах). | 20 |
| `TradeVolume` | Базовый объём заявки. | 0.1 |

Все значения в пунктах пересчитываются в абсолютное изменение цены через `PriceStep` инструмента.

## Особенности реализации

- Используется высокоуровневый API StockSharp: подписка на свечи и связывание индикаторов через `BindEx`, что избавляет от ручной работы с буферами.
- Логика трейлинг-стопа повторяет оригинал: активируется при накоплении прибыли и постепенно подтягивает уровень стопа.
- Перед разворотом позиции активные заявки снимаются, чтобы избежать конфликтов на бирже.
- На графике отображаются 15-минутные свечи со сглаженной средней и отдельная панель со стохастическим осциллятором.

## Рекомендации по использованию

- Подбирайте подходящий тип свечей в зависимости от поставщика данных (возможна замена на объёмные или другие типы при наличии соответствующего `DataType`).
- Настраивайте порог, стопы и тейк-профит под волатильность конкретного инструмента и размер тика.
- Стратегия лучше всего работает на трендовых инструментах с регулярными откатами к скользящей средней.
