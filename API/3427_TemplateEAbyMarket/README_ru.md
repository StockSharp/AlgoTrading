# Стратегия TemplateEAbyMarket

## Обзор
TemplateEAbyMarket — это прямая портированная версия советника MetaTrader 4 *TemplateEAbyMarket.mq4* на платформу StockSharp. Стратегия использует индикатор MACD для отслеживания сдвигов импульса. Когда основная линия MACD пересекает сигнальную линию при условии, что обе находятся в одной положительной или отрицательной зоне, открывается рыночная позиция в направлении пересечения. Выход из сделки осуществляется исключительно через защитные уровни (тейк-профит и стоп-лосс), которые настраиваются с помощью `StartProtection`.

Поведение полностью повторяет оригинальный MQL-алгоритм: стратегия только открывает позиции и не пытается автоматически закрывать противоположную сторону. После открытия сделка ведётся защитными уровнями или вручную.

## Торговая логика
1. Выполняется подписка на выбранный пользователем тип свечей (по умолчанию — 15-минутный таймфрейм).
2. На каждой завершённой свече рассчитывается MACD с параметрами 12/26/9 (по умолчанию).
3. Отслеживается относительное положение основной и сигнальной линий MACD для фиксации события пересечения:
   - **Бычий сценарий:** на предыдущей свече основная линия была ниже сигнальной, текущая свеча закрылась выше, и обе линии находятся выше нулевого уровня. Отправляется рыночная заявка на покупку объёмом `OrderVolume`, если текущая экспозиция меньше `MaxOrders * OrderVolume`.
   - **Медвежий сценарий:** на предыдущей свече основная линия была выше сигнальной, текущая свеча закрылась ниже, и обе линии находятся ниже нулевого уровня. Отправляется рыночная заявка на продажу с тем же ограничением по экспозиции.
4. Защитные уровни `takeProfit` и `stopLoss` активируются один раз при запуске. Автоматического переворота позиции нет — риск контролируется модулем защиты или пользователем.

## Параметры
| Имя | Описание |
|-----|----------|
| `MacdFastPeriod` | Период быстрой EMA в расчёте MACD. |
| `MacdSlowPeriod` | Период медленной EMA в расчёте MACD. |
| `MacdSignalPeriod` | Период сигнальной EMA MACD. |
| `CandleType` | Тип свечей (таймфрейм), используемый в расчётах. |
| `OrderVolume` | Объём каждой рыночной заявки. |
| `MaxOrders` | Максимальное количество одновременных заявок в кратных `OrderVolume`. Перед новой заявкой проверяется условие `abs(Position) < MaxOrders * OrderVolume`. |
| `TakeProfitPoints` | Дистанция тейк-профита в ценовых пунктах. Значение `0` отключает тейк-профит. |
| `StopLossPoints` | Дистанция стоп-лосса в ценовых пунктах. Значение `0` отключает стоп-лосс. |

## Примечания
- Параметры проскальзывания и magic number из MQL-версии опущены, поскольку в StockSharp они реализуются иначе.
- Убедитесь, что коннектор возвращает корректные параметры шага цены; `StartProtection` интерпретирует дистанции в ценовых пунктах инструмента.
- Стратегия намеренно оставлена минималистичной и не обрабатывает частичные исполнения либо наращивание позиции сверх лимита `MaxOrders`.
