# Стратегия WE TRUST Channel

## Обзор
**WE TRUST Channel** — порт MetaTrader 5 советника «WE TRUST» на высокоуровневый API StockSharp. Стратегия торгует возврат цены к линейной взвешенной скользящей средней, вокруг которой построены полосы стандартного отклонения. Когда цена закрытия выходит за пределы канала, система ожидает возврат к среднему и открывает позицию в противоположную сторону. Поддерживаются инверсия сигналов, принудительное закрытие встречных позиций и управление рисками в пипсах — так же, как в оригинальном советнике.

## Логика торговли
1. Подписываемся на выбранный тип свечей (по умолчанию часовые) и рассчитываем два индикатора по заданной цене свечи:
   - Линейно-взвешенную скользящую среднюю (LWMA) с настраиваемым периодом и сдвигом.
   - Индикатор стандартного отклонения со своим периодом и сдвигом для построения канала.
2. Переводим все значения в пипсах в абсолютные ценовые расстояния с помощью `PriceStep` инструмента. Для пяти- и трёхзнаковых котировок шаг цены умножается на 10, что повторяет определение пипса в MetaTrader.
3. Формируем границы канала: `LWMA ± StdDev ± ChannelIndentPips` (в ценовых единицах).
4. Обрабатываем только завершённые свечи. Если выбранная цена закрытия опускается ниже нижней границы, формируется **покупка**; если выше верхней — **продажа**.
5. При включённом **ReverseSignals** направление сигналов меняется на противоположное. Параметр **CloseOpposite** позволяет закрывать встречную позицию перед открытием новой сделки.
6. Рыночные заявки отправляются только тогда, когда текущая позиция отсутствует или совпадает по направлению с сигналом.

## Управление рисками
- **StopLossPips** и **TakeProfitPips** конвертируются в абсолютные расстояния и передаются в `StartProtection`. Значение `0` отключает соответствующий уровень.
- **TrailingStopPips** и **TrailingStepPips** задают пипсовый трейлинг-стоп, который сопровождает прибыльные позиции. Расчёт выполняется с использованием той же величины пипса.
- Все выходы осуществляются рыночными заявками для максимального соответствия MQL5-реализации.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `OrderVolume` | Объём каждой рыночной заявки. | `0.1` |
| `StopLossPips` | Дистанция стоп-лосса в пипсах (0 отключает стоп). | `40` |
| `TakeProfitPips` | Дистанция тейк-профита в пипсах (0 отключает цель). | `60` |
| `TrailingStopPips` | Размер трейлинг-стопа в пипсах. | `10` |
| `TrailingStepPips` | Шаг между перестановками трейлинг-стопа. | `10` |
| `MaPeriod` | Период линейно-взвешенной скользящей средней. | `60` |
| `MaShift` | Количество баров сдвига средней. | `0` |
| `StdDevPeriod` | Период расчёта стандартного отклонения. | `50` |
| `StdDevShift` | Сдвиг значения стандартного отклонения. | `0` |
| `SignalBarOffset` | Сколько завершённых баров отступать назад при анализе. | `1` |
| `ChannelIndentPips` | Дополнительный буфер за пределами полос. | `1` |
| `ReverseSignals` | Инвертировать направления сигналов. | `false` |
| `CloseOpposite` | Закрывать встречную позицию перед входом. | `false` |
| `AppliedPrice` | Тип цены свечи, подаваемый в индикаторы. | `Weighted` |
| `CandleType` | Тип свечей, запрашиваемый у коннектора. | Таймфрейм `1 час` |

## Примечания
- Стратегия использует `PriceStep` инструмента. При отсутствии значения выполняется поэтапный откат к `Security.Step`, затем к `1`.
- В каталоге присутствует только реализация на C#. Python-версия намеренно не создаётся согласно задаче.
- Обработка ведётся исключительно по завершённым свечам; частичные бары не аккумулируются.
