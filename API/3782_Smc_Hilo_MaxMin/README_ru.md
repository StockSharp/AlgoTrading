# SMC Hilo MaxMin — стратегия пробоя диапазона

## Общее описание
Стратегия повторяет логику советника MetaTrader *SMC MaxMin at 1200*. В заранее заданный час терминала (`SetHour`) она ставит
отложенный ордер Buy Stop выше максимума предыдущей свечи и Sell Stop ниже минимума. Уровни автоматически смещаются на минимальную
дистанцию, требуемую брокером, — значение задаётся в пунктах и переводится в цену через `Security.PriceStep`. После срабатывания
одного из стопов противоположный ордер отменяется, а позиция сопровождается фиксированным стоп-лоссом, тейк-профитом и, при
необходимости, трейлинг-стопом.

Основные отличия от исходного MQL4-скрипта:

- Вместо прямых вызовов `OrderSend` используются высокоуровневые методы StockSharp (`BuyStop`, `SellStop`, `BuyLimit`,
  `SellLimit`).
- Все расстояния задаются в пунктах и приводятся к ценам по реальному шагу котировки (`Security.PriceStep`).
- Трейлинг-стоп подтягивается только после достижения прибыли, превышающей заданный буфер, что предотвращает лишние отмены.
- Работа ведётся через подписку на свечи, без ручного перебора истории и без собственных массивов значений.

## Правила торговли
1. **Час запуска** — когда серверное время по часам равно `SetHour`, берётся предыдущая завершённая свеча.
2. **Вход в лонг** — Buy Stop выставляется на `high предыдущей свечи + минимальная дистанция + шаг цены`.
3. **Вход в шорт** — Sell Stop ставится на `low предыдущей свечи - минимальная дистанция - шаг цены`.
4. **Взаимоисключение** — после исполнения одного ордера противоположный немедленно отменяется.
5. **Стоп-лосс** — для лонга уровень `low предыдущей свечи - StopLossPips`, для шорта `high + StopLossPips` (после перевода в цену).
6. **Тейк-профит** — лонг закрывается Sell Limit по `entry + TakeProfitPips`, шорт — Buy Limit по `entry - TakeProfitPips`.
7. **Трейлинг-стоп** — при прибыли больше `TrailingStopPips` стоп сдвигается, сохраняя ту же дистанцию от актуального bid/ask.
8. **Отмена через 2 часа** — если до `SetHour + 2` стопы не активировались, они снимаются.

## Параметры
| Имя | Назначение | Значение по умолчанию |
| --- | ---------- | --------------------- |
| `Volume` | Объём сделок для входных ордеров. | `0.1` |
| `SetHour` | Час терминала (0–23), когда строится конструкция пробоя. | `15` |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах; `0` отключает тейк. | `500` |
| `StopLossPips` | Дистанция стоп-лосса в пунктах; `0` отключает стартовый стоп. | `30` |
| `TrailingStopPips` | Размер трейлинг-стопа в пунктах; `0` — без трейлинга. | `30` |
| `MinStopDistancePips` | Минимальная дистанция до стопов от брокера. | `0` |
| `CandleType` | Тип свечей для расчёта, по умолчанию часовые. | `1h` |

## Рекомендации по применению
- Нужны данные уровня 1, чтобы получать текущие bid/ask для трейлинг-стопа и корректных расчётов дистанций.
- Для инструментов с нестандартным шагом цены (например, кроссы JPY) корректируйте значения `TakeProfitPips`, `StopLossPips` и
  `TrailingStopPips`.
- Если стоп или тейк отключены (значение `0`), соответствующий ордер не выставляется, но трейлинг при включении всё равно будет
  работать.
- Убедитесь, что час `SetHour` соответствует часовому поясу торгового сервера, иначе конструкция может быть построена не в то
  время.
