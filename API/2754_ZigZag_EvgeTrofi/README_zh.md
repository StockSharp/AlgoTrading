# ZigZag EvgeTrofi 策略
[English](README.md) | [Русский](README_ru.md)

ZigZag EvgeTrofi 策略是将经典的 MetaTrader 专家顾问移植到 StockSharp 高级 API 的版本。它追踪 ZigZag 逻辑识别的最近一个摆动点，并在信号仍然有效的时间窗口内迅速执行交易。

## 策略思路

* 原始顾问会检查 ZigZag 缓冲区中最新的非零点，以判断最后一个摆动是高点还是低点。
* 默认情况下，高点会触发做多。启用 **SignalReverse** 后，方向会被反转。
* 只有在新摆动仍然“新鲜”时才允许开仓，参数 **Urgency** 限制了从摆动出现后可以进场的最大 K 线数量。
* 在发送新的订单之前，会先平掉反方向的持仓；在有效窗口内，策略可以在同一方向上逐步加仓。

该移植保持了原策略的反趋势特性：新高触发多单，新低触发空单。

## 运作流程

1. `Highest` 与 `Lowest` 指标模拟 ZigZag 的深度参数，在最近 `Depth` 根 K 线内跟踪极值。
2. 当价格突破这些极值且幅度超过 **Deviation**（按价格步长折算）时，就确认新的摆动点。
3. 策略记录自摆动出现以来经过的 K 线数量，超过 **Urgency** 后信号失效。
4. 只要仍在时间窗口内，每根收盘的 K 线都会按 `VolumePerTrade` 的数量开仓；先平掉反向仓位，保证顺利翻仓。

## 参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `Depth` | 17 | 查找摆动高/低点的窗口长度，对应 ZigZag 的深度。 |
| `Deviation` | 7 | 确认新摆动所需的最小价格变动，以价格步长为单位。 |
| `Backstep` | 5 | 在允许切换到反向摆动之前必须经过的最小 K 线数。 |
| `Urgency` | 2 | 摆动出现后允许进场的最大 K 线数。 |
| `SignalReverse` | `false` | 翻转高/低点对应的做多和做空信号。 |
| `CandleType` | 5 分钟 K 线 | 用于分析的时间框架，可根据需求调整。 |
| `VolumePerTrade` | 0.10 | 每次进场的下单数量，对应原策略的 Lot。 |

## 交易提示

* 策略本身不包含止损或止盈，需要结合账户或其他模块进行风险控制。
* 在 `Urgency` 窗口内每根 K 线都可能加仓，趋势行情中仓位会迅速扩大。
* 对于波动较大的标的，建议提高 `Depth` 以减少噪音；若希望更灵敏，则可以降低该值。
* 启用 **SignalReverse** 后，策略变为突破跟随：高点做空，低点做多。

## 文件

* `CS/ZigZagEvgeTrofiStrategy.cs` – 策略的 C# 实现。
* 暂未提供 Python 版本。
