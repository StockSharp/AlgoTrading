# Стратегия ZigZag EvgeTrofi
[English](README.md) | [中文](README_zh.md)

Стратегия ZigZag EvgeTrofi представляет собой перенос оригинального советника MetaTrader на высокоуровневый API StockSharp. Она отслеживает последний пивот, найденный по логике ZigZag, и стремится открыть позицию, пока сигнал остаётся актуальным.

## Идея

* Исходный советник анализирует первый ненулевой элемент буфера ZigZag и определяет, был ли последний подтверждённый экстремум максимумом или минимумом.
* Максимум порождает длинный вход по умолчанию. Параметр **SignalReverse** инвертирует направление сделок.
* Сделки разрешены только пока новый пивот считается «свежим». Параметр **Urgency** ограничивает число баров после пивота, когда допускается открытие позиции.
* Противоположные позиции закрываются немедленно перед постановкой новых заявок. В течение окна актуальности возможно наращивание позиции в том же направлении.

Таким образом перенос сохраняет контртрендовую природу оригинала: новые максимумы дают лонги, свежие минимумы — шорты.

## Как работает

1. Два скользящих индикатора (`Highest` и `Lowest`) имитируют выборку ZigZag с глубиной `Depth`.
2. Когда цена формирует новый экстремум выше/ниже этих уровней и движение превышает **Deviation** (в шагах цены), фиксируется новый пивот.
3. Алгоритм считает число баров, прошедших с момента пивота. После превышения **Urgency** сигнал истекает.
4. На каждом закрытом баре в пределах окна стратегия входит объёмом `VolumePerTrade`. Сначала закрываются обратные позиции, поэтому перевороты происходят корректно.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `Depth` | 17 | Количество баров для поиска экстремумов, аналог глубины ZigZag. |
| `Deviation` | 7 | Минимальный сдвиг цены в шагах цены, необходимый для подтверждения нового пивота. |
| `Backstep` | 5 | Минимальное число баров, которое должно пройти перед сменой направления пивота. |
| `Urgency` | 2 | Максимальное количество баров после пивота, когда допускаются входы. |
| `SignalReverse` | `false` | Инвертирует соответствие максимумов/минимумов и длинных/коротких сигналов. |
| `CandleType` | 5-минутные свечи | Таймфрейм анализа, подберите под используемый график. |
| `VolumePerTrade` | 0.10 | Объём заявки при каждом входе, совпадает с параметром Lot оригинала. |

## Особенности торговли

* Логика не содержит стопов или тейк-профитов — управление риском необходимо добавлять отдельно.
* Стратегия может наращивать позицию на каждом баре в окне `Urgency`, поэтому размер позиции быстро растёт при сильных движениях.
* Для волатильных инструментов увеличивайте `Depth`, чтобы отфильтровать шум, и уменьшайте для более агрессивной торговли.
* При включённом **SignalReverse** стратегия становится пробойной: максимумы открывают шорт, минимумы — лонг.

## Файлы

* `CS/ZigZagEvgeTrofiStrategy.cs` — реализация стратегии на C#.
* Версия на Python сознательно не предоставляется.
