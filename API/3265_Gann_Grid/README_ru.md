# Стратегия Gann Grid

Стратегия переносит оригинального эксперта **Gann Grid** из `MQL/25065/Gann Grid.mq4` на высокоуровневый API StockSharp. В исходном коде использовались вручную нарисованные объекты и фильтры на разных таймфреймах; версия на C# повторяет логику, заменяя графические конструкции вычислениями на индикаторах, что позволяет запускать стратегию полностью автоматически.

## Логика работы

1. **Синтетическая сетка Gann** — максимумы и минимумы за `AnchorPeriod` свечей заменяют уровни, которые трейдер рисовал в MetaTrader. Пробой максимума открывает покупки, пробой минимума — продажи.
2. **Подтверждение тренда** — быстрые и медленные линейно-взвешенные средние на старшем таймфрейме (`TrendCandleType`) должны соответствовать направлению пробоя.
3. **Фильтр импульса** — модуль процента между значением индикатора Momentum и текущей ценой (также на старшем таймфрейме) должен быть выше `MomentumThreshold`, чтобы вход происходил при достаточном ускорении.
4. **MACD-фильтр** — отдельный поток свечей (`MacdCandleType`) рассчитывает MACD (12/26/9 по умолчанию). Линия MACD должна находиться по ту же сторону от нуля и сигнальной линии, что и направление сделки.
5. **Управление рисками** — стоп-лосс и тейк-профит задаются как симметричные смещения от цены входа. Опциональные блоки перевода в безубыток и трейлинг-стоп повторяют защиту капитала из MQL-версии.

Обрабатываются только завершённые свечи, что соответствует проверке «нового бара» в оригинале.

## Отличия от реализации в MQL

- В MetaTrader требовалось вручную нарисовать объект `GANNGRID`. В портированной версии его заменяют индикаторы Highest/Lowest, что делает стратегию детерминированной для тестов.
- Momentum в MetaTrader колеблется вокруг 100. В StockSharp индикатор возвращает ценовую разницу, поэтому значение преобразуется в процент от текущей цены перед сравнением с `MomentumThreshold`.
- Почтовые и push-уведомления, а также графические операции исключены.
- Управление позициями ведётся рыночными заявками, без модификации открытых ордеров, поскольку StockSharp работает на уровне позиции.

## Параметры

| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `CandleType` | `DataType` | 5-минутные свечи | Основной поток свечей, по которому ищется пробой. |
| `TrendCandleType` | `DataType` | 15-минутные свечи | Старший таймфрейм для LWMA и Momentum. |
| `MacdCandleType` | `DataType` | Дневные свечи | Поток свечей для расчёта MACD. |
| `FastMaPeriod` | `int` | 6 | Период быстрой LWMA на старшем таймфрейме. |
| `SlowMaPeriod` | `int` | 85 | Период медленной LWMA на старшем таймфрейме. |
| `MomentumPeriod` | `int` | 14 | Период индикатора Momentum. |
| `MomentumThreshold` | `decimal` | 0.3 | Минимальное процентное отклонение Momentum от нуля для входа. |
| `AnchorPeriod` | `int` | 100 | Количество свечей для построения синтетической сетки. |
| `TakeProfitOffset` | `decimal` | 0.005 | Абсолютное расстояние до тейк-профита. |
| `StopLossOffset` | `decimal` | 0.002 | Абсолютное расстояние до стоп-лосса. |
| `EnableTrailing` | `bool` | `true` | Включает трейлинг-стоп. |
| `TrailingActivation` | `decimal` | 0.003 | Прибыль, после которой активируется трейлинг. |
| `TrailingStep` | `decimal` | 0.0015 | Расстояние между локальным максимумом и трейлинг-стопом. |
| `EnableBreakEven` | `bool` | `true` | Включает перевод позиции в безубыток. |
| `BreakEvenTrigger` | `decimal` | 0.0025 | Прибыль, необходимая для активации безубытка. |
| `BreakEvenOffset` | `decimal` | 0.0 | Смещение относительно цены входа при выходе в безубыток. |
| `MacdFastPeriod` | `int` | 12 | Период быстрой EMA внутри MACD. |
| `MacdSlowPeriod` | `int` | 26 | Период медленной EMA внутри MACD. |
| `MacdSignalPeriod` | `int` | 9 | Период сигнальной EMA внутри MACD. |

Все смещения задаются в абсолютных ценовых величинах. Подбирайте их в соответствии с шагом цены инструмента (например, 0.001 ≈ 10 пунктов для пятизнака).

## Рекомендации по использованию

1. Привяжите стратегию к нужному инструменту и настройте таймфреймы свечей. При желании можно использовать один и тот же таймфрейм для всех фильтров.
2. Подберите `AnchorPeriod` и ценовые смещения под волатильность рынка.
3. Включите или отключите блоки безубытка и трейлинга в зависимости от политики управления риском.
4. Запустите стратегию — она сама оформит подписки на свечи и будет управлять позициями рыночными заявками.

## Состав папки

- `CS/GannGridStrategy.cs` — код стратегии.
- `README.md` — документация на английском языке.
- `README_ru.md` — данное описание на русском языке.
- `README_cn.md` — перевод на китайский язык.
