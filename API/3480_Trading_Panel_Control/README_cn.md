# Trading Panel 控制策略

## 概述

**Trading Panel Strategy** 在 StockSharp 中复刻了 MetaTrader 4 平台的 "Trading Panel" 辅助面板。原始 MQL 程序通过按钮切换图表周期和交易品种，而此移植版本把这些操作抽象成策略参数，可由 Designer、终端或自定义界面在运行时调整。

策略本身不会下单，其职责是根据选择的周期和品种管理蜡烛订阅，并记录最新完成蜡烛的收盘信息，为操作者提供与原面板相同的反馈。

## 主要功能

- **周期切换**：支持 M1、M5、M15、M30、H1、H4、D1、W1。修改参数后会立即重新订阅对应的蜡烛。
- **品种查找**：可以填写目标证券的标识符。启用 `AutoLookupSecurity` 时通过 `SecurityProvider` 自动解析，否则使用策略已绑定的 `Security`。
- **蜡烛日志**：每根完成的蜡烛都会写入日志，包含证券 ID、当前周期和收盘价，用来替代原面板的文本标签。

## 参数

| 参数 | 说明 |
|------|------|
| `TimeFrameName` | 周期代码（`M1`、`M5`、`M15`、`M30`、`H1`、`H4`、`D1`、`W1`），默认 `M15`。 |
| `SecurityId` | 要跟踪的证券标识，可留空以沿用策略当前的 `Security`。 |
| `AutoLookupSecurity` | 为 `true` 时通过 `SecurityProvider` 自动查找证券。 |
| `DefaultCandleType` | 当输入未知周期时使用的备用 `DataType`，默认是一分钟蜡烛。 |

## 工作流程

1. **启动**：`OnStarted` 中解析目标证券与周期，并启动相应的蜡烛订阅。
2. **运行时调整**：当 `TimeFrameName`、`SecurityId` 或 `AutoLookupSecurity` 发生变化时，策略会停止旧订阅并用新设置重新订阅。
3. **蜡烛处理**：每当蜡烛完成，更新 `LastFinishedCandle` 属性并写日志，记录当前设置的反馈。
4. **停止**：在 `OnStopped` 或重新配置订阅时，确保先停止旧的订阅。

## 使用建议

- 在 Designer 中与图表部件搭配使用，可获得与 MT4 面板相同的交互体验；参数编辑器相当于按钮和下拉框。
- 如果策略实例已经由宿主指定了证券，可将 `SecurityId` 留空。
- 可以把日志输出绑定到界面文本或控制台，以便观察当前周期/品种状态。

## 与 MQL 版本的差异

- 不再提供图形按钮，而是通过参数控制。
- 不发送任何交易指令，只负责数据订阅与日志反馈。
- 支持的周期列表与原脚本一致，方便从 MT4 迁移。

