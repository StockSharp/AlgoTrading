# Стратегия Pending tread Grid

## Обзор
**Pending tread Grid** — это перенос эксперта MetaTrader 4 `Pending_tread.mq4` на платформу StockSharp. Изначальный советник постоянно поддерживает две решётки отложенных ордеров: одну выше текущей цены и одну ниже. Каждую решётку можно настроить на работу либо с покупками, либо с продажами, а расстояние между ступенями задаётся в пунктах. Реализация на StockSharp повторяет эту логику, опираясь исключительно на высокоуровневый API.

## Логика торговли
1. **Поддержка по bid/ask** – стратегия подписывается на котировки первого уровня (`SubscribeLevel1`) и сохраняет актуальные bid/ask. При поступлении новых данных (с учётом настраиваемого троттлинга) запускается процедура синхронизации сетки с текущим количеством ордеров.
2. **Решётка выше рынка** – параметр `AboveMarketSide` определяет тип ордеров, размещаемых выше цены: buy stop либо sell limit. Каждая ступень располагается на расстоянии `PipStep` пунктов и получает индивидуальный тейк-профит величиной `TakeProfitPips`.
3. **Решётка ниже рынка** – параметр `BelowMarketSide` задаёт buy limit либо sell stop-ордера, расположенные ниже текущей цены, с теми же интервалами и тейк-профитами.
4. **Контроль минимальной дистанции** – параметр `MinStopDistancePoints` имитирует MT4-поле `MODE_STOPLEVEL`. Если расстояние между ценой заявки и соответствующим bid/ask меньше указанного порога, ордер не ставится.
5. **Троттлинг** – `ThrottleSeconds` воспроизводит оригинальную паузу в пять секунд, защищающую от ошибки «TRADE_CONTEXT_BUSY». В течение указанного интервала выполняется не более одного цикла обслуживания, независимо от числа тиков.

Параметры, выраженные в пунктах (`PipStep`, `TakeProfitPips`), преобразуются в абсолютные ценовые смещения на основе `PriceStep` и `Decimals` инструмента. Для пяти- и трёхзначных котировок шаг автоматически умножается на десять, что соответствует mql-понятию «adjusted point».

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `OrderVolume` | 0.01 | Объём каждой заявки. Перед отправкой приводится к биржевому шагу объёма. |
| `PipStep` | 12 | Интервал между соседними ордерами в пунктах. |
| `TakeProfitPips` | 10 | Величина тейк-профита для каждого отложенного ордера, в пунктах. |
| `OrdersPerSide` | 10 | Максимальное количество активных заявок выше и ниже рынка. |
| `AboveMarketSide` | Buy | Тип ордеров выше рынка: `Buy` — buy stop, `Sell` — sell limit. |
| `BelowMarketSide` | Sell | Тип ордеров ниже рынка: `Buy` — buy limit, `Sell` — sell stop. |
| `MinStopDistancePoints` | 0 | Минимально допустимая дистанция (в пунктах) между рынком и отложенной заявкой. Укажите брокерский `MODE_STOPLEVEL`, если требуется. |
| `ThrottleSeconds` | 5 | Пауза между циклами обслуживания решётки, секунды. |
| `SlippagePoints` | 3 | Параметр сохранён для совместимости с MT4; в StockSharp на отложенные заявки не влияет. |

## Особенности реализации
- Используются только высокоуровневые методы StockSharp: `SubscribeLevel1`, `BuyLimit`, `SellLimit`, `BuyStop`, `SellStop`.
- Цены нормализуются через `Security.ShrinkPrice`, чтобы соответствовать шагу котирования.
- Объёмы корректируются с учётом `VolumeStep`, `MinVolume` и `MaxVolume` инструмента.
- Сообщения выводятся через `AddInfoLog` и `AddWarningLog`, что соответствует детальному логированию оригинального эксперта.
- По требованию задачи Python-версия отсутствует.

## Рекомендации по использованию
1. Назначьте инструмент и портфель, затем запустите стратегию — после первого обновления Level 1 решётки появятся автоматически.
2. Увеличивайте `OrdersPerSide` осторожно: каждая дополнительная ступень — это новая реальная заявка у брокера.
3. Чтобы максимально точно повторить MT4-эксперта, оставьте паузу в пять секунд и настройте `MinStopDistancePoints` согласно требованиям брокера.
4. StockSharp ведёт нетто-позиции; если активируются противоположные решётки, сделки будут частично взаимозачтены, а не образуют хедж, как в MT4.
