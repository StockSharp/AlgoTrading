# Стратегия Exp Color PEMA Digit Tm Plus

## Описание
**Exp Color PEMA Digit Tm Plus** — порт советника MetaTrader 5 «Exp_ColorPEMA_Digit_Tm_Plus». Стратегия воссоздаёт оригинальный индикатор Pentuple Exponential Moving Average (PEMA) и сохраняет все флаги доступа к торговым операциям. Сделки выполняются по выбранной серии свечей только после смены цвета индикатора и выдержки, заданной параметром `Signal Bar`.

Версия для StockSharp сохраняет систему мани-менеджмента, контроль стопов/тейков и временной выход, присутствовавшие в MQL-версии. Все настройки оформлены через `StrategyParam<T>`, что облегчает конфигурирование и оптимизацию в интерфейсе.

## Логика индикатора
* Используются восемь каскадно соединённых экспоненциальных скользящих средних с длиной `PEMA Length` и ценой из параметра `Applied Price`.
* Итоговое значение округляется до `Rounding Digits`, полностью повторяя работу оригинального индикатора.
* Наклон округлённой линии задаёт три состояния:
  * **Up (magenta)** — бычье давление, потенциальный вход в покупки.
  * **Flat (gray)** — нейтральная зона, действий нет.
  * **Down (dodger blue)** — медвежье давление, потенциальный вход в продажи.
* Состояние индикатора сохраняется для каждой закрытой свечи, что позволяет обращаться к истории при `Signal Bar > 0`.

## Правила торговли
1. **Определение сигнала** — на закрытой свече анализируется состояние индикатора, которое соответствует свече, отстоящей на `Signal Bar` баров, и сравнивается с предыдущим значением.
2. **Вход в покупки** — при переходе состояния в *Up*:
   * добавляется запрос на открытие длинной позиции (если активен флаг `Allow Long Entries`);
   * формируется запрос на закрытие шортов (если активен `Allow Short Exits`).
3. **Вход в продажи** — при переходе состояния в *Down*:
   * добавляется запрос на открытие короткой позиции (если активен `Allow Short Entries`);
   * формируется запрос на закрытие лонгов (если активен `Allow Long Exits`).
4. **Исполнение** — отложенные действия выполняются только при условии, что
   * стратегия находится онлайн и разрешено торговать;
   * достигнуто время активации, связанное с исходной свечой;
   * расчёт мани-менеджмента даёт ненулевой объём сделки.
5. **Управление рисками** —
   * стоп-лосс и тейк-профит рассчитываются от цены входа по тем же «пойнтам», что и в MetaTrader;
   * опция `Use Time Exit` закрывает позиции, просидевшие дольше `Holding Minutes` минут;
   * встречные сигналы могут сразу закрывать позицию, если соответствующий флаг разрешён.

## Параметры
| Название | Описание |
| -------- | -------- |
| Money Management | Базовое значение для расчёта объёма сделки. |
| Money Mode | Модель расчёта объёма (лоты или доля капитала). |
| Stop Loss (points) | Расстояние до стоп-лосса в пунктах. |
| Take Profit (points) | Расстояние до тейк-профита в пунктах. |
| Allowed Deviation | Допустимое отклонение цены (сохранено для совместимости). |
| Allow Long/Short Entries | Разрешение на открытие позиций в выбранном направлении. |
| Allow Long/Short Exits | Разрешение на закрытие позиций по противоположным сигналам. |
| Use Time Exit | Включает принудительное закрытие по времени. |
| Holding Minutes | Максимальное время удержания позиции (в минутах). |
| Candle Type | Тип обрабатываемых свечей (по умолчанию H4). |
| PEMA Length | Длина всех восьми EMA в каскаде PEMA. |
| Applied Price | Цена, подаваемая на вход индикатора. |
| Rounding Digits | Количество знаков округления результата. |
| Signal Bar | Число закрытых баров ожидания перед реакцией. |

## Рекомендации
* Добавьте стратегию в нужный коннектор StockSharp и подключите соответствующую свечную серию.
* Настройте параметры под конфигурацию оригинального советника.
* Стратегия реагирует только на полностью сформированные свечи, поэтому результаты идентичны логике MT5.

## Статус конверсии
* **C#-версия** — реализована (`CS/ExpColorPemaDigitTmPlusStrategy.cs`).
* **Версия на Python** — не создавалась (по инструкции).
