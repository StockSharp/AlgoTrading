# Стратегия Pure Price Action

## Общее описание
**Pure Price Action Strategy** — порт MetaTrader-советника «Pure Price Action» (MQL №24291) на платформу StockSharp.
Алгоритм объединяет пробой подтверждённого фрактала, фильтр импульса на старшем таймфрейме и долгосрочный трендовый фильтр MACD, что позволяет входить в рынок при повторном тесте свежих экстремумов.

## Логика работы
1. **Таймфрейм сигналов** — решения принимаются на выбранном пользователем таймфрейме (по умолчанию 15 минут).
2. **Подтверждение фракталом** — сделка возможна только тогда, когда последняя закрывшаяся свеча завершилась в пределах одного шага цены от ближайшего подтверждённого фрактала (верхний фрактал для шортов, нижний — для лонгов).
3. **Паттерн тел свечей** — модуль последнего тела меньше тела предыдущей свечи, а тело предыдущей свечи больше тела ещё более ранней свечи. Это повторяет фильтр «retracement momentum» из исходного советника.
4. **Скользящие средние** — две линейно взвешенные скользящие (LWMA 6 и 85) задают направление. Для покупок быстрая средняя должна быть выше медленной, для продаж — наоборот.
5. **Фильтр импульса** — индикатор Momentum с периодом 14 на старшем таймфрейме (по умолчанию 1 час) должен хотя бы раз за последние три измерения отклоняться от уровня 100 больше порога.
6. **Фильтр MACD** — индикатор MACD(12, 26, 9), рассчитанный на более высоком таймфрейме (по умолчанию 30-дневные свечи, имитирующие месяц), требует, чтобы основная линия была выше сигнальной для покупок и ниже для продаж.
7. **Размер позиции** — используется свойство `Volume` базового класса `Strategy`. При отсутствии значения открывается 1 лот. Параметр `MaxPosition` ограничивает суммарный объём позиций.

## Управление позицией
- **Начальные стопы** — необязательные уровни стоп-лосса и тейк-профита задаются в шагах цены и применяются симметрично.
- **Трейлинг-стоп** — при включении сопровождает максимум/минимум после входа на заданное расстояние.
- **Перевод в безубыток** — после прохождения цены на расстояние триггера уровень защиты переносится к цене входа с учётом смещения.
- **Ручное закрытие** — на каждой завершённой свече проверяются условия для стоп-лосса, тейк-профита, трейлинга и безубытка. При выполнении любого условия позиция закрывается целиком.

## Параметры
- `CandleType` — рабочий таймфрейм сигналов (по умолчанию 15 минут).
- `MomentumCandleType` — таймфрейм, на котором считается Momentum (по умолчанию 1 час).
- `MacdCandleType` — таймфрейм для MACD (по умолчанию 30-дневные свечи).
- `FastPeriod` / `SlowPeriod` — периоды быстрый/медленной LWMA.
- `MomentumPeriod` — период индикатора Momentum.
- `MomentumThreshold` — минимальное отклонение Momentum от 100.
- `MacdFastPeriod`, `MacdSlowPeriod`, `MacdSignalPeriod` — параметры MACD.
- `StopLossPoints`, `TakeProfitPoints` — расстояние до стоп-лосса и тейк-профита в шагах цены.
- `TrailingStopPoints` — величина трейлинг-стопа.
- `BreakEvenTriggerPoints`, `BreakEvenOffsetPoints` — параметры перевода в безубыток.
- `MaxPosition` — максимальный модуль совокупной позиции.
- `EnableTrailing`, `EnableBreakEven`, `UseStopLoss`, `UseTakeProfit` — флаги включения защитных блоков.

## Дополнительно
- Все комментарии в коде оставлены на английском языке согласно требованиям репозитория.
- Стратегия работает только по закрытиям свечей и не реагирует на внутрисвечные события.
- Используются подписки на несколько таймфреймов для воссоздания оригинальной логики (M15 для сигналов, H1 для Momentum, «месячные» свечи для MACD).
- В папке нет автоматических тестов; глобальный набор тестов репозитория остаётся без изменений, как и требовалось.
