# Fuzzy Logic 策略

## 概览

Fuzzy Logic 策略将 MT5 专家顾问 **Fuzzy logic (barabashkakvn 版)** 迁移到 StockSharp 的高级 API。系统结合比尔·威廉姆斯的多项指标与经典动量指标，将观测值转换为模糊隶属度，并在 0 到 1 之间计算单一决策分数。

当模糊得分越过以下阈值时触发交易：

- **Decision &gt; 0.75** —— 视为强烈的做空机会（动能衰竭 / 超买）。
- **Decision &lt; 0.25** —— 视为强烈的做多机会（动能回升 / 超卖）。

策略使用以价格步长表示的固定止盈、止损距离；若设置了跟踪止损距离，则会自动启用跟踪模式。

## 指标组合

| 指标 | 作用 |
| --- | --- |
| **Gator 振荡器**（基于 Alligator 线） | 通过颚线、齿线、唇线之间的距离衡量趋势扩张或收敛。 |
| **Williams %R (14)** | 识别超买与超卖区域。 |
| **Acceleration/Deceleration Oscillator** | 统计连续的动量变化次数，评估趋势加速度。 |
| **DeMarker (14)** | 比较高低点以确认衰竭信号，在策略中手工实现。 |
| **RSI (14)** | 经典动量震荡指标。 |

Alligator 线采用平滑均线并向前偏移 8/5/3 根柱，与原版 EA 完全一致，从而得到相同的 Gator 值。AC 指标通过 Awesome Oscillator（5/34 SMA 之差）减去其 5 周期均线获得，结果与 MT5 的 `iAC` 保持一致。

## 交易逻辑

1. 每个指标的数值被映射到五个模糊集合（从强烈看空到强烈看多），分段线性函数沿用了 MT5 中的原始阈值。
2. 五个集合分别乘以 0.133、0.133、0.133、0.268、0.333 的权重，并汇总为四个中间得分。
3. 最终决策得分通过 `Σ summary[x] * (0.2 * (x + 1) - 0.1)` 计算，范围保持在 `[0, 1]`。
4. 仅在蜡烛收盘时评估信号，若账户当前无持仓并且得分突破阈值则开仓。
5. 下单数量由 `Volume` 属性决定（默认 1），防守单通过 `StartProtection` 自动注册。

## 风险控制

- **StopLossPoints** —— 止损距离（价格步长单位），当 `TrailingStopPoints` 为 0 时使用该值。
- **TrailingStopPoints** —— 跟踪止损距离，大于 0 时启用跟踪功能并以此作为初始止损距离。
- **TakeProfitPoints** —— 止盈距离（价格步长单位）。

## 参数

| 参数 | 说明 |
| --- | --- |
| `CandleType` | 计算所用的蜡烛类型/周期。 |
| `BuyThreshold` | 模糊得分低于该值时建立多头，默认 0.25。 |
| `SellThreshold` | 模糊得分高于该值时建立空头，默认 0.75。 |
| `StopLossPoints` | 止损距离（价格步长）。默认 60。 |
| `TakeProfitPoints` | 止盈距离（价格步长）。默认 20。 |
| `TrailingStopPoints` | 跟踪止损距离（价格步长）。默认 0（关闭）。 |
| `WilliamsPeriod` | Williams %R 的计算周期。默认 14。 |
| `RsiPeriod` | RSI 的计算周期。默认 14。 |
| `DeMarkerPeriod` | 内置 DeMarker 的周期。默认 14。 |

## 实现要点

- 由于 StockSharp 未提供 DeMarker 指标，实现中直接累计高点差与低点差以再现 MT5 算法。
- 保存最近五个 AC 数值，以便模糊逻辑检测连续的加速序列，与 `iAC(..., shift)` 的行为保持一致。
- 通过内部缓冲区还原 Alligator 的 8/5/3 根前移，使得 Gator 振荡器与原策略等效。
- 仅在 `Position == 0` 时允许开新仓，遵循原专家顾问一次仅持有一笔仓位的规则。

## 使用步骤

1. 在 Designer 或 Backtester 中将策略绑定到目标投资组合与证券。
2. 通过 `CandleType` 选择分析用的蜡烛序列。
3. 如有需要，调整阈值或止盈止损距离。
4. 启动策略，当模糊得分突破设定阈值时，系统会自动发送订单。
