# Стратегия Fractal ZigZag
[English](README.md) | [中文](README_cn.md)

Эта стратегия представляет собой прямую конвертацию советника MetaTrader 4 **Fractal ZigZag Expert.mq4**. Она заново строит
последовательность фракталов Билла Уильямса и трактует последнюю подтверждённую экстремальную точку как активную фазу рынка.
Если последним сформировался фрактал-минимум, стратегия открывает длинную позицию; если подтверждён фрактал-максимум — короткую.
Все исходные параметры — глубина фрактала, тейк-профит, стартовый стоп и трейлинг-стоп — сохранены, но заявочная логика
адаптирована под высокоуровневый API StockSharp.

Лучше всего стратегия работает на часовых свечах (H1), как и оригинальный советник. При необходимости параметр `CandleType`
позволяет переключиться на любой другой таймфрейм из доступных. Все расстояния задаются в ценовых пунктах (шагов цены
инструмента), полностью повторяя использование константы `Point` в MetaTrader.

## Правила торговли

- **Определение сигнала**
  - Каждый завершённый бар добавляется в скользящее окно размером `2 * Level + 1`.
  - Фрактал-максимум подтверждается, если центральная свеча имеет наибольший максимум в окне; для фрактала-минимума требуется
    наименьший минимум.
  - Последний подтверждённый фрактал определяет направление: минимум задаёт внутренний тренд `2` (покупки), максимум — `1`
    (продажи).
- **Входы**
  - Когда внутренний тренд равен `2` и позиций нет, отправляется рыночная покупка объёмом `Lots`.
  - При тренде `1` и отсутствии позиции выполняется рыночная продажа.
  - После закрытия сделки стратегия вновь войдёт в том же направлении, если тренд не сменился.
- **Выходы и управление риском**
  - Каждой сделке назначаются исходный стоп-лосс и фиксированный тейк-профит (в пунктах). Значение `0` отключает соответствующую
    защиту.
  - Дополнительный трейлинг-стоп (также в пунктах) активируется после прохода ценой заданного расстояния и поддерживает одинаковый
    отступ от цены закрытия, не пересекающий стартовый стоп.
  - Контроль уровней реализован через анализ максимумов и минимумов свечей, что позволяет приблизить поведение к оригиналу на MQL4.

## Параметры по умолчанию

| Параметр | Значение | Описание |
|----------|----------|----------|
| `Level` | `2` | Число свечей по обе стороны, необходимое для подтверждения фрактала. |
| `TakeProfitPoints` | `25` | Расстояние до тейк-профита в ценовых пунктах. |
| `InitialStopPoints` | `20` | Расстояние до исходного стоп-лосса в ценовых пунктах. |
| `TrailingStopPoints` | `10` | Дистанция трейлинг-стопа (значение `0` отключает его). |
| `Lots` | `1` | Объём рыночных заявок. |
| `CandleType` | `H1` | Таймфрейм свечей, используемый в расчётах. |

## Примечания

- В начале работы вызывается `StartProtection()`, чтобы StockSharp мог задействовать аварийное закрытие позиции при необходимости.
- Комментарии в коде ведутся только на английском языке, а описания в README подготовлены на требуемых языках.
- Реализация обходится без индикаторных буферов и хранит лишь минимальное окно данных, необходимое для проверки фрактала.
