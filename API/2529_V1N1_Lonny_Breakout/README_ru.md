# Стратегия V1N1 Lonny Breakout

## Обзор
Стратегия V1N1 Lonny Breakout повторяет логику эксперта MetaTrader "V1N1 LONNY", ориентированного на прорывы во время перекрытия лондонской и нью-йоркской сессий. Перед началом торговли формируется ценовой диапазон из нескольких свечей, после чего стратегия ожидает закрытия свечи за пределами диапазона. Дополнительные фильтры: экспоненциальная скользящая средняя для оценки тренда и стохастик для контроля перекупленности/перепроданности.

Настройки риска позволяют рассчитывать объём позиции как фиксированное значение либо как процент от капитала. Также реализованы фильтр по спреду, плавающий стоп-лосс и закрытие сделки по истечении заданного числа свечей при отсутствии развития импульса.

## Логика торговли
1. **Торговые часы.** Сделки разрешены только между заданными временем начала и окончания. Время может корректироваться с учётом перехода на летнее время в Лондоне или Нью-Йорке.
2. **Диапазон открытия.** Перед стартом сессии запоминаются максимумы и минимумы фиксированного количества свечей. Этот диапазон служит базой для определения пробоев.
3. **Подтверждение тренда.** EMA должна наклоняться в сторону предполагаемой сделки: для покупок — рост, для продаж — снижение.
4. **Фильтр импульса.** Значение стохастика должно находиться в заданном диапазоне вокруг 50, чтобы избежать входа при крайних значениях индикатора.
5. **Валидация пробоя.** Предыдущая свеча должна закрыться за пределами диапазона на расстояние не меньше минимального и не больше максимального порога.
6. **Управление риском.** Стоп-лосс рассчитывается от противоположной границы диапазона, тейк-профит — как произведение дистанции стопа на коэффициент. Доступны трейлинг-стоп и принудительное закрытие по количеству свечей.

## Параметры
- `StartTrade` — время начала торговли.
- `EndTrade` — время завершения торговли.
- `SwitchDst` — режим учёта летнего времени (Европа/США/без сдвига).
- `RiskMode` — способ расчёта объёма (процент капитала или фиксированный объём).
- `PositionRisk` — процент риска либо фиксированный объём в зависимости от режима.
- `TradeRange` — число свечей для построения диапазона.
- `MinRangePoints` / `MaxRangePoints` — допустимый размер диапазона в пунктах.
- `MinBreakRange` / `MaxBreakRange` — минимальная и максимальная величина пробоя в пунктах.
- `StopLossPoints` — расстояние стоп-лосса в пунктах.
- `TpFactor` — коэффициент для расчёта тейк-профита от стоп-лосса.
- `TrailStopPoints` — размер трейлинг-стопа (0 — отключено).
- `TrendPeriod` — период EMA.
- `OverPeriod` — период стохастика.
- `OverLevels` — допустимое отклонение стохастика от уровня 50.
- `BarsToClose` — максимальное количество свечей в позиции (0 — без ограничения).
- `MaxSpreadPoints` — максимальный допустимый спред.
- `SlippagePoints` — ориентир по проскальзыванию (для совместимости с оригиналом).
- `CandleType` — используемый тип и таймфрейм свечей.

## Рекомендации по использованию
- Все параметры, заданные в пунктах, преобразуются в ценовые дистанции через `PriceStep` инструмента.
- Для контроля спреда стратегия подписывается на стакан заявок. При отсутствии котировок фильтр не применяется.
- Трейлинг-стоп и закрытие по количеству свечей проверяются только на закрытых барах, что соответствует оригинальной реализации в MQL.
- При выборе расчёта по проценту капитала требуется значение `Portfolio.CurrentValue`. Если оно недоступно, используется минимальный доступный объём.

## Файлы
- `CS/V1n1LonnyBreakoutStrategy.cs` — реализация стратегии на C# для StockSharp.
- `README.md` — описание на английском языке.
- `README_cn.md` — описание на китайском языке.
- `README_ru.md` — описание на русском языке.
