# Стратегия Galactic Explosion

## Обзор
Galactic Explosion воспроизводит оригинального советника MT5 в инфраструктуре StockSharp. Алгоритм работает только с полностью сформированными свечами, использует долгосрочную скользящую среднюю для определения торгового направления и строит расширяющуюся сетку заявок. Пока цена остаётся по одну сторону от средней, стратегия наращивает позицию и закрывает весь портфель по достижении заданной прибыли.

## Рыночная логика
1. **Фильтр направления** — сравнение цены закрытия со значением скользящей средней. Закрытие ниже средней трактуется как бычий сигнал, выше — как медвежий.
2. **Прогрессивная сетка** — первые восемь сделок открываются при любом подходящем сигнале. Начиная с девятой, расстояние от текущей цены до последней и первой точек входа определяет, можно ли добавить новую сделку.
3. **Контроль расстояния** — все дистанции измеряются в минимальных шагах цены. Если цена ушла достаточно далеко от последнего входа, стратегия добавляет позицию. В зависимости от расстояния до первой сделки она делает это сразу, спустя три свечи или спустя шесть свечей.
4. **Фиксация прибыли** — к минимальной цели сравнивается сумма реализованной и нереализованной прибыли. При достижении порога стратегия отправляет рыночную заявку на закрытие всех позиций.

## Управление сделками
- **Объём** — каждая сделка исполняется фиксированным объёмом. При смене направления стратегия одной заявкой закрывает старую позицию и открывает новую с учётом требуемого объёма.
- **Учёт состояния** — отдельно отслеживаются средняя цена, первая и последняя точки входа для длинной и короткой корзины, что позволяет повторить исходные правила сетки.
- **Торговая сессия** — сигналы учитываются только между заданными часами. Используется время открытия свечи, всё остальное игнорируется.
- **Проверка параметров** — при ошибочной настройке торгового окна (начало не раньше конца) стратегия выводит предупреждение и пропускает сигналы.

## Параметры
| Параметр | Описание |
|----------|----------|
| **Order Volume** | Объём каждой новой сделки. Также применяется для оценки числа открытых ступеней сетки. |
| **Start Hour** | Час начала торговой сессии. Сигналы ранее этого времени игнорируются. |
| **End Hour** | Час окончания сессии (исключительно). Сигналы после этого времени игнорируются. |
| **Minimal Profit** | Суммарная реализованная и нереализованная прибыль, при достижении которой позиции закрываются. |
| **Indent After 8th** | Минимальная дистанция от последнего входа после восьмой сделки (в шагах цены) для разрешения нового входа. |
| **Skip 3 Min** | Нижняя граница дистанции, активирующая правило «пропустить три свечи». |
| **Skip 3 Max** | Верхняя граница, при которой правило «пропустить три свечи» остаётся активным. |
| **Skip 6 Max** | Верхняя граница, при которой активно правило «пропустить шесть свечей». |
| **MA Length** | Длина простой скользящей средней, определяющей направление. |
| **Candle Type** | Тип свечей, на основании которых выполняются расчёты стратегии. |

## Особенности реализации
- Используется `SubscribeCandles` в связке с индикатором `SimpleMovingAverage`, обрабатываются только завершённые свечи.
- В методе `OnNewMyTrade` поддерживается учёт состояния портфеля: фиксируются первая и последняя цены входа, а также средние цены длинной и короткой корзины.
- Пороговые значения пересчитываются через `PriceStep`, что сохраняет логику «пунктов» исходного советника.
- Логика опирается на скалярные поля и не использует дополнительные коллекции, что соответствует требованиям репозитория.
