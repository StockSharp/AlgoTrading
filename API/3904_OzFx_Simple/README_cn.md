# OzFx 简化策略

## 概述
- 将 MetaTrader 4 专家顾问 **OzFx**（位于 `MQL/7994`）迁移到 StockSharp 高层 API。
- 通过 Awesome Oscillator (5/34) 与其 5 周期简单均线的差值得到 Accelerator Oscillator，并与随机指标 %K 线配合判断动量是否穿越零轴。
- 完整复刻专家顾问一次性打开 5 笔等量市价单、设置分层止盈以及首个止盈触发后将剩余仓位移至保本的管理逻辑。

## 交易逻辑
1. 计算 Awesome Oscillator（5/34），再减去其 5 周期 SMA，得到上一根和当前完成蜡烛的 Accelerator Oscillator 数值。
2. 订阅随机指标（%K 长度为 `StochasticLength`，平滑参数 3/3），在蜡烛收盘时读取主线。
3. **做多条件**：
   - `%K` 高于设定的中轴水平（默认 50）。
   - 当前 AC 为正且高于上一值。
   - 上一 AC 仍位于零轴下方（动量自下向上穿越）。
4. **做空条件** 与上述规则相反。
5. 当新蜡烛出现信号时，策略会立即打开 5 笔等量市价单：
   - 第 1~4 层分别按 `TakeProfitPips` 的倍数设置止盈。
   - 第 5 层不设止盈，用于跟随趋势。
6. 若反向条件出现且仍持有仓位，会以市价平掉剩余订单，确保策略在下一次入场前处于空仓状态。

## 仓位管理
- 所有层共享 `StopLossPips` 定义的止损距离。
- 当第一笔止盈成交后，剩余订单的止损会被提升至入场价，实现原始 EA 中的“modok” 保本逻辑。
- 当蜡烛的最高/最低价突破记录的止损或止盈水平时即执行保护性平仓，不依赖经纪商托管委托。
- 策略一次只允许一个方向的持仓，必须等待全部订单平仓后才会重置入场阻挡标志。

## 参数
| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `OrderVolume` | 每一层市价单的手数。 | `0.1` |
| `StopLossPips` | 入场价到止损价的距离（点数）。 | `100` |
| `TakeProfitPips` | 连续止盈层之间的间隔（第 1~4 层）。 | `50` |
| `StochasticLevel` | 随机指标 %K 的阈值。 | `50` |
| `StochasticLength` | 随机指标 %K 的回看周期。 | `5` |
| `CandleType` | 策略使用的蜡烛类型（默认 4 小时）。 | `4 小时` |

## 实现说明
- 仅在蜡烛收盘后评估信号，与原 MT4 专家顾问在新柱开启时运作的方式保持一致。
- 点值计算会在检测到 3/5 位小数的外汇品种时自动乘以 10，以匹配真实点值。
- 分层仓位在内存中维护，便于精确处理部分止盈与止损。
- C# 代码中的注释全部使用英文，符合仓库规范。
