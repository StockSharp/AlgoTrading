# Стратегия Serial MA Swing (API/2782)

## Краткое описание
- Перенос советника MetaTrader SerialMA в экосистему StockSharp с использованием высокоуровневого API и кастомного индикатора последовательного скользящего среднего.
- Открывает новые свинговые позиции при смене направления индикатора относительно цены, позволяет инвертировать сигналы и ограничивать количество одновременно удерживаемых сделок.
- Повторяет точечные стоп-лоссы и тейк-профиты из оригинала: расстояния задаются в пунктах инструмента и пересчитываются на каждой завершённой свече.

## Индикатор Serial Moving Average
Первоначальный советник опирается на индикатор *SerialMA*, который после каждого пересечения цены заново строит своё среднее. Перенесённый индикатор реализует тот же алгоритм:
1. Накапливает цены закрытия, начиная с последнего пересечения, и вычисляет их среднее арифметическое.
2. Отслеживает знак разницы между средним и текущим закрытием, чтобы обнаружить смену направления.
3. При смене знака «обнуляет» внутреннее окно, фиксируя момент пересечения и сигнализируя об этом стратегии.

Индикатор возвращает пару значений: само последовательное среднее и логический флаг, сообщающий о пересечении на предыдущей свече. Это позволяет повторить логику MQL без прямого обращения к буферам индикатора.

## Логика торговли
1. На каждой завершённой свече стратегия получает значение индикатора и флаг пересечения.
2. Если предыдущая свеча породила пересечение:
   - Закрытие выше среднего — формируется длинный сигнал.
   - Закрытие ниже среднего — формируется короткий сигнал.
3. Параметр **ReverseSignals** при необходимости меняет направление сделок на противоположное.
4. Параметр **OpenedMode** управляет наращиванием позиций:
   - **AllSwing** позволяет открывать новую сделку при каждом сигнале, даже если уже есть позиция в ту же сторону.
   - **SingleSwing** блокирует новые входы, пока открыта позиция соответствующего направления.
5. Перед открытием новой сделки стратегия закрывает противоположную позицию, чтобы сохранить «свинговую» структуру, как в оригинальном советнике.
6. Стоп-лосс и тейк-профит вычисляются в пунктах (price step) и проверяются на каждой свече.

## Параметры
| Имя | Назначение | Значение по умолчанию |
| --- | --- | --- |
| `OpenedMode` | Режим открытия: стек позиций или одиночный свинг. | `AllSwing` |
| `EnableBuy` | Разрешить длинные сделки. | `true` |
| `EnableSell` | Разрешить короткие сделки. | `true` |
| `ReverseSignals` | Инверсия сигналов. | `false` |
| `TradeVolume` | Объём (в лотах) каждой новой сделки. | `1` |
| `StopLossPoints` | Стоп-лосс в пунктах. `0` отключает защиту. | `0` |
| `TakeProfitPoints` | Тейк-профит в пунктах. `0` отключает цель. | `0` |
| `CandleType` | Тип свечей для расчётов. | Свечи 5 минут |

## Управление ордерами и защитой
- Для длинных позиций проверяется пробой стоп-лосса по минимуму свечи и достижение тейк-профита по максимуму, после чего отправляется рыночный ордер на закрытие.
- Для коротких позиций аналогично контролируются максимум (стоп) и минимум (прибыль).
- Уровни переводятся из пунктов в цену через `PriceStep`. При отсутствии шага цены защитные проверки отключаются, что соответствует ситуации с неизвестным `Point()` в MQL.

## Примечания по использованию
- Стратегия использует высокоуровневые методы StockSharp (`SubscribeCandles`, `BindEx`) и не обращается к низкоуровневым буферам.
- Python-версия отсутствует по требованию: реализована только C#-стратегия `CS/SerialMASwingStrategy.cs`.
- Для наибольшего сходства с оригиналом рекомендуется оставлять оба направления включёнными и режим `AllSwing`.
