# Стратегия Time EA
[English](README.md) | [中文](README_cn.md)

**Time EA Strategy** — портирование советника MetaTrader "TimeEA" в экосистему StockSharp. Стратегия управляет одной позицией, ориентируясь исключительно на время суток: открывает сделку в заданный момент, удерживает её в фиксированном направлении и закрывает по расписанию или при срабатывании опциональных стоп-лосса и тейк-профита.

В отличие от индикаторных систем, акцент сделан на дисциплине торговой сессии. Перед входом стратегия закрывает противоположную позицию, гарантирует только одно открытие в день и поддерживает минимальную дистанцию защитных ордеров, имитируя проверку ограничений брокера по стоп-уровням.

## Как работает

1. Стратегия подписывается на выбранный поток свечей (по умолчанию 1 минута) и обрабатывает только завершённые свечи.
2. Когда закрытие свечи пересекает заданное **время открытия**, выполняются действия:
   - Закрывается противоположная позиция, если она ещё активна.
   - Размещается рыночный ордер в выбранном направлении (Buy или Sell) с заданным объёмом.
   - Фиксируются уровни стоп-лосса и тейк-профита в пунктах (шаг цены) от цены входа с учётом минимального отступа.
3. В течение дня стратегия мониторит цены:
   - Если свеча пробивает стоп-лосс или тейк-профит, позиция закрывается немедленно.
   - Если свеча попадает во **время закрытия**, позиция ликвидируется вне зависимости от результата.
4. После закрытия сделка не переоткрывается до следующего календарного дня, что воспроизводит поведение оригинального советника.

## Параметры

| Параметр | Описание |
| --- | --- |
| **Open Time** | Время открытия позиции (`ЧЧ:ММ:СС`). |
| **Close Time** | Время принудительного закрытия. Может быть в тот же день или после полуночи. |
| **Position Type** | Направление позиции (`Buy` или `Sell`). |
| **Order Volume** | Объём рыночного ордера. |
| **Stop Loss (points)** | Дистанция стоп-лосса в шагах цены. `0` отключает стоп. |
| **Take Profit (points)** | Дистанция тейк-профита в шагах цены. `0` отключает цель. |
| **Minimum Distance Multiplier** | Минимальный отступ для стопа и тейка (в шагах цены), аналог множителя спреда в MQL версии. |
| **Candle Type** | Тип свечей, используемых для расчёта времени (по умолчанию минутные). |

## Практические заметки

- **Одно открытие в день.** После срабатывания времени входа позиция не переоткроется до следующего дня даже при раннем закрытии по стопу.
- **Поддержка ночных сессий.** Логика корректно обрабатывает расписания, пересекающие полночь.
- **Управление объёмом.** Объём ордера берётся из параметра `Order Volume`; подберите значение под спецификацию инструмента.
- **Эмуляция стоп-уровней.** Минимальный отступ заставляет стопы и цели находиться не ближе заданного количества пунктов от входа, компенсируя отсутствие динамического спреда.
- **Требования к данным.** Используйте свечи в часовом поясе биржи, чтобы временные условия совпадали с ожидаемым расписанием.
- **Управление риском.** Стоп и тейк исполняются программно: при достижении уровней стратегия посылает рыночный ордер на закрытие.

## Когда применять

- Для автоматизации входа в строго определённое время (например, открытие Лондона или Нью-Йорка).
- Когда направление заранее известно, но требуется жёсткое соблюдение расписания.
- Для переноса советников MetaTrader, основанных на времени, в StockSharp без низкоуровневого кода.

## Ограничения

- Проскальзывание контролируется только рынком: параметра `Deviation`, как в MetaTrader, нет.
- Минимальный отступ задаётся статически и не зависит от текущего спреда.
- Каждая стратегия управляет лишь одним инструментом.

## Быстрый старт

1. Настройте параметры (время открытия/закрытия, направление, объём, защитные дистанции) в Designer или в коде.
2. Привяжите стратегию к нужному инструменту и источнику данных.
3. Убедитесь, что временная зона свечей совпадает с планируемым расписанием.
4. Запустите стратегию и контролируйте журнал сделок; при необходимости подключите визуализацию свечей и сделок.

Подробная логика реализована в файле `CS/TimeEaStrategy.cs` и снабжена английскими комментариями по каждому этапу.
