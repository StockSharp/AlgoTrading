# Стратегия XP Trade Manager

## Краткая информация
- **Название**: XP Trade Manager Strategy
- **Источник**: конвертация советника MetaTrader «XP Trade Manager»
- **Тип**: сопровождение сделок / управление рисками
- **Рынки**: форекс и CFD с доступом к котировкам bid/ask и шагу цены

## Описание
Стратегия XP Trade Manager не генерирует собственных торговых сигналов. Она принимает под контроль уже открытые позиции и отложенные заявки по выбранному инструменту. Реализация повторяет оригинальный советник: при поступлении новых котировок автоматически поддерживаются уровни стоп-лосса, тейк-профита, перевода в безубыток и трейлинг-стопа. Если *Stealth Mode* выключен, стратегия размещает реальные защитные заявки. При включённом *Stealth Mode* уровни хранятся внутри стратегии, а выход из позиции выполняется рыночным ордером при достижении цены.

Логика работает как для длинных, так и для коротких позиций. Трейлинг-стоп соответствует алгоритму MQL: активируется после достижения заданного профита, сдвигается дискретными шагами и при необходимости ограничивается уровнем безубытка. Если трейлинг отключён, можно задействовать перенос в безубыток – при достижении целевого профита стоп переносится чуть выше цены входа.

## Основные особенности
1. Автоматический расчёт начальных уровней стоп-лосса и тейк-профита по цене входа и заданному количеству пунктов.
2. Опциональный трейлинг-стоп с дискретными шагами и возможностью ограничения на уровне безубытка.
3. Режим перевода в безубыток при отключённом трейлинге.
4. Поддержка как видимых защитных заявок, так и полностью виртуального режима.
5. Работа по данным Level1 (bid/ask), что обеспечивает поведение, идентичное исходному советнику MetaTrader.

## Параметры
| Параметр | Описание |
|----------|----------|
| `StopLossPoints` | Расстояние в пунктах для начального стоп-лосса. |
| `TakeProfitPoints` | Расстояние в пунктах для тейк-профита. |
| `UseBreakEven` | Включает перенос стопа в безубыток. |
| `BreakevenActivationPoints` | Профит (в пунктах), после которого срабатывает безубыток. |
| `BreakevenLevelPoints` | Запас пунктов, сохраняемый после перевода в безубыток. |
| `UseTrailingStop` | Включает трейлинг-стоп. |
| `TrailingStartPoints` | Профит (в пунктах), после которого активируется трейлинг. |
| `TrailingStepPoints` | Шаг (в пунктах) для очередного сдвига трейлинга. |
| `TrailingDistancePoints` | Расстояние между ценой и трейлинг-стопом после активации. |
| `TrailingEndAtBreakeven` | Ограничивает трейлинг уровнем безубытка. |
| `StealthMode` | Виртуальный режим без выставления защитных заявок. |

## Рекомендации по применению
1. Запустите стратегию на нужном инструменте – она начнёт управлять уже открытыми позициями.
2. Убедитесь, что для инструмента поступают котировки Level1, иначе расчёт уровней будет невозможен.
3. При выключенном *Stealth Mode* стратегия отменяет и создаёт защитные заявки заново при изменении параметров или продвижении трейлинга.
4. Для инструментов с 3 или 5 знаками после запятой шаг рассчитывается в «пипсах» (шаг цены × 10), что соответствует оригинальному MQL советнику.
5. Модуль рекомендуется использовать совместно с другими стратегиями, которые отвечают за открытие сделок.

## Ссылки
- Исходный файл MetaTrader: `MQL/42180/XP Trade Manager.mq5`
