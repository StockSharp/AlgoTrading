# XP 交易管家策略

## 概述
- **名称**：XP Trade Manager Strategy
- **来源**：来自 MetaTrader 专家顾问 “XP Trade Manager”的移植
- **类型**：仓位管理 / 风险控制
- **适用市场**：外汇、差价合约等提供买卖价和最小价格步长的品种

## 策略说明
XP 交易管家策略不会生成新的交易信号，而是接管当前品种已经持有的仓位和挂单。它按照原始 EA 的逻辑，在收到新的买卖报价时自动维护止损、止盈、保本和追踪止损水平。禁用 *Stealth Mode* 时，策略会在交易所注册真实的止损/止盈订单；启用 *Stealth Mode* 时，策略仅在内部跟踪这些价位，一旦触发就通过市价单离场。

策略同时支持多头与空头仓位，并根据方向分别计算价格。追踪止损复刻了原版 EA 的行为：只有在价格达到激活阈值后才生效，之后按照离散的步长推进，并可选地限制在保本价位附近。若禁用追踪止损，可开启保本逻辑，在达到指定利润后将止损上移到略有盈利的位置。

## 主要特性
1. 根据开仓价和用户定义的点数自动计算初始止损、止盈价格。
2. 可选的追踪止损，按照固定步长推进，并支持限制在保本价附近。
3. 保本机制，在追踪止损关闭时于达到目标利润后自动调整止损。
4. 同时支持可见保护单和纯虚拟（隐形）管理模式。
5. 使用实时 Level1 买卖报价来判断离场，与原始 MetaTrader 管家保持一致。

## 参数说明
| 参数 | 说明 |
|------|------|
| `StopLossPoints` | 初始化保护性止损的点数距离。 |
| `TakeProfitPoints` | 初始止盈的点数距离。 |
| `UseBreakEven` | 启用保本逻辑（在追踪止损关闭时生效）。 |
| `BreakevenActivationPoints` | 触发保本的利润点数阈值。 |
| `BreakevenLevelPoints` | 保本触发后保留的利润点数。 |
| `UseTrailingStop` | 启用追踪止损模块。 |
| `TrailingStartPoints` | 启动追踪止损所需的利润点数。 |
| `TrailingStepPoints` | 每次推动追踪止损所需的额外利润点数。 |
| `TrailingDistancePoints` | 追踪止损激活后与当前价格保持的点数距离。 |
| `TrailingEndAtBreakeven` | 限制追踪止损不超过保本价。 |
| `StealthMode` | 启用隐形模式，仅在内部维护价位并通过市价单离场。 |

## 使用提示
1. 将策略附加到目标品种上，启动后即会管理现有仓位。可以在建仓前或建仓后启动。
2. 需要订阅 Level1 买卖价行情，否则无法判断是否触发保护价位。
3. 禁用 *Stealth Mode* 时，策略会根据参数变化或追踪止损推进情况取消并重建保护订单。
4. 点数计算依赖品种的 `PriceStep`；对于 3 位或 5 位小数的外汇品种，会自动采用与原 EA 相同的 pip（步长 × 10）。
5. 该模块适用于与其它产生交易信号的策略联合使用，由本策略负责风险控制。

## 参考
- 原始 MetaTrader 源码：`MQL/42180/XP Trade Manager.mq5`
