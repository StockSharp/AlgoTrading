# EA Trix 策略

## 概述

EA Trix 策略复刻自 MetaTrader 5 的同名专家顾问，它将 *TRIX ARROWS* 指标与基础风控模块结合使用。当 TRIX 三重指数
均线与其信号线发生交叉时触发入场信号，并根据配置选择在信号 K 线收盘价立即执行或者在下一根 K 线开盘执行，以
符合原始脚本中的“收盘交易”选项。

## 交易逻辑

1. 计算两条三重指数移动平均：
   - TRIX 通过连续三次对收盘价应用长度为 **TRIX EMA** 的 EMA，并对第三次平滑的数值计算单根 K 线的变化率。
   - 信号线采用相同的流程，但使用 **Signal EMA** 设定的长度。
2. 通过交叉判断方向：
   - 信号线从下向上穿越 TRIX 时准备开多单；
   - 信号线从上向下穿越 TRIX 时准备开空单。
3. 根据 **Trade On Close** 参数执行：
   - 为 `false` 时在当前信号 K 线收盘价直接下单；
   - 为 `true` 时将信号挂起，等下一根 K 线开盘价执行，以模拟原始 EA 的延迟交易模式。
4. 每次入场前都会平掉反向持仓，因此策略在任意时刻只持有一个方向的净头寸。

## 仓位管理

- **Stop Loss**：可选的固定止损距离，设置为 `0` 表示不启用。
- **Take Profit**：可选的固定止盈距离，设置为 `0` 表示不启用。
- **Break Even**：当价格向有利方向运行达到该距离后，止损价移动到开仓价实现保本。
- **Trailing Stop**：在达到追踪距离后启动移动止损，并按照 **Trailing Step** 指定的最小步长上调/下调止损价。
- 策略在每根完成的 K 线上使用最高价/最低价检查保护条件，一旦命中便通过市价单离场。

## 参数说明

| 参数 | 说明 |
| ---- | ---- |
| `CandleType` | 策略订阅的 K 线类型（时间框架）。 |
| `Volume` | 新仓位的下单数量，反向仓位会自动加入以完成反手。 |
| `EmaPeriod` | 计算 TRIX 曲线所用 EMA 的周期。 |
| `SignalPeriod` | 计算信号曲线所用 EMA 的周期。 |
| `TradeOnCloseBar` | `true` 表示在下一根 K 线开盘执行；`false` 表示在信号 K 线收盘执行。 |
| `StopLoss` | 距离开仓价的止损幅度，`0` 关闭。 |
| `TakeProfit` | 距离开仓价的止盈幅度，`0` 关闭。 |
| `TrailingStop` | 启动移动止损所需的距离，`0` 关闭。 |
| `TrailingStep` | 移动止损每次调整的最小步长。 |
| `BreakEven` | 触发保本移动所需的距离，`0` 关闭。 |

## 使用建议

- 策略仅订阅一条蜡烛数据流，并且只处理已经收盘的 K 线，符合 StockSharp 高层 API 的使用规范。
- 止损、止盈及移动止损距离以价格单位表示，请根据交易品种的最小价位变动进行调整。
- 在回测或仿真中采用市价委托，默认以信号 K 线收盘价（或下一根 K 线开盘价）作为成交价。

## 转换说明

- 原版 MT5 专家顾问依赖外部指标 *TRIX ARROWS*（编号 19056）。本转换使用 StockSharp 的
  `ExponentialMovingAverage` 指标与单根变化率计算复现同样的结果，无需访问自定义缓冲区。
- MT5 中的服务器端止损/止盈在此实现中改为根据 K 线极值判断后发送市价单完成离场。
- 报警、声音提醒以及经纪商相关的辅助参数未迁移，因为它们不影响核心的交易逻辑。
