# Стратегия EA Trix

## Общее описание

EA Trix воспроизводит логику советника MetaTrader 5, который использует индикатор *TRIX ARROWS* вместе с базовыми инструментами
управления рисками. Стратегия отслеживает пересечения тройной экспоненциальной средней (TRIX) и её сигнальной линии, после чего
открывает позицию. В зависимости от настроек можно выполнять сделки сразу по закрытию бара с сигналом либо переносить их на
следующую свечу, как это предусмотрено в оригинальном советнике («торговля на закрытии бара»).

## Торговая логика

1. Формируются два тройных экспоненциальных сглаживания:
   - TRIX рассчитывается как три последовательно применённых EMA длиной **TRIX EMA** к цене закрытия с последующим вычислением
     изменения третьей EMA за один бар.
   - Сигнальная линия строится аналогично, но с использованием периода **Signal EMA**.
2. Определяются направления по пересечениям:
   - Сигнальная линия пересекает TRIX снизу вверх — подготавливается вход в покупку.
   - Сигнальная линия пересекает TRIX сверху вниз — подготавливается вход в продажу.
3. В зависимости от параметра **Trade On Close** стратегия:
   - Либо исполняет ордер по цене закрытия свечи с сигналом;
   - Либо ставит сигнал в очередь и исполняет его по цене открытия следующего бара.
4. Перед открытием новой позиции алгоритм закрывает противоположную позицию, поэтому в рынке всегда находится только одно чистое
   направление.

## Управление позицией

- **Stop Loss** — фиксированное расстояние от цены входа. Значение `0` отключает защитный стоп.
- **Take Profit** — целевая прибыль. Значение `0` отключает тейк-профит.
- **Break Even** — при достижении указанного расстояния в прибыль стоп переносится в точку входа.
- **Trailing Stop** — после прохождения ценой заданного расстояния стоп следует за ценой с шагом не менее **Trailing Step**.
- Контроль защитных условий выполняется на каждой закрытой свече по экстремумам (High/Low). При срабатывании условия позиция
  закрывается рыночной заявкой.

## Параметры

| Параметр | Описание |
| -------- | -------- |
| `CandleType` | Тип/таймфрейм свечей, с которыми работает стратегия. |
| `Volume` | Объём новой позиции. При наличии противоположной позиции её объём автоматически учитывается для реверса. |
| `EmaPeriod` | Длина EMA для вычисления кривой TRIX. |
| `SignalPeriod` | Длина EMA для сигнальной кривой. |
| `TradeOnCloseBar` | `true` — исполнение на следующем баре; `false` — немедленное исполнение на текущей свече. |
| `StopLoss` | Расстояние защитного стопа от цены входа. `0` — отключено. |
| `TakeProfit` | Расстояние до тейк-профита. `0` — отключено. |
| `TrailingStop` | Дистанция активации трейлинг-стопа. `0` — отключено. |
| `TrailingStep` | Минимальный шаг обновления трейлинг-стопа. |
| `BreakEven` | Дистанция для переноса стопа в безубыток. `0` — отключено. |

## Практические рекомендации

- Стратегия подписывается только на один поток свечей и обрабатывает исключительно закрытые бары, что соответствует требованиям
  высокоуровневого API StockSharp.
- Значения стопов и тейк-профита задаются в ценовых единицах. Подбирайте их с учётом шага цены выбранного инструмента.
- При тестировании ордера исполняются по цене закрытия (или по цене открытия следующей свечи для отложенных сигналов), так как
  используются рыночные заявки.

## Особенности конверсии

- В оригинальном коде MT5 задействован внешний индикатор *TRIX ARROWS* (код 19056). В версии StockSharp его расчёт выполнен через
  стандартные `ExponentialMovingAverage` и вычисление изменения за бар без обращения к индикаторным буферам.
- Биржевые стопы/тейки, использовавшиеся в MT5, заменены контролем экстремумов свечей и последующей отправкой рыночных заявок.
- Система оповещений, звуков и брокерские параметры не перенесены, поскольку они не влияют на основную торговую логику.
