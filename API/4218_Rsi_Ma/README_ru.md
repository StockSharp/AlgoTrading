# 4218 RSI MA Strategy

## Общее описание
Стратегия представляет собой порт оригинального эксперта MetaTrader из каталога `MQL/9925`. Индикатор RSI_MA рассчитывается путём умножения классического RSI на наклон экспоненциальной скользящей средней по взвешенной цене `(High + Low + 2 * Close) / 4`. Обработка ведётся только по закрытым свечам, что позволяет максимально точно воспроизвести поведение исходного алгоритма.

Базовая конфигурация рассчитана на дневные свечи EURUSD (таймфрейм D1) и допускает только одну открытую позицию. При необходимости стратегию можно адаптировать под другой инструмент, изменив тип свечей и пороговые уровни.

## Логика работы
1. **Расчёт индикатора**
   - RSI с настраиваемым периодом считается по ценам закрытия.
   - EMA с тем же периодом рассчитывается по взвешенной цене.
   - Итоговое значение индикатора = `RSI * (EMA[тек] - EMA[пред]) / размер_пункта`, ограниченное диапазоном `[1, 99]`.
2. **Условия входа в лонг**
   - Предыдущее значение индикатора ниже экстремального уровня перепроданности (по умолчанию 5).
   - Текущее значение выше уровня активации (по умолчанию 20).
   - Открытых позиций нет либо имеется короткая позиция (при необходимости она закрывается и открывается длинная).
3. **Условия входа в шорт**
   - Предыдущее значение выше экстремального уровня перекупленности (по умолчанию 95).
  - Текущее значение ниже уровня активации (по умолчанию 80).
   - Открытых позиций нет либо имеется длинная позиция (при необходимости она закрывается и открывается короткая).
4. **Выход по индикатору**
   - Лонг закрывается при переходе индикатора из зоны перекупленности ниже уровня активации (95 → 80).
   - Шорт закрывается при переходе индикатора из зоны перепроданности выше уровня активации (5 → 20).
5. **Защитные выходы**
   - Стоп-лосс, тейк-профит и трейлинг выражаются в пунктах, которые автоматически переводятся в цену через `PriceStep` (резервное значение 0.0001).
   - Трейлинг активируется только после продвижения цены на расстояние, превышающее заданное значение, и никогда не отодвигает стоп назад.

## Параметры
| Параметр | Значение |
|----------|----------|
| `RsiPeriod` | Период RSI и EMA. |
| `OversoldActivationLevel` | Уровень подтверждения входа в лонг после экстремума перепроданности. |
| `OversoldExtremeLevel` | Экстремальное значение, которое должно быть достигнуто перед открытием лонга. |
| `OverboughtActivationLevel` | Уровень подтверждения входа в шорт после экстремума перекупленности. |
| `OverboughtExtremeLevel` | Экстремальное значение, которое должно быть достигнуто перед открытием шорта. |
| `StopLossPips` | Дистанция стоп-лосса в пунктах (включается через `UseStopLoss`). |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах (включается через `UseTakeProfit`). |
| `TrailingStopPips` | Дистанция трейлинг-стопа (включается через `UseTrailingStop`). |
| `UseStopLoss` | Включение/отключение стоп-лосса. |
| `UseTakeProfit` | Включение/отключение тейк-профита. |
| `UseTrailingStop` | Включение/отключение трейлинг-стопа. |
| `UseMoneyManagement` | Активация мани-менеджмента по проценту риска. |
| `RiskPercent` | Процент капитала, который разрешается рисковать в сделке. |
| `TradeVolume` | Фиксированный объём при отключённом мани-менеджменте. |
| `CandleType` | Тип свечей для расчётов (по умолчанию дневные). |

## Рекомендации по применению
- Для полного соответствия оригинальному советнику используйте символ EURUSD с дневными свечами. При смене инструмента скорректируйте тип свечей и пороги.
- Стратегия всегда держит одну позицию: противоположное направление закрывается перед открытием новой сделки.
- При отсутствии данных о портфеле или если рассчитанный объём ≤ 0 используется фиксированное значение `TradeVolume`.
- Убедитесь, что `PriceStep` инструмента соответствует пункту (для большинства валютных пар 0.0001). При другом шаге пересмотрите значения стопов.

## Управление рисками
- Проверка стоп-уровней выполняется по диапазону High/Low закрывшейся свечи.
- Трейлинг-стоп подтягивается только при наличии прибыли, не снижая защитный уровень.
- Даже при отключении защитных ордеров индикаторные условия продолжают закрывать позиции, что повторяет логику MQL-версии.
