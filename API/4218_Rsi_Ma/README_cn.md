# 4218 RSI MA 策略

## 概览
该策略是 `MQL/9925` 中 MetaTrader 专家的 C# 移植版本。它通过 `(High + Low + 2 * Close) / 4` 的加权价格计算 EMA 斜率，并将其与传统 RSI 相乘，从而重建 RSI_MA 动量指标。仅使用收盘完成的 K 线参与计算，以保持与原始 EA 一致的信号节奏。

默认配置针对 EURUSD 日线 (D1)，任意时刻只允许存在一笔仓位。如果需要，也可以通过调整蜡烛类型与阈值，将策略应用到其他品种与周期。

## 交易逻辑
1. **指标计算**
   - 使用可配置周期的 RSI 处理收盘价。
   - 使用相同周期的 EMA 处理加权价格。
   - 指标值为 `RSI * (EMA(当前) - EMA(前一根)) / 点值`，并限制在 `[1, 99]` 区间。
2. **做多条件**
   - 前一根指标值低于超卖极值（默认 5）。
   - 最新指标值高于多头激活阈值（默认 20）。
   - 当前没有多头仓位；若存在空头仓位会先行平仓再入场做多。
3. **做空条件**
   - 前一根指标值高于超买极值（默认 95）。
   - 最新指标值低于空头激活阈值（默认 80）。
   - 当前没有空头仓位；若存在多头仓位会先行平仓再入场做空。
4. **指标出场**
   - 多头：指标从超买极值回落到激活阈值以下（95 → 80）。
   - 空头：指标从超卖极值回升到激活阈值以上（5 → 20）。
5. **防护机制**
   - 止损、止盈与追踪止损以点数表示，并按照标的的 `PriceStep`（缺省为 0.0001）换算成价格。
   - 追踪止损仅在浮盈超过设置距离后才会向有利方向推进，永不放宽。

## 参数说明
| 参数 | 说明 |
|------|------|
| `RsiPeriod` | RSI 与 EMA 的周期。 |
| `OversoldActivationLevel` | 超卖极值出现后触发多头的激活阈值。 |
| `OversoldExtremeLevel` | 允许做多前必须达到的超卖极值。 |
| `OverboughtActivationLevel` | 超买极值出现后触发空头的激活阈值。 |
| `OverboughtExtremeLevel` | 允许做空前必须达到的超买极值。 |
| `StopLossPips` | 止损距离（点），可通过 `UseStopLoss` 启用/禁用。 |
| `TakeProfitPips` | 止盈距离（点），可通过 `UseTakeProfit` 启用/禁用。 |
| `TrailingStopPips` | 追踪止损距离（点），可通过 `UseTrailingStop` 启用/禁用。 |
| `UseStopLoss` | 是否启用止损管理。 |
| `UseTakeProfit` | 是否启用止盈管理。 |
| `UseTrailingStop` | 是否启用追踪止损。 |
| `UseMoneyManagement` | 是否使用按风险百分比计算仓位。 |
| `RiskPercent` | 启用资金管理时的单笔风险百分比。 |
| `TradeVolume` | 未启用资金管理时的固定下单量。 |
| `CandleType` | 策略处理的蜡烛类型（默认日线）。 |

## 使用建议
- 若需完全复制原 EA 的行为，请使用 EURUSD 日线数据；更换品种或周期时请同步调整 `CandleType` 与阈值。
- 策略始终保持单一仓位，开仓前会自动平掉反向单。
- 当无法获取组合价值或计算出的仓位小于等于 0 时，会退回到固定 `TradeVolume`。
- 请确保标的的 `PriceStep` 与实际点值一致（大多数外汇品种为 0.0001），否则需要重新评估止损/止盈距离。

## 风险控制
- 每根完成的 K 线都会根据最高价/最低价判断是否触发止损或止盈。
- 追踪止损只在盈利状态下收紧，永不反向放宽。
- 即使关闭防护参数，指标条件仍会执行平仓，保持与 MQL 版本相同的退场逻辑。
