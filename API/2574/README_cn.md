# NUp1Down 策略

## 概述
**NUp1Down** 策略是 MetaTrader 5 专家顾问 “N bars up, then one bar down”（文件 `NUp1Down.mq5`）的直接移植版本。
策略只分析 StockSharp 提供的已完成 K 线，当连续多根上涨 K 线后出现一根下跌 K 线时自动建立空头仓位，
适用于希望在 StockSharp Designer、Shell 或 Runner 中自动化经典反转形态的交易者。

## 交易逻辑
1. 仅处理由参数 `CandleType` 指定类型的收盘 K 线。
2. 始终保留最近 `BarsCount + 1` 根 K 线。最新 K 线必须收阴（收盘价低于开盘价），这是触发信号的下跌 K 线。
3. 之前的 `BarsCount` 根 K 线全部需要收阳。除最旧的一根外，每根 K 线的收盘价都必须高于它前一根的收盘价，
   形成阶梯式上涨结构。
4. 当上述条件满足并且没有持有空头仓位时，策略会发送市价卖出指令。
5. 仓位大小由 `RiskPercent` 控制。算法根据止损距离（以货币计）计算可承受的最大亏损，并确定允许开仓的
   手数，确保风险不超过账户权益的设定百分比。`Volume` 仍然是最小下单数量，风险模型只会在此基础上放大仓位。

## 仓位管理
- 建仓后会立即计算止损与止盈。两者都以点（pip）为单位，并通过 `PriceStep` 转换为价格。对于报价拥有
  三位或五位小数的品种，策略会自动调整点值以匹配 MetaTrader 的定义。
- 每根收盘 K 线都会重新计算追踪止损。追踪距离等于 `TrailingStopPips`，只有当价格至少向有利方向移动
  `TrailingStepPips` 时才会移动止损。逻辑与原版专家顾问一致：对于空头仓位，止损沿着卖价下移，而策略
  不会开多头仓位。
- 在寻找新的入场信号之前，策略会先评估退出条件。一旦触及止损、止盈或者追踪止损被上移至当前卖价之上，
  仓位就会被平仓。

## 参数
| 名称 | 说明 |
| ---- | ---- |
| `BarsCount` | 入场前需要的连续上涨 K 线数量（默认 3）。 |
| `TakeProfitPips` | 止盈距离（点），基于入场价计算（默认 50）。 |
| `StopLossPips` | 止损距离（点），基于入场价计算（默认 50）。 |
| `TrailingStopPips` | 追踪止损与当前价格之间的距离（默认 10）。 |
| `TrailingStepPips` | 触发追踪止损移动所需的最小有利波动（默认 5）。 |
| `RiskPercent` | 每笔交易允许承担的账户资金百分比（默认 5）。 |
| `CandleType` | 用于识别形态的 K 线类型/时间框架（默认 1 小时）。 |

## 使用说明
- 请将 `Volume` 设置为经纪商允许的最小交易手数。风险模型可能会增加下单数量，但不会低于该值。
- 策略在任何时刻仅维持一个综合空头仓位。如果账户中存在多头仓位，系统会先平掉多头再建立空头。
- 策略基于 K 线数据运行。止损或止盈的触发依赖于 K 线的最高价/最低价，因此实际成交时间可能与逐笔行情
  略有差异。
- 本次仅提供 C# 版本，Python 版本及其目录暂未创建。代码位于 `API/2574/CS/NUp1DownStrategy.cs`。
