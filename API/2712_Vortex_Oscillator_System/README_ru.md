# Стратегия Vortex Oscillator System

## Общее описание
Vortex Oscillator System — это прямой порт советника MetaTrader 5, основанного на осцилляторе Vortex. Индикатор вычисляется как разница между положительной линией Vortex (VI+) и отрицательной линией Vortex (VI-) на выбранной серии свечей. Сильные отрицательные значения показывают доминирование VI-, а высокие положительные значения свидетельствуют о превосходстве VI+. Стратегия трактует эти экстремумы как потенциальные точки разворота и реагирует контртрендовыми входами, дополняя их выходами по уровням осциллятора.

## Принцип работы стратегии
1. Свечи строятся с использованием заданного таймфрейма и передаются во встроенный индикатор `VortexIndicator`.
2. После формирования индикатора осциллятор на каждом закрытом баре вычисляется как `VI+ - VI-`.
3. Осциллятор сравнивается с настраиваемыми порогами:
   - Если значение падает ниже порога покупок, формируется сигнал на вход в лонг.
   - Если значение поднимается выше порога продаж, формируется сигнал на вход в шорт.
4. Дополнительные параметры могут ограничивать сигналы диапазоном между торговым порогом и уровнем стоп-лосса (для каждой стороны отдельно).
5. При появлении нового сигнала стратегия закрывает противоположную позицию и открывает сделку в нужном направлении заданным объёмом.
6. Открытые позиции постоянно контролируются: при достижении уровней стоп-лосса или тейк-профита по осциллятору позиция закрывается немедленно.

Такой алгоритм полностью повторяет логику MT5: расчёт выполняется только на закрытых барах, сигналы не конфликтуют между собой, а защитные правила привязаны к значениям осциллятора.

## Правила входа
- **Покупка**
  - Условие выполняется, когда осциллятор меньше либо равен порогу покупок.
  - Если включён стоп-лосс для лонгов, значение осциллятора также должно быть выше уровня стоп-лосса.
  - Перед открытием лонга существующая короткая позиция закрывается.
- **Продажа**
  - Условие выполняется, когда осциллятор больше либо равен порогу продаж.
  - Если включён стоп-лосс для шортов, значение осциллятора также должно быть ниже уровня стоп-лосса.
  - Перед открытием шорта существующая длинная позиция закрывается.
- Если значение осциллятора находится между порогами покупок и продаж, сигналы обнуляются и позиция не меняется.

## Правила выхода
- **Длинные позиции**
  - Закрываются, если осциллятор опускается до уровня стоп-лосса или ниже (при включённом параметре).
  - Закрываются, если осциллятор поднимается до уровня тейк-профита или выше (при включённом параметре).
- **Короткие позиции**
  - Закрываются, если осциллятор поднимается до уровня стоп-лосса или выше (при включённом параметре).
  - Закрываются, если осциллятор опускается до уровня тейк-профита или ниже (при включённом параметре).

Проверка условий выхода выполняется после каждого закрытия свечи, что обеспечивает точное соответствие циклу мониторинга оригинального советника.

## Параметры
- **Vortex Length** — период расчёта индикатора Vortex (по умолчанию 14).
- **Candle Type** — таймфрейм, используемый для построения свечей и расчёта индикатора.
- **Use Buy Stop Loss** — включает фильтр и выход по стоп-лоссу для длинных позиций.
- **Use Buy Take Profit** — включает выход по тейк-профиту для длинных позиций.
- **Use Sell Stop Loss** — включает фильтр и выход по стоп-лоссу для коротких позиций.
- **Use Sell Take Profit** — включает выход по тейк-профиту для коротких позиций.
- **Buy Threshold** — значение осциллятора, при котором разрешён вход в лонг (по умолчанию -0.75).
- **Buy Stop Loss Level** — значение осциллятора, закрывающее длинные позиции при активном стоп-лоссе (по умолчанию -1.00).
- **Buy Take Profit Level** — значение осциллятора, закрывающее длинные позиции при активном тейк-профите (по умолчанию 0.00).
- **Sell Threshold** — значение осциллятора, при котором разрешён вход в шорт (по умолчанию 0.75).
- **Sell Stop Loss Level** — значение осциллятора, закрывающее короткие позиции при активном стоп-лоссе (по умолчанию 1.00).
- **Sell Take Profit Level** — значение осциллятора, закрывающее короткие позиции при активном тейк-профите (по умолчанию 0.00).
- **Volume** — размер позиции для новых сделок (по умолчанию 0.1, как в оригинальном советнике).

## Особенности реализации
- Обработка ведётся только по закрытым свечам, чтобы исключить повторные сигналы внутри бара.
- Для основных порогов заданы диапазоны оптимизации, что позволяет исследовать параметры в тестере StockSharp.
- При смене направления стратегия автоматически переворачивает позицию, отправляя заявку, достаточную для закрытия противоположного объёма и открытия новой сделки.
- Настройки стоп-лосса и тейк-профита независимы: можно использовать любой набор защитных правил.
