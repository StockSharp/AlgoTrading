# Стратегия Cloudzs Trade 2

## Обзор
**Cloudzs Trade 2** — порт советника MetaTrader 4 `cloudzs_trade_2` на платформу StockSharp. Алгоритм сочетает развороты по стохастику с фильтром из двух подряд одинаковых фракталов и активно сопровождает позицию трейлинг-стопом. В реализации на C# сохранена логика сигналов и управления сделками, при этом все настройки вынесены в `StrategyParam`, что позволяет оптимизировать их в Designer или задавать из пользовательского интерфейса.

Стратегия анализирует один поток свечей (период задаётся параметром) и формирует сигналы двумя независимыми способами:

1. **Разворот стохастика** — когда линия %D выходит из зоны перекупленности (>= 80) или перепроданности (<= 20) и подтверждается пересечение %D и %K на предыдущей свече.
2. **Двойной фрактал** — когда подряд появляются два верхних либо два нижних фрактала.

Если хотя бы одно условие выдаёт покупку или продажу, стратегия открывает позицию (при отсутствии активной сделки и если последняя фиксация прибыли была в другой день). При включённой опции `CloseOnOpposite` противоположный сигнал также может досрочно закрыть позицию.

## Параметры
| Параметр | Назначение | Значение по умолчанию |
| -------- | ---------- | --------------------- |
| `LotSplitter` | Коэффициент расчёта объёма от текущей стоимости портфеля. | `0.1` |
| `MaxVolume` | Максимальный объём позиции (0 — без ограничения). | `0` |
| `TakeProfitOffset` | Фиксированная дистанция тейк-профита в ценовых пунктах. | `0` |
| `TrailingStopOffset` | Дистанция трейлинг-стопа. | `0.01` |
| `StopLossOffset` | Фиксированная дистанция стоп-лосса. | `0.05` |
| `MinProfitOffset` | Минимальная прибыль, при падении ниже которой позиция закрывается после достижения `ProfitPointsOffset`. | `0` |
| `ProfitPointsOffset` | Необходимое благоприятное движение для включения правила `MinProfitOffset`. | `0` |
| `%K Period / %D Period / Slowing` | Настройки стохастика. | `8 / 8 / 4` |
| `Method` | Идентификатор метода сглаживания из оригинала MT4 (для справки, на поведение не влияет). | `3` |
| `PriceMode` | Идентификатор типа цены из MT4 (для справки). | `1` |
| `UseStochasticCondition` | Включить сигналы по стохастику. | `true` |
| `UseFractalCondition` | Включить сигналы по фракталам. | `true` |
| `CloseOnOpposite` | Закрывать позицию при противоположном сигнале. | `true` |
| `CandleType` | Тип и таймфрейм используемых свечей. | `15 минут` |

## Торговые сигналы
### Покупка
- Линия %D находится ниже/равна 20 и пересекает %K вниз (проверяется предыдущая свеча).
- **Или** появляются два подряд нижних фрактала.
- Позиция отсутствует, последняя сделка закрыта в другой календарный день.

### Продажа
- Линия %D находится выше/равна 80 и пересекает %K вверх.
- **Или** появляются два подряд верхних фрактала.
- Позиция отсутствует, последняя сделка закрыта в другой день.

### Выход из позиции
- Достижение стоп-лосса или тейк-профита (если заданы).
- Срабатывание трейлинг-стопа.
- После прохождения `ProfitPointsOffset` и отката до `MinProfitOffset` прибыль фиксируется.
- При включённом `CloseOnOpposite` противоположный сигнал закрывает позицию.

## Управление рисками
- Стопы и тейки задаются в абсолютных ценовых единицах, как и в оригинальной версии.
- Трейлинг-стоп обновляется по цене закрытия и движется только в сторону прибыли.
- Расчёт объёма опирается на стоимость портфеля; при отсутствии данных используется значение `LotSplitter`.

## Ограничения
- В StockSharp доступна единственная реализация стохастика, поэтому параметры `Method` и `PriceMode` оставлены для совместимости, но не меняют расчёты.
- Оригинальный советник работал по тикам; порт обрабатывает только завершённые свечи в соответствии с рекомендациями StockSharp.

## Использование
1. Добавьте стратегию в проект StockSharp и выберите инструмент.
2. Настройте таймфрейм, параметры стохастика и уровни защиты.
3. Убедитесь, что значения стопов/тейков соответствуют минимальному шагу цены.
4. Запустите стратегию в Designer, Runner или через API и следите за логами для контроля сигналов.
