# Стратегия Day Trading

## Общее описание
Стратегия Day Trading – это порт оригинального советника `MQL/24298/Day Trading.mq4` на платформу StockSharp. Алгоритм ищет сделки по тренду после отката к средней, комбинируя индикаторы EMA, Momentum и подтверждение по MACD на старшем таймфрейме. Все ключевые настройки вынесены в параметры стратегии и могут подстраиваться под инструмент.

Торговля ведётся по одной бумаге и по типу свечей, который задаётся пользователем. Ордера выставляются по рынку только после закрытия свечи, когда все фильтры выполняются. После входа немедленно рассчитываются фиксированные уровни стоп-лосса и тейк-профита.

## Логика входа
1. **Подтверждение тренда** – последние `TrendConfirmationCount` свечей должны находиться по правильную сторону 100-периодной EMA. Для покупок минимумы свечей обязаны располагаться выше EMA, для продаж – максимумы ниже. Это повторяет работу функции `candles()` из исходника.
2. **Откат к EMA20** – хотя бы одна из трёх предыдущих свечей должна протестировать 20-периодную EMA. Для длинных позиций низ свечи должен проколоть среднюю, для коротких – низ остаётся выше EMA (в оригинальном коде использовалось сравнение `Low > EMA20`, и этот критерий сохранён).
3. **Фильтр Momentum** – индикатор Momentum с периодом `MomentumPeriod` должен отклониться от базового уровня 100 больше, чем на `MomentumThreshold`, на любой из трёх последних свечей. Используется абсолютное отклонение `abs(momentum - 100)`.
4. **MACD на месяце** – сделки разрешены только когда основная линия MACD на старшем таймфрейме выше сигнальной (для покупок) или ниже (для продаж). MACD считается на подписке `MacdCandleType`, по умолчанию это месячные свечи, с настройками 12/26/9.
5. **Размер позиции** – каждый новый ордер имеет объём `Volume`. Совокупная позиция не превышает `Volume * MaxPositions`. При смене сигнала открытая позиция переворачивается одним рыночным ордером.
6. **Управление рисками** – сразу после входа сохраняются значения стопа и цели, рассчитанные из параметров `StopLossPips` и `TakeProfitPips`. На каждой закрывшейся свече проверяется, не были ли достигнуты уровни, и при необходимости позиция закрывается.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Volume` | Базовый торговый объём. Нормализуется по шагу объёма инструмента. | `1` |
| `CandleType` | Рабочий таймфрейм для расчётов. | `TimeSpan.FromMinutes(15).TimeFrame()` |
| `MacdCandleType` | Таймфрейм для подтверждения MACD. | `TimeSpan.FromDays(30).TimeFrame()` |
| `TrendConfirmationCount` | Число свечей, которые должны удерживаться по одну сторону EMA100. Аналог параметра `Count`. | `10` |
| `MomentumPeriod` | Период индикатора Momentum. | `14` |
| `MomentumThreshold` | Минимальное отклонение Momentum от уровня 100. | `0.3` |
| `StopLossPips` | Размер стоп-лосса в пунктах. | `20` |
| `TakeProfitPips` | Размер тейк-профита в пунктах. | `50` |
| `MaxPositions` | Максимальное количество базовых лотов в одном направлении. | `10` |

## Особенности реализации
- Используется высокоуровневое API: основная подписка привязывает EMA20/60/100 и Momentum, а отдельная – MACD по старшему таймфрейму через `BindEx`.
- Для имитации обращений к истории, присутствовавших в MQL, применяются кольцевые очереди. Это исключает прямой доступ к значениям индикаторов по индексам.
- Функция перевода пунктов в цену подбирает размер пункта из `PriceStep`, воспроизводя расчёт переменной `pips` в оригинале.
- Метод `StartProtection()` запускается при старте, чтобы активировать встроенные защитные механизмы фреймворка.

## Отличия от исходника
- Финансовые блоки (контроль общей прибыли/убытка, перевод в безубыток, пользовательский трейлинг) не перенесены. При необходимости их можно добавить поверх реализованной логики.
- Удалены уведомления по почте/Push и элементы оформления на графике.
- В StockSharp позиции агрегируются, поэтому `MaxPositions` ограничивает суммарный объём, а не количество отдельных сделок.

## Как использовать
1. Подключите стратегию к источнику данных, который предоставляет свечи для рабочего таймфрейма и для подтверждения MACD.
2. Настройте параметры под инструмент. Повышение `TrendConfirmationCount` или `MomentumThreshold` сделает сигналы более редкими.
3. Запустите стратегию – сделки будут открываться автоматически после закрытия свечи, когда все фильтры дают разрешение.

## Состав
- `CS/DayTradingStrategy.cs` – реализация на C#.
- `README.md` – описание на английском языке.
- `README_cn.md` – описание на китайском языке.
