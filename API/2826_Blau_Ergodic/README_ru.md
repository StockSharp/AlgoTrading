# Стратегия Blau Ergodic
[English](README.md) | [中文](README_cn.md)

Стратегия является портом советника **Exp_BlauErgodic** из MQL5. Осциллятор Blau Ergodic реконструируется путём тройного EMA-
сглаживания импульса и его абсолютного значения, после чего формируется нормализованная гистограмма и сигнальная линия. В
стратегии доступны три режима сигналов, полностью повторяющие оригинальную логику.

По умолчанию используются завершённые четырёхчасовые свечи. Можно выбрать источник цены (close, open, медианная, типичная,
взвешенная и т.п.), настроить глубины каждого сглаживания и указать номер бара (`SignalBar`), по которому считываются сигналы.
Объём сделок задаётся свойством `Volume`; входы/выходы в лонг и шорт можно отключать отдельными булевыми параметрами. Стоп-лосс
и тейк-профит задаются в пунктах и переводятся в абсолютные цены через `Security.PriceStep`.

## Режимы сигналов

- **Breakdown** – реагирует на пересечение нуля. Лонг открывается при переходе осциллятора из отрицательной зоны в положительную,
  шорт — при обратном переходе. Позиции закрываются, если осциллятор удерживается по другую сторону от нуля.
- **Twist** – ищет смену наклона. Лонговый сигнал появляется, когда на предыдущем баре осциллятор снижался, но на текущем
  разворачивается вверх; шорт требует зеркальной картины.
- **CloudTwist** – отслеживает пересечение осциллятора с сигнальной линией. Лонг активируется при пробое сигнального облака
  вверх, шорт — при обратном пробое вниз.

Во всех режимах значения индикатора берутся с бара, заданного `SignalBar` (по умолчанию `1`, то есть последний завершённый бар),
а для подтверждения используются более старые значения. Параметр `SignalBar` должен быть не меньше `1`, поскольку стратегия
работает только с закрытыми свечами.

## Правила входа и выхода

- **Лонг:** включается, если `AllowBuyEntry = true`, текущая позиция не длинная (`Position <= 0`) и активный режим выдаёт сигнал
  на покупку. При необходимости стратегия перекрывает шорт, покупая `Volume + |Position|`.
- **Шорт:** включается, если `AllowSellEntry = true`, текущая позиция не короткая (`Position >= 0`) и режим формирует сигнал на
  продажу. Перед открытием шорта перекрывается возможный лонг.
- **Выход из лонга:** происходит по сигналу режима либо при достижении `StopLossPoints` / `TakeProfitPoints`. Принудительное
  закрытие игнорирует флаг `AllowBuyExit`, чтобы защитные стопы всегда срабатывали.
- **Выход из шорта:** аналогично логике выхода из лонга, с учётом `AllowSellExit` и соответствующих стоп-уровней.

## Параметры

- `CandleType` – таймфрейм подписки на свечи (по умолчанию 4 часа).
- `Mode` – `Breakdown`, `Twist` или `CloudTwist`.
- `MomentumLength` – длина расчёта исходного импульса.
- `First/Second/ThirdSmoothingLength` – длины EMA в каскадах сглаживания импульса.
- `SignalSmoothingLength` – длина EMA сигнальной линии.
- `SignalBar` – номер завершённого бара для анализа (минимум `1`).
- `AppliedPrice` – источник цены для осциллятора (close, open, median, typical, weighted и т.д.).
- `AllowBuyEntry`, `AllowSellEntry`, `AllowBuyExit`, `AllowSellExit` – включение/отключение входов и выходов.
- `StopLossPoints`, `TakeProfitPoints` – защитные расстояния в пунктах (конвертируются через `Security.PriceStep`).

Конвертация использует высокоуровневый API StockSharp (`SubscribeCandles`, `Bind`), сохраняет поведение MQL5-версии и
следует требованиям по стилю: табуляция и комментарии на английском языке.
