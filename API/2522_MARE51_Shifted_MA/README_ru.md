# Стратегия MARE5.1 с смещёнными скользящими средними

## Обзор

**MARE5.1 с смещёнными скользящими средними** — порт оригинального советника MetaTrader 5 «MARE5.1» на высокоуровневый API StockSharp. Стратегия по умолчанию работает с минутными свечами (тип можно поменять) и сравнивает две простые скользящие средние (SMA), которым задан одинаковый сдвиг вперёд. Для подтверждения сигналов используются исторические значения SMA и направление последней закрытой свечи.

## Логика торговли

- Рассчитываются две SMA: быстрая и медленная. Обе смещаются на одинаковое количество баров вперёд, что повторяет логику оригинального советника.
- **Вход в короткую позицию** осуществляется при выполнении всех условий:
  1. На текущей свече медленная SMA минимум на один шаг цены выше быстрой SMA.
  2. Две свечи назад быстрая SMA минимум на один шаг цены была выше медленной.
  3. Пять свечей назад быстрая SMA минимум на один шаг цены была выше медленной.
  4. Последняя завершённая свеча (предыдущий бар) медвежья.
- **Вход в длинную позицию** — зеркальная ситуация:
  1. На текущей свече быстрая SMA минимум на один шаг цены выше медленной.
  2. Две свечи назад медленная SMA минимум на один шаг цены была выше быстрой.
  3. Пять свечей назад медленная SMA минимум на один шаг цены была выше быстрой.
  4. Предыдущая свеча бычья.
- Одновременно может быть открыта только одна позиция. Объём заявки задаётся параметром `TradeVolume`.
- Торговля разрешена только внутри заданного часового окна (границы включительно), что полностью повторяет проверку времени из исходного эксперта.

## Управление рисками

Фиксированные уровни тейк-профита и стоп-лосса сохранены. Значения задаются в «пунктах» (для инструментов с тремя и пятью знаками после запятой пункт автоматически увеличивается в 10 раз) и переводятся в абсолютные ценовые величины при запуске стратегии. Защитные ордера обслуживаются через `StartProtection` с выходом рыночными заявками.

## Индикаторы и данные

- **Быстрая SMA** — длина задаётся параметром `FastPeriod`.
- **Медленная SMA** — длина задаётся параметром `SlowPeriod`.
- **Источник данных** — по умолчанию минутные свечи, но через `CandleType` можно выбрать любой поддерживаемый тип свечей.

## Параметры

| Имя | Значение по умолчанию | Описание |
|-----|-----------------------|----------|
| `TradeVolume` | 0.01 | Объём сделки при входе в позицию. |
| `TakeProfitPips` | 35 | Расстояние до тейк-профита в корректированных пунктах. Ноль отключает тейк-профит. |
| `StopLossPips` | 55 | Расстояние до стоп-лосса в корректированных пунктах. Ноль отключает стоп-лосс. |
| `FastPeriod` | 14 | Период быстрой SMA. |
| `SlowPeriod` | 79 | Период медленной SMA. |
| `MovingAverageShift` | 4 | Сдвиг (в барах), применяемый к обеим SMA. |
| `SessionOpenHour` | 2 | Час начала торгового окна (0–23). |
| `SessionCloseHour` | 3 | Час окончания торгового окна (0–23), должен быть больше `SessionOpenHour`. |
| `CandleType` | минутные свечи | Тип свечей, используемый в расчётах. |

## Примечания

- Сигналы оцениваются только после закрытия свечи. Исторические значения SMA буферизуются внутри стратегии, чтобы воспроизвести чтение индикатора по индексам, как в MQL.
- Для проверки минимального расстояния между SMA используется шаг цены инструмента, что гарантирует разницу минимум в один тик.
- Стоп-лосс и тейк-профит рассчитываются от шага цены. Для инструментов с тремя и пятью знаками после запятой пункт автоматически увеличивается в десять раз, как и в MetaTrader.
- Стратегия не усредняет позиции и не строит сетки: новая сделка возможна только после полного закрытия текущей позиции.
- В данный каталог включена только C#-версия; Python-реализация для этой стратегии отсутствует.
