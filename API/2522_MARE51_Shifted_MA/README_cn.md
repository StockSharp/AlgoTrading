# MARE5.1 移位均线策略

## 概述

**MARE5.1 移位均线策略** 是 MetaTrader 5 专家顾问 “MARE5.1” 的 StockSharp 高级 API 版本。策略默认使用 1 分钟 K 线（可配置），对比具有相同前移偏移量的两条简单移动平均线（SMA），并利用历史 SMA 关系以及上一根蜡烛的方向来确认信号。

## 交易逻辑

- 策略同时计算快线和慢线两条 SMA，二者都应用相同的前移偏移量，从而复现原始 EA 的行为。
- **做空** 条件：
  1. 当前蜡烛上慢线至少比快线高一个最小价位。
  2. 两根蜡烛之前快线至少比慢线高一个最小价位。
  3. 五根蜡烛之前快线至少比慢线高一个最小价位。
  4. 最新完成的蜡烛（上一根）为阴线。
- **做多** 条件为上述条件的镜像：
  1. 当前蜡烛上快线至少比慢线高一个最小价位。
  2. 两根蜡烛之前慢线至少比快线高一个最小价位。
  3. 五根蜡烛之前慢线至少比快线高一个最小价位。
  4. 最新完成的蜡烛（上一根）为阳线。
- 同一时间只允许持有一笔仓位，默认下单数量由 `TradeVolume` 参数控制。
- 只有在设定的交易时间窗口（包含起止小时）内才会开仓，完全还原原始 EA 中按小时过滤交易的逻辑。

## 风险控制

策略保留了原始版本的固定止盈与止损距离。`TakeProfitPips` 与 `StopLossPips` 以“点”（对三位和五位小数报价会自动放大 10 倍）表示，并在启动时转换为绝对价格距离。通过 `StartProtection` 使用市价单方式管理保护性平仓。

## 指标与数据

- **快线 SMA** – 周期由 `FastPeriod` 决定。
- **慢线 SMA** – 周期由 `SlowPeriod` 决定。
- **数据源** – 默认使用 1 分钟蜡烛，可通过 `CandleType` 参数选择任意 StockSharp 支持的蜡烛类型。

## 参数

| 名称 | 默认值 | 说明 |
|------|--------|------|
| `TradeVolume` | 0.01 | 每次进场的下单数量。 |
| `TakeProfitPips` | 35 | 止盈距离（调整后的点数）。设为 0 可禁用。 |
| `StopLossPips` | 55 | 止损距离（调整后的点数）。设为 0 可禁用。 |
| `FastPeriod` | 14 | 快线 SMA 的周期。 |
| `SlowPeriod` | 79 | 慢线 SMA 的周期。 |
| `MovingAverageShift` | 4 | 应用于两条 SMA 的前移位移（单位：根数）。 |
| `SessionOpenHour` | 2 | 允许交易的起始小时（0–23）。 |
| `SessionCloseHour` | 3 | 允许交易的结束小时（0–23），必须大于 `SessionOpenHour`。 |
| `CandleType` | 1 分钟蜡烛 | 策略使用的蜡烛数据类型。 |

## 备注

- 策略仅在蜡烛收盘后评估信号。内部缓冲 SMA 历史值，以复现原始 MQL 代码中按索引读取指标的方式。
- 使用标的的最小价格跳动（PriceStep）来比较两条 SMA 的差距，确保满足至少一个最小价位的要求。
- 止盈止损基于最小价格跳动计算，对三位与五位报价自动将点值放大 10 倍，与 MetaTrader 的处理方式一致。
- 策略不会加仓或网格化，必须等待当前仓位全部平掉后才会寻找下一次入场机会。
- 本目录仅包含 C# 实现版本，本策略暂未提供 Python 版本。
