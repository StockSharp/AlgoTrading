# Lilith Goes To Hollywood 策略

## 概述
本策略把 MetaTrader 专家顾问 “Lilith goes to Hollywood” 移植到 StockSharp 的高层 API。它实现了一套对冲网格，提供两种截然不同的工作模式：

* **自动模式** – 使用抛物线 SAR 指标（加速 0.02 / 最大加速 0.2）触发市价开仓。
* **手动模式** – 在用户给定的参考价格附近挂入买卖止损/限价单，等待行情触发。

无论在哪种模式下，策略都会分别统计多头与空头的成交量，计算当前网格的浮动盈亏，并据此决定何时加码或对冲。

## 运行模式
* **自动模式**：当没有持仓时，策略根据抛物线 SAR 信号在每根已完成 K 线收盘后立即下单。价格高于 SAR 时买入，价格低于 SAR 时卖出。成交价定义为新的 **焦点价格（Focus）**，后续的恢复单会按照锚点距离围绕该价格布置。
* **手动模式**：当没有持仓时，每一侧仅保留一个挂单。若市场价格低于 `PriceUp`，则挂买入止损单；若价格高于该水平，则改为买入限价单。卖出方向围绕 `PriceDown` 采用相同规则。挂单成交后，另一侧会继续保持，除非被手动取消或被策略逻辑关闭。

## 订单管理逻辑
* 策略持续追踪多空实仓量及买卖挂单量，用于衡量两侧的失衡程度。
* 当浮动利润达到动态目标（账户价值 / 1000）时，策略会平掉全部仓位并撤销所有挂单。
* 当浮亏低于 `-AccountValue * RiskPercent / 100` 时，会触发紧急对冲，在市价上补齐净敞口以锁定风险。
* 恢复单通过止损单实现，价格围绕焦点（自动模式）或手动设置的价格分布，数量按照 `(对侧仓位 * XFactor) - 当前仓位` 计算，完全复刻原 MT4 网格的加码方式。

## 参数
| 名称 | 说明 |
| --- | --- |
| `Automated` | 是否启用抛物线 SAR 驱动的自动开仓。关闭后进入手动挂单模式。 |
| `PriceUp` | 手动模式下用于生成买入止损/限价单的参考价格。 |
| `PriceDown` | 手动模式下用于生成卖出止损/限价单的参考价格。 |
| `AnchorSteps` | 以价格步长为单位的锚点距离，用于计算恢复单的上下偏移。 |
| `ManualVolume` | 手动模式或动态仓位算法返回零时使用的基础手数。 |
| `XFactor` | 计算恢复单数量时乘以对侧仓位的系数。 |
| `RiskPercent` | 触发紧急对冲前允许的最大浮亏，占账户价值的百分比。 |
| `CandleType` | 用于驱动指标与管理逻辑的时间框架。 |

## 风险控制
* 盈利目标随账户权益自动调节，账户增长时目标也随之提高。
* 当浮亏超过 `RiskPercent` 阈值时会自动对冲，防止网格在单边行情中失控。
* 所有挂单价格都会按最小跳动价对齐，交易数量也会根据交易所限制进行修正，与原始 MT4 专家顾问保持一致的保护机制。

## 转换说明
* MetaTrader 的逐笔调用被转换为基于已完成 K 线的处理，默认使用 1 分钟周期以保持灵敏度，可通过 `CandleType` 参数调整。
* MQL 脚本中的 `Anchor` 以“点”为单位，这里改为“价格步长数量”，从而可以自动适配标的的最小报价单位。
* 原脚本中的 `Comment` 输出被替换为 `LogInfo` 日志，方便在 StockSharp 的日志系统中查看运行状态。
