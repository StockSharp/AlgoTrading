# Стратегия E-Skoch-Open (порт на StockSharp)

## Общее описание
**E-Skoch-Open** — это перенос оригинального советника MetaTrader 5, основанного на простом ценовом паттерне из трёх свечей. В версии для StockSharp расчёты выполняются после закрытия каждой свечи: анализируется последовательность недавних закрытий и при появлении нужной конфигурации открывается позиция. Риски контролируются фиксированными уровнями стоп-лосса и тейк-профита, задаваемыми в «приведённых» пунктах (pip), а также глобальной целью по росту капитала. Объём позиций формируется по схеме мартингейла: убыточная сделка увеличивает размер следующей позиции в 1.6 раза, прибыльная — возвращает объём к исходному значению.

## Логика работы
1. Используется таймфрейм, указанный в параметре `CandleType` (по умолчанию 1 час).
2. Стратегия ждёт появления минимум трёх завершённых свечей.
3. **Сигнал на покупку**: если `Close[n-3] > Close[n-2]` и `Close[n-1] < Close[n-2]`, а длинные сделки разрешены.
4. **Сигнал на продажу**: если `Close[n-3] > Close[n-2]` и `Close[n-2] < Close[n-1]`, а короткие сделки разрешены.
5. При активном `CloseOnOppositeSignal` встречный сигнал сначала закрывает текущую позицию и до конца свечи новые сделки не открываются.
6. При открытии позиции рассчитываются уровни стоп-лосса и тейк-профита от текущего закрытия. Если максимум/минимум последующих свечей достигает заданного уровня, позиция закрывается.
7. Одновременно контролируется капитал портфеля. Как только рост относительно последнего момента без позиции превысит `TargetProfitPercent`, стратегия закрывает все сделки.
8. После убыточной сделки объём следующей позиции умножается на 1.6, после прибыльной — сбрасывается к базовому значению. Объём корректируется под шаг, минимум и максимум инструмента (`VolumeStep`, `VolumeMin`, `VolumeMax`).

## Параметры
| Параметр | Описание |
| --- | --- |
| `CandleType` | Таймфрейм, по которому ищется паттерн (любые свечи, поддерживаемые StockSharp). |
| `InitialOrderVolume` | Базовый объём первой сделки (по умолчанию 0.01). |
| `StopLossPoints` | Дистанция стоп-лосса в приведённых пунктах: для инструментов с 5 или 3 знаками после запятой используется `PriceStep * 10`, иначе `PriceStep`. |
| `TakeProfitPoints` | Дистанция тейк-профита, рассчитывается аналогично стоп-лоссу. |
| `EnableBuySignals` / `EnableSellSignals` | Включение/выключение сделок в длинную или короткую сторону. |
| `MaxBuyTrades` / `MaxSellTrades` | Максимальное число последовательных сделок в каждом направлении (`-1` снимает ограничение). В порте по умолчанию используется одна чистая позиция на направление. |
| `TargetProfitPercent` | Процент роста капитала, после которого закрываются все позиции (по умолчанию 1.2%). |
| `CloseOnOppositeSignal` | При активации встречный сигнал немедленно закрывает позицию перед поиском новых входов. |

## Важные замечания по рискам
- Уровни стопа и профита проверяются по экстремумам закрывшихся свечей. В реальном исполнении сервер MetaTrader может обрабатывать лимитные/стоп-заявки внутри бара, что даёт расхождения.
- Множитель мартингейла 1.6 быстро увеличивает объёмы при серии убытков. Убедитесь, что ограничения инструмента (`VolumeMax`) и размер счёта позволяют выдержать максимальную позицию.
- Триггер по росту капитала требует актуального значения `Portfolio.CurrentValue` от брокера или тестовой среды.

## Рекомендации
- Подберите `CandleType`, соответствующий исходной настройке советника.
- Настройте `StopLossPoints` и `TakeProfitPoints` в соответствии с волатильностью инструмента — пересчёт в пункты выполняется автоматически.
- При запрете хеджирования у брокера можно отключить одну из сторон торговли.
- Перед длительными тестами оцените потенциальный рост объёма при использовании мартингейла и целевого профита по капиталу.
