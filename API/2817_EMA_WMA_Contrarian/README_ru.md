# Контртрендовая стратегия EMA WMA
[English](README.md) | [中文](README_cn.md)

Контртрендовая система, сравнивающая экспоненциальную (EMA) и взвешенную (WMA) скользящие средние, рассчитанные по ценам открытия свечей. Когда быстрая EMA опускается ниже WMA, стратегия покупает в расчёте на возврат цены. Когда EMA снова поднимается выше WMA, открывается короткая позиция. Размер сделки определяется процентом риска и расстоянием до защитного стопа, а также дополняется фиксированным стоп-лоссом, тейк-профитом и трейлинг-стопом.

## Детали

- **Условия входа**:
  - Лонг: EMA(Open) пересекает WMA(Open) сверху вниз
  - Шорт: EMA(Open) пересекает WMA(Open) снизу вверх
- **Направление**: Лонг и шорт
- **Условия выхода**:
  - Фиксированный стоп-лосс в шагах цены
  - Фиксированный тейк-профит в шагах цены
  - Трейлинг-стоп, который подтягивается после движения цены на `TrailingStopPoints + TrailingStepPoints`
  - Противоположный сигнал закрывает текущую позицию и открывает новую
- **Стопы**: Стоп-лосс, тейк-профит и трейлинг-стоп
- **Значения по умолчанию**:
  - `EmaPeriod` = 28
  - `WmaPeriod` = 8
  - `StopLossPoints` = 50m
  - `TakeProfitPoints` = 50m
  - `TrailingStopPoints` = 50m
  - `TrailingStepPoints` = 10m
  - `RiskPercent` = 10m
  - `BaseVolume` = 1m
  - `CandleType` = TimeSpan.FromMinutes(1).TimeFrame()
- **Фильтры**:
  - Категория: Скользящие средние, контртренд
  - Направление: Лонг и шорт
  - Индикаторы: EMA (open), WMA (open)
  - Стопы: Да (жёсткий стоп и трейлинг)
  - Сложность: Средняя
  - Таймфрейм: Внутридневной (по умолчанию 1 минута)
  - Сезонность: Нет
  - Нейросети: Нет
  - Дивергенция: Нет
  - Уровень риска: Средний

## Параметры

| Параметр | Описание |
| --- | --- |
| `EmaPeriod`, `WmaPeriod` | Периоды EMA и WMA, рассчитанных по ценам открытия свечей. |
| `StopLossPoints`, `TakeProfitPoints` | Расстояние в шагах цены до защитного стопа и тейк-профита. |
| `TrailingStopPoints` | Расстояние между ценой и трейлинг-стопом после активации. |
| `TrailingStepPoints` | Дополнительное прибыльное движение, необходимое для подтяжки трейлинг-стопа. Должно быть положительным при включённом трейлинге. |
| `RiskPercent` | Процент капитала портфеля, которым рискуем в одной сделке. Объём позиции вычисляется как `RiskPercent / (StopLossPoints * PriceStep)`. |
| `BaseVolume` | Минимальный объём сделки, если расчёт по риску невозможен. |
| `CandleType` | Тип свечей для расчётов (по умолчанию минутные). |

## Примечания

- Обе скользящие средние используют цены открытия, что повторяет логику оригинального эксперта MetaTrader.
- Трейлинг-стоп активируется только после движения в нашу сторону не менее чем на `TrailingStopPoints + TrailingStepPoints`, как и в исходной реализации.
- Если задан `TrailingStopPoints`, но `TrailingStepPoints` равен нулю или отрицателен, стратегия сразу остановится, чтобы избежать некорректной работы трейлинга.
- Если стоимость портфеля, шаг цены или расстояние стопа недоступны, расчёт объёма откатывается к значению `BaseVolume`.
