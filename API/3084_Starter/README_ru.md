# Стратегия Starter

**Starter** — порт оригинального советника MetaTrader 5 «Starter (barabashkakvn's edition)». Алгоритм отслеживает выход индекса товарного канала (CCI) из зоны перепроданности или перекупленности и подтверждает сигнал наклоном длинной скользящей средней. Когда импульс совпадает с направлением трендового фильтра, стратегия открывает одну рыночную позицию с объёмом, рассчитанным по доле риска от капитала. Стоп-лосс и ступенчатое сопровождение воспроизводят правила управления капиталом исходного эксперта.

## Логика торговли

- **Трендовый фильтр** — настраиваемая скользящая средняя должна расти быстрее `MaDelta`, чтобы разрешить покупки, и падать быстрее `MaDelta`, чтобы разрешить продажи. Поддерживаются те же методы сглаживания, что и в MQL (простая, экспоненциальная, сглаженная, линейно-взвешенная).
- **Подтверждение CCI** — CCI анализируется только на закрытых свечах. Пересечение уровня `-CciLevel` снизу вверх формирует длинный сигнал, пересечение `CciLevel` сверху вниз — короткий.
- **Одна позиция** — стратегия не открывает новых сделок, пока не закроет текущую, что отражает фильтрацию по символу и magic number в оригинале.

### Условия входа

1. Дождаться закрытия свечи.
2. Получить значения скользящей средней на текущем и предыдущем сдвиге.
3. Получить значения CCI на текущем и предыдущем сдвиге.
4. **Покупка** выполняется, если:
   - Разница между текущей и предыдущей MA превышает `MaDelta`.
   - Текущий CCI выше предыдущего.
   - CCI пересекает `-CciLevel` снизу вверх.
5. **Продажа** выполняется, если:
   - Разница между MA меньше `-MaDelta`.
   - Текущий CCI ниже предыдущего.
   - CCI пересекает `CciLevel` сверху вниз.

### Условия выхода

- **Первичный стоп-лосс** — при `StopLossPips > 0` стоп рассчитывается как цена входа ± `StopLossPips * PriceStep`.
- **Трейлинг-стоп** — если заданы `TrailingStopPips` и `TrailingStepPips`, стоп передвигается всякий раз, когда цена улучшается минимум на заданный шаг. Для лонга стоп = `Close - TrailingStop`, для шорта = `Close + TrailingStop`.
- **Принудительное закрытие** — при достижении уровня стопа внутри свечи позиция закрывается рыночной заявкой, а защитные уровни сбрасываются.

## Управление рисками

- **Размер позиции** — базовый объём равен `Portfolio.CurrentValue * MaximumRisk / price`. Если значение капитала недоступно, используется свойство `Volume` (по умолчанию 1).
- **Снижение объёма после убытков** — после двух и более убыточных сделок подряд объём уменьшается на `volume * losses / DecreaseFactor`. Любая прибыльная сделка обнуляет счётчик.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `MaximumRisk` | `0.02` | Доля капитала, которая рискуется в одной сделке. |
| `DecreaseFactor` | `3` | Коэффициент уменьшения объёма после серии убытков. |
| `CciPeriod` | `14` | Период расчёта CCI. |
| `CciLevel` | `100` | Порог перепроданности/перекупленности для CCI. |
| `CciCurrentBar` | `0` | Сдвиг текущего значения CCI. |
| `CciPreviousBar` | `1` | Сдвиг предыдущего значения CCI. |
| `MaPeriod` | `120` | Период трендовой скользящей средней. |
| `MaMethod` | `Simple` | Метод сглаживания MA (Simple, Exponential, Smoothed, LinearWeighted). |
| `MaCurrentBar` | `0` | Сдвиг скользящей средней. |
| `MaDelta` | `0.001` | Минимальный прирост наклона между текущей и предыдущей MA. |
| `StopLossPips` | `0` | Дистанция первичного стоп-лосса в пунктах. |
| `TrailingStopPips` | `5` | Базовая дистанция трейлинг-стопа в пунктах. |
| `TrailingStepPips` | `5` | Минимальное улучшение цены для передвижения трейлинг-стопа. |
| `CandleType` | таймфрейм `30m` | Тип свечей, используемый стратегией. |

## Особенности реализации

- Значения индикаторов кэшируются для доступа по сдвигам, что соответствует работе с буферами в MQL.
- Размер пункта вычисляется из `Security.PriceStep`; если биржа не предоставляет корректный шаг цены, защитные приказы отключаются.
- Все комментарии в коде написаны на английском языке согласно требованиям репозитория.
- Python-версия намеренно отсутствует по просьбе задания.
