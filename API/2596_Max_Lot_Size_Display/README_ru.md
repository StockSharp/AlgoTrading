# Стратегия Max Lot Size Display

## Обзор
Стратегия представляет собой порт индикатора MetaTrader 5 **EXP_MAX_LOT** на платформу StockSharp. Оригинальный скрипт показывал максимально возможный размер позиции при текущем свободном маржинальном обеспечении. В StockSharp версия сохраняет ту же цель: постоянно оценивать допустимый объем заявки в выбранном направлении, чтобы не превысить доступные средства.

В отличие от классических торговых систем стратегия не отправляет ордера. Она работает как помощник по управлению рисками и пересчитывает результат на каждой завершённой свече выбранного таймфрейма. Значение записывается в журнал и сохраняется в свойстве `Volume`, благодаря чему его могут использовать другие компоненты автоматизации.

## Параметры
- **Trade Direction** – направление (`Buy` или `Sell`), для которого вычисляется максимальный объем. Аналог входного параметра `PosType` в исходнике MQL.
- **Risk Fraction** – множитель, применяемый к свободному капиталу перед расчётом. Соответствует аргументу `Money_Management` в MQL. Значение `1.0` использует всю свободную маржу, меньшие значения оставляют резерв.
- **Label Prefix** – текстовый префикс, добавляемый к информационным сообщениям в журнале. Сохраняет стиль подписи индикатора (`MAX_LOT_Label_`).
- **Candle Type** – источник свечных данных, который инициирует пересчёт. В оригинале обновление происходило на каждом тике; здесь расчёт выполняется после закрытия свечи выбранного типа, что соответствует высокоуровневому API.

## Логика работы
1. Подписаться на свечи, заданные параметром **Candle Type**, и ждать их закрытия.
2. При каждом обновлении:
   - Определить стоимость портфеля (текущее значение или стартовое, если текущего нет).
   - Умножить капитал на **Risk Fraction**, получив доступные средства.
   - Рассчитать маржу на единицу объема для выбранного **Trade Direction**. При наличии биржевых данных (`MarginBuy`/`MarginSell`) они используются напрямую, иначе применяется оценка по цене закрытия и `VolumeStep` инструмента.
   - Нормализовать результат к биржевому шагу объема и учесть ограничения `MinVolume`/`MaxVolume`.
3. Сохранить итог в `Volume` и вывести строку в журнал. При недостатке средств формируется предупреждение.

Логика повторяет ключевые функции исходного файла `.mq5` (`LotCount`, `LotCorrect`, `LotFreeMarginCorrect`, `GetLotForOpeningPos`), но опирается на свойства сущностей StockSharp.

## Особенности реализации
- Обрабатываются только закрытые свечи в соответствии с требованиями высокоуровневых стратегий.
- Отступы сделаны табуляцией, комментарии на английском – по правилам репозитория.
- Если отсутствуют данные по марже и цене, стратегия возвращает нулевой объем и фиксирует предупреждение.
- В `OnStarted` вызывается `StartProtection()`, что соответствует принятому в примерах защитному шаблону.

## Использование
Запустите стратегию на нужном инструменте и настройте параметры в соответствии с требованиями риск-менеджмента. В журнале будут появляться сообщения вида:

```
MAX_LOT_Label_: Maximum volume for Buy = 2.5
```

Это значение также доступно через свойство `Volume`, что позволяет автоматизировать выбор размера заявки в других частях системы.
