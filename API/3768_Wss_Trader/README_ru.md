# Wss Trader

Порт эксперта MetaTrader 4 «Wss_trader» с сайта forex-instruments.info. Первоначальная версия использует уровни Камариллы и классические пивоты, открывая не более одной сделки за свечу, когда цена пробивает расчётные границы в рабочее время.

## Логика стратегии

1. В начале каждого нового торгового дня считываются максимум, минимум и закрытие предыдущих суток для построения лестницы уровней:
   - `Pivot = (High + Low + Close) / 3`
   - `Long entry = Pivot + Metric × point`
   - `Short entry = Pivot − Metric × point`
   - `Long stop = Short entry`
   - `Short stop = Long entry`
   - Цели повторяют формулы MetaTrader `Close ± (High − Low) × 1.1 / 2` с тем же ограничителем, что и в оригинальном коде.
2. Торговля разрешена только между `Start Hour` и `End Hour` (включительно). Вне окна открытая позиция немедленно закрывается.
3. Если закрытие свечи пересекает длинный уровень (текущее закрытие ≥ уровень и предыдущее закрытие < уровень), стратегия покупает один раз указанным объёмом, фиксирует рассчитанные стоп и тейк, а также блокирует повторные входы на текущей свече. Для коротких сигналов действует зеркальное правило.
4. При положительном движении не менее `Trailing Points` шагов цены стоп подтягивается, сохраняя расстояние до закрытия, и никогда не отходит назад.

## Параметры

| Имя | Описание | Значение по умолчанию |
| --- | -------- | --------------------- |
| `Working Candle` | Тип свечей для внутридневных расчётов. | `15 Minute` |
| `Daily Candle` | Тип свечей для чтения предыдущего дня. | `1 Day` |
| `Start Hour` | Час (0-23), с которого разрешена торговля. | `8` |
| `End Hour` | Час (0-23), после которого новые сделки запрещены. | `16` |
| `Metric Points` | Расстояние от пивота до уровней пробоя в шагах цены. | `20` |
| `Trailing Points` | Дистанция трейлинг-стопа в шагах цены (`0` отключает трейлинг). | `20` |
| `Order Volume` | Объём заявки, соответствующий параметру `lots` из MQL. | `0.1` |

## Примечания

- Позиция закрывается сразу после завершения торгового окна, как и в оригинальном советнике.
- Трейлинг рассчитывается по закрытым свечам: внутрибарая подтяжка не воспроизводится, поскольку порт работает на данных закрытия.
- На каждой свече допускается только один вход, что соответствует флагу `tenb` в исходнике.
