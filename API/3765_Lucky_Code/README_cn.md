# Lucky Code 策略
[English](README.md) | [Русский](README_ru.md)

Lucky Code 源自 MetaTrader 的「Lucky_code」专家顾问，是一套超短线突破型剥头皮策略。它实时监控买卖价差的极值，当最优卖价相对上一笔报价跃升、或最优买价下挫超过设定的点数距离时立即出手。策略的持仓管理非常激进：行情一旦朝有利方向跳动就平仓锁定利润，若出现超过阈值的不利波动则立即止损。

## 数据与执行

- **市场数据**：需要 Level 1 报价流以获取最新的最优买价和卖价。
- **委托类型**：所有进出场均使用市价单，完整复刻 MQL 版本的逐笔执行方式。
- **持仓模式**：兼容净额和锁仓账户。多笔成交会合并为单一净持仓并按整体处理。

## 参数

- **Shift points** – 连续两笔报价之间触发交易所需的最小点数差。数值越大，交易频率越低，噪声过滤越强。
- **Limit points** – 容许的最大不利点数。一旦亏损幅度超过该数值，仓位将被强制平掉。该参数会根据标的的最小价位单位转换为实际价格距离。

## 交易逻辑

1. **初始化**
   - 使用品种的最小变动价位将点数参数换算成真实价格距离。
   - 订阅 Level 1 数据，并清空内部记录的上一笔买、卖价。
2. **入场规则**
   - 当最优卖价相较前一笔报价上跳至少指定点数时，策略建立空头仓位（与原版 EA 在上冲后做空的逻辑一致）。
   - 当最优买价较前一笔报价下挫达到同样的点数时，策略建立多头仓位，博取反弹。
3. **仓位大小**
   - 以策略的 `Volume` 属性作为默认下单数量。
   - 如果能够获取到投资组合市值，会将数量调整为 `round(Equity / 10,000, 1)` 手，以模拟 MetaTrader 中 `AccountFreeMargin/10000` 的头寸分配。
4. **出场规则**
   - 多头仓位在买价高于平均建仓价时立即平仓；若卖价跌破建仓价达到限额，也会强制止损。
   - 空头仓位在卖价低于建仓价时立即平仓；若买价上穿建仓价达到限额，则触发止损。

## 实践提示

- 策略对每一次报价变动都做出响应，实盘时可适当增大 Shift 参数或对高噪声行情做节流处理。
  - 使用市价单意味着需要较好的流动性，以避免行情剧烈波动时的滑点风险。
- 建议结合额外的组合风险管理（如日内止损、最大回撤限制、持仓数量上限）共同使用。
