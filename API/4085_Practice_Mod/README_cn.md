# Practice Mod Strategy (ID 4085)

## 概述
- 来自 MetaTrader 4 专家顾问 **PracticeMod.mq4** 的移植版本，用于训练手动下单和持仓管理。
- 把图表上的水平/垂直线命令改写为目录中的指令文件，使得在 StockSharp 中也能保持交互式工作流程。
- 使用高级 API：烛线订阅提供稳定的轮询节奏，Level-1 报价负责止盈、止损和跟踪止损的执行。

## 操作流程
1. **入场** – 在 `<CommandDirectory>/<EntryFileName>`（默认 `entry.txt`）写入单个价格。若该价格高于当前买价则触发买入，反之触发卖出。文件在读取后立即删除。
2. **修改保护位** – 持仓期间将目标价格写入 `<CommandDirectory>/<ModifyFileName>`（默认 `modify.txt`）。价格高于买价时，更新为空头的止损或多头的止盈；价格低于买价时，更新为空头的止盈或多头的止损。可以写多行，系统会依次处理。
3. **手动平仓** – 新建 `<CommandDirectory>/<CloseFileName>`（默认 `close.txt`）会在下一次数据更新时关闭全部仓位。若当前无仓位则忽略。
4. **移动止损** – `TrailingStopPips` 大于零时启用，Level-1 报价在价格向有利方向移动超过设定点数后收紧止损。算法完全仿照原版：多头只向上移动，空头只向下移动，且不会放宽用户手动设定的水平。

所有指令文件都必须使用带小数点的价格格式（例如 `1.2345`）。文件在处理后会被删除，因此每条命令应只写一次。

## 参数
- `Volume` – 市价单的下单手数。
- `TakeProfitPips` – 开仓后立即应用的初始止盈距离（点）。
- `StopLossPips` – 开仓后立即应用的初始止损距离（点）。
- `TrailingStopPips` – 跟踪止损距离，设为 `0` 即可关闭跟踪功能。
- `CommandDirectory` – 存放指令文件的目录，策略启动时会自动创建。
- `EntryFileName` – 入场命令文件名。
- `ModifyFileName` – 调整止盈/止损命令文件名。
- `CloseFileName` – 触发手动平仓的文件名。
- `CandleType` – 用于在行情停滞时保持轮询节奏的烛线类型。

## 细节与差异
- 入场和平仓均使用 `BuyMarket` / `SellMarket` 市价单，保持与 MT4 版本同样的即时执行体验。
- 止盈与止损存储在内部变量中，达到目标时通过市价单离场，而不是登记附带的止损/止盈委托。
- 解析指令时会忽略空行，并在日志中报告无效数值，但不会中断策略。
- 当存在持仓或活动委托时，新入场命令会被忽略，遵循原脚本“一次只管理一笔交易”的限制。
- 收到平仓命令或保护触发后会设置标志位，防止在成交确认前重复提交平仓单。
