# Practice Mod Strategy (ID 4085)

## Описание
- Порт эксперта MetaTrader 4 **PracticeMod.mq4**, предназначенного для тренировки ручного управления сделками.
- Вместо горизонтальных и вертикальных линий на графике использует управляющие файлы в каталоге, что делает сценарий удобным в экосистеме StockSharp.
- Задействует высокоуровневые подписки: свечи обеспечивают периодический опрос команд, а поток level-1 отвечает за выходы и траление стопов.

## Последовательность работы
1. **Вход** – создайте файл `<CommandDirectory>/<EntryFileName>` (по умолчанию `entry.txt`) с одной ценой. Если значение выше текущего Bid, стратегия покупает, если ниже – продаёт. После чтения файл удаляется.
2. **Коррекция защитных уровней** – при открытой позиции запишите цену в `<CommandDirectory>/<ModifyFileName>` (по умолчанию `modify.txt`). Значение выше Bid станет новым стоп-лоссом для шорта или тейк-профитом для лонга. Значение ниже Bid превращается в тейк-профит для шорта или стоп-лосс для лонга. Допускается несколько строк; каждая обрабатывается последовательно.
3. **Принудительное закрытие** – размещение `<CommandDirectory>/<CloseFileName>` (по умолчанию `close.txt`) инициирует полное закрытие позиции при ближайшем обновлении данных. Если позиции нет, запрос игнорируется.
4. **Трейлинг-стоп** – при положительном `TrailingStopPips` стоп сдвигается вслед за ценой, как в оригинале: в лонге только вверх, в шорте только вниз. Если пользователь смещал уровни вручную, алгоритм лишь ужесточает их и никогда не расширяет.

Все файлы команд должны содержать цены в десятичном формате с точкой (`1.2345`). После обработки файлы удаляются, поэтому каждое действие следует отправлять однократно.

## Параметры
- `Volume` – объём рыночных заявок.
- `TakeProfitPips` – исходный тейк-профит в пунктах, выставляется сразу после входа.
- `StopLossPips` – исходный стоп-лосс в пунктах, также устанавливается после открытия сделки.
- `TrailingStopPips` – шаг трейлинг-стопа в пунктах; значение `0` отключает траление.
- `CommandDirectory` – каталог, в котором хранится тройка управляющих файлов. Создаётся автоматически при запуске.
- `EntryFileName` – имя файла с командами входа.
- `ModifyFileName` – имя файла для изменения стопов и тейков.
- `CloseFileName` – имя файла, инициирующего принудительное закрытие.
- `CandleType` – тип свечей, используемый только для периодического опроса каталога при отсутствии рыночных тиков.

## Особенности и отличия от MQL-версии
- Для входа и выхода применяются рыночные приказы (`BuyMarket` / `SellMarket`), что повторяет мгновенное исполнение оригинального советника.
- Стопы и тейки хранятся во внутренних переменных; при достижении уровня позиция закрывается по рынку, а не через связанные стоп-заявки.
- Парсер команд пропускает пустые строки и выводит предупреждение для некорректных значений, не прерывая работу стратегии.
- Новые команды входа игнорируются, пока уже есть позиция или активные заявки, что сохраняет ограничение «одна сделка» из PracticeMod.
- После получения команды закрытия или срабатывания защиты выставляется флаг, предотвращающий повторную отправку приказов до фактического исполнения.
