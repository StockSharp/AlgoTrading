# TDSGlobal 4

## Обзор
TDSGlobal 4 — это порт MetaTrader 4 советника «TDSGlobal 4» на платформу StockSharp. Оригинальная система опирается на концепцию
тройного экрана Александра Элдера: направление определяется по наклону дневного MACD (гистограмма/OsMA), а пуски сделок разрешаютс
я только при согласии с показаниями Williams %R. После фильтрации стратегия выставляет стоповые заявки за максимумом и минимумом пр
ошлого дня. Перенос сохраняет исходную логику пробоя, добавляет точное минутное расписание для разных валютных пар и расширяет упр
авление позицией за счёт настраиваемого трейлинг-стопа и фиксированного тейк-профита.

## Логика стратегии
### Фильтры старшего таймфрейма
* **Наклон MACD** – сравниваются два последних завершённых значения основной линии MACD на дневном графике (EMA 12/26, сигнал 9).
Если текущее значение выше предыдущего, считается восходящее направление; если ниже — нисходящее; равенство трактуется как отсутствие
 тренда.
* **Williams %R** – рассчитывается дневной Williams %R с периодом 24. Длинные заявки разрешаются только если показатель выше верхне
го порога (по умолчанию −25), короткие — только если ниже нижнего порога (по умолчанию −75).

### Размещение пробойных заявок
* **Уровни** – после закрытия каждой дневной свечи запоминаются максимум и минимум предыдущего дня. Новые стоповые заявки ставятся
на расстоянии одного пункта за этими экстремумами (параметр *EntryBufferPips*) в полном соответствии с исходным советником.
* **Контроль расстояния** – перед отправкой заявки проверяется минимальный зазор между лучшим котированием и ценой входа. Значение
*MinDistancePips* (по умолчанию 16 пунктов) повторяет проверку `Ask + 16*Point` и не даёт ставить заявки слишком близко к рынку.
* **Фильтрация по направлению** – buy-stop создаётся только при положительном наклоне MACD и «бычьем» Williams %R; sell-stop появляет
ся только при отрицательном наклоне и подтверждении «медвежьего» состояния осциллятора.

### Обслуживание отложенных заявок
* **Ежедневный сброс** – при появлении новой дневной свечи все неисполненные заявки снимаются, чтобы следующий торговый день начиналс
я «с чистого листа». Если фильтры не дают сигнала, ордера в этот день не выставляются.
* **Одна попытка в день** – после оценки условий в текущий день (заявки выставлены или пропущены) стратегия ждёт следующего дневного
 закрытия. При исполнении стоп-заявки противоположная немедленно отменяется, исключая одновременные длинные и короткие позиции.

### Управление рисками
* **Защитные стопы** – длинные позиции контролируют минимум прошлого дня (стоп размещается немного ниже), короткие – максимум (стоп вы
ше). Проверка выполняется на минутном потоке свечей.
* **Тейк-профит** – необязательная фиксированная цель в пунктах относительно фактической цены входа. Значение `0` для *TakeProfitPips*
 отключает цель аналогично настройке MT4.
* **Трейлинг-стоп** – при положительном значении *TrailingStopPips* стратегия подписывается на поток Level1, отслеживает лучшие Bid/Ask
и тянет стоп вслед за движением. При возврате цены к трала позиция закрывается рыночной заявкой.

### Расписание
* **Минутные окна** – чтобы несколько инструментов не ставили заявки одновременно, советник распределял минуты: USDCHF работает на 0/8/
16/24/32/40/48-й минуте часа, GBPUSD на 2/10/18/26/34/42/50-й, USDJPY на 4/12/20/28/36/44/52-й, EURUSD на 6/14/22/30/38/46/54-й. Для ос
тальных инструментов разрешены все минуты (0–59).
* **Триггерный поток** – подписка на минутные свечи управляет как расписанием, так и проверкой стопов/тейков внутри дня. Проверка ус
ловий выполняется только один раз в первый подходящий промежуток.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `Volume` | Объём стоповых заявок. | `1` |
| `MacdFastPeriod` / `MacdSlowPeriod` / `MacdSignalPeriod` | Настройка MACD для оценки наклона. | `12 / 26 / 9` |
| `WilliamsPeriod` | Период расчёта Williams %R. | `24` |
| `WilliamsBuyLevel` | Верхний порог для разрешения длинных сигналов. | `-25` |
| `WilliamsSellLevel` | Нижний порог для разрешения коротких сигналов. | `-75` |
| `TakeProfitPips` | Расстояние тейк-профита в пунктах; `0` отключает цель. | `999` |
| `TrailingStopPips` | Шаг трейлинг-стопа в пунктах; `0` отключает трейлинг. | `10` |
| `EntryBufferPips` | Дополнительный зазор за максимумом/минимумом. | `1` |
| `MinDistancePips` | Минимальная дистанция между рынком и отложенной заявкой. | `16` |
| `DailyCandleType` | Таймфрейм для индикаторов (по умолчанию дневные свечи). | 1 день |
| `TriggerCandleType` | Минутный таймфрейм для расписания и контроля рисков. | 1 минута |

## Дополнительные сведения
* Реализация на C# использует высокоуровневые методы StockSharp (`SubscribeCandles`, `BuyStop`, `SellStop`, привязку Level1) и не тре
бует ручного управления заявками.
* Для работы трейлинг-стопа необходим поток Level1, так как именно из него берутся актуальные лучшая покупка и продажа.
* В комплект входят только C# стратегия и документация на нескольких языках; Python-версия не поставляется.
