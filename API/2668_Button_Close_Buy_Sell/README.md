# Button Close Buy Sell
[Русский](README_ru.md) | [中文](README_cn.md)

Utility strategy that mirrors the MetaTrader button script for closing buy or sell positions. The strategy tracks the volume and average price of the current net exposure, calculates floating profit separately for long and short sides, and lets the user flatten each side on demand via boolean parameters instead of on-chart buttons.

## Details

- **Purpose**: Provide quick manual exit controls for existing positions without adding new entry logic.
- **Workflow**:
  - Subscribes to trade data to keep an updated market price.
  - Tracks fills generated by the strategy to maintain separate long and short exposure snapshots.
  - Recomputes floating PnL for both directions whenever price or position state changes.
  - Sends market orders when a close request parameter is toggled to `true`, then automatically resets the flag.
- **Position Handling**:
  - Long and short exposures are netted per StockSharp rules; only one side can remain open after fills execute.
  - Partial fills adjust the tracked average price and volume before new exposure is added.
- **Parameters**:
  - `Slippage` – informational allowance (in price steps) logged when closing orders are sent.
  - `CloseBuyPositions` – set to `true` to close all open long volume and immediately reset back to `false`.
  - `CloseSellPositions` – set to `true` to close all open short volume and immediately reset back to `false`.
- **Real-time Metrics**:
  - `OpenBuyProfit` – floating profit of the current long exposure based on the last trade price.
  - `OpenSellProfit` – floating profit of the current short exposure based on the last trade price.
- **Differences vs. MQL version**:
  - No on-chart buttons; use strategy parameters or external automation to trigger closes.
  - Filters by magic number or comment are not available because StockSharp operates with netted positions.

## Usage

1. Attach the strategy to the desired security and start it alongside any other logic that opens trades.
2. Observe floating profits for long and short sides in the parameter panel.
3. Toggle `CloseBuyPositions` or `CloseSellPositions` to flatten the corresponding exposure with a market order.
4. The strategy can be combined with discretionary entries, other automated modules, or protection logic such as `StartProtection()` if needed.
