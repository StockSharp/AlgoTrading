# Button Close Buy Sell
[English](README.md) | [中文](README_cn.md)

Утилита повторяет скрипт MetaTrader с кнопками закрытия покупок и продаж. Стратегия ведёт учёт объёма и средней цены текущей нетто-позиции, отдельно считает плавающий результат для лонга и шорта и позволяет закрывать каждую сторону по запросу через булевые параметры вместо кнопок на графике.

## Подробности

- **Назначение**: Быстро закрывать уже открытые позиции без собственной логики входа.
- **Как работает**:
  - Подписывается на поток сделок, чтобы иметь актуальную рыночную цену.
  - Отслеживает сделки стратегии и поддерживает раздельные состояния лонгового и шортового плеча.
  - Пересчитывает плавающую прибыль по обеим сторонам при каждом изменении цены или позиции.
  - Отправляет рыночные заявки при переключении параметра закрытия в `true` и сразу возвращает его в `false`.
- **Управление позицией**:
  - Позиции неттингуются по правилам StockSharp; после исполнения остаётся только одна сторона.
  - Частичное закрытие корректирует среднюю цену и объём перед добавлением нового объёма.
- **Параметры**:
  - `Slippage` – информационное значение допуска по проскальзыванию (в шагах цены), выводится в журнал при отправке заявок.
  - `CloseBuyPositions` – установите в `true`, чтобы закрыть весь открытый лонг; параметр автоматически вернётся в `false`.
  - `CloseSellPositions` – установите в `true`, чтобы закрыть весь открытый шорт; параметр автоматически вернётся в `false`.
- **Онлайн-показатели**:
  - `OpenBuyProfit` – плавающая прибыль по текущей длинной позиции по последней цене сделки.
  - `OpenSellProfit` – плавающая прибыль по текущей короткой позиции по последней цене сделки.
- **Отличия от версии MQL**:
  - Нет кнопок на графике: закрытие запускается через параметры или внешнюю автоматизацию.
  - Фильтрация по magic/comment отсутствует, поскольку в StockSharp используются неттинговые позиции.

## Использование

1. Запустите стратегию на нужном инструменте вместе с модулями, которые открывают сделки.
2. Следите за плавающей прибылью лонга и шорта в панели параметров.
3. Установите `CloseBuyPositions` или `CloseSellPositions` в `true`, чтобы рыночной заявкой закрыть соответствующее плечо.
4. При необходимости комбинируйте стратегию с защитными механизмами (например, `StartProtection()`), если торговый процесс этого требует.
