# Button Close Buy Sell
[English](README.md) | [Русский](README_ru.md)

该实用策略复刻了 MetaTrader 中用于关闭买单和卖单的按钮脚本。策略维护当前净头寸的仓位数量与均价，分别计算多头与空头的浮动盈亏，并通过布尔参数提供平仓命令，取代图表按钮。

## 详细信息

- **目标**：为现有头寸提供快速的人工平仓控制，不包含入场逻辑。
- **工作流程**：
  - 订阅成交流，以保持最新的市场价格。
  - 监控策略自身的成交，单独维护多头和空头的持仓状态。
  - 在价格或持仓发生变化时重新计算两侧的浮动盈亏。
  - 当关闭参数切换为 `true` 时发送市价单，并立即把参数恢复为 `false`。
- **持仓管理**：
  - 遵循 StockSharp 的净额制度，同一时刻只能保留一侧敞口。
  - 部分成交会先更新已跟踪的均价与数量，再记录新增仓位。
- **参数**：
  - `Slippage` – 以价格步长表示的容许滑点，发送平仓单时写入日志。
  - `CloseBuyPositions` – 设为 `true` 以平掉全部多头仓位，随后自动复位。
  - `CloseSellPositions` – 设为 `true` 以平掉全部空头仓位，随后自动复位。
- **实时指标**：
  - `OpenBuyProfit` – 当前多头仓位按照最新成交价计算的浮动收益。
  - `OpenSellProfit` – 当前空头仓位按照最新成交价计算的浮动收益。
- **与 MQL 版本的差异**：
  - 不再提供图表按钮，需要通过参数或外部自动化触发平仓。
  - 由于 StockSharp 采用净额模式，不支持按照 magic/comment 过滤单据。

## 使用方法

1. 将策略加载到目标品种，并与负责开仓的模块同时运行。
2. 在参数面板中查看多头与空头的浮动收益。
3. 将 `CloseBuyPositions` 或 `CloseSellPositions` 设置为 `true`，即可用市价单平掉对应方向。
4. 如有需要，可结合 `StartProtection()` 等风险控制组件共同使用。
