# Стратегия MA on Momentum Min Profit

## Обзор
Стратегия воспроизводит советник MetaTrader 5 **MA on Momentum Min Profit.mq5**. Сделки открываются при пересечении индикатора Momentum со своей скользящей средней, рассчитанной по самому Momentum. Сигнал на покупку появляется, когда Momentum пробивает среднюю вверх и при этом на предыдущей свече находился ниже нейтрального уровня 100. Сигнал на продажу возникает при обратном пересечении и значении Momentum выше 100 на предыдущей свече. Реализованы исходные ограничения по убытку в деньгах и фиксированный тейк-профит в пунктах.

## Логика торговли
1. Загружаем свечи типа `CandleType` и передаём их в индикатор Momentum.
2. Сглаживаем поток Momentum скользящей средней с параметрами `MomentumMovingAverageType` и `MomentumMovingAveragePeriod`.
3. Ищем пересечения, используя значения предыдущей свечи, чтобы исключить дублирующие сигналы.
4. Дополнительные опции из версии MQL:
   - Инверсия сигналов.
   - Закрытие встречной позиции перед открытием новой либо отказ от входа.
   - Жёсткое ограничение на одну чистую позицию.
   - Возможность реагировать на текущую (формирующуюся) свечу.
5. Управление риском:
   - Денежный стоп-контроль: сумма `PnL + Position * (close - PositionPrice)` не должна опускаться ниже `StopLossMoney`.
   - Тейк-профит переводится из пунктов в цену через `Security.PriceStep`.

## Параметры
| Параметр | Тип | Значение по умолчанию | Описание |
|----------|-----|------------------------|----------|
| `CandleType` | `DataType` | `TimeSpan.FromMinutes(5).TimeFrame()` | Таймфрейм свечей для расчёта Momentum. |
| `MomentumPeriod` | `int` | `14` | Период индикатора Momentum. |
| `MomentumMovingAveragePeriod` | `int` | `6` | Длина скользящей средней по Momentum. |
| `MomentumMovingAverageType` | `MomentumMovingAverageType` | `Smoothed` | Тип скользящей (Simple, Exponential, Smoothed, Weighted). |
| `ReverseSignals` | `bool` | `false` | Инвертировать покупки и продажи. |
| `CloseOpposite` | `bool` | `true` | Закрывать встречную позицию перед входом. |
| `OnlyOnePosition` | `bool` | `true` | Держать только одну чистую позицию. |
| `UseCurrentCandle` | `bool` | `false` | Сигналы по текущей свече вместо закрытой. |
| `StopLossMoney` | `decimal` | `15` | Допустимая просадка по счёту в деньгах. |
| `TakeProfitPoints` | `decimal` | `460` | Тейк-профит в пунктах (умножается на `PriceStep`). |
| `MomentumReference` | `decimal` | `100` | Нейтральный уровень Momentum из оригинала. |

## Особенности реализации
- Для сглаживания используются стандартные индикаторы StockSharp (`Simple/Exponential/Smoothed/WeightedMovingAverage`).
- Очередь заявок и фильтрация по magic number заменены работой с нетто-позицией: при включённом `CloseOpposite` стратегия отправляет одну рыночную заявку, которая сначала закрывает встречный объём, а затем открывает новую позицию нужного размера.
- Денежный стоп вызывает `CloseAll()` при превышении плавающего убытка и тем самым повторяет контроль `Commission + Swap + Profit` из версии MQL.
