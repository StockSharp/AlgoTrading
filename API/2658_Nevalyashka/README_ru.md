# Стратегия Nevalyashka
[English](README.md) | [中文](README_cn.md)

Порт оригинального эксперта MetaTrader «Nevalyashka» на платформу StockSharp. Стратегия постоянно чередует направления: сначала открывает рыночную продажу, дожидается закрытия позиции по стоп-лоссу или тейк-профиту, после чего немедленно открывает рыночную сделку в противоположную сторону. Защитные приказы пересоздаются для каждой новой сделки с теми же отступами в пунктах, что и в MQL-версии.

## Логика стратегии

1. **Инициализация**
   - Определяет шаг цены и количество знаков инструмента, чтобы вычислить размер пункта так же, как это делал советник (для 3/5 знаков шаг умножается на 10).
   - Умножает биржевой `MinVolume` на параметр `LotMultiplier`, затем при необходимости округляет объём к шагу объёма.
2. **Получение котировок**
   - Подписывается на обновления стакана, чтобы всегда иметь актуальные лучшую цену спроса и предложения — аналог вызова `RefreshRates()` в MQL.
3. **Постановка приказов**
   - После появления котировок открывает стартовую рыночную продажу.
   - После закрытия позиции меняет направление (покупка после продажи и наоборот) и выставляет новый рыночный приказ с тем же объёмом.
   - После фактического входа создаёт связанные стоп- и лимит-приказы на основе заданных расстояний в пунктах.

## Управление рисками

- **Стоп-лосс**: при значении `StopLossPips` больше нуля отправляется защитный приказ (`SellStop` для лонга, `BuyStop` для шорта) по цене `вход ± StopLossPips * пункт`.
- **Тейк-профит**: при значении `TakeProfitPips` больше нуля выставляется защитный лимитный приказ (`SellLimit` для лонга, `BuyLimit` для шорта) по цене `вход ± TakeProfitPips * пункт`.
- Всякий раз при переходе в ноль стратегия отменяет старые защитные заявки, чтобы избежать «висячих» приказов перед следующим разворотом.

## Параметры

| Название | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `LotMultiplier` | Множитель минимального биржевого объёма. Результат округляется к шагу объёма. | `1` |
| `StopLossPips` | Расстояние стоп-лосса в пунктах. `0` — отключить стоп. | `50` |
| `TakeProfitPips` | Расстояние тейк-профита в пунктах. `0` — отключить цель. | `50` |

## Практические замечания

- Подход постоянно меняет направление позиции, поэтому особенно полезен на средне- и короткосрочных откатных рынках.
- Работает с любым инструментом, который предоставляет лучшие цены bid/ask; размер пункта подстраивается автоматически.
- Проскальзывание контролируется биржей — сделки отправляются по рынку без дополнительных проверок, как и в оригинальном советнике.
- В стратегии нет фильтров торговых сессий, новостей или трейлинг-стопов; при необходимости их можно добавить в метод `TryOpenNextPosition` или `RegisterProtectionOrders`.
