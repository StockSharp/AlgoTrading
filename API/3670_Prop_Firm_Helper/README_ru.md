# Стратегия Prop Firm Helper

## Обзор
Prop Firm Helper — это конвертированный из MetaTrader советник, построенный на пробое канала Дончиана. Стратегия размещает стоп-заявки на покупку выше диапазона и стоп-заявки на продажу ниже диапазона. Дополнительно она контролирует правила проп-фирм: завершает торговлю при достижении целевой доходности или при превышении дневного лимита убытков.

## Логика торговли
- Подписка на свечи, задаваемые параметром `Candle Type`.
- Расчёт двух каналов Дончиана:
  - `Entry Period`/`Entry Shift` — для поиска уровней пробоя.
  - `Exit Period`/`Exit Shift` — для сопровождения открытых позиций.
- Размещение отложенного ордера Buy Stop на один тик выше смещённой верхней границы канала, если нет длинной позиции.
- Размещение Sell Stop на один тик ниже смещённой нижней границы, если нет короткой позиции.
- Использование индикатора среднего истинного диапазона (`ATR Period`) для фильтрации обновления защитных стопов.
- Закрытие длинной позиции при закрытии свечи ниже нижней границы канала сопровождения. Закрытие короткой — при закрытии выше верхней границы.

## Управление рисками
- Параметр `Risk Per Trade %` рассчитывает объём сделки по текущей стоимости портфеля, шагу цены и стоимости шага. Объём приводится к минимальному шагу и ограничивается биржевыми лимитами.
- Защитные стопы подтягиваются вдоль канала выхода с учётом буфера ATR, чтобы уменьшить количество перестановок.

## Правила проп-фирмы
- `Use Challenge Rules` включает контроль условий испытания.
- Достижение `Pass Criteria` приводит к закрытию всех позиций и отмене заявок.
- Если текущая дневная просадка превышает `Daily Loss Limit`, стратегия закрывает позиции, отменяет заявки и блокирует новые входы до конца дня. Начальное значение капитала пересчитывается в начале каждого торгового дня.

## Параметры
| Название | Описание |
| --- | --- |
| `Entry Period` | Длина окна для канала пробоя. |
| `Entry Shift` | Число завершённых свечей, игнорируемых при определении пробоя. |
| `Exit Period` | Длина окна для канала сопровождения. |
| `Exit Shift` | Число завершённых свечей, игнорируемых при расчёте стопов. |
| `Risk Per Trade %` | Доля капитала под риском на сделку. |
| `ATR Period` | Период ATR, применяемый при переносе стопов. |
| `Use Challenge Rules` | Включение правил проп-фирмы. |
| `Pass Criteria` | Целевое значение капитала для завершения торговли. |
| `Daily Loss Limit` | Максимально допустимый дневной убыток. |
| `Candle Type` | Тип свечей для расчётов. |

## Примечания
- Для корректной работы необходим доступ к портфелю, чтобы рассчитывать объёмы и отслеживать капитал.
- После закрытия каждой свечи стратегия пересчитывает уровни и при необходимости перерегистрирует отложенные заявки.
- Значения по умолчанию соответствуют исходному советнику MetaTrader.
