# Стратегия Williams AO + AC

## Описание
**Williams AO + AC** — это перенос советника MetaTrader 4 «Williams_AOAC» на высокоуровневый API StockSharp. Алгоритм объединяет несколько инструментов Билла Вильямса, чтобы на часовом таймфрейме (по умолчанию) отбирать импульсные движения:

1. **Фильтр по ширине полос Боллинджера** — сделки допускаются только тогда, когда расстояние между полосами находится в заданном диапазоне пунктов. Это позволяет отсеивать как боковики, так и чрезмерно волатильные периоды.
2. **Подтверждение через RSI** — для покупок индекс относительной силы должен быть выше верхнего порога, для продаж — ниже нижнего порога.
3. **Пересечение нулевой линии Awesome Oscillator** — индикатор обязан пересечь ноль в сторону предполагаемой сделки, фиксируя смену импульса.
4. **Ускорение Accelerator Oscillator** — три последние величины ускорителя должны находиться по одну сторону от нуля, а последняя должна усиливать движение, подтверждая ускорение.
5. **Фильтр торговой сессии** — сигналы разрешены только внутри задаваемого окна торговых часов.

После закрытия каждой свечи стратегия получает значения индикаторов через `Bind`, проверяет фильтры и при необходимости закрывает противоположную позицию, затем открывает новую рыночную заявку заданным объёмом. Стоп-лосс и тейк-профит задаются в пунктах от цены входа, опциональный трейлинг подтягивает стоп при достаточной прибыли.

## Условия входа
### Лонг
1. Ширина полос Боллинджера (разница между верхней и нижней полосой, переведённая в пункты) лежит в интервале от **BollingerSpreadLower** до **BollingerSpreadUpper**.
2. RSI строго больше значения **RsiBuyThreshold**.
3. Awesome Oscillator на текущей свече пересекает ноль снизу вверх.
4. Три последних значения Accelerator Oscillator положительны, причём текущее значение больше предыдущего, что говорит об ускорении роста.
5. Время открытия свечи попадает в торговое окно, начинающееся с **EntryHour** и продолжающееся **TradingWindowHours** часов (окно может переходить через полночь).
6. Текущая позиция не лонговая (допускается шорт или ноль).

При выполнении условий стратегия закрывает короткую позицию (если есть), открывает лонг объёмом **TradeVolume** и навешивает защитные ордера. Трейлинг-стоп начинает работать после того, как прибыль превысит **TrailingStopPoints** пунктов.

### Шорт
1. Ширина полос Боллинджера находится в допустимом диапазоне.
2. RSI строго меньше **RsiSellThreshold**.
3. Awesome Oscillator пересекает ноль сверху вниз.
4. Три последних значения ускорителя отрицательны и текущее значение меньше предыдущего — медвежий импульс усиливается.
5. Свеча открыта внутри торгового окна.
6. Текущая позиция не шортовая (допускается лонг или ноль).

После подтверждения условий модуль закрывает длинную позицию, открывает шорт объёмом **TradeVolume** и повторно устанавливает защитные уровни.

## Управление позицией
* **Тейк-профит** — если **TakeProfitPoints** больше нуля, выставляется цель на указанное количество пунктов от цены входа.
* **Стоп-лосс** — если **StopLossPoints** больше нуля, задаётся фиксированный стоп относительно цены входа.
* **Трейлинг-стоп** — если **TrailingStopPoints** больше нуля, стоп подтягивается, когда плавающая прибыль превышает указанную дистанцию. Для покупок стоп поднимается к `Close - TrailingStopPoints * pip`, для продаж опускается к `Close + TrailingStopPoints * pip`. Перемещение только в сторону уменьшения риска.
* Любые внешние изменения позиции учитываются: трейлинг ориентируется на фактический объём позиции.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|---------|----------|-----------------------|
| `CandleType` | Основная серия свечей. | Часовые свечи |
| `BollingerPeriod` | Длина расчёта полос Боллинджера. | 20 |
| `BollingerDeviation` | Множитель стандартного отклонения. | 2.0 |
| `BollingerSpreadLower` | Минимальная допустимая ширина полос (в пунктах). | 40 |
| `BollingerSpreadUpper` | Максимальная допустимая ширина полос (в пунктах). | 210 |
| `AoFastPeriod` | Быстрый период Awesome Oscillator. | 11 |
| `AoSlowPeriod` | Медленный период Awesome Oscillator. | 40 |
| `RsiPeriod` | Период RSI. | 20 |
| `RsiBuyThreshold` | Минимальный RSI для лонгов. | 46 |
| `RsiSellThreshold` | Максимальный RSI для шортов. | 40 |
| `EntryHour` | Час (0–23), с которого начинается торговое окно. | 0 |
| `TradingWindowHours` | Продолжительность торгового окна в часах (0 — только стартовый час). | 20 |
| `TradeVolume` | Объём новой позиции. | 0.01 |
| `StopLossPoints` | Дистанция стоп-лосса в пунктах. | 60 |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах. | 90 |
| `TrailingStopPoints` | Дистанция трейлинг-стопа в пунктах. | 30 |

## Дополнительные замечания
* Значение Accelerator Oscillator вычисляется как разность между текущим Awesome Oscillator и его 5-периодной SMA — это повторяет логику исходного индикатора из MetaTrader.
* Перевод ширины полос в пункты опирается на `PriceStep` инструмента; при отсутствии шага цена используется напрямую.
* Торговое окно корректно переходит через полночь, если `EntryHour + TradingWindowHours` превышает 23, полностью копируя поведение MQL4-версии.
* Перед открытием новой позиции стратегия закрывает противоположный объём, сохраняя ограничение оригинального эксперта на единственную сделку в рынке.
