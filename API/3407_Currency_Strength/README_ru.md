# Стратегия Currency Strength

## Обзор

**Currency Strength Strategy** — порт оригинального советника MQL4 «Currency Strength» на платформу StockSharp. Алгоритм сравнивает восемь основных валют (EUR, GBP, AUD, NZD, USD, CAD, CHF, JPY) по результатам анализа 28 наиболее ликвидных валютных пар. Сделки совершаются по инструменту на графике, если его базовая валюта сильнейшая в корзине, а котируемая валюта — самая слабая. Реализация использует высокоуровневый API StockSharp и заменяет низкоуровневые вызовы отправки ордеров абстракциями платформы.

## Логика торговли

1. Подписаться на свечи выбранного инструмента и на свечи остальных 27 пар, необходимых для расчёта силы валют.
2. Для каждой вспомогательной пары сохранять последнюю и предыдущую цены закрытия завершённой свечи и вычислять процентное изменение.
3. Прибавлять изменение к базовой валюте пары и вычитать его из котируемой валюты, формируя итоговую силу каждой валюты.
4. Определять самую сильную и самую слабую валюты корзины.
5. Проверять технические фильтры по торгуемой паре:
   - Пересечение линейных взвешенных скользящих средних (LWMA).
   - Расположение линии MACD относительно сигнальной линии и нулевого уровня.
   - Абсолютное значение индикатора Momentum выше настраиваемого порога.
6. Открывать длинную позицию, если базовая валюта — сильнейшая, котируемая — слабейшая, и все фильтры подтверждают покупку. Открывать короткую позицию при зеркальной ситуации.
7. Закрывать позиции, когда смещается валютный перекос или условия индикаторов перестают поддерживать сделку.
8. Каждые 30 минут выводить в журнал текущую «карту» силы валют для контроля и отладки.

## Параметры

| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Таймфрейм, используемый для всех подписок на свечи. | 15 минут |
| `FastMaLength` | Длина быстрой LWMA по типичной цене. | 6 |
| `SlowMaLength` | Длина медленной LWMA по типичной цене. | 85 |
| `MomentumLength` | Количество свечей в расчёте Momentum. | 14 |
| `MomentumThreshold` | Минимальное абсолютное значение Momentum для открытия позиции. | 0.3 |
| `MacdFastLength` | Быстрый EMA в фильтре MACD. | 12 |
| `MacdSlowLength` | Медленный EMA в фильтре MACD. | 26 |
| `MacdSignalLength` | Период сигнальной линии MACD. | 9 |

Все параметры оформлены через `StrategyParam<T>` и поддерживают оптимизацию согласно правилам репозитория.

## Защита и журналирование

- При запуске стратегия вызывает `StartProtection()`, чтобы активировать встроенный механизм защиты позиции после её открытия.
- Информационные сообщения фиксируют открытие и закрытие сделок и выводят валюты, определённые как сильнейшие и слабейшие.
- Снимок силы валют публикуется каждые 30 минут для отслеживания динамики корзины в тестах.

## Примечания

- Для корректной работы необходимы данные по всем 28 валютным парам. Отсутствующие инструменты исключаются из расчёта с записью предупреждения в лог.
- Модель силы использует процентное изменение между последовательными ценами закрытия свечей, что повторяет логику исходного советника и соответствует потоковой модели StockSharp.
- Ордера отправляются только по рынку; дополнительные уровни стоп-лосс/тейк-профит следует реализовывать отдельно при необходимости.

## Детали конверсии

- Все комментарии переведены на английский язык, как требует общий регламент.
- Индикаторы подключаются через `SubscribeCandles().Bind(...)`; прямой доступ к внутренним буферам не используется.
- Логика полностью опирается на значения, передаваемые в обработчики, и не обращается к историческим индикаторным массивам, что соответствует ограничениям проекта.
