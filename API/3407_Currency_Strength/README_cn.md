# 货币强度策略

## 概述

**货币强度策略** 是对 MQL4 专家顾问“Currency Strength”的 StockSharp 移植版本。系统通过分析 28 个主要货币对，比较八个核心货币（EUR、GBP、AUD、NZD、USD、CAD、CHF、JPY）的相对强弱。当交易品种的基础货币最强、报价货币最弱时触发交易。本转换遵循高层 API 指南，将原始的下单逻辑替换为 StockSharp 的抽象实现。

## 交易逻辑

1. 订阅当前交易品种以及其余 27 个辅助货币对的 K 线数据。
2. 在每根辅助货币对的 K 线完成时，保存最新收盘价和前一根收盘价，并计算百分比变化。
3. 将每个货币对的变化量加到基础货币上、减到报价货币上，得到每个货币的强度得分。
4. 找出篮子中最强和最弱的货币。
5. 在交易品种上应用技术过滤条件：
   - 线性加权移动平均线（LWMA）金叉或死叉过滤。
   - MACD 主线位于信号线的正确一侧并满足零轴方向。
   - 动量指标的绝对值高于可配置阈值。
6. 当基础货币最强、报价货币最弱且所有多头条件成立时开多单；反向条件满足时开空单。
7. 当趋势偏向或技术条件不再支持持仓时平仓。
8. 每隔 30 分钟记录一次货币强度快照，便于调试与回测分析。

## 参数

| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `CandleType` | 所有订阅使用的时间框架。 | 15 分钟 |
| `FastMaLength` | 作用于典型价格的快速 LWMA 长度。 | 6 |
| `SlowMaLength` | 作用于典型价格的慢速 LWMA 长度。 | 85 |
| `MomentumLength` | 动量指标使用的 K 线数量。 | 14 |
| `MomentumThreshold` | 允许开仓前的最小动量绝对值。 | 0.3 |
| `MacdFastLength` | MACD 快速 EMA 周期。 | 12 |
| `MacdSlowLength` | MACD 慢速 EMA 周期。 | 26 |
| `MacdSignalLength` | MACD 信号线周期。 | 9 |

所有参数都通过 `StrategyParam<T>` 注册，可按项目规则进行优化。

## 保护与日志

- 策略在启动时调用 `StartProtection()`，以启用 StockSharp 内置的持仓保护功能。
- 信息日志会记录开仓、平仓事件以及识别到的最强/最弱货币。
- 强度快照每 30 分钟输出一次，有助于监控篮子变化情况。

## 注意事项

- 需要行情源提供全部 28 个主要货币对的 K 线。如果缺少某个品种，会记录警告并将其从计算中排除。
- 强度模型使用连续两根 K 线收盘价的百分比变化，既符合原始 EA 的思路，也兼容 StockSharp 的数据流。
- 策略仅使用市价单；如需止损或止盈，可在外部加上风控模块。

## 转换说明

- 全部代码注释均改写为英文，符合仓库要求。
- 指标计算使用高层 `SubscribeCandles().Bind(...)` 模式，不直接操作指标缓冲区。
- 仅使用回调中提供的指标值，避免访问历史缓存，完全符合转换规范。
