# Стратегия Close Panel

## Обзор
Стратегия переносит утилиту MetaTrader 5 **Close panel (in money)** в экосистему StockSharp. Исходный советник отображал панель
с тремя кнопками: "Close all" для закрытия всех позиций, "Close loss" для закрытия убыточных сделок при превышении заданного
уровня и "Close profit" для фиксации прибыли. В версии для StockSharp эти действия выполняются автоматически через набор
параметров, поэтому ручное взаимодействие больше не требуется.

## Как работает стратегия
- При запуске можно мгновенно закрыть все открытые позиции (`CloseAllOnStart`). Это полный аналог кнопки "Close all".
- Во время работы стратегия подписывается на тики и следит за текущей прибылью/убытком по каждому портфельному инструменту.
- Если включён параметр `CloseLossEnabled`, то позиции, чья плавающая просадка (в валюте счёта) опускается ниже `-LossThreshold`,
  закрываются рыночным ордером.
- При активном параметре `CloseProfitEnabled` позиции с прибылью выше `ProfitThreshold` немедленно фиксируются.
- Перед отправкой приказа стратегия проверяет, нет ли уже активных заявок на закрытие в том же направлении, чтобы не дублировать
  заявки.

## Обработка заявок
Все выходы выполняются рыночными приказами: для длинных позиций отправляется продажа, для коротких — покупка. При расчёте общего
объёма учитываются позиции самой стратегии, портфеля и дочерних стратегий, что гарантирует корректное закрытие всех открытых
сделок в аккаунте.

## Параметры
| Параметр | Описание |
|----------|----------|
| `LossThreshold` | Максимально допустимая плавающая просадка на позицию (в валюте счёта). При активном `CloseLossEnabled` позиция закрывается, когда PnL падает ниже `-LossThreshold`. |
| `ProfitThreshold` | Целевое значение прибыли на позицию (в валюте счёта). При активном `CloseProfitEnabled` позиция закрывается, когда PnL превышает порог. |
| `CloseLossEnabled` | Включает автоматическое закрытие убыточных позиций. |
| `CloseProfitEnabled` | Включает автоматическое закрытие прибыльных позиций. |
| `CloseAllOnStart` | Закрывает все позиции сразу после запуска стратегии. |

## Примечания
- В оригинале действия выполнялись вручную. Здесь используйте булевы параметры, чтобы задать желаемое поведение до старта
  стратегии.
- Пороговые значения задаются в денежном выражении — настройте их в соответствии с размером счёта и волатильностью инструмента.
- Из-за исполнения рыночными ордерами итоговый результат может слегка отличаться от заданного уровня прибыли или убытка.
- Стратегия не открывает новые позиции и предназначена только для управления уже существующими сделками.
