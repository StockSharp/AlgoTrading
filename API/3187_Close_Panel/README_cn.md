# Close Panel 策略

## 概述
本策略将 MetaTrader 5 的 **Close panel (in money)** 工具移植到 StockSharp 平台。原始 EA 提供一个面板，包含三个按
钮，分别用于关闭所有头寸、按亏损金额关闭头寸以及按盈利金额关闭头寸。移植版本取消了手动界面，通过参
数配置自动执行相同的平仓逻辑。

## 工作原理
- 启动时可以选择立即平掉所有持仓，对应面板上的 “Close all” 按钮，通过 `CloseAllOnStart` 参数控制。
- 策略订阅逐笔成交数据，持续监控投资组合中每个头寸的浮动盈亏。
- 当 `CloseLossEnabled` 为真时，如果某个头寸的未实现亏损（以货币计）超过设定的阈值，策略会立即发出市价单平仓。
- 当 `CloseProfitEnabled` 为真时，如果某个头寸的浮动盈利达到目标，也会通过市价单锁定利润。
- 在发送平仓指令前，策略会检查是否已经存在相同方向的活动订单，避免重复提交。

## 订单处理
平仓全部使用市价单执行：多头头寸使用卖出市价单，空头头寸使用买入市价单。策略会合并当前策略、托管投
资组合以及子策略中的所有持仓，确保账户内所有敞口都被正确处理。

## 参数
| 参数 | 说明 |
|------|------|
| `LossThreshold` | 每个头寸允许的最大未实现亏损（账户货币）。当 `CloseLossEnabled` 打开且浮亏低于 `-LossThreshold` 时触发平仓。 |
| `ProfitThreshold` | 每个头寸的目标盈利（账户货币）。当 `CloseProfitEnabled` 打开且浮盈高于该值时触发平仓。 |
| `CloseLossEnabled` | 启用基于亏损阈值的自动保护。 |
| `CloseProfitEnabled` | 启用基于盈利阈值的自动保护。 |
| `CloseAllOnStart` | 策略启动后立即平掉所有头寸。 |

## 注意事项
- 原版面板需要手动点击按钮，StockSharp 版本通过布尔参数实现相同的组合，请在启动前配置好需要的选项。
- 阈值以货币计量，请根据账户规模与标的波动性进行调整。
- 由于使用市价单执行，实际平仓价格可能因滑点而与目标金额存在差异。
- 本策略不会开立新仓，仅负责管理并关闭已有头寸。
