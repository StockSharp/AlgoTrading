# Revised Self Adaptive EA

Порт эксперта MetaTrader 5 `revised_self_adaptive_ea.mq5` на высокоуровневый API StockSharp.

## Краткое описание стратегии

* **Паттерн** – анализируются две последние закрытые свечи. Для покупки требуется бычья свеча с телом выше среднего, открывшаяся ниже закрытия предыдущей медвежьей свечи. Для продажи условия зеркальные.
* **Осциллятор** – RSI подтверждает перепроданность/перекупленность перед открытием позиции.
* **Трендовый фильтр** – короткая SMA должна совпадать с направлением входа, что снижает количество сделок против тренда.
* **Управление риском** – расстояния стоп-лосса, тейк-профита и опционального трейлинга рассчитываются по ATR. При достижении защитных уровней позиция закрывается рыночным приказом.
* **Контроль спреда и риска** – сигнал игнорируется, если текущий спред превышает заданный порог или рассчитанный ATR-стоп требует риска выше допустимого процента от цены входа.

## Параметры

- `CandleType` – используемый таймфрейм (по умолчанию 1H).
- `AverageBodyPeriod` – период усреднения для оценки размера свечи.
- `MovingAveragePeriod` – период трендовой SMA.
- `RsiPeriod`, `OversoldLevel`, `OverboughtLevel` – настройки RSI.
- `AtrPeriod`, `StopLossAtrMultiplier`, `TakeProfitAtrMultiplier`, `TrailingStopAtrMultiplier`, `UseTrailingStop` – параметры ATR и трейлинг-стопа.
- `MaxSpreadPoints` – максимальный допустимый спред в шагах цены.
- `MaxRiskPercent` – максимальный риск (в процентах от цены) исходя из ATR-стопа.
- `TradeVolume` – базовый объем позиции.

## Отличия от оригинала

- В исходном MQL-скрипте была только проверка паттерна. В портированной версии добавлены MA-фильтр и полноценный ATR-блок управления позицией, чтобы задействовать объявленные в коде индикаторы.
- Исключено рисование графических объектов (стрелок), так как в StockSharp это не используется по умолчанию.
- Добавлен контроль процентного риска, предотвращающий открытие сделок с чрезмерным размером стопа.

## Как использовать

1. Укажите портфель и инструмент в среде исполнения (Hydra или собственное приложение).
2. Подберите параметры таймфрейма и рисков в соответствии с торговым планом.
3. Запустите стратегию – она автоматически подпишется на свечи, рассчитает индикаторы и выполнит рыночные сделки при выполнении условий.
