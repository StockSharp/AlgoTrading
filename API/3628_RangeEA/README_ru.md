# RangeEA Стратегия

## Обзор

RangeEA — это сеточная стратегия с отложенными лимитными заявками, портированная из оригинального эксперт-советника MetaTrader.
Алгоритм определяет актуальный недельный ценовой диапазон и распределяет внутри него заданное количество отложенных заявок.
Для каждой заявки рассчитываются динамические уровни стоп-лосса и тейк-профита: они масштабируются относительно расстояния до
текущей цены и дополнительно ограничиваются минимальными значениями в пунктах. При достижении целевой доходности стратегия
закрывает все позиции и заявки, фиксируя прибыль.

Реализация опирается на высокоуровневый API StockSharp: логика запускается по свечам, управление заявками осуществляется через
встроенные методы стратегии, а параметры риска доступны для оптимизации.

## Логика торговли

1. Подписка на два потока свечей:
   - Пользовательский таймфрейм (по умолчанию 1 час) для обслуживания сетки.
   - Недельные свечи для оценки диапазона.
2. После закрытия каждой недельной свечи обновляются максимум и минимум за последние две недели. Разница между ними задаёт
   рабочий диапазон.
3. На закрытии каждой рабочей свечи:
   - Проверяется торговое окно (`StartTradeHour` — `EndTradeHour`).
   - При необходимости сетка сбрасывается в начале нового торгового дня.
   - При отсутствии активных лимитных заявок формируется новая сетка, равномерно покрывающая диапазон.
   - Если уже исполнено минимум две заявки, то при сокращении сетки до `NumberOfOrders - 2` заявок возобновляется заявка по цене
     предпоследнего исполнения.
   - Контролируется прирост капитала, и при достижении целевого процента выполняется полная ликвидация позиций.
4. По окончании торгового окна и при включённом `CloseAllAtEndTrade` стратегия отменяет все отложенные заявки и закрывает
   открытые позиции.

## Параметры

| Имя | Описание | Значение по умолчанию |
|-----|----------|-----------------------|
| `CandleType` | Таймфрейм для управления сеткой. | Часовые свечи |
| `WeeklyCandleType` | Таймфрейм для расчёта диапазона. | Недельные свечи |
| `StartTradeHour` | Час начала выставления заявок. | 0 |
| `EndTradeHour` | Час завершения торговли. | 24 |
| `CloseAllAtEndTrade` | Закрывать позиции и заявки вне торгового окна. | true |
| `MaxOpenOrders` | Максимум одновременно открытых заявок и позиций. | 5 |
| `NumberOfOrders` | Количество лимитных заявок в сетке. | 10 |
| `OrderVolume` | Объём каждой заявки. | 0.01 |
| `ResetOrdersDaily` | Перестраивать сетку в начале дня. | true |
| `StopLossPoints` | Минимальный стоп-лосс в пунктах. | 60 |
| `TakeProfitPoints` | Минимальный тейк-профит в пунктах. | 60 |
| `StopLossMultiplier` | Множитель динамического стоп-лосса. | 3 |
| `TakeProfitMultiplier` | Множитель динамического тейк-профита. | 1 |
| `TargetPercentage` | Рост капитала, после которого выполняется фиксация. | 8 |

## Управление рисками

- Ограничение `MaxOpenOrders` удерживает число заявок и позиций под контролем.
- Стоп-лосс и тейк-профит всегда находятся не ближе минимального числа пунктов и могут быть увеличены множителями.
- Ежедневный сброс не позволяет переносить устаревшие заявки на следующий день.
- Целевой процент прибыли фиксирует накопленный результат и предотвращает переразмеренный риск.

## Примечания

- Необходимо, чтобы по инструменту поставлялись недельные свечи, иначе диапазон не будет рассчитан.
- Для инструментов с нестандартным шагом цены следует скорректировать параметры в пунктах под фактический тик.
- Оптимизация `NumberOfOrders`, `OrderVolume` и множителей стопов/тейков помогает адаптировать стратегию к различной
  волатильности.
