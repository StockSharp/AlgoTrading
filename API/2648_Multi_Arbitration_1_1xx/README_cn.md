# Multi Arbitration 1.1xx 策略

## 概述
该策略在 StockSharp 中复刻了 MetaTrader 平台上的 “Multi Arbitration 1.1xx” 专家顾问。它同时交易主图品种 (`Security`) 与可配置的第二个品种，通过比较当前收盘价与历史上最有利的买入 / 卖出价位，在出现新突破时累加仓位。

## 参数
- **Signal Candles (`CandleType`)** – 用于两只品种的信号时间框架（默认 15 分钟）。策略通过订阅生成所需 K 线，因此界面上的图表周期可以不同。
- **Second Security (`SecondSecurity`)** – 与主品种一起交易的第二个品种，启动前必须指定。
- **Profit Target (`ProfitTarget`)** – 当账户权益相对初始值的增量达到该值时，会立即平掉所有头寸。
- **Max Open Units (`MaxOpenUnits`)** – 两个品种的绝对持仓量之和上限。达到上限且账户盈利时，策略会强制退出以降低风险。
- **Second Volume (`SecondVolume`)** – 第二个品种的下单数量。主品种使用策略的 `Volume` 属性。

## 交易逻辑
1. 为主品种与第二品种订阅相同的时间框架 K 线。只有当两条序列都给出具有相同开盘时间的完结 K 线时才会计算信号。
2. 分别维护两个品种的最低买入价与最高卖出价。当最新收盘价突破这些价位时，会在相应方向上加仓：
   - 收盘价低于记录的买入价 → 加多仓（若无持仓则先建仓）。
   - 收盘价高于记录的卖出价 → 加空仓（若无持仓则先建仓）。
3. 策略在净头寸模式下运行。当持仓为零时，会在下一次评估时默认开多，以保持网格活跃。
4. 每次下单前都会检查总敞口 (`|pos1| + |pos2|`) 是否超过 `MaxOpenUnits`。若超过且账户盈利，则立即平仓。
5. 当累计利润高于 `ProfitTarget` 时，同时平掉两个品种的头寸并重置内部价位。

## 与原版 MQL 专家的差异
- StockSharp 默认使用净头寸账户，无法像 MetaTrader 那样通过 `PositionCloseBy` 同时持有多头和空头，因此用净敞口管理的方式进行近似。
- 原策略中针对最小手数的检测与异步下单重试被简化为使用平台的订单处理，两个品种分别使用固定的下单数量。
- 交易权限、成交方式等检测由 StockSharp 框架自身负责，代码中不再重复实现。

## 使用说明
- 启动前请确保 `SecondSecurity` 已配置，并且连接器能够为两个品种提供行情。
- 调整 `Volume` 与 `SecondVolume` 以满足交易标的的最小手数要求。
- 建议在能够提供同步时间戳的市场环境中运行，因为策略会等待两只品种的 K 线开盘时间一致后才会执行。
