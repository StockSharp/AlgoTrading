# Стратегия Pending Order Grid

Стратегия повторяет работу советника AntiFragile из MetaTrader. Она формирует симметричную сетку стоп-заявок вокруг текущей цены и сопровождает позиции защитными ордерами.

## Основная логика
- После запуска подписывается на стакан и получает лучшие цены bid/ask, на их основе размещаются buy stop выше рынка и sell stop ниже рынка.
- Цена каждого уровня рассчитывается как *Distance* от текущей цены плюс кратное значение *Spacing (ticks)*, умноженное на шаг цены инструмента.
- Объём заявок увеличивается на процент *Volume Increase %* для каждого последующего уровня, что воспроизводит мартина из MQL-версии.
- При исполнении заявок формируется чистая позиция. Для неё выставляются стоп-лосс и тейк-профит, а при заданном *Trailing Stop (ticks)* стоп переносится ближе к рынку при достижении нужной прибыли.
- Когда все заявки исполнены/сняты и позиция снова нулевая, сетка строится заново.

## Параметры
- **Starting Volume** – базовый объём первого ордера; последующие используют указанное процентное увеличение.
- **Volume Increase %** – процент прироста объёма каждого уровня (0.1 = +0.1% на уровень).
- **Distance** – абсолютное смещение первого ордера от текущей цены (в валюте инструмента).
- **Spacing (ticks)** – количество шагов цены между уровнями сетки.
- **Orders per side** – максимальное число ордеров в длинную и в короткую сторону.
- **Take Profit (ticks)** – расстояние тейк-профита от средней цены входа в шагах цены.
- **Stop Loss (ticks)** – расстояние стоп-лосса от средней цены. Значение 0 отключает исходный стоп.
- **Trailing Stop (ticks)** – расстояние для трейлинг-стопа. Ноль отключает перенос.
- **Enable Long Grid / Enable Short Grid** – флаги, включающие длинную или короткую часть сетки.

## Особенности реализации
- В StockSharp применяется неттинг позиций, поэтому разнонаправленные сделки взаимно компенсируются и не образуют хедж как в MT4.
- Цены и объёмы округляются до минимальных шагов перед отправкой заявок.
- Трейлинг реализован через отмену предыдущего стопа и постановку нового при улучшении цены.
- Для корректной работы необходима подписка `SubscribeOrderBook()`.

## Рекомендации по использованию
1. Подбирайте *Starting Volume* и *Volume Increase %* с учётом маржи — сетка может быстро наращивать объём.
2. Убедитесь, что площадка поддерживает стоп-заявки; стратегия активно их использует.
3. Следите за количеством активных ордеров, поскольку крупная сетка может блокировать существенную часть средств.
