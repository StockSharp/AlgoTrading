# 挂单网格策略

该策略复刻了 MetaTrader 中“AntiFragile”挂单网格 EA 的逻辑。策略在行情上下方持续铺设对称的止损单网格，并在触发后提供风控处理。

## 核心机制
- 启动后订阅盘口数据，记录最新买一/卖一价，并在价格上方挂出买入止损单、下方挂出卖出止损单。
- 每个挂单价格先按 *Distance* 参数离当前价一定距离，再根据 *Spacing (ticks)* 乘以品种最小价格跳动生成网格间距。
- 订单手数依据 *Volume Increase %* 逐级递增，复现原 MQL 程序的马丁加仓方式。
- 当挂单成交形成净头寸后，策略会同步下达止损和止盈单；若启用 *Trailing Stop (ticks)*，则根据实时买卖价在盈利达到设定阈值时上移/下移止损。
- 所有挂单成交或被取消且仓位回到空仓后，会重新搭建完整网格。

## 参数说明
- **Starting Volume** – 第一笔挂单的基础手数，之后的订单按百分比递增。
- **Volume Increase %** – 每层网格的手数增幅（0.1 代表每层增加 0.1%）。
- **Distance** – 首个挂单相对当前价的绝对偏移量（以标的货币计）。
- **Spacing (ticks)** – 网格层之间的跳动数。
- **Orders per side** – 多头与空头方向各自的最大挂单数量。
- **Take Profit (ticks)** – 止盈相对均价的跳动距离，为 0 表示不下达止盈。
- **Stop Loss (ticks)** – 初始止损的跳动距离，为 0 表示不下达止损。
- **Trailing Stop (ticks)** – 启用追踪止损时的移动距离，为 0 表示关闭追踪。
- **Enable Long Grid / Enable Short Grid** – 是否在上方放置买入止损单 / 在下方放置卖出止损单。

## 实现细节
- StockSharp 使用净头寸模型，不支持 MT4 那样的对冲持仓；相反方向成交会相互抵消。
- 所有价格与手数在下单前都会按照交易所最小跳动量进行取整。
- 追踪止损通过取消旧止损单并以新价格重新下单来实现。
- 策略依赖 `SubscribeOrderBook()` 提供的盘口数据来驱动网格和追踪逻辑。

## 使用建议
1. 根据账户保证金和风险承受能力谨慎设置 *Starting Volume* 与 *Volume Increase %*，避免在大波动行情中急剧放大持仓。
2. 确保交易通道支持触发型止损单，否则挂出的保护订单可能无法执行。
3. 注意大量挂单会占用保证金或冻结资金，必要时调整挂单数量。
