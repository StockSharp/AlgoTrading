# Стратегия Exp Breakout Signals
[English](README.md) | [中文](README_cn.md)

Индикатор EXP Breakout Signals отслеживает реакции цены около вручную нанесённых горизонтальных уровней.
Порт под StockSharp воспроизводит ту же логику уведомлений через высокоуровневый API стратегий:
подписывается на свечи, фиксирует пробои уровней и выводит подробные сообщения в журнал без открытия сделок.

## Концепция

- Трейдер задаёт список горизонтальных уровней (`Levels`), которые выступают поддержкой или сопротивлением.
- Обрабатываются только полностью сформированные свечи, чтобы не дублировать сигналы в процессе построения бара.
- Когда свеча касается уровня или открывается по разные стороны от него, формируется уведомление выбранного типа.
- Каждое сообщение содержит пользовательский префикс, что позволяет использовать несколько копий стратегии в одном рабочем месте.

## Обработка рыночных данных

1. При запуске стратегия проверяет корректность настроек уведомлений (режим «Sound» требует имя файла).
2. Список уровней разбирается один раз; некорректные значения пропускаются с предупреждением в журнале.
3. Через `SubscribeCandles` создаётся подписка на свечи выбранного таймфрейма.
4. Сохраняется цена открытия предыдущей свечи, чтобы обнаруживать пробои между открытиями соседних баров, как в версии MT5.

## Логика пробоя

- **Только завершённые бары**: `ProcessCandle` игнорирует незакрытые свечи (`candle.State != CandleStates.Finished`).
- **Проход внутри диапазона**: если максимум и минимум свечи охватывают уровень, считается, что произошёл пробой.
- **Гэп вверх**: если прошлое открытие было ниже уровня, а новое стало выше или равно — фиксируется пробой вверх.
- **Гэп вниз**: если прошлое открытие было выше уровня, а новое стало ниже или равно — фиксируется пробой вниз.
- Каждое выполненное условие генерирует одно уведомление на уровень и свечу, что соответствует оригинальному алгоритму.

## Обработка уведомлений

- `Sound`: в журнал пишется информационное сообщение с именем звукового файла, который должен воспроизвести хост.
- `Alert`: используется предупреждающий лог, чтобы выделить событие в визуальных просмотрщиках логов.
- `Push`: создаётся информационное сообщение о необходимости отправить push-уведомление внешними средствами.
- `Mail`: выводится информационное сообщение о предполагаемой email-рассылке.
- Во всех режимах сообщение содержит префикс, уровень (в инвариантном формате) и время открытия свечи.

## Параметры

- **Candle Type** (`General`): таймфрейм, по которому строятся свечи для проверки пробоя.
- **Prefix** (`Notifications`): текст, добавляемый к каждому уведомлению; аналог префикса объектов в MetaTrader.
- **Signal Mode** (`Notifications`): выбирает тип уведомления.
- **Sound Name** (`Notifications`): имя звукового файла, обязательное при выборе режима `Sound`.
- **Levels** (`Levels`): список цен через `;`, `,` или пробел (пример: `1835.5;1840;1845.75`).
- **Clear On Stop** (`Levels`): при остановке очищает кеш уровней, чтобы при следующем запуске список был разобран заново.

## Руководство по использованию

1. Добавьте стратегию в портфель и выберите инструмент, за которым хотите наблюдать.
2. Подберите `Candle Type` в соответствии с таймфреймом вашей разметки уровней.
3. Введите уровни в инвариантном формате (десятичная точка `.`), разделяя значения `;`, `,` или пробелами.
4. Настройте префикс так, чтобы сигналы разных экземпляров легко различались в общем журнале.
5. Выберите подходящий режим уведомлений; при звуковом режиме обязательно укажите файл.
6. Запустите стратегию — при каждом касании уровня на новой свече появится сообщение в журнале.
7. По завершении остановите стратегию; включите `Clear On Stop`, если часто меняете список уровней между запусками.

## Дополнительные замечания

- Стратегия не выставляет заявки и не управляет позицией — это исключительно инструмент оповещения, как и оригинальный скрипт MT5.
- Свечные данные поступают через высокоуровневый API, поэтому дополнительной загрузки истории не требуется.
- Значение предыдущего открытия сбрасывается при каждой остановке, что исключает использование устаревших данных.
- Сообщения журнала могут быть перенаправлены во внешние сервисы уведомлений силами приложения StockSharp.
