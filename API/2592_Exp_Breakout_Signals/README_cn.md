# Exp Breakout Signals 策略
[English](README.md) | [Русский](README_ru.md)

EXP Breakout Signals 指标用于监控交易者手动绘制的水平价格线附近的反应。
该 StockSharp 版本通过高层策略 API 实现同样的提醒逻辑：订阅蜡烛、侦测突破并输出详细日志，不会自动下单。

## 核心思路

- 通过 `Levels` 参数提供需要监控的支撑与阻力价格。
- 仅处理已经收盘的蜡烛，避免在形成过程中重复触发信号。
- 当蜡烛触碰或跨越任意水平价位时，策略会根据选择的通知类型生成提示。
- 所有提示都会加上自定义前缀，方便在多图表或多实例环境下区分来源。

## 数据处理流程

1. 启动时先校验通知设置（选择 `Sound` 模式时必须指定声音文件名）。
2. 将价格列表解析一次并缓存，无法解析的条目会在日志中给出警告。
3. 通过 `SubscribeCandles` 订阅所选周期的蜡烛数据。
4. 记录上一根蜡烛的开盘价，用于检测两根蜡烛开盘价之间的跳空突破，与 MT5 版本一致。

## 突破判定

- **仅限已完成蜡烛**：如果 `candle.State != CandleStates.Finished` 将直接返回。
- **区间穿越**：蜡烛的最高价与最低价包住水平线则视为突破。
- **向上跳空**：上一根开盘价在水平线下方，本根开盘价位于其上方或等于水平线。
- **向下跳空**：上一根开盘价在水平线上方，本根开盘价位于其下方或等于水平线。
- 满足任一条件都会在该水平线上记录一次通知，完全复刻原始逻辑。

## 通知处理

- `Sound`：写入包含声音文件名称的信息日志，供宿主程序播放。
- `Alert`：写入警告日志，方便在界面上醒目显示。
- `Push`：写入信息日志，提示需要触发外部的推送服务。
- `Mail`：写入信息日志，提示需要发送邮件。
- 消息文本始终包含前缀、突破价格（使用 InvariantCulture 格式）以及蜡烛开盘时间。

## 参数说明

- **Candle Type**（General）：用于检测突破的蜡烛周期。
- **Prefix**（Notifications）：添加到通知文本中的前缀，对应 MT5 版本的对象前缀。
- **Signal Mode**（Notifications）：选择通知通道。
- **Sound Name**（Notifications）：当 `Signal Mode` 为 `Sound` 时必须填写的声音文件。
- **Levels**（Levels）：使用 `;`、`,` 或空格分隔的价格列表，例如 `1835.5;1840;1845.75`。
- **Clear On Stop**（Levels）：停止策略时清空缓存的价格列表，使下次启动重新解析。

## 使用步骤

1. 将策略添加到投资组合，并选择需要监控的证券。
2. 根据分析所用周期设置 `Candle Type`。
3. 使用英文句点 `.` 作为小数点录入价格，可用 `;`、`,` 或空格分隔多个数值。
4. 配置前缀，确保多实例运行时可以在日志中区分信号来源。
5. 选择合适的通知模式；若选择 `Sound`，请填写正确的声音文件名。
6. 启动策略，价格在新蜡烛上触及或跨越水平线时，日志会记录相应提醒。
7. 停止策略；若经常调整水平线列表，可启用 `Clear On Stop` 以便每次重启重新解析。

## 其他说明

- 策略不会自动交易，仅作为提醒工具，与原始 MT5 指标一致。
- 所有市场数据均通过高层 API 获得，无需手动加载历史。
- 每次停止时都会清除上一根开盘价，防止下次运行沿用旧数据。
- 通过宿主的日志路由功能，可以将这些提示转发至外部通知系统。
