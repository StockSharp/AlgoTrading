# Стратегия Ring System

## Идея

**Ring System Strategy** переносит ключевую концепцию треугольного арбитража из "MT5 Ring System EA" в StockSharp. Стратегия од
новременно отслеживает три валютные пары, образующие замкнутый конверсионный цикл (например, `EURUSD`, `USDJPY`, `EURJPY`). Как
только произведение первых двух ног отклоняется от прямого кросс-курса, стратегия открывает сбалансированный набор сделок и закр
ывает его, когда цены возвращаются к равновесию.

Реализация использует высокоуровневый API подписки на свечи. Каждая нога контролируется отдельно, а сделки исполняются синхронны
ми рыночными ордерами, чтобы суммарная позиция оставалась близкой к нулю.

## Параметры

| Параметр | Описание |
|----------|----------|
| `Currencies` | Упорядоченный список валют для построения кольца. Используются только первые три кода. |
| `Entry Threshold` | Минимальное относительное отклонение между синтетическим курсом (`leg1 * leg2`) и прямым кроссом для открытия позиции. |
| `Exit Threshold` | Уровень отклонения, при котором существующее кольцо закрывается. Обычно меньше порога входа. |
| `Order Volume` | Объём, отправляемый по каждой ноге при открытии и закрытии кольца. |
| `Candle Type` | Тип свечей, используемый для оценки спреда. Можно выбирать любое таймфреймное представление, доступное у поставщика данных. |
| `Symbol Prefix` | Необязательный префикс, добавляемый к каждому символу (например, `m.` или `FX_`). |
| `Symbol Suffix` | Необязательный суффикс, добавляемый к каждому символу (например, `EURUSD.i`). |
| `Flatten On Stop` | При включении стратегия автоматически закрывает все ноги при остановке. |

## Логика торговли

1. Разобрать строку с валютами, взять первые три тикера и сформировать три пары кольца.
2. Подписаться на свечи для каждой ноги и сохранять закрытие после формирования свечи.
3. Рассчитать теоретический курс (`price1 * price2`) и сравнить его с прямым кросс-курсом (`price3`).
4. Если относительное отклонение превышает порог входа, открыть корзину:
   - Длинное кольцо: купить прямой кросс (третью ногу) и продать две остальные.
   - Короткое кольцо: продать прямой кросс и купить остальные ноги.
5. Когда абсолютное значение отклонения опускается ниже порога выхода, закрыть все позиции.
6. При необходимости дополнительно закрыть позиции в методе `OnStopped`.

## Особенности использования

- Требуется наличие всех трёх инструментов у провайдера ценных бумаг. При необходимости используйте параметры префикса и суффикса для соответствия обозначениям брокера.
- Для максимальной совместимости с оригинальным советником сделки выполняются рыночными ордерами.
- Стратегия не накапливает несколько корзин одновременно: новая позиция открывается только при отсутствии любой открытой ноги.
- Один экземпляр стратегии обслуживает только одно кольцо. Для других комбинаций запустите дополнительные экземпляры.

## Отличия от оригинального советника

- Версия для StockSharp фокусируется на одном кольце, тогда как MQL-реализация может обслуживать до 56 колец.
- Сложные функции управления капиталом (автолоты, прогрессии, таймеры) заменены простым параметром `Order Volume`.
- Визуальная панель и расширенное логирование из оригинала не реализованы.
- Ограничения торговых сессий и контроль проскальзывания отсутствуют; при необходимости используйте механизмы риск-менеджмента StockSharp.

## Рекомендации по тестированию

Для тестирования выберите три форекс-инструмента с общей валютной базой и синхронизированными свечами. Настройте пороги входа и выхода в соответствии с волатильностью выбранных пар.
