# Стратегия Four Hour Swing

## Обзор
**Four Hour Swing Strategy** переносит советник MetaTrader "4H swing" на высокоуровневый API StockSharp. Оригинальная система сочетает трендовые фильтры и осцилляторы из старших таймфреймов. В версии на C# создаются три подписки на свечи (рабочий, подтверждающий и макрофильтр), а индикаторы построены на стандартных компонентах StockSharp.

## Логика торговли
- Основной фильтр тренда использует три экспоненциальные скользящие средние по типичной цене свечей входа. Для покупки требуется условие `Fast EMA > Medium EMA > Slow EMA`, для продажи — обратное.
- Стохастик рассчитывается на старшем подтверждающем таймфрейме: линия %K должна находиться выше %D для лонга и ниже %D для шорта.
- Индикатор Momentum анализирует тот же набор свечей и переводится в метатрейдеровский формат вокруг уровня 100. Сделка разрешается, если хотя бы одно из трёх последних значений отстоит от 100 больше заданного порога.
- Макрофильтр строится на значениях MACD: для длинных позиций требуется превышение линии MACD над сигнальной, для коротких — обратная ситуация.

После выполнения всех условий на следующей рабочей свече отправляется рыночная заявка. Если стратегия уже находится в противоположной позиции, новый ордер закрывает её и разворачивает направление.

## Управление рисками
- Сразу после входа выставляются фиксированные стоп-лосс и тейк-профит (в пипсах).
- При ненулевом `TrailingStopPips` активируется классический трейлинг от экстремума, достигнутого после входа.
- Перевод в безубыток переносит стоп к цене входа плюс смещение после достижения заданной прибыли.
- Дополнительный флаг `UseMacdExit` закрывает позицию при смене сигнала макрофильтра MACD.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `TradeVolume` | Базовый объём рыночных заявок. | `0.01` |
| `CandleType` | Таймфрейм свечей для поиска входов. | `4H` |
| `SignalCandleType` | Таймфрейм для стохастика и Momentum. | `7D` (неделя) |
| `MacdCandleType` | Таймфрейм MACD-фильтра. | `30D` |
| `FastEmaPeriod`, `MediumEmaPeriod`, `SlowEmaPeriod` | Периоды EMA по типичной цене. | `4`, `14`, `50` |
| `StochasticKPeriod`, `StochasticDPeriod`, `StochasticSmoothPeriod` | Настройки стохастика. | `13`, `5`, `5` |
| `MomentumPeriod` | Глубина индикатора Momentum. | `14` |
| `MomentumThreshold` | Минимальное отклонение от 100 для подтверждения импульса. | `0.3` |
| `StopLossPips`, `TakeProfitPips` | Расстояние стоп-лосса и тейк-профита в пипсах. | `20`, `50` |
| `TrailingStopPips` | Шаг трейлинг-стопа (0 — отключён). | `40` |
| `UseBreakEven` | Включает перевод в безубыток. | `true` |
| `BreakEvenTriggerPips`, `BreakEvenOffsetPips` | Порог и смещение при переводе в безубыток. | `30`, `30` |
| `UseMacdExit` | Закрывать позицию при обратном сигнале MACD. | `false` |

## Примечания
- Денежные и процентные ограничения из оригинального советника не реализованы, чтобы сохранить компактность стратегии.
- Обработка ведётся только по завершённым свечам, что повторяет поведение MetaTrader.
- При необходимости любой параметр `DataType` можно изменить и адаптировать стратегию под другой набор таймфреймов.
