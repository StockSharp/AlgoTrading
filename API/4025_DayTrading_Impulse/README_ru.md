# Стратегия Day Trading Impulse

## Общее описание

**DayTrading Strategy** — это точная конвертация советника MetaTrader 4 «DayTrading», опубликованного компанией NazFunds в 2005 году. Алгоритм рассчитан на пятиминутные графики Forex и объединяет несколько трендовых и моментум-индикаторов, чтобы брать краткосрочные импульсы с небольшим тейк-профитом и при необходимости сопровождать сделку трейлинг-стопом. Версия на StockSharp полностью повторяет логику MQL-скрипта и одновременно делает ключевые параметры доступными для оптимизации.

## Набор индикаторов

Для выбранной свечной серии рассчитываются четыре индикатора:

- **Parabolic SAR** (`ParabolicSar`) с настраиваемыми коэффициентами ускорения, шага и максимума. Индикатор определяет базовый тренд и должен сменить сторону относительно цены, чтобы разрешить новую сделку.
- **MACD (12, 26, 9)** (`MovingAverageConvergenceDivergenceSignal`). Линия MACD должна находиться ниже сигнальной для покупок и выше для продаж, что соответствует сравнению гистограммы и сигнальной линии в оригинальном советнике.
- **Стохастик (5, 3, 3)** (`StochasticOscillator`). Линия %K должна быть ниже 35 для лонгов и выше 60 для шортов, подтверждая выход из зоны перепроданности/перекупленности.
- **Momentum (14)** (`Momentum`). Значение ниже 100 разрешает покупки, выше 100 — продажи.

Все индикаторы подключены через высокоуровневый метод `BindEx`, поэтому нет необходимости вручную управлять буферами или обращаться к прошлым значениям.

## Правила торговли

### Условия входа

**Лонг** открывается на последней сформированной свече, если выполняются условия:

1. Точка Parabolic SAR находится на уровне или ниже текущей цены ask, а предыдущая точка была выше текущей (свежий разворот SAR вверх).
2. Momentum < 100.
3. Линия MACD ниже сигнальной.
4. Стохастик %K < 35.

**Шорт** открывается зеркально:

1. Точка Parabolic SAR находится на уровне или выше текущей цены bid, а предыдущая точка была ниже текущей (разворот вниз).
2. Momentum > 100.
3. Линия MACD выше сигнальной.
4. Стохастик %K > 60.

В позиции может находиться только одна сделка. При появлении противоположного сигнала активная позиция закрывается, и на той же свече новая сделка не открывается — именно так работает сканирование `OrdersTotal` в оригинале.

### Управление выходом

- **Стоп-лосс / тейк-профит:** Необязательные фиксированные дистанции в пунктах переводятся в цену с учётом шага котировки и проверяются на каждой свече. При пробое позиция закрывается.
- **Трейлинг-стоп:** После прохождения ценой заданного числа пунктов активируется сопровождение. Для лонга стоп подтягивается под цену закрытия, для шорта — над ценой. Стоп никогда не откатывается назад, тем самым фиксируя прибыль.
- **Противоположный сигнал:** Валидный сигнал противоположного направления немедленно закрывает текущую позицию до рассмотрения новой сделки.

Стратегия не использует усреднение, сетки или хеджирование — логика остаётся минималистичной, как в исходном EA.

## Параметры

| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `LotSize` | 1 | Объём каждой рыночной заявки. При запуске значение синхронизируется со свойством `Strategy.Volume`. |
| `TrailingStopPoints` | 15 | Дистанция трейлинг-стопа в пунктах. Ноль — отключить сопровождение. |
| `TakeProfitPoints` | 20 | Фиксированный тейк-профит в пунктах. Ноль — без цели. |
| `StopLossPoints` | 0 | Стоп-лосс в пунктах. Ноль воспроизводит оригинальную работу без стопа. |
| `SlippagePoints` | 3 | Допустимое проскальзывание (параметр сохранён для совместимости, но не используется напрямую). |
| `CandleType` | 5-минутные свечи | Свечная серия для расчёта индикаторов. Для повторения оригинала оставьте M5. |
| `MacdFastPeriod` | 12 | Период быстрой EMA в MACD. |
| `MacdSlowPeriod` | 26 | Период медленной EMA в MACD. |
| `MacdSignalPeriod` | 9 | Период сигнальной EMA MACD. |
| `StochasticLength` | 5 | Длина %K стохастика. |
| `StochasticSignal` | 3 | Период сглаживания %D. |
| `StochasticSlow` | 3 | Дополнительное сглаживание %K. |
| `MomentumPeriod` | 14 | Длина расчёта Momentum. |
| `SarAcceleration` | 0.02 | Начальный коэффициент ускорения Parabolic SAR. |
| `SarStep` | 0.02 | Шаг увеличения ускорения. |
| `SarMaximum` | 0.2 | Максимальное ускорение Parabolic SAR. |

Все числовые параметры помечены для оптимизации, поэтому их легко исследовать в оптимизаторе StockSharp.

## Особенности реализации

- Цены bid/ask берутся из Level1, если данные доступны, либо подставляется цена закрытия свечи — это делает стратегию устойчивой при тестировании на исторических свечах.
- Перевод пунктов в цену выполняется через `Security.Step`/`PriceStep`. При отсутствии шага используется запасное значение `0.0001`, соответствующее стандартному форексному пункту.
- Позиция всегда одиночная: стратегия не переворачивается в обе стороны одновременно и не наращивает объём.
- Все комментарии в коде даны на английском в соответствии с требованиями репозитория, а расширенная документация приведена в README.

## Рекомендации по применению

1. Назначьте нужную валютную пару, оставьте таймфрейм 5 минут и запустите стратегию — индикаторы прогреются автоматически.
2. Для реальной торговли рекомендуем задать ненулевой стоп-лосс: оригинальный советник предлагал торговать без него, но трейлинг-стоп может не защитить счёт от резкого разворота.
3. Стратегию можно включать в корзину `BasketStrategy` и управлять капиталом извне, пользуясь тем, что все ключевые пороги доступны как параметры.

Подробные описания на английском и китайском языках находятся в этой же папке.
