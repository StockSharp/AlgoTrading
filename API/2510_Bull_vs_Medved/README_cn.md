# Bull vs Medved 策略
[English](README.md) | [Русский](README_ru.md)

Bull vs Medved 是从 MetaTrader 5 移植而来的限价突破策略。策略监控最近三根已完成的 K 线，只在一天内六个可配置的五分钟时间窗口内允许下单。当出现指定的多头或空头蜡烛组合时，策略会按照与当前买卖价差的固定偏移放置挂单，并使用对称的止损与止盈保护头寸。

## 交易逻辑

1. **交易窗口**：仅当当前时间处于六个时间窗口之一时才会评估信号（默认窗口为 00:05、04:05、08:05、12:05、16:05、20:05，每个窗口持续 5 分钟）。一旦离开窗口，单窗口只下一单的限制会被重置。
2. **所需数据**：策略至少等待三根完整的蜡烛。所有条件都基于最近三根已收盘蜡烛的开收价。
3. **多头条件**：
   - **常规多头**：倒数第三根蜡烛收于第二根的开盘价之上，第二根的实体至少为 1 个点，最近一根蜡烛的实体大于 `CandleSizePips`。
   - **劣质多头过滤**：若三根蜡烛的实体都很大且方向一致，则忽略信号，以避免追入过度拉升。
   - **“冷静多头”**：若第二根蜡烛出现至少 2 个点的看跌回撤，则最新一根必须重新站上该回撤且实体不小于 `CandleSizePips` 的 40%。常规多头（未被过滤）或“冷静多头”任意满足即可触发做多。
   - 满足做多条件时，在最佳卖价下方 `IndentUpPips` 的距离放置 **buy limit** 挂单（自动转换为价格单位）。
4. **空头条件**：若最近一根蜡烛的看跌实体超过 `CandleSizePips`，则在最佳买价上方 `IndentDownPips` 位置放置 **sell limit** 挂单。
5. **风控管理**：订单成交后立即使用配置的点数距离附加绝对止损和止盈。
6. **订单管理**：每个时间窗口仅允许发送一张挂单，并且在同一标的仍有活动的限价单时不会再次下单。

## 参数

- `OrderVolume` – 挂单的交易数量。
- `CandleSizePips` – 最近一根蜡烛所需的最小实体（点）。
- `StopLossPips` – 止损距离，按点数从入场价计算。
- `TakeProfitPips` – 止盈距离。
- `IndentUpPips` – buy limit 相对于最佳卖价的下移距离。
- `IndentDownPips` – sell limit 相对于最佳买价的上移距离。
- `EntryWindowMinutes` – 每个交易窗口的持续时间。
- `CandleType` – 用于判断形态的 K 线周期。
- `StartTime0` … `StartTime5` – 六个交易窗口的起始时间。

## 其他说明

- 策略订阅盘口数据以获得最新买价与卖价用于精确挂单；如果盘口暂不可用，则退化为使用最近一根蜡烛的收盘价。
- 所有距离会根据 3 位或 5 位报价自动转换为标准“点”单位。
- 止损/止盈通过 `StartProtection` 创建，因此目标价位会根据实际成交价动态设置。
