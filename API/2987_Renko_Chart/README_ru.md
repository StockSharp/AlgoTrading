# Стратегия Renko Chart
[English](README.md) | [中文](README_cn.md)

## Обзор
`RenkoChartStrategy` — это конвертация эксперта **RenkoChart.mq5**, которая не совершает сделок, а воспроизводит
механику построения пользовательского символа Renko внутри StockSharp. Стратегия подписывается на тиковые данные,
агрегирует их в свечи Renko с настраиваемым размером брикеты и публикует поток свечей для визуализации или дальнейшей
обработки. Каждая завершённая брикета логируется вместе с последним тиком, вызвавшим обновление, что позволяет
сопоставить результат с исходной реализацией в MetaTrader.

## Соответствие параметров MQL
- **StartDateTime** → `StartTime`: начальная отметка времени, с которой начинается построение истории Renko.
- **BaseSymbol** → `Strategy.Security`: в StockSharp базовый инструмент задаётся самим коннектором, поэтому параметр
  заменён использованием выбранного `Security`. Для сохранения соглашения «Renko-\<symbol\>» используется префикс
  `RenkoPrefix` в логах и подписи графика.
- **Mode (Bid/Last)** → `UseBidTicks`: определяет, использовать ли поток бидов или сделок при отслеживании текущего тика.
- **Range** → `BrickSizeSteps`: количество ценовых шагов в одной брикете. Значение умножается на `PriceStep` инструмента,
  чтобы получить абсолютный размер бокса.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `StartTime` | `DateTimeOffset` | 01.08.2018 09:00:00 UTC | Свечи с временем открытия раньше этой отметки игнорируются, как и в MQL-версии. |
| `BrickSizeSteps` | `int` | 5 | Размер брикеты в шагах цены. При создании подписки переводится в абсолютное значение. |
| `UseBidTicks` | `bool` | `false` | При `false` используется поток сделок, при `true` — поток бидов (режим `Bid`). |
| `RenkoPrefix` | `string` | `"Renko-"` | Префикс для имени виртуального символа, который появляется в логах и на графике. |

> **Примечание.** Свойство `BrickSize` отражает абсолютный размер брикеты и может использоваться другими компонентами,
> которым нужны значения в ценовых единицах.

## Логика работы
1. В `GetWorkingSecurities` создаётся подписка на свечи Renko с типом `RenkoBuildFrom.Points` и рассчитанным размером брикеты.
2. В `OnStarted` запускается подписка, добавляется мониторинг тиков (биды или сделки) и, при наличии, строится график свечей.
3. `ProcessTrade` и `ProcessLevel1` сохраняют последний тик и его время для детализированного логирования.
4. `ProcessCandle` пропускает незавершённые свечи, фильтрует данные до `StartTime` и фиксирует каждую готовую брикету с
   указанием предыдущего и нового закрытия, а также последнего тика.

## Рекомендации по использованию
- Подключайте стратегию к инструментам, предоставляющим сделки или данные Level1. Поток Renko появится в стандартной
  области графика с заданным префиксом.
- Стратегия не выставляет заявки, поэтому её можно запускать параллельно с торговыми алгоритмами, чтобы получать
  синхронизированное представление рынка в виде Renko.
- Записи в журнале содержат направление брикеты и тик, который её сформировал, что упрощает сверку с выгрузкой из MetaTrader.

## Отличия от исходной версии
- Создание пользовательского символа заменено публикацией данных через стандартные механизмы StockSharp и подробными логами.
- Вместо массивов используются встроенные средства построения Renko на десятичных величинах.
- Конвертация следует концепции подписок и защиты позиций StockSharp, поэтому при необходимости стратегию легко дополнить
  торговыми правилами.
