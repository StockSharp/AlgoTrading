# Стратегия Master Mind Triple WPR

## Обзор
- Портированная версия советника MetaTrader 4 `MasterMind3CE` (каталог `MQL/8458`).
- Использует сразу четыре индикатора Williams %R с периодами 26, 27, 29 и 30 для выявления экстремальных зон перекупленности/перепроданности.
- Ориентирована на возврат к среднему: покупки после сильных распродаж и продажи после чрезмерного роста.
- Включает настраиваемые стоп-лосс, тейк-профит и необязательный трейлинг-стоп в шагах цены инструмента.
- Работает на любом таймфрейме, поддерживаемом StockSharp; по умолчанию применяются 15-минутные свечи.

## Логика торговли
### Индикаторы
- `WilliamsR(26)` — сверхбыстрый осциллятор.
- `WilliamsR(27)` — быстрый осциллятор для подтверждения.
- `WilliamsR(29)` — среднесрочный сглаживающий фильтр.
- `WilliamsR(30)` — более медленный осциллятор, требующий совпадения экстремумов.

Все четыре индикатора должны сформироваться. Обработка ведётся только по закрытым свечам, что соответствует поведению оригинала с параметром `TradeAtCloseBar = true`.

### Условия входа
- **Покупка**: все Williams %R ниже или равны `OversoldLevel` (по умолчанию `-99.99`). Стратегия стремится к длинной позиции объёмом `TradeVolume`. При наличии шорта он закрывается и позиция переворачивается за одну рыночную заявку.
- **Продажа**: все Williams %R выше или равны `OverboughtLevel` (по умолчанию `-0.01`). Цель — короткая позиция `TradeVolume`, при открытом лонге он сначала закрывается.

### Условия выхода
- **Смена сигнала**: противоположное условие закрывает или переворачивает позицию.
- **Стоп-лосс**: опциональная дистанция в шагах цены от средней цены входа. Попадание в диапазон свечи приводит к рыночному выходу.
- **Тейк-профит**: опциональная цель в шагах цены от средней цены входа.
- **Трейлинг-стоп**: запускается после движения цены на `TrailingStopSteps + TrailingStepSteps` в прибыльную сторону. Стоп удерживается на расстоянии `TrailingStopSteps` от закрытия и обновляется только при улучшении не менее чем на `TrailingStepSteps`.

## Управление рисками
Все расстояния задаются в шагах цены инструмента (PriceStep). Например, при `PriceStep = 0.0001` и `StopLossSteps = 2000` стоп располагается в 0.2000 от входа. При добавлении к позиции средняя цена пересчитывается, чтобы стопы и цели оставались согласованными. Трейлинг-стоп отключён, если любое из значений `TrailingStopSteps` или `TrailingStepSteps` равно нулю.

## Параметры
| Название | Описание | Значение по умолчанию |
| --- | --- | --- |
| `TradeVolume` | Целевой чистый объём позиции (лоты/контракты). | `1` |
| `OversoldLevel` | Порог перепроданности Williams %R. | `-99.99` |
| `OverboughtLevel` | Порог перекупленности Williams %R. | `-0.01` |
| `StopLossSteps` | Дистанция стоп-лосса в шагах цены (`0` отключает). | `2000` |
| `TakeProfitSteps` | Дистанция тейк-профита в шагах цены (`0` отключает). | `0` |
| `TrailingStopSteps` | Дистанция трейлинг-стопа в шагах цены (требует `TrailingStepSteps > 0`). | `0` |
| `TrailingStepSteps` | Минимальное улучшение для сдвига трейлинг-стопа (в шагах цены). | `1` |
| `CandleType` | Тип/таймфрейм свечей для расчёта. | `TimeFrame(15m)` |

## Особенности портирования
- Из оригинала удалены звуковые оповещения, отправка писем и логирование в файлы; вместо этого можно использовать стандартные журналы StockSharp.
- В МТ4 разрешались сделки до закрытия бара, но версия для StockSharp обрабатывает только завершённые свечи, повторяя типичную настройку советника.
- Механизмы MetaTrader (magic number, повторные попытки, рисование объектов) не имеют прямых аналогов и опущены.
- Управление стопами выполняется внутри стратегии без постоянных модификаций заявок; проверки выполняются на каждой новой свече.

## Рекомендации по применению
1. Выберите инструмент и таймфрейм, максимально близкие к исходному окружению советника.
2. При необходимости адаптируйте уровни и риск-параметры под волатильность инструмента.
3. Запустите стратегию — она подпишется на свечи, отслеживает экстремумы Williams %R и управляет позициями согласно логике.
