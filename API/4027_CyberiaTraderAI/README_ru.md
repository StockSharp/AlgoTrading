# Стратегия Cyberia Trader AI

Стратегия представляет собой порт на StockSharp исходного советника **CyberiaTrader.mq4 (build 8553)**. В оригинале алгоритм
сочетает вероятностную модель и набор дополнительных фильтров. В переводе сохранена та же логика: модель подбирает лучший
период выборки, а затем фильтры MACD, EMA и детектор разворотов могут запретить или разрешить сделки.

## Индикаторы и внутренняя модель

- **Вероятностный движок** — перебирает кандидаты от 1 до `MaxPeriod` и для каждого анализирует `SamplesPerPeriod` исторических
  отрезков. Для каждого периода вычисляются:
  - Направление (покупка/продажа/ожидание) на основе последовательностей минутных свечей с шагом равным периоду.
  - Средние амплитуды "возможностей" для покупок, продаж и неопределённых состояний, а также доля успешных случаев выше
    `SpreadThreshold`.
  - Лучший период определяется максимальным отношением успешных исходов.
- **EMA-фильтр тренда** (`EnableMa`) — запрещает сделки против текущего наклона EMA.
- **MACD-фильтр** (`EnableMacd`) — блокирует сделки против направленного импульса.
- **Детектор разворотов** (`EnableReversalDetector`) — инвертирует разрешения, если текущие возможности превышают средние значения
  более чем в `ReversalFactor` раз.

## Параметры

| Имя | Описание |
| --- | --- |
| `MaxPeriod` | Максимальный тестируемый шаг выборки для вероятностной модели. |
| `SamplesPerPeriod` | Количество отрезков истории на каждый кандидат периода. |
| `SpreadThreshold` | Минимальная амплитуда, считающаяся успешным исходом. |
| `EnableCyberiaLogic` | Включает оригинальные переключатели, блокирующие покупки или продажи. |
| `EnableMacd` | Включает фильтр MACD. |
| `EnableMa` | Включает фильтр по наклону EMA. |
| `EnableReversalDetector` | Включает детектор резких разворотов. |
| `MaPeriod` | Длина EMA в трендовом фильтре. |
| `MacdFast` / `MacdSlow` / `MacdSignal` | Периоды MACD (быстрый, медленный и сигнальный). |
| `ReversalFactor` | Множитель, запускающий детектор разворотов. |
| `CandleType` | Тип используемых свечей (по умолчанию 1 минута). |
| `TakeProfitPercent` | Процентное значение take-profit. |
| `StopLossPercent` | Процентное значение stop-loss. |

## Логика торговли

1. После формирования свечи история обновляется, и для всех периодов от 1 до `MaxPeriod` пересчитываются статистики. Наилучший
   период — тот, у которого максимальная доля успешных исходов.
2. Cyberia-логика выставляет флаги `DisableBuy` и `DisableSell` аналогично MQL:
   - Сравнивает средние возможности покупок/продаж и их успех при увеличении или уменьшении периода.
   - Запрещает новый сигнал, если текущая возможность больше успешной средней более чем вдвое.
3. Фильтры применяются последовательно: MACD → EMA → детектор разворотов.
4. При отсутствии позиции стратегия открывает сделку по направлению решения, если соответствующая возможность превышает свою
   успешную среднюю и противоположное направление заблокировано.
5. При наличии позиции она закрывается, когда вероятностная модель меняет решение или фильтры запрещают текущее направление.
6. Вызов `StartProtection` активирует защиту позиции при ненулевых параметрах риска.

## Особенности перевода

- Вместо проверки по фактическому спреду используется параметр `SpreadThreshold`.
- Автоматический расчёт объёма и вывод информации о счёте опущены; объём контролируется через свойство `Volume` стратегии.
- Блоки MoneyTrain и Pipsator сведены к единой логике входа/выхода в соответствии с высокоуровневым API StockSharp.
- Для наглядности добавлено отображение свечей, EMA и MACD на графике в дизайнере.
