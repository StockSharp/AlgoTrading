# Twenty 200 Pips 策略

## 概述
该策略复刻了 MQL5 顾问 **20/200 pips** 的思想。它分析小时K线，并比较两个历史开盘价
(`Open[t1]` 和 `Open[t2]`)。当在指定小时内这两个开盘价之间的差值超过阈值时，策略只
会在当天开立一笔仓位，同时依赖固定的止盈和止损。

## 交易逻辑
1. 订阅所需周期的K线（默认 1 小时），并将开盘价输入两个 `Shift` 指标，用于直接获取
   对应索引处的开盘价，而无需维护自定义数组。
2. 每根完结的K线都会检查当前小时是否已经大于设置的 `TradeHour`，如果是则重新允许
   下一笔交易，从而复制原始顾问的每日重置逻辑。
3. 当当前小时与 `TradeHour` 相等、没有持仓且允许交易时，比较保存的开盘价：
   - 如果 `Open[t1] > Open[t2] + delta`，提交市价卖单。
   - 如果 `Open[t1] + delta < Open[t2]`，提交市价买单。
4. 发送订单后会立即禁止新的入场，直到下一次时间窗口再次打开。`StartProtection`
   负责自动挂出止盈和止损。

## 参数
- `TakeProfit` – 止盈距离（以价格点数表示，默认 200 点）。
- `StopLoss` – 止损距离（以价格点数表示，默认 2000 点）。
- `TradeHour` – 检查信号的小时（0-23，默认 18）。
- `FirstOffset` – 较旧的开盘价索引（对应 MQL 中的 `Open[t1]`，默认 7）。
- `SecondOffset` – 较新的开盘价索引（对应 `Open[t2]`，默认 2）。
- `DeltaPoints` – 触发交易所需的最小开盘价差（默认 70 点）。
- `Volume` – 市价单的下单数量（默认 0.1）。
- `CandleType` – 计算时使用的K线类型（默认 1 小时）。

## 实现细节
- 通过手动调用 `Shift` 指标来读取历史开盘价，避免创建额外的数据集合。
- 在 `OnStarted` 中调用一次 `StartProtection`，以模拟原始顾问中为每笔交易设置的止盈
  和止损。
- 代码中添加了英文注释，方便审阅和后续维护。
- 每天只允许一次入场：下单后 `_canTrade` 立即被清零，只有在当前小时再次超过
  `TradeHour` 时才会恢复。

## 使用方式
1. 将策略附加到目标证券上，并根据交易品种调整参数。
2. 确保证券定义了有效的 `PriceStep`，因为点数参数会依据该值转换成绝对价格距离。
3. 启动策略后，它会等待设定的小时，并在下一根完成的K线上检查开盘价差异以决定是否
   入场。
