# Стратегия масштабирования лота

## Обзор

**Lot Size Scaling Strategy** — это прямая конвертация скрипта MetaTrader 4 `LotSize.mq4`. Исходник представлял собой огромную таблицу соответствий между текущим балансом счёта и рекомендуемым торговым объёмом. В версии для StockSharp сохранено исходное поведение: рассчитанный объём передаётся через свойство `Strategy.Volume`, а также отображается в комментарии стратегии.

Стратегия не выставляет заявки автоматически. Её задача — вычислять актуальный объём, который может использоваться другими алгоритмами или вручную. Таблица покрывает диапазон балансов от 20 до 294 635 единиц и объёмы от 0.01 до 100 лотов.

## Логика работы

1. Таблица «баланс → объём» генерируется напрямую из оригинального MQL-кода и содержит 1 090 записей.
2. При запуске, изменении PnL или появлении собственной сделки стратегия:
   - Считывает текущий баланс портфеля (или использует параметр `MinimumBalance`, если портфель ещё не загружен).
   - Находит максимальную запись таблицы, не превышающую баланс.
   - Присваивает найденный объём в свойства `Volume` и `RecommendedVolume`.
   - Выводит данные в комментарий стратегии для удобного контроля из интерфейса.
3. Ни одна заявка не регистрируется автоматически — рассчитанный объём необходимо использовать в составе другого алгоритма.

## Параметры

| Название | Описание | Значение по умолчанию |
| --- | --- | --- |
| `MinimumBalance` | Нижняя граница, применяемая до появления реального значения портфеля. | `20` |
| `MinimumVolume` | Стартовый объём, применяемый при балансе ниже первой записи таблицы. | `0.01` |

Параметры можно изменять, однако таблица всегда повторяет исходное сопоставление из MQL.

## Примечания

- Сохранены все неровности исходной таблицы (например, чередование шагов 294/295 после объёма 2.0).
- Используйте стратегию как вспомогательный модуль, если требуется зависимость объёма от баланса.
- При старте вызывается `StartProtection()`, чтобы активировать штатную защиту StockSharp для внешних потребителей объёма.
