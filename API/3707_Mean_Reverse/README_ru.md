# Стратегия Mean Reverse

## Общее описание
Стратегия Mean Reverse повторяет советника "MeanReversionTrendEA" и объединяет трендовую компоненту, основанную на пересечении скользящих средних, с модулем возврата к среднему, который использует волатильностные полосы ATR. Сделка открывается, когда цена подтверждает смену тренда либо уходит слишком далеко от медленной скользящей средней на величину, заданную умножителем ATR.

## Логика торговли
- **Трендовая часть**: сигнал на покупку формируется, когда быстрая простая скользящая средняя (SMA) пересекает сверху медленную SMA. Сигнал на продажу появляется при обратном пересечении.
- **Часть возврата к среднему**: покупка активируется, если цена закрытия опускается ниже медленной SMA более чем на `ATR × Multiplier`. Продажа запускается, если цена закрытия поднимается выше медленной SMA на ту же дистанцию.
- **Комбинация сигналов**: как только хотя бы один из модулей даёт сигнал и позиция отсутствует, стратегия открывает сделку указанным объёмом.

## Управление позицией
- **Стоп-лосс**: сразу после входа рассчитывается уровень `вход − StopLossPoints × Step` для длинных позиций или `вход + StopLossPoints × Step` для коротких. При достижении этого уровня экстремумом свечи позиция закрывается.
- **Тейк-профит**: одновременно выставляется цель `вход + TakeProfitPoints × Step` для покупок либо `вход − TakeProfitPoints × Step` для продаж. Достижение уровня закрывает позицию.
- **Ограничение на количество сделок**: одновременно может быть открыта только одна позиция, повторные сигналы игнорируются до её закрытия.
- **Модуль безопасности**: вызов `StartProtection()` воспроизводит защитный блок оригинального эксперта и предотвращает неожиданные состояния позиции.

## Индикаторы
- **Простая скользящая средняя (SMA)** с периодом `FastMaPeriod`.
- **Простая скользящая средняя (SMA)** с периодом `SlowMaPeriod`.
- **Average True Range (ATR)** с периодом `AtrPeriod`.

Все индикаторы получают данные из одной подписки на свечи, заданной параметром `CandleType`.

## Параметры
| Имя | Описание | Значение по умолчанию |
|-----|----------|------------------------|
| `FastMaPeriod` | Период быстрой SMA для тренда и полос возврата. | 20 |
| `SlowMaPeriod` | Период медленной SMA, определяющей среднее значение. | 50 |
| `AtrPeriod` | Количество свечей для вычисления ATR. | 14 |
| `AtrMultiplier` | Множитель ATR, задающий ширину отклонения. | 2.0 |
| `StopLossPoints` | Расстояние стоп-лосса в шагах цены `Security.Step`. | 500 |
| `TakeProfitPoints` | Расстояние тейк-профита в шагах цены `Security.Step`. | 1000 |
| `TradeVolume` | Объём заявки при открытии позиции. | 1 |
| `CandleType` | Тип свечей, подаваемых на индикаторы. | Таймфрейм 1 час |

## Примечания
- По умолчанию используется часовой таймфрейм, что соответствует логике "текущего периода" в MetaTrader. При необходимости выберите другой.
- ATR-диапазоны рассчитываются по цене закрытия, что эквивалентно среднему между Bid и Ask в исходной реализации.
- Параметры помечены для оптимизации, что облегчает подбор настроек под разные инструменты.
