# Стратегия The Predator

## Обзор

Стратегия представляет собой конвертацию советника MQL **"The Predator"** на высокоуровневый API StockSharp. Оригинальная версия совмещает трендовые фильтры с импульсными показателями, полосами Боллинджера и стохастиком. В распоряжении остаются два шаблона входа (Strategy 1 и Strategy 2), полностью повторяющие режимы из MQL.

Все вычисления выполняются на одной настраиваемой серии свечей. Подписки и индикаторы подключаются через механизмы `SubscribeCandles` и `Bind`/`BindEx`, что позволяет обойтись без ручного хранения историй.

## Используемые индикаторы

- **Линейные взвешенные скользящие средние (LWMA)** — быстрый и медленный фильтр тенденции.
- **DMI + ADX** — сила и направление тренда.
- **Momentum (по умолчанию период 14)** — оценивает удалённость от нейтрального уровня 100.
- **Полосы Боллинджера** — две оболочки (узкая и широкая) для анализа контекста предыдущей свечи.
- **Стохастический осциллятор** — дополнительный фильтр для Strategy 2.
- **MACD** — подтверждение импульса через сравнение основной и сигнальной линий.

## Логика торговли

### Общие условия

1. Обрабатываются только завершённые свечи.
2. Перед торгами проверяется готовность индикаторов (`IsFormedAndOnlineAndAllowTrading`).
3. ADX должен превышать заданный порог.
4. Сохраняются три последних отклонения Momentum от уровня 100 (без обращения к `GetValue`).

### Strategy 1

- **Покупка**:
  - ADX выше порога и +DI превышает −DI.
  - Быстрая LWMA выше медленной.
  - Отклонение Momentum за один из последних трёх отсчётов превышает порог на покупку.
  - MACD выше сигнальной линии.
- **Продажа** — зеркальные условия.

### Strategy 2

- **Покупка** дополнительно требует:
  - Закрытие предыдущей свечи не ниже узкой нижней полосы Боллинджера.
  - Стохастик: и основная, и сигнальная линии выше верхнего порога.
  - Отклонение Momentum ниже порога покупки хотя бы в одном из трёх значений (поиск откатов в тренде).
- **Продажа** дополнительно требует:
  - Закрытие предыдущей свечи не выше узкой верхней полосы.
  - Стохастик: сигнальная линия выше верхнего порога, основная ниже нижнего порога.
  - Отклонение Momentum ниже порога продажи хотя бы раз за три отсчёта.

### Управление позицией

- Перед открытием нового ордера отменяются все активные заявки.
- При смене направления существующая позиция закрывается и открывается новая противоположная одним маркет-ордером соответствующего объёма.

## Управление рисками

- `StartProtection` задаёт:
  - Стоп-лосс в пунктах.
  - Тейк-профит в пунктах.
  - При необходимости — трейлинг-стоп в фиксированном размере.
- Все расстояния пересчитываются в абсолютные цены через минимальный шаг инструмента.
- Денежные тралы, безубыток и уведомления из MQL-версии не перенесены, вместо них применены пунктовые параметры.

## Параметры

| Параметр | Описание |
|----------|----------|
| `Mode` | Выбор шаблона Strategy 1 или Strategy 2. |
| `FastMaLength`, `SlowMaLength` | Периоды быстрый/медленной LWMA. |
| `DmiPeriod`, `AdxSmoothing` | Настройки DMI/ADX. |
| `MomentumPeriod` | Период расчёта Momentum. |
| `MomentumBuyThreshold`, `MomentumSellThreshold` | Минимальное отклонение от 100 для сигналов. |
| `AdxThreshold` | Минимальный уровень ADX для работы. |
| `BollingerPeriod`, `TightBandWidth`, `WideBandWidth` | Параметры полос Боллинджера. |
| `StochasticLength`, `StochasticSmooth`, `StochasticUpper`, `StochasticLower` | Настройки стохастика для Strategy 2. |
| `TradeVolume` | Торговый объём. |
| `StopLossPips`, `TakeProfitPips`, `TrailingStopPips` | Расстояния стопов/тейков/трейлинга в пунктах. |
| `CandleType` | Тип свечей для анализа. |

## Отличия от оригинала

- Денежные стопы и тейк-профиты преобразованы в пунктовые значения и обрабатываются через `StartProtection`.
- Логика безубытка, а также email/notification-сервисы отсутствуют.
- В MQL некоторые индикаторы вызывались на старших таймфреймах. В StockSharp версия работает на выбранной серии; при необходимости можно добавить дополнительные подписки.
- Мартингейл и адаптивный объём заменены на фиксированный параметр `TradeVolume`.

## Использование

1. Подготовьте соединение и портфель, как в других примерах StockSharp.
2. Создайте экземпляр `ThePredatorStrategy`, назначьте `Security`, `Portfolio` и параметры.
3. Запустите стратегию. При наличии окна графика индикаторы и сделки отобразятся автоматически.

Перевод сохраняет ключевые условия оригинала, но использует рекомендованные подходы StockSharp с привязкой индикаторов и стандартным блоком защиты позиций.
