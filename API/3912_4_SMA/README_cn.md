# 4 SMA 策略

## 概述
4 SMA 策略复刻了 MetaTrader 专家顾问 **4 SMA.mq4**。策略在使用中值价(最高价与最低价的平均值)计算的 30 分钟K线上运行，并比较 5、20、40、60 四条简单移动平均线来捕捉动量突破。StockSharp 版本保持了原始程序一次只持有一个方向仓位的行为，并使用高层 API 来完成下单与风控。

## 交易逻辑
- 对每根收盘完成的K线计算中值价 `(high + low) / 2`，并将该值送入四条 SMA 指标。
- **做多开仓** 条件：快线 SMA 高于中线 SMA，中线 SMA 高于慢线 SMA，慢线 SMA 至少高于超慢线一个最小价格步长，同时上一根K线的慢线 SMA 小于或等于超慢线。仅在没有持仓或持有空单时才会入场做多。
- **做空开仓** 条件与之相反：快线 SMA 低于中线 SMA，中线 SMA 低于慢线 SMA，超慢线至少高于慢线一个价格步长，并且上一根K线的慢线 SMA 大于或等于超慢线。仅在没有持仓或持有多单时才会入场做空。

## 仓位管理
- 当慢线下穿超慢线时平掉多单；当慢线上穿超慢线时平掉空单。
- 入场后预先计算止损和止盈价格，距离以点数表示并乘以标的的最小价格步长，与原程序保持一致。
- 价格走出设定的跟踪距离后启动移动止损，每根K线根据收盘价向有利方向平移，且不会回撤。

## 参数
| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| CandleType | 计算所用的K线序列，默认 30 分钟。 | M30 时间框架 |
| TakeProfit | 止盈点数距离。 | 50 |
| StopLoss | 止损点数距离。 | 50 |
| TrailingStop | 移动止损点数距离。 | 11 |
| FastLength | 快线 SMA 长度。 | 5 |
| MediumLength | 中线 SMA 长度。 | 20 |
| SlowLength | 慢线 SMA 长度。 | 40 |
| VerySlowLength | 超慢线 SMA 长度。 | 60 |

所有数值型参数都暴露在 StockSharp 参数界面中，可用于优化。

## 与 MQL 版本的差异
- 原始版本通过修改 MT4 订单的止损来实现移动止损，本移植版改为计算价格并在触发时发送市价单离场。
- 使用价格步长保证策略可在非外汇品种上运行。
- StockSharp 实现依赖 `SubscribeCandles` 等高层 API，并采用参数系统来配置策略，更符合框架最佳实践。
