# Стратегия 4 SMA

## Обзор
Стратегия 4 SMA повторяет советник MetaTrader **4 SMA.mq4**. Расчёты выполняются на 30-минутных свечах по медианной цене (среднее между High и Low). Сравнение четырёх простых скользящих средних с периодами 5, 20, 40 и 60 позволяет находить моменты ускорения тренда. Порт StockSharp сохраняет логику единственной позиции и задействует высокоуровневый API фреймворка.

## Логика торговли
- Для каждой закрытой свечи вычисляется медианная цена `(high + low) / 2`, которая подаётся на вход четырём SMA.
- **Покупка** выполняется, когда быстрая SMA выше средней, средняя выше медленной, медленная превосходит очень медленную минимум на один шаг цены, а значение медленной SMA на предыдущей свече было ниже или равно очень медленной. Сделка открывается только при отсутствии длинной позиции.
- **Продажа** — зеркальные условия: быстрая SMA ниже средней, средняя ниже медленной, очень медленная выше медленной не менее чем на шаг цены, а медленная SMA на предыдущей свече была выше или равна очень медленной. Открывается только при отсутствии короткой позиции.

## Управление позицией
- Длинные позиции закрываются при пересечении медленной SMA вниз через очень медленную, короткие — при обратном пересечении.
- После входа рассчитываются уровни стоп-лосса и тейк-профита. Расстояния измеряются в пунктах и умножаются на шаг цены инструмента, как и в оригинальном коде.
- Трейлинг-стоп активируется после прохождения ценой заданного расстояния. Уровень подтягивается по каждой свече и никогда не отодвигается назад.

## Параметры
| Название | Описание | Значение по умолчанию |
| --- | --- | --- |
| CandleType | Свечной поток для расчётов (по умолчанию 30 минут). | Таймфрейм M30 |
| TakeProfit | Расстояние до тейк-профита в пунктах. | 50 |
| StopLoss | Расстояние до стоп-лосса в пунктах. | 50 |
| TrailingStop | Дистанция трейлинг-стопа в пунктах. | 11 |
| FastLength | Период быстрой SMA. | 5 |
| MediumLength | Период средней SMA. | 20 |
| SlowLength | Период медленной SMA. | 40 |
| VerySlowLength | Период очень медленной SMA. | 60 |

Все числовые параметры доступны для оптимизации через интерфейс StockSharp.

## Отличия от версии MQL
- В MT4 трейлинг реализован через модификацию ордеров, тогда как порт закрывает позицию рыночным приказом при достижении рассчитанного уровня.
- Учёт шага цены позволяет применять стратегию к инструментам с любой минимальной котировкой.
- Реализация построена на высокоуровневых подписках `SubscribeCandles` и системе параметров, что соответствует рекомендациям проекта.
