# Стратегия Hoop Master Breakout

## Обзор
- Конвертация MetaTrader 5 советника **"Hoop master 2"** (автор Владимир Карпутов).
- На каждом новом баре формирует «коробку» вокруг цены и выставляет зеркальные заявки buy stop и sell stop.
- Повторяет поведение оригинала: после убыточного цикла удваивает объём, после прибыльного — возвращает базовый лот.

## Логика торговли
1. Стратегия подписывается на выбранный поток свечей и работает только с завершёнными барами.
2. При нулевой позиции:
   - Размещает **buy stop** выше цены закрытия на расстояние `IndentPips`.
   - Размещает **sell stop** ниже цены закрытия на то же расстояние.
   - «Пункты» MetaTrader переводятся в абсолютную цену через `PriceStep` инструмента. Если у инструмента 3 или 5 знаков после запятой, шаг дополнительно умножается на 10 — как в исходном MQL.
3. Каждая заявка запоминает собственные уровни Stop Loss и Take Profit. При исполнении заявки противоположная снимается, а защитные ордера воссоздаются биржевыми заявками (`SellStop`/`SellLimit` для лонга, `BuyStop`/`BuyLimit` для шорта).
4. Если позицию закрывает защитная заявка, вторая «привязанная» заявка отменяется, чтобы избежать двойного выхода.
5. При включённом трейлинг-стопе уровень стопа подтягивается в сторону прибыли, когда цена прошла минимум `TrailingStopPips`, а улучшение превысило `TrailingStepPips`.
6. После каждого полного цикла (от отсутствия позиции и обратно) считается суммарный PnL. Отрицательный результат умножает рабочий объём на `LossMultiplier`, положительный — возвращает объём к исходному `Volume`.

## Параметры
| Параметр | Описание | Значение по умолчанию | Примечания |
|----------|----------|-----------------------|------------|
| `Volume` | Базовый объём для постановки новых заявок. | Свойство `Volume` стратегии | При убытке умножается на `LossMultiplier`. |
| `StopLossPips` | Дистанция стоп-лосса в пунктах MT5. | `25` | `0` отключает стоп. |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах MT5. | `70` | `0` отключает цель. |
| `TrailingStopPips` | Отступ трейлинг-стопа. | `0` | Ноль — трейлинг выключен. |
| `TrailingStepPips` | Минимальное улучшение перед подтяжкой стопа. | `5` | Используется только при включённом трейлинге. |
| `IndentPips` | Отступ от текущей цены при постановке стоп-заявок. | `15` | Фильтрует шум вокруг последнего закрытия. |
| `LossMultiplier` | Множитель объёма после убыточного цикла. | `2` | Реализует мартингейл из оригинального советника. |
| `CandleType` | Тип/таймфрейм свечей для переармирования. | `1 час` | Настраивается под рабочий график. |

## Управление рисками и защита
- После входа защитные уровни выставляются биржевыми заявками, что сохраняет стопы и профиты даже при отключении стратегии.
- В методе `OnStarted` вызывается `StartProtection()`, чтобы закрыть случайно оставленные позиции.
- Подтяжка стопов выполняется через замену существующих stop-заявок, без рыночных выходов — аналогично MQL-функции `PositionModify`.

## Особенности реализации
- Используется высокоуровневый API StockSharp: подписка на свечи, методы `BuyStop`/`SellStop` для входа и `BuyLimit`/`SellLimit` для тейк-профитов.
- Комментарии в коде написаны на английском языке (требование репозитория); подробное описание доступно в README-файлах.
- Пересчёт пунктов полностью повторяет алгоритм `m_adjusted_point` из MQL, включая корректировку для дробных котировок.
