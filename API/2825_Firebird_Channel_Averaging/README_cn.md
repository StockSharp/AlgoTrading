# Firebird通道均值策略

## 概述
Firebird通道均值策略在StockSharp高阶API上重现MetaTrader 5专家顾问“Firebird v0.60”。策略基于可配置的均线通道进行交易，当价格远离通道时逐步加仓，实现典型的外汇均值回归与网格化风格，并通过以点数计的风控参数控制风险。

## 指标设置
- 计算一种可选的移动平均线（简单、指数、平滑或加权）作为基础线，价格来源（收盘价、高价、低价、中位价等）可配置。
- 将移动平均线按用户定义的百分比向上和向下偏移，得到上下通道边界。

## 入场逻辑
1. **做多条件**
   - 选定的蜡烛价格源收于下轨之下。
   - 当前无持仓，或新的买入价距离最近一次成交至少达到 `Step (pips)`，若设置了 `Step Exponent` 则按持仓数量的幂次放大距离。
   - 相邻开仓之间必须间隔至少两个蜡烛周期。
2. **做空条件**
   - 价格收于上轨之上。
   - 距离和冷却时间检查与做多逻辑相同。

满足信号时策略按设定手数提交市价单。策略始终保持单向持仓，出现反向信号时需等待现有仓位通过止盈/止损退出。

## 仓位管理
- 策略保存每一笔开仓记录，以便计算当前网格的平均价格。
- 止损和止盈以点数定义。单笔仓位时，止损为入场价减/加 `Stop Loss (pips)`，止盈为入场价加/减 `Take Profit (pips)`。
- 多笔仓位时，将止损距离按持仓数量平均分摊，模拟原始专家顾问的均价保护逻辑。
- 止盈始终基于平均价格设定，而止损在每根蜡烛上都会重新计算。
- 可通过参数禁止周五交易。

## 参数
| 参数 | 说明 |
| --- | --- |
| `Volume` | 每次加仓的手数（默认0.1）。 |
| `Stop Loss (pips)` | 止损距离（点）（默认50）。 |
| `Take Profit (pips)` | 止盈距离（点）（默认150）。 |
| `MA Period` | 移动平均线周期（默认10）。 |
| `MA Shift` | 将移动平均线向前平移的蜡烛数量。 |
| `MA Type` | 移动平均类型：Simple、Exponential、Smoothed 或 Weighted。 |
| `Price Source` | 用于指标计算的蜡烛价格（默认收盘价）。 |
| `Channel %` | 通道相对均线的百分比偏移（默认0.3%）。 |
| `Trade Friday` | 是否允许周五交易。 |
| `Step (pips)` | 网格加仓的最小点差（默认30）。 |
| `Step Exponent` | 随持仓数量调整加仓间距的幂指数（0表示固定间距）。 |
| `Candle Type` | 策略使用的蜡烛时间框架。 |

## 注意事项
- 策略假定交易品种的 `PriceStep` 表示一个点，如不可用则退化为0.0001。
- 为保持与高阶API一致，止盈/止损通过市价单执行，而非原生挂单。
- 冷却机制与可增长的加仓间距共同限制网格规模，防止无限制加仓。
