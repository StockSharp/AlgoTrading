# Стратегия Firebird Channel Averaging

## Обзор
Стратегия Firebird Channel Averaging переносит логику эксперта MetaTrader 5 «Firebird v0.60» на высокоуровневый API StockSharp. Торговля ведётся по настраиваемому каналу вокруг скользящей средней, а позиции усредняются по мере ухода цены от канала. Решение ориентировано на форекс-стратегии возврата к среднему с сеточным набором позиций и фиксированными рисками в пунктах.

## Настройка индикаторов
- Рассчитывается выбранная скользящая средняя (простая, экспоненциальная, сглаженная или взвешенная). Источник цены свечи (close, high, low, median и т.д.) задаётся параметром.
- Верхняя и нижняя границы канала формируются путём умножения значения скользящей средней на заданный процент.

## Логика входа
1. **Покупка**
   - Закрытие выбранной цены свечи ниже нижней границы канала.
   - Либо позиция отсутствует, либо новая заявка удалена от последнего входа минимум на `Step (pips)` с учётом роста шага через `Step Exponent`.
   - Между открытиями должно пройти не менее двух свечных интервалов.
2. **Продажа**
   - Цена закрывается выше верхней границы канала.
   - Проверки дистанции и таймаута полностью аналогичны длинной стороне.

При выполнении условий отправляется рыночная заявка указанным объёмом. Одновременно удерживается только одно направление: противоположные сигналы ждут закрытия текущей позиции по стопу или тейк-профиту.

## Управление позицией
- Все входы сохраняются, что позволяет вычислять среднюю цену сетки.
- Стоп-лосс и тейк-профит задаются в пунктах. Для одиночной позиции стоп равен цене входа минус/плюс `Stop Loss (pips)`, тейк — цене входа плюс/минус `Take Profit (pips)`.
- При нескольких позициях расстояние до стопа делится на число входов, что повторяет механику усреднения оригинального эксперта.
- Тейк-профит фиксирован относительно средней цены, а стоп пересчитывается на каждой свече.
- Торговлю по пятницам можно отключить отдельным параметром.

## Параметры
| Параметр | Описание |
| --- | --- |
| `Volume` | Объём каждой рыночной заявки (по умолчанию 0.1 лота). |
| `Stop Loss (pips)` | Дистанция стоп-лосса в пунктах (по умолчанию 50). |
| `Take Profit (pips)` | Дистанция тейк-профита в пунктах (по умолчанию 150). |
| `MA Period` | Период расчёта скользящей средней (по умолчанию 10). |
| `MA Shift` | Сдвиг значения скользящей средней вперёд на указанное число свечей. |
| `MA Type` | Тип скользящей: Simple, Exponential, Smoothed или Weighted. |
| `Price Source` | Цена свечи, используемая в индикаторе (по умолчанию close). |
| `Channel %` | Процентное смещение каналов относительно скользящей средней (по умолчанию 0.3%). |
| `Trade Friday` | Разрешение на торговлю в пятницу. |
| `Step (pips)` | Минимальный шаг между усредняющими входами (по умолчанию 30 пунктов). |
| `Step Exponent` | Показатель степени, увеличивающий шаг в зависимости от количества позиций (0 — фиксированный шаг). |
| `Candle Type` | Рабочий таймфрейм свечей. |

## Дополнительные замечания
- Стратегия считает, что `PriceStep` инструмента равен одному пункту; при отсутствии значения используется 0.0001.
- Защитные выходы исполняются рыночными заявками, что соответствует возможностям высокоуровневого API.
- Холодный период и увеличивающийся шаг ограничивают размер сетки и предотвращают чрезмерное наращивание позиции.
