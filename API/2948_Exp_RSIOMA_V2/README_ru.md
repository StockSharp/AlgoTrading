# Стратегия Exp RSIOMA V2

## Обзор
Exp RSIOMA V2 — конверсия оригинального советника MetaTrader 5 в инфраструктуру StockSharp. Стратегия использует осциллятор RSIOMA (Relative Strength Index of Moving Average): выбранная цена свечи сглаживается, из сглаженных значений рассчитывается импульс, после чего формируется RSI-подобная величина. Торговые решения принимаются, когда осциллятор меняет направление или выходит из ключевых зон.

## Логика торговли
1. **Предобработка цены.** Цена свечи, заданная параметром `AppliedPrice` (по умолчанию закрытие), сглаживается одним из четырёх типов средних (простое, экспоненциальное, сглаженное или линейно взвешенное).
2. **Расчёт импульса.** Сглаженное значение сравнивается с ценой `MomentumPeriod` свечей назад, что даёт текущий импульс.
3. **Вычисление RSIOMA.** Положительные и отрицательные импульсы усредняются экспоненциальным фильтром длиной `RsiomaLength`, формируя значение от 0 до 100.
4. **Оценка сигналов.** В зависимости от `Mode` анализируются последние закрытые свечи:
   - **Breakdown** — реагирует на выход RSIOMA за уровни `MainTrendLong` / `MainTrendShort`. Возврат из верхней зоны закрывает шорты и позволяет открыть лонг, выход из нижней зоны делает обратное.
   - **Twist** — ищет разворотные точки. Покупка происходит, когда наклон осциллятора меняется с нисходящего на восходящий, продажа — при обратном переходе.
   - **CloudTwist** — повторяет «облако» индикатора MT5: сделки открываются, когда RSIOMA возвращается из экстремумов внутрь канала, одновременно закрывая противоположные позиции.

Сигналы оцениваются на свече, заданной `SignalBar` (по умолчанию предыдущая полностью закрытая свеча).

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `OrderVolume` | Базовый объём заявки. | `1` |
| `CandleType` | Тип свечей, используемый стратегией. | `4 часа` |
| `EnableLongEntries` / `EnableShortEntries` | Разрешение на открытие длинных / коротких позиций. | `true` |
| `EnableLongExits` / `EnableShortExits` | Разрешение на закрытие длинных / коротких позиций. | `true` |
| `Mode` | Режим генерации сигналов (Breakdown, Twist, CloudTwist). | `Breakdown` |
| `PriceSmoothing` | Тип усреднения, применяемый к цене перед расчётом RSIOMA. | `Exponential` |
| `RsiomaLength` | Длина усреднения RSIOMA. | `14` |
| `MomentumPeriod` | Запаздывание при расчёте импульса. | `1` |
| `AppliedPrice` | Используемая цена свечи (close, open, median, DeMark и т.д.). | `Close` |
| `MainTrendLong` / `MainTrendShort` | Границы зон перекупленности и перепроданности. | `60` / `40` |
| `SignalBar` | Количество закрытых свечей назад для анализа. | `1` |

## Особенности реализации
- Реализованы только типы сглаживания, доступные в StockSharp (SMA, EMA, SMMA, WMA). Продвинутые варианты из MT5 (JJMA, VIDYA, AMA и др.) не поддерживаются.
- Для инициализации RSI используется первая серия импульсов длиной `RsiomaLength`, затем применяется стандартное экспоненциальное обновление, как и в оригинальном советнике.
- Перед открытием противоположной позиции стратегия всегда закрывает текущую. Параметры `EnableLongEntries` / `EnableShortEntries` и `EnableLongExits` / `EnableShortExits` позволяют гибко ограничивать направления.
- Значение `SignalBar = 0` позволяет реагировать на текущую закрытую свечу, большие значения имитируют задержку, доступную в MT5.

## Как использовать
1. Добавьте стратегию в проект StockSharp и назначьте инструмент для торговли.
2. Настройте подписку на свечи через `CandleType` (по умолчанию 4-часовые) и при необходимости скорректируйте пороговые уровни под волатильность инструмента.
3. Выберите режим сигналов: пробой уровней (`Breakdown`), разворот (`Twist`) или изменение «облака» (`CloudTwist`).
4. Запустите стратегию. Она подпишется на выбранные свечи, рассчитает цепочку RSIOMA и отправит рыночные заявки при выполнении условий.
