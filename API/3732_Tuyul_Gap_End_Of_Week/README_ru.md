# Tuyul Gap End Of Week

## Обзор
Tuyul Gap End Of Week — порт советника MetaTrader 5 `TuyulGAP` на StockSharp. Стратегия готовится к ценовому разрыву на выходных: в пятницу вечером она просматривает настраиваемое число последних свечей и выставляет две стоп-заявки на пробой — чуть выше максимума и чуть ниже минимума. За одну торговую сессию в неделю можно выполнить только одну подготовку. После размещения заявок стратегия просто ждёт, пока рынок откроется с разрывом в любую сторону. Если открытая позиция достигает заданной цели по защищаемой прибыли в валюте счёта, она немедленно закрывается по рынку, а в понедельник оставшиеся стоп-заявки отменяются, чтобы очистить сценарий на следующую неделю.

## Логика стратегии
* **Еженедельное окно запуска** – срабатывает в выбранный день недели (по умолчанию пятница), когда биржевое время достигает заданного часа. В течение минутного окна (по умолчанию 23:00–23:15) уровни пробоя рассчитываются только один раз.
* **Динамические уровни пробоя** – максимальное и минимальное значения предыдущих завершённых `Lookback Bars` свечей задают цены срабатывания. Стоп на покупку ставится на один тик выше максимума, стоп на продажу — на один тик ниже минимума, что повторяет смещение в MetaTrader.
* **Гигиена отложенных заявок** – если соответствующая заявка уже стоит в текущую неделю, новая не создаётся. После срабатывания одной стороны противоположная заявка остаётся активной, чтобы стратегия могла отработать любой разрыв.
* **Фиксация защищаемой прибыли** – на каждой завершённой свече проверяются открытые позиции. Когда нереализованная прибыль позиции достигает целевого уровня (в валюте портфеля), позиция сразу закрывается по рынку.
* **Еженедельный сброс** – первая свеча понедельника отменяет все ещё активные стоп-заявки и сбрасывает флаг сессии, подготавливая стратегию к следующей пятнице.

## Параметры
* **Volume** – объём заявок на пробой.
* **Stop Loss (points)** – расстояние от цены входа до защитного стопа в пунктах инструмента. Значение `0` отключает стоп.
* **Lookback Bars** – число завершённых свечей, по которым ищутся недельные экстремумы.
* **Setup Day Of Week** – индекс дня недели (0=воскресенье … 6=суббота), в который запускается подготовка. Значение по умолчанию `5` соответствует пятнице.
* **Setup Hour** – биржевой час, в который формируются заявки на пробой.
* **Setup Minute Window** – число минут после `Setup Hour`, в течение которых запуск остаётся допустимым. По умолчанию `15`, что соответствует диапазону 23:00–23:15 включительно.
* **Secure Profit Target** – минимальная величина нереализованной прибыли на позицию (в валюте портфеля), при достижении которой позиция закрывается.
* **Candle Type** – таймфрейм свечей, используемый для поиска максимумов/минимумов и мониторинга.

## Дополнительные замечания
* Защитный стоп размещается только после открытия позиции, поскольку в StockSharp нельзя привязать стоп непосредственно к отложенной стоп-заявке.
* Объёмы, цены и стопы нормализуются с учётом шага цены и точности, предоставляемых инструментом.
* Для стратегии доступна только реализация на C#; версия на Python не входит в комплект.
