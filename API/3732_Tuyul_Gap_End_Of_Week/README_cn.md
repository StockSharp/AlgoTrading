# Tuyul Gap End Of Week

## 概述
Tuyul Gap End Of Week 将 MetaTrader 5 智能交易系统 `TuyulGAP` 迁移到 StockSharp。策略在周五晚间扫描可配置数量的最近K线，在最高价上方和最低价下方各放置一张突破止损单，为周末跳空做好准备。每周只允许触发一次，当挂单就位后策略等待价格向任意方向突破。如果持仓的浮动利润达到设定的安全目标，策略立即以市价平仓，并在周一取消所有剩余的挂单，为下一周重新初始化。

## 策略逻辑
* **每周触发窗口** – 在可配置的星期几（默认周五）并且到达指定小时后，于设定的分钟窗口内（默认23:00–23:15）准备突破价位，每周仅执行一次。
* **动态突破价** – 取最近 `Lookback Bars` 根已完成K线的最高价与最低价，分别在高点上方一个最小跳动、低点下方一个最小跳动放置买入止损和卖出止损，重现 MetaTrader 的 point 偏移逻辑。
* **挂单管理** – 如果本周已经存在相应的止损挂单则不会重复下单。某一方向触发后，另一张挂单仍保持有效，以便参与任意方向的跳空。
* **安全利润平仓** – 在每根收盘K线上检查所有持仓，只要浮动盈利（以账户货币计价）达到安全利润阈值，即刻以市价离场。
* **每周重置** – 周一出现的第一根K线会取消所有仍然激活的挂单，并重置会话标志，以便下一次周五设置。

## 参数
* **Volume** – 突破止损单使用的下单量。
* **Stop Loss (points)** – 入场价到保护止损之间的距离，单位为合约最小跳动。为 `0` 时不使用止损。
* **Lookback Bars** – 计算周内高点和低点所需的已完成K线数量。
* **Setup Day Of Week** – 触发设置流程的星期索引（0=周日 … 6=周六），默认值 `5` 对应原策略的周五行为。
* **Setup Hour** – 用于布置突破挂单的交易所时间小时。
* **Setup Minute Window** – 在 `Setup Hour` 之后允许执行设置的分钟数，默认 `15` 表示23:00至23:15（含）之间。
* **Secure Profit Target** – 触发立即平仓的最小浮动盈利，单位为账户货币。
* **Candle Type** – 用于高低点扫描和监控循环的K线时间框架。

## 其他说明
* 由于 StockSharp 无法直接在挂单上附带保护止损，止损会在仓位真正打开后才提交。
* 订单数量、价格和止损都会按照交易品种的最小变动和精度信息进行规范化。
* 本策略仅提供 C# 实现，不包含 Python 版本。
