# Стратегия Exp Rj SlidingRangeRj Digit System Tm Plus

## Описание

Стратегия представляет собой перенос советника MetaTrader `Exp_Rj_SlidingRangeRj_Digit_System_Tm_Plus` на платформу StockSharp. Логика полностью повторяет оригинал: используются сигналы пользовательского индикатора **Rj_SlidingRangeRj_Digit**, а также настройки отложенного входа, временного контроля и остановок по пунктам. Стратегия анализирует закрытые свечи выбранного таймфрейма, выявляет выход цены за границы канала и управляет позицией согласно правилам исходного эксперта.

## Индикатор

Индикатор формирует адаптивный ценовой коридор по следующему алгоритму:

1. Для верхней границы вычисляется максимум в каждом из `UpCalcPeriodRange` скользящих окон длиной `UpCalcPeriodRange`, сдвинутых на `UpCalcPeriodShift` баров. Значения максимума усредняются и округляются до `UpDigit` знаков.
2. Нижняя граница рассчитывается аналогично по минимумам с параметрами `DnCalcPeriodRange`, `DnCalcPeriodShift`, `DnDigit`.
3. Закрытие свечи выше верхней границы помечается цветами `2` или `3`, ниже нижней границы — `0` или `1`, внутри канала — `4`.

Для воспроизведения логики MQL стратегия хранит историю цветовых кодов и обращается к сигналу на баре, заданном параметром `SignalBar`.

## Правила торговли

* **Отложенный вход.** Оценка сигнала производится на баре `SignalBar` (по умолчанию предыдущий). Сделка открывается только при появлении нового цвета-прорыва и отсутствии такого же цвета на предыдущем баре.
* **Покупка.** При включённом `EnableBuyEntries` бычий выход (цвет `2` или `3`) инициирует покупку по рынку, если нет открытой длинной позиции (короткая позиция при этом закрывается).
* **Продажа.** При включённом `EnableSellEntries` медвежий выход (цвет `0` или `1`) вызывает продажу по рынку.
* **Выход из позиции.**
  * `EnableBuyExits` — закрывать лонг при появлении цветов `0`/`1`.
  * `EnableSellExits` — закрывать шорт при появлении цветов `2`/`3`.
  * `UseTimeExit` — закрыть любую позицию после истечения `ExitMinutes` минут удержания.
  * `StopLossPoints` и `TakeProfitPoints` задают уровни стоп-лосса и тейк-профита в пунктах и автоматически преобразуются в цену через `PriceStep` инструмента.

Все сделки отправляются методами `BuyMarket` и `SellMarket`, поэтому стратегия умеет развернуться из противоположной позиции одной заявкой.

## Параметры

| Параметр | Назначение | Значение по умолчанию |
|----------|------------|------------------------|
| `CandleType` | Тип/таймфрейм свечей для сигналов | 8-часовые свечи |
| `EnableBuyEntries` / `EnableSellEntries` | Разрешение входов в лонг/шорт | `true` |
| `EnableBuyExits` / `EnableSellExits` | Разрешение индикаторных выходов | `true` |
| `UseTimeExit` | Использовать выход по времени | `true` |
| `ExitMinutes` | Максимальное время удержания позиции (минуты) | `1920` |
| `UpCalcPeriodRange`, `UpCalcPeriodShift`, `UpDigit` | Параметры верхней границы канала | `5`, `0`, `2` |
| `DnCalcPeriodRange`, `DnCalcPeriodShift`, `DnDigit` | Параметры нижней границы канала | `5`, `0`, `2` |
| `SignalBar` | Номер бара для анализа сигнала | `1` |
| `StopLossPoints`, `TakeProfitPoints` | Стоп-лосс / тейк-профит в пунктах (× `PriceStep`) | `1000`, `2000` |

Размер позиции задаётся через свойство `Volume`. Чтобы отключить стоп или тейк, установите соответствующий параметр в `0`.

## Дополнительно

* Для корректного расчёта канала необходим достаточный объём истории (примерно `max(shift + 2 × range)` свечей). До накопления данных сигналы игнорируются.
* Округление значений производится по количеству знаков после запятой, что повторяет поведение индикатора в MetaTrader.
* По требованию проекта Python-реализация не создаётся, в каталоге присутствует только версия на C#.
