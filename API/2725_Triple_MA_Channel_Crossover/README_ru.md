# Стратегия Triple MA Channel Crossover

## Обзор
**Triple MA Channel Crossover** торгует направленные пробои в момент, когда быстрая скользящая средняя пересекает сверху или
снизу две более медленные средние. Для сопровождения позиции используется ценовой канал Дончиана, который может автоматически
задавать уровни стоп-лосса и тейк-профита. Алгоритм является переносом оригинального советника MetaTrader «3MACross EA» и
сохраняет его настраиваемые параметры скользящих средних и риск-менеджмента.

Стратегия поддерживает поэтапное наращивание позиции, работу с фиксированными целями в пунктах и динамическое сопровождение
по каналу. При активации функции безубыточности стоп переносится к цене входа с дополнительным зазором безопасности.

## Торговая логика
- **Вход в лонг** — быстрая средняя пересекает вверх среднюю и медленную. При включенном параметре `Trade On Close` пересечение
  должно быть подтверждено на закрытом баре; при выключенном параметре достаточно, чтобы быстрая средняя находилась выше обеих
  остальных.
- **Вход в шорт** — зеркальное условие: быстрая средняя пересекает вниз две медленные средние.
- При появлении сигнала противоположной направленности стратегия закрывает текущую позицию и при необходимости сразу переворачива
  ется. Дополнительные входы в ту же сторону разрешены, пока общее число лотов не превысит `Max Positions`.

## Управление рисками
- Стоп-лосс и тейк-профит можно задать фиксированным расстоянием в пунктах или поручить их расчёт ценовому каналу (`Auto SL/TP`).
- Трейлинг-стоп и перенос в безубыток повторяют логику исходного советника: защита только ужесточается и никогда не ослабляется.
- Канал Дончиана выступает динамической зоной поддержки/сопротивления, позволяя быстро адаптировать выходы.
- Параметр `Max Positions` ограничивает количество доливок и предотвращает чрезмерное наращивание позиции.

## Основные параметры
| Параметр | Описание |
|----------|----------|
| `Volume` | Объём заявки для каждой доливки. |
| `Stop Loss (pips)` | Фиксированное расстояние стоп-лосса (0 — выключено). |
| `Take Profit (pips)` | Фиксированное расстояние тейк-профита (0 — выключено). |
| `Trailing Stop (pips)` | Дистанция трейлинг-стопа (0 — выключено). |
| `Trailing Step (pips)` | Минимальный шаг обновления трейлинг-стопа. |
| `Break Even (pips)` | Прибыль в пунктах, после которой стоп переносится в безубыток. |
| `Auto SL/TP` | Использовать канал Дончиана для расчёта стопов и целей. |
| `Trade On Close` | Требовать подтверждения пересечения на закрытом баре (иначе проверяется каждое обновление свечи). |
| `Max Positions` | Максимальное число доливок в одном направлении. |
| `Fast/Middle/Slow MA Period` | Периоды трёх скользящих средних. |
| `Fast/Middle/Slow MA Shift` | Сдвиг соответствующей скользящей (в барах). |
| `Fast/Middle/Slow MA Type` | Типы скользящих (Simple, Exponential, Smoothed, Weighted). |
| `Channel Period` | Глубина расчёта канала Дончиана. |
| `Candle Type` | Таймфрейм свечей, которые обрабатывает стратегия. |

## Особенности реализации
- Перевод пунктов в цены выполняется через `Security.PriceStep`. При отсутствии корректного шага цены используется значение `1`.
- Автоматический канал никогда не отдаляет стоп или цель от цены — уровни двигаются только в сторону сокращения риска.
- Порог безубыточности использует «шаг трейлинга» как дополнительный буфер, что соответствует логике оригинального советника.
- Стратегия построена на высокоуровневом API StockSharp и может отображать на графике свечи, скользящие средние и канал.
- Для корректной работы убедитесь, что в истории достаточно данных для формирования самой медленной средней и канала.

## Порядок использования
1. Привяжите стратегию к нужному инструменту и выберите таймфрейм свечей;
2. Настройте периоды, типы и сдвиги скользящих средних под свои требования или под параметры оригинального советника;
3. Выберите режим управления риском: фиксированные цели или автоматические уровни по каналу;
4. Запустите стратегию — она подпишется на свечи, рассчитает индикаторы и начнёт торговать при появлении сигналов;
5. Следите за перемещениями стопов и результатами сделок через журнал и построенные графики.

> **Важно:** автоматическая торговля связана с повышенным риском. Перед использованием на реальном счёте обязательно протестируйте
> стратегию на истории и в демо-среде.
