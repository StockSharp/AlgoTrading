# 三均线通道交叉策略

## 概述
**三均线通道交叉策略**（Triple MA Channel Crossover）在快速均线穿越中速与慢速均线时寻找趋势方向的突破，并借助
唐奇安式价格通道进行风控。该实现基于 MetaTrader 的原始“3MACross EA”，保留了可配置的均线结构、仓位分级、止损/
止盈与移动保护逻辑。

策略可以按设定的步长逐步加仓，支持以点数设定的固定风控，也可以让止损/止盈跟随价格通道自动调整。当触发保本条
件时，系统会把止损推至入场价上方（或下方）并留出安全缓冲。

## 交易逻辑
- **入场条件**
  - *做多：* 快速均线同时上穿中速与慢速均线。如果启用“收盘确认”，则只有在 K 线收盘后确认交叉时才会入场；如
    果关闭该选项，只要快速均线保持在另外两条均线之上即视为有效信号。
  - *做空：* 快速均线同时下穿中速与慢速均线，确认逻辑与做多相同。
  - 若已持有反向仓位，则先平仓再反向开仓；同向信号允许分批加仓，直至达到“最大仓位数”。
- **出场条件**
  - 价格触及配置的固定止盈点或通道给出的目标价。
  - 价格触及动态止损，包括固定点差、跟踪止损、保本位或通道止损等。
  - 如果启用跟踪止损，只有当价格按设定的“跟踪步长”继续向有利方向运行后才会更新止损。

## 风险控制
- 止损与止盈既可以使用固定点差，也可以在开启 `Auto SL/TP` 时完全由价格通道决定。
- 跟踪止损与保本逻辑与原 EA 一致，只会向有利方向收紧，不会放宽。
- 唐奇安通道提供自然的支撑/阻力区间，可用于自动设置保护性价位。
- `Max Positions` 限定了分批加仓的次数，防止无限制放大仓位。

## 关键参数
| 参数 | 说明 |
|------|------|
| `Volume` | 每次加仓的手数。 |
| `Stop Loss (pips)` | 固定止损点差，为 0 表示关闭。 |
| `Take Profit (pips)` | 固定止盈点差，为 0 表示关闭。 |
| `Trailing Stop (pips)` | 跟踪止损的距离，为 0 表示关闭。 |
| `Trailing Step (pips)` | 更新跟踪止损所需的最小位移。 |
| `Break Even (pips)` | 触发保本移动所需的盈利点数。 |
| `Auto SL/TP` | 使用唐奇安通道计算止损与止盈。 |
| `Trade On Close` | 是否只在收盘后确认交叉信号。关闭后每根 K 线都会检查均线位置。 |
| `Max Positions` | 同向最多允许的加仓次数。 |
| `Fast/Middle/Slow MA Period` | 三条均线的周期。 |
| `Fast/Middle/Slow MA Shift` | 对应均线向前/向后偏移的柱数。 |
| `Fast/Middle/Slow MA Type` | 均线类型（简单、指数、平滑、加权）。 |
| `Channel Period` | 唐奇安通道的回溯周期。 |
| `Candle Type` | 策略使用的 K 线周期。 |

## 实现说明
- 点差换算使用 `Security.PriceStep`。若品种未提供最小变动价位，则退化为每点一个价格单位。
- 自动通道管理只会让止损/止盈向当前价格靠拢，不会放宽原有保护。
- 保本逻辑会将“跟踪步长”作为额外缓冲，与原 EA 的处理方式一致。
- 策略基于 StockSharp 高阶 API 编写，自动绘制均线与价格通道，便于图形化分析。
- 请确保历史数据覆盖足够长的时间，以便慢速均线与通道在发出信号前已经形成。

## 使用步骤
1. 将策略绑定到目标合约，并设置需要的 K 线周期；
2. 根据原 EA 或个人需求配置三条均线的周期、类型与偏移；
3. 在固定点差风控与通道自动止损/止盈之间进行选择；
4. 启动策略，系统会订阅对应的 K 线、计算指标并在条件满足时自动下单；
5. 通过日志与图表监控跟踪止损与保本止损的调整情况。

> **风险提示：** 程序化交易具有较高风险。务必先在历史回测与模拟环境中充分验证，再考虑应用到真实账户。
