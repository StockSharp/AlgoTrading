# Стратегия AutoRisk

## Обзор
AutoRisk воспроизводит логику расчёта объёма из оригинального советника MetaTrader. Стратегия подписывается на дневные свечи, вычисляет ATR с периодом 14 и по результату определяет рекомендуемый объём позиции на основе капитала счёта (эквити или баланса). Она не выставляет заявки самостоятельно — последнее вычисленное значение доступно через свойство `RecommendedVolume` и выводится в журнал.

## Основная логика
1. Подписаться на заданный тип свечей (по умолчанию дневные) и передавать цены в индикатор `AverageTrueRange`.
2. После закрытия свечи преобразовать значение ATR в количество шагов цены (`PriceStep`) и далее в валюту через `StepPrice`.
3. Применить параметр риска (`RiskFactor`) к выбранной метрике счёта (`CalculationMode`) и разделить результат на вычисленный знаменатель ATR, чтобы получить «сырой» объём.
4. Привести объём к торговым правилам инструмента (`VolumeStep`, `MinVolume`, `MaxVolume`), используя `RoundUp` для выбора между округлением до ближайшего шага или усечением вниз.
5. Сохранить и залогировать итоговый объём, чтобы внешние компоненты могли использовать его при отправке заявок.

## Параметры
- **RiskFactor** – процент риска, применяемый к знаменателю на основе ATR (по умолчанию `2`).
- **CalculationMode** – выбор метрики капитала: `Equity` (текущая стоимость портфеля) или `Balance` (начальная стоимость, по умолчанию).
- **RoundUp** – при включении округляет до ближайшего шага объёма, иначе значение усечается вниз (по умолчанию `true`).
- **CandleType** – тип рыночных данных для расчёта ATR (по умолчанию дневные свечи `TimeFrameCandleMessage`).

## Требования к данным
- Необходимо привязать инструмент с заполненными полями `PriceStep`, `StepPrice`, `VolumeStep`, `MinVolume`, `MaxVolume`, чтобы соблюдались ограничения брокера.
- Портфельный адаптер должен обновлять `Portfolio.CurrentValue` (эквити) и `Portfolio.BeginValue` (баланс).
- Нужен поток дневных свечей либо скорректируйте `CandleType` под требуемый таймфрейм.

## Рекомендации по использованию
1. Перед запуском укажите инструмент и портфель стратегии.
2. Запустите стратегию, чтобы начать подписку на свечи ATR — индикатор регистрируется автоматически.
3. Считывайте `RecommendedVolume` (или анализируйте информационные логи) для получения актуального объёма.
4. Отправляйте заявки во внешней логике, подставляя рекомендованный объём при необходимости.
