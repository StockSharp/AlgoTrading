# Стратегия Altarius RSI Stochastic

## Обзор
Altarius RSI Stochastic — это перенос советника MetaTrader 5 «Altarius RSI Stohastic» на высокоуровневый API StockSharp. Алгоритм сочетает две стохастические кривые и быстрый RSI с периодом 3, чтобы ловить краткосрочные развороты, возникающие после сжатия и последующего резкого ускорения импульса. В версии для StockSharp сохранены исходные торговые правила, но добавлены параметризация, автоматическое управление риском и адаптивный расчёт объёма позиции.

## Как работает стратегия
- **Основной стохастик (15/8/8).** Фильтрует тренд. Для входа в лонг %K должна быть ниже 50 и пересекать %D снизу вверх. Для шорта требуется обратное условие: %K выше 55 и пересекает %D сверху вниз.
- **Второй стохастик (10/3/3).** Измеряет расхождение между %K и %D. Только если абсолютная разница превышает 5 пунктов, сигнал считается валидным.
- **RSI с периодом 3.** Управляет выходом из позиции. Лонг закрывается, когда RSI выше 60, а %D основного стохастика разворачивается вниз из зоны выше 70. Шорт закрывается при RSI ниже 40 и развороте %D вверх из зоны ниже 30.
- **Экстренное ограничение просадки.** Если плавающий результат становится ниже `MaximumRisk × Portfolio.CurrentValue`, стратегия немедленно закрывает позицию — аналогично защите капитала в оригинальном советнике.
- **Адаптивный объём.** Базовый объём заявок рассчитывается как произведение стоимости портфеля на коэффициент `MaximumRisk`, делённое на 1000. После серии убыточных сделок объём сокращается в соответствии с `DecreaseFactor`, но не падает ниже `MinimumVolume`.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Таймфрейм загружаемых свечей. | 5 минут |
| `BaseVolume` | Резервный объём при отсутствии данных о портфеле. | 0.1 |
| `MinimumVolume` | Минимально допустимый объём сделки. | 0.1 |
| `MaximumRisk` | Коэффициент риска для расчёта объёма и аварийного выхода. | 0.1 |
| `DecreaseFactor` | Делитель, уменьшающий объём после серии убытков. | 3 |
| `PrimaryStochasticLength` | Длина окна %K основного стохастика. | 15 |
| `PrimaryStochasticKPeriod` | Период сглаживания %K основного стохастика. | 8 |
| `PrimaryStochasticDPeriod` | Период сигнальной линии %D основного стохастика. | 8 |
| `SecondaryStochasticLength` | Длина окна второго стохастика. | 10 |
| `SecondaryStochasticKPeriod` | Период сглаживания %K второго стохастика. | 3 |
| `SecondaryStochasticDPeriod` | Период сигнальной линии %D второго стохастика. | 3 |
| `DifferenceThreshold` | Минимальный разрыв между %K и %D второго стохастика. | 5 |
| `PrimaryBuyLimit` | Верхняя граница %K основного стохастика для входа в лонг. | 50 |
| `PrimarySellLimit` | Нижняя граница %K основного стохастика для входа в шорт. | 55 |
| `PrimaryExitUpper` | Минимальное значение %D для закрытия лонга. | 70 |
| `PrimaryExitLower` | Максимальное значение %D для закрытия шорта. | 30 |
| `RsiPeriod` | Период RSI. | 3 |
| `LongExitRsi` | Порог RSI для выхода из лонга. | 60 |
| `ShortExitRsi` | Порог RSI для выхода из шорта. | 40 |

## Правила торговли
1. **Вход в позицию**
   - **Лонг:** %K основного стохастика > %D, значение %K < `PrimaryBuyLimit`, абсолютная разница между %K и %D второго стохастика > `DifferenceThreshold`, позиция отсутствует.
   - **Шорт:** %K основного стохастика < %D, значение %K > `PrimarySellLimit`, абсолютная разница между %K и %D второго стохастика > `DifferenceThreshold`, позиция отсутствует.
2. **Выход из позиции**
   - **Закрытие лонга:** RSI > `LongExitRsi`, %D основного стохастика > `PrimaryExitUpper` и текущее значение %D ниже предыдущего.
   - **Закрытие шорта:** RSI < `ShortExitRsi`, %D основного стохастика < `PrimaryExitLower` и текущее значение %D выше предыдущего.
   - **Аварийный выход:** при |PnL| ≥ `MaximumRisk × Portfolio.CurrentValue` позиция ликвидируется.

## Управление рисками
- При старте вызывается `StartProtection()`, включающее стандартные защитные механизмы StockSharp.
- Метод `CalculateTradeVolume()` уменьшает объём после серии убытков (`_lossStreak > 1`), повторяя логику MT5-параметра `DecreaseFactor`.
- Параметр `MinimumVolume` не позволяет стратегии уходить ниже биржевых ограничений по количеству.

## Примечания
- Алгоритм ориентирован на хеджевые счета, как и оригинальный советник MetaTrader.
- Таймфрейм `CandleType` следует подбирать в соответствии с таймфреймом, на котором работал советник в MT5.
- Для тестирования стратегии можно использовать Backtester из данного репозитория или визуальное построение в StockSharp Designer.
