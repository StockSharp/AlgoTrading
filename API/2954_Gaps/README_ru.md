# Стратегия Gaps
[English](README.md) | [中文](README_cn.md)

Стратегия на основе ценового действия, которая реагирует на разрывы между последовательными свечами. После появления новой
 свечи алгоритм проверяет, ушла ли цена открытия за пределы экстремумов предыдущей свечи на заданное количество пунктов, входит
 в противоположном направлении и сопровождает сделку фиксированными стопами, тейк-профитом и при необходимости ступенчатым
 трейлингом.

## Логика работы

1. Стратегия отслеживает один инструмент в выбранном таймфрейме.
2. После закрытия каждой свечи сравниваются цены открытия двух последних баров:
   - если открытие ниже минимума прошлой свечи на величину больше `GapPips`, открывается длинная позиция в расчёте на откат;
   - если открытие выше максимума прошлой свечи на величину больше `GapPips`, открывается короткая позиция с ожиданием снижения.
3. Управление позицией выполняется полностью внутри стратегии:
   - стоп-лосс ставится на расстоянии `StopLossPips` пунктов от цены входа (ниже для лонга, выше для шорта);
   - тейк-профит фиксируется на расстоянии `TakeProfitPips` от цены входа по направлению позиции;
   - трейлинг-стоп активируется, когда цена проходит `TrailingStopPips + TrailingStepPips` пунктов в прибыль, после чего стоп
     подтягивается на расстояние `TrailingStopPips` от локального максимума/минимума и двигается ступенями не меньше
     `TrailingStepPips`.
4. Все защитные уровни проверяются на каждой завершённой свече по максимуму и минимуму, поэтому даже внутридневные касания
   учитываются корректно.
5. Перед новым входом отменяются активные заявки, а переворот автоматически закрывает противоположную позицию.

## Параметры

- `OrderVolume` = 0.1 — объём сделки в лотах.
- `StopLossPips` = 50 — расстояние от точки входа до стоп-лосса в пунктах (0 — стоп отключён).
- `TakeProfitPips` = 50 — расстояние до тейк-профита в пунктах (0 — тейк отключён).
- `TrailingStopPips` = 5 — размер трейлинг-стопа в пунктах (0 — трейлинг выключен).
- `TrailingStepPips` = 5 — минимальный шаг цены в пунктах для переноса трейлинг-стопа.
- `GapPips` = 1 — минимальный размер разрыва открытия, необходимый для сигнала.
- `CandleType` = часовой таймфрейм — свечи, по которым ищутся гэпы и контролируются риски.

## Особенности реализации

- Параметры в пунктах переводятся в абсолютные цены через шаг цены инструмента; для пяти- и трёхзнаковых форекс-котировок
  выполняется корректировка до реального размера пункта.
- Если включён трейлинг-стоп (`TrailingStopPips > 0`), параметр `TrailingStepPips` также должен быть положительным; при нарушении
  стратегия завершит запуск с ошибкой, как и оригинальная версия на MQL.
- Проверки защитных уровней выполняются только на закрытых свечах в соответствии с требованиями высокоуровневого API StockSharp.
- Для выхода используются рыночные заявки, отдельные стоп- или лимитные ордера в стакан не выставляются.
- Настройки по умолчанию ориентированы на валютный рынок; при торговле другими активами корректируйте размеры пунктов и
  таймфрейм под волатильность инструмента.
