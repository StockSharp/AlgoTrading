# Стратегия AK-47 Scalper

Стратегия перенесена из MetaTrader 5 эксперта **«AK-47 Scalper EA» (билд 44883)** и реализована на высокоуровневом API StockSharp.

Во время работы стратегия держит один отложенный ордер *Sell Stop* в разрешённое торговое время. После срабатывания заявка немедленно сопровождается стоп-лоссом и тейк-профитом. Цена отложенного ордера и защитный стоп автоматически подтягиваются вслед за рынком.

## Логика работы

1. Определяется размер пункта на основе минимального шага цены (для пятизнаковых инструментов используется шаг 0.1 пункта как в MT5).
2. Рассчитывается торговое окно. При включённом фильтре сделки разрешены только между заданными временем начала и окончания; допускается переход через полночь.
3. Перед постановкой ордера проверяется, что текущий спред в пунктах не превышает максимально допустимое значение.
4. Объём позиции:
   - Либо задаётся фиксированным лотом (`Base Lot`),
   - Либо вычисляется по доле капитала (`Risk Percent`), после чего приводится к биржевым ограничениям по минимальному, максимальному объёму и шагу.
5. Ордер Sell Stop размещается на `SL/2` пункта ниже текущего бидa. Планируемый стоп ставится на `SL/2` пункта выше аска, тейк — на `TP` пунктов ниже цены входа.
6. Пока ордер активен, его цена пере-регистрируется так, чтобы сохранять расстояние `SL/2` от бида, а также обновляются запланированные уровни защиты.
7. После исполнения:
   - Регистрируются защитные ордера Buy Stop (стоп-лосс) и Buy Limit (тейк-профит) по рассчитанным ранее ценам.
   - На закрытии каждой свечи стоп переносится на расстояние `SL` пунктов от текущего бида, никогда не расширяя риск.
   - Тейк-профит остаётся неизменным.
8. После закрытия позиции защитные ордера отменяются и цикл начинается заново.

## Параметры

| Параметр | Описание |
|----------|----------|
| **Use Risk Percent** | Использовать ли процент от капитала для расчёта объёма. |
| **Risk Percent** | Процент капитала, используемый при расчёте объёма. |
| **Base Lot** | Фиксированный лот и шаг округления для объёма. |
| **Stop Loss (pips)** | Расстояние до стоп-лосса; половина этого значения определяет смещение отложенного ордера. |
| **Take Profit (pips)** | Расстояние до тейк-профита (0 — отключить). |
| **Max Spread (points)** | Максимально допустимый спред в пунктах MetaTrader. |
| **Use Time Filter** | Включение ограничения по торговому времени. |
| **Start Hour / Minute** | Время начала торгового окна. |
| **End Hour / Minute** | Время окончания торгового окна. |
| **Candle Type** | Тип свечей, по которым обновляется логика. |

## Дополнительно

- Стратегия торгует только короткие позиции, полностью повторяя оригинальную логику EA.
- Подтягивание стопа выполняется после закрытия свечи, что соответствует высокоуровневому API StockSharp.
- Для изменения защитных заявок используется `ReRegisterOrder`; торговая площадка должна поддерживать замену ордеров.
- Текстовые комментарии терминала из оригинала не переносились, стратегия использует стандартные журналы StockSharp.
