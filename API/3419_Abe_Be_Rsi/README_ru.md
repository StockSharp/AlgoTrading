# Стратегия ABE BE RSI

## Общее описание

**ABE BE RSI** — порт советника MetaTrader `Expert_ABE_BE_RSI`. Стратегия сочетает японские свечные модели «бычье/медвежье поглощение» с подтверждением импульса через индекс относительной силы (RSI). Для формирования сигнала требуется две подряд завершённые свечи с паттерном поглощения, а также значение RSI последней закрытой свечи в заданном диапазоне. Дополнительно отслеживаются пересечения RSI с ключевыми уровнями, что позволяет вовремя закрывать или переворачивать позицию. Такое поведение максимально повторяет исходный механизм голосов в MQL-версии.

## Логика торговли

1. **Определение паттерна поглощения**  
   После закрытия каждой свечи анализируются две предыдущие:
   - Для бычьего сигнала свеча *t-2* должна быть медвежьей, свеча *t-1* — бычьей.
   - Тело свечи *t-1* должно превышать средний размер тел за последние `MovingAveragePeriod` свечей.
   - Свеча *t-1* закрывается выше открытия свечи *t-2* и открывается ниже её закрытия, что обеспечивает полное поглощение.
   - Средняя точка свечи *t-2* расположена ниже скользящей средней по закрытиям, подтверждая локальный нисходящий тренд.

   Для медвежьего сигнала условия зеркальны: более старая свеча бычья, новая — медвежья с крупным телом, полностью покрывающим тело предыдущей свечи, при этом средняя точка старой свечи находится выше скользящей средней закрытий.

2. **Фильтрация по RSI**  
   - Покупка разрешена, если RSI последней закрытой свечи ниже `BullishEntryLevel` (по умолчанию 40).
   - Продажа разрешена, если RSI последней закрытой свечи выше `BearishEntryLevel` (по умолчанию 60).

3. **Управление выходами**  
   Пересечения RSI с двумя уровнями управляют закрытием позиций:
   - Короткие позиции закрываются, когда RSI поднимается выше `ExitLowerLevel` (30) или `ExitUpperLevel` (70) после нахождения ниже этих уровней.
   - Длинные позиции закрываются при обратном пересечении сверху вниз.

4. **Исполнение заявок**  
   Все операции выполняются рыночными заявками. При смене направления текущая позиция закрывается, затем открывается новая с базовым объёмом `Volume`, что соответствует фиксированному лоту в оригинальном советнике.

## Параметры

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Volume` | Объём сделки в контрактах. | `0.1` |
| `RsiPeriod` | Период расчёта RSI. | `11` |
| `MovingAveragePeriod` | Период скользящих средних по телам и закрытиям свечей. | `5` |
| `BullishEntryLevel` | Максимальное значение RSI для подтверждения бычьего сигнала. | `40` |
| `BearishEntryLevel` | Минимальное значение RSI для подтверждения медвежьего сигнала. | `60` |
| `ExitLowerLevel` | Нижний уровень RSI, используемый для фиксации прибыли/убытка. | `30` |
| `ExitUpperLevel` | Верхний уровень RSI для закрытия позиций. | `70` |
| `CandleType` | Тип/период свечей, с которыми работает стратегия. | `1 час` |

Все параметры реализованы через `StrategyParam`, поэтому поддерживают оптимизацию в Designer и Runner.

## Набор индикаторов

- **Relative Strength Index** — основной фильтр импульса, задаёт входные и выходные уровни.  
- **Простая скользящая средняя закрытий** — оценивает локальный тренд и помогает отфильтровать ложные поглощения.  
- **Простая скользящая средняя тел свечей** — проверяет, что новая свеча действительно крупнее типичных баров.

## Рекомендации по использованию

- Обработка выполняется только по завершённым свечам (`CandleStates.Finished`), чтобы избежать преждевременных сигналов.  
- Внутри стратегии хранится лишь минимально необходимый набор значений (две последние свечи и их индикаторы), что соответствует требованиям репозитория по эффективности.  
- В `OnStarted` вызывается `StartProtection()`, что активирует стандартные защитные механизмы StockSharp при появлении позиции.

## Отличия от оригинального советника

- Система голосов MetaTrader заменена на прямые торговые действия с теми же условиями.  
- Управление капиталом сведено к одному параметру `Volume`, аналогичному фиксированному лоту `Money_FixLot_Lots`.  
- Модуль трейлинг-стопа отсутствует, как и в исходном наборе модулей (`TrailingNone`).

## Рекомендации по тестированию

1. Запустите стратегию в Designer или Runner на инструментах, где свечные разворотные модели показывают устойчивые результаты (например, основные валютные пары).  
2. Перед запуском уточните значения RSI и скользящих средних для вашего инструмента; дефолтные настройки совпадают с MetaTrader-версией.  
3. Используйте оптимизацию, чтобы подобрать иные пороги или период усреднения под конкретный рынок.
