# 三指标策略

## 概述
该策略是将原始 MQL5 专家顾问 **“Three indicators”** 转换到 StockSharp 平台后的版本。在所选周期的每一根收盘 K 线时，策略会同时评估 MACD、随机指标和 RSI 三个经典震荡指标。只有当所有过滤条件朝同一方向时才会入场，从而保持与原脚本一致的信号确认逻辑。

## 交易逻辑
1. **K 线方向过滤**：比较当前已收盘 K 线与上一根 K 线的开盘价。当前开盘价更高则倾向做多，更低则倾向做空。
2. **MACD 斜率过滤**：计算 MACD 主线当前值与上一根的差值。主线下降支持做多，主线上升支持做空，与原策略完全一致。
3. **随机指标过滤**：检查 %D 相对于 50 的位置。低于 50 支持多头，高于 50 支持空头。
4. **RSI 过滤**：依据 RSI 与 50 的关系。低于 50 允许做多，高于 50 允许做空。

当且仅当 **四项过滤** 同向时，策略才会开仓。如果持仓期间出现反向信号，策略会立即通过一次市场单同时平掉原有仓位并建立反向仓位，去除 MQL 版本中 30 秒的延迟。

## 参数
| 参数 | 说明 |
| --- | --- |
| `CandleType` | 使用的 K 线周期，默认 1 分钟。 |
| `TradeVolume` | 开仓或反手时使用的交易量。 |
| `MacdFastPeriod` | MACD 快速 EMA 周期。 |
| `MacdSlowPeriod` | MACD 慢速 EMA 周期。 |
| `MacdSignalPeriod` | MACD 信号线 EMA 周期。 |
| `MacdPriceType` | 提供给 MACD 的价格类型（收盘价、开盘价、最高价、最低价、中价、典型价、加权价）。 |
| `StochasticKPeriod` | %K 的计算周期。 |
| `StochasticDPeriod` | %D 的平滑周期。 |
| `StochasticSlowing` | 在计算 %D 前对 %K 进行的附加平滑长度。 |
| `RsiPeriod` | RSI 的平滑周期。 |
| `RsiPriceType` | 输入 RSI 的价格类型。 |

## 指标
- **MACD**：按照设置的快/慢 EMA 以及信号线周期计算。
- **随机指标 (Stochastic Oscillator)**：使用 StockSharp 默认实现，可调节 %K、%D 以及 slowing。
- **RSI**：用于最终的动量方向确认。

## 行为说明
- 策略仅处理 **收盘 K 线**，相比原始按新 Bar 第一个 Tick 触发的方式更加稳定。
- 原代码中的 `Sleep(30000)` 被去除，反手时直接发送合并的市价单。
- 随机指标采用 StockSharp 默认的 SMA 平滑方式，与原 MQL 实现的效果一致。
- MACD 与 RSI 的价格来源通过 `IndicatorAppliedPrice` 枚举配置，对应 MetaTrader 的全部选项。

## 风险管理
策略不会自动设置止损或止盈，仓位控制完全由三重指标信号决定。如需固定风险控制，请在外部添加相应模块。

## 使用建议
1. 通过 `CandleType` 选择交易品种的时间框架。
2. 根据市场波动调整各指标参数，以平衡信号频率与稳定性。
3. 利用策略绘制的 K 线与指标曲线检查信号是否一致。
4. 如需固定止损/止盈，请结合外部资金管理或保护模块。
