# Exp RJTX Matches Smoothed Duplex

## Обзор
Стратегия повторяет логику советника MetaTrader 5 `Exp_RJTX_Matches_Smoothed_Duplex.mq5`. Два независимых блока RJTX анализируют сглаженные ряды цен открытия и закрытия на выбранных таймфреймах. Каждый законченный бар классифицируется как бычий или медвежий в зависимости от того, превысило ли сглаженное закрытие сглаженное открытие `Period` баров назад. Бычьи «спички» активируют длинный модуль, а медвежьи управляют коротким модулем.

## Формирование сигналов
1. **Сглаживание** – оба блока подают цены открытия и закрытия в выбранный метод сглаживания. Для открытия и закрытия создаются отдельные экземпляры индикаторов, чтобы избежать пересечения буферов.
2. **Сравнение** – после накопления достаточной истории текущее сглаженное закрытие сравнивается со сглаженным открытием, зафиксированным `Period` баров назад.
3. **Определение спички** – если закрытие выше, бар считается бычьим, иначе – медвежьим. Сигналы оцениваются после сдвига на `SignalBar` закрытых свечей, как и при чтении буферов в MT5.

## Управление позицией
- **Длинный блок** открывает лонг (при необходимости закрывая шорт) при появлении бычьей спички в окне оценки. Медвежья спичка закрывает длинную позицию, если включено разрешение на выход.
- **Короткий блок** действует зеркально: медвежья спичка открывает шорт (с закрытием лонга при разрешении), а бычья закрывает его.
- В StockSharp стратегия работает в неттинговом режиме. Поэтому при появлении противоположного сигнала текущая позиция закрывается перед открытием новой, вместо одновременного ведения двух хеджированных позиций, как в MT5. Чтобы запретить автоматическое закрытие противоположной позиции, отключите соответствующий параметр `Allow ... Close`.

## Управление рисками
Стоп-лосс и тейк-профит задаются в шагах цены (`PriceStep × points`). Для каждого закрытого бара стратегия проверяет, достиг ли диапазон свечи уровней стопа или профита, и сразу закрывает позицию при срабатывании. Это имитирует защитные ордера MT5 без необходимости регистрировать их на стороне брокера.

## Параметры
| Раздел | Параметр | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| Long | `LongCandleType` | H4 | Таймфрейм, используемый длинным блоком RJTX. |
| Long | `LongVolume` | 0.1 | Объём открытия длинной позиции. |
| Long | `LongAllowOpen` | `true` | Разрешить открытие лонгов. |
| Long | `LongAllowClose` | `true` | Разрешить закрытие лонгов по медвежьим спичкам. |
| Long | `LongStopLossPoints` | 1000 | Расстояние стоп-лосса в шагах цены (0 отключает проверку). |
| Long | `LongTakeProfitPoints` | 2000 | Расстояние тейк-профита в шагах цены (0 отключает проверку). |
| Long | `LongSignalBar` | 1 | Сдвиг при чтении буферов RJTX (`0` = текущая закрытая свеча). |
| Long | `LongPeriod` | 10 | Количество баров между текущим сглаженным закрытием и историческим сглаженным открытием. |
| Long | `LongMethod` | `Sma` | Метод сглаживания (`Sma`, `Ema`, `Smma`, `Lwma`, `Jjma`, `Jurx`, `Parma`, `T3`, `Vidya`, `Ama`). |
| Long | `LongLength` | 12 | Длина фильтра сглаживания для рядов открытия/закрытия. |
| Long | `LongPhase` | 15 | Параметр фазы для фильтров Jurik (оставлен для совместимости). |
| Short | `ShortCandleType` | H4 | Таймфрейм, используемый коротким блоком RJTX. |
| Short | `ShortVolume` | 0.1 | Объём открытия короткой позиции. |
| Short | `ShortAllowOpen` | `true` | Разрешить открытие шортов. |
| Short | `ShortAllowClose` | `true` | Разрешить закрытие шортов по бычьим спичкам. |
| Short | `ShortStopLossPoints` | 1000 | Расстояние стоп-лосса для шортов в шагах цены (0 отключает проверку). |
| Short | `ShortTakeProfitPoints` | 2000 | Расстояние тейк-профита для шортов в шагах цены (0 отключает проверку). |
| Short | `ShortSignalBar` | 1 | Сдвиг при чтении буферов RJTX в коротком блоке. |
| Short | `ShortPeriod` | 10 | Количество баров между текущим сглаженным закрытием и историческим сглаженным открытием. |
| Short | `ShortMethod` | `Sma` | Метод сглаживания в коротком блоке. |
| Short | `ShortLength` | 12 | Длина фильтра сглаживания для коротких сигналов. |
| Short | `ShortPhase` | 15 | Параметр фазы для фильтров Jurik в коротком блоке. |

## Примечания
- `Jjma` соответствует Jurik Moving Average. Методы `Jurx`, `Parma` и `Vidya` аппроксимируются Zero-Lag EMA, Arnaud Legoux MA и EMA соответственно, поскольку в StockSharp нет точных аналогов из библиотеки SmoothAlgorithms.
- Проверка стоп-лосса и тейк-профита выполняется по экстремумам свечи. Внутрибарачные движения, не попавшие в диапазон high/low, не приведут к срабатыванию.
- Обработка сигналов происходит только на завершённых свечах, что соответствует проверке `IsNewBar` в оригинальном советнике.
