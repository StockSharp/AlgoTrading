# Trailing Take Profit MQ5 Strategy

## 概述
该策略是 MetaTrader 5 专家顾问 `TrailingTakeProfit.mq5` 的 StockSharp 移植版本。原脚本会在已有仓位出现回撤时不断下移（或上移）止盈价，使目标价紧跟当前行情。移植版本通过订阅最佳买卖价流并在触发条件达到后立即平仓，实现了同样的功能。

策略本身不会开立新仓，只负责管理已经存在的持仓。开启跟踪后，组件会根据输入参数计算激活阈值，并按照原始 MQL 逻辑维护最新的止盈位置。

## 主要特性
- 采用高层级 `SubscribeLevel1()` API 获取实时 bid/ask 报价。
- 仅在价格相对入场价不利移动超过设定点数时才启动跟踪。
- 保持当前价格与止盈价之间的最大距离，等价于在 MQL 中修改止盈订单。
- 当市场触及更新后的目标价时，使用市价单立刻平掉全部多头或空头仓位。
- 在仓位平掉或停用功能时自动清除内部状态。

## 参数
| 名称 | 默认值 | 说明 |
| ---- | ------ | ---- |
| `TrailingEnabled` | `true` | 是否启用跟踪止盈管理。 |
| `TrailingStartPoints` | `200` | 价格相对入场不利移动多少个最小价位后启动跟踪。 |
| `TrailingDistancePoints` | `200` | 当前价格与更新后止盈价之间允许的最大价位数。 |

所有距离都会乘以标的的 `PriceStep` 转换成实际价格，并为两个数值参数设置了优化区间。

## 运行流程
1. 订阅 Level1 数据并记录最新的买价与卖价。
2. 当存在持仓且已启用跟踪时，计算平均持仓价与当前行情之间的不利距离；一旦超过 `TrailingStartPoints`，便以 `TrailingDistancePoints` 的距离生成新的止盈候选价。
3. 对多头仓位，仅在新价位低于旧的止盈价时才更新；对空头仓位，仅在新价位高于旧的止盈价时才更新。
4. 如果市场报价触及维护中的目标价，策略会立即发出市价单关闭全部持仓。
5. 当仓位归零或关闭跟踪功能时，内部目标被重置，行为与原始专家一致。

## 使用建议
- 在需要托管的持仓所在的证券上启动该策略。
- 请确保证券定义了有效的 `PriceStep`，否则距离计算会被跳过。
- 策略通过市价单平仓，请将策略的交易量参数设置为需要管理的仓位数量。
- 可以与其他开仓策略组合使用，该组件专注于止盈的动态维护。
