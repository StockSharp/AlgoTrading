# Стратегия Bull Row Breakout

## Описание
Bull Row Breakout — это порт на C# эксперта MetaTrader 5 «BULL row full EA». Оригинальный советник собран из блоков и сочетает свечные последовательности с подтверждением индикаторами. Версия для StockSharp воспроизводит те же правила на одном настраиваемом таймфрейме и сохраняет англоязычные комментарии в коде, как требует стандарт репозитория.

Стратегия открывает **только длинные** позиции, когда серию медвежьих свечей сменяет восходящий импульс и пробой последних максимумов. Осциллятор Стохастик фильтрует сигналы, а динамические уровни стоп-лосса и тейк-профита повторяют риск-профиль исходной реализации.

## Логика входа
1. Работа ведётся только после закрытия новой свечи (аналог блока «once per bar»).
2. Торговля разрешена, если нет открытой длинной позиции.
3. Проверяется «медвежья цепочка»:
   - `BearRowSize` свечей начиная со смещения `BearShift` назад должны быть медвежьими.
   - Тело каждой свечи не меньше `BearMinBody` шагов цены.
   - Размер тела должен соответствовать режиму `BearRowMode` (обычный / каждое больше / каждое меньше предыдущего).
4. Проверяется «бычья цепочка»:
   - `BullRowSize` свечей начиная со смещения `BullShift` назад должны быть бычьими.
   - Тело каждой свечи не меньше `BullMinBody` шагов цены.
   - Прогрессия тел соответствует `BullRowMode`.
5. Подтверждение пробоя: закрытие последней свечи выше максимума, найденного от бара 2 до `BreakoutLookback` баров назад.
6. Подтверждение Стохастиком:
   - Текущая %K (период `StochasticKPeriod`) выше %D (`StochasticDPeriod`).
   - За последние `StochasticRangePeriod` баров %K не выходила за уровни `StochasticLowerLevel` и `StochasticUpperLevel`.
7. Управление риском:
   - Стоп-цена — минимум среди последних `StopLossLookback` свечей (начиная с последней закрытой).
   - Тейк-профит рассчитывается как `TakeProfitPercent` процентов от дистанции стопа.
   - После входа уровни контролируются на каждом закрытии свечи; при пробое стопа или цели позиция закрывается рынком.

## Параметры
| Параметр | Описание |
| --- | --- |
| `Volume` | Фиксированный объём каждой сделки. |
| `CandleTimeFrame` | Таймфрейм анализируемых свечей. |
| `StopLossLookback` | Количество баров для расчёта динамического стоп-лосса. |
| `TakeProfitPercent` | Соотношение тейк-профита к стопу в процентах. |
| `BearRowSize`, `BearMinBody`, `BearRowMode`, `BearShift` | Настройки медвежьей последовательности. |
| `BullRowSize`, `BullMinBody`, `BullRowMode`, `BullShift` | Настройки бычьей последовательности. |
| `BreakoutLookback` | Глубина истории для поиска уровня пробоя. |
| `StochasticKPeriod`, `StochasticDPeriod`, `StochasticSlowing` | Параметры осциллятора Стохастик. |
| `StochasticRangePeriod` | Число исторических значений %K, которые должны оставаться внутри коридора. |
| `StochasticUpperLevel`, `StochasticLowerLevel` | Границы коридора %K. |

Минимальные размеры тела выражены в шагах цены — так же, как функция `toDigits` в MQL. Если инструмент не предоставляет шаг цены, используется значение 1.

## Отличия от MQL-версии
- В исходном конструкторе можно было задавать разные таймфреймы для блоков. Порт StockSharp работает на едином таймфрейме `CandleTimeFrame`, что отражает стандартное использование эксперта.
- Система виртуальных стопов и обработка отложенных заявок не понадобились и не реализованы.
- Стоп-лосс и тейк-профит эмулируются проверкой свечей: при достижении уровня вызывается `SellMarket` с объёмом текущей позиции.
- Графические объекты и статусные комментарии MQL опущены.

## Рекомендации
- Подбирайте длину и смещение цепочек под конкретный инструмент. Значения по умолчанию повторяют оригинал: три медвежьих свечи с третьего бара назад и две бычьи с первого бара назад.
- Настраивайте уровни Стохастика, чтобы управлять строгой фильтрации.
- При волатильных гэпах стоит увеличить `StopLossLookback` или добавить дополнительные фильтры, чтобы стопы не ставились слишком близко.
