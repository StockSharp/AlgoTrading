# Стратегия Russian20 Time Filter Momentum

## Обзор
**Russian20 Time Filter Momentum** — конвертация советника MetaTrader 4 `Russian20-hp1.mq4`, опубликованного компанией Gordago Software Corp. Алгоритм использует простую скользящую среднюю (SMA) с периодом 20 и индикатор Momentum с периодом 5 на 30-минутных свечах. Сделки открываются только при согласовании тренда и импульса и, при необходимости, ограничиваются заданным торговым окном внутри дня.

## Логика торговли
- **Таймфрейм:** Пользователь задаёт тип свечей (по умолчанию 30 минут — эквивалент MQL4 `PERIOD_M30`). Сигналы рассчитываются только после закрытия свечи, что повторяет поведение оригинального советника.
- **Индикаторы:**
  - Простая скользящая средняя с настраиваемой длиной (по умолчанию 20).
  - Индикатор Momentum с настраиваемым окном (по умолчанию 5) и нейтральным уровнем 100, как в MetaTrader.
- **Вход в покупку:**
  1. Цена закрытия выше SMA.
  2. Значение Momentum превышает порог (по умолчанию 100).
  3. Текущая цена закрытия выше предыдущей.
- **Вход в продажу:**
  1. Цена закрытия ниже SMA.
  2. Momentum ниже порога.
  3. Текущая цена закрытия ниже предыдущей.
- **Выход:**
  - Длинные позиции закрываются при снижении Momentum до порога или ниже, либо при срабатывании тейк-профита.
  - Короткие позиции закрываются при росте Momentum до порога или выше, либо при достижении тейк-профита.

## Торговая сессия
В MQL4-версии предусмотрен фильтр по времени (по умолчанию 14:00–16:00). В портированной версии его включают параметры `UseTimeFilter`, `StartHour` и `EndHour`. При активном фильтре стратегия пропускает и входы, и выходы вне допустимого интервала, точно так же как исходный советник завершал обработку раньше времени.

## Управление рисками
Оригинальный код выставлял фиксированный тейк-профит в 20 пунктов. В C#-версии расстояние задаётся в «пунктах» и автоматически масштабируется по `PriceStep`, что корректно обрабатывает трёх- и пятизначные котировки. Значение `0` отключает цель.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | Свечи 30 минут | Тип данных для расчётов. |
| `MovingAverageLength` | 20 | Период SMA. |
| `MomentumPeriod` | 5 | Период Momentum. |
| `MomentumThreshold` | 100 | Нейтральный уровень Momentum для входов/выходов. |
| `TakeProfitPips` | 20 | Дистанция тейк-профита в пунктах (0 — отключить). |
| `UseTimeFilter` | false | Включить фильтр торговых часов. |
| `StartHour` | 14 | Час начала торгового окна (включительно, 0–23). |
| `EndHour` | 16 | Час окончания окна (включительно, 0–23). |

Все параметры оформлены через `StrategyParam<T>`, что обеспечивает отображение в интерфейсе и возможность оптимизации.

## Особенности реализации
- Используется высокоуровневый метод `SubscribeCandles().Bind(...)`, поэтому значения индикаторов поступают напрямую в обработчик без ручного хранения истории.
- Для сравнения свечей хранится только последнее закрытие, что соответствует требованиям репозитория по производительности.
- Размер «пункта» пересчитывается из `Security.PriceStep`, благодаря чему тейк-профит корректен для инструментов с дробными котировками.
- Добавлены вызовы `DrawCandles`, `DrawIndicator`, `DrawOwnTrades` для удобного отображения на графике (если поддерживается окружением).

## Рекомендации по применению
- Подберите таймфрейм под инструмент; для валютных пар 30-минутные свечи соответствуют настройкам исходного советника.
- При активном фильтре времени убедитесь, что `StartHour` ≤ `EndHour`. Обратное соотношение фактически блокирует торговлю, потому что исходный код просто завершал работу вне диапазона.
- В оригинале отсутствовал стоп-лосс, поэтому для реальной торговли стоит дополнительно настроить защиту позиции через StockSharp или вручную.
