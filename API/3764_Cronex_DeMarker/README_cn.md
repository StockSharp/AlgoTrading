# Cronex DeMarker 策略

## 概览
Cronex DeMarker 策略复刻了 MetaTrader 指标 **Cronex DeMarker**，并将其转化为自动化交易系统。原始指标绘制 DeMarker 振荡器以及两条线性加权移动平均线（LWMA）。该策略完全复制这一结构：在两条平滑曲线发生金叉或死叉时生成交易信号，让系统能够及时捕捉动量由空头转为多头或由多头转为空头的变化。

## 指标构建
1. **DeMarker 振荡器**：比较当前蜡烛与上一根蜡烛。
   - 若当前最高价高于上一根最高价，则正向压力等于两个最高价的差，否则为零。
   - 若当前最低价低于上一根最低价，则负向压力等于两个最低价的距离，否则为零。
   - 在 `DeMarkerPeriod` 根蜡烛上累计正向与负向压力，计算振荡器值 `deMax / (deMax + deMin)`。
2. **快速 LWMA**：将周期为 `FastMaPeriod` 的线性加权均线作用于 DeMarker 序列，以强调最新的振荡器变化。
3. **慢速 LWMA**：对同一 DeMarker 序列再应用周期为 `SlowMaPeriod` 的线性加权均线，得到平滑的确认曲线。

策略仅在蜡烛收盘后更新上述指示器，确保计算结果与 MQ4 源代码中的缓冲区完全一致。

## 交易逻辑
1. 等待 DeMarker 振荡器及两条 LWMA 都完成初始化。
2. 每根收盘蜡烛到来时，计算新的 DeMarker 值，并同步更新两条线性加权均线。
3. 检测快慢 LWMA 的交叉：
   - **金叉**：快速 LWMA 从下向上穿越慢速 LWMA。策略平掉空头仓位并以市价开多。
   - **死叉**：快速 LWMA 从上向下跌破慢速 LWMA。策略平掉多头仓位并以市价开空。
4. 若策略尚未形成、处于离线状态或被禁止交易，则忽略信号。

当出现反向信号时，策略立即反转仓位，通过增加下单数量来同时平仓与开新仓。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `DeMarkerPeriod` | 计算 DeMarker 振荡器所使用的蜡烛数量。 | `25` |
| `FastMaPeriod` | 快速线性加权均线的周期，响应最新的振荡器变化。 | `14` |
| `SlowMaPeriod` | 慢速线性加权均线的周期，用于确认趋势方向。 | `25` |
| `CandleType` | 策略处理的蜡烛类型（时间周期或其他 `DataType`）。 | 1 小时蜡烛 |

## 实现细节
- 采用高层 `SubscribeCandles` API，仅在蜡烛状态为 `Finished` 时更新指标，避免盘中重绘。
- 直接使用 StockSharp 内置的 `DeMarker` 与 `WeightedMovingAverage` 指标，确保与 MQ4 版本一致。
- 启动时自动创建图表区域，同时绘制价格蜡烛、DeMarker 振荡器及两条 LWMA，便于观察信号。
- 在 `OnStarted` 中调用 `StartProtection()`，按照项目要求仅初始化一次持仓保护。

## 使用方法
1. 将策略附加到目标交易品种，并选择需要的蜡烛类型（例如 1 小时）。
2. 设置 DeMarker 及两条 LWMA 的周期，可以使用默认值以复刻原指标，或根据需要进行优化。
3. 启动策略。在指标完全形成并允许交易后，系统会自动执行买卖。
4. 通过图表观察蜡烛和三条曲线，了解策略触发的多空信号。
