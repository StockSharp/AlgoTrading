# Стратегия CGOscillator X2

## Общее описание

**CGOscillator X2** — это мультифреймовая стратегия на основе осциллятора центра тяжести (Center of Gravity, CG). На старшем таймфрейме индикатор определяет направление тренда по наклону осциллятора, а на младшем таймфрейме стратегия отслеживает «крючки» (hook) — разворотные точки, которые появляются при откате против основного тренда. После подтверждения сигнала позиция открывается по рынку в сторону глобального движения. Дополнительно можно задать абсолютные уровни стоп-лосса и тейк-профита.

## Логика работы

1. **Определение тренда (старший таймфрейм)**
   - CG рассчитывается с периодом `TrendLength`.
   - Если текущий CG выше своей сигнальной линии (предыдущего значения), стратегия рассматривает тренд как восходящий; если ниже — как нисходящий.
2. **Поиск сигнала (младший таймфрейм)**
   - Второй экземпляр CG с периодом `SignalLength` анализирует последние две закрытые свечи.
   - Комбинация «текущий CG ≥ сигнал и предыдущий CG < предыдущий сигнал» трактуется как завершившийся откат в нисходящем тренде (готовность к продаже). Условие «текущий CG ≤ сигнал и предыдущий CG > предыдущий сигнал» сигнализирует о завершении отката в восходящем тренде (готовность к покупке).
3. **Открытие и закрытие позиций**
   - Лонги разрешены только при восходящем тренде на старшем таймфрейме и наличии нисходящего «крючка» на младшем. Шорты — при нисходящем тренде и восходящем «крючке».
   - Позиции закрываются при смене глобального тренда или при появлении противоположного сигнала на младшем таймфрейме, если соответствующие параметры включены.
4. **Риск-менеджмент**
   - После входа в позицию устанавливаются уровни стоп-лосса и тейк-профита на заданном расстоянии от цены входа. Если в пределах текущей свечи цена достигает одного из уровней, позиция закрывается до обработки новых сигналов.

## Настройки

| Параметр | Описание |
| -------- | -------- |
| `TrendCandleType` | Тип свечей (таймфрейм) для расчёта трендового CG. |
| `SignalCandleType` | Тип свечей для расчёта сигнального CG. |
| `TrendLength` | Период CG на старшем таймфрейме. |
| `SignalLength` | Период CG на младшем таймфрейме. |
| `BuyOpen` | Разрешить открытие длинных позиций. |
| `SellOpen` | Разрешить открытие коротких позиций. |
| `BuyClose` | Закрывать лонги при переходе тренда в медвежью фазу. |
| `SellClose` | Закрывать шорты при переходе тренда в бычью фазу. |
| `BuyCloseSignal` | Закрывать лонги при появлении медвежьего «крючка» на младшем таймфрейме. |
| `SellCloseSignal` | Закрывать шорты при появлении бычьего «крючка». |
| `StopLoss` | Абсолютное расстояние стоп-лосса (0 — отключено). |
| `TakeProfit` | Абсолютное расстояние тейк-профита (0 — отключено). |

## Подробности индикатора

Пользовательский индикатор **CenterOfGravityOscillatorIndicator** полностью повторяет реализацию MT5:
- В качестве входных данных используется медианная цена `(High + Low) / 2`.
- CG вычисляется как взвешенное среднее последних `Length` значений медианной цены.
- Сигнальная линия — это предыдущее значение CG, что обеспечивает удобное выявление крючков.

## Рекомендации по применению

- Размер позиции задаётся свойством `Volume`. При реверсе стратегия автоматически добавляет модуль текущей позиции, чтобы новая сделка открылась в нужном направлении.
- Работает только по закрытым свечам, поэтому менее чувствительна к внутридневным шумам, но реагирует раз в свечу.
- Стоп-лосс и тейк-профит задаются в абсолютных ценовых единицах — подберите значения с учётом шага цены и волатильности инструмента.
- После выбора подходящих типов свечей стратегию можно использовать на любом инструменте, поддерживаемом StockSharp.
