# Стратегия Fortrader 10 Pips

## Общее описание
**Fortrader 10 Pips** — порт советника MetaTrader 4 `10pips.mq4` (ID 8074) на платформу StockSharp. Робот одновременно держит одну длинную и одну короткую позицию. Для каждой стороны используются фиксированные уровни тейк-профита, стоп-лосса и трейлинг-стопа, заданные в пунктах инструмента.

Реализация повторяет хеджирующее поведение исходного эксперта с помощью высокоуровневого API StockSharp. Сразу после запуска стратегия отправляет рыночные заявки на покупку и продажу. Если защитный ордер закрывает одну из ног, стратегия мгновенно открывает новую позицию в том же направлении, сохраняя две противоположные позиции в рынке.

## Параметры
| Название | Описание |
| --- | --- |
| `Take Profit Buy` | Дистанция тейк-профита для длинной позиции (в пунктах). |
| `Stop Loss Buy` | Дистанция стоп-лосса для длинной позиции (в пунктах). |
| `Trailing Stop Buy` | Дистанция трейлинг-стопа для длинной позиции (в пунктах). Значение 0 отключает трейлинг. |
| `Take Profit Sell` | Дистанция тейк-профита для короткой позиции (в пунктах). |
| `Stop Loss Sell` | Дистанция стоп-лосса для короткой позиции (в пунктах). |
| `Trailing Stop Sell` | Дистанция трейлинг-стопа для короткой позиции (в пунктах). Значение 0 отключает трейлинг. |
| `Volume` | Объём каждой рыночной заявки в лотах. |

Все расстояния умножаются на `PriceStep` инструмента для перевода пунктов в абсолютную цену. Каждый параметр реализован через `StrategyParam<T>`, поэтому его можно менять и оптимизировать в интерфейсе.

## Логика торговли
1. **Старт** — метод `OnStarted` подписывается на Level 1, чтобы отслеживать лучшие цены Bid/Ask, и сразу отправляет рыночные заявки на покупку и продажу.
2. **Защитные ордера** — после каждой сделки (`OnNewMyTrade`) выставляются соответствующие ордера стоп-лосс и тейк-профит, если их дистанция больше нуля. Цены округляются к ближайшему шагу цены.
3. **Повторный вход** — при срабатывании стоп-лосса или тейк-профита стратегия немедленно переоткрывает позицию в том же направлении, поддерживая двухстороннее присутствие в рынке.
4. **Трейлинг-стоп** — при обновлении котировок вызывается `UpdateTrailingStops`. Если прибыль превысила заданную дистанцию от цены входа, стоп-лосс сдвигается по направлению движения, как в оригинальном советнике.

## Особенности реализации
- В оригинальном MT4 коде между первой покупкой и продажей была пауза 10 секунд. В StockSharp задержка не требуется, поэтому обе сделки размещаются сразу.
- Поскольку по умолчанию StockSharp работает с нетто-позицией, фактическая возможность держать встречные позиции зависит от брокера/коннектора. Стратегия самостоятельно отслеживает каждую ногу и переоткрывает её при закрытии.
- Метод `StartProtection()` вызывается в `OnStarted`, чтобы активировать глобальную защиту портфеля, если она настроена в платформе.

## Рекомендации по использованию
- Убедитесь, что используемый коннектор поддерживает одновременные длинные и короткие позиции, если требуется хеджирование.
- Установите значение трейлинг-стопа в 0, чтобы отключить его для выбранного направления.
- Оптимизируйте параметры тейк-профита, стоп-лосса и трейлинг-стопа на исторических данных под свой инструмент и таймфрейм.
