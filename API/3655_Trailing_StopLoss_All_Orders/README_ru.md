# Стратегия Trailing StopLoss All Orders

Стратегия переносит логику скрипта MetaTrader «Trailing_StopLoss_for All_orders_and_symbols» в StockSharp. Она не открывает сделки самостоятельно, а только сопровождает уже открытую чистую позицию по выбранному инструменту, подтягивая виртуальный трейлинг-стоп после достижения заданной прибыли.

## Как работает

1. Подписывается на тиковые сделки инструмента и ждёт появления длинной либо короткой позиции.
2. Когда цена проходит в прибыльном направлении не меньше `Trail Start (pips)`, активируется трейлинг.
3. Фиксируется лучшее достигнутое значение цены. Защитный уровень сдвигается так, чтобы оставаться на расстоянии `Trail Distance (pips)` от этой экстремальной цены. Стоп никогда не перешагивает цену входа, обеспечивая как минимум выход в ноль.
4. При появлении сделки за пределами уровней трейлинга стратегия закрывает остаток позиции рыночной заявкой.

Алгоритм сохраняет идею исходного MQL-скрипта сопровождать все ордера, но в StockSharp управление выполняется над суммарной позицией стратегии.

## Параметры

| Название | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `Trail Start (pips)` | Необходимая прибыль в пунктах для запуска трейлинга. Значение `0` включает трейлинг сразу. | `20` |
| `Trail Distance (pips)` | Расстояние в пунктах между лучшей ценой и уровнем трейлинга. Должно быть положительным. | `10` |

Обе величины переводятся в цену через `PriceStep` инструмента, сохраняя пунктовую настройку оригинального скрипта.

## Особенности

- Стратегия только управляет рисками уже открытых позиций.
- Трейлинг виртуальный: вместо выставления стоп-ордера позиция закрывается рыночной заявкой.
- Для корректной работы требуется поток сделок в реальном времени или тиковые данные при тестировании.
