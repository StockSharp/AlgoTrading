# Стратегия Regularities of Exchange Rates
[English](README.md) | [中文](README_cn.md)

Эта стратегия для StockSharp является дословной конверсией советника MetaTrader 4 **Strategy_of_Regularities_of_Exchange_Rates.mq4**. Идея проста: в заданный час формируется «коридор» из симметричных отложенных стоп-заявок, а в ночной час закрытия все позиции и заявки принудительно снимаются. Таким образом реализуется дневной брейкаут-стреддл, который живёт строго в пределах одной торговой сессии.

В отличие от индикаторных систем здесь нет сложных вычислений — только расписание и фиксированное расстояние. Когда наступает `OpeningHour`, стратегия берёт текущие bid/ask, отмеряет `EntryOffsetPoints` в брокерских пунктах (pips) и размещает *Buy Stop* выше ask и *Sell Stop* ниже bid. Алгоритм автоматически корректирует шаг цены для инструментов с 3- или 5-значными котировками, чтобы поведение совпадало с оригиналом.

## Логика торговли

1. **Час открытия.** После закрытия свечи с часом `OpeningHour` стратегия удаляет остаточные заявки и создаёт пару стопов. Расстояние задаётся как `EntryOffsetPoints * point`, где `point` вычисляется из `PriceStep` инструмента с учётом дробных котировок.
2. **Защитные ордера.** При запуске вызывается `StartProtection` с параметром `StopLossPoints`, поэтому каждая исполненная сделка получает стоп-лосс, аналогичный MT4.
3. **Контроль профита.** На каждой завершённой свече проверяется, достигла ли прибыль значения `TakeProfitPoints * point`. Если да — позиция закрывается рыночной заявкой, что полностью повторяет цикл `OrderClose` в MQL.
4. **Час закрытия.** Когда часы равны `ClosingHour`, все отложенные заявки снимаются, а позиции ликвидируются независимо от текущего результата.
5. **Суточный сброс.** Новая пара стоп-заявок создаётся только один раз в сутки, что исключает дублирование сигналов на таймфреймах меньше часа.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `OpeningHour` | `9` | Час (0–23), в который размещаются отложенные стоп-заявки. |
| `ClosingHour` | `2` | Час (0–23), в который стратегия снимает заявки и закрывает позиции. |
| `EntryOffsetPoints` | `20` | Расстояние от текущих bid/ask до стоп-заявок в брокерских пунктах. |
| `TakeProfitPoints` | `20` | Цель по прибыли в пунктах. Значение `0` отключает ручной тейк-профит. |
| `StopLossPoints` | `500` | Размер стоп-лосса в пунктах, передаваемый в `StartProtection`. |
| `OrderVolume` | `0.1` | Объём каждой стоп-заявки. |
| `CandleType` | `30 минут` | Таймфрейм, по свечам которого контролируется расписание. Любой интервал ≤ 1 часа сохраняет поведение оригинала. |

## Особенности конверсии

- В MQL советник работал по тиковым событиям и опирался на `Hour()`. В StockSharp используется поток завершённых свечей и их `OpenTime.Hour`, что соответствует правилам репозитория и сохраняет часовую логику.
- Цены заявок нормализуются через `Security.ShrinkPrice`, поэтому уровни всегда кратны шагу цены инструмента.
- Защитный стоп реализован через `StartProtection`, что повторяет присоединённый брокером стоп-лосс при `OrderSend`.
- Введено отслеживание даты последнего сигнала, чтобы на подчасовых таймфреймах не возникало множества наборов заявок в течение одного дня.
- В коде добавлены подробные английские комментарии, описывающие каждый этап работы стратегии, что упрощает поддержку и эксперименты.
