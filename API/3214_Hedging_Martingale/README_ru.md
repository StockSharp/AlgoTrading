# Стратегия Hedging Martingale

## Обзор
Данная стратегия представляет собой порт MetaTrader-советника "Hedging Martingale" (каталог `MQL/23693`) на платформу StockSharp. Она поддерживает хедж за счет одновременного открытия длинной и короткой позиции на каждой новой свече, а затем добавляет усредняющие заявки по схеме Мартингейла. При неблагоприятном движении цены на заданное число пунктов к убыточной стороне добавляется новая сделка с увеличенным объемом, в то время как противоположная позиция остается открытой.

## Логика торговли
- **Начальный хедж**: если стратегия находится без позиций и формируется новая закрытая свеча, открываются покупки и продажи одинаковым базовым объемом.
- **Шаги Мартингейла**: когда цена движется против стороны более чем на `Pip Step` пунктов, на эту сторону открывается дополнительная сделка. Объем умножается на `Volume Multiplier`, что воспроизводит наращивание лота в исходном советнике.
- **Индивидуальные тейк-профиты**: каждая позиция имеет собственный тейк-профит на расстоянии `Take Profit (pips)`. После достижения указанной дистанции позиции сокращаются обратной сделкой.
- **Закрытие корзины**: весь портфель позиций закрывается при достижении денежного целевого профита, процента от стартового капитала или после возврата прибыли сверх допустимой величины в режиме трейлинг-локирования. Эти режимы соответствуют функциям `Take_Profit_In_Money`, `Take_Profit_In_percent` и `TRAIL_PROFIT_IN_MONEY2` из MQL-версии.
- **Ограничение сделок**: параметр `Max Trades` задает максимальное число одновременно открытых уровней. При включенном `Close On Max` стратегия полностью закрывает корзину при превышении лимита.

## Параметры
| Название | Описание |
| -------- | -------- |
| Candle Type | Таймфрейм, на котором анализируются свечи и принимаются решения. |
| Use Money TP / Money Take Profit | Включение денежного тейк-профита для всей корзины. |
| Use Percent TP / Percent Take Profit | Закрытие корзины при достижении заданного процента от начального капитала. |
| Enable Trailing / Trailing Start / Trailing Step | Настройка денежного трейлинг-лока для плавающей прибыли. |
| Take Profit (pips) | Дистанция тейк-профита для отдельных позиций. |
| Pip Step | Отрицательное движение цены (в пунктах), после которого добавляется следующий уровень. |
| Base Volume | Базовый объем для стартовых покупок и продаж. |
| Volume Multiplier | Множитель объема при открытии новых уровней. |
| Max Trades | Максимальное количество одновременно открытых сделок (в обе стороны). |
| Close On Max | Закрывать ли все позиции при достижении лимита по количеству сделок. |

## Дополнительно
- Все заявки выставляются рыночными ордерами через `BuyMarket` и `SellMarket`, как и в оригинальном советнике.
- Объемы нормализуются под шаг лота инструмента, чтобы избежать отказов биржи.
- После полного выхода из позиций трейлинг-лок сбрасывает накопленный максимум прибыли для новой серии сделок.

## Файлы
- `CS/HedgingMartingaleStrategy.cs` – реализация стратегии (C#).
- `README.md` – описание на английском.
- `README_cn.md` – описание на китайском.
- `README_ru.md` – описание на русском.
