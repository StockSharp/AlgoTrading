# Стратегия Bollinger Band Pending Stops

## Обзор
Стратегия представляет собой перенос советника MQL "Bb_0_1" на высокоуровневый API StockSharp. Алгоритм подписывается на одну свечную серию, строит полосы Боллинджера и, пока цена остаётся между верхней и нижней полосой, размещает три отложенных ордера Buy Stop и три Sell Stop. У каждого слоя собственная дистанция тейк-профита, но общий уровень стопа задаётся противоположной полосой.

## Логика торговли
- Получить свечи выбранного таймфрейма и рассчитать полосы Боллинджера с заданным периодом и отклонением.
- В торговое окно (`StartHour` < час < `EndHour`) и пока цена находится между полосами:
  - Разместить три ордера Buy Stop на уровне текущей верхней полосы с тейк-профитами на расстоянии `FirstTakeProfit`, `SecondTakeProfit` и `ThirdTakeProfit` шагов цены выше входа.
  - Разместить зеркальные Sell Stop у нижней полосы с тейк-профитами ниже цены входа.
  - Для всех ордеров начальный стоп-лосс совпадает с противоположной полосой Боллинджера.
- Если индикатор смещается ближе к цене, ордера автоматически перерегистрируются, чтобы сопровождать границы канала.
- После срабатывания отложенного ордера выставляются отдельные стоп-лосс и тейк-профит для объёма позиции.
- Параметр `UseBandTrailingStop` включает трейлинг по противоположной полосе, при `false` используется средняя линия (EMA). Стоп переносится только если закрытие ушло дальше цены входа и индикатор даёт более выгодный уровень.

## Параметры
| Имя | Описание |
| --- | --- |
| `CandleType` | Таймфрейм для расчёта полос Боллинджера. |
| `BandPeriod` | Количество свечей в расчёте полос. |
| `BandDeviation` | Множитель стандартного отклонения. |
| `Volume` | Объём каждой ступени. |
| `StartHour` / `EndHour` | Торговый интервал по часам (исключающие границы). |
| `FirstTakeProfit`, `SecondTakeProfit`, `ThirdTakeProfit` | Дистанции тейк-профитов в шагах цены. |
| `UseBandTrailingStop` | Выбор источника трейлинга: противоположная полоса (`true`) или средняя линия (`false`). |

## Особенности реализации
- Объём сделок фиксированный (`Volume`), оригинальный риск-менеджмент на основе истории счёта не реализован из-за отсутствия данных портфеля в примере.
- Параметры смещения индикатора из MQL не перенесены, так как высокоуровневый API возвращает актуальные значения индикаторов для рассматриваемой свечи.
- Защитные приказы создаются в виде обычных стопов и лимиток и обновляются при улучшении уровня по условиям трейлинга.
