# 布林带分层挂单策略

## 概述
本示例将 MQL 顾问 "Bb_0_1" 迁移到 StockSharp 的高级 API。策略订阅一组蜡烛数据，根据设定的周期和偏差计算布林带。当价格位于上下轨之间时，算法会在上轨放置三张分层 Buy Stop 挂单，并在下轨放置三张分层 Sell Stop 挂单。每一层都有独立的止盈距离，而止损都引用相反一侧的布林带。

## 交易逻辑
- 订阅指定的时间框架，计算布林带指标。
- 在交易时间窗口内（`StartHour` < 小时 < `EndHour`），且价格位于布林带范围内时：
  - 在当前上轨价格放置三张 Buy Stop 挂单，止盈距离分别为 `FirstTakeProfit`、`SecondTakeProfit`、`ThirdTakeProfit` 个价格步长。
  - 在当前下轨价格放置三张 Sell Stop 挂单，并在相同步长处设置止盈。
  - 所有挂单的初始止损均使用相反一侧的布林带。
- 当布林带向价格靠近时，挂单会重新登记，以保持紧跟通道边界。
- 挂单成交后，策略会为成交量注册显式的止损与止盈单。
- 可选的移动止损由 `UseBandTrailingStop` 控制：为 `true` 时使用相反轨道，为 `false` 时使用布林带中轨（EMA）。仅当收盘价超过入场价且指标给出更优水平时，才会移动止损。

## 参数
| 名称 | 说明 |
| --- | --- |
| `CandleType` | 计算布林带使用的时间框架。 |
| `BandPeriod` | 布林带周期。 |
| `BandDeviation` | 布林带标准差倍数。 |
| `Volume` | 每一层挂单的成交量。 |
| `StartHour` / `EndHour` | 交易时段（不包含边界）。 |
| `FirstTakeProfit`、`SecondTakeProfit`、`ThirdTakeProfit` | 各层止盈的价格步长距离。 |
| `UseBandTrailingStop` | 选择移动止损的参考：相反轨道 (`true`) 或中轨 (`false`)。 |

## 实现说明
- 挂单数量固定为参数 `Volume`，原始脚本中的历史权益风险控制未实现，因为示例环境不提供账户历史。
- MQL 中的指标位移参数未保留，高级 API 已经提供与当前蜡烛对齐的指标值。
- 止损与止盈均通过普通的止损单和限价单实现，并在满足移动条件时刷新价格。
