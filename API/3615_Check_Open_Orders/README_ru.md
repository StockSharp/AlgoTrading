# Стратегия Check Open Orders

## Обзор
Стратегия Check Open Orders — это порт на StockSharp эксперта MetaTrader 4 *Check_Open_Orders.mq4*. Оригинальный советник был
создан как учебный инструмент: сразу после запуска он открывает несколько рыночных сделок и выводит на график комментарий о
наличии позиций, соответствующих выбранному фильтру (все, только покупки или только продажи). StockSharp-версия повторяет эту
логику, используя высокоуровневый API платформы для отправки заявок, отслеживания позиций и формирования статусных сообщений.

При запуске стратегия приводит выбранный объём к ограничениям инструмента, подписывается на заявки первого уровня и асинхронно
отправляет две рыночные заявки на покупку, а затем одну заявку на продажу. Между отправками выдерживается пауза, задаваемая
`WaitTimeMilliseconds`. После каждого срабатывания в журнал пишется сообщение, аналогичное исходной функции `Comment()`, — в нём
указано, какой режим контроля выбран, и остались ли позиции подходящего типа. Если доступны котировки bid/ask, стратегия
дополнительно выставляет для демонстрационных сделок защитные стоп-лосс и тейк-профит.

## Логика работы
1. Считываются параметры стратегии и объём приводится к минимальному, максимальному значению и шагу объёма инструмента.
2. Выполняется подписка на Level1, чтобы получать свежие котировки для расчёта защитных уровней.
3. Запускается асинхронный сценарий, который отправляет две покупки и одну продажу с интервалом `WaitTimeMilliseconds`.
4. После каждой заявки определяется опорная цена по последней сделке или bid/ask и вызываются `SetStopLoss` и `SetTakeProfit`
   с расстоянием в пунктах брокера.
5. При появлении новых сделок или изменении позиции пересчитывается текст статуса: указывается текущий фильтр (`Mode`) и факт
   наличия подходящих позиций.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `TradeVolume` | `decimal` | `0.01` | Объём демонстрационных рыночных заявок; автоматически приводится к допустимым значениям. |
| `StopLossPoints` | `decimal` | `100` | Размер защитного стоп-лосса в пунктах брокера. |
| `TakeProfitPoints` | `decimal` | `400` | Размер тейк-профита в пунктах брокера. |
| `SlippagePoints` | `decimal` | `7` | Информационный буфер по проскальзыванию, переводится в цену и записывается в `Strategy.Slippage`. |
| `WaitTimeMilliseconds` | `int` | `2000` | Задержка между последовательными рыночными заявками в миллисекундах. |
| `Mode` | `CheckOpenOrdersMode` | `CheckAllTypes` | Определяет, какие позиции учитывать в статусе: все, только длинные или только короткие. |

Перечисление `CheckOpenOrdersMode` включает варианты:
- `CheckAllTypes` — сообщение «Yes», если суммарная позиция стратегии не равна нулю.
- `CheckOnlyBuy` — сообщение «Yes» только при наличии длинной (положительной) позиции.
- `CheckOnlySell` — сообщение «Yes» только при наличии короткой (отрицательной) позиции.

## Отличия от версии MetaTrader
- StockSharp самостоятельно связывает сделки со стратегией, поэтому фильтрация по `MagicNumber` не требуется — анализируется
  собственная чистая позиция.
- Защитные заявки выставляются через `SetStopLoss`/`SetTakeProfit` на основе последних котировок Level1. При отсутствии bid/ask
  стратегия пропускает выставление уровней и выводит предупреждение, вместо использования глобальных `Bid`/`Ask`.
- Задержка между сделками реализована с помощью `Task.Delay`, что позволяет стратегии обрабатывать другие события, в отличие от
  блокирующей функции `Sleep()`.
- Статус выводится через `AddInfoLog`, поэтому сообщение отображается в логах и интерфейсе Designer, а не в комментарии на
  графике.

## Рекомендации по использованию
- Используйте поставщика данных, который передаёт котировки первого уровня; без них сделки выполнятся, но защитные уровни не
  будут установлены.
- Поскольку стратегия работает с чистой позицией, на счетах с хеджированием отчётность будет зависеть от суммарного результата
  по всем открытым ордерам.
- Значения по умолчанию совпадают с учебным экспертом MetaTrader. При необходимости выдерживать более длинную паузу увеличьте
  `WaitTimeMilliseconds`.
- Стратегия рассчитана на демонстрацию. При переносе в реальный алгоритм удалите блок, создающий тестовые сделки, и расширьте
  логику в соответствии с боевыми требованиями.
