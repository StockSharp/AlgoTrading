# Ingrit

## 概览
Ingrit 源自 MetaTrader 5 智能交易系统 `Ingrit.mq5`。策略监控 5 分钟 K 线：当上一根 K 线与当前方向相反且收盘动量强劲，同时当前波动与 14 根之前的摆动之间的距离足够大时，触发突破信号。所有订单均以市价执行，止损、止盈以及移动止损均以点（pip）配置，可选地反转信号或在入场前平掉相反持仓。

## 策略逻辑
### 突破识别
* 仅处理所选周期的收盘 K 线（默认 5 分钟）。
* **做多**：上一根 K 线必须收阴，且“14 根之前的最高价 - 上一根 K 线的最低价”大于 `StepPips`（换算成价格单位后）。
* **做空**：上一根 K 线必须收阳，且“上一根 K 线的最高价 - 14 根之前的最低价”大于 `StepPips`。
* 启用 `ReverseSignals` 会对调多空条件，与原版 EA 的反向模式一致。

### 头寸管理
* 策略使用属性 `Volume` 指定的数量下市价单。若 `CloseOppositePositions` 为真，则在下单量中额外加上当前持有的反向仓位，以便在一次交易中同时平仓并建立新方向。
* 入场后立即根据参数设置固定止损和止盈（大于零时生效）。距离会依据品种的最小价格步长换算点值，并自动适配三位或五位小数的外汇报价。
* 当未实现盈利超过 `TrailingStopPips + TrailingStepPips` 时启动移动止损。多头止损跟随收盘价下方，空头止损跟随收盘价上方，并且每次移动都会至少保持 `TrailingStepPips` 的额外缓冲，避免频繁修改。

### 其他特性
* 将 `TrailingStopPips` 设为 0 可关闭移动止损；若启用移动止损，则 `TrailingStepPips` 必须为正值（与原脚本一致的校验）。
* 所有计算基于收盘 K 线，在 StockSharp 中无需逐笔或盘中逻辑。
* 策略不会挂出限价或止损单，所有保护水平都在策略内部维护。

## 参数
| 参数 | 说明 |
| --- | --- |
| `CandleType` | 用于计算突破信号的 K 线周期，默认为 5 分钟。 |
| `StopLossPips` | 止损距离（点）。为 0 时不设置固定止损。 |
| `TakeProfitPips` | 止盈距离（点）。为 0 时不设置固定止盈。 |
| `TrailingStopPips` | 移动止损的基础距离（点）。为 0 时关闭移动止损。 |
| `TrailingStepPips` | 再次移动止损前所需的额外盈利（点）。启用移动止损时必须为正。 |
| `StepPips` | 触发信号所需的最小摆动距离（点），比较当前上一根与 14 根前的高低点。 |
| `ReverseSignals` | 为真时对调多空信号（反向模式）。 |
| `CloseOppositePositions` | 为真时增加下单量以平掉相反持仓后再开仓。 |
| `Volume` | 策略属性，定义基础下单数量，可与 `CloseOppositePositions` 配合控制翻仓行为。 |

## 备注
* 策略通过品种的最小价格步长推导点值；若小数位为 3 或 5，则自动乘以 10，使得 1 点与外汇市场的定义一致。
* 本仓库中暂不提供该策略的 Python 版本。
