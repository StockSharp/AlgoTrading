# Ingrit

## Обзор
Ingrit — порт советника MetaTrader 5 `Ingrit.mq5`. Стратегия анализирует пятиминутные свечи и реагирует на сочетание сильной встречной свечи с расширением диапазона относительно максимума или минимума четырнадцать баров назад. Сделки открываются по рынку, стоп-лосс, тейк-профит и трейлинг задаются в пунктах. Пользователь может инвертировать сигналы и при необходимости разворачивать позицию одной заявкой.

## Логика стратегии
### Поиск пробоя
* Обрабатываются только завершённые свечи выбранного таймфрейма (по умолчанию 5 минут).
* **Покупка**: предыдущая свеча должна закрыться вниз, а расстояние между максимумом свечи 14 баров назад и минимумом предыдущей свечи превышает `StepPips` (после пересчёта пунктов в цену).
* **Продажа**: предыдущая свеча закрывается вверх, а расстояние между её максимумом и минимумом свечи 14 баров назад превышает `StepPips`.
* Флаг `ReverseSignals` меняет местами условия для покупок и продаж, что соответствует режиму реверса в исходном роботе.

### Управление сделкой
* Заявки отправляются по рынку с объёмом `Volume`. При активном `CloseOppositePositions` к объёму добавляется абсолютная величина текущей позиции, что позволяет моментально развернуться и закрыть встречное направление.
* После входа выставляются фиксированные уровни стоп-лосса и тейк-профита (если значения больше нуля). Все расстояния пересчитываются из пунктов через шаг цены инструмента и корректно работают с трёх- и пятизнаковыми котировками Forex.
* Трейлинг-стоп активируется, когда плавающая прибыль превышает `TrailingStopPips + TrailingStepPips`. Для длинных позиций стоп сопровождает цену снизу, для коротких — сверху. Каждый перенос выполняется только если новое значение дальше предыдущего минимум на `TrailingStepPips`, что снижает частоту модификаций.

### Дополнительные особенности
* Установка `TrailingStopPips` в ноль отключает трейлинг. Если трейлинг включён, параметр `TrailingStepPips` должен быть положительным (проверка совпадает с оригиналом).
* Расчёты выполняются по закрытым свечам, внутрибарая логика не требуется.
* Стратегия не размещает отложенные заявки — вход всегда по рынку, защитные уровни ведутся внутри стратегии.

## Параметры
| Параметр | Описание |
| --- | --- |
| `CandleType` | Таймфрейм свечей для расчётов (по умолчанию 5 минут). |
| `StopLossPips` | Расстояние стоп-лосса в пунктах. Ноль отключает фиксированный стоп. |
| `TakeProfitPips` | Расстояние тейк-профита в пунктах. Ноль отключает фиксированную цель. |
| `TrailingStopPips` | Базовый трейлинг-стоп в пунктах. Ноль отключает сопровождение. |
| `TrailingStepPips` | Дополнительное движение в пунктах перед очередным переносом трейлинга. При активном трейлинге должно быть больше нуля. |
| `StepPips` | Минимальное расстояние в пунктах между эталонной свечой и последней свечой перед сигналом. |
| `ReverseSignals` | При `true` меняет условия входа местами (режим реверса). |
| `CloseOppositePositions` | При `true` увеличивает объём заявки, чтобы закрыть встречную позицию и открыть новую. |
| `Volume` | Свойство стратегии, определяющее базовый объём заявки. Используйте вместе с `CloseOppositePositions` для настройки разворотов. |

## Примечания
* Значение пункта вычисляется из шага цены. Для инструментов с тремя или пятью знаками шаг умножается на десять, чтобы соответствовать стандартному пункту на Forex.
* Python-версии стратегии в репозитории нет.
