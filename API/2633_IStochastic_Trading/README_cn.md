# IStochastic 交易策略

## 概述
IStochastic 交易策略是 MetaTrader 5 专家顾问 "IStochastic_Trading" 的 StockSharp 版本。策略使用随机指标识别超买与超卖区域，并按照马丁格尔思路逐级加仓，同时为每一笔仓位设置止损、止盈与跟踪止损。实现完全基于 StockSharp 的高级 API，在每根完成的 K 线之后决策，并仅发送市价单。

## 交易逻辑
1. 构建带有可配置 %K 周期、%D 平滑周期和附加缓和系数的随机振荡指标。
2. 当没有持仓时检查最新收盘的 K 线：
   - 如果 %K 高于 %D 且 %D 低于设定的买入区域，则开多单。
   - 如果 %K 低于 %D 且 %D 高于设定的卖出区域，则开空单。
3. 已有仓位时跟踪最后一次加仓：
   - 当价格逆向运行达到设定的间隔（以点值计）时，并且尚未达到允许的最大仓位数，按同方向再开一笔仓位，手数为前一单的两倍。
4. 对每笔仓位根据点值距离计算独立的止损和止盈价位，换算时使用合约的 `PriceStep` 和小数位数，以复现终端中的“调整点”逻辑。一旦收盘价触及止损或止盈，策略立即以市价平掉对应仓位。
5. 在每根 K 线收盘后应用跟踪止损。当行情向有利方向移动超过设定的跟踪步长时，更新止损价，模拟终端对单笔仓位的逐步移动止损行为。

## 参数
| 名称 | 默认值 | 说明 |
| --- | --- | --- |
| `OrderVolume` | `0.1` | 初始下单手数，之后的加仓按上一次手数翻倍。 |
| `TakeProfitPips` | `50` | 每笔仓位的止盈距离（点）。 |
| `StopLossPips` | `50` | 每笔仓位的止损距离（点）。 |
| `TrailingStopPips` | `10` | 跟踪止损距离（点），设为 0 可关闭。 |
| `TrailingStepPips` | `5` | 每次移动止损所需的最小有利运行（点）。 |
| `MaxPositions` | `3` | 同方向允许的最大仓位数量，设为 `0` 表示不限制。 |
| `GapPips` | `7` | 触发加倍加仓所需的逆向位移（点）。 |
| `KPeriod` | `5` | 计算 %K 所用的周期数。 |
| `DPeriod` | `3` | %D 平滑平均的周期。 |
| `Slowing` | `3` | 额外应用于 %K 的平滑系数。 |
| `ZoneBuy` | `30` | 用于确认多头信号的 %D 阈值。 |
| `ZoneSell` | `70` | 用于确认空头信号的 %D 阈值。 |
| `CandleType` | `15 分钟` | 进行计算的 K 线时间框架。 |

## 实现说明
- 点值换算基于 `PriceStep`。对于 3 位或 5 位报价，会额外乘以 10，以对齐 MetaTrader 的“调整点”规则。
- 止损、止盈以及跟踪止损的触发依据收盘价判断，以确保回测时的确定性；若需要更细粒度的管理，可在实时环境中扩展处理。
- 策略在任一时刻只维护一个方向的仓位梯队，必须全部平仓后才会反向建仓。
- 根据需求未提供 Python 版本及其目录。
