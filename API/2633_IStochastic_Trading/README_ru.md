# Стратегия IStochastic Trading

## Обзор
Стратегия IStochastic Trading представляет собой перенос эксперта MetaTrader 5 "IStochastic_Trading" на платформу StockSharp. Алгоритм использует осциллятор Стохастик для определения зон перепроданности и перекупленности, после чего строит лесенку позиций по принципу мартингейла и сопровождает каждое входящую позицию стоп-лоссом, тейк-профитом и трейлинг-стопом. Реализация основана на свечах, предоставляемых высокоуровневым API StockSharp, и работает исключительно с рыночными приказами.

## Логика торговли
1. Рассчитывается осциллятор Стохастик с настраиваемыми параметрами %K, %D и дополнительным сглаживанием.
2. При отсутствии позиций анализируется последняя закрытая свеча:
   - Открывается длинная позиция, если %K выше %D и %D находится ниже порога покупок.
   - Открывается короткая позиция, если %K ниже %D и %D выше порога продаж.
3. Если позиции уже есть, отслеживается последняя добавленная ступень:
   - Когда цена движется против позиции на величину, равную настроенному зазору (в пунктах), открывается новая позиция в том же направлении с удвоенным объёмом, если лимит по количеству ступеней ещё не достигнут.
4. Для каждой ступени рассчитываются индивидуальные уровни стоп-лосса и тейк-профита. Конвертация из пунктов в цену выполняется на основе `PriceStep` инструмента и количества знаков после запятой, что повторяет логику "adjusted point" оригинального советника. При достижении закрытия цены уровня стопа или цели соответствующая позиция закрывается рыночным приказом.
5. После закрытия каждой свечи выполняется подтягивание трейлинг-стопа. При достаточном движении цены в прибыльную сторону стоп переносится на величину заданного шага, имитируя поведение MetaTrader для каждой позиции.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `OrderVolume` | `0.1` | Объём первой сделки в лотах. Каждое последующее добавление удваивает объём предыдущей позиции. |
| `TakeProfitPips` | `50` | Расстояние до тейк-профита в пунктах для каждой ступени. |
| `StopLossPips` | `50` | Расстояние до стоп-лосса в пунктах для каждой ступени. |
| `TrailingStopPips` | `10` | Дистанция трейлинг-стопа в пунктах. Значение `0` отключает сопровождение. |
| `TrailingStepPips` | `5` | Минимальное благоприятное движение (в пунктах), после которого стоп подтягивается. |
| `MaxPositions` | `3` | Максимальное количество одновременно открытых ступеней. Значение `0` снимает ограничение. |
| `GapPips` | `7` | Обратное движение цены (в пунктах), необходимое для удвоения позиции. |
| `KPeriod` | `5` | Количество свечей при расчёте линии %K. |
| `DPeriod` | `3` | Период сглаживания для линии %D. |
| `Slowing` | `3` | Дополнительное сглаживание линии %K. |
| `ZoneBuy` | `30` | Порог %D для подтверждения длинного сигнала (зона перепроданности). |
| `ZoneSell` | `70` | Порог %D для подтверждения короткого сигнала (зона перекупленности). |
| `CandleType` | `15 минут` | Таймфрейм свечей, используемый в расчётах. |

## Особенности реализации
- Перевод расстояний в пунктах в цены выполняется с помощью `PriceStep`. Для инструментов с 3 или 5 знаками после запятой дополнительно применяется множитель 10, что соответствует подходу MetaTrader.
- Контроль стопов и целей выполняется по закрытию свечи. Это обеспечивает детерминированность в тестах; при необходимости можно расширить логику для внутрисвечного сопровождения.
- В каждый момент времени стратегия сопровождает только одну лесенку в заданном направлении. Для смены направления все позиции должны быть закрыты.
- Python-версия и соответствующая папка намеренно не создавались по условиям задания.
