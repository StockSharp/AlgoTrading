# Стратегия XROC2 VG X2

## Общее описание
XROC2 VG X2 — мульти-таймфреймовая стратегия, основанная на двух сглаженных потоках индикатора Rate of Change. Старший таймфрейм используется как фильтр направления, младший — для генерации конкретных сигналов входа и выхода. Исходный эксперт под MetaTrader 5 опирался на пользовательский индикатор XROC2_VG и библиотеку управления капиталом. В портированной версии для StockSharp сохранена логика сигналов и основные параметры вынесены в настройки стратегии.

Стратегия подписывается на две серии свечей:
- **Старший таймфрейм** (по умолчанию 6 часов) — определяет доминирующее направление рынка.
- **Младший таймфрейм** (по умолчанию 30 минут) — отслеживает пересечения двух ROC-линий и формирует торговые события.

Обе линии используют одинаковый режим расчёта ROC, но обладают независимыми методами сглаживания. По умолчанию применяется сглаживание Jurik, что обеспечивает поведение максимально близкое к оригиналу. Для методов, отсутствующих в StockSharp (JurX, ParMA, T3, VIDYA, AMA с управлением фазой), используется ближайший доступный тип скользящей средней, поэтому результаты могут незначительно отличаться.

## Логика торговли
1. **Определение тренда (старший таймфрейм)**
   - Рассчитать две сглаженные ROC-линии с заданными периодами и методами сглаживания.
   - На свече, указанной параметром `HigherSignalBar`, сравнить значения: если быстрая линия выше медленной, считается, что тренд бычий, если ниже — медвежий. Равенство значений обнуляет тренд и блокирует торговлю.
2. **Формирование сигналов (младший таймфрейм)**
   - Повторить расчёт ROC-линий на младшем таймфрейме.
   - Проанализировать последнюю закрытую свечу (смещение `LowerSignalBar`) и предыдущую, чтобы определить факт пересечения.
   - Лонг сигнал появляется, когда старший тренд бычий, быстрая линия пересекает медленную сверху вниз и разрешено открывать покупки.
   - Шорт сигнал возникает, когда старший тренд медвежий, быстрая линия пересекает медленную снизу вверх и разрешено открывать продажи.
3. **Управление позицией**
   - Длинные позиции закрываются при медвежьем пересечении на младшем ТФ (`CloseBuyOnLower`) или при смене тренда старшего ТФ на медвежий (`CloseBuyOnTrendFlip`).
   - Короткие позиции закрываются при бычьем пересечении (`CloseSellOnLower`) или при смене тренда старшего ТФ на бычий (`CloseSellOnTrendFlip`).
   - Новые сделки открываются только при отсутствии открытой позиции. Объём заявок задаётся параметром `Volume` стратегии.

## Параметры
- `HigherCandleType` — тип свечей для трендового фильтра (по умолчанию 6 часов).
- `LowerCandleType` — тип свечей для сигналов (по умолчанию 30 минут).
- `HigherSignalBar` — сдвиг по закрытым свечам при чтении значений старшего таймфрейма (по умолчанию 1).
- `LowerSignalBar` — аналогичный сдвиг для младшего таймфрейма (по умолчанию 1).
- `HigherRocMode` / `LowerRocMode` — режим расчёта ROC (`Momentum`, `RateOfChange`, `RateOfChangePercent`, `RateOfChangeRatio`, `RateOfChangeRatioPercent`).
- `HigherFastPeriod`, `HigherFastMethod`, `HigherFastLength`, `HigherFastPhase` — настройки быстрой линии для старшего таймфрейма.
- `HigherSlowPeriod`, `HigherSlowMethod`, `HigherSlowLength`, `HigherSlowPhase` — настройки медленной линии для старшего таймфрейма.
- `LowerFastPeriod`, `LowerFastMethod`, `LowerFastLength`, `LowerFastPhase` — настройки быстрой линии для младшего таймфрейма.
- `LowerSlowPeriod`, `LowerSlowMethod`, `LowerSlowLength`, `LowerSlowPhase` — настройки медленной линии для младшего таймфрейма.
- `AllowBuyOpen`, `AllowSellOpen` — разрешения на открытие длинных и коротких позиций.
- `CloseBuyOnTrendFlip`, `CloseSellOnTrendFlip` — закрывать ли позиции при смене тренда на старшем ТФ.
- `CloseBuyOnLower`, `CloseSellOnLower` — закрывать ли позиции при пересечении на младшем ТФ против позиции.

## Особенности реализации
- В оригинальном коде использовалась обширная библиотека сглаживания. В портированной версии поддерживаемые методы отображаются на стандартные индикаторы StockSharp (SMA, EMA, SMMA/RMA, LWMA, Jurik, Kaufman AMA). Для остальных выбирается ближайший аналог, поэтому возможны небольшие расхождения в поведении.
- Модуль управления капиталом, стоп-лоссы, тейк-профиты и параметры проскальзывания из `TradeAlgorithms.mqh` не реализованы. Стратегия торгует фиксированным объёмом `Volume`.
- Все сделки выполняются рыночными ордерами. При необходимости можно добавить защиту (стоп-лосс, трейлинг) через стандартные механизмы StockSharp.
- Торговая логика активируется только при готовности обеих подписок и выполнении условия `IsFormedAndOnlineAndAllowTrading()`.

## Рекомендации по использованию
- Подбирайте таймфреймы в соответствии со стилем торговли (например, 6 часов / 30 минут для свинг-подхода). Возможны и другие комбинации.
- Настраивайте периоды ROC и методы сглаживания под требуемую чувствительность. Jurik обеспечивает поведение, максимально близкое к MQL-версии.
- При торговле на реальном счёте стоит дополнительно настроить риск-менеджмент (стоп-лоссы, контроль объёма), поскольку порт использует только рыночные выходы.
