# Стратегия Reversing Martingale

## Общее описание
**Reversing Martingale Strategy** — порт советника MetaTrader «Reversing Martingale EA». Стратегия постоянно держит только одну рыночную позицию и после каждого закрытия меняет направление сделки. Убыточные сделки запускают мартингейловое увеличение объёма, а прибыльные возвращают цикл к исходному лоту. Все позиции защищаются симметричными стоп-лоссом и тейк-профитом, заданными в пунктах.

Стратегия не использует индикаторы и не анализирует рыночную структуру: она реагирует исключительно на факт закрытия позиций, сохраняя активное присутствие на рынке, пока торговля разрешена.

## Логика работы
1. **Инициализация**
   - При старте стратегия сразу отправляет рыночный ордер с объёмом `Start Volume` и направлением `First Trade Side`.
   - Стоп-лосс и тейк-профит устанавливаются на расстоянии `Target (points)` при помощи `StartProtection`.
2. **Управление позицией**
   - Одновременно может существовать только одна позиция. Стратегия ждёт полного закрытия текущей позиции защитными ордерами или внешними действиями.
   - После закрытия направление следующей сделки разворачивается (buy → sell либо sell → buy).
   - Если последняя сделка завершилась с убытком, следующий объём равен предыдущему объёму, умноженному на `Lot Multiplier`. После прибыли объём сбрасывается к `Start Volume`.
3. **Продолжение цикла**
   - Как только вычислены новое направление и объём, мгновенно отправляется очередной рыночный ордер, поддерживая непрерывный цикл «реверсивного» мартингейла.

## Параметры
| Название | Описание |
| --- | --- |
| **Start Volume** | Исходный объём, с которого начинается каждый прибыльный цикл. |
| **Lot Multiplier** | Множитель объёма, применяемый после убыточной сделки (значение > 1). |
| **First Trade Side** | Направление первой сделки при запуске стратегии. |
| **Target (points)** | Расстояние до стоп-лосса и тейк-профита в минимальных шагах цены. |
| **Order Comment** | Необязательная текстовая пометка, присваиваемая каждому ордеру. |

## Дополнительные сведения
- Дистанция защитных ордеров преобразуется в `UnitTypes.Step` и передаётся в `StartProtection`, поэтому стоп и тейк всегда выставляются автоматически.
- Функция `NormalizeVolume` приводит объём в соответствие с шагом объёма инструмента и его лимитами по минимальному/максимальному размеру.
- Стратегия ожидает события исполнения от коннектора. Если торговля была приостановлена, цикл автоматически продолжится после восстановления соединения и разрешения торгов.
