# Стратегия Explosion Range Expansion

## Общее описание
Explosion Strategy — портированная версия советника «Explosion» для MetaTrader 5. Алгоритм сравнивает диапазон (High − Low) текущей завершённой свечи с диапазоном предыдущей и открывает рыночную позицию в сторону тела свечи, если расширение диапазона превышает заданное отношение. Версия для StockSharp сохраняет ключевые защитные механизмы оригинала и предоставляет удобные параметры для настройки торгового окна и трейлинг-стопа.

## Правила входа
- **Расширение диапазона.** Текущая свеча должна иметь диапазон больше, чем диапазон предыдущей свечи, умноженный на параметр `Range Ratio`.
- **Определение направления.**
  - Если свеча закрылась выше цены открытия и позиция отсутствует либо короткая, отправляется рыночная заявка на покупку.
  - Если свеча закрылась ниже цены открытия и позиция отсутствует либо длинная, отправляется рыночная заявка на продажу.
- **Торговое окно.** Сигналы учитываются только для свечей, закрытие которых попадает между `Start Hour` и `End Hour` включительно.
- **Ограничение сделок.** При включённом параметре `One Trade Per Day` исполняется только первый сигнал текущего дня.
- **Пауза между сделками.** После открытия позиции стратегия выдерживает паузу `Pause (sec)` секунд перед поиском нового входа.
- **Максимальная нагрузка.** Суммарный объём позиции не превышает `Max Positions * Order Volume`.

## Выход и управление риском
- **Начальные стопы.** Опциональные уровни стоп-лосса и тейк-профита задаются в шагах цены и рассчитываются от цены входа.
- **Трейлинг-стоп.** При активном трейлинге стоп-лосс подтягивается к цене после достижения минимального профита (`Trailing Stop + Trailing Step`), повторяя поведение оригинального советника.
- **Закрытие по целям.** При достижении свечой стоп-уровня или тейк-профита позиция закрывается рыночной заявкой.

## Настройки
- `Candle Type` – тип свечей для подписки.
- `Order Volume` – торговый объём в лотах.
- `Range Ratio` – коэффициент расширения диапазона для генерации сигнала.
- `Max Positions` – максимальное количество лотов в позиции.
- `Pause (sec)` – минимальная пауза между входами в секундах.
- `Start Hour` / `End Hour` – торговое время (0–23).
- `One Trade Per Day` – ограничение «одна сделка в день».
- `Stop Loss` – расстояние стоп-лосса в шагах цены.
- `Take Profit` – расстояние тейк-профита в шагах цены.
- `Trailing Stop` – расстояние трейлинг-стопа в шагах цены.
- `Trailing Step` – дополнительное смещение, необходимое для обновления трейлинг-стопа.

## Особенности конверсии
- Используется высокоуровневый API `SubscribeCandles` и `Bind`, что позволяет обходиться без индикаторов.
- Логика трейлинг-стопа, торгового окна, паузы и дневного ограничения полностью повторяет MQ5-версию.
- Размер позиции задаётся напрямую параметром объёма; расчёт лота от процента риска, присутствовавший в оригинале, не реализован.
