# Многотаймфреймовый трейдер
[English](README.md) | [中文](README_cn.md)

Стратегия анализирует девять таймфреймов свечных данных и строит для каждого линейный регрессионный канал одинаковой длины. Наклон канала на часовом таймфрейме (H1) выступает фильтром тренда: отрицательное значение разрешает только продажи, положительное — только покупки. Каналы на M5 и M1 используются для точного определения зон входа.

## Логика работы

- **Источники данных**: свечи на таймфреймах M1, M5, M15, M30, H1, H4, D1, W1 и MN1.
- **Индикаторы**: для каждого потока рассчитывается линейная регрессия. Верхняя и нижняя границы строятся симметрично относительно центральной линии по максимальному отклонению цены закрытия за выбранное окно.
- **Фильтр тренда**: проверяется знак наклона регрессии на H1. Пока наклон отрицательный, стратегия ищет только шорты; при положительном наклоне ищутся только лонги.
- **Условия входа**:
  - **Шорт** — экстремумы последней свечи M5 и последней свечи M1 находятся выше верхних границ своих каналов при отрицательном наклоне H1.
  - **Лонг** — минимумы последней свечи M5 и последней свечи M1 касаются нижних границ каналов при положительном наклоне H1.
- **Исполнение**: заявки отправляются по рынку с заданным объемом. Стоп-лосс рассчитывается как половина расстояния от верхней/нижней границы канала M5 до центральной линии. Тейк-профит равен самой линии M5.
- **Выход**: на каждом закрытии свечи M1 проверяются уровни стопа и цели. При достижении любого из уровней позиция закрывается рыночной заявкой.
- **Управление позицией**: одновременно может существовать только одна позиция (без усреднений и переворотов).

## Параметры

| Параметр | Описание |
| --- | --- |
| `EnableTrading` | Включает или выключает возможность выставления заявок. |
| `BarsToCount` | Количество свечей в окне регрессионных каналов (по умолчанию 50). |
| `Volume` | Объем рыночной заявки в лотах. |

## Дополнительные замечания

- Увеличение `BarsToCount` делает наклон каналов плавнее, но замедляет реакции на изменение тренда.
- Отображение наклонов по всем таймфреймам полезно для визуальной оценки синхронизации, хотя торговые решения принимает только наклон H1.
- Стопы и цели пересчитываются на каждой новой свече M5, поэтому риск подстраивается под актуальную ширину канала.
