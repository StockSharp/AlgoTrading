# Стратегия EMA Cross Trailing

## Обзор
Стратегия представляет собой портирование советника MetaTrader 4 `MQL/8606/EMA_CROSS_2.mq4` в инфраструктуру StockSharp. Она сохраняет исходную идею — отслеживать взаимное положение медленной и быстрой экспоненциальных скользящих средних и открывать единственную позицию при смене направления. Управление тейк-профитом, стоп-лоссом и трейлинг-стопом реализовано через высокоуровневый метод `StartProtection`, что позволяет повторить логику оригинала и одновременно следовать рекомендациям StockSharp.

## Логика торговли
- Формируются свечи заданного таймфрейма `CandleType` (по умолчанию 15 минут) и на их основе рассчитываются две EMA: медленная с периодом `SlowEmaLength` и быстрая с периодом `FastEmaLength`.
- Ведётся учёт последнего направления (медленная EMA выше или ниже быстрой). Первая завершённая свеча после формирования индикаторов используется только для инициализации направления — аналог переменной `first_time` в MQL.
- Когда медленная EMA поднимается выше быстрой (новое направление равно `1`) и стратегия находится вне позиции, отправляется рыночная заявка на покупку. Когда медленная EMA опускается ниже быстрой (новое направление `2`), отправляется рыночная заявка на продажу. Тем самым полностью воспроизводится поведение функции `Crossed(LEma, SEma)` из исходного кода.
- Одновременно может существовать только одна позиция. Пока ордер на вход исполняется либо позиция открыта, все последующие сигналы игнорируются.

## Управление сделкой и рисками
- `StartProtection` задаёт параметры тейк-профита, стоп-лосса и трейлинг-стопа в абсолютных ценовых шагах, вычисленных из `PriceStep` инструмента. Значение `TrailingStopPips = 0` отключает трейлинг.
- Для входов используются `BuyMarket`/`SellMarket`, а закрытие происходит рыночными ордерами при достижении защитных уровней, что отражает логику циклов `OrderSend` и `OrderModify` в советнике.
- Параметр `OrderVolume` задаёт базовый объём позиции. Перед отправкой заявки значение корректируется в соответствии с шагом объёма, минимальными и максимальными ограничениями инструмента.

## Параметры
| Параметр | Описание |
|----------|----------|
| `TakeProfitPips` | Расстояние в пунктах до тейк-профита. Значение по умолчанию: 20. |
| `StopLossPips` | Расстояние в пунктах до стоп-лосса. Значение по умолчанию: 30. |
| `TrailingStopPips` | Длина трейлинг-стопа в пунктах. Значение `0` выключает трейлинг. По умолчанию: 50. |
| `OrderVolume` | Объём входа (в лотах) до выравнивания по шагу. Значение по умолчанию: 2. |
| `FastEmaLength` | Период быстрой EMA по ценам закрытия. Значение по умолчанию: 5. |
| `SlowEmaLength` | Период медленной EMA по ценам закрытия. Значение по умолчанию: 60. |
| `CandleType` | Таймфрейм свечей. Значение по умолчанию: 15 минут. |

## Примечания
- Проверка `Bars < 100` из MQL заменена ожиданием формирования обеих EMA, что обеспечивает такую же устойчивость сигналов.
- Трейлинг-стоп обслуживается встроенным модулем защиты. Благодаря этому нет необходимости вручную вызывать `OrderModify`, как это делалось в оригинальной версии.
- Python-реализация не создавалась по запросу — в директории присутствует только C# версия.
