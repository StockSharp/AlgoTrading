# Fine Clock 策略

## 概述
- **来源**：来自 MetaTrader 5 专家顾问 `FineClock.mq5`（Vladimir Gomonov，2009）的移植。
- **用途**：在图表上持续显示数字时钟，并把时间同步到策略注释中，方便实时观察。
- **类型**：纯粹的可视化/工具型策略，不会发送任何订单。

## 工作流程
1. 订阅所选的 K 线数据类型，确保始终有价格坐标可以绘制文本。
2. 订阅 Level1 数据，追踪最新成交价以及买卖报价，用于把标签锚定在最近价格附近（若没有成交，则回退到买卖均价或 `PriceStep`）。
3. 根据所选显示格式自动启动策略内置计时器：`Seconds` 每秒触发一次，`Minutes` 每分钟触发一次。
4. 每次计时器触发时，按指定时间源（本地、服务器或 UTC）格式化时间，将文本写入策略注释，并在图表上绘制一到两个文本标签（第二个标签模拟阴影效果）。

实现完全基于 StockSharp 的高阶 API，例如 `SubscribeCandles`、`SubscribeLevel1`、图表绘制扩展以及策略计时器，无需手动管理指标或处理底层消息。

## 参数
| 名称 | 说明 | 默认值 |
|------|------|--------|
| `CandleType` | 用于绘制和确定时间位移单位的 K 线类型。 | `TimeFrame(1s)` |
| `Format` | 时钟格式（`Seconds` 显示 `HH:mm:ss`，`Minutes` 显示 `HH:mm`）。 | `Seconds` |
| `TimeSource` | 选择显示本地时间、连接器服务器时间或 UTC。 | `Local` |
| `Corner` | 目标角落，决定水平/垂直偏移的方向。 | `RightLower` |
| `HorizontalOffset` | 按蜡烛数量衡量的水平偏移（负值表示向左移动）。 | `0` |
| `VerticalOffset` | 按价格步长衡量的垂直偏移（负值表示向下移动）。 | `0` |
| `ShadowOffset` | 主文本与阴影文本之间的偏移量，单位与主偏移一致。 | `1` |
| `UseShadow` | 是否绘制阴影标签。 | `true` |
| `ShowInComment` | 是否把时间字符串写入 `Strategy.Comment`。 | `true` |

## 注意事项
- 文本位置会随着最新价格移动；当缺少成交时，会使用买卖均价或者 `PriceStep` 作为锚点。
- 计时器在市场静止时依旧运行，效果与 MetaTrader 中的 `OnTimer` 一致。
- 切换显示格式会立即更新计时器周期以及绘制的文本。
- 字体、字号和颜色由 StockSharp 图表主题控制，此策略只负责逻辑和位置。
- 策略仅用于信息展示，不会调用任何下单方法。

## 与 MetaTrader 版本的差异
- 原版可以使用像素坐标并指定字体/颜色；在 StockSharp 中使用时间/价格坐标，因此偏移以蜡烛和价格步长表示，外观由平台主题决定。
- 原版逻辑写在 `OnTimer` 中，本转换使用 `Strategy.Timer` 实现同样的节奏，并结合蜡烛与 Level1 订阅来保持价格锚点。
- 仍然绘制两个文本对象以模拟阴影，从而保留了原策略的视觉效果。
