# Стратегия Fine Clock

## Описание
- **Источник**: конвертация из советника MetaTrader 5 `FineClock.mq5` (Vladimir Gomonov, 2009).
- **Назначение**: декоративный оверлей, который отображает цифровые часы на графике и дублирует время в поле комментария стратегии.
- **Тип**: информационная стратегия без каких-либо торговых заявок.

## Принцип работы
1. Оформляет подписку на выбранный тип свечей, чтобы всегда иметь ценовой ориентир для размещения подписи.
2. Подключается к потоку Level1 и отслеживает последнюю цену сделки, а также бид/аск для корректной привязки метки к текущей цене (при отсутствии сделок используется середина спреда или `PriceStep`).
3. Запускает встроенный таймер стратегии с периодом, соответствующим выбранному формату отображения (`Seconds` — раз в секунду, `Minutes` — раз в минуту).
4. При каждом срабатывании таймера форматирует выбранный источник времени (локальный, серверный или UTC), записывает строку в комментарий стратегии и рисует одну или две подписи на графике (вторая подпись имитирует тень).

Во всей логике задействованы только высокоуровневые вспомогательные методы StockSharp (`SubscribeCandles`, `SubscribeLevel1`, рисование через `DrawText`, таймер стратегии). Никакой работы с низкоуровневыми сообщениями и ручного управления индикаторами не требуется.

## Параметры
| Имя | Описание | Значение по умолчанию |
|-----|----------|------------------------|
| `CandleType` | Тип свечей, используемый для прорисовки и расчёта базовой единицы смещения по времени. | `TimeFrame(1s)` |
| `Format` | Формат вывода часов (`Seconds` → `HH:mm:ss`, `Minutes` → `HH:mm`). | `Seconds` |
| `TimeSource` | Какое время показывать: локальное, серверное или UTC. | `Local` |
| `Corner` | Предпочтительный угол графика, определяющий направление горизонтальных/вертикальных смещений. | `RightLower` |
| `HorizontalOffset` | Дополнительный сдвиг по времени, измеряется в количестве свечей (отрицательные значения двигают влево). | `0` |
| `VerticalOffset` | Дополнительный сдвиг по цене, измеряется в шагах цены (отрицательные значения двигают вниз). | `0` |
| `ShadowOffset` | Расстояние между основной и теневой надписью в тех же единицах, что и основные смещения. | `1` |
| `UseShadow` | Включает/отключает отрисовку «теневой» надписи. | `true` |
| `ShowInComment` | Дублировать ли текст часов в поле `Strategy.Comment`. | `true` |

## Особенности
- Подпись следует за последней известной ценой; при отсутствии сделок используется середина спреда или шаг цены инструмента.
- Таймер поддерживает обновление часов даже в моменты отсутствия рыночной активности, что соответствует оригинальному `OnTimer` в MetaTrader.
- Изменение формата (`Seconds`/`Minutes`) моментально меняет период таймера и формат выводимой строки.
- Шрифт, размер и цвета зависят от настроек графика StockSharp; стратегия управляет только позиционированием и логикой обновления.
- Стратегия предназначена исключительно для визуализации и не выставляет торговые ордера.

## Отличия от версии MetaTrader
- В оригинале координаты задавались в пикселях и можно было выбирать шрифты и цвета. В StockSharp используются координаты «время/цена», поэтому смещения задаются в свечах и шагах цены, а оформление контролируется темой графика.
- MetaTrader выполнял код в обработчике `OnTimer`. Здесь используется `Strategy.Timer` с аналогичным интервалом и добавлены подписки на свечи/Level1, чтобы всегда иметь актуальную цену привязки.
- Сохранена двойная отрисовка текста: основная подпись плюс смещённая «тень», что визуально повторяет оригинальный советник.
