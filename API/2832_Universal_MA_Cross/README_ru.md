# Стратегия Universal MA Cross

## Обзор
**Universal MA Cross Strategy** — конвертация оригинального эксперта MQL5 «UniversalMACrossEA» в высокоуровневый фреймворк StockSharp. Алгоритм сравнивает быструю и медленную скользящие средние, позволяя задать метод сглаживания и тип цены для каждой линии. Дополнительные параметры управляют подтверждением сигналов, поведением «стоп и разворот», логикой риск-менеджмента и допуском к торговле по времени.

## Логика торговли
### Расчёт индикаторов
* Рассчитываются две скользящие средние по выбранной серии свечей. Для каждой можно задать собственный период, метод (SMA, EMA, SMMA или LWMA) и тип цены (close, open, high, low, median, typical или weighted).
* Параметр **MinCrossDistance** требует, чтобы на баре пересечения расстояние между средней и сигнальной линиями было не меньше заданного значения в ценовых единицах.
* Если включено **ConfirmedOnEntry**, пересечение проверяется по двум предыдущим закрытым барам (аналог индексов 2 и 1 в исходном эксперте). При отключении сравнивается текущий завершённый бар с предыдущим, что имитирует «тик-режим» MQL.
* Параметр **ReverseCondition** меняет местами условия покупок и продаж без изменения индикаторных настроек.

### Правила входа
1. Для открытия длинной позиции быстрая средняя должна пересечь медленную сверху вниз с запасом не меньше **MinCrossDistance**. Для короткой позиции требуется обратное пересечение.
2. При активном параметре **StopAndReverse** появление противоположного сигнала приводит к закрытию текущей позиции перед рассмотрением новых ордеров.
3. Если **OneEntryPerBar** установлено в `true`, стратегия запоминает время бара последнего входа и не открывает повторную сделку в пределах той же свечи.
4. Объём каждой сделки задаётся параметром **Volume**.

### Сопровождение позиции
* Стоп-лосс и тейк-профит задаются в абсолютных ценовых величинах. В режиме **PureSar** они отключаются, что соответствует опции «Pure SAR» в исходном советнике.
* Трейлинг-стоп активируется после движения цены на величину **TrailingStop + TrailingStep** от входа. Каждое последующее смещение не менее **TrailingStep** подтягивает стоп на расстояние **TrailingStop**. В режиме **Pure SAR** трейлинг не используется.
* Защитные уровни контролируются по завершённым свечам. Если диапазон свечи пробивает стоп или тейк-профит, позиция закрывается рыночным ордером.

### Временной фильтр
* При включённом **UseHourTrade** сделки совершаются только в случае, если час открытия свечи лежит между **StartHour** и **EndHour** (включительно). Управление трейлинг-стопом продолжается и вне этого интервала, но новые входы и «стоп и разворот» не выполняются.

## Параметры
| Параметр | Описание |
|----------|----------|
| `FastMaPeriod`, `SlowMaPeriod` | Периоды быстрой и медленной скользящих средних. |
| `FastMaType`, `SlowMaType` | Методы расчёта: простая, экспоненциальная, сглаженная (RMA) или линейно-взвешенная. |
| `FastPriceType`, `SlowPriceType` | Типы цен, подаваемые на соответствующие средние. |
| `StopLoss`, `TakeProfit` | Защитные расстояния в абсолютных ценовых единицах (0 отключает уровень). |
| `TrailingStop`, `TrailingStep` | Величина трейлинг-стопа и минимальный дополнительный ход перед подтяжкой. |
| `MinCrossDistance` | Минимальная дистанция между средними на баре пересечения. |
| `ReverseCondition` | Переворот логики входов. |
| `ConfirmedOnEntry` | Подтверждение сигналов только закрытыми барами. |
| `OneEntryPerBar` | Не более одного входа на свечу. |
| `StopAndReverse` | Закрыть текущую позицию и перевернуться по противоположному сигналу. |
| `PureSar` | Отключить стоп-лосс, тейк-профит и трейлинг. |
| `UseHourTrade`, `StartHour`, `EndHour` | Временной фильтр (часы 0–23). |
| `Volume` | Объём заявки. |
| `CandleType` | Тип свечных данных для расчётов. |

## Особенности конверсии
* Защитные уровни контролируются внутри стратегии по максимумам и минимумам свечи, поскольку высокоуровневый StockSharp работает с завершёнными барами, а не с тиками. Такой подход сохраняет логику оригинального эксперта.
* Алгоритм трейлинг-стопа повторяет MQL-реализацию: стоп подтягивается только после прохождения цены на **TrailingStop + TrailingStep**.
* По требованию заказчика Python-версия стратегии не создавалась.
