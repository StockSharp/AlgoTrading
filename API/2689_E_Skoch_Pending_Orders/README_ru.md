# Стратегия e-Skoch Pending Orders

## Обзор

**e-Skoch Pending Orders** — это порт оригинального советника MetaTrader, который работает только на открытии новой свечи, анализирует два последних максимума и минимума на рабочем таймфрейме и на дневном таймфрейме и размещает отложенные ордера на пробой. Целью является захват импульса после короткой коррекции, когда дневной тренд подтверждает направление прорыва.

Версия для StockSharp повторяет исходную логику, но использует высокоуровневые возможности API: подписку на свечи, автоматическую установку защитных заявок и систему параметров. Код на C# расположен в папке `CS/`. Python-реализация пока не создавалась.

## Логика торговли

1. После закрытия каждой свечи считываются максимумы и минимумы двух последних свечей рабочего таймфрейма, а также данные двух предыдущих дневных свечей.
2. Если последний дневной максимум ниже позапрошлого и предыдущий внутридневной максимум также ниже своего предшественника, стратегия размещает **buy stop** над ближайшим максимумом с добавлением настраиваемого отступа.
3. Если последний дневной минимум выше позапрошлого и предыдущий внутридневной минимум также выше своего предшественника, стратегия размещает **sell stop** ниже последнего минимума с учётом заданного отступа.
4. Каждая заявка сразу получает собственные уровни стоп-лосса и тейк-профита. При исполнении входа стратегия моментально выставляет защитные стоповые и лимитные заявки по текущей позиции.
5. Когда активных позиций и ордеров нет, фиксируется текущее значение капитала. При росте капитала на установленный процент относительно этой базы все позиции закрываются, а защитные заявки отменяются.
6. Параметр `CheckExistingTrade` позволяет запретить размещение новых ордеров, если уже открыта какая-либо позиция, что полностью повторяет флаг «CheckTrade» из оригинального советника.

## Параметры

| Параметр | Описание |
| --- | --- |
| `CandleType` | Рабочий таймфрейм для сигналов (по умолчанию часовые свечи). |
| `TakeProfitBuyPips` / `StopLossBuyPips` | Размер тейк-профита и стоп-лосса для длинных позиций в пунктах. |
| `TakeProfitSellPips` / `StopLossSellPips` | Размер тейк-профита и стоп-лосса для коротких позиций в пунктах. |
| `IndentHighPips` / `IndentLowPips` | Отступ от последнего максимума/минимума для постановки отложенных ордеров. |
| `CheckExistingTrade` | Если включено, новые сигналы игнорируются при наличии открытой позиции. |
| `PercentEquity` | Процент роста капитала, после достижения которого все позиции закрываются. |
| `Volume` | Объём входа. Значение 0.01 соответствует настройкам оригинального советника. |

## Управление рисками

- Buy stop сопровождается стоп-лоссом ниже цены входа и тейк-профитом выше неё.
- Sell stop сопровождается стоп-лоссом выше цены входа и тейк-профитом ниже неё.
- При закрытии позиции или переустановке защиты старые защитные заявки отменяются автоматически.
- Контроль роста капитала выполняет роль «глобального» стопа, фиксируя прибыль и предотвращая дальнейшие сделки до следующего сигнала.

## Дополнительные замечания

- Для работы стратегии необходимы данные по рабочему таймфрейму и по дневным свечам — убедитесь, что оба потока данных доступны в Designer или при тестировании.
- Для инструментов с трёх- и пятизнаковой котировкой размер пункта автоматически пересчитывается: шаг цены умножается на 10.
- При активном `CheckExistingTrade` стратегия предполагает наличие только одной совокупной позиции и не допускает одновременных длинных и коротких позиций.
