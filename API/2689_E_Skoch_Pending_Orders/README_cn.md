# e-Skoch 挂单策略

## 概述

**e-Skoch 挂单策略** 复刻了原始的 MetaTrader 专家顾问。策略在每个新 K 线形成时，比较交易时间框架与日线时间框架的最近两根 K 线高低点，并在突破水平附近放置突破型挂单。目标是在日线趋势确认的情况下，捕捉价格冲破上一根 K 线后的动能。

本 StockSharp 版本沿用了原始思路，但使用了高层 API，包括蜡烛订阅、自动保护单和参数系统。C# 实现位于 `CS/` 目录，目前尚未提供 Python 版本。

## 交易逻辑

1. 每当一个蜡烛收盘时，读取交易时间框架最近两根蜡烛的高低点，同时获取前两根日线蜡烛的高低点。
2. 若最近一根日线高点低于前一根日线高点，并且上一根交易周期高点低于再前一根高点，则在最近高点上方加上缓冲距离处放置 **买入止损** 挂单。
3. 若最近一根日线低点高于前一根日线低点，并且上一根交易周期低点高于再前一根低点，则在最近低点下方减去缓冲距离处放置 **卖出止损** 挂单。
4. 每个挂单都带有独立的止损和止盈。当挂单被触发后，策略会立即为当前持仓提交对应方向的保护性止损与止盈委托。
5. 当没有持仓与挂单时，记录当前权益作为基准值；若账户权益相对该基准值的涨幅达到设定百分比，立即平掉所有持仓并取消保护性委托。
6. 可选的 `CheckExistingTrade` 参数可以阻止在有持仓时继续发出新的挂单，行为与原始 EA 的 “CheckTrade” 参数一致。

## 参数说明

| 参数 | 描述 |
| --- | --- |
| `CandleType` | 用于产生信号的主时间框架，默认 1 小时蜡烛。 |
| `TakeProfitBuyPips` / `StopLossBuyPips` | 多头方向的止盈与止损偏移量（以点数计）。 |
| `TakeProfitSellPips` / `StopLossSellPips` | 空头方向的止盈与止损偏移量（以点数计）。 |
| `IndentHighPips` / `IndentLowPips` | 挂单距离最近高点或低点的缓冲点数。 |
| `CheckExistingTrade` | 为 true 时，只要存在持仓就不会放置新的挂单。 |
| `PercentEquity` | 相对基准权益的百分比增幅，达到时关闭全部仓位。 |
| `Volume` | 下单数量，默认 0.01 手以贴合原 EA 设置。 |

## 风险管理

- 买入止损单会在入场价下方放置止损，在入场价上方放置止盈。
- 卖出止损单会在入场价上方放置止损，在入场价下方放置止盈。
- 当持仓平仓或生成新的保护组合时，会自动取消旧的保护性委托。
- 权益增幅检测相当于全局止盈，在达到目标后立即锁定盈利并重新等待下一次机会。

## 注意事项

- 策略需要同时订阅主时间框架与日线蜡烛，请确保在 Designer 或回测环境中具备这两类数据。
- 对于采用 3 位或 5 位小数报价的外汇品种，策略会自动把价格步长乘以 10 以转换成标准点值。
- `CheckExistingTrade` 启用时策略默认只维持单方向持仓，不会同时持有多空仓位。
