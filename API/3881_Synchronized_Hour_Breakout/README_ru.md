# Стратегия «Synchronized Hour Breakout»

## Обзор
**Synchronized Hour Breakout** — это портирование в StockSharp экспертного советника MetaTrader 4 `JK_sinkhro1`. Стратегия подсчитывает соотношение бычьих и медвежьих свечей за последний период и ищет точки входа только в два заранее определённых «синхронизированных» часа (по умолчанию 19:00 и 22:00 плюс смещение). Такой подход позволяет отлавливать направленные импульсы, сохраняя строгие ограничения риска, заложенные в оригинальный MQL-советник.

## Логика торговли
- Работает с серией свечей, заданной параметром `Candle Type` (по умолчанию — часовые свечи).
- Поддерживает скользящее окно из `Analysis Period` завершённых свечей и подсчитывает, сколько из них закрылись ростом и падением.
- Если число бычьих свечей больше медвежьих, формируется условие для покупки в первый час синхронизации (`22 + Hour Offset`).
- Если число медвежьих свечей больше бычьих, готовится условие для продажи во второй час синхронизации (`19 + Hour Offset`).
- Сигнал действителен только в первые пять минут часа, чтобы открытие сделки совпадало с началом новой свечи, как в исходном коде.
- Новые заявки не отправляются, если уже достигнут лимит `Max Active Orders` или по инструменту имеется открытая позиция.

## Управление рисками и сделками
- Позиции открываются фиксированным объёмом (`Fixed Volume`) либо адаптивным объёмом, вычисленным на основе свободных средств портфеля и параметра `Risk %`. Расчёт повторяет логику исходного советника: допустимый риск делится на расстояние до стоп-лосса в шагах цены.
- Для каждой сделки используется многоуровневое сопровождение:
  - основной тейк-профит на расстоянии `Take Profit (pts)` от цены входа;
  - быстрый тейк-профит `Secondary TP (pts)`, имитирующий досрочное закрытие позиции при достижении первого целевого уровня;
  - стоп-лосс `Stop Loss (pts)` ниже/выше цены входа.
- Дополнительный трейлинг: при движении цены на величину `Trailing Stop (pts)` экстремум фиксируется, и позиция закрывается при возврате цены на трейлинг-дистанцию.
- После полного выхода из позиции состояние стратегии очищается и готовится к следующему окну синхронизации.

## Параметры
| Параметр | Описание |
| --- | --- |
| `Take Profit (pts)` | Основной тейк-профит в шагах цены инструмента. |
| `Secondary TP (pts)` | Быстрый тейк-профит, срабатывающий до основного. |
| `Stop Loss (pts)` | Стоп-лосс в шагах цены. |
| `Trailing Stop (pts)` | Дистанция трейлинг-стопа (0 — отключено). |
| `Analysis Period` | Количество свечей в анализируемом окне. |
| `Hour Offset` | Смещение, добавляемое к исходным часам 19:00 и 22:00. |
| `Max Active Orders` | Максимум одновременно активных заявок стратегии. |
| `Fixed Volume` | Объём сделки при выключенном риск-менеджменте. |
| `Use Risk Volume` | Включение динамического расчёта объёма. |
| `Risk %` | Процент капитала, которым рискуем в одной сделке (для динамического объёма). |
| `Candle Type` | Тип/таймфрейм свечей, по которым ведётся расчёт. |

## Рекомендации по использованию
- Значения по умолчанию рассчитаны под торговлю парами типа EURUSD в часовом формате; при необходимости скорректируйте `Hour Offset` под часовой пояс брокера.
- Убедитесь, что инструмент в StockSharp содержит корректные `PriceStep`, `VolumeStep` и `MinVolume`, чтобы расчёт объёма и стопов соответствовал торговой площадке.
- Стратегия использует данные закрытия свечей, поэтому необходим источник данных, выдающий выбранный таймфрейм без задержек.
- Трейлинг-логика основана на закрытиях свечей: такое поведение максимально приближено к тиковому сопровождению исходного эксперта, но полностью совместимо с высокоуровневым API StockSharp.
