# 同步时段突破策略

## 概述
**同步时段突破策略（Synchronized Hour Breakout）** 是将 MetaTrader 4 专家顾问 `JK_sinkhro1` 移植到 StockSharp 平台的版本。策略在最近一段时间内统计多头与空头蜡烛数量，只在两个预设的“同步”时段（默认为 19:00 与 22:00 加上时间偏移量）寻找入场机会，以捕捉方向性突破，同时延续原策略的风险控制思想。

## 交易逻辑
- 使用由 `Candle Type` 参数指定的蜡烛序列（默认：1 小时蜡烛）。
- 维护长度为 `Analysis Period` 的滑动窗口，对窗口内已完成蜡烛的收盘方向进行计数。
- 当多头蜡烛数量大于空头蜡烛时，在第一个同步时段（`22 + Hour Offset`）准备做多突破。
- 当空头蜡烛数量大于多头蜡烛时，在第二个同步时段（`19 + Hour Offset`）准备做空突破。
- 信号只在每个小时的前 5 分钟内有效，以保证下单与新蜡烛的开盘时刻同步，符合原始 EA 的逻辑。
- 如果活跃订单数已达到 `Max Active Orders` 或当前持有仓位，则新的信号会被忽略。

## 风险与仓位管理
- 开仓量可以使用固定值（`Fixed Volume`），也可以根据账户现金与 `Risk %` 参数动态计算。动态模式将允许的资金风险除以止损距离（价格步长），从而模拟原策略的资金管理。
- 每笔交易包含三层退出机制：
  - `Take Profit (pts)`：主要止盈目标。
  - `Secondary TP (pts)`：较快的止盈目标，对应原策略中提前平仓的逻辑。
  - `Stop Loss (pts)`：硬性止损距离。
- 可选的 `Trailing Stop (pts)`：当浮盈超过该距离后，策略会记录有利方向的极值，若价格回撤超过追踪距离则立即平仓。
- 每次平仓后都会重置内部状态，以等待下一次同步交易窗口。

## 参数说明
| 参数 | 说明 |
| --- | --- |
| `Take Profit (pts)` | 主要止盈目标，单位为价格步长。 |
| `Secondary TP (pts)` | 较快止盈目标，先于主要止盈触发。 |
| `Stop Loss (pts)` | 止损距离，单位为价格步长。 |
| `Trailing Stop (pts)` | 追踪止损距离，0 表示关闭。 |
| `Analysis Period` | 统计多空数量时使用的蜡烛数量。 |
| `Hour Offset` | 加到默认同步时间（19:00 和 22:00）上的偏移量。 |
| `Max Active Orders` | 允许存在的最大活跃订单数量。 |
| `Fixed Volume` | 未开启风险模型时使用的固定下单量。 |
| `Use Risk Volume` | 是否启用基于风险的下单量计算。 |
| `Risk %` | 在风险模型下，每笔交易允许承担的资金百分比。 |
| `Candle Type` | 计算与信号使用的蜡烛类型/周期。 |

## 使用建议
- 默认参数适用于原 EA 所使用的欧美时段交易，可根据经纪商服务器时间调整 `Hour Offset`。
- 请确认证券对象提供了准确的 `PriceStep`、`VolumeStep` 与 `MinVolume`，以便风险模型正确匹配交易所的最小变动单位。
- 策略依赖已完成蜡烛的数据，建议连接能够稳定提供相应周期蜡烛的行情源或历史数据服务。
- 追踪止损基于蜡烛收盘价计算，这在保持 StockSharp 高层 API 兼容性的同时，尽量贴近原 EA 依赖逐笔报价更新的行为。
