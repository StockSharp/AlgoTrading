# Стратегия ASCV Pivot Breakout

## Обзор

ASCV Pivot Breakout — это высокоуровневый порт оригинального советника MetaTrader 4 «ASCV» (файл `Avpb.mq4`) на платформу StockSharp. В исходном коде использовались два пользовательских индикатора ASCTrend1sig и BrainTrend1Sig, стандартное отклонение, дневные уровни пивота и рост объёма для торговли по пробойной тенденции в заданном торговом окне. Поскольку закрытые индикаторы недоступны в StockSharp, реализация заменяет их комбинацией скользящих средних, стохастика и расчёта дневных пивотов, сохраняя при этом оригинальные правила управления позицией.

## Логика торговли

1. **Сеансовый фильтр.** Сделки разрешены только между заданными часами (по умолчанию 02:00–20:00 по времени брокера). Каждый новый час сбрасывает флаги входа, как и условие `Minute()==0` в MQL.
2. **Порог волатильности.** Индикатор стандартного отклонения на выбранном таймфрейме должен превышать заданный порог, что соответствует проверке `iStdDev` в советнике.
3. **Подтверждение тренда.** Быстрая и медленная SMA заменяют связку ASCTrend/BrainTrend. Для покупок требуется, чтобы быстрая средняя находилась выше медленной, а свеча закрывалась выше дневного пивота. Для продаж — наоборот.
4. **Импульс.** Стохастик гарантирует, что пробои сопровождаются положительным (для лонга) или отрицательным (для шорта) значением `%K-%D`. Абсолютное значение спрэда также используется как динамический фильтр выхода, аналогичный оригинальному советнику.
5. **Рост объёма.** Разница между объёмом текущей и предыдущей свечи должна быть не меньше заданного порога (по умолчанию 30), имитируя условие `Volume[0]-Volume[1]`.
6. **Выставление заявок.** Используются рыночные приказы `BuyMarket` и `SellMarket` с фиксированным объёмом. В течение одного часа допускается только одна сделка в каждую сторону.
7. **Стопы и цели.** Стоп-лосс ставится на ближайшие уровни поддержки/сопротивления (S1/S2 или R1/R2). Если они слишком близко, применяется резервное расстояние в шагах цены. Цели по прибыли строятся по той же иерархии, как и в MQL-версии.
8. **Динамическое сопровождение.** Стохастик отвечает за ранний выход при потере импульса, а трейлинг-стоп в шагах цены повторяет логику последовательного подтягивания стопа.

## Параметры

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Таймфрейм для индикаторов и сигналов. | Свечи 15 минут |
| `StartHour` / `EndHour` | Границы торговой сессии (включительно). | 2 / 20 |
| `FastMaLength` | Период быстрой SMA. | 10 |
| `SlowMaLength` | Период медленной SMA. | 40 |
| `StdDevLength` | Длина окна для стандартного отклонения. | 10 |
| `StdDevThreshold` | Минимальное стандартное отклонение. | 0.0005 |
| `VolumeDeltaThreshold` | Минимальный прирост объёма свечи. | 30 |
| `StochasticKPeriod` / `StochasticDPeriod` / `StochasticSlowing` | Параметры стохастика. | 5 / 3 / 3 |
| `StochasticExitDelta` | Порог абсолютного значения `%K-%D` для выхода. | 5 |
| `TrailingStopSteps` | Дистанция трейлинг-стопа в шагах цены. | 30 |
| `MinPivotDistanceSteps` | Минимальная дистанция до целевых уровней по пивотам. | 50 |
| `StopFallbackSteps` | Резервный стоп-лосс в шагах цены. | 33 |
| `TakeProfitBufferSteps` | Резервный тейк-профит в шагах цены. | 50 |
| `OrderVolume` | Объём каждой сделки. | 1 |

Все расстояния задаются в шагах цены инструмента, что упрощает адаптацию под разные биржи.

## Особенности реализации

- Используется высокоуровневый API: подписка на свечи и `BindEx(...)` без добавления индикаторов в `Strategy.Indicators`.
- Пивоты рассчитываются один раз в сутки на основе High/Low/Close предыдущего дня. В первый торговый день стратегия только собирает данные.
- `StartProtection()` активирован для повышения устойчивости при обрывах соединения.
- XML-комментарии и пояснения в коде показывают соответствие блоков оригинальному MQL.
- Стопы и цели выставляются через `SetStopLoss` и `SetTakeProfit` с переводом расстояний в шаги цены.

## Рекомендации по применению

1. Используйте инструменты, где доступна информация по объёмам свечей — фильтр объёмов критичен.
2. При оптимизации сначала подбирайте параметры волатильности (`StdDevThreshold`) и объёма (`VolumeDeltaThreshold`).
3. Для высоковолатильных рынков увеличивайте `MinPivotDistanceSteps`, чтобы дать цене пространство до тейка.
4. Если стохастик слишком часто закрывает позиции, увеличьте `StochasticExitDelta`, чтобы трейлинг-стоп управлял выходами.

## Файлы

- `CS/AscvStrategy.cs` — основная реализация стратегии.
- `README.md` — документация на английском.
- `README_ru.md` — текущий файл на русском.
- `README_cn.md` — перевод на китайский.
