# Стратегия Risk Manager Info Panel

## Обзор
**Risk Manager Info Panel** повторяет информационную панель из MetaTrader 5 эксперт-советника *RiskManager_with_InfoPanel_and_Support*. Исходный советник не открывал сделки – он лишь рассчитывал параметры риска и выводил их на график вместе с кнопкой поддержки. Перенос на StockSharp сохраняет такой же аналитический профиль: стратегия вычисляет рекомендуемый объём позиции по заданному проценту риска, показывает ожидаемые уровни стоп-лосса и тейк-профита и контролирует превышение дневного лимита убытков. Все результаты публикуются в поле комментария стратегии (`Strategy.Comment`), поэтому панель можно отобразить в Designer, Shell или собственной визуализации.

Стратегия не торгует автоматически, её задача – предоставить трейдеру информацию о рисках во время ручных операций или работы других алгоритмов.

## Основные возможности
- Формула размера позиции полностью повторяет расчёт MT5: используется текущая стоимость портфеля, расстояние до стоп-лосса и стоимость минимального шага цены.
- Отслеживает баланс счёта, текущую стоимость, плавающий результат и время последнего обновления.
- Строит уровни стоп-лосса/тейк-профита относительно эталонной цены входа, рассчитывает расстояние в пунктах и соотношение риск/прибыль.
- Накапливает реализованный результат за текущий день и предупреждает о превышении дневного лимита риска.
- Поддерживает дополнительное сообщение поддержки, чтобы комментарий стратегии воспроизводил текст кнопки «Support».

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `RiskPercent` | `1` | Процент капитала, которым рискует каждая сделка. |
| `EntryPrice` | `1.1000` | Расчётная цена входа для отображения уровней SL/TP. |
| `StopLossPercent` | `0.2` | Процентное расстояние от входа до стоп-лосса. |
| `TakeProfitPercent` | `0.5` | Процентное расстояние от входа до тейк-профита. |
| `MaxDailyRiskPercent` | `2` | Дневной лимит убытков; предупреждение появляется при просадке ниже `-equity × MaxDailyRiskPercent / 100`. |
| `UpdateIntervalSeconds` | `10` | Интервал обновления панели в секундах. |
| `UseSupportMessage` | `true` | Включает отображение строки с поддержкой. |
| `SupportMessage` | `"Contact support for assistance!"` | Текст, добавляемый после статистики для имитации кнопки поддержки. |

Все параметры можно менять во время работы через панель свойств Designer или через `Strategy.Param`. Для рисковых настроек добавлены проверки на неотрицательные значения, аналогичные ограничениям в оригинальном MQL.

## Как пользоваться
1. Привяжите стратегию к нужному инструменту и портфелю.
2. Задайте эталонную цену входа, проценты риска и сообщение поддержки при необходимости.
3. Запустите стратегию. Каждые `UpdateIntervalSeconds` секунд комментарий стратегии обновляется блоком текста, повторяющим панель MT5:
   ```
   Risk Manager for EURUSD@FX
   -----------------------------
   Account: DEMO-12345
   Balance: 10000.00
   Equity: 10025.34
   Floating PnL: 25.34
   Updated: 12:30

   Risk/Trade: 1.00%
   Entry Price: 1.10000
   Stop Loss: 1.09780 (0.20%)
   Take Profit: 1.10550 (0.50%)

   Distance (pips): 22.0
   Risk ($): 100.25
   Recommended Volume: 0.45
   Reward:Risk Ratio: 1.82

   Daily P/L: 35.00
   Daily Risk Limit: 200.51
   ```
4. Отобразите `Strategy.Comment` или строку `RiskSnapshot` в своём интерфейсе, чтобы показать панель. Если дневной лимит риска превышен, добавляется предупреждение `*** DAILY RISK LIMIT EXCEEDED! Trading suspended.`.

## Отличия от версии MetaTrader
- Вместо объектов графика используется поле `Strategy.Comment`, что упрощает перенос стратегии между приложениями StockSharp.
- Конвертация пунктов основана на свойствах инструмента `Security.PriceStep` и `Security.StepPrice`, поэтому формула подходит для фьючерсов, форекса и CFD без ручных коэффициентов.
- Реализованный дневной результат суммируется по событиям `MyTrade.PnL` и автоматически сбрасывается при переходе на новый торговый день.
- Строка поддержки отображается текстом; активной кнопки нет, так как стратегии StockSharp не управляют элементами графика напрямую.

## Примечания
- Подключите портфель, который предоставляет `Portfolio.CurrentValue` и `Portfolio.CurrentBalance`. Если данные отсутствуют, расчёты используют нули и рекомендованный объём будет равен нулю.
- Стратегия носит информационный характер и не вызывает методов `BuyMarket`, `SellMarket` и т.п. Используйте её совместно с ручной торговлей или другими роботами.
- Защитный монитор запускается один раз при старте, что соответствует руководству по защитным модулям StockSharp.
