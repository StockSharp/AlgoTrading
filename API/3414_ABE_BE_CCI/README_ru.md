# Стратегия ABE BE CCI Engulfing
[English](README.md) | [中文](README_cn.md)

Данный проект переносит эксперта MetaTrader 5 **Expert_ABE_BE_CCI** (папка `MQL/306`) в экосистему StockSharp. Исходный робот использует свечные модели «Bullish/Bearish Engulfing», подтверждённые индикатором Commodity Channel Index (CCI), и торгует фиксированным объёмом. C# версия полностью воспроизводит логику принятия решений, но реализована через высокоуровневые подписки и индикаторы StockSharp, поэтому код становится компактнее и прозрачнее.

Алгоритм обрабатывает только завершённые свечи выбранного таймфрейма. Для каждой новой свечи рассчитывается скользящее среднее величины тела (`BodyAveragePeriod`) и среднее закрытия, а также CCI с периодом `CciPeriod`. Паттерн поглощения считается валидным, если тело текущей свечи превышает средний размер, её закрытие выходит за пределы открытия предыдущей свечи, а средняя точка поглощённой свечи расположена по правильную сторону от среднего закрытия — это повторяет проверки класса `CCandlePattern` из MQL. В лонг входим при бычьем поглощении и CCI ниже уровня перепроданности `EntryOversoldLevel`, в шорт — при медвежьем поглощении и CCI выше `EntryOverboughtLevel`. Выходы из позиций соответствуют 40-балльным «голосам» оригинального фильтра: любое пересечение CCI через ±`ExitLevel` закрывает открытую позицию.

## Как работает стратегия

1. Подписка на свечи `CandleType` и одновременный расчёт:
   - среднего размера тела по `BodyAveragePeriod` последним барам;
   - среднего значения цены закрытия за тот же период;
   - индикатора CCI длиной `CciPeriod`.
2. При формировании новой завершённой свечи:
   - проверяется, что предыдущая свеча противоположного цвета и её тело полностью «поглощено» текущей свечой;
   - убедиться, что тело поглощения больше среднего и закрытие выше (ниже) открытия предыдущей свечи;
   - оценить контекст тренда по положению средней точки предыдущей свечи относительно среднего закрытия;
   - подтвердить импульс по CCI и соответствующим порогам.
3. Управление сделками:
   - при бычьем наборе условий закрываются шорты и открывается лонг указанного объёма;
   - при медвежьем наборе закрываются лонги и открывается шорт;
   - CCI контролирует выход: пересечение сверху вниз `+ExitLevel` или опускание ниже `-ExitLevel` закрывает лонги, пересечение снизу вверх `-ExitLevel` или падение ниже `+ExitLevel` — шорты.

## Параметры по умолчанию

| Параметр | Значение | Описание |
| --- | --- | --- |
| `CciPeriod` | 49 | Период индикатора Commodity Channel Index. |
| `BodyAveragePeriod` | 11 | Длина окна для среднего размера свечного тела и среднего закрытия. |
| `EntryOversoldLevel` | -50 | Порог перепроданности для подтверждения бычьего поглощения. |
| `EntryOverboughtLevel` | 50 | Порог перекупленности для подтверждения медвежьего поглощения. |
| `ExitLevel` | 80 | Абсолютное значение CCI, при пересечении которого позиция закрывается. |
| `CandleType` | 1 час | Таймфрейм свечей, используемый в стратегии. |

## Дополнительно

- Управление объёмом идентично оригиналу: базовый размер задаётся параметром `Volume`, а при развороте противоположная позиция закрывается автоматически.
- Компоненты MQL (`TrailingNone`, `MoneyFixedLot`) не переносились — их функции покрывает стандартная логика StockSharp.
- Комментарии в коде написаны на английском, отступы выполнены табуляцией, индикаторные значения берутся из `Bind`, без вызовов `GetValue`, как требует репозиторий.
