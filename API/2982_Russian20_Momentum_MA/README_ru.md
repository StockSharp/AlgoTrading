# Стратегия Russian20 Momentum MA

## Обзор
**Russian20 Momentum MA** — это прямой порт оригинального советника MetaTrader 5 `Russian20-hp1.mq5`. Скрипт компании Gordago Software Corp. использует двухчасовые свечи, простое скользящее среднее с периодом 20 и индикатор Momentum с периодом 5 для отслеживания продолжения краткосрочного тренда. Версия для StockSharp сохраняет исходную логику анализа и адаптирует управление позициями под высокоуровневый API стратегий.

## Торговая логика
- **Таймфрейм:** по умолчанию 2-часовые свечи (аналог MQL5 `PERIOD_H2`). Обработка выполняется только после закрытия свечи.
- **Индикаторы:**
  - Простое скользящее среднее (SMA) с настраиваемым периодом, по умолчанию 20.
  - Индикатор Momentum с настраиваемым периодом, по умолчанию 5. Уровень 100 используется как нейтральное значение, как и в MQL5.
- **Условия входа в длинную позицию (все пункты должны выполниться):**
  1. Цена закрытия выше SMA.
  2. Значение Momentum превышает 100 и подтверждает положительное ускорение.
  3. Цена закрытия выше закрытия предыдущей свечи, что фиксирует восходящий импульс.
- **Условия входа в короткую позицию (все пункты должны выполниться):**
  1. Цена закрытия ниже SMA.
  2. Значение Momentum ниже 100 и показывает отрицательное ускорение.
  3. Цена закрытия ниже закрытия предыдущей свечи.
- **Выход из длинной позиции:** при падении Momentum ниже 100 либо при достижении рассчитанного стоп-лосса или тейк-профита.
- **Выход из короткой позиции:** при росте Momentum выше 100 либо при достижении соответствующих уровней стоп-лосса и тейк-профита.

## Управление рисками
В MQL5 версия использует фиксированные стоп-лосс и тейк-профит в пунктах с поправкой на 4- и 5-значные котировки. Реализация на C# повторяет этот подход:
- Расчитывает размер пункта на основе `PriceStep`. Для инструментов с тремя или пятью десятичными знаками пункт равен `PriceStep * 10`, в остальных случаях — `PriceStep`.
- Переводит заданные пользователем значения стоп-лосса и тейк-профита в абсолютные ценовые расстояния.
- На закрытии каждой свечи контролирует пересечение цены с вычисленными уровнями и закрывает позицию при необходимости.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | 2-часовые свечи | Тип данных, используемый для расчётов. |
| `MovingAverageLength` | 20 | Период SMA-фильтра. |
| `MomentumPeriod` | 5 | Период индикатора Momentum. |
| `StopLossBuyPips` | 50 | Размер стоп-лосса для покупок в пунктах (0 — отключить). |
| `TakeProfitBuyPips` | 50 | Размер тейк-профита для покупок в пунктах (0 — отключить). |
| `StopLossSellPips` | 50 | Размер стоп-лосса для продаж в пунктах (0 — отключить). |
| `TakeProfitSellPips` | 50 | Размер тейк-профита для продаж в пунктах (0 — отключить). |

Все числовые параметры реализованы через `StrategyParam<T>` и при необходимости помечены как оптимизируемые, что позволяет легко запускать тесты и подбор параметров в StockSharp.

## Особенности реализации
- Используется высокоуровневый вызов `SubscribeCandles().Bind(...)`, который одновременно предоставляет свечи и значения SMA/Momentum без ручного копирования буферов.
- Пороговые значения Momentum полностью совпадают с оригинальной версией; при выходе цены за преобразованные уровни стоп-лосса или тейк-профита позиция закрывается рыночным ордером.
- Для оценки импульса хранится только предыдущее значение закрытия, что избавляет от дорогостоящих выборок по историям и соответствует правилам производительности проекта.
- При наличии графического окружения доступны функции `DrawCandles`, `DrawIndicator`, `DrawOwnTrades` для визуального контроля сигналов и сделок.

## Рекомендации по применению
- Стандартные настройки соответствуют исходной стратегии. При работе с другими инструментами скорректируйте `CandleType` и периоды индикаторов.
- Для инструментов с нестандартным шагом цены убедитесь, что пересчитанный размер пункта соответствует ожиданиям перед установкой стоп-уровней.
- Стратегия рассчитана на единственную открытую позицию. Ручные сделки или параллельные алгоритмы по тому же инструменту могут нарушить логику выхода.
