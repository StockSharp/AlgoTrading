# Стратегия подтверждения синхронных графиков
[English](README.md) | [中文](README_cn.md)

Стратегия повторяет идею оригинального советника MQL «SyncCharts»: она анализирует две потоки свечей по одному и тому же
инструменту и совершает сделки только тогда, когда оба потока подтверждают одинаковое направление тренда. Главный поток
представляет привычный график трейдера, а ведомый поток — вспомогательный график (например, более быстрый таймфрейм или
альтернативная агрегация). Требование согласованности сигналов снижает количество ложных входов и автоматически ограничивает
работу на хаотичных участках, когда таймфреймы расходятся или свечи формируются не одновременно.

Наибольший эффект достигается на инструментах с выраженной многофреймовой структурой тренда, таких как фьючерсы на индексы и
ликвидные валютные пары. Стратегия подходит для алгоритмического подтверждения ручных сигналов: если графики «разошлись» по
времени или направлению, позиция закрывается.

## Подробности

- **Условия входа**:
  - **Покупка**: скользящие средние (SMA) главного и ведомого потоков растут на последней закрытой свече, а разница во времени
    между свечами меньше допустимого окна синхронизации.
  - **Продажа**: обе SMA снижаются, а разница во времени также укладывается в порог.
- **Условия выхода**:
  - Десинхронизация: если последняя свеча одного потока ушла дальше допустимого порога, позиция немедленно закрывается.
  - Расхождение трендов: когда одна SMA растет, а другая падает, открытая позиция закрывается.
- **Стопы**: отдельные стоп-заявки не выставляются, роль мягкого стопа выполняет логика принудительного закрытия.
- **Направление**: работа как в лонг, так и в шорт.
- **Значения по умолчанию**:
  - Главный график: таймфрейм 5 минут.
  - Ведомый график: таймфрейм 1 минута.
  - Длина SMA: 20 периодов для обоих потоков.
  - Допуск синхронизации: 15 секунд между временем открытия свечей.
- **Фильтры**:
  - Категория: подтверждение тренда / многофреймовый анализ.
  - Направление: двустороннее.
  - Индикаторы: две SMA.
  - Стопы: нет жестких стопов, только авто-закрытие при расхождениях.
  - Сложность: средняя (две подписки с проверкой синхронизации).
  - Таймфрейм: гибкий (по умолчанию внутри дня).
  - Сезонность: отсутствует.
  - Нейросети: нет.
  - Дивергенция: используется как фильтр (требуется согласие, а не расхождение).
  - Риск: умеренный благодаря двойному подтверждению.

## Логика работы

1. Через высокоуровневый API StockSharp создаются две подписки на свечи: для главного и ведомого графиков.
2. Каждый поток проходит через SMA одинаковой длины, что позволяет определить направление (`up`, если значение SMA выросло,
   `down` — если снизилось).
3. После завершения свечей проверяется их временной сдвиг: модуль разницы должен быть меньше заданного допуска.
4. Если графики синхронны и оба тренда направлены вверх — стратегия покупает (предварительно закрыв шорт). Если оба тренда вниз
   — продаёт (предварительно закрыв лонг).
5. При потере синхронизации или разнонаправленных трендах позиция закрывается, чтобы состояние счёта соответствовало видимым
   графикам.

## Рекомендации по использованию

- Выбирайте два таймфрейма одного инструмента, которые обычно согласованы (например, 5 и 1 минуту, час и 15 минут).
- Увеличивайте допуск синхронизации, если используете источники данных с задержками формирования свечей.
- Для реальной торговли комбинируйте стратегию с отдельным модулем управления рисками или внешними стопами.
