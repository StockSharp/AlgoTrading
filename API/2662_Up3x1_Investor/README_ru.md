# Стратегия Up3x1 Investor
[English](README.md) | [中文](README_cn.md)

Перенос советника Up3x1 Investor из MetaTrader. Стратегия отслеживает последний закрытый бар на выбранном таймфрейме и при достаточной ширине диапазона и тела свечи открывает позицию в направлении закрытия на следующей свече.

По умолчанию стратегия рассчитана на часовики по основным валютным парам, но пороги можно адаптировать под любой инструмент. Одновременно поддерживается только одна позиция, объем сделки задаётся свойством `Volume` стратегии.

## Логика работы

- **Источник сигналов** – свечи типа `CandleType` (по умолчанию H1).
- **Условия входа**
  - Рассчитывается диапазон High–Low и модуль тела предыдущей свечи.
  - Длинная позиция открывается, если свеча закрылась выше открытия и оба значения превышают порог в пунктах.
  - Короткая позиция открывается, если свеча закрылась ниже открытия и оба значения превышают порог.
  - Пока позиция открыта, новые входы игнорируются.
- **Сопровождение позиции**
  - Стоп-лосс и тейк-профит задаются в пунктах, переводятся в цену через `Security.PriceStep`. Нулевое значение отключает уровень.
  - Трейлинг-стоп активируется, когда цена проходит расстояние `TrailingStopPips + TrailingStepPips` от входа.
  - Трейлинг сдвигается только если новый уровень ближе к цене минимум на `TrailingStepPips`.
  - Выход из позиции происходит при достижении стоп-лосса, тейк-профита или трейлинг-стопа.

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Тип свечей для сигналов (по умолчанию 1 час). |
| `RangeThresholdPips` | Минимальный диапазон High–Low предыдущей свечи в пунктах. |
| `BodyThresholdPips` | Минимальный размер тела предыдущей свечи в пунктах. |
| `StopLossPips` | Стоп-лосс в пунктах, 0 отключает уровень. |
| `TakeProfitPips` | Тейк-профит в пунктах, 0 отключает уровень. |
| `TrailingStopPips` | Расстояние трейлинг-стопа от цены, 0 отключает трейлинг. |
| `TrailingStepPips` | Дополнительное движение цены для сдвига трейлинг-стопа. |

> **Важно:** Пункты пересчитываются через `Security.PriceStep`. Убедитесь, что у инструмента корректно задан шаг цены.

## Рекомендации по использованию

1. Перед запуском назначьте нужный `Security` и подключение к торговому шлюзу.
2. Настройте пороги в пунктах под волатильность вашего рынка (для 5-значных котировок форекса 10 пунктов = 0.0010).
3. Задайте `Volume` стратегии для управления размером позиции. Алгоритм управления риском исходного советника намеренно упрощён.
4. Сигналы формируются на закрытии свечи, заявки отправляются сразу после подтверждения импульсной свечи.
