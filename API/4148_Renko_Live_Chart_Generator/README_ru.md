# Стратегия Renko Live Chart Generator
[English](README.md) | [中文](README_cn.md)

## Обзор
`RenkoLiveChartGeneratorStrategy` — перенос советника MetaTrader 4 **RenkoLiveChart_v3_2.mq4** на платформу StockSharp. Оригинальный
скрипт создавал офлайн-график Renko, записывая синтетические свечи в файл `.hst`. В StockSharp та же логика реализована в виде
стратегии: она подписывается на выбранный поток свечей, повторяет алгоритм построения кирпичей из версии MQL и фиксирует каждую
готовую Renko-свечу в журнале. Стратегия не выставляет заявки — её задача состоит в формировании актуального Renko-представления,
которое можно использовать для визуализации или дальнейшего анализа.

## Соответствие параметров MQL
- **RenkoBoxSize** → `BrickSizeSteps`: высота кирпича в ценовых шагах инструмента. Значение умножается на `Security.PriceStep`,
  чтобы получить абсолютный размер в единицах цены.
- **RenkoBoxOffset** → `BrickOffsetSteps`: сдвиг первой Renko-свечи на указанное число шагов. Как и в MQL-скрипте, модуль сдвига
  не может быть больше размера кирпича.
- **RenkoTimeFrame** → `CandleType`: вместо числовых таймфреймов используется тип `DataType`. По умолчанию подключается поток
  минутных свечей, но можно выбрать любую доступную серию (время, тики, диапазон и т. д.).
- **ShowWicks** → `UseWicks`: добавляет тени, если цена выходила за пределы тела кирпича до его закрытия.
- **EmulateOnLineChart** → `EmulateLineChart`: включает непрерывное логирование текущего кирпича, имитируя обновление офлайн-графика
  в MetaTrader.
- **StrangeSymbolName** → `UseShortSymbolName`: укорачивает обозначение инструмента до первых шести символов при выводе в журнал —
  это прямой аналог оригинальной опции.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `BrickSizeSteps` | `int` | `10` | Высота кирпича Renko в шагах цены. Преобразуется в абсолютную величину умножением на `PriceStep`. |
| `BrickOffsetSteps` | `int` | `0` | Сдвиг первого кирпича в шагах цены. Позволяет совместить сетку с пользовательскими уровнями. |
| `UseWicks` | `bool` | `true` | При значении `true` в журнал попадают хвосты свечей, отражающие экстремумы до закрытия кирпича. |
| `EmulateLineChart` | `bool` | `true` | Ведёт подробный лог активного кирпича после каждого обновления цены, как на линейном графике MT4. |
| `UseShortSymbolName` | `bool` | `false` | Обрезает название инструмента до шести символов в префиксе журнала. |
| `CandleType` | `DataType` | `TimeFrame(1m)` | Поток свечей, используемый для инициализации Renko-истории. Стратегия обрабатывает их High/Low/Close. |

## Последовательность работы
1. `OnStarted` проверяет корректность размера и сдвига кирпича, подготавливает текстовый префикс и оформляет подписки на выбранные
   свечи и на поток сделок.
2. `ProcessCandle` повторяет исторический цикл из MQL-версии: каждая завершённая свеча обновляет рабочий кирпич, при необходимости
   создаются сразу несколько Renko-блоков подряд.
3. `ProcessTrade` обрабатывает тики между закрытиями свечей, накапливает экстремумы для теней, считает условный объём и мгновенно
   формирует новые кирпичи при пробое следующего уровня.
4. `EmitBrick` пишет в журнал направление кирпича, значения OHLC, накопленный объём и монотонное время. Если `EmulateLineChart = true`,
   метод `UpdateActiveBrick` дополнительно выводит промежуточные обновления текущего кирпича.

## Практические рекомендации
- Подключайте стратегию к любому инструменту StockSharp и выбирайте тот тип свечей, который должен формировать Renko (по времени,
  тикам, объёму и т. д.).
- Включите `UseWicks`, если нужно повторить «режим с тенями» из оригинального советника. Отключите параметр для классических
  прямоугольных кирпичей.
- Соблюдайте условие |`BrickOffsetSteps`| < `BrickSizeSteps`. Нарушение приводит к остановке стратегии, как и в исходной реализации.
- Активный режим `EmulateLineChart` позволяет запускать стратегию параллельно с торговыми алгоритмами и получать согласованное Renko-
  представление в журнале Designer или Shell.

## Отличия от версии MQL
- Исключена работа с файлами: вместо записи `.hst` стратегия публикует поток Renko в логах StockSharp, что удобно для Designer,
  Shell и других интерфейсов.
- Используются десятичные вычисления и подписки StockSharp вместо глобальных массивов и таймеров MetaTrader.
- Для сохранения строгой хронологии время новых кирпичей при необходимости увеличивается на 1 миллисекунду (`TimeSpan.FromMilliseconds(1)`).
- Стратегия не торгует. Она служит генератором данных Renko, который можно объединить с внешними анализаторами или ручным контролем.
