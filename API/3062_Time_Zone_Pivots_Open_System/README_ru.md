# Стратегия Time Zone Pivots Open System

Стратегия представляет собой перенос на StockSharp (высокоуровневый API) эксперта MetaTrader `Exp_TimeZonePivotsOpenSystem`. Как и оригинал, она строит симметричный ценовой канал вокруг цены открытия свечи в заданный час и реагирует на закрытие свечей выше или ниже границ канала. Все сделки исполняются рыночными ордерами, а защитные стопы и тейк-профиты подключаются через `StartProtection`.

## Принцип работы

1. Подписывается на выбранный таймфрейм свечей, считывает минимальный шаг цены инструмента и при ненулевых дистанциях настраивает защитные стопы.
2. Для каждого торгового дня отслеживает первую свечу, чьё время открытия совпадает со значением `StartHour`. Её цена открытия становится опорной, а верхняя и нижняя границы устанавливаются на расстоянии `OffsetPoints` шагов цены вверх и вниз.
3. Для каждой завершённой свечи рассчитывается пятисостоятый сигнал, полностью повторяющий цветовой буфер оригинального индикатора:
   - `0` / `1`: закрытие выше верхней границы (бычий пробой, индекс зависит от направления свечи).
   - `2`: закрытие внутри канала (нейтральный режим).
   - `3` / `4`: закрытие ниже нижней границы (медвежий пробой).
4. Ведётся скользящая история сигналов. Свеча на расстоянии `SignalBar` используется как подтверждающая, а свеча перед ней должна быть нейтральной, что воспроизводит паузу в одну свечу после пробоя из MQL версии.
5. При подтверждённом бычьем сигнале стратегия по желанию закрывает короткие позиции и, если разрешено и позиция нулевая, открывает длинную. Для медвежьих сигналов логика зеркальна.
6. После открытия новой позиции стратегия запрещает повторные входы в ту же сторону до начала следующей свечи после подтверждающего бара, что предотвращает дублирование сделок.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `CandleType` | Таймфрейм свечей, используемый для расчёта пробоев. | `H1` |
| `OrderVolume` | Объём новой позиции. | `0.1` |
| `StartHour` | Час (0-23), чья свеча формирует опорную цену. | `0` |
| `OffsetPoints` | Полуширина канала в шагах цены. | `100` |
| `SignalBar` | Количество закрытых свечей между текущей и подтверждающей. В данной реализации должно быть ≥ 1. | `1` |
| `StopLossPoints` | Дистанция стоп-лосса в шагах цены. | `1000` |
| `TakeProfitPoints` | Дистанция тейк-профита в шагах цены. | `2000` |
| `EnableLongEntry` | Разрешить открытие длинных позиций по бычьим сигналам. | `true` |
| `EnableShortEntry` | Разрешить открытие коротких позиций по медвежьим сигналам. | `true` |
| `CloseLongOnBearishBreak` | Закрывать длинные позиции при медвежьем подтверждении. | `true` |
| `CloseShortOnBullishBreak` | Закрывать короткие позиции при бычьем подтверждении. | `true` |

## Дополнительно

- Блок money-management из MetaTrader заменён на явный параметр `OrderVolume`, что типично для стратегий StockSharp.
- Стопы и тейк-профиты пересчитываются из пунктов в абсолютные значения на основе текущего шага цены инструмента.
- Как и в MQL версии, стратегия работает с одной чистой позицией и не открывает новые сделки, пока прежняя позиция не закрыта.
