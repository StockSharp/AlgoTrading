# 时区枢轴开盘系统策略

该策略基于 MetaTrader 智能交易系统 `Exp_TimeZonePivotsOpenSystem`，使用 StockSharp 的高级 API 重新实现。策略会在每天指定小时的开盘价处建立一个对称价格通道，并在收盘蜡烛突破上下轨时做出响应。所有交易均以市价单执行，并通过 `StartProtection` 配置可选的止损与止盈。

## 工作原理

1. 订阅所选蜡烛周期，记录品种的最小报价步长，并在止损/止盈距离大于零时初始化保护模块。
2. 每天检测第一个开盘时间等于 `StartHour` 的蜡烛，其开盘价作为当日枢轴锚点。上下轨分别设置在锚点上下方 `OffsetPoints` 个最小步长的位置。
3. 对每根收盘蜡烛计算五种信号状态，对应原始自定义指标的颜色缓冲区：
   - `0` / `1`：蜡烛收于上轨之上（多头突破，索引区分阳线与阴线）。
   - `2`：蜡烛收在通道内部（中性）。
   - `3` / `4`：蜡烛收于下轨之下（空头突破）。
4. 维护一个滚动信号历史。向前数 `SignalBar` 根的蜡烛作为确认棒，且其前一根必须为中性，才能触发开仓，与原策略在突破后等待一根蜡烛的逻辑一致。
5. 当出现多头确认时，策略可选地平掉空头仓位，并在允许且当前为空仓时开立新的多头；空头方向同理。
6. 新仓位建立后，会把同方向的下一次入场推迟到确认棒之后的下一根蜡烛开始，以避免同一信号重复下单。

## 参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `CandleType` | 驱动突破判断的蜡烛周期。 | `H1` |
| `OrderVolume` | 每次开仓使用的手数。 | `0.1` |
| `StartHour` | 用于确定枢轴锚点的小时（0-23）。 | `0` |
| `OffsetPoints` | 通道半宽度，按最小报价步长计。 | `100` |
| `SignalBar` | 当前蜡烛与突破确认蜡烛之间的间隔（收盘蜡烛数）。在本移植版本中必须 ≥ 1。 | `1` |
| `StopLossPoints` | 止损距离，单位为最小步长。 | `1000` |
| `TakeProfitPoints` | 止盈距离，单位为最小步长。 | `2000` |
| `EnableLongEntry` | 允许在多头信号出现后开多。 | `true` |
| `EnableShortEntry` | 允许在空头信号出现后开空。 | `true` |
| `CloseLongOnBearishBreak` | 在空头确认时平掉现有多头。 | `true` |
| `CloseShortOnBullishBreak` | 在多头确认时平掉现有空头。 | `true` |

## 说明

- 原始版本的资金管理模块被替换为更符合 StockSharp 风格的显式 `OrderVolume` 参数。
- 止损与止盈参数会根据当前品种的价格步长转换为绝对价格距离。
- 与 MQL 原版一样，该实现始终保持单一净头寸；若已有持仓，将跳过新的相反方向入场。
