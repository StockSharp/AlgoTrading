# MarsiEaStrategy

## Общее описание

`MarsiEaStrategy` переносит советник MARSIEA из MetaTrader в высокоуровневый API StockSharp. Стратегия объединяет простую скользящую среднюю (SMA) и осциллятор RSI, поддерживая только одну позицию одновременно. Стоп-лосс и тейк-профит задаются в пунктах, как и в оригинале, а объем рассчитывается динамически на основе капитала портфеля и заданного процента риска.

## Логика торговли

1. **Подготовка данных**
   - На выбранной серии свечей рассчитывается SMA с настраиваемым периодом.
   - На тех же свечах рассчитывается RSI с настраиваемым периодом.
   - Тип свечей задается параметром `CandleType`, по умолчанию используются минутные бары.

2. **Условия входа**
   - Сигналы анализируются только тогда, когда оба индикатора сформированы и открытых позиций нет.
   - **Покупка:** цена закрытия выше SMA, а RSI ниже порога перепроданности.
   - **Продажа:** цена закрытия ниже SMA, а RSI выше порога перекупленности.
   - Пока позиция открыта, новые сделки не инициируются, что полностью повторяет поведение оригинального советника.

3. **Условия выхода**
   - Сразу после входа выставляются стоп-лосс и тейк-профит на фиксированном расстоянии в пунктах.
   - Дополнительных условий выхода нет — позиция закрывается защитными ордерами.

## Управление рисками и объемом

- `RiskPercent` задает долю текущей стоимости портфеля, которая может быть потеряна в одной сделке.
- Стоимость пункта рассчитывается по `Security.PriceStep`, `Security.StepPrice` и количеству знаков после запятой, что повторяет проверку `_Digits` в MQL.
- Объем округляется к ближайшему допустимому шагу `Security.VolumeStep` и учитывает минимальный объем `Security.VolumeMin`, если он задан.
- Если расчет по риску невозможен (нет данных по инструменту или нулевой стоп), стратегия использует значение свойства `Volume` (по умолчанию 1 контракт/лот).

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Серия свечей для расчета индикаторов. |
| `MaPeriod` | Период SMA. |
| `RsiPeriod` | Период RSI. |
| `RsiOverbought` | Порог RSI для определения перекупленности (сигнал на продажу). |
| `RsiOversold` | Порог RSI для определения перепроданности (сигнал на покупку). |
| `RiskPercent` | Процент капитала под риск в одной сделке. |
| `StopLossPips` | Расстояние стоп-лосса в пунктах. |
| `TakeProfitPips` | Расстояние тейк-профита в пунктах. |

## Особенности конверсии

- В MetaTrader сделки открывались по Bid/Ask; в портированном варианте используется цена закрытия свечи, так как тиковые данные в высокоуровневом API недоступны.
- Расчет размера пункта полностью повторяет исходный алгоритм: для инструментов с 5 или 3 знаками пункт равен десятикратному шагу цены.
- Вызов `StartProtection()` обеспечивает автоматическую привязку стоп-ордеров к позиции со стороны движка.
- Логика «не открывать новую позицию при наличии старой» сохранена без изменений.
