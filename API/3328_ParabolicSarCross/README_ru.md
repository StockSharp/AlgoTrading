# Стратегия Parabolic SAR Cross
[English](README.md) | [中文](README_cn.md)

Стратегия представляет собой перенос экспертного советника MetaTrader «PSAR Trader EA» на платформу StockSharp. Алгоритм отслеживает взаимодействие цены со значениями индикатора Parabolic SAR и реагирует только в момент смены положения точек относительно тела свечи. В переносе сохранена оригинальная логика управления капиталом: можно торговать фиксированным объёмом или автоматически пересчитывать лот в зависимости от баланса, используются фиксированные уровни стоп-лосса и тейк-профита, а также подключается трейлинг-стоп после накопления заданной прибыли.

## Логика входа и выхода
- Строится Parabolic SAR с пользовательскими параметрами ускорения и максимального ускорения на выбранном таймфрейме (по умолчанию 30-минутные свечи).
- **Бычий разворот** фиксируется, когда точки SAR переходят из области над свечой под свечу. Если позиция отсутствует — открывается покупка. Если есть короткая позиция — сначала закрываем шорт и ждём следующего сигнала для входа в лонг.
- **Медвежий разворот** фиксируется при переходе точек SAR из-под свечи наверх. При отсутствии позиции открывается шорт. Если есть лонг — позиция закрывается, а вход выполняется только после следующего сигнала.
- На каждой закрытой свече контролируются открытые сделки: если текущий максимум или минимум достигает защитных уровней (стоп, тейк или трейлинг), позиция закрывается полностью.

## Управление рисками
- **Стоп-лосс** задаётся в пунктах (ценовых шагах). Для покупок стоп устанавливается ниже цены входа, для продаж — выше.
- **Тейк-профит** также задаётся в пунктах. Уровень зеркально отражает стоп-лосс в противоположную сторону и закрывает позицию при достижении.
- **Трейлинг-стоп** активируется после прохождения ценой заданного расстояния в прибыль. Стоп подтягивается только в сторону прибыли, что воспроизводит режим «только ужесточать стопы» из оригинального советника.

## Управление объёмом
- **Фиксированный лот** — при отключенном авто-лоте заявки отправляются с заданным объёмом.
- **Автолотовый режим** — при включении параметра объём рассчитывается как `(Баланс / 1000) * LotsPerThousand`, затем приводится к шагу объёма и минимальному лоту инструмента.

## Параметры и значения по умолчанию
- `SarStep` — шаг ускорения Parabolic SAR. По умолчанию `0.02`.
- `SarMaximum` — максимальное ускорение Parabolic SAR. По умолчанию `0.2`.
- `CandleType` — таймфрейм анализа. По умолчанию 30-минутные свечи.
- `UseAutoLot` — включение авто-расчёта объёма. По умолчанию `false`.
- `FixedLot` — объём заявки при отключённом авто-лоте. По умолчанию `0.1`.
- `LotsPerThousand` — множитель для расчёта авто-лота. По умолчанию `0.05`.
- `StopLossPoints` — расстояние до стоп-лосса в пунктах. По умолчанию `500`.
- `TakeProfitPoints` — расстояние до тейк-профита в пунктах. По умолчанию `1000`.
- `TrailingStartPoints` — порог прибыли для запуска трейлинг-стопа. По умолчанию `500`.
- `TrailingDistancePoints` — расстояние трейлинга после активации. По умолчанию `100`.

## Дополнительные замечания
- Стратегия работает как в лонг, так и в шорт, но удерживает не более одной позиции одновременно.
- Защитные уровни контролируются по закрытым свечам. На реальном рынке внутрисвечные всплески меньше выбранного таймфрейма могут влиять на точность исполнения.
