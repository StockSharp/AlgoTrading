# EES Hedger (advanced)

## Overview

The strategy mirrors the behaviour of the classic MetaTrader "EES Hedger" expert advisor. Whenever an external trader, discretionary operator, or another automated system opens a position on the same account, the strategy immediately creates an opposite hedge using a configurable volume. It then manages the hedge with stop-loss, take-profit, break-even, and trailing-stop rules so that exposure is neutralised while profits on the hedge are protected.

Unlike traditional signal-driven strategies, this module assumes that entries are produced elsewhere. Its sole responsibility is to observe account trades, react to matching tickets, and protect the hedge position until it is closed either by the protective orders or manually.

## Trading logic

1. **Detection of external trades** – the connector stream of account trades is monitored. Trades whose comment matches `OriginalOrderComment` (or all trades when the field is empty) are treated as the source that must be hedged. Trades produced by the strategy itself are filtered by storing their transaction identifiers.
2. **Mirroring orders** – once a qualifying trade is received, the strategy submits an immediate market order in the opposite direction with volume `HedgeVolume`. An optional `HedgerOrderComment` helps back-office tools separate the hedge orders from other activity.
3. **Risk management** – after the hedge is filled the strategy places stop-loss and take-profit orders at distances defined by the pip parameters. When break-even conditions are met, the stop is moved to the entry price plus one pip. If trailing is enabled, the stop is further advanced as the market continues to move in favour of the hedge.
4. **State cleanup** – when the position reaches zero (for example, after a manual close) all protective orders are cancelled and internal flags are reset so that the next external trade can be hedged from scratch.

## Parameters

| Parameter | Description |
|-----------|-------------|
| `HedgeVolume` | Volume used to open the opposite hedge position. |
| `StopLossPips` | Distance from the entry price to the protective stop-loss order. |
| `TakeProfitPips` | Distance from the entry price to the take-profit order. |
| `TrailingStopPips` | Distance maintained by the trailing stop once the activation threshold is exceeded. Set to zero to disable trailing. |
| `TrailingActivationPips` | Minimum profit (in pips) required before the trailing stop begins to move. |
| `BreakEvenPips` | Profit threshold (in pips) after which the stop-loss is moved to the entry price plus one pip. |
| `OriginalOrderComment` | Optional comment filter that selects which external trades should be hedged. Leave empty to hedge all trades on the instrument. |
| `HedgerOrderComment` | Comment attached to hedge orders and protective stops generated by the strategy. |

## Practical notes

- Assign the same portfolio/account to the strategy as the external trader. All positions created on that account will be visible to the connector and can therefore be hedged.
- When used with MetaTrader bridges, configure the expert adviser or bridge to copy the original order comment so that filtering works as expected.
- The pip size is derived from the instrument price step. For five-digit FX symbols the distance automatically translates the specified pip values into correct price offsets.
- Break-even and trailing logic never move the stop further away from the entry price. Only improvements are applied, ensuring that once break-even is reached the stop never goes back to a loss-making level.
- The strategy does not manage the original position. Closing or modifying it remains the responsibility of the primary trading system.

## Usage workflow

1. Configure the strategy parameters, paying special attention to the comment filters and the volume of the hedge.
2. Start the strategy and confirm that it is connected to the broker feed. It will remain idle until an external trade arrives.
3. As soon as a qualifying trade appears, observe how the hedge order is created and how protective orders are placed in the DOM.
4. Monitor the break-even and trailing behaviour to ensure that the configured pip distances match the broker's contract specifications.
5. Stop the strategy when hedging is no longer required. All working protective orders are cancelled during shutdown.

## Limitations

- The module assumes access to the account's trade stream. It cannot hedge trades that are completely invisible to the connector.
- Volume rounding rules are broker-specific. Ensure that the configured `HedgeVolume` is compatible with the instrument's lot step.
- Because the strategy places market orders immediately, slippage in fast markets may result in imperfect hedges. Increase stop-loss distances to account for this when necessary.
