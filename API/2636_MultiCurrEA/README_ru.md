# Стратегия MultiCurrEA

## Обзор

MultiCurrEA — это портированная с MetaTrader5 многоинструментальная стратегия пробоя. Она одновременно отслеживает до трёх
валютных пар и реагирует на касание полос Боллинджера, рассчитанных по максимумам и минимумам свечей. Счётчик сделок позволяет
масштабировать объём, перераспределяя заданный процент капитала на каждую новую позицию.

## Логика торговли

- **Индикаторы**
  - Для каждого инструмента рассчитываются две полосы Боллинджера: одна по максимумам, вторая по минимумам.
  - Параметр `Bollinger Shift` смещает значения индикатора и полностью повторяет оригинальный алгоритм.
- **Входы**
  - Покупка выполняется, когда текущая цена Ask опускается ниже нижней полосы, построенной по минимумам.
  - Продажа выполняется, когда текущая цена Bid поднимается выше верхней полосы, построенной по максимумам.
  - На одной свече разрешена только одна сделка — используется блокировка по времени бара.
- **Выходы**
  - Длинные позиции закрываются, когда Bid касается нижней полосы, рассчитанной по максимумам.
  - Короткие позиции закрываются, когда Ask достигает верхней полосы, рассчитанной по минимумам.
  - Если оба условия выполняются одновременно, торговля приостанавливается и счётчик сделок сбрасывается.
- **Управление объёмом**
  - Объём первой сделки рассчитывается как `Deal % of Equity` процентов от стоимости портфеля, делённой на текущую цену.
  - Каждая последующая сделка умножает базовый объём на `Lot Increase * (dealNumber - 1)`.

Для расчёта используется стаканная котировка Bid/Ask (Level1). При отсутствии котировок стратегия подставляет цену закрытия
последней свечи.

## Параметры

### Общие параметры риска
- `Deal % of Equity` — доля капитала на первую сделку.
- `Lot Increase` — множитель для последующих сделок.

### Параметры каждого инструмента
- `Security` — торговый инструмент.
- `Enabled` — включение торговли по выбранному инструменту.
- `Timeframe` — тип свечей для расчёта индикаторов.
- `Bollinger Period` — длина скользящей средней в полосах Боллинджера.
- `Bollinger Shift` — сдвиг значений индикатора (0 — текущая свеча).
- `Bollinger Deviation` — коэффициент стандартного отклонения.

## Управление позициями

- Обрабатываются только завершённые свечи.
- Позиции закрываются рыночными ордерами противоположного направления.
- Ордера отправляются через `RegisterOrder`, что гарантирует привязку к нужному инструменту.
- Объём автоматически приводится к шагу, минимуму и максимуму `StepVolume`, `MinVolume`, `MaxVolume`, если эти значения доступны.

## Рекомендации по использованию

1. Перед запуском стратегии назначьте реальные объекты `Security` для каждого слота (например, перетащите инструменты из панели).
2. Убедитесь, что поставщик даёт Level1 котировки, иначе будет использоваться цена закрытия свечи.
3. При необходимости можно расширить список инструментов, изменив массив `SymbolSlot` или значения по умолчанию в конструкторе.
4. Стратегия может удерживать несколько позиций по одному инструменту — убедитесь, что брокер допускает соответствующую маржу.
