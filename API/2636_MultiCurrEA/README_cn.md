# MultiCurrEA 策略

## 概述

MultiCurrEA 是从 MetaTrader5 EA 移植而来的多货币突破策略。策略最多同时监控三只外汇品种，当价格触及基于
最高价和最低价计算的布林带时入场。通过交易计数器，仓位会按设定的权益百分比进行逐笔放大。

## 交易逻辑

- **指标**
  - 每个品种都会创建两条布林带：一条使用最高价、一条使用最低价。
  - `Bollinger Shift` 参数允许像原始 EA 一样对指标数值进行横向位移。
- **入场条件**
  - 当当前卖价跌破基于最低价计算的下轨时开多。
  - 当当前买价突破基于最高价计算的上轨时开空。
  - 每根 K 线只允许一次交易，靠柱时间锁来控制。
- **离场条件**
  - 多单在买价触及基于最高价计算的下轨时平仓。
  - 空单在卖价触及基于最低价计算的上轨时平仓。
  - 如果两个条件同时满足，则停止加仓并重置交易计数器。
- **仓位管理**
  - 首笔仓位按照 `Deal % of Equity` 占用账户权益的比例除以当前价格得到。
  - 同一品种后续的加仓按照 `Lot Increase * (dealNumber - 1)` 系数放大。

买卖价来自 Level1 行情，如无报价，则退化为使用最近一根 K 线的收盘价。

## 参数

### 通用风险参数
- `Deal % of Equity` – 首笔交易使用的权益百分比。
- `Lot Increase` – 第二笔及之后每笔交易的放大量。

### 每个品种的参数
- `Security` – 交易标的。
- `Enabled` – 是否启用该品种的交易。
- `Timeframe` – 指标使用的 K 线类型。
- `Bollinger Period` – 布林带移动平均的周期长度。
- `Bollinger Shift` – 指标取值的横向位移（0 表示当前柱）。
- `Bollinger Deviation` – 标准差倍数。

## 仓位处理

- 只处理已完成的 K 线。
- 通过反向市价单平仓。
- 使用 `RegisterOrder` 发送市价单以确保绑定到正确的 `Security`。
- 下单数量会遵循品种的 `StepVolume`、`MinVolume` 与 `MaxVolume` 限制（如可用）。

## 使用提示

1. 在启动前为每个槽位指定实际的 `Security` 对象（例如从终端面板拖入）。默认值仅为占位符。
2. 确保 Level1 行情可用，否则策略会退化为使用收盘价。
3. 如需扩展更多品种，可在构造函数中调整 `SymbolSlot` 数组或默认参数。
4. 策略可能在同一品种持有多笔仓位，请确认经纪商的保证金要求。
