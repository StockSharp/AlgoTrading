# Стратегия уведомлений TenKijun Cross (ID 3562)

## Общее описание

Стратегия представляет собой перенос эксперта MetaTrader **TenKijun.mq4** на высокоуровневый API StockSharp. В оригинале советник лишь отслеживал пересечения линий Tenkan-sen и Kijun-sen индикатора Ишимоку и отправлял уведомления, не совершая сделок. Перенос полностью сохраняет уведомительный характер, дополняя его инфраструктурой StockSharp: параметрами, подпиской на свечи и автоматической визуализацией.

Алгоритм работает на завершённых свечах выбранного таймфрейма. Когда новая свеча закрывается в пределах разрешённого торгового интервала, рассчитывается индикатор Ichimoku с классическими периодами 9/26/52 и фиксируются текущие значения Tenkan/Kijun. Если Tenkan пересекает Kijun снизу вверх — в журнал добавляется запись о бычьем сигнале, при пересечении сверху вниз — запись о медвежьем сигнале. Сделки не открываются: стратегия предназначена для сигнализации или подключения внешней автоматики.

## Индикаторы и поток данных

- **Индикатор** — стандартный `Ichimoku` из StockSharp с независимыми параметрами Tenkan, Kijun и Senkou Span B. Для принятия решений используются только линии Tenkan и Kijun, как в исходном советнике.
- **Подписка** — `SubscribeCandles` с настраиваемым `CandleType`. По умолчанию используется 30-минутный таймфрейм.
- **Связка** — применяется `BindEx`, чтобы получать типизированный `IchimokuValue` без вызовов `GetValue`.
- **График** — при наличии окна графика автоматически отображаются свечи и линия Ichimoku, что упрощает проверку сигналов.

## Фильтр торговой сессии

Как и в MetaTrader, пользователь задаёт временной интервал в часах:

- `StartHour` — начало активного окна (включительно), по умолчанию 0.
- `LastHour` — окончание активного окна (включительно), по умолчанию 20.

Если `StartHour` ≤ `LastHour`, уведомления формируются только внутри этого диапазона. Если `StartHour` > `LastHour`, интервал считается ночным и покрывает конец суток и начало следующего дня (например, 20 → 6).

## Параметры

| Параметр | Описание | Значение по умолчанию | Примечание |
|----------|----------|-----------------------|------------|
| `StartHour` | Старт часа, с которого разрешены уведомления | 0 | Целое число 0-23 |
| `LastHour` | Финальный час разрешённого интервала | 20 | Целое число 0-23 |
| `TenkanPeriod` | Длина расчёта линии Tenkan | 9 | Допускает оптимизацию |
| `KijunPeriod` | Длина расчёта линии Kijun | 26 | Допускает оптимизацию |
| `SenkouSpanBPeriod` | Длина Senkou Span B | 52 | Добавлена для полноты, в логике не участвует |
| `CandleType` | Тип свечей для индикатора | 30-минутные свечи | Можно выбрать любой таймфрейм на основе `TimeSpan` |

## Логика сигналов

1. Дождаться первой завершённой свечи, чтобы инициализировать предыдущие значения Tenkan и Kijun.
2. На каждой последующей завершённой свече внутри торгового окна:
   - Извлечь текущие значения Tenkan и Kijun из `IchimokuValue`.
   - Зафиксировать бычий сигнал, если раньше Tenkan ≤ Kijun, а теперь Tenkan > Kijun.
   - Зафиксировать медвежий сигнал, если раньше Tenkan ≥ Kijun, а теперь Tenkan < Kijun.
   - Записать информационное сообщение в журнал с направлением сигнала, ценой закрытия и отметкой времени.

## Рекомендации по применению

- Подпишитесь на журнал стратегии или расширьте метод `ProcessCandle`, чтобы пересылать уведомления по email, в мессенджеры или проигрывать звук.
- Для автоматической торговли унаследуйте стратегию и добавьте в обработчик размещение заявок (`BuyMarket`, `SellMarket` и т.п.).
- Выберите таймфрейм, соответствующий используемому в MetaTrader графику, чтобы получать те же пересечения.

## Отличия от оригинального советника

- Уведомления пишутся через систему логирования StockSharp вместо `SendNotification` MetaTrader.
- Все параметры снабжены метаданными (`SetDisplay`, диапазоны, признаки оптимизации), что упрощает работу в Designer/Optimizer.
- Свечи и индикатор автоматически выводятся на график StockSharp.

## Файлы

- `CS/TenKijunCrossStrategy.cs` — реализация стратегии на C#.

