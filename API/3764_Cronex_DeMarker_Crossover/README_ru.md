# Стратегия Cronex DeMarker Crossover

## Обзор
Стратегия Cronex DeMarker повторяет индикатор **Cronex DeMarker** из MetaTrader и превращает его в полностью автоматизированную торговую систему. Исходный индикатор строит осциллятор DeMarker и две линейно взвешенные скользящие средние (LWMA). В стратегии воспроизводится та же связка: пересечения сглаженных линий интерпретируются как сигналы на покупку или продажу, что позволяет быстро реагировать на смену импульса между покупателями и продавцами.

## Построение индикаторов
1. **Осциллятор DeMarker** — оценивает отношение текущей свечи к предыдущей:
   - Если текущий максимум выше предыдущего, положительное давление равно разнице максимумов, иначе берётся ноль.
   - Если текущий минимум ниже предыдущего, отрицательное давление равно расстоянию между минимумами, иначе берётся ноль.
   - Суммы положительного и отрицательного давления за `DeMarkerPeriod` свечей формируют значение осциллятора `deMax / (deMax + deMin)`.
2. **Быстрая LWMA** — линейно взвешенная скользящая среднего с периодом `FastMaPeriod` применяется к значениям DeMarker, подчёркивая последние изменения осциллятора.
3. **Медленная LWMA** — ещё одна линейно взвешенная средняя с периодом `SlowMaPeriod` сглаживает тот же поток значений DeMarker и служит подтверждающей линией.

Каждая завершённая свеча передаётся через эту цепочку индикаторов, полностью повторяя вычисления буферов из исходного MQ4-файла.

## Торговая логика
1. Дождаться, пока осциллятор DeMarker и обе LWMA полностью сформируются.
2. После закрытия каждой свечи вычислить новое значение DeMarker и обновить обе скользящие средние.
3. Определить пересечения между быстрой и медленной LWMA:
   - **Бычье пересечение** — быстрая LWMA переходит снизу вверх через медленную. Стратегия закрывает короткую позицию и открывает длинную.
   - **Медвежье пересечение** — быстрая LWMA опускается сверху вниз ниже медленной. Стратегия закрывает длинную позицию и открывает короткую.
4. Заявки не отправляются, если стратегия ещё не сформирована, находится офлайн или торговля запрещена.

При смене сигнала позиция разворачивается немедленно: объём рыночного ордера увеличивается, чтобы закрыть противоположную позицию и открыть новую.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `DeMarkerPeriod` | Количество свечей в расчёте осциллятора DeMarker. | `25` |
| `FastMaPeriod` | Период быстрой линейно взвешенной скользящей средней. | `14` |
| `SlowMaPeriod` | Период медленной линейно взвешенной скользящей средней. | `25` |
| `CandleType` | Тип свечей (таймфрейм или другой `DataType`), с которым работает стратегия. | Таймфрейм 1 час |

## Особенности реализации
- Используется высокоуровневый метод `SubscribeCandles`. Индикаторы обновляются только после закрытия свечи (`Finished`), чтобы исключить перерисовку.
- Применяются встроенные индикаторы StockSharp: `DeMarker` и `WeightedMovingAverage`, что гарантирует соответствие MQ4 версии.
- Автоматически создаётся область графика с ценой, осциллятором и обеими LWMA для визуального контроля сигналов.
- Метод `StartProtection()` вызывается при запуске один раз, соблюдая правила проекта по защите позиций.

## Использование
1. Подключите стратегию к нужному инструменту и задайте желаемый тип свечей (например, часовые).
2. Настройте периоды DeMarker и скользящих средних, чтобы воспроизвести оригинальный индикатор или подготовить параметры для оптимизации.
3. Запустите стратегию. Торговля начнётся после полной формировки индикаторов и разрешения сделок.
4. Отслеживайте график: на нём отображаются свечи, осциллятор и LWMA, по которым генерируются входы.
