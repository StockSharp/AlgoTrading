# Стратегия Daily Target

## Общее описание

`DailyTargetStrategy` — порт советника MetaTrader 4 «Daily Target». Стратегия отслеживает совокупный результат за текущий
календарный день и прекращает торговлю, когда плавающая + реализованная прибыль достигают заданной цели либо уходит ниже
максимально допустимого убытка. После срабатывания одного из порогов все активные заявки снимаются, а позиция закрывается рыночной
заявкой. Торговля возобновится только после наступления следующего дня.

## Логика работы

1. **Запуск**
   - В методе `OnStarted` вызывается `ResetDailySnapshot`, который запоминает дату и базовое значение реализованного PnL.
   - `SubscribeLevel1()` обеспечивает поток котировок Bid/Ask, необходимый для точного расчёта плавающей прибыли.
   - `SubscribeTrades()` сохраняет цену последней сделки, чтобы иметь резервный источник цены при отсутствии котировок.
   - Таймер с периодом одна минута позволяет заметить смену даты даже в периоды без рыночных событий.
2. **Оценка PnL**
   - `EvaluateDailyThresholds` пересчитывает реализованный PnL (текущий `PnL` минус сохранённая база) и добавляет плавающий PnL,
     вычисленный из последних Bid/Ask или цены сделки.
   - При достижении целевой прибыли либо просадке ниже отрицательного порога вызывается `TriggerDailyStop`.
3. **Аварийный выход**
   - `TriggerDailyStop` пишет информационное сообщение в лог, отменяет все отложенные заявки и отправляет рыночный ордер на
     закрытие оставшейся позиции.
   - Флаг `_dailyStopTriggered` блокирует повторный вход в тот же день. После смены даты `ResetDailySnapshot` очищает флаг и
     пересчитывает базовый PnL.

## Параметры

| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `DailyTarget` | `10` | Целевая прибыль в валюте счёта. Достигнув её, стратегия прекращает торговать до конца дня. |
| `DailyMaxLoss` | `0` | Допустимый дневной убыток в валюте счёта. Значение `0` отключает фильтр. При достижении порога стратегия останавливает торговлю до следующего дня. |

## Примечания

- Стратегия управляет только основным инструментом `Security`, что соответствует односимвольной логике оригинального советника.
- Плавающий PnL считается по Bid для длинных и по Ask для коротких позиций. Если котировки отсутствуют, используется последняя
  цена сделки.
- Версия на Python не предоставляется, пакет содержит только C#-реализацию на высокоуровневом API.
