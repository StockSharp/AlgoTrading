# Стратегия Blau TStoch Indicator

## Общее описание
- Перенос советника MetaTrader 5 `Exp_BlauTStochI` на высокоуровневый API StockSharp.
- Работает с тройным стохастическим индикатором Уильяма Блау на настраиваемых таймфреймах.
- Поддерживает два алгоритма торговли: **Breakdown** (пробой нулевой линии) и **Twist** (разворот наклона).
- Логика разрешений полностью повторяет исходный советник: отдельные флаги для открытия и закрытия длинных/коротких позиций.

## Построение индикатора
- Рассчитывается серия импульса как `цена применения - минимум` за `MomentumLength` баров и диапазон `максимум - минимум`.
- К числителю и знаменателю последовательно применяются три сглаживания.
- Доступные методы сглаживания: экспоненциальное (EMA), простое (SMA), сглаженное/скользящее среднее RMA (SMMA) и линейно взвешенное (LWMA).
- Расширенные методы из оригинального файла SmoothAlgorithms.mqh (JJMA, JurX, ParMA, T3, VIDYA, AMA) не реализованы; параметр `Phase` сохранён для совместимости, но не используется.
- Выбор цены соответствует MQL-константам: закрытие, открытие, максимум, минимум, медиана, типичная, взвешенная, простая, квартильная, два варианта trend-follow и DeMark.
- Итоговое значение индикатора: `100 * сглаженный импульс / сглаженный диапазон - 50`.

## Торговые правила
### Режим Breakdown
- Сигнал берётся с бара, заданного `SignalBar` (по умолчанию 1 — последний закрывшийся бар).
- **Покупка:** предыдущее значение (`SignalBar+1`) выше нуля и текущее (`SignalBar`) пересекает ноль сверху вниз.
- **Продажа:** предыдущее значение ниже нуля и текущее пересекает ноль снизу вверх.
- **Закрытие лонга:** предыдущее значение ниже нуля при разрешённых выходах из длинных позиций.
- **Закрытие шорта:** предыдущее значение выше нуля при разрешённых выходах из коротких позиций.

### Режим Twist
- **Покупка:** индикатор растёт (`value[SignalBar+1] < value[SignalBar+2]`), а последнее значение не ниже предыдущего.
- **Продажа:** индикатор падает (`value[SignalBar+1] > value[SignalBar+2]`), а последнее значение не выше предыдущего.
- **Закрытие лонга:** наклон меняется вниз (`value[SignalBar+1] > value[SignalBar+2]`).
- **Закрытие шорта:** наклон меняется вверх (`value[SignalBar+1] < value[SignalBar+2]`).

### Управление позицией
- При открытии позиции рассчитывается объём как `Volume` плюс величина противоположной позиции для разворота.
- Выходы закрывают весь текущий объём рыночными ордерами.
- Сигналы обрабатываются только на закрытых свечах после полного формирования индикатора.

## Управление рисками
- Необязательные стоп-лосс и тейк-профит в шагах цены (`StopLossPoints`, `TakeProfitPoints`).
- Реализованы через `StartProtection`; установка значения 0 отключает соответствующий уровень.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `CandleType` | Тип/таймфрейм свечей для расчёта. | 4-часовые свечи |
| `Smoothing` | Метод сглаживания (EMA/SMA/SMMA/LWMA). | EMA |
| `MomentumLength` | Глубина поиска максимумов/минимумов. | 20 |
| `FirstSmoothing` | Длина первого сглаживания. | 5 |
| `SecondSmoothing` | Длина второго сглаживания. | 8 |
| `ThirdSmoothing` | Длина третьего сглаживания. | 3 |
| `Phase` | Параметр совместимости (не используется). | 15 |
| `PriceType` | Тип применяемой цены. | Close |
| `SignalBar` | Бар для анализа сигнала (>= 1). | 1 |
| `Mode` | Режим торговли (Breakdown/Twist). | Twist |
| `AllowLongEntries` | Разрешить открытия лонгов. | true |
| `AllowShortEntries` | Разрешить открытия шортов. | true |
| `AllowLongExits` | Разрешить закрытие лонгов. | true |
| `AllowShortExits` | Разрешить закрытие шортов. | true |
| `TakeProfitPoints` | Дистанция тейк-профита в шагах (0 отключает). | 2000 |
| `StopLossPoints` | Дистанция стоп-лосса в шагах (0 отключает). | 1000 |

## Отличия от оригинального MT5-советника
- Реализованы только базовые методы сглаживания; экзотические варианты SmoothAlgorithms не поддерживаются.
- Управление размером позиции упрощено: используется параметр `Volume` стратегии.
- Сигналы исполняются исключительно по закрытым свечам, без внутрибара.

## Рекомендации по использованию
- Держите `SignalBar` не ниже 1 — история индикатора поддерживается автоматически.
- Увеличение длин сглаживаний повышает время формирования, так как каждая стадия требует полный объём данных.
- Для разворотной торговли на старших таймфреймах разумно расширить стоп/тейк или отключить одну из сторон через разрешения.

