# Стратегия Coin Flip

## Общее описание

Стратегия Coin Flip повторяет идею оригинального советника MetaTrader: каждая завершённая свеча запускает "подбрасывание монеты", которое случайным образом выбирает длинное или короткое направление. В рынке может находиться только одна позиция. Новая сделка открывается рыночным ордером с рассчитанным объёмом, одновременно задаются уровни стоп-лосса и тейк-профита. Дополнительный трейлинг-стоп позволяет постепенно подтягивать защитный уровень при движении цены в прибыльную сторону.

Встроена схема мани-менеджмента по типу мартингейла. Если предыдущая позиция закрылась по стоп-лоссу, объём следующей сделки умножается на заданный коэффициент. Профитные выходы возвращают объём к базовому значению. Максимально допустимый объём защищает от неконтролируемого роста позиций.

## Правила торговли

1. На каждой завершённой свече оценивается текущая позиция.
2. При отсутствии позиции псевдослучайное число с равной вероятностью выбирает покупку или продажу (если стороны разрешены).
3. Базовый объём используется для первой сделки цикла. После стоп-лосса объём умножается на коэффициент мартингейла, но не превышает установленный предел.
4. Для каждой позиции сразу рассчитываются уровни стоп-лосса и тейк-профита. Достижение одного из уровней приводит к закрытию позиции рыночным ордером.
5. При активном трейлинг-стопе, когда прибыль превышает сумму расстояния трейлинга и шага, защитный стоп подтягивается вслед за ценой.

## Параметры

- **Stop Loss** – расстояние от цены входа до стоп-лосса в шагах цены.
- **Take Profit** – расстояние до тейк-профита в шагах цены.
- **Trailing Stop** – минимальная прибыль для активации трейлинг-стопа. Значение 0 отключает трейлинг.
- **Trailing Step** – дополнительная прибыль, необходимая для очередного смещения трейлинга.
- **Base Volume** – объём первой сделки в серии.
- **Martingale Mult** – множитель, применяемый к объёму после стоп-лосса.
- **Max Volume** – верхний предел объёма. Если расчётный объём больше, сделка пропускается и записывается предупреждение.
- **Candle Type** – тип свечей, по которым выполняются решения и риск-контроль.

## Примечания

- В стратегии используются рыночные ордера для входов и выходов, что соответствует поведению исходного советника.
- Если у инструмента отсутствует шаг цены, параметры интерпретируются как абсолютные значения в пунктах.
- Генератор случайных чисел инициализируется текущим временем, чтобы разные запуски не повторяли одну и ту же последовательность сделок.
