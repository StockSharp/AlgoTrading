# Стратегия Turbo Scaler Grid

## Описание
Стратегия Turbo Scaler Grid переносит логику советника MQL5 «Turbo Scaler Grid Pending» в инфраструктуру StockSharp. Алгоритм выстраивает сетку отложенных стоп-заявок вокруг заданных цен, защищает открытые позиции с помощью перевода в безубыток и трейлинг-стопа, а также контролирует совокупную плавающую прибыль/убыток по портфелю.

Основные источники данных:

- Пользовательский таймфрейм свечей (параметр `TriggerCandleType`) — определяет, когда цена достаточно приблизилась к опорным уровням и можно активировать сетку.
- Свечи 30 минут, 2 часа и 1 день — используются для дополнительной фильтрации направленных сигналов.
- Потоки Level1 — предоставляют актуальные bid/ask, необходимые для расчёта цен заявок и сопровождения позиций.

## Логика работы
1. **Формирование сетки**
   - Стартовые уровни задаются параметрами `BuyStopEntry` и `SellStopEntry`.
   - Количество заявок ограничивается параметром `PendingQuantity`, шаг между ними — `PendingStepPoints`.
   - Цена должна подтвердить импульс в сторону сетки (проверяется свечами выбранного таймфрейма) перед размещением заявок.
   - При включении `PendingConditionTrigger` дополнительно анализируются дневные диапазоны (`OrderBuyBlockStart/End`, `OrderSellBlockStart/End`) и направление свечей H2/M30.
2. **Защита позиции**
   - Базовый стоп вычисляется из `StopLossPoints` (либо из фиксированных `BuyStopLossPrice`/`SellStopLossPrice`).
   - После прохождения `BreakevenTriggerPoints` стоп переводится в безубыток с учётом `BreakevenOffsetPoints`.
   - Трейлинг активируется только после безубытка и обновляется, когда цена уходит дальше на `TrailMultiplier * TrailPoints`.
3. **Контроль капитала**
   - Если плавающий убыток превышает `MaxFloatLoss` (значение автоматически масштабируется относительно объёма сделки), все позиции закрываются.
   - При достижении прибыли `EquityTrigger` создаётся виртуальная линия фиксации на уровне `EquityBreakeven`, далее она подтягивается с шагом `EquityTrail`.

## Параметры
| Параметр | Назначение |
| --- | --- |
| `StopLossPoints` | Размер первоначального стоп-лосса (в пунктах). |
| `BreakevenTriggerPoints` | Смещение цены для перевода стопа в безубыток. |
| `BreakevenOffsetPoints` | Дополнительный буфер при установке стопа в безубыток. |
| `TrailPoints` | Расстояние трейлинг-стопа после безубытка. |
| `TrailMultiplier` | Коэффициент, определяющий момент обновления трейлинга. |
| `BuyStopLossPrice` / `SellStopLossPrice` | Жёстко заданные уровни стопов для длинных/коротких позиций. |
| `BuyStopEntry` / `SellStopEntry` | Базовые цены сетки отложенных стоп-заявок. |
| `OrderVolume` | Объём каждой заявки. |
| `PendingQuantity` | Максимум активных отложенных заявок. |
| `PendingStepPoints` | Шаг между заявками в сетке. |
| `TriggerCandleType` | Таймфрейм свечей для ценового триггера. |
| `PendingPriceTrigger` | Включает ценовой триггер.
| `PendingConditionTrigger` | Включает многофреймовый фильтр. |
| `OrderBuyBlockStart` / `OrderBuyBlockEnd` | Верхняя/нижняя границы дневного диапазона для покупок. |
| `OrderSellBlockStart` / `OrderSellBlockEnd` | Верхняя/нижняя границы диапазона для продаж. |
| `MaxFloatLoss` | Допустимый плавающий убыток (масштабируется по объёму). |
| `EquityBreakeven` | Уровень прибыли, который фиксируется после срабатывания триггера. |
| `EquityTrigger` | Порог плавающей прибыли, запускающий фиксацию. |
| `EquityTrail` | Шаг подтягивания линии фиксации. |

## Дополнительно
- Значение `OrderVolume` масштабирует все денежные пороги по той же формуле, что и в оригинальном советнике (0.01 лота — базовая величина).
- Комментарии в исходном коде приведены на английском языке, чтобы соблюдать единый стиль репозитория.
- Реализация использует только высокоуровневые механизмы StockSharp (`SubscribeCandles`, `Bind`, `BuyStop`, `SellStop`, `SellMarket`, `BuyMarket`).
