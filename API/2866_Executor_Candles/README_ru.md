# Стратегия Executor Candles
[English](README.md) | [中文](README_cn.md)

Стратегия представляет собой точную конвертацию советника MetaTrader «Executor Candles». Она отслеживает широкий набор свечных разворотных моделей и при необходимости подтверждает сигналы свечой более старшего таймфрейма. Управление сделкой — стоп-лоссы, тейк-профиты и трейлинг-стопы — воспроизведено из оригинала и задаётся в пунктах (price step инструмента).

## Принцип работы

- **Фильтр тренда**. При включённом параметре `UseTrendFilter` анализируется последняя завершённая свеча таймфрейма `TrendCandleType`. Лонги разрешены только если свеча закрылась ростом, шорты — если свеча медвежья. При отключённом фильтре (значение по умолчанию) решение принимается только по свечным моделям.
- **Модели для входа в лонг**: «молот», бычье поглощение, модель «поглощение» (piercing line), «утренняя звезда» и «утренняя дожи-звезда» по трём последним завершённым свечам рабочего таймфрейма.
- **Модели для входа в шорт**: «повешенный», медвежье поглощение, «тёмное облако», «вечерняя звезда» и «вечерняя дожи-звезда».
- **Менеджмент позиции**:
  - Раздельные стоп-лоссы и тейк-профиты для лонгов и шортов (`StopLossBuyPips`, `TakeProfitBuyPips`, `StopLossSellPips`, `TakeProfitSellPips`).
  - Дополнительные трейлинг-стопы (`TrailingStopBuyPips`, `TrailingStopSellPips`) с минимальным шагом подтяжки `TrailingStepPips`. Трейлинг активируется только после прохождения ценой расстояния стопа плюс шаг, как в MQL-версии.
  - Объём заявки определяется параметром `OrderVolume`, закрытие и разворот позиции выполняется рыночными ордерами.

Стратегия подписывается на свечи `CandleType` для поиска сигналов и при необходимости на `TrendCandleType` для фильтра тренда. В памяти хранятся только три последних завершённых бара, что достаточно для всех используемых шаблонов и не требует накопления истории.

## Параметры

- `CandleType` — таймфрейм торговых свечей.
- `TrendCandleType` — таймфрейм свечи для подтверждения тренда (используется при активном фильтре).
- `OrderVolume` — объём рыночных заявок.
- `StopLossBuyPips`, `TakeProfitBuyPips`, `TrailingStopBuyPips` — параметры управления риском для длинных позиций.
- `StopLossSellPips`, `TakeProfitSellPips`, `TrailingStopSellPips` — аналогичные параметры для коротких позиций.
- `TrailingStepPips` — минимальное улучшение цены, необходимое для подтяжки трейлинг-стопа.
- `UseTrendFilter` — включает или отключает фильтр старшего таймфрейма.

## Примечания

- Все значения в пунктах умножаются на `PriceStep` инструмента — убедитесь, что шаг цены задан корректно.
- Проверка условий выполняется на закрытии каждой свечи. Тики в течение бара лишь обновляют текущую свечу и не приводят к немедленным сделкам.
- Для повторения поведения исходного советника используются только рыночные ордера и полный выход из позиции при срабатывании условий.
