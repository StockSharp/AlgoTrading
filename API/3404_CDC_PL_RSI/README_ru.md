# Стратегия CDC PL RSI

## Общее описание
**CDC PL RSI Strategy** переносит эксперта MetaTrader *Expert_ADC_PL_RSI* на платформу StockSharp. Алгоритм анализирует завершённые свечи, выявляет свечные разворотные модели и подтверждает сигналы индикатором RSI. Длинные позиции открываются после модели «Пробой облака тьмы» (*Piercing Line*) в сочетании с перепроданностью RSI, короткие — после «Покрывающей тёмное облако» (*Dark Cloud Cover*) в зоне перекупленности. Управление капиталом оставлено базовому механизму StockSharp: объём задаётся свойством `Volume` стратегии.

## Логика индикаторов и фильтров
- **Свечные модели**. Поведение полностью повторяет исходный MQL‑код: используются две последние завершённые свечи, проверяются разрывы цен, длина тел относительно скользящего среднего и направление тренда.
- **RSI**. Осциллятор с периодом 20 (значение можно оптимизировать) служит для подтверждения импульса. Для лонга требуется `RSI < 40`, для шорта — `RSI > 60`. История значений дополнительно используется для фиксации позиции при обратных пересечениях уровней 30 и 70.
- **Среднее тело и тренд**. Два индикатора SMA дублируют функции `AvgBody` и `CloseAvg` из MQL: первый усредняет длину тел, второй оценивает тренд закрытий. Это позволяет фильтровать шумовые свечи и гарантировать появление моделей после направленного движения.

## Торговые правила
### Вход в лонг
1. Найти модель Piercing Line на двух последних свечах.
2. Убедиться, что RSI предыдущей свечи ниже 40.
3. Открыть покупку по рынку. При наличии короткой позиции стратегия переворачивается, покупая сумму текущего объёма и абсолютной величины позиции.

### Вход в шорт
1. Найти модель Dark Cloud Cover на двух последних свечах.
2. Проверить, что RSI предыдущей свечи выше 60.
3. Открыть продажу по рынку. При наличии длинной позиции выполняется разворот с тем же объёмным правилом.

### Выход
- Закрывать лонг, когда RSI опускается ниже 70 или поднимается выше 30, сигнализируя об окончании импульса.
- Закрывать шорт, когда RSI поднимается выше 30 или опускается ниже 70, что соответствует логике оригинального эксперта.

## Параметры
| Имя | Значение по умолчанию | Описание |
|-----|-----------------------|----------|
| `RsiPeriod` | 20 | Период RSI. Допускается оптимизация в диапазоне 10–40 с шагом 5. |
| `BodyAveragePeriod` | 14 | Период сглаживания длины тел и трендового фильтра по закрытиям. Оптимизируется в диапазоне 10–30 с шагом 5. |
| `CandleType` | Таймфрейм 1 час | Тип свечей для расчёта. Можно выбрать любой поддерживаемый формат StockSharp. |
| `Volume` (устанавливается пользователем) | — | Базовый объём заявки, задаётся перед запуском стратегии. |

## Использование
1. Привяжите стратегию к нужным портфелю и инструменту в Designer, Shell или Runner.
2. Настройте таймфрейм свечей и объём сделок под специфику инструмента.
3. При необходимости измените периоды RSI и скользящей средней или запустите оптимизацию.
4. Запустите стратегию и контролируйте сигналы через наложенные на график свечи, линию RSI и линию среднего закрытия.

## Дополнительно
- Метод `StartProtection()` активирован, поэтому можно задействовать стандартные защитные механизмы (стоп-лосс, тейк-профит, трейлинг и т.п.).
- Обрабатываются только полностью сформированные свечи — логика совпадает с реализацией в MetaTrader.
- Хранение больших коллекций не требуется: все расчёты выполняются индикаторами, что соответствует требованиям конвертации.
