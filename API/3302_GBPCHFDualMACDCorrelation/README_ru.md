# GBPCHF Dual-MACD Correlation Strategy

## Описание
Стратегия торгует кросс-курс GBP/CHF, анализируя взаимосвязь двух основных валютных пар: GBPUSD и USDCHF. Обе пары обрабатываются индикатором MACD (12, 26, 9) на одной и той же серии свечей. Если MACD по GBPUSD пересекает MACD по USDCHF снизу вверх, и обе величины находятся выше нуля, стратегия рассматривает это как синхронное усиление фунта и покупает GBPCHF. Пересечение сверху вниз при отрицательных значениях трактуется как повод для продаж. Параметр `ReverseSignals` позволяет инвертировать логику сигналов.

## Алгоритм
1. Подписка на свечи выбранного таймфрейма (по умолчанию 1 час) для трёх инструментов: торгуемого GBPCHF, а также GBPUSD и USDCHF.
2. Привязка индикаторов MACD к потокам свечей GBPUSD и USDCHF.
3. После формирования индикаторов:
   - **Покупка**: предыдущие значения MACD по обеим парам положительные, и MACD GBPUSD пересекает MACD USDCHF снизу вверх.
   - **Продажа**: предыдущие значения отрицательные, и MACD GBPUSD пересекает MACD USDCHF сверху вниз.
4. Флаги `OnlyOnePosition` и `CloseOppositePositions` контролируют количество одновременно открытых позиций и поведение при встречных сделках.
5. Выход из позиции осуществляется по стоп-лоссу, тейк-профиту или трейлинг-стопу с настраиваемой частотой обновления.

## Параметры
- `StopLossPips` — расстояние стоп-лосса в пунктах (по умолчанию 70).
- `TakeProfitPips` — тейк-профит в пунктах (45).
- `TrailingFrequencySeconds` — минимальный интервал между обновлениями трейлинг-стопа. Значения меньше 10 означают обновление только при завершении новой свечи.
- `TrailingStopPips` — дистанция трейлинг-стопа (0 отключает механизм).
- `TrailingStepPips` — минимальный шаг в пунктах, на который цена должна продвинуться, чтобы трейлинг-стоп передвинулся.
- `ReverseSignals` — инвертировать сигналы.
- `CloseOppositePositions` — закрывать встречные позиции перед открытием новой.
- `OnlyOnePosition` — разрешать только одну позицию одновременно.
- `TradeVolume` — объём заявки при открытии позиций.
- Параметры `MacdShortPeriod`, `MacdLongPeriod`, `MacdSignalPeriod` — настройки MACD.
- `CandleType` — тип свечей для всех расчётов.
- `GbpUsdSecurity` и `UsdChfSecurity` — инструменты GBPUSD и USDCHF (обязательные параметры).

## Управление позицией
- Если задан `StopLossPips`, начальный стоп устанавливается по этой величине; при нуле используется дистанция трейлинг-стопа.
- `TakeProfitPips` задаёт уровень фиксации прибыли, если значение больше нуля.
- Трейлинг-стоп передвигается после благоприятного движения на `TrailingStepPips` пунктов и с учётом ограничения по времени (`TrailingFrequencySeconds`).
- Любое срабатывание стопов приводит к закрытию позиции рыночным ордером.

## Рекомендации
- Убедитесь, что свечи для GBPUSD и USDCHF совпадают по таймфрейму с торгуемым инструментом, иначе кроссовая логика будет искажена.
- При торговле на счётах без хеджирования включайте `CloseOppositePositions` для автоматического закрытия встречных сделок.
- Трейлинг работает по закрытию свечи. Для более оперативного сопровождения используйте меньший таймфрейм или уменьшите параметр частоты.
