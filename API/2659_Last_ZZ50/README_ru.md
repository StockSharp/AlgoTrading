# Стратегия Last ZZ50

## Обзор
Last ZZ50 повторяет одноимённого эксперта MetaTrader, созданного Владимиром Карпутовым.
Стратегия использует индикатор ZigZag для отслеживания последних трёх экстремумов и выставляет отложенные заявки на половине двух последних отрезков ZigZag.
Таким образом алгоритм пытается войти в пробой текущей структуры и мгновенно обновляет заявки при каждом изменении пивотов.

## Логика торговли
- **Определение пивотов** – Индикатор ZigZag (по умолчанию глубина 12, отклонение 5, backstep 3) возвращает пивоты A (последний), B и C.
- **Отрезок BC** – Если новые значения B и C отличаются от предыдущих, а пивот A подтверждает направление, выставляется отложенная заявка по цене `(B + C) / 2`.
  - При восходящем отрезке BC открывается длинная позиция, при нисходящем – короткая.
  - Тип заявки (лимит/стоп) выбирается в зависимости от текущей цены относительно среднего уровня.
- **Отрезок AB** – Те же правила применяются к отрезку AB, что позволяет ловить откат к предыдущему лучу.
- **Фильтр сессии** – Торговля разрешена только в пределах выбранных дней и времени (по умолчанию с понедельника 09:01 до пятницы 21:01).
  Вне окна стратегия отменяет заявки и при необходимости закрывает позицию.
- **Трейлинг-стоп** – Когда прибыль превышает сумму параметров `TrailingStop` и `TrailingStep`, защитная стоп-заявка подтягивается за ценой для фиксации результата.

## Управление рисками
- Объём каждой заявки рассчитывается как произведение `LotMultiplier` на минимальный торгуемый объём инструмента.
- Заявки по лучам AB и BC отменяются и перерегистрируются при каждом изменении ZigZag, что исключает «зависшие» уровни.
- Трейлинг включается только после комфортного движения в прибыль, снижая количество преждевременных выходов.

## Параметры
- `LotMultiplier` – множитель минимального объёма сделки.
- `ZigZagDepth`, `ZigZagDeviation`, `ZigZagBackstep` – настройки индикатора ZigZag.
- `TrailingStopPips`, `TrailingStepPips` – расстояние трейлинг-стопа и порог его активации в пунктах.
- `StartDay`, `EndDay`, `StartTime`, `EndTime` – границы торговой сессии.
- `CloseOutsideSession` – закрывать ли позиции при выходе из торгового окна.
- `CandleType` – тип свечей, используемых для расчёта ZigZag (по умолчанию 1 час).

## Индикаторы
- **ZigZag** – основной источник пивотов для вычисления уровней входа.
