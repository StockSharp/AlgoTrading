# Стратегия MACD 1 MIN SCALPER

Стратегия является C# портом MetaTrader-советника **«MACD 1 MIN SCALPER»**. Она использует связку из взвешенных скользящих средних, подтверждений MACD на нескольких таймфреймах и фильтра по импульсу. Задача — открывать сделки по тренду, когда младший и старшие таймфреймы показывают единое направление, а импульс цены достаточно сильный.

## Логика работы

1. **Базовый таймфрейм** – настраиваемый (по умолчанию M1). Две WMA с периодами 50 и 200, рассчитанные по типичной цене `(High + Low + Close) / 3`, определяют краткосрочный тренд.
2. **Фильтр старшего таймфрейма** – те же периоды WMA вычисляются на таймфрейме H1. Для покупок обе быстрые WMA должны находиться выше медленных, для продаж – ниже. Если рабочий таймфрейм уже равен H1, используются значения базовых средних.
3. **Подтверждение MACD** – MACD (12, 26, 9) должен пересекать сигнал сверху на базовом таймфрейме, на H1 и на месячном таймфрейме (≈43200 минут). Для коротких сигналов требуется обратное расположение линий на всех трёх периодах.
4. **Фильтр импульса** – индикатор Momentum с периодом 14 строится на следующем «метатрейдеровском» таймфрейме (M1→M15, M5→M30 и т.д.). Абсолютное отклонение от 100 должно превысить заданный порог хотя бы на одном из трёх последних завершённых баров.
5. **Правила входа** – позиция открывается только при выполнении всех условий соответствующего направления и отсутствии открытого объёма в ту же сторону. Если имеется противоположная позиция, заявка автоматически включает объём для её закрытия.
6. **Управление рисками** – опциональные стоп-лосс и тейк-профит задаются в пунктах (pips) и пересчитываются в шаги цены при запуске. Трейлинг, перенос в безубыток и денежный менеджмент исходного советника в данном порте не реализованы.

## Параметры

| Параметр | Описание |
| --- | --- |
| `CandleType` | Таймфрейм, на котором работают базовые индикаторы. |
| `OrderVolume` | Объём рыночного ордера и одновременно объём для переворота. |
| `FastMaPeriod` / `SlowMaPeriod` | Периоды быстрых и медленных взвешенных скользящих. |
| `MacdFastPeriod` / `MacdSlowPeriod` / `MacdSignalPeriod` | Параметры EMA в индикаторе MACD. |
| `MomentumPeriod` | Период индикатора Momentum. |
| `MomentumThreshold` | Минимальное абсолютное отклонение от 100 для фильтра импульса. |
| `TakeProfitPips` / `StopLossPips` | Необязательные уровни тейк-профита и стоп-лосса в пунктах. |

## Особенности реализации

- Используется высокоуровневое API StockSharp: подписка на свечи и привязка индикаторов (`SubscribeCandles`, `Bind`, `BindEx`). Дополнительные массивы и ручные расчёты не требуются.
- Таймфрейм для Momentum определяется по таблице MetaTrader `[1,5,15,30,60,240,1440,10080,43200]`. Если рабочий период отсутствует в списке, выбирается значение, равное четырём базовым периодам.
- `StartProtection` активируется только при ненулевых параметрах стопа или тейка. Трейлинг-стоп в этой реализации отсутствует.
- Для наглядности на график выводятся базовые свечи, обе WMA и MACD.

## Рекомендации

- Устанавливайте `OrderVolume` в соответствии с минимальным лотом инструмента – стратегия автоматически округляет объём по шагу.
- Убедитесь, что в источнике данных доступны свечи H1 и месячного таймфрейма, иначе подтверждающие сигналы не сформируются и сделок не будет.
- Порог `MomentumThreshold` влияет на частоту сделок: чем он выше, тем сильнее требуется импульс и тем реже поступают сигналы.
