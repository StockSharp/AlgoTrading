# Стратегия Color XMUV с торговым окном

Стратегия переносит эксперт **Exp_ColorXMUV_Tm** из MetaTrader в StockSharp, повторяя построение линии Color XMUV и фильтр по
времени, но используя высокоуровневый API StockSharp для управления сделками. Цвет линии определяет направление: переход в
бирюзовый цвет (рост) управляет длинными позициями, переход в пурпурный (падение) — короткими.

## Логика работы
- Для каждого завершённого бара рассчитывается составная цена, как в исходном MQL: `(High + Close)/2` для бычьей свечи,
  `(Low + Close)/2` для медвежьей и `Close` для дожи.
- Составная цена подаётся в выбранный метод сглаживания. Встроенные в StockSharp индикаторы обеспечивают SMA, EMA, SMMA/RMA,
  LWMA и Jurik. Экзотические варианты (T3, VIDYA, ParMA) заменены на EMA из-за отсутствия прямых аналогов. Параметр `Phase`
  сохранён ради совместимости, даже если конкретный индикатор его игнорирует.
- Цвет линии восстанавливается сравнением текущего сглаженного значения с предыдущим: рост — бычий цвет, падение — медвежий,
  без изменения — нейтральный.
- `SignalBar` задаёт количество полностью закрытых баров, которые нужно пропустить перед обработкой сигнала (по умолчанию 1 —
  анализируется бар перед последним, что соответствует логике исходного советника).
- Бычий разворот (предыдущий цвет не был бычьим, текущий стал бычьим) закрывает открытую короткую позицию и при необходимости
  открывает/добавляет длинную. Медвежий разворот действует зеркально.
- Фильтр по времени полностью повторяет MQL-версию: вне торгового окна позиции закрываются немедленно, новые сигналы игнорируются.
  Если время начала больше времени окончания, окно считается ночным и проходит через полночь.
- `StopLossPoints` и `TakeProfitPoints` трактуются как расстояние в пунктах и переводятся в абсолютную цену через шаг цены
  инструмента. Затем защита регистрируется через `StartProtection`, чтобы по возможности передать сопровождение на уровень торгового
  движка StockSharp.

## Управление рисками и позициями
- `OrderVolume` задаёт базовый объём рыночных заявок. При развороте стратегия добавляет модуль текущей позиции, чтобы одной заявкой
  закрыть старую и открыть новую позицию.
- При значении параметров стоп-лосса или тейк-профита, равном нулю, соответствующий защитный уровень отключается. Пересчёт из пунктов
  выполняется автоматически.
- Закрытие по сигналу цвета учитывает флаги `EnableBuyExits` и `EnableSellExits`, что позволяет независимо управлять выходом из
  длинных и коротких позиций.

## Параметры
- **Candle Type** – тип свечей для расчёта (по умолчанию 4-часовые).
- **Order Volume** – базовый объём рыночных сделок.
- **Enable Long Entries / Enable Short Entries** – разрешение на открытие длинных/коротких позиций при смене цвета.
- **Close Longs / Close Shorts** – автоматическое закрытие позиций при противоположном сигнале.
- **Use Time Filter** – включение фильтра по времени торговли.
- **Start Hour / Start Minute / End Hour / End Minute** – границы торговой сессии; если начало больше конца, окно считается
  ночным и продолжается через полночь.
- **Smoothing Method** – метод сглаживания линии Color XMUV. Для отсутствующих в StockSharp реализаций используется EMA с отметкой
  в документации.
- **Length** – длина окна сглаживания (положительное значение).
- **Phase** – дополнительный параметр фазы, сохранённый для совместимости с исходным советником.
- **Signal Bar** – количество завершённых баров, на которое задерживается обработка сигналов; 0 означает работу по последнему бару.
- **Stop Loss (pts) / Take Profit (pts)** – расстояние стоп-лосса и тейк-профита в пунктах; ноль отключает уровень.

## Примечания
- Исходный индикатор опирался на внешние библиотеки сглаживания. При отсутствии аналога (ParMA, VIDYA, T3) стратегия применяет
  EMA. Об этом следует уведомлять пользователей.
- Стратегия хранит только минимальную историю цветов, необходимую для `SignalBar`, что соответствует требованию репозитория не
  создавать избыточные коллекции данных.
- Все комментарии в коде выполнены на английском языке, как было оговорено.
