# Стратегия Ichimoku Barabashkakvn
[English](README.md) | [中文](README_cn.md)

Стратегия повторяет советник Владимира Карпутова (редакция barabashkakvn) на платформе StockSharp. Используется классический индикатор Ichimoku: пересечение линий Tenkan/Kijun в сочетании с положением цены относительно облака и полноценное управление рисками из оригинальной версии.

## Логика работы

- **Набор индикаторов** – один Ichimoku Kinko Hyo с периодами 9/26/52. Из него берутся линии Tenkan, Kijun, Senkou Span A и Senkou Span B.
- **Условия для покупок** – Tenkan пересекает Kijun снизу вверх, а закрытие свечи находится выше Senkou Span B. Для распознавания пересечения используется предыдущее значение Tenkan, как в MQL.
- **Условия для продаж** – Tenkan опускается ниже Kijun, а цена закрытия располагается ниже Senkou Span A.
- **Ведение позиции** – стратегия держит только одну суммарную позицию. При появлении сигнала в противоположную сторону сначала закрывается текущая позиция, и только на следующей свече возможно открытие в новом направлении.
- **Торговое окно** – при необходимости включается фильтр по часам. Проверка интервала полностью повторяет условия в оригинальном коде.

## Управление рисками

- **Стопы и тейки для каждого направления** – для длинных и коротких позиций задаются отдельные значения стоп-лосса и тейк-профита в пунктах. Пересчёт в цену выполняется через шаг цены с поправкой ×10 для трёх- и пятизнаковых инструментов, как в MetaTrader.
- **Трейлинг-стоп** – расстояние трейлинга задаётся отдельно для длин и коротких позиций, дополнительно указывается общий шаг трейлинга. Стоп подтягивается только после того, как прибыль превысила сумму расстояния и шага, что полностью повторяет алгоритм EA.
- **Контроль исполнения** – даже без реальных заявок стопы и тейки проверяются на каждой закрытой свече, поэтому виртуальная защита работает так же, как серверные приказы в MetaTrader.

## Параметры

- `TenkanPeriod` (по умолчанию 9) – период линии Tenkan.
- `KijunPeriod` (26) – период линии Kijun.
- `SenkouSpanBPeriod` (52) – период Senkou Span B.
- `CandleType` (часовые свечи) – источник данных.
- `OrderVolume` (1 лот) – объём сделки.
- `BuyStopLossPips` / `SellStopLossPips` (100) – расстояние стоп-лосса в пунктах.
- `BuyTakeProfitPips` / `SellTakeProfitPips` (300) – расстояние тейк-профита в пунктах.
- `BuyTrailingStopPips` / `SellTrailingStopPips` (50) – расстояние трейлинга в пунктах.
- `TrailingStepPips` (5) – минимальный прирост прибыли перед сдвигом трейлинга.
- `UseTradeHours` (false) – включение фильтра по времени.
- `StartHour` / `EndHour` (0 / 23) – границы торгового окна, часы указываются в диапазоне 0–23.

Все параметры созданы через `StrategyParam<T>`, поэтому их можно оптимизировать в Designer или менять из интерфейса без правок исходного кода.
