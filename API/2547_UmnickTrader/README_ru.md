# Стратегия UmnickTrader
[English](README.md) | [中文](README_cn.md)

Адаптивная контртрендовая система, портированная из оригинального советника UmnickTrader для MQL5. Стратегия одновременно
удерживает только одну позицию и меняет торговое направление в зависимости от результата предыдущей сделки. Для оценки движения
используется средняя цена свечи `(O + H + L + C) / 4`, и новые сигналы рассматриваются лишь тогда, когда эта средняя изменилась
минимум на величину `StopBase`.

## Логика работы

- Для каждой закрытой свечи рассчитывается средняя цена по четырём точкам.
- Обработка сигналов начинается лишь тогда, когда модуль разницы между текущей и последней обработанной средней ценой достигает
  `StopBase`. Таким образом стратегия дожидается значимого движения, как и в исходном советнике.
- При отсутствии открытых позиций рассчитываются адаптивные уровни тейк-профита и стоп-лосса на основе двух кольцевых буферов,
  хранящих восемь последних величин прибыли и просадки.
- После прибыльной сделки в буфер прибыли записывается максимальное благоприятное отклонение цены (с вычетом спрэда), а буфер
  убытков получает значение `StopBase + 7 * Spread`.
- После убыточной сделки буфер прибыли сбрасывается до `StopBase - 3 * Spread`, буфер убытков пополняется зафиксированной
  просадкой плюс надбавка на спрэд, а следующее направление торговли разворачивается.

## Управление сделками

- Базовое расстояние для тейк-профита и стоп-лосса равно `StopBase`. Если сумма значений в соответствующем буфере превышает
  `StopBase / 2`, стратегия использует среднее значение буфера, расширяя или сужая цели динамически.
- Входы выполняются рыночными ордерами. Цены тейк-профита и стоп-лосса сохраняются внутри стратегии, и позиции закрываются при
  достижении уровня максимумом или минимумом свечи.
- Пока позиция открыта, фиксируются наибольшее благоприятное движение и максимальная просадка по экстремумам свечей. Эти данные
  используются при обновлении буферов после закрытия сделки.
- Одновременно может существовать только одна позиция; новый сигнал игнорируется, если предыдущая сделка ещё не завершена.

## Параметры

- `StopBase` – базовое расстояние (в ценовых единицах), определяющее значимость движения и исходные уровни TP/SL. Значение по
  умолчанию: `0.017`.
- `TradeVolume` – объём рыночных ордеров. Значение по умолчанию: `0.1`.
- `Spread` – величина поправки на спрэд при обновлении адаптивных буферов. Значение по умолчанию: `0.0005`.
- `CandleType` – тип свечей, по которым выполняются расчёты. Значение по умолчанию: `TimeSpan.FromMinutes(5).TimeFrame()`.

## Классификация и фильтры

- **Направление**: Обе стороны (но не одновременно).
- **Стиль**: Адаптивная свинговая / контртрендовая торговля.
- **Индикаторы**: Средняя цена, пользовательские буферы экстремумов.
- **Стопы**: Динамический тейк-профит и стоп-лосс, рассчитываемые стратегией.
- **Сложность**: Средняя — требуется поддержка буферов и адаптивных расчётов.
- **Таймфрейм**: Настраивается параметром `CandleType`.
- **Сезонность и новости**: Не используются.
- **Управление рисками**: Размер позиции задаётся `TradeVolume`, расстояния выхода адаптируются к недавним результатам.
