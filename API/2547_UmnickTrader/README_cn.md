# UmnickTrader 策略
[English](README.md) | [Русский](README_ru.md)

该策略从原版 MQL5 顾问 UmnickTrader 移植而来，属于自适应的逆势/摇摆交易系统。策略在任意时刻只保留一张头寸，
并根据上一笔交易的盈亏来切换做多或做空方向。它以 `(O + H + L + C) / 4` 的平均价格来衡量行情变化，只有当该平均
值相对上一次处理时发生至少 `StopBase` 的移动后才会评估新的信号。

## 核心逻辑

- 对每根收盘的K线计算 `(开盘价 + 最高价 + 最低价 + 收盘价) / 4` 的平均价。
- 当当前平均价与上一次处理的平均价之差的绝对值大于或等于 `StopBase` 时才会触发信号判断，模拟原策略等待足够大
  波动的逻辑。
- 若当前没有持仓，则根据两个循环缓冲区（各保存最近八笔盈利和亏损的幅度）来计算自适应的止盈与止损距离。
- 盈利交易结束后，将持仓期间的最大有利波动减去点差垫值写入盈利缓冲区，同时将 `StopBase + 7 * Spread` 写入亏损
  缓冲区。
- 亏损交易结束后，将盈利缓冲区重置为 `StopBase - 3 * Spread`，亏损缓冲区记录最大回撤再加点差垫值，并把下一笔交
  易的方向反转。

## 交易管理

- 止盈与止损的基准距离都是 `StopBase`。如果缓冲区的累计值超过 `StopBase / 2`，则使用缓冲区的平均值来动态放宽或
  收紧出场距离。
- 入场采用市价单，策略内部保存预期的止盈价与止损价，当K线的最高价或最低价触及这些水平时主动平仓。
- 持仓过程中，策略利用K线极值跟踪最大的顺势波动和最大回撤，这些统计值会在交易结束时写入缓冲区。
- 任何时刻只允许一张头寸；如果上一笔交易尚未完成，则忽略新的信号。

## 参数

- `StopBase` – 判断行情是否足够波动的基准距离，同时也是初始的止盈/止损距离，默认 `0.017`。
- `TradeVolume` – 市价单的交易量，默认 `0.1`。
- `Spread` – 更新自适应缓冲区时使用的点差补偿，默认 `0.0005`。
- `CandleType` – 用于计算的K线类型，默认 `TimeSpan.FromMinutes(5).TimeFrame()`。

## 分类与筛选

- **方向**：双向（但同一时间只持有一个方向）。
- **风格**：自适应摇摆 / 逆势交易。
- **指标**：价格平均值，自定义的波动缓冲区。
- **止损/止盈**：由策略动态计算并管理。
- **复杂度**：中等——需要维护缓冲区并进行自适应计算。
- **周期**：由 `CandleType` 参数决定。
- **季节性 / 新闻过滤**：未使用。
- **风险管理**：仓位规模由 `TradeVolume` 固定，出场距离根据近期表现动态调整。
