# Стратегия Manual EA

**Manual EA Strategy** — это перенос советника MetaTrader 4 *Manual_EA.mq4* (каталог `MQL/8159`) на высокоуровневый API StockSharp. Исходный алгоритм генерирует ручные торговые сигналы, когда стохастический осциллятор выходит из зон перекупленности или перепроданности. Порт сохранит конфигурацию 5-3-3, автоматически закрывает противоположные позиции перед открытием нового ордера по рынку и делает параметры управления капиталом доступными в настройках стратегии.

## Логика торговли

1. Стратегия подписывается на свечи типа `CandleType` (по умолчанию 15-минутные) и передаёт цены закрытия в стохастический осциллятор со следующими параметрами:
   - длина `%K` = `KPeriod` (по умолчанию 5 баров);
   - дополнительное сглаживание `%K` = `Slowing` (по умолчанию 3 бара);
   - сглаживание `%D` = `DPeriod` (по умолчанию 3 бара).
2. Сигналы рассчитываются только по финальному значению линии %D каждой завершённой свечи; сравниваются два последовательных значения, чтобы определить пересечение уровней.
3. **Покупка** — если предыдущее значение %D было меньше либо равно `OversoldLevel` (по умолчанию 10), а текущее поднялось выше порога. Сначала стратегия закрывает короткие позиции, затем покупает `Volume + |short|` по рынку.
4. **Продажа** — если предыдущее значение %D было больше либо равно `OverboughtLevel` (по умолчанию 90), а текущее опустилось ниже порога. Сначала закрываются длинные позиции, затем продаётся `Volume + |long|` по рынку.
5. Защитные приказы ставятся через `StartProtection`. Положительные значения `StopLoss` и/или `TakeProfit` (в пунктах) активируют соответствующие уровни, значение `0` отключает защиту.

Перенос следует рекомендациям StockSharp: не обращается к буферам индикаторов напрямую и игнорирует незавершённые свечи.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `CandleType` | Таймфрейм (`DataType`), по которому строятся свечи и считается индикатор. | 15 минут |
| `KPeriod` | Длина расчёта линии %K стохастика. | 5 |
| `DPeriod` | Сглаживание линии %D. | 3 |
| `Slowing` | Дополнительное сглаживание %K перед вычислением %D. | 3 |
| `OverboughtLevel` | Верхний уровень, пересечение вниз которого запускает продажи. | 90 |
| `OversoldLevel` | Нижний уровень, пересечение вверх которого запускает покупки. | 10 |
| `StopLoss` | Расстояние до стоп-лосса в пунктах (0 = отключён). | 100 |
| `TakeProfit` | Расстояние до тейк-профита в пунктах (0 = отключён). | 100 |
| `Volume` | Объём заявки (в лотах). Перед выставлением нового ордера стратегия неттует противоположные позиции. | 0.1 |

## Дополнительные замечания

- Используется связка `SubscribeCandles` + `BindEx`, поэтому стратегия получает готовые значения `StochasticOscillatorValue` и не торгует по промежуточным данным.
- При наличии области графика автоматически отображаются свечи, кривая стохастика и собственные сделки стратегии.
- Сравнение двух последовательных значений %D повторяет поведение MQL-реализации, где использовались буферы `MODE_SIGNAL` со сдвигами 1 и 2.
