# Стратегия Zone Recovery Button

**Zone Recovery Button Strategy** — порт эксперта MetaTrader "ZONE RECOVERY BUTTON VER1" (`MQL/25347`).
В оригинале торговля запускалась через кнопки BUY/SELL на графике. В версии под StockSharp панель заменена параметрами, но
сохранены логика восстановления позиции, тейк-профиты в деньгах и процентах, трейлинг по прибыли и экстренный выход по equity.

После задания направления стратегия открывает стартовую сделку. Когда цена проходит настроенную ширину зоны, добавляется
противоположный ордер с увеличенным объёмом. Корзина закрывается при достижении тейк-профита по пунктам, при превышении
заданной прибыли в валюте/процентах, при откате после трейлинга либо при срабатывании защитного equity-stop.

## Правила

1. **Стартовое направление** — аналог нажатия на кнопку BUY или SELL. Первая сделка появляется сразу после получения данных и
разрешения на торговлю. После закрытия корзины можно автоматически перезапустить цикл в том же направлении.
2. **Зональное восстановление** — на каждом шаге направление чередуется. Для long-цикла продажа добавляется, если цена падает
ниже `Базовая цена - Ширина зоны`, покупка — когда рынок возвращается выше базы. Для short-цикла условия зеркальные.
3. **Масштабирование объёма** — каждый хедж либо умножает предыдущий объём, либо прибавляет фиксированное значение, повторяя
настройки `Lots` и `Multiply` исходного советника.
4. **Закрытие корзины** — происходит при:
   - достижении тейк-профита по пунктам от базовой цены;
   - достижении цели в валюте счёта;
   - выполнении цели в процентах от текущей стоимости портфеля;
   - откате прибыли после активации трейлинга;
   - превышении допустимой просадки по equity относительно зафиксированного максимума.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | `TimeSpan.FromMinutes(5)` | Тип свечей для отслеживания цены. |
| `StartDirection` | `Buy` | Первое направление корзины (BUY/SELL/NONE). |
| `AutoRestart` | `true` | Автоматический запуск нового цикла после закрытия корзины. |
| `TakeProfitPips` | `200` | Расстояние по пунктам между базовой ценой и тейк-профитом. |
| `ZoneRecoveryPips` | `10` | Ширина зоны, при выходе за которую открывается противоположный ордер. |
| `InitialVolume` | `0.01` | Объём первой сделки. |
| `UseVolumeMultiplier` | `true` | Использовать мультипликативное наращивание объёма. |
| `VolumeMultiplier` | `2` | Множитель объёма при включённом `UseVolumeMultiplier`. |
| `VolumeIncrement` | `0.01` | Аддитивный шаг объёма, если мультипликатор выключен. |
| `MaxTrades` | `100` | Максимальное число сделок в корзине. |
| `UseMoneyTakeProfit` | `false` | Закрывать корзину при достижении цели в валюте. |
| `MoneyTakeProfit` | `40` | Цель по прибыли в валюте счёта. |
| `UsePercentTakeProfit` | `false` | Закрывать корзину при достижении процентной цели. |
| `PercentTakeProfit` | `10` | Цель по прибыли в процентах от стоимости портфеля. |
| `EnableTrailing` | `true` | Включить трейлинг плавающей прибыли. |
| `TrailingProfitThreshold` | `40` | Уровень прибыли, после которого включается трейлинг. |
| `TrailingDrawdown` | `10` | Допустимая отдача прибыли после активации трейлинга. |
| `UseEquityStop` | `true` | Включить экстренный выход по equity. |
| `TotalEquityRiskPercent` | `1` | Максимальная плавающая просадка (в % от пика equity) до закрытия корзины. |

## Примечания

- Для расчёта пунктов стратегия использует `PriceStep` и `StepPrice` инструмента. Без этих значений конвертация пунктов в цену и
валюту невозможна.
- StockSharp работает с неттингом, поэтому хеджирующая сетка моделируется внутри стратегии. Список сделок хранится отдельно, чтобы
повторить вычисление прибыли MetaTrader.
- Трейлинг контролирует только плавающую прибыль корзины, не выставляя дополнительных стоп-заявок.
