# Стратегия Exp Cronex Chaikin

Стратегия переносит советник MetaTrader **Exp_CronexChaikin.mq5** на высокоуровневый API StockSharp. Оригинальный робот восстанавливает осциллятор Chaikin по кривой накопления/распределения, дважды сглаживает его фильтрами Cronex XMA и торгует пересечения между быстрой и сигнальной линиями. В версии StockSharp все этапы реализованы на индикаторах библиотеки и вынесены в настраиваемые параметры.

## Логика работы

1. Подписка на выбранный поток свечей (`CandleType`).
2. Пересчет линии накопления/распределения (AD) для каждой завершенной свечи с учетом выбранного источника объема (`VolumeSource`: тиковый либо реальный).
3. Построение осциллятора Chaikin: к AD применяются два скользящих средних (`ChaikinMethod`, `ChaikinFastPeriod`, `ChaikinSlowPeriod`), после чего берется их разность.
4. Результирующий осциллятор дважды сглаживается фильтрами Cronex, управляемыми параметрами `SmoothingMethod`, `FastPeriod`, `SlowPeriod` и `Phase`. Полученные значения соответствуют быстрой и сигнальной линиям индикатора Cronex.
5. На расстоянии `SignalBar` завершенных свечей назад сравниваются значения обеих линий на текущей и предыдущей свечах.
6. Если быстрая линия находится выше сигнальной, стратегия при необходимости закрывает короткие позиции (`SellCloseEnabled`) и при разрешении (`BuyOpenEnabled`) открывает длинную при условии свежего пересечения снизу вверх.
7. Если быстрая линия ниже сигнальной, выполняются зеркальные действия для коротких позиций с учетом флагов `SellOpenEnabled` и `BuyCloseEnabled`.
8. После каждого открытия позиции пересчитываются стоп-лосс и тейк-профит в пунктах (`StopLoss`, `TakeProfit`).

Поддерживается только один суммарный нетто-позиционный объем. При смене направления заявка объединяет объем закрытия и новую сделку, чтобы повторить поведение неттингового счёта MetaTrader.

## Индикаторы и сглаживание

- **Осциллятор Chaikin** — строится на основе выбранного типа скользящей средней (`ChaikinMethod`): простая, экспоненциальная, сглаженная либо линейно-взвешенная.
- **Сглаживатели Cronex** — параметр `SmoothingMethod` открывает весь набор XMA (SMA, EMA, SMMA, LWMA, Jurik JJMA/JurX, Parabolic MA, T3, VIDYA, AMA). Параметр `Phase` управляет фазой в Jurik-фильтрах, как и в исходном MQL.

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Тип свечей, на основе которых рассчитывается индикатор (по умолчанию четырёхчасовой таймфрейм). |
| `ChaikinMethod` | Метод сглаживания в расчете осциллятора Chaikin. |
| `ChaikinFastPeriod` / `ChaikinSlowPeriod` | Быстрый и медленный периоды сглаживания AD. |
| `SmoothingMethod` | Алгоритм Cronex для сглаживания значений Chaikin. |
| `FastPeriod` / `SlowPeriod` | Периоды быстрой и сигнальной линий Cronex. |
| `Phase` | Параметр фазы для Jurik-фильтров (диапазон от -100 до +100). |
| `VolumeSource` | Источник объема при расчете AD (тики или реальный объем). |
| `SignalBar` | Количество завершенных свечей назад, на которых проверяется пересечение. |
| `BuyOpenEnabled` / `SellOpenEnabled` | Разрешение на открытие длинных и коротких позиций. |
| `BuyCloseEnabled` / `SellCloseEnabled` | Разрешение закрывать противоположные позиции при обратном сигнале. |
| `TakeProfit` / `StopLoss` | Дистанция тейк-профита и стоп-лосса в пунктах, устанавливаемая после открытия позиции. |
| `Volume` | Стандартный объем сделок StockSharp, заменяющий расчет лота из MQL. |

## Отличия от MQL-версии

- Вместо процедур из `TradeAlgorithms.mqh` используются базовые механизмы StockSharp (`Volume`, `SetStopLoss`, `SetTakeProfit`).
- Расчеты выполняются только на закрытых свечах, что повышает воспроизводимость при тестировании и в онлайне.
- Сглаживатели Cronex реализованы через индикаторы StockSharp: Jurik-фильтр — `JurikMovingAverage` с управлением фазой, VIDYA и ParMa — экспоненциальные приближения, применяемые и в других Cronex-конвертациях.
