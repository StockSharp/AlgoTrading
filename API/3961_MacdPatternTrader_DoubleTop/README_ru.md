# Macd Pattern Trader DoubleTop Strategy

## Обзор

Порт советника MetaTrader 4 **MacdPatternTraderv04cb**. Стратегия отслеживает основную линию MACD на выбранном таймфрейме
и ищет фигуры двойная вершина/двойное дно. Когда второй экстремум оказывается слабее первого при сохранении значения MACD
за пределами порогового уровня, открывается рыночная сделка в расчёте на разворот. Защитные приказы полностью повторяют
исходные 100 пунктов стоп-лосса и 300 пунктов тейк-профита.

## Правила торговли

1. Подписаться на выбранные свечи (по умолчанию 30 минут) и рассчитать линию MACD с периодами 5, 13 и 1.
2. Хранить три последних завершённых значения MACD. Медвежий сценарий активируется, когда MACD держится выше
   `TriggerLevel`, формирует локальный максимум и начинает снижаться. Сигнал подтверждается, если следующий максимум MACD
   ниже сохранённого. В этот момент отправляется рыночная продажа.
3. Бычиий сценарий зеркален: при значении MACD ниже `-TriggerLevel`, формировании впадины и последующей более высокой
   впадине открывается покупка.
4. При возвращении MACD в диапазон `[-TriggerLevel, TriggerLevel]` накопленные экстремумы сбрасываются, как и в оригинальном
   советнике.
5. Объём позиции задаётся параметром `TradeVolume`. При смене направления стратегия сначала закрывает противоположный объём,
   а затем открывает новую сделку.
6. Метод `StartProtection` запускается один раз при старте, чтобы стоп-лосс и тейк-профит в 100 и 300 пунктов
   поддерживались платформой автоматически.

## Параметры

| Имя | Описание |
| --- | -------- |
| `FastPeriod` | Быстрый период EMA в MACD. |
| `SlowPeriod` | Медленный период EMA в MACD. |
| `SignalPeriod` | Период сглаживания сигнальной линии MACD. |
| `TriggerLevel` | Абсолютный уровень MACD, необходимый для активации поиска фигур. |
| `StopLossPips` | Размер стоп-лосса в пунктах (по умолчанию 100). |
| `TakeProfitPips` | Размер тейк-профита в пунктах (по умолчанию 300). |
| `TradeVolume` | Базовый объём рыночной заявки. |
| `CandleType` | Тип свечей, используемый для расчётов индикатора. |

## Примечания

- Перед передачей в `StartProtection` значения стопа и тейка пересчитываются из пунктов в шаги инструмента.
- Все комментарии в исходном коде стратегии написаны на английском языке в соответствии с требованиями репозитория.
