# ACB2 策略

## 概述
该策略复刻了 MetaTrader 专家顾问 **ACB2**，它是一个诊断工具，而不是交易机器人。策略会在选定的 K 线周期（默认 M1）内监控 tick 活动，并输出详细报表，比较本地累计的 tick 数量与数据提供方报告的 tick 成交量。移植到 StockSharp 后，所有提醒仍通过 `AddInfoLog` 输出，因此可以无缝接入任何日志通道或通知系统。

## 参数
- **Candle Type** – 用于定义监控区间的时间框架。默认值为 M1，只要基于 `TimeFrameCandleMessage` 的自定义周期都可以使用。

## 监控流程
1. 启动时，策略会同时订阅：
   - 指定时间框架的 K 线，以获取当前和上一根 K 线的开盘时间以及 tick 成交量；
   - tick 数据流，用来响应每一笔成交更新。
2. 首个 K 线快照用于把内部计数器与已累计的 tick 成交量对齐。随后立刻打印一次 `"Start"` 日志，对应原脚本中的 `Alert("Start")`。
3. 后续每个 tick 到达时执行以下步骤：
   - 通过将服务器时间对齐到所选时间框架，判定该 tick 属于当前区间还是开启了新的区间；
   - 如果仍在当前区间，增加本地 tick 计数；如果开始新的区间，则把上一段的计数移动到 `Frame 1`，把当前计数重置为 1，并记录一条 "Frame 0 closed" 信息，其中包含上一段的开盘时间、本地计数和来自 K 线订阅的 tick 成交量；
   - 使用最新的 K 线快照刷新缓存的提供方数据，以便在报表中暴露本地统计与外部源之间的差异。
4. 完成逐 tick 处理后输出一行汇总信息，格式与原策略一致，内容包括：
   - 品种代码与时间框架标签；
   - 当前区间的开盘时间、从开盘起经过的秒数、本地计数以及提供方的 tick 成交量；
   - 上一段区间的开盘时间、本地计数和提供方的 tick 成交量。

## 日志类型
策略会产生三类日志：
- `Start` – 表示已经与 K 线订阅完成同步；
- `Frame 0 closed: ...` – 在新的区间开始时输出，对上一段进行总结；
- `<symbol> <timeframe>: Frame 0 ...` – 每个 tick 都会输出一次，实时展示当前和上一段的计数与成交量。

所有内容均通过 `AddInfoLog` 写入，能够立即在 StockSharp 日志窗口和任何外部监听器中查看。

## 实现说明
- 策略仅采集诊断数据，不会创建订单或修改投资组合。
- tick 成交量优先来自 `ICandleMessage.TotalTicks`，若数据源只提供成交量，则回退使用 `TotalVolume` 或 `Volume`。
- 内部仅维护两个滚动区间，不会构建额外集合，以满足转换规范。
- 当外部数据源暂未送达新的 tick 成交量时，会临时使用本地计数确保日志保持一致。
- 辅助方法 `DescribeDataType` 会把时间框架转换成紧凑标签（如 M1、H1），方便阅读诊断信息。
