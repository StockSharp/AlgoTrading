# Стратегия Cash Machine 5min

## Обзор
Стратегия является прямой конвертацией экспертного советника **CashMachine 5min** из MQL в высокоуровневый API StockSharp. Она рассчитана на пятиминутные свечи и комбинирует индикатор DeMarker с фильтром по пересечению стохастика. Управление позицией строится на скрытых уровнях стоп-лосса и тейк-профита, а также на каскадном трейлинге, который стремится зафиксировать прибыль при развитии импульса.

## Торговая логика
### Условия входа
- **Покупка**: предыдущее значение DeMarker ниже 0.30, текущее значение выше или равно 0.30, и одновременно %K стохастика пересекает уровень 20 снизу вверх. Открытых позиций быть не должно.
- **Продажа**: предыдущее значение DeMarker выше 0.70, текущее значение ниже или равно 0.70, и %K стохастика пересекает уровень 80 сверху вниз. Открытых позиций быть не должно.

### Сопровождение позиции
- Одновременно удерживается только одна позиция; противоположные сигналы игнорируются до закрытия текущей сделки.
- Скрытые уровни закрывают позицию при достижении ценой отметок `Entry ± HiddenStopLoss` или `Entry ± HiddenTakeProfit` (значения задаются в пунктах).
- Три промежуточные цели (`TargetTp1/2/3`) сдвигают скрытый трейлинг-стоп на `текущая цена - (target - 13)` пунктов для покупок и `текущая цена + (target + 13)` пунктов для продаж. Дополнительные 13 пунктов повторяют оригинальную логику, фиксируя прибыль после каждого этапа без немедленного выхода.
- После активации трейлинг-стопа позиция закрывается по рынку при его пробитии.

## Индикаторы
- **DeMarker** — отслеживает развороты импульса; длина соответствует исходному периоду усреднения.
- **Stochastic Oscillator** — использует оригинальные значения периода %K (`StochasticLength`), сглаживания %K (`StochasticK`) и сглаживания %D (`StochasticD`).

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `HiddenTakeProfit` | Расстояние скрытого тейк-профита в пунктах. | 60 |
| `HiddenStopLoss` | Расстояние скрытого стоп-лосса в пунктах. | 30 |
| `TargetTp1` | Первый уровень активации трейлинга (пункты). | 20 |
| `TargetTp2` | Второй уровень активации трейлинга (пункты). | 35 |
| `TargetTp3` | Третий уровень активации трейлинга (пункты). | 50 |
| `DeMarkerLength` | Период усреднения DeMarker. | 14 |
| `StochasticLength` | Расчётный период %K стохастика. | 5 |
| `StochasticK` | Сглаживание %K. | 3 |
| `StochasticD` | Сглаживание %D. | 3 |
| `CandleType` | Тип свечей для расчётов (по умолчанию 5 минут). | Таймфрейм 5 минут |

## Примечания
- Размер пункта вычисляется из `Security.PriceStep`. Если шаг цены неизвестен, используется значение по умолчанию `0.0001`, что соответствует логике советника для котировок с 3 и 5 знаками.
- Все решения принимаются по закрытым свечам. В оригинале алгоритм работал на каждом тике, поэтому внутридневное поведение может немного отличаться.
- Объём заявки управляется стандартным свойством `Strategy.Volume` в StockSharp.
