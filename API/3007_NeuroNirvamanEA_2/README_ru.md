# Neuro Nirvaman EA 2

## Обзор
Neuro Nirvaman EA 2 — это переработанная под StockSharp версия одноимённого советника из MetaTrader 5. Стратегия строится на трёхслойной системе перцептронов, которая объединяет четыре Laguerre-фильтра +DI и два детектора SilverTrend. Каждый завершённый бар пересчитывает выходы перцептронов, после чего модуль supervisor принимает решение об открытии позиции согласно выбранному режиму `Pass`. Сделки допускаются только внутри заданного торгового окна, по его завершении позиции принудительно закрываются.

## Индикаторы и сигналы
- **Laguerre +DI** — каждый блок получает линию +DI индикатора ADX и сглаживает её фильтром Laguerre с γ = 0.764. Значение колеблется в диапазоне [0;1] и сравнивается с центральным уровнем 0.5 и пользовательским отступом.
- **SilverTrend** — два канала SilverTrend рассчитывают динамические уровни поддержки/сопротивления по последним девяти барам. Параметр риска изменяет ширину коридора (`K = 33 - risk`). Изменение направления канала формирует сигнал ±1, поступающий на вход перцептронов.

## Торговая логика
1. **Перцептрон №1**: сочетает «напряжение» от Laguerre #1 и breakout-сигнал SilverTrend #1. Веса `X11` и `X12` уменьшаются на 100 — как и в оригинальном коде.
2. **Перцептрон №2**: аналог первой модели, но использует Laguerre #2 и SilverTrend #2 с весами `X21` и `X22`.
3. **Перцептрон №3**: суммирует напряжения Laguerre #3 и Laguerre #4 с весами `X31` и `X32`.
4. **Supervisor (`Pass`)**:
   - `1` — торгует только сигнал перцептрона №1 (значение < 0 — короткая позиция, иначе — длинная).
   - `2` — торгует по перцептрону №2 (значение > 0 — покупка, иначе — продажа).
   - `3` — открывает лонг при положительных значениях перцептронов №3 и №2; открывает шорт, если перцептрон №3 ≤ 0 и перцептрон №1 < 0.
   - `4` — режим защиты: сделки не совершаются (соответствует стандартной настройке советника).

При входе стратегия отправляет рыночную заявку фиксированного объёма и запоминает уровни стоп-лосса и тейк-профита в шагах цены. На каждом завершённом баре проверяется, достиг ли максимум/минимум этих уровней; при срабатывании позиция закрывается. Выход за границы торгового окна также приводит к закрытию.

## Параметры
| Параметр | Описание |
| --- | --- |
| `Risk1`, `Risk2` | Риск-параметры SilverTrend: чем выше значение, тем уже канал и чаще сигналы. |
| `LaguerreXPeriod` | Длина ADX, из которого берётся линия +DI для соответствующего фильтра Laguerre. |
| `LaguerreXDistance` | Процентный отступ от центра 0.5, определяющий границы зоны перекупленности/перепроданности. |
| `X11`, `X12`, `X21`, `X22`, `X31`, `X32` | Веса перцептронов (внутри формулы из значения вычитается 100). |
| `TakeProfit1`, `StopLoss1`, `TakeProfit2`, `StopLoss2` | Размеры тейк-профита и стоп-лосса в шагах цены для соответствующих сигналов. |
| `Pass` | Режим supervisor (1–4). |
| `TradeVolume` | Базовый объём заявки. |
| `StartHour`, `StartMinute`, `EndHour`, `EndMinute` | Границы торговой сессии; вне окна сделки не открываются, позиции закрываются. |
| `CandleType` | Тип свечей, по которым работает стратегия. |

## Управление рисками
Используются только фиксированные стоп-лосс и тейк-профит; усреднение и наращивание позиции отсутствуют. Одновременно может быть открыта лишь одна позиция. При выходе цены за уровни защиты или при окончании торговой сессии сделка закрывается.

## Примечания
- Значение γ для фильтра Laguerre зафиксировано на 0.764, как в исходном индикаторе.
- Режим `Pass = 4` полностью блокирует торговлю и служит защитной настройкой по умолчанию.
- Расчёт SilverTrend выполнен через стандартные индикаторы Highest/Lowest/SMA, что соответствует требованиям StockSharp и избавляет от ручного управления буферами.
