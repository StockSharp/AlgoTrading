# Neuro Nirvaman EA 2

## 概述
Neuro Nirvaman EA 2 源自 MetaTrader 5 的神经网络策略，核心思路是将四条 Laguerre 平滑的 +DI 曲线与两个 SilverTrend 突破信号组合成三层感知器。每根完成的 K 线都会重新计算三个感知器输出，并由 supervisor 选择在当前 `Pass` 模式下应该执行的信号。策略只会在设定的交易时段内开仓，并在时段结束时强制平仓。

## 指标与信号
- **Laguerre +DI 过滤器**：每个 Laguerre 模块对 ADX 指标的 +DI 值进行 Laguerre 平滑（gamma = 0.764），输出位于 0 到 1 之间，再与 0.5 中心线及自定义距离阈值比较，从而给出多空张力判断。
- **SilverTrend 突破**：两个 SilverTrend 探测器使用最近 9 根 K 线的最高价和最低价构建动态包络，风险参数通过公式 `K = 33 - risk` 调整带宽。一旦价格突破包络并改变趋势，就产生 ±1 的信号输入到感知器。

## 交易逻辑
1. **感知器 #1**：使用 Laguerre #1 产生的张力信号与 SilverTrend #1 的突破信号，权重由 `X11` 与 `X12` 控制（内部会减去 100，与原始 EA 一致）。
2. **感知器 #2**：结构与第一层相同，但使用 Laguerre #2 与 SilverTrend #2，对应权重为 `X21` 与 `X22`。
3. **感知器 #3**：仅对 Laguerre #3 与 Laguerre #4 的张力信号做加权组合，权重分别为 `X31` 与 `X32`。
4. **Supervisor (`Pass`) 模式**：
   - `1`：只使用感知器 #1，输出 < 0 开空，否则开多。
   - `2`：只使用感知器 #2，输出 > 0 开多，否则开空。
   - `3`：当感知器 #3 和 #2 同时为正时开多；当感知器 #3 ≤ 0 且感知器 #1 < 0 时开空。
   - `4`：禁止交易（保持与原始 EA 的默认保护行为一致）。

下单时使用固定手数的市价单，并根据触发感知器配置的止盈止损（以价格跳动为单位）记录目标位。每根完成的 K 线都会检测最高/最低是否触及这些目标，若满足条件立即平仓；当时间超出交易时段时也会强制退出。

## 参数
| 参数 | 说明 |
| --- | --- |
| `Risk1`, `Risk2` | SilverTrend 风险系数，数值越大包络越窄，信号越频繁。 |
| `LaguerreXPeriod` | 四条 Laguerre +DI 滤波器使用的 ADX 周期。 |
| `LaguerreXDistance` | 相对 0.5 中轴的百分比阈值，用于判定张力多空。 |
| `X11`, `X12`, `X21`, `X22`, `X31`, `X32` | 感知器权重（内部会减 100，以复刻 MQL 版本）。 |
| `TakeProfit1`, `StopLoss1`, `TakeProfit2`, `StopLoss2` | 各感知器对应的止盈/止损距离，单位为价格跳动。 |
| `Pass` | Supervisor 模式选择（1–4）。 |
| `TradeVolume` | 下单使用的基础手数。 |
| `StartHour`, `StartMinute`, `EndHour`, `EndMinute` | 允许交易的时间窗口，窗口外会平仓并禁止新单。 |
| `CandleType` | 驱动策略的 K 线订阅类型。 |

## 风险管理
策略完全依赖固定止盈止损，不加仓、不摊平，每次最多只持有一笔仓位。若时间超过交易窗口或价格触发目标，都会立即退出，确保风险可控。

## 备注
- Laguerre 平滑的 gamma 固定为 0.764，与原始指标一致。
- `Pass = 4` 会让策略保持空仓，是原版 EA 的默认安全设置。
- SilverTrend 计算使用 Highest、Lowest 与 SMA 等现成指标，避免手写缓存，符合 StockSharp 的实现规范。
