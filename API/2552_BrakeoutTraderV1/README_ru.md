# Brakeout Trader v1
[English](README.md) | [中文](README_cn.md)

Brakeout Trader v1 — это простая стратегия пробоя фиксированного уровня. Алгоритм отслеживает закрытия сформированных свечей и открывает позицию, когда цена закрытия пробивает заданный уровень. Закрытие выше уровня (при включенных покупках) запускает длинную позицию, закрытие ниже уровня (при включенных продажах) инициирует короткую. Размер позиции рассчитывается из заданного процента риска и расстояния до стоп-лосса, что позволяет автоматически масштабировать объём относительно капитала счёта.

## Логика торговли
- Обрабатываются только завершённые свечи выбранного таймфрейма `CandleType`. Формирующиеся свечи игнорируются.
- Алгоритм хранит последнее значение закрытия, чтобы обнаружить пробой пользовательского уровня `BreakoutLevel`.
- **Вход в лонг**: текущая свеча закрылась выше `BreakoutLevel`, а предыдущая — на уровне или ниже него. Дополнительно должен быть разрешён параметр `EnableLong`. При наличии открытого шорта он полностью закрывается перед формированием новой заявки.
- **Вход в шорт**: текущая свеча закрылась ниже `BreakoutLevel`, а предыдущая — на уровне или выше него. Параметр `EnableShort` должен быть включён. Любая длинная позиция закрывается заранее.
- Заявки отправляются по рынку. Количество рассчитывается таким образом, чтобы потенциальный убыток между ценой входа и стоп-лоссом соответствовал `RiskPercent` от текущей стоимости портфеля. Если рассчитать объём по риску невозможно, используется базовое значение `Volume`.
- После открытия фиксируются уровни стоп-лосса и тейк-профита в пипсах (`StopLossPoints` и `TakeProfitPoints`). При достижении любого уровня позиция закрывается по рынку, а кэшированные значения очищаются.
- Одновременных сделок в одну сторону не возникает: стратегия всегда управляет чистой позицией и закрывает противоположные позиции перед разворотом.

## Управление позицией
- Защитный стоп для лонга располагается ниже входа, для шорта — выше. Расстояние вычисляется как `StopLossPoints * pip`, где `pip` берётся из `Security.PriceStep` с поправкой на точность (для инструментов с 3 или 5 знаками после запятой используется множитель 10 — аналогично оригинальному эксперту MQL).
- Тейк-профит устанавливается симметрично по параметру `TakeProfitPoints`.
- Если в пределах одной свечи возможны одновременные срабатывания стопа и тейка, сначала проверяется стоп-лосс, что повторяет консервативную серверную последовательность.
- Сигнал в противоположном направлении всегда сначала закрывает текущую позицию, исключая хеджевые конфигурации.
- Вспомогательные значения автоматически сбрасываются, как только позиция становится нулевой.

## Параметры
- `BreakoutLevel` – фиксированный уровень цены, на пробой которого реагирует стратегия.
- `EnableLong` / `EnableShort` – флаги, разрешающие входы в лонг или шорт.
- `StopLossPoints` – расстояние стоп-лосса в пипсах (в шагах цены с учётом пересчёта pip).
- `TakeProfitPoints` – расстояние тейк-профита в пипсах.
- `RiskPercent` – доля капитала, которую допускается потерять в одной сделке; используется для расчёта объёма по стоп-лоссу.
- `CandleType` – тип свечей, по которым формируются сигналы (по умолчанию 15-минутные).
- `Volume` – базовый объём ордера, применяемый, если расчёт по риску недоступен.

## Подробности
- **Условия входа**: закрытие свечи пересекает `BreakoutLevel` сверху вниз или снизу вверх.
- **Направление**: поддерживаются обе стороны рынка, регулируемые флагами `EnableLong` и `EnableShort`.
- **Условия выхода**: срабатывание стоп-лосса/тейк-профита или появление обратного пробоя.
- **Стопы**: фиксированное расстояние от цены входа, измеренное в пипсах.
- **Параметры по умолчанию**: `BreakoutLevel = 0`, `StopLossPoints = 140`, `TakeProfitPoints = 180`, `RiskPercent = 10`, `CandleType = 15 минут`, `EnableLong = EnableShort = true`.
- **Фильтры**: дополнительных фильтров нет, кроме направления.

## Рекомендации по использованию
- Используйте инструменты с корректной настройкой шага цены. Для символов с 3 или 5 знаками после запятой pip автоматически умножается на 10.
- Убедитесь, что подключённый портфель возвращает `CurrentValue`, иначе объём будет рассчитываться по базовому `Volume`.
- Так как заявки исполняются по рынку, фактическая цена входа может отличаться от закрытия свечи. При необходимости увеличьте дистанции стопа/тейка для компенсации проскальзывания.
