# Стратегия iVIDyA Simple

## Обзор
Эта стратегия представляет собой порт советника MetaTrader **«iVIDyA Simple»** на высокоуровневый API StockSharp. Она работает с одним инструментом, отслеживая переменное среднее VIDYA, которое адаптируется к рыночному импульсу с помощью осциллятора Чанде. Когда последняя завершённая свеча пересекает смещённую линию VIDYA, стратегия открывает рыночную позицию в сторону пробоя и при необходимости добавляет защитные стоп-лосс и тейк-профит.

## Логика торговли
1. Используются свечи таймфрейма, заданного параметром `CandleType`.
2. Осциллятор Чанде (`CmoPeriod`) привязывается к серии свечей. Его модуль изменяет коэффициент сглаживания VIDYA, базовое значение которого равно `2 / (EmaPeriod + 1)` — как в оригинале.
3. На каждой завершённой свече стратегия:
   - Выбирает тип цены (`AppliedPrice`) из свечи (close, open, median и т. д.).
   - Пересчитывает значение VIDYA с адаптивным коэффициентом.
   - Сохраняет историю VIDYA, чтобы повторить поведение параметра `ma_shift` в MetaTrader.
4. Текущая свеча сравнивается со значением VIDYA, смещённым на `MaShift` баров назад:
   - Если свеча открылась ниже VIDYA и закрылась выше, формируется сигнал **покупки**.
   - Если свеча открылась выше VIDYA и закрылась ниже, формируется сигнал **продажи**.
5. Перед входом в сделку стратегия закрывает противоположную позицию, доводя итоговый объём до требуемого значения.
6. После открытия позиции вызываются `SetStopLoss` и `SetTakeProfit`, если соответствующие дистанции больше нуля.

Таким образом воспроизводится исходный советник, который работал только по новым барам, рассчитывал VIDYA через CMO и EMA и использовал стопы в пунктах.

## Параметры
| Имя | Значение по умолчанию | Описание |
|-----|-----------------------|----------|
| `Volume` | `1` | Базовый торговый объём. При реверсе стратегия автоматически перекрывает существующую позицию. |
| `StopLossPoints` | `150` | Размер стоп-лосса в шагах цены. `0` — отключить. |
| `TakeProfitPoints` | `460` | Размер тейк-профита в шагах цены. `0` — отключить. |
| `CmoPeriod` | `15` | Период осциллятора Чанде, определяющий адаптивный вес VIDYA. |
| `EmaPeriod` | `12` | Период EMA, задающий базовый коэффициент сглаживания в формуле VIDYA. |
| `MaShift` | `1` | Количество завершённых свечей для смещения линии VIDYA вперёд (аналог `ma_shift`). |
| `AppliedPrice` | `Close` | Тип цены для расчёта VIDYA (`Close`, `Open`, `High`, `Low`, `Median`, `Typical`, `Weighted`). |
| `CandleType` | `TimeSpan.FromMinutes(5)` | Тип и таймфрейм свечей для анализа и сигналов. |

## Дополнительные сведения
- Защитные ордера устанавливаются через высокоуровневые методы `SetStopLoss` и `SetTakeProfit`, тогда как в MQL коде проверялись уровни freeze/stops вручную.
- Стратегия обрабатывает только завершённые свечи, полностью повторяя условие «нового бара» из MetaTrader.
- История VIDYA автоматически обрезается, поэтому потребление памяти остаётся низким даже при большом `MaShift`.
- Все комментарии в коде оставлены на английском языке в соответствии с требованиями проекта.
