# Стратегия Caudate X Period Candle TM Plus

## Общее описание
Стратегия повторяет логику советника Caudate X Period Candle TM Plus. Для каждой свечи вычисляются сглаженные значения открытия, максимума, минимума и закрытия выбранным типом скользящей средней. На основе сглаженного диапазона Donchian стратегия присваивает завершённой свече один из шести цветовых кодов, характеризующих положение тела внутри диапазона. Коды **0/1** (бычий нижний хвост) открывают длинные позиции, коды **5/6** (медвежий верхний хвост) открывают короткие, противоположные группы закрывают уже открытые сделки.

## Правила торговли
1. Подписаться на свечи указанного таймфрейма и сгладить каждую компоненту OHLC выбранной средней.
2. Рассчитать максимум и минимум сглаженных экстремумов за `Donchian Period`, затем расширить диапазон так, чтобы он всегда содержал сглажённые открытие и закрытие.
3. Определить цвет свечи:
   * **0/1** – тело возле верхней границы диапазона (нижний хвост).
   * **2/4** – тело в центре диапазона.
   * **5/6** – тело возле нижней границы диапазона (верхний хвост).
4. Использовать цвет бара со смещением `Signal Bar` (по умолчанию `1`, то есть предыдущая завершённая свеча).
5. Открывать позиции, если цвет относится к группе входа и противоположная позиция отсутствует.
6. Закрывать позиции при попадании цвета в группу выхода либо по истечении максимального времени удержания.
7. При ненулевых дистанциях стоп-лосса и тейк-профита стратегия вызывает `StartProtection`, формируя защитные заявки.

## Параметры
| Параметр | Описание |
| --- | --- |
| `Candle Type` | Таймфрейм, по которому рассчитываются сигналы. |
| `Donchian Period` | Длина окна для сглаженного диапазона максимумов и минимумов. |
| `Signal Bar` | На сколько баров сдвигается оценка цвета (0 — текущая свеча). |
| `Smoothing Method` | Тип сглаживания OHLC (SMA, EMA, SMMA, LWMA, аппроксимация Jurik JJMA, Kaufman AMA). |
| `MA Length` | Длина фильтра сглаживания. |
| `MA Phase` | Зарезервировано для совместимости с JJMA (в текущей реализации не используется). |
| `Enable Long/Short Entries` | Разрешение на открытие длинных/коротких позиций. |
| `Enable Long/Short Exits` | Разрешение на закрытие длинных/коротких позиций по сигналу. |
| `Enable Time Exit` | Включение ограничения по времени удержания. |
| `Time Exit (minutes)` | Максимальное время удержания позиции в минутах. |
| `Stop Loss (points)` | Расстояние стоп-лосса в шагах цены. |
| `Take Profit (points)` | Расстояние тейк-профита в шагах цены. |

## Примечания
- Значение `Signal Bar = 1` совпадает с поведением оригинального советника и использует последнюю завершённую свечу.
- При ненулевых стопах/целях `StartProtection` рассчитывает абсолютные цены с учётом `Security.PriceStep`.
- Параметр `MA Phase` сохранён для совместимости, но не влияет на стандартные реализации скользящих сред StockSharp.
- Базовый объём заявок задаётся через свойство `Strategy.Volume`; перед открытием новой позиции стратегия закрывает противоположную.
