# ChannelEA2 策略

## 概述
ChannelEA2 策略在 StockSharp 中复刻 MetaTrader 专家顾问 “ChannelEA2”。策略会在配置的会话开始与结束时间之间构建日内价格通道。当会话结束时，它会在通道上沿上方和下沿下方挂入场止损单，每个止损单的保护止损价都设置为通道的另一侧边界。此方法旨在捕捉会话期间盘整后的突破行情。

## 交易逻辑
- 当第一根完成的 K 线开盘时间跨越 `BeginHour` 时，策略会重置当日会话：
  - 使用市价单平掉所有持仓。
  - 取消所有活动订单（包括上一轮的入场止损单以及保护止损单）。
  - 使用会话内第一根 K 线初始化通道的最高价和最低价。
- 在会话运行期间（从 `BeginHour` 到 `EndHour`），每根完成的 K 线都会更新通道的最高价和最低价。
- 在会话结束后的第一根 K 线开盘时（`EndHour` 之后），策略会：
  - 在会话最高价之上（可选价差缓冲）挂出买入止损单；
  - 在会话最低价之下（同样的缓冲）挂出卖出止损单；
  - 买入订单的保护止损设为会话最低价，卖出订单的保护止损设为会话最高价。
- 一旦有方向被触发形成持仓，策略会取消相反方向的入场订单，并根据记录的止损价注册保护止损单。
- 这些订单会一直保留到下一次会话开始时，届时所有仓位和订单都会被重新清理。

## 参数
| 名称 | 描述 | 默认值 |
| --- | --- | --- |
| `BeginHour` | 会话重置并开始收集数据的小时（0-23）。 | `1` |
| `EndHour` | 安排挂入止损单的小时（0-23），当 `BeginHour > EndHour` 时可跨夜。 | `10` |
| `TradeVolume` | 每笔入场订单使用的成交量。 | `1` |
| `CandleType` | 构建通道所用的 K 线类型（默认 1 小时）。 | `1 小时` |
| `StopBufferMultiplier` | 以价格最小变动为单位的缓冲倍数，用于入场触发价和保护止损。 | `2` |

## 风险控制
- 策略会自动调用 `StartProtection()`，让 StockSharp 处理意外持仓。
- 保护止损单会在出现持仓后立即提交，当仓位归零时自动取消。
- 止损价格会按照 `StopBufferMultiplier * PriceStep` 偏移，避免触犯交易所的最小止损距离限制。

## 其他说明
- 一旦生成入场止损单，通道高低值会被冻结，直到下一次会话开始才重新计算。
- 如果标的没有定义 `PriceStep`，则缓冲忽略，止损单直接挂在通道价格。
- `TradeVolume` 支持小数，方便在允许的市场中使用分数手或手数。
- 策略会在图表区域绘制 K 线和成交记录，便于可视化跟踪。
