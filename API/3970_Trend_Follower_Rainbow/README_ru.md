# Стратегия Trend Follower Rainbow

## Обзор
Trend Follower Rainbow — порт советника MetaTrader 4 «TrendFollowerRainbowMethodkyast773» на C#. Стратегия использует несколько уровней подтверждения, чтобы торговать в направлении сильного тренда и избегать флэта. Входы формируются комбинацией перекрёста EMA, подтверждения MACD, гистограммы Лагерра, фильтра Money Flow Index и строгой структуры «радужных» скользящих средних.

## Логика торговли
1. **Торговое окно** – сигналы анализируются только тогда, когда время закрытия свечи строго между заданными часами начала и окончания. Это повторяет фильтр оригинального советника, пропускавшего крайние часы сессии.
2. **Пересечение EMA** – для покупки быстрая EMA (по умолчанию 4) должна пересечь снизу вверх медленную EMA (по умолчанию 8). Для продажи требуется обратное пересечение.
3. **Подтверждение MACD** – значения MACD и сигнальной линии (по умолчанию 5/35/5) должны быть одновременно выше нуля для сделок на покупку и ниже нуля для сделок на продажу.
4. **Фильтр Лагерра** – значение индикатора обязано пересечь вверх порог 0,15, чтобы разрешить лонг, и пересечь вниз 0,75, чтобы разрешить шорт.
5. **Структура радуги** – пять пакетов экспоненциальных скользящих (по четыре EMA в каждом) должны быть упорядочены: для лонга — невозрастающе, для шорта — неубывающе. Это имитирует состояние RainbowMMA индикаторов.
6. **Фильтр MFI** – индикатор Money Flow Index (период 14) должен находиться ниже 40 для покупок и выше 60 для продаж, чтобы не идти против потока капитала.
7. **Управление позицией** – используются рыночные ордера. При появлении противоположного сигнала текущая позиция закрывается и открывается новая в обратном направлении.

## Управление рисками
Стратегия применяет `StartProtection` из StockSharp:
- **Take Profit** и **Stop Loss** задаются в шагах цены, как в оригинальном советнике.
- **Trailing Stop** также указывается в шагах и активируется сразу после запуска защиты.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `OrderVolume` | Базовый объём заявки. | 1 |
| `TakeProfitPoints` | Дистанция до тейк-профита в шагах цены. | 17 |
| `StopLossPoints` | Дистанция до стоп-лосса в шагах цены. | 30 |
| `TrailingStopPoints` | Дистанция до трейлинг-стопа в шагах цены. | 45 |
| `TradingStartHour` | Час (включительно), до которого сигналы игнорируются. | 1 |
| `TradingEndHour` | Час (включительно), начиная с которого сигналы игнорируются. | 23 |
| `FastEmaLength` | Период быстрой EMA. | 4 |
| `SlowEmaLength` | Период медленной EMA. | 8 |
| `MacdFastLength` | Период быстрой EMA в MACD. | 5 |
| `MacdSlowLength` | Период медленной EMA в MACD. | 35 |
| `MacdSignalLength` | Период сигнальной EMA в MACD. | 5 |
| `LaguerreGamma` | Коэффициент сглаживания фильтра Лагерра. | 0.7 |
| `LaguerreBuyThreshold` | Порог для открытия лонга. | 0.15 |
| `LaguerreSellThreshold` | Порог для открытия шорта. | 0.75 |
| `MfiPeriod` | Период Money Flow Index. | 14 |
| `MfiBuyLevel` | Максимальное значение MFI для лонга. | 40 |
| `MfiSellLevel` | Минимальное значение MFI для шорта. | 60 |
| `RainbowGroup{1..5}Base` | Базовые периоды пакетов радуги. Четыре EMA формируются добавлением смещений 0/2/4/6. | 5 / 13 / 21 / 34 / 55 |
| `CandleType` | Тип свечей, используемых стратегией (по умолчанию 5-минутные). | 5 минут |

## Визуализация
Стратегия автоматически рисует:
- свечи выбранного инструмента;
- быстрые и медленные EMA;
- кривую Лагерра;
- сделки стратегии.

## Примечания
- Реализация радуги основана на настраиваемых EMA и служит приближением оригинальных RainbowMMA индикаторов.
- Все комментарии и документация внутри кода даны на английском языке согласно требованиям.
- В рамках задачи создана только версия на C#; Python-реализация отсутствует.
