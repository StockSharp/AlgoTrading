# Стратегия EMA Cross Contest Hedged
[English](README.md) | [中文](README_cn.md)

Эта стратегия повторяет советник MetaTrader **EMA_CROSS_CONTEST_HEDGED** в среде StockSharp. Робот отслеживает пересечения быстрой и медленной экспоненциальных средних (EMA) и при необходимости фильтрует сигналы по MACD. После появления сигнала стратегия открывает рыночную позицию и выставляет каскад отложенных стоп-заявок, которые наращивают позицию при продолжении тренда.

## Логика торговли
- Рассчитываются короткая и длинная EMA на выбранных свечах. Сигналы могут рассчитываться по предыдущей свече (значение по умолчанию) либо по текущей свече после её закрытия.
- Фиксируется **бычье пересечение**, когда короткая EMA поднимается выше длинной, и **медвежье пересечение**, когда она опускается ниже.
- При включённом фильтре MACD требуется, чтобы линия MACD была выше нуля для покупок и ниже нуля для продаж.
- При бычьем условии совершается покупка по рынку, выставляются стоп-лосс и тейк-профит, а также четыре отложенные buy stop заявки с заданным шагом хеджирования.
- При медвежьем условии совершается продажа по рынку и выставляются симметричные sell stop заявки.
- Отложенные заявки отменяются после истечения времени жизни, если не были активированы.
- Трейлинг-стоп подтягивается при росте плавающей прибыли, а противоположное пересечение может преждевременно закрыть позицию при активном параметре `Use Close`.

## Параметры
- **Candle Type** – таймфрейм расчёта индикаторов.
- **Order Volume** – объём сделки и каждой хедж-заявки.
- **Take Profit (pips)** – расстояние тейк-профита в пунктах.
- **Stop Loss (pips)** – расстояние стоп-лосса в пунктах.
- **Trailing Stop (pips)** – расстояние трейлинг-стопа (0 отключает).
- **Hedge Level (pips)** – шаг между хеджирующими отложенными ордерами.
- **Use Close** – закрывать позицию при противоположном пересечении EMA.
- **Use MACD** – требовать подтверждение по MACD.
- **Expiration (s)** – время жизни отложенных ордеров в секундах.
- **Short EMA** – период быстрой EMA.
- **Long EMA** – период медленной EMA (должен быть больше, чем у быстрой).
- **Signal Bar** – выбор бара для сигнала: 0 – текущий, 1 – предыдущий.

## Примечания
- Все комментарии в коде оставлены на английском языке.
- Сетка отложенных заявок повторяет структуру оригинального советника и содержит четыре уровня.
- Пересчёт пунктов в цену учитывает `PriceStep` и количество знаков инструмента, чтобы соответствовать расчётам MetaTrader.
