# Стратегия up3x1 Krohabor D

## Обзор
**up3x1 Krohabor D** — это перенос эксперта MetaTrader 4 `up3x1_Krohabor_D.mq4` на платформу StockSharp. Стратегия использует три смещённых простых скользящих средних (SMA), чтобы выявлять продолжение тренда на выбранном таймфрейме. Реализация на C# применяет высокоуровневый API StockSharp с подпиской на свечи и привязкой индикаторов, а также адаптированные механизмы управления позицией и рисками.

## Логика торговли
- Рассчитываются три SMA по ценам закрытия:
  - Быстрая SMA (по умолчанию 24 бара)
  - Средняя SMA (по умолчанию 60 баров)
  - Медленная SMA (по умолчанию 120 баров)
- Каждая средняя сдвигается вперёд на заданное число завершённых свечей (по умолчанию 6), после чего сравниваются текущие и предыдущие значения.
- **Условия для покупки**:
  - Медленная SMA (текущая и предыдущая) остаётся ниже быстрых и средних средних, формируя восходящую структуру.
  - Средняя SMA опускается относительно быстрой (предыдущее значение выше, текущее ниже).
- **Условия для продажи** полностью зеркальны.
- В один момент времени открыта только одна позиция. При отсутствии открытых сделок стратегия ждёт сигнала, при наличии — управляет выходом.

## Правила выхода и защита
- Защитные ордера моделируются через анализ экстремумов свечей:
  - Стоп-лосс задаётся в ценовых шагах (по умолчанию 110 пунктов) и активируется сразу после входа.
  - Тейк-профит задаётся аналогично (по умолчанию 5 пунктов).
- Трейлинг-стоп (по умолчанию 10 пунктов) включается при достижении нужной прибыли и перемещает защитный уровень вслед за ценой.
- Если быстрая SMA пересекает среднюю и медленную в обратную сторону, позиция закрывается — так же, как в оригинальном советнике.
- После серии убыточных сделок объём новой позиции уменьшается пропорционально числу убытков, но не опускается ниже заданного минимума.

## Параметры
| Имя | Описание |
|-----|----------|
| `FastPeriod` | Период быстрой SMA. |
| `MediumPeriod` | Период средней SMA. |
| `SlowPeriod` | Период медленной SMA. |
| `MaShift` | Количество завершённых свечей для смещения индикаторов. |
| `Volume` | Базовый объём сделки. |
| `MinVolume` | Минимальный объём после уменьшения из-за убытков. |
| `LossReductionFactor` | Делитель, определяющий степень уменьшения объёма после серии убытков. |
| `StopLossPoints` | Стоп-лосс в ценовых шагах. |
| `TakeProfitPoints` | Тейк-профит в ценовых шагах. |
| `TrailingPoints` | Дистанция и порог для трейлинг-стопа в ценовых шагах. |
| `CandleType` | Тип/таймфрейм свечей для анализа. |

## Дополнения
- Используются методы `SubscribeCandles` и `Bind`, поэтому не требуется вручную запрашивать значения индикаторов.
- Защитные уровни реализованы внутри стратегии и могут быть заменены реальными ордерами при подключении к брокеру.
- Все комментарии в коде приведены на английском языке в соответствии с требованиями репозитория.
- Автоматические тесты отсутствуют — рекомендуем прогонять стратегию в тестере StockSharp с нужными параметрами.
