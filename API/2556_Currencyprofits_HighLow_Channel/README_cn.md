# Currencyprofits High-Low Channel 策略

## 概览
该策略是 MetaTrader 专家顾问 `Currencyprofits_01.1` 的 StockSharp 版本。策略通过一快一慢两条移动平均线确定趋势方向，并在价格回测最近通道的极值时入场。快线位于慢线之上时判定为多头环境，等待价格回到最近若干根 K 线的最低点；快线位于慢线之下时判定为空头环境，关注价格回测通道最高点以入场做空。

所有计算均基于收盘完成的 K 线执行，可同时用于回测和实时交易。

## 交易逻辑
1. 订阅指定的蜡烛类型，计算快/慢两条移动平均线以及由最近 `ChannelLength` 根 K 线构成的高低通道（默认 6 根）。
2. 保存上一根 K 线的指标值，以复刻原版 MQL 程序中使用的 1 根偏移逻辑。
3. **做多条件**：上一根快均线大于慢均线，且当前 K 线最低价触及或突破上一周期通道最低值。
4. **做空条件**：上一根快均线小于慢均线，且当前 K 线最高价触及或突破上一周期通道最高值。
5. **离场规则**：
   - 多头仓位在下一根 K 线收盘价高于保存的通道最高值时平仓，或触发止损价位时平仓。
   - 空头仓位在下一根 K 线收盘价低于保存的通道最低值时平仓，或触发止损价位时平仓。
6. 策略同一时间只持有一个方向的仓位，持仓期间新的信号不会执行。

## 风险控制
- `RiskPercent` 表示单笔交易可承担的账户资金比例（默认 `0.14`，即 14%）。
- 止损距离由 `StopLossPoints` 与标的物的 `PriceStep` 相乘得到；若没有步长信息则直接使用点数。
- 单合约的资金风险通过交易所步值 `StepPrice` 估算；如果该数据缺失，则退化为价格差值。
- 最终委托量会按照 `VolumeStep`、`MinVolume`、`MaxVolume` 等交易规则对齐。若无法计算风险仓位，则使用策略的默认 `Volume`。

## 参数
- `FastLength` —— 快速移动平均线周期（默认 32）。
- `FastMaType` —— 快速移动平均线类型（Simple、Exponential、Smoothed、Weighted）。
- `SlowLength` —— 慢速移动平均线周期（默认 86）。
- `SlowMaType` —— 慢速移动平均线类型。
- `PriceSource` —— 参与移动平均计算的蜡烛价格（默认收盘价）。
- `ChannelLength` —— 计算高低通道时使用的历史 K 线数量（默认 6）。
- `StopLossPoints` —— 止损距离（点数表示，默认 170）。
- `RiskPercent` —— 单笔交易的风险资金比例（默认 0.14 → 14%）。
- `CandleType` —— 用于计算的蜡烛类型/周期（默认 1 小时，可按需求调整）。

## 使用建议
- 启动前请填写 `PriceStep`、`StepPrice` 以及相关成交量约束，以确保仓位计算准确。
- 当 `RiskPercent = 0` 或不希望动态计算仓位时，请为策略设置合适的 `Volume` 作为回退值。
- 策略在确认的收盘 K 线后执行交易。
- 该实现不设独立的止盈，与原始专家顾问一致，通过止损和通道反向突破退出。

## 来源
基于 `MQL/17641/Currencyprofits_01.1.mq5` 转换，并使用 StockSharp 高阶 API 实现。
