# Стратегия Ten Points 3

## Общее описание
Стратегия представляет собой перенос классического советника MetaTrader 4 «10 points 3» на платформу StockSharp. Логика основана на мартингейле: направление цикла задаётся наклоном основной линии MACD, после чего позиции наращиваются при каждом движении цены против текущей корзины на заданное количество пунктов. Работа продолжается до достижения профит-цели либо до срабатывания защитных механизмов.

## Логика торговли
- Направление выбирается по знаку изменения основной линии MACD: рост значения означает покупки, падение — продажи. При необходимости интерпретацию можно инвертировать.
- Первая сделка открывается сразу после появления направления и проверки торгового календаря (допустимые годы и месяцы).
- Пока корзина активна, каждая неблагоприятная протяжка на `EntryDistancePips` пунктов приводит к открытию очередного мартингейл-ордера. Если `MaxTrades` больше 12, объём умножается на 1.5, иначе — на 2.
- Каждая новая сделка получает исходный стоп-лосс и тейк-профит на расстояниях `InitialStopPips` и `TakeProfitPips`. Для всей корзины поддерживаются агрегированные уровни защиты.
- После прохождения в прибыль `TrailingStopPips + EntryDistancePips` пунктов активируется трейлинг-стоп, который сопровождает цену на расстоянии `TrailingStopPips`.
- Когда число открытых сделок достигает `MaxTrades - OrdersToProtect`, модуль защиты счёта рассчитывает плавающий результат (с учётом валютных значений пункта). Если он превышает `SecureProfit`, последняя сделка закрывается и набор не пополняется до полного выхода из корзины.

## Управление капиталом
- Базовый объём можно фиксировать через `LotSize` или рассчитывать по оригинальной формуле, активируя `UseMoneyManagement`. При этом используется текущая стоимость портфеля и параметр `RiskPercent`. Отключив `IsStandardAccount`, можно имитировать мини-счёт.
- Рассчитанный объём ограничивается 100 лотами до применения мартингейл-множителей.

## Управление ордерами
- Входы выполняются рыночными заявками (`BuyMarket`/`SellMarket`).
- Защитные выходы исполняются рыночными ордерами при достижении стоп-лосса, трейлинг-стопа или тейк-профита.
- Функция защиты счёта закрывает только последнюю позицию (`_lastEntryVolume`), повторяя поведение оригинального советника.

## Параметры
| Параметр | Описание |
|----------|----------|
| `TakeProfitPips` | Дистанция тейк-профита для каждой сделки. |
| `LotSize` | Фиксированный объём без управления капиталом. |
| `InitialStopPips` | Исходное расстояние стоп-лосса. |
| `TrailingStopPips` | Дистанция трейлинг-стопа после активации. |
| `MaxTrades` | Максимальное количество сделок в корзине. |
| `EntryDistancePips` | Минимальное встречное движение для очередного входа. |
| `SecureProfit` | Требуемая плавающая прибыль (в деньгах) для запуска защиты счёта. |
| `UseAccountProtection` | Включает механику защиты счёта. |
| `OrdersToProtect` | Количество завершающих ступеней мартингейла, попадающих под защиту. |
| `ReverseSignals` | Инвертирует трактовку наклона MACD. |
| `UseMoneyManagement` | Включает расчёт объёма по балансу. |
| `RiskPercent` | Процент риска в формуле управления капиталом. |
| `IsStandardAccount` | Использовать стандартные, а не мини-лоты. |
| `EurUsdPipValue`, `GbpUsdPipValue`, `UsdChfPipValue`, `UsdJpyPipValue`, `DefaultPipValue` | Денежная стоимость пункта для расчёта плавающей прибыли. |
| `StartYear`, `StartMonth`, `EndYear`, `EndMonth` | Временные границы для запуска новой корзины. |
| `CandleType` | Таймфрейм свечей, по которым строится MACD и ведётся управление. |
| `MacdFastLength`, `MacdSlowLength`, `MacdSignalLength` | Параметры MACD. |

## Примечания
- В реализации используются высокоуровневые API StockSharp (`SubscribeCandles` + `BindEx`), при этом сохранены множители мартингейла и защитные правила оригинала.
- Расчёт плавающего PnL ведётся по агрегированной позиции, поэтому результаты могут незначительно отличаться от MetaTrader, где модифицируются отдельные заявки.
- Перед использованием на реальном счёте убедитесь, что параметры соответствуют спецификациям вашего контракта (шаг цены, стоимость пункта, размер лота).
