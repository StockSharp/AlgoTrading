# Стратегия Gazonkos Rollback

## Обзор
Стратегия Gazonkos Rollback является конверсией оригинального советника **gazonkos** для MetaTrader 5. Изначальная логика рассчитана на часовую диаграмму EUR/USD и ищет импульс между двумя прошлыми закрытиями. После фиксации сильного движения система ждёт отката заданной величины и входит в сторону первоначального импульса. Реализация на StockSharp сохраняет пошаговый автомат состояний исходного кода и использует высокоуровневый API со свечными подписками и защитными ордерами.

## Логика торговли
1. **Проверка допустимости** – в пределах одного часа открывается не более одной позиции. Если в текущем часовом интервале сделка уже была открыта либо достигнут лимит `ActiveTrades`, стратегия ничего не делает.
2. **Поиск импульса** – вычисляется разница закрытий двух прошлых свечей (`SecondShift` минус `FirstShift`). Если разница превышает `Delta`, фиксируется направление сделки (лонг при росте, шорт при падении).
3. **Отслеживание отката** – с момента появления импульса контролируется максимум (для лонга) либо минимум (для шорта), достигнутый в течение того же часа. Как только цена откатит на расстояние `Rollback`, сигнал подтверждается. При смене часа до наступления отката сигнал сбрасывается.
4. **Исполнение ордера** – после подтверждённого отката выставляется рыночный ордер с фиксированными значениями тейк-профита и стоп-лосса. Размер позиции задаётся параметром `TradeVolume`, а стопы автоматически управляются через `StartProtection`.

Такая последовательность полностью повторяет MT5-реализацию, где этапы контролировались переменными `STATE` и `Trade`.

## Управление рисками
* `StartProtection` задаёт тейк-профит и стоп-лосс в абсолютных ценовых шагах, как и в оригинальном советнике.
* `ActiveTrades` ограничивает суммарную позицию, сравнивая модуль текущей позиции с произведением торгового объёма на допустимое количество сделок.
* Ограничение по времени и обязательный откат защищают от избыточной торговли во флете.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `TakeProfit` | `0.0016` | Абсолютное расстояние до тейк-профита (эквивалент 16 пунктам для пятизначного EUR/USD). |
| `Rollback` | `0.0016` | Минимальный откат от экстремума после импульса. |
| `StopLoss` | `0.0040` | Абсолютное расстояние до защитного стоп-лосса (около 40 пунктов). |
| `Delta` | `0.0040` | Минимальная разница закрытий, при которой считается, что появился импульс. |
| `TradeVolume` | `0.1` | Базовый объём заявки для `BuyMarket()` и `SellMarket()`. |
| `FirstShift` | `3` | Более старая свеча (в барах назад) для расчёта разницы закрытий. |
| `SecondShift` | `2` | Более новая свеча для расчёта разницы закрытий. |
| `ActiveTrades` | `1` | Максимальное количество одновременно открытых сделок. Значение `0` снимает ограничение. |
| `CandleType` | Таймфрейм 1 час | Тип свечей, используемый в расчётах; по умолчанию соответствует исходному советнику. |

## Дополнительно
* Значения `Delta`, `Rollback`, `TakeProfit` и `StopLoss` нужно адаптировать под стоимость пункта выбранного инструмента.
* Все комментарии в коде даны на английском языке согласно требованиям репозитория.
* Python-версия стратегии пока не реализована.
