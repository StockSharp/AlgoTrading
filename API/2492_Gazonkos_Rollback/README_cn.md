# Gazonkos 回撤策略

## 概述
Gazonkos 回撤策略源自 MetaTrader 5 平台上的 **gazonkos** 专家顾问。本策略同样以 EUR/USD 小时级别为主要场景，通过比较两根历史 K 线的收盘价来寻找强势动量，并在出现预设幅度的回撤后顺势入场。StockSharp 版本沿用了原始 EA 的状态机流程，使用高级 API、蜡烛订阅以及保护性订单完成整个逻辑。

## 交易流程
1. **资格检查**：系统限定每个整点最多只开一笔新仓。如果当前小时已经有交易，或现有仓位数量达到 `ActiveTrades` 限制，则跳过本次信号。
2. **动量检测**：计算 `SecondShift` 与 `FirstShift` 两根历史 K 线收盘价的差值。差值超过 `Delta` 时，记录交易方向（最新收盘价更高时做多，反之做空）。
3. **回撤确认**：从动量产生的那一刻起，在同一个小时内监控最高价（做多）或最低价（做空）。当价格向相反方向回撤至少 `Rollback` 时，视为确认信号；如果在满足回撤之前小时发生改变，则信号作废。
4. **执行下单**：回撤成立后立即按记录的方向市价成交，并通过 `StartProtection` 设定固定的止盈和止损距离。下单手数由 `TradeVolume` 控制。

该流程与原始 MT5 程序中依靠 `STATE` 与 `Trade` 变量驱动的顺序完全一致。

## 风险控制
* `StartProtection` 在绝对价格单位内设置止盈/止损，与原策略一笔订单一组保护单的思路相同。
* `ActiveTrades` 根据当前净持仓与允许的最大仓位数量比较，限制总体风险敞口。
* 小时节奏加上回撤过滤可以减少盘整阶段的过度交易。

## 参数说明
| 名称 | 默认值 | 说明 |
| --- | --- | --- |
| `TakeProfit` | `0.0016` | 止盈距离，单位为绝对价格，约等于 16 个 5 位点。 |
| `Rollback` | `0.0016` | 信号确认所需的最小回撤幅度。 |
| `StopLoss` | `0.0040` | 止损距离，约等于 40 个点。 |
| `Delta` | `0.0040` | 判断动量的最小收盘价差值。 |
| `TradeVolume` | `0.1` | 市价单默认下单手数。 |
| `FirstShift` | `3` | 较早的历史 K 线索引（向前回溯的根数）。 |
| `SecondShift` | `2` | 较新的历史 K 线索引。 |
| `ActiveTrades` | `1` | 允许同时持有的最大交易数量，设为 0 表示不限制。 |
| `CandleType` | 1 小时 | 使用的蜡烛类型，默认等同于原始 EA 的小时线。 |

## 其他提示
* 请根据交易品种的点值调整 `Delta`、`Rollback`、`TakeProfit` 与 `StopLoss`。
* 代码中的注释均为英文，符合仓库规范。
* 当前未提供 Python 版本的实现。
