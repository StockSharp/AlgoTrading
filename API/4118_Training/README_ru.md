# Стратегия Training

## Общее описание
Стратегия воссоздаёт ручного советника «Training» из MetaTrader 4. В оригинале пользователь перетягивает подписи на графике выше или ниже порога, чтобы отправить рыночные заявки. В StockSharp те же действия реализованы через булевы параметры стратегии. Лёгкий таймер повторяет MQL-функцию `Control()`: он проверяет флаги, отправляет рыночные заявки, закрывает позиции и выводит обновлённую статистику в лог.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `OrderVolume` | Количество контрактов для каждой ручной команды. | `1` |
| `TakeProfitPoints` | Расстояние до тейк-профита в шагах цены. `0` отключает заявку. | `30` |
| `StopLossPoints` | Расстояние до стоп-лосса в шагах цены. `0` отключает заявку. | `30` |
| `RequestBuy` | Установите `true`, чтобы отправить рыночную покупку. После обработки флаг сбрасывается. | `false` |
| `RequestSell` | Установите `true`, чтобы отправить рыночную продажу. После обработки флаг сбрасывается. | `false` |
| `CloseBuy` | Установите `true`, чтобы закрыть открытую длинную позицию. Флаг сбрасывается даже при отсутствии позиции. | `false` |
| `CloseSell` | Установите `true`, чтобы закрыть открытую короткую позицию. Флаг сбрасывается даже при отсутствии позиции. | `false` |

## Логика работы
- Таймер с периодом 250 мс полностью повторяет цикл `Control()` из MQL.
- При установке `RequestBuy` или `RequestSell` стратегия отменяет защитные заявки, рассчитывает итоговый объём и отправляет рыночный ордер через `BuyMarket`/`SellMarket`.
- Флаги `CloseBuy` и `CloseSell` закрывают соответствующие позиции и удаляют защитные заявки.
- После исполнения входа выставляются стоп-лосс и тейк-профит через `SellStop`/`SellLimit` (для лонга) или `BuyStop`/`BuyLimit` (для шорта). Для конвертации пунктов в цены используется `Security.PriceStep`. Если шаг цены не задан, защитные заявки пропускаются, а в лог выводится предупреждение.
- При срабатывании защитного ордера второй ордер отменяется, как и в оригинальном советнике.
- Каждые пять секунд метод `AddInfoLog` публикует баланс портфеля, реализованный PnL и текущую позицию, заменяя вывод `Comment()` из MQL.

## Особенности конверсии
- Перетаскивание меток на графике заменено булевыми параметрами, так как в StockSharp нет готового API для обработки событий перетаскивания.
- Вызовы `OrderSend` заменены высокоуровневыми `BuyMarket`/`SellMarket`, что упрощает регистрацию ордеров и сводит хеджевые позиции к единой нетто-позиции.
- Пара стоп-лосс/тейк-профит реализована через соответствующие лимитные и стоповые заявки, полностью повторяя прикреплённые ордера из MQL.
- Очистка объектов `Delete_My_Obj` превращена в метод `CancelProtectionOrders`, который отменяет защитные заявки при возврате позиции к нулю.

## Рекомендации по использованию
1. Перед запуском заполните у инструмента `PriceStep` (и при необходимости `StepPrice`), чтобы корректно переводить пункты в цены.
2. Во время работы стратегии меняйте булевы параметры из UI или программно — это аналог перетаскивания кнопок.
3. При необходимости изменяйте `OrderVolume`, `TakeProfitPoints` и `StopLossPoints` заранее; таймер автоматически применит новые значения.
4. Отслеживайте периодические сообщения в логе платформы — они заменяют надписи на графике из исходного советника.
