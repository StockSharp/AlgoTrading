# Стратегия Bollinger Bands RSI
[English](README.md) | [中文](README_cn.md)

Стратегия перенесена из советника MetaTrader «Bollinger Bands RSI». Используются три полосы Боллинджера с одинаковым периодом и разными отклонениями: «желтая» (базовая), «синяя» (отклонение вдвое меньше) и «красная» (отклонение вдвое больше). Сделки открываются при возврате цены в выбранную зону между полосами, при необходимости подтверждаются фильтрами RSI и Стохастика.

## Логика стратегии
- Желтая полоса строится с заданным множителем стандартного отклонения.
- Синяя полоса использует половину этого множителя, образуя более узкий коридор.
- Красная полоса использует двойной множитель и формирует внешний коридор.
- Значения RSI и Стохастика берутся по предыдущей завершённой свече (`Bar Shift`), как и в оригинальном роботе.
- Параметр `Only One Position` определяет, открывать ли новую сделку только при нулевой позиции либо разрешать добавление при возврате цены к средней полосе.

## Правила входа
### Покупка
1. На текущей свече цена опускается до выбранной зоны (`Entry Mode`): середина между желтой и синей, синей и красной либо одна из полос.
2. При активных фильтрах:
   - RSI: значение RSI ≤ `100 - RSI Lower`.
   - Стохастик: %K < `100 - Stochastic Lower`.
3. Дополнительные условия:
   - При `Only One Position = true` открываемся только при отсутствии позиции.
   - В режиме добавлений новая покупка возможна лишь после закрытия свечи выше средней полосы, что снимает блокировку.

### Продажа
1. Цена на текущей свече достигает выбранной верхней зоны.
2. Фильтры:
   - RSI: значение RSI ≥ `RSI Lower`.
   - Стохастик: %K > `Stochastic Lower`.
3. Позиционные условия аналогичны покупке (требуется пустая позиция либо разблокировка после закрытия ниже средней полосы).

## Правила выхода
- Параметр `Closure Mode` задаёт целевую область закрытия:
  - `Middle Line`: фиксируем прибыль по длинной позиции при касании средней полосы сверху и закрываем шорт при касании снизу.
  - `Between Yellow and Blue` / `Between Blue and Red`: закрытие на тех же серединных уровнях, что и входы; если выбран другой режим входа, применяется середина между синей и красной.
  - `Yellow Line`, `Blue Line`, `Red Line`: закрытие при прямом касании соответствующей полосы.
- В режиме добавлений блокировки снимаются автоматически, когда свеча закрывается по противоположную сторону от средней полосы.

## Управление риском
- `Stop Loss` и `Take Profit` задаются в пунктах и конвертируются в абсолютное расстояние через `Pip Value` при запуске защиты `StartProtection`.
- Нулевое значение отключает соответствующий защитный ордер.
- Объём каждой сделки задаётся параметром `Order Volume`.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Entry Mode` | Зона, в которой формируется сигнал на вход. | Между жёлтой и синей |
| `Closure Mode` | Уровень/зона фиксации позиции. | Между синей и красной |
| `Bands Period` | Период всех полос Боллинджера. | 140 |
| `Deviation` | Множитель отклонения для жёлтой полосы (синяя = половина, красная = двойной). | 2.0 |
| `Use RSI Filter` | Включить фильтр RSI. | false |
| `RSI Period` | Период усреднения RSI. | 8 |
| `RSI Lower` | Порог перекупленности; перепроданность = `100 - порог`. | 70 |
| `Use Stochastic Filter` | Включить фильтр Стохастика. | true |
| `Stochastic Period` | Основной период %K (сглаживание 3/3 SMA). | 20 |
| `Stochastic Lower` | Порог перекупленности; перепроданность = `100 - порог`. | 95 |
| `Bar Shift` | Количество завершённых свечей для смещения сигналов. | 1 |
| `Only One Position` | Открывать новую сделку только при нулевой позиции. | true |
| `Order Volume` | Объём рыночного ордера. | 1 |
| `Pip Value` | Абсолютная стоимость одного пункта. | 0.0001 |
| `Stop Loss` | Дистанция стоп-лосса в пунктах (0 — выключено). | 200 |
| `Take Profit` | Дистанция тейк-профита в пунктах (0 — выключено). | 200 |
| `Candle Type` | Тип свечей для расчётов (по умолчанию 1 минута). | 1 минута |

## Дополнительно
- Стратегия работает только с закрытыми свечами, поэтому `Bar Shift` следует оставлять ≥ 1.
- Фильтры используют линию %K; линия %D рассчитывается, но не участвует в логике, как и в исходном советнике.
- Реализация выполнена через высокоуровневый API StockSharp (подписка через `Bind`, без прямого доступа к буферам индикаторов).
