# Стратегия BBStrategy

## Общее описание

BBStrategy — это портированная из MetaTrader экспертная система «BBStrategy», основанная на расширениях полос Боллинджера. Алгоритм отслеживает две пары полос с одинаковым периодом, но разными коэффициентами отклонения. После прорыва внешней полосы стратегия переходит в режим ожидания сделки и открывает позицию только тогда, когда цена возвращается внутрь внутренней полосы, подтверждая продолжение импульса без чрезмерного перекупленности/перепроданности.

## Логика работы

1. Подписка на свечи и расчёт двух индикаторов Bollinger Bands:
   - **Внешняя полоса** использует настраиваемое отклонение (по умолчанию 3.0).
   - **Внутренняя полоса** рассчитывается с меньшим отклонением (по умолчанию 2.0).
2. Фиксация закрытия свечи за пределами внешней полосы:
   - Закрытие выше верхней внешней полосы активирует режим ожидания покупки.
   - Закрытие ниже нижней внешней полосы активирует режим ожидания продажи.
3. Вход осуществляется только если следующая завершённая свеча закрывается внутри внутренней полосы в сторону сигнала. Пока цена не вернулась в диапазон, стратегия остаётся в режиме ожидания для соответствующего направления.
4. При выполнении условий отправляется одна рыночная заявка, если нет открытых позиций и активных заявок. Противоположная позиция закрывается увеличенным объёмом рыночной заявки.
5. Опциональные стоп-лосс и тейк-профит задаются в пунктах и автоматически переводятся в абсолютные цены через встроенный модуль защиты.

## Параметры

| Название | Описание |
|----------|----------|
| **Order Volume** | Объём каждой сделки. |
| **Bollinger Period** | Количество свечей в расчёте полос Боллинджера. |
| **Inner Deviation** | Множитель отклонения для внутренней полосы. |
| **Outer Deviation** | Множитель отклонения для внешней полосы. |
| **Stop-Loss Points** | Дистанция стоп-лосса в пунктах (0 отключает защиту). |
| **Take-Profit Points** | Дистанция тейк-профита в пунктах (0 отключает цель). |
| **Candle Type** | Таймфрейм свечей для расчётов. |

## Дополнительные заметки

- Стратегия работает только с одной позицией и игнорирует новые сигналы при наличии активных заявок.
- Перевод пунктов MetaTrader в реальные изменения цены выполняется исходя из шага цены инструмента.
- Для визуального контроля на график выводятся свечи, обе полосы Боллинджера и собственные сделки стратегии.
