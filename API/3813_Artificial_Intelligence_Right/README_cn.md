# Artificial Intelligence Right 策略

## 概览
该策略来源于 MetaTrader 4 的专家顾问 **ArtificialIntelligence_Right.mq4**。它通过对加速/减速振荡指标
(Acceleration/Deceleration, AC) 的四个延迟样本执行单层感知机计算，用感知机的符号来决定开仓方向以及是否需要反向。

移植到 StockSharp 之后，所有动作都在已完成的 K 线收盘价上执行，使得回测与参数优化的结果更加可重复。

## 指标与计算方法
- **加速/减速振荡器** 由 Awesome Oscillator 重建：先使用 HL2（(High+Low)/2）计算 5 周期与 34 周期 SMA 的差值得到 AO，
  再对 AO 应用 5 周期 SMA 并做差，得到最终 AC 数值。
- 策略维护一个长度为 22 的数组来存放最新的 AC 数据，正好可以访问索引 0、7、14、21，与原始 MQL 脚本完全一致。
- 感知机的每个权重都先减去 100 (`w = x - 100`)，然后与对应的 AC 数据点做点乘，复现原始信号公式。

## 交易逻辑
1. **入场**
   - 感知机大于零且当前无持仓时，按市价买入。
   - 感知机小于零且当前无持仓时，按市价卖出。
2. **止损管理**
   - 每次开仓后都会记录一个虚拟止损价位，其距离为 `StopLossPoints * PriceStep`，与 MetaTrader 中 `Point`
     的概念保持一致。
   - 收盘价穿越止损水平时，立即通过市价单平仓，模拟真实的止损执行。
3. **移动止损与反向**
   - 当浮动盈利超过 `(2 * StopLossPoints + SpreadPoints)` 点时，原脚本会启动移动止损，或者在感知机翻转时直接反向。
   - 移植版本沿用同样的触发条件：若感知机转向，则以当前仓位的两倍成交量下单，实现与 `OrderCloseBy`
     类似的反向操作；否则把虚拟止损价位跟随价格移动，保持原有的距离。

所有反向操作都采用“双倍成交量”的方式，以保证结果仓位的方向相反而手数不变。

## 参数说明
| 名称 | 说明 |
| --- | --- |
| `X1` … `X4` | 感知机权重，默认值（135、127、16、93）与 MQL 源码一致。 |
| `StopLoss` | 止损距离（点数），会乘以标的物的 `PriceStep` 转换为真实价格。 |
| `Spread` | 移动止损触发条件中的额外点差缓冲，默认为 3 点。 |
| `Candle Type` | 计算所用的 K 线类型，默认 1 分钟。 |

`Volume` 属性固定为 1 手，对应原脚本的 `lots` 参数。

## 实现细节
- 每次重置策略时都会清空指标缓冲区，避免旧数据造成误触发。
- 如果标的物没有提供 `PriceStep`，策略会退化为使用点值 `1`，确保在各种回测环境下都能运行。
- 策略内部没有真实挂出止损单，而是在 K 线处理函数中通过市价单模拟，这种方式能够跨平台保持一致的执行效果。
