# Стратегия Elderv30aug05v

## Общее описание
Elderv30aug05v — порт советника MetaTrader 4 с тем же названием. Алгоритм сочетает два фильтра MACD на часовом таймфрейме и два стохастика на 15-минутных свечах. Торговля и управление выходами выполняются на минутных свечах, что повторяет тиковую логику оригинального MQL-скрипта. Стратегия держит не более одной позиции одновременно и опирается на динамические трейлинг-стопы вместо фиксированных тейк-профитов.

## Используемые данные и индикаторы
- **Основной MACD** (`13/30/9`, часовые свечи). Для лонга требуется, чтобы значение росло, а предыдущая величина оставалась ниже нуля.
- **Дополнительный MACD** (`14/56/9`, часовые свечи). Для шорта необходимо снижение текущего значения при положительном предыдущем.
- **Быстрый стохастик** (`%K=2`, `%D=3`, сглаживание=3, 15-минутные свечи). Лонг разрешён только если %K ниже порога `LongStochasticThreshold` (по умолчанию 36) и растёт относительно предыдущего бара.
- **Медленный стохастик** (`%K=1`, `%D=3`, сглаживание=3, 15-минутные свечи). Для шорта %K должен быть выше `ShortStochasticThreshold` (по умолчанию 66) и снижаться по сравнению с предыдущим значением.
- **Минутные свечи** обеспечивают подтверждение пробоя и служат для сопровождения позиции.

Все индикаторы обрабатывают только закрытые свечи через вызовы `SubscribeCandles().Bind()/BindEx()`, что соответствует рекомендациям по высокоуровневому API StockSharp.

## Правила входа
### Условия для покупки
1. Основной MACD растёт, а его предыдущее значение ниже нуля.
2. Быстрый стохастик находится ниже `LongStochasticThreshold` и выше предыдущего значения.
3. Цена закрытия текущей минутной свечи выше максимума предыдущей минутной свечи.

### Условия для продажи
1. Дополнительный MACD падает, а его прошлое значение выше нуля.
2. Медленный стохастик находится выше `ShortStochasticThreshold` и ниже предыдущего значения.
3. Цена закрытия текущей минутной свечи ниже минимума предыдущей минутной свечи.

Если позиция уже открыта, новые сигналы игнорируются до закрытия текущей сделки по стопу или трейлингу.

## Правила выхода
- **Начальный стоп-лосс**: при входе фиксируется цена открытия плюс/минус `LongStopLoss` или `ShortStopLoss`, умноженные на `PriceStep` инструмента. При отсутствии шага цены используется запасное значение `0.0001`.
- **Трейлинг-стоп**: когда цена проходит как минимум `LongTrailingStop` или `ShortTrailingStop` пунктов в сторону позиции, стоп переносится за ценой закрытия текущей свечи. Для лонга стоп двигается вверх, для шорта — вниз.
- Если диапазон свечи касается сохранённого стоп-уровня, позиция закрывается рыночной заявкой.

Тейк-профит не применяется, что полностью повторяет оригинальную реализацию.

## Параметры
| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `Volume` | `0.1` | Объём сделки для рыночных заявок. |
| `LongStopLoss` | `17` | Дистанция стоп-лосса для лонгов (в пунктах). |
| `ShortStopLoss` | `46` | Дистанция стоп-лосса для шортов (в пунктах). |
| `LongTrailingStop` | `18` | Шаг трейлинг-стопа для лонгов. |
| `ShortTrailingStop` | `22` | Шаг трейлинг-стопа для шортов. |
| `LongStochasticThreshold` | `36` | Максимальное значение быстрого стохастика для входа в лонг. |
| `ShortStochasticThreshold` | `66` | Минимальное значение медленного стохастика для входа в шорт. |
| `BaseCandleType` | `TimeFrame(1m)` | Таймфрейм для исполнения и сопровождения. |
| `StochasticCandleType` | `TimeFrame(15m)` | Таймфрейм для обоих стохастиков. |
| `MacdCandleType` | `TimeFrame(1h)` | Таймфрейм для обоих MACD. |
| `MacdFastPeriod` / `MacdSlowPeriod` / `MacdSignalPeriod` | `13 / 30 / 9` | Периоды основного MACD. |
| `AltMacdFastPeriod` / `AltMacdSlowPeriod` / `AltMacdSignalPeriod` | `14 / 56 / 9` | Периоды дополнительного MACD. |
| `StochasticFastKPeriod` / `StochasticFastDPeriod` / `StochasticFastSmooth` | `2 / 3 / 3` | Параметры быстрого стохастика. |
| `StochasticSlowKPeriod` / `StochasticSlowDPeriod` / `StochasticSlowSmooth` | `1 / 3 / 3` | Параметры медленного стохастика. |

## Дополнительные замечания
- Стратегия подходит для любых инструментов с минутными свечами и корректным `PriceStep`.
- Трейлинг-стопы реализованы внутри стратегии, биржевые защитные заявки не выставляются.
- Обработка ведётся только по завершённым свечам, что исключает перерисовку и соответствует логике оригинального советника.

## Источник
- **Файл**: `MQL/7674/Elderv30aug05v.mq4`
- **Платформа**: MetaTrader 4.
