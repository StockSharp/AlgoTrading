# Neural Network ATR 策略

## 概述

该策略在 StockSharp 中还原 "Neurotest" 专家顾问，通过轻量级神经网络层
与 ATR 风险管理的组合生成交易信号。系统对每根完成的 M15 K 线（可配置）
提取五个归一化特征：收盘动量、日内振幅、K 线实体、成交量扩张以及 ATR
相对波动率。单隐层神经网络输出的概率值再乘以自适应学习率，与买入/卖出
阈值比较后决定持仓方向。

## 交易规则

1. 订阅指定周期的蜡烛并计算相同周期的 ATR。
2. 使用上一根与当前完成蜡烛构建五个特征，送入神经网络得到预测值。
3. 当修正后的预测值高于买入阈值且当前没有多头仓位时，开多或翻多。
4. 当修正后的预测值低于卖出阈值且当前没有空头仓位时，开空或翻空。
5. 每次入场都会按照 ATR 距离附加止损和止盈；若 ATR 尚未形成，则使用
   备用的点数距离。
6. 若当前点差超过限制，本根蜡烛不参与交易决策。

## 风险控制

- 仓位大小按账户权益和 ATR 止损距离计算，使止损亏损约等于 `Max Risk %`。
- 止盈价格基于可配置的风险回报比。
- 当日或总回撤超过限制时自动停止交易。
- 若当日收益未达到目标，学习率降低 10%（不低于最小值），以降低接下来
  的信号强度；新交易日会重新评估。

## 参数

| 参数 | 说明 |
|------|------|
| **Max Risk %** | 单笔交易相对于权益的最大风险比例。 |
| **Daily Loss %** | 当日最大允许回撤。 |
| **Total Loss %** | 全局最大允许回撤。 |
| **Daily Profit %** | 当日收益目标，低于该值会触发惩罚。 |
| **Learning Rate** | 神经网络输出的缩放因子。 |
| **Hidden Layer** | 隐藏层神经元数量。 |
| **Buy Threshold / Sell Threshold** | 多头与空头信号阈值。 |
| **Candle Type** | 使用的蜡烛类型与周期。 |
| **ATR Period** | ATR 指标周期。 |
| **Max Spread** | 允许的最大点差（以价格步长计）。 |
| **Risk Reward** | 止盈与止损距离的倍数关系。 |
| **Fallback Stop** | ATR 不可用时的备用止损点数。 |

## 备注

- 策略订阅 Level1 数据以便在决策前检查买卖价点差。
- 神经网络权重通过固定随机种子（42）初始化，学习率的衰减模拟原策略的
  自适应行为。
- 请确保投资组合提供 `CurrentValue`、`StepPrice` 以及交易量上下限，以便
  正确计算仓位和保护性订单。
