# Breakeven Trailing Stop 策略

## 概览
- 根据 MetaTrader 专家顾问 `e_Breakeven_v4` 改写的基于 tick 的追踪止损管理器。
- 当价格远离开仓价时，自动上移或下移虚拟止损，从而把仓位锁定在保本并继续跟随趋势。
- 价格触及追踪水平时以市价平掉全部仓位，复现原始 EA 的“保本 + 步长”逻辑。
- 内置可选的演示模式，在回测时随机开仓，便于观察追踪效果而无需额外信号源。

## 工作流程
1. 订阅逐笔成交数据（`DataType.Ticks`），模拟 MQL5 中的 `OnTick` 回调。
2. 只要持仓盈利并超过 `TrailingStop + TrailingStep`（单位：点），就把追踪止损移动到更接近当前价格的位置。
3. 多头：若价格上涨超过阈值，则把止损放在 `当前价格 - TrailingStop`。
4. 空头：若价格下跌超过阈值，则把止损放在 `当前价格 + TrailingStop`。
5. 一旦最新成交价触碰追踪水平，立即按市价平仓并重置状态。
6. 当标的报价精度为 3 或 5 位小数时，将最小价位变动乘以 10，把 point 转换成 pip，与 MQL5 的处理保持一致。
7. 开启演示模式时，策略在空仓状态收到新的 tick 后会根据随机结果开多或开空，仓位大小取自 `Volume`。

## 参数
| 名称 | 说明 | 默认值 | 备注 |
| --- | --- | --- | --- |
| `TrailingStopPips` | 当前价格与追踪止损之间的 pip 距离。 | 10 | 设为 `0` 可完全关闭追踪功能。 |
| `TrailingStepPips` | 每次继续移动止损前需要的额外 pip 距离。 | 1 | 当启用追踪时必须大于 0，与原 EA 的校验一致。 |
| `EnableDemoEntries` | 是否在测试时随机开仓。 | `false` | 设为 `true` 时，在空仓的 tick 上抛硬币决定方向。 |

## 仓位管理
- 默认不主动开仓，仅对外部或人工仓位执行追踪；若开启演示模式，则使用随机信号。
- 多、空两种方向都采用相同的追踪规则，可处理任意手数。
- 使用虚拟止损，通过市价平仓来执行，不依赖券商的真实止损订单。
- 可作为其他策略的“保护层”，只负责管理止损，不干预开仓逻辑。

## 使用提示
- 推荐在提供逐笔成交数据的市场中使用，以便追踪能即时响应。
- 使用演示模式时，请确保 `Volume` 与期望的下单手数一致。
- pip 转换假设标的是外汇类品种（3 或 5 位小数），其他品种可根据需要调整默认参数。
- 触发条件采用首个穿越止损的 tick，与 MQL5 版本的即时修改并平仓行为相符。

## 与原始 MQL5 EA 的差异
- StockSharp 策略通过虚拟止损和市价平仓来实现保护，不直接修改经纪商侧的止损订单。
- MetaTrader 测试器中的随机开仓被改造成可配置的 `EnableDemoEntries` 参数。
- 点值转换通过 `Security.PriceStep` 与小数位统计实现，而非使用 `Symbol().Digits()`。
- 所有代码注释与日志均改为英文，满足仓库的统一要求。
