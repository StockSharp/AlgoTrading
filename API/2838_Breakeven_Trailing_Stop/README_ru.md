# Стратегия Breakeven Trailing Stop

## Описание
- Тиковый менеджер трейлинг-стопа, конвертированный из советника MetaTrader `e_Breakeven_v4`.
- Отслеживает каждую сделку, чтобы переносить виртуальный стоп-лосс после достаточного движения цены от точки входа.
- Закрывает длинные и короткие позиции рыночными ордерами при достижении уровня трейлинга, повторяя механику «безубыток + шаг» исходного алгоритма.
- Включает опциональный демонстрационный режим, который в тестах случайным образом открывает сделки для иллюстрации работы трейлинга.

## Логика работы
1. Стратегия подписывается на тиковые данные (`DataType.Ticks`), имитируя обработчик `OnTick` из MQL5.
2. Когда у стратегии есть позиция и цена прошла расстояние `TrailingStop + TrailingStep` (в пипсах), уровень стопа переносится ближе к текущей цене.
3. Для лонгов стоп устанавливается на `текущая цена - TrailingStop`, если прибыль превышает `TrailingStop + TrailingStep`.
4. Для шортов стоп переносится на `текущая цена + TrailingStop` после аналогичного движения вниз.
5. При касании цены сохранённого уровня позиция полностью закрывается по рынку, а состояние трейлинга сбрасывается.
6. Для перевода «поинтов» в пипсы шаг цены умножается на 10 при 3 или 5 знаках после запятой — аналогично корректировке в MQL5.
7. В демо-режиме стратегия подбрасывает «монетку» на каждом новом тике после выхода из позиции и открывает случайный лонг или шорт объёмом `Volume`.

## Параметры
| Параметр | Описание | Значение по умолчанию | Примечание |
| --- | --- | --- | --- |
| `TrailingStopPips` | Расстояние от цены до трейлинг-стопа в пипсах. | 10 | Значение `0` полностью отключает трейлинг. |
| `TrailingStepPips` | Дополнительные пипсы, необходимые для следующего переноса стопа. | 1 | Должно быть больше нуля, если трейлинг активен — правило из оригинального советника. |
| `EnableDemoEntries` | Включить случайные входы в тестовом режиме. | `false` | При `true` стратегия генерирует сигналы, пока нет позиции. |

## Управление позициями
- Без включённого демо-режима стратегия не открывает сделки самостоятельно и обслуживает только внешние позиции.
- Трейлинг симметричен для лонгов и шортов, работает с любыми объёмами.
- Стопы виртуальные: при срабатывании выполняется рыночный выход, что не требует поддержки стоп-заявок у брокера.
- Подходит в качестве надстройки для ручной торговли или другой стратегии, которая генерирует сигналы.

## Практические замечания
- Требуются тиковые данные, чтобы перенос стопа происходил без задержки.
- При использовании демо-режима убедитесь, что параметр `Volume` соответствует размеру лота входящих позиций.
- Перевод в пипсы ориентирован на валютные инструменты с 3 или 5 знаками после запятой.
- Выход выполняется на первом тике, который пробивает уровень стопа, что отражает мгновенное обновление ордеров в MQL5.

## Отличия от версии MQL5
- Вместо модификации стоп-заявок у брокера используются виртуальные уровни и рыночные выходы — подход, принятый в StockSharp.
- Блок случайных сделок тестера вынесен в настраиваемый параметр `EnableDemoEntries`.
- Преобразование «поинт → пипс» выполняется через `Security.PriceStep` и подсчёт знаков, а не через `Symbol().Digits()`.
- Все комментарии и сообщения переведены на английский язык в соответствии с требованиями репозитория.
