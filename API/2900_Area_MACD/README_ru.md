# Стратегия Area MACD

## Описание
Area MACD сравнивает суммарную силу быков и медведей с помощью главной линии MACD. За заданное количество свечей стратегия накапливает сумму всех положительных значений индикатора и абсолютную сумму отрицательных значений. Если преобладает положительная область, открывается длинная позиция; если отрицательная — короткая. Дополнительный параметр позволяет инвертировать сигналы и торговать против основного направления.

Реализация использует высокоуровневый API StockSharp: подключение к свечам, привязку индикаторов и обработку только завершённых свечей внутри метода `ProcessCandle`.

## Индикаторы и данные
- **MACD** с настраиваемыми периодами быстрой, медленной и сигнальной EMA.
- **Свечи** выбранного таймфрейма (по умолчанию 30 минут).

## Правила входа
1. **Покупка** — положительная площадь MACD превышает модуль отрицательной. В режиме Reverse условие меняется на противоположное.
2. **Продажа** — модуль отрицательной площади больше положительной. В режиме Reverse условия меняются местами.
3. **Управление позицией** — при появлении нового сигнала противоположное плечо закрывается рыночным ордером, чтобы стратегия держала только одну направленную позицию.

## Управление рисками
- **Стоп-лосс** — фиксированное расстояние в пунктах от цены входа. Пересчитывается в цену с учётом шага цены инструмента.
- **Тейк-профит** — фиксированная цель в пунктах, рассчитывается аналогично стоп-лоссу.
- **Трейлинг-стоп** — опциональный механизм. Активируется, когда прибыль превышает `TrailingStopPips + TrailingStepPips`. После активации стоп следует за ценой с отступом `TrailingStopPips` и сдвигается только при дополнительном прогрессе минимум на `TrailingStepPips`. Для работы трейлинга оба параметра должны быть больше нуля.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `OrderVolume` | Объём ордера при входе. | 1 |
| `HistoryLength` | Количество свечей для расчёта площадей MACD. | 60 |
| `MacdFastLength` | Период быстрой EMA в MACD. | 12 |
| `MacdSlowLength` | Период медленной EMA. | 26 |
| `MacdSignalLength` | Период сигнальной EMA. | 9 |
| `ReverseSignals` | Инвертировать ли условия входа. | false |
| `StopLossPips` | Расстояние стоп-лосса в пунктах. | 100 |
| `TakeProfitPips` | Расстояние тейк-профита в пунктах. | 150 |
| `TrailingStopPips` | Отступ трейлинг-стопа в пунктах (0 — отключено). | 5 |
| `TrailingStepPips` | Минимальный дополнительный ход цены для обновления трейлинга (0 — отключено). | 5 |
| `CandleType` | Таймфрейм свечей. | 30-минутные свечи |

## Рекомендации по использованию
1. Подключите стратегию к нужному инструменту и портфелю, затем скорректируйте параметры под выбранный рынок.
2. Чтобы включить трейлинг-стоп, задайте положительные значения `TrailingStopPips` и `TrailingStepPips`. При нулевых значениях срабатывают только обычный стоп и тейк.
3. Информационные сообщения о срабатывании стопов и тейлинга выводятся в лог на английском языке, что облегчает сопровождение стратегии.

## Источник идеи
Стратегия создана на основе советника MetaTrader 5 «Area MACD». В версии для StockSharp сохранён принцип сравнения площадей MACD и добавлены инструменты управления рисками через возможности фреймворка.
