# Стратегия Gaps

## Обзор

**Gaps** — это прямой порт советника MetaTrader 4 `gaps.mq4`. Стратегия отслеживает 15-минутные свечи и ищет открытия, кот
орые происходят за пределами диапазона предыдущей свечи. При появлении такого гэпа система немедленно входит в рынок в расчет
е на возврат цены к диапазону.

Версия для StockSharp следует исходной логике и использует высокоуровневый API подписки на свечи. Управление сделками произ
водится рыночными ордерами без постановки фиксированных защитных заявок, что соответствует поведению оригинального кода MQL.

## Торговые правила

1. Подписаться на 15-минутные свечи (тип регулируется параметром `CandleType`).
2. Сохранить максимум и минимум последней завершённой свечи.
3. Когда формируется новая свеча:
   - Рассчитать буфер гэпа: `(MinGapSize + spreadInSteps) * pointValue`.
   - Если цена открытия **выше** `previousHigh + gapBuffer`, открыть **короткую** позицию.
   - Если цена открытия **ниже** `previousLow - gapBuffer`, открыть **длинную** позицию.
4. На каждой свече допускается только одна сделка. После отправки ордера стратегия ждёт следующую свечу, прежде чем генериров
ать новый сигнал.

Компонент спреда использует текущие котировки bid/ask, когда они доступны. При отсутствии данных стратегия применяет один ша
г цены в качестве консервативного буфера.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `MinGapSize` | `1` | Минимальный размер гэпа в шагах цены, необходимый для открытия позиции. |
| `GapVolume` | `0.1` | Объём рыночного ордера, отправляемого при срабатывании сигнала. |
| `CandleType` | `15m TimeFrame` | Тип свечей, используемых для расчётов (по умолчанию 15 минут). |

Все параметры зарегистрированы через `StrategyParam<T>` и поддерживают оптимизацию в StockSharp Designer и других инструментах.

## Особенности реализации

- Используется `SubscribeCandles` с `Bind`, чтобы обрабатывать только завершённые свечи.
- Диапазон предыдущей свечи сохраняется во внутренних переменных, что исключает необходимость дополнительных коллекций.
- За счёт хранения времени открытия свечи, вызвавшей сделку, предотвращаются повторные ордера в рамках того же бара.
- На график выводятся свечи и сделки стратегии для оперативной визуальной проверки.

## Отличия от версии MQL

- В оригинальном советнике значения для стоп-лосса и тейк-профита передавались в неверные параметры, поэтому сделки выполнялись
без защитных заявок. Перенос сохранён в таком же виде и не добавляет стопов.
- Оценка спреда теперь использует актуальные котировки bid/ask и только при их отсутствии возвращается к минимальному шагу цены.

## Требования

- Доступ к свечным данным выбранного инструмента в среде StockSharp.
- Поток котировок Level1 не обязателен, но повышает точность вычисления буфера по спреду.
