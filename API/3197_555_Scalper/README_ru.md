# Стратегия 555 Scalper

## Общее описание
Стратегия 555 Scalper — это перенос одноимённого советника MetaTrader на высокоуровневый API StockSharp. Алгоритм может работать на любом базовом таймфрейме и использует фильтры старшего периода вместе с месячным MACD для подтверждения тренда. Основа сигналов — пересечение быстрых и медленных LWMA по типичной цене, проверка структуры предыдущих свечей, фильтр по индикатору Momentum и подтверждение по MACD. Блок управления рисками повторяет логику оригинального советника: перевод в безубыток, трейлинг-стоп по пунктам, стоп по просадке капитала и выходы по деньгам.

## Торговая логика
- **Фильтр тренда.** На типичной цене рассчитываются быстрые и медленные LWMA. Для покупок быстрая LWMA должна быть выше медленной, для продаж — ниже.
- **Структура свечей.** Проверяется перекрытие двух последних завершённых свечей (минимум позапрошлой свечи ниже максимума прошлой — условие для покупок, обратное условие — для продаж).
- **Фильтр Momentum.** На старшем таймфрейме (выбирается автоматически: M1 → M15, M5 → M30, M15 → H1 и т. д.) считается индикатор Momentum с периодом 14. Сигнал допустим, если хотя бы одно из трёх последних значений отклоняется от 100 больше заданного порога (по умолчанию 0.3).
- **Подтверждение MACD.** На месячных свечах рассчитывается MACD (12/26/9). Покупки разрешены, когда линия MACD выше сигнальной, продажи — когда ниже.
- **Управление объёмом.** Первая сделка открывается базовым объёмом, последующие добавляются с коэффициентом LotExponent до достижения лимита MaxTrades.

## Управление рисками
- **Начальный стоп и тейк-профит.** Каждая позиция получает исходные уровни по заданным расстояниям в пунктах.
- **Перевод в безубыток.** После прохождения заданного количества пунктов стоп переносится в зону безубытка с дополнительным запасом.
- **Пипсовый трейлинг.** Стоп последовательно подтягивается вслед за ценой, когда позиция уходит в прибыль.
- **Цели по деньгам.** Опциональные фиксаторы прибыли — в валюте счёта или в процентах от стартового капитала.
- **Денежный трейлинг.** Отслеживается максимум плавающей прибыли; при откате на заданную величину позиция закрывается.
- **Стоп по эквити.** Запоминается максимум совокупной стоимости портфеля. Если текущая просадка превышает допустимый процент, все позиции закрываются.

## Основные параметры
- **BaseVolume / LotExponent** — базовый объём и множитель для добавочных сделок.
- **StopLossSteps / TakeProfitSteps** — расстояние до стоп-лосса и тейк-профита в пунктах MetaTrader.
- **FastMaPeriod / SlowMaPeriod** — периоды LWMA для трендового фильтра.
- **MomentumBuy/SellThreshold** — требуемое отклонение Momentum для длинных и коротких сигналов.
- **MaxTrades** — максимальное количество сделок в одном направлении.
- **BreakEvenTriggerSteps / BreakEvenOffsetSteps / TrailingStopSteps** — настройки безубытка и трейлинг-стопа.
- **UseMoneyTakeProfit / UsePercentTakeProfit / EnableMoneyTrailing** — параметры денежного управления.
- **UseEquityStop / TotalEquityRisk** — включение стопа по просадке и его величина.

## Рекомендации по использованию
1. Выберите основной таймфрейм через параметр `CandleType` и убедитесь, что доступны исторические данные как для него, так и для старшего периода.
2. Для корректной работы фильтра Momentum требуется достаточное количество свечей старшего таймфрейма.
3. Месячный MACD нуждается в истории по месячным свечам — обеспечьте загрузку соответствующих данных.
4. Подберите объёмы и расстояния стопов в соответствии с волатильностью инструмента и допустимым риском счёта.

Стратегия воспроизводит ключевую логику оригинального советника 555 Scalper и использует возможности StockSharp для подписки на данные, расчёта индикаторов и управления заявками.
