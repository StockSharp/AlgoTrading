# 555 Scalper 策略

## 概述
555 Scalper 策略是 MetaTrader "555 Scalper" 智能交易顾问的完整移植版本。策略可以运行在任何主周期上，同时使用更高周期的动量过滤和月线级别的 MACD 确认。主要信号由快慢线性加权移动平均交叉、结构性蜡烛条件以及动量/ MACD 过滤组合而成。风控模块保留了原始 EA 的特性，包括移动止损、保本保护、权益回撤止损以及以资金为单位的止盈/拖尾控制。

## 交易逻辑
- **趋势过滤：** 在交易周期的典型价格上计算快、慢两条 LWMA。做多时要求快 LWMA 高于慢 LWMA，做空时要求快 LWMA 低于慢 LWMA。
- **蜡烛结构：** 检查最近两根已完成蜡烛是否重叠（两根前的最低价低于上一根最高价用于做多，反之用于做空），模拟 EA 中的分形确认逻辑。
- **动量过滤：** 在根据主周期推导出的更高周期上计算 14 周期 Momentum 指标（例如 M1→M15，M5→M30，M15→H1 等）。只有当最近三个动量值中至少有一个偏离 100 超过设定阈值（默认 0.3）时，信号才有效。
- **MACD 确认：** 在月线周期上计算 12/26/9 MACD，只有当 MACD 主线位于信号线之上时才允许做多，主线低于信号线时才允许做空。
- **仓位管理：** 第一笔仓位使用基础手数，后续加仓按照手数指数乘数放大，最多叠加到设定的最大开仓次数。

## 风险控制
- **初始止损/止盈：** 每笔新仓位都会根据 MetaTrader 点值距离设置初始止损和止盈。
- **保本移动：** 当价格盈利达到设定点数后，将止损移动到开仓价并加上额外偏移。
- **点差拖尾：** 根据原始 EA 的逻辑，当价格继续朝盈利方向移动时，按照点数距离提升止损位置。
- **资金止盈：** 可选的金额止盈和百分比止盈，当浮动盈利达到目标时自动平仓。
- **资金拖尾：** 记录浮动盈利峰值，一旦回撤达到设定值便离场。
- **权益止损：** 追踪策略运行期间的账户权益峰值，若浮动回撤超过允许百分比则全部平仓。

## 参数说明
- **BaseVolume / LotExponent：** 定义初始手数以及每次加仓的乘数。
- **StopLossSteps / TakeProfitSteps：** 以点（MetaTrader pip）表示的止损和止盈距离。
- **FastMaPeriod / SlowMaPeriod：** LWMA 趋势过滤的快慢周期长度。
- **Momentum 阈值：** 做多和做空所需的动量偏离程度。
- **MaxTrades：** 每个方向允许的最大加仓次数。
- **保本与拖尾设置：** 配置触发保本、保本偏移以及点数拖尾距离。
- **资金管理：** 控制金额止盈、百分比止盈以及资金拖尾逻辑是否启用。
- **权益止损：** 设置相对于权益峰值的最大容忍百分比。

## 使用建议
1. 通过 `CandleType` 参数选择交易周期，并确保行情数据覆盖主周期与所需的高阶周期。
2. 动量过滤所需的高阶周期会自动推导，但测试时应提供足够的历史数据，以便指标正确预热。
3. 月线 MACD 需要月度蜡烛数据；在回测或实时前请确保平台能够提供该级别数据。
4. 根据交易品种的波动性和账户规模，适当调整手数、点数距离以及资金风控参数。

该策略在 StockSharp 高层 API 上复现了原始 EA 的核心决策流程，并提供完整的订单执行与风险管理支持。
