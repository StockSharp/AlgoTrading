# Стратегия Breakdown Catcher

## Общее описание
Breakdown Catcher — это конвертированная стратегия из MetaTrader, которая строит точки входа по пробою диапазона предыдущей свечи. После закрытия бара фиксируются его максимум и минимум, к которым добавляется (или вычитается) настраиваемый отступ. При пробое уровня стратегия открывает позицию по рынку, сразу рассчитывает стоп-лосс, тейк-профит и при необходимости включает трейлинг-стоп в пипсах.

## Логика работы
1. После завершения каждой свечи её high/low становятся диапазоном наблюдения на следующий бар.
2. Уровень покупки = предыдущий максимум + отступ в пипсах. Уровень продажи = предыдущий минимум − отступ.
3. Если новая свеча пробивает уровень покупки и позиция отсутствует, стратегия открывает длинную позицию по рынку, сбрасывает короткие настройки и сохраняет защитные уровни.
4. Если пробивается уровень продажи, открывается короткая позиция по рынку.
5. Стоп-лосс и тейк-профит переводятся из пипсов в абсолютную цену через шаг цены инструмента и поправку для инструментов с 3/5 знаками после запятой (как в исходном советнике).
6. Трейлинг-стоп активируется, когда цена проходит в прибыль сторону не менее чем на `TrailingStop + TrailingStep` пипсов. Передвинуть стоп можно только при дополнительном движении на величину шага.
7. Если в пределах одной свечи были достигнуты оба уровня (buy и sell), сделка пропускается, чтобы избежать неопределённости порядка исполнения.
8. Перед постановкой новой сделки проверяется спред. Если текущий спред превышает `AllowedSpreadPoints` (в шагах цены), вход блокируется.

## Управление капиталом
* Объём заявок задаётся свойством `Strategy.Volume`. Для реверса позиция пересчитывается как базовый объём плюс модуль текущей позиции.
* Все защитные уровни реализованы через рыночные ордера закрытия при достижении соответствующих цен в диапазоне свечи.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `StopLossPips` | Расстояние стоп-лосса в пипсах. | `30` |
| `TakeProfitPips` | Расстояние тейк-профита в пипсах. | `90` |
| `TrailingStopPips` | Дистанция трейлинг-стопа в пипсах. `0` — отключить. | `30` |
| `TrailingStepPips` | Дополнительный проход цены перед сдвигом трейлинга. Должен быть > 0 при включённом трейлинге. | `5` |
| `IndentPips` | Дополнительный отступ от максимума/минимума. | `0` |
| `AllowedSpreadPoints` | Максимальный допустимый спред в шагах цены (`PriceStep`). | `5` |
| `CandleType` | Тип свечей, используемый для анализа. | `таймфрейм 1 час` |

## Особенности
* Пересчёт пипсов учитывает формат цены: для инструментов с 3 или 5 знаками пип равен десяти шагам цены.
* Из-за обработки на уровне свечей невозможно определить очередность пробоя верхнего и нижнего уровня внутри одного бара, поэтому такие бары пропускаются.
* Стратегия не создаёт стоп-заявок на бирже: выходы выполняются рыночными ордерами, что упрощает перенос между брокерами и тестирование.
