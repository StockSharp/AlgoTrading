# Breakdown Catcher 策略

## 概述
Breakdown Catcher 策略来自 MetaTrader 专家顾问“Breakdown catcher”，在每根 K 线收盘时记录该 K 线的高点和低点，并在其上下分别设置突破触发价（可选附加点差）。当下一根 K 线突破任一触发价时，策略按突破方向建立市价仓位，并按照设置的点数立即计算止损、止盈以及（可选的）跟踪止损。

## 交易逻辑
1. 每根 K 线收盘后，上一根 K 线的最高价和最低价成为下一周期的观察区间。
2. 买入突破价 = 上一高点 + 偏移点数；卖出突破价 = 上一低点 − 偏移点数。
3. 若当前 K 线向上突破且当前没有仓位，则以市场价建立多头仓位，并保存新的保护参数。
4. 若向下突破且为空仓，则以市场价建立空头仓位。
5. 止损与止盈距离以点（pip）为单位，并依据品种最小报价单位和 3/5 位小数的常见调整换算成绝对价格。
6. 当盈利幅度达到 `TrailingStop + TrailingStep` 点时，启动跟踪止损；只有在价格继续前进达到最小步长后才会重新移动止损位。
7. 如果同一根 K 线同时触及上下两个突破价，为避免执行顺序不确定，该 K 线不产生交易。
8. 进入交易前会检测当前点差，当点差大于 `AllowedSpreadPoints`（以价格步长计）时，跳过信号。

## 资金管理
* 下单数量使用基础属性 `Strategy.Volume`。反向开仓时，会在基础数量上加上当前仓位的绝对值以实现完全反手。
* 止损、止盈与跟踪止损通过检测 K 线范围触发后直接发送市价平仓指令完成，而不是依赖券商端的委托单。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `StopLossPips` | 止损距离（点）。 | `30` |
| `TakeProfitPips` | 止盈距离（点）。 | `90` |
| `TrailingStopPips` | 跟踪止损距离（点），为 `0` 时关闭跟踪。 | `30` |
| `TrailingStepPips` | 移动跟踪止损所需的额外进展（点），启用跟踪时必须大于 0。 | `5` |
| `IndentPips` | 在突破价上附加的偏移点数。 | `0` |
| `AllowedSpreadPoints` | 允许的最大点差，单位为价格步长。 | `5` |
| `CandleType` | 用于分析的 K 线类型。 | `1 小时周期` |

## 注意事项
* Pip 换算遵循原策略规则：若品种报价保留 3 或 5 位小数，则 1 pip 等于 10 个价格步长。
* 由于策略基于 K 线事件，无法确定同一根 K 线中先触及哪个突破价，因此会跳过此类情况。
* 所有保护性退出均采用市价指令，便于跨券商部署和回测复现。
