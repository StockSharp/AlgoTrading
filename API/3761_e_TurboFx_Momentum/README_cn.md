# e-TurboFx 动量策略

## 概述
**e-TurboFx** 是原始 MetaTrader 4 智能交易系统的移植版本。策略会检查最近收盘的蜡烛线，寻找蜡烛实体持续扩大的趋势段。若连续出现实体不断放大的空头蜡烛，说明下跌动能正在衰竭，可以考虑做多；若连续出现实体不断放大的多头蜡烛，则意味着上涨过度，可以尝试做空。StockSharp 版本通过蜡烛订阅保持事件驱动结构，并可选地自动附加止损和止盈。

## 交易逻辑
1. 订阅可配置的蜡烛类型，仅处理 `CandleStates.Finished` 的蜡烛。
2. 分别维护多头和空头两个序列计数器。
3. 计算每根蜡烛的实体长度 `|Close - Open|`。
4. 一旦出现反向收盘的蜡烛，就重置对应的反方向序列。
5. 序列内部要求实体严格放大：新蜡烛的实体必须大于上一根，同方向实体缩小时序列会重置为 1。
6. 当某个序列的计数达到 `DepthAnalysis`，在该序列的反方向发出市价订单（空头序列触发买入，多头序列触发卖出）。
7. 有持仓时暂停信号检测，等待回到空仓再重新开始。`StartProtection` 在启动时只调用一次，可按价格步长配置止损/止盈，输入 0 表示关闭。

这种实现方式完整复刻了 MQL4 脚本：它逐根检查最近的 `N` 根蜡烛，确认方向相同且实体逐渐变大。

## 实现细节
- 使用高层 API：`SubscribeCandles` 与 `Bind`，无自建集合或历史遍历，符合项目要求。
- 状态信息保存在四个字段中（`_bearishSequence`、`_bullishSequence`、`_previousBearishBody`、`_previousBullishBody`），避免额外的列表或队列。
- 保护模块只在 `OnStarted` 中配置一次，支持按步长设置止损与止盈；与原策略一致，填 0 即表示不下达对应委托。
- 源码中提供了详细的英文注释，说明何时重置序列、何时触发交易。
- 在 Designer 或 UI 中运行时，会绘制蜡烛及自身成交，方便验证行为。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `DepthAnalysis` | 需要多少根同向且实体递增的蜡烛才会触发交易。 | `3` |
| `TakeProfitSteps` | 止盈距离（价格步长），设置为 `0` 时关闭。 | `120` |
| `StopLossSteps` | 止损距离（价格步长），设置为 `0` 时关闭。 | `70` |
| `TradeVolume` | 每次市价单的交易量，同时会更新基础 `Strategy.Volume`。 | `0.1` |
| `CandleType` | 用于分析的蜡烛类型（时间框架）。 | `1 hour` |

所有数值型参数都包含优化元数据，可直接在 StockSharp 优化器中调整。

## 注意事项
- 策略对蜡烛实体敏感，因此时间框架越短，信号越频繁，但保护距离也需相应调整。
- 请确保交易工具提供有效的 `PriceStep`，否则步长无法转换为真实价格距离。
- 建议在实盘前先在 Designer 中回测，确认止损和止盈距离符合预期。
- 策略一次只持有一笔仓位。平仓后计数器会重置，必须重新累积新的序列才能再次交易，这与原版行为一致。
