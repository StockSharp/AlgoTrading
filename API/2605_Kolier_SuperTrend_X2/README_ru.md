# Стратегия Kolier SuperTrend X2

## Обзор
Стратегия повторяет оригинальный эксперт MetaTrader, сочетая два фильтра SuperTrend на разных таймфреймах. SuperTrend старшего таймфрейма определяет доминирующее направление рынка, а SuperTrend младшего таймфрейма ищет синхронные развороты для входов. В портировании на StockSharp используются привязки высокоуровневого API, поэтому индикаторы получают свечи напрямую и ведут собственную историю.

## Логика торговли
- **Фильтр тренда:** SuperTrend старшего таймфрейма должен подтвердить восходящий или нисходящий тренд. Задержка подтверждения задаётся параметром `TrendSignalShift`, а режим (`TrendMode`) определяет, нужна ли всего одна свеча (`NewWay`) либо два последовательных бара (остальные режимы).
- **Сигналы входа:** SuperTrend младшего таймфрейма ждёт смены направления в сторону текущего фильтра. Параметр `EntrySignalShift` откладывает момент оценки до закрытых баров, а `EntryMode` определяет реакцию сразу после смены (`NewWay`) либо только после подтверждённого разворота (прочие режимы).
- **Лонг:** допускается, если `EnableBuyEntries = true`, трендовый фильтр бычий и входной SuperTrend переключился вверх в соответствии с выбранным режимом. Перед открытием закрывается возможная короткая позиция, затем покупается объём `Volume + |Position|`.
- **Шорт:** допускается, если `EnableSellEntries = true`, трендовый фильтр медвежий и входной SuperTrend переключился вниз. Перед входом закрывается длинная позиция.
- **Выходы:**
  - Разворот на старшем таймфрейме закрывает лонги (`CloseBuyOnTrendFlip`) или шорты (`CloseSellOnTrendFlip`).
  - Смена направления на младшем таймфрейме закрывает позиции при включении `CloseBuyOnEntryFlip`/`CloseSellOnEntryFlip`.
  - Опциональные фиксированные стопы (`StopLossPoints`, `TakeProfitPoints`) рассчитываются в кратных `Security.PriceStep`.

## Индикаторы
- Два экземпляра StockSharp `SuperTrend` (один для фильтра тренда, второй для входов).

## Параметры
- `TrendCandleType` – таймфрейм фильтра тренда.
- `EntryCandleType` – таймфрейм сигналов входа.
- `TrendAtrPeriod`, `TrendAtrMultiplier` – настройки ATR для трендового SuperTrend.
- `EntryAtrPeriod`, `EntryAtrMultiplier` – настройки ATR для входного SuperTrend.
- `TrendMode`, `EntryMode` – режимы подтверждения: `NewWay` реагирует после одного бара, остальные требуют два подряд (Visual и ExpertSignal в порте работают как классический SuperTrend).
- `TrendSignalShift`, `EntrySignalShift` – количество закрытых баров до использования значений индикаторов.
- `EnableBuyEntries`, `EnableSellEntries` – разрешения на лонги и шорты.
- `CloseBuyOnTrendFlip`, `CloseSellOnTrendFlip` – выход по сигналу противоположного тренда.
- `CloseBuyOnEntryFlip`, `CloseSellOnEntryFlip` – выход по смене направления на входном таймфрейме.
- `StopLossPoints`, `TakeProfitPoints` – расстояния защитных ордеров в шагах цены (0 отключает уровни).
- `Volume` – базовый объём сделок.
- `Slippage` – параметр-заглушка, оставленный для совместимости с оригиналом.

## Примечания
- Порт использует высокоуровневый рабочий процесс StockSharp: подписка на свечи через `SubscribeCandles`, привязка индикаторов `BindEx`, хранение только минимального состояния (направление тренда и актуальные стопы).
- Метод `StartProtection()` вызывается один раз для активации стандартной защиты позиций StockSharp.
