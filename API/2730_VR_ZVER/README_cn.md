# VR ZVER 策略

## 概述
VR ZVER 策略是一套趋势跟随系统，同时使用三层确认：快速/慢速/超慢速 EMA 结构、随机指标和 RSI。只有当所有启用的过滤器同时满足方向条件时才会开仓，从而在行情震荡或信号矛盾时保持观望。本转换版保留了原有的盈亏平衡和保护性逻辑，并基于 StockSharp 的高级 API 实现。

## 市场状态识别
1. **EMA 结构**：默认使用周期 3、5、7 的指数移动平均线。做多时要求快线在慢线之上、慢线在超慢线之上；做空则完全相反。
2. **随机指标**：同时检查 %K/%D 的位置与顺序。做多需要 %K 低于下轨且高于 %D，表示超卖反弹；做空需要 %K 高于上轨且低于 %D，指示超买回落。
3. **RSI 过滤**：RSI 必须低于下限才允许做多，高于上限才允许做空。

只有当所有激活的过滤器一致时，策略才会按照设定的交易量发送市价单。

## 风险控制
- **止损**：依据 `StopLossPips` 配合品种点值计算止损价。多头在 K 线最低价跌破止损时离场，空头在最高价突破止损时离场。
- **止盈**：同步设置等距止盈。若当前 K 线触及目标价位，立即平仓。
- **保本保护**：价格推进达到 `BreakevenPips` 后启动保本机制，若回撤到入场价则马上平仓以保护资金。
- **订单清理**：每次建仓前都会取消所有挂单，防止无意叠加。

## 参数说明
| 参数 | 说明 |
|------|------|
| `CandleType` | 计算所使用的 K 线类型。 |
| `UseMovingAverage` | 是否启用 EMA 趋势过滤。 |
| `FastMaPeriod`、`SlowMaPeriod`、`VerySlowMaPeriod` | 快速、慢速、超慢速 EMA 的周期。 |
| `UseStochastic` | 是否启用随机指标过滤。 |
| `StochasticKPeriod`、`StochasticDPeriod`、`StochasticSlowing` | 随机指标各项周期参数。 |
| `StochasticUpperLevel`、`StochasticLowerLevel` | %K 的超买/超卖阈值。 |
| `UseRsi` | 是否启用 RSI 过滤。 |
| `RsiPeriod` | RSI 平滑周期。 |
| `RsiUpperLevel`、`RsiLowerLevel` | RSI 的超买/超卖阈值。 |
| `StopLossPips`、`TakeProfitPips` | 止损与止盈的点数距离。 |
| `BreakevenPips` | 触发保本的点数距离。 |
| `Volume` | 每次下单的交易数量。 |

## 实现细节
- 点值根据合约的最小报价步长和小数位数自动推导，若小数位为 3 或 5，会应用原始 MQL 脚本中的 10 倍调整。
- 全部指标数据通过 `BindEx` 绑定，只在蜡烛收盘并且指标值最终确认后才会执行决策。
- 策略只会保持单向持仓，任何反向信号都会先平掉当前仓位再考虑入场。
