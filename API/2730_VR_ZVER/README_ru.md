# Стратегия VR ZVER

## Общее описание
VR ZVER — это трендовая стратегия, в которой задействованы три уровня фильтрации: связка экспоненциальных средних (быстрая, медленная и очень медленная), осциллятор Stochastic и индикатор RSI. Сделка открывается только тогда, когда все активированные фильтры подтверждают одно и то же направление. Такой подход позволяет избегать сделок в период рыночного шума и противоречивых сигналов. При переносе на StockSharp сохранены исходные правила перевода позиции в безубыток и защитного выхода.

## Определение рыночного режима
1. **Структура EMA** — по умолчанию используются EMA с периодами 3, 5 и 7. Для лонга требуется, чтобы быстрая EMA находилась выше медленной, а медленная выше самой медленной. Для шорта условия зеркальные.
2. **Стохастик** — анализируются и относительное положение линий %K/%D, и их нахождение относительно уровней. Для покупок %K должна быть ниже нижнего порога и выше %D, что указывает на выход из перепроданности. Для продаж %K должна находиться выше верхнего порога и ниже %D.
3. **RSI** — индикатор должен быть ниже нижнего уровня для покупок или выше верхнего уровня для продаж.

Только при согласованности всех фильтров стратегия отправляет рыночный ордер с заданным объёмом.

## Управление рисками
- **Стоп-лосс** — рассчитывается на основе параметра `StopLossPips` и размера пункта инструмента. Лонг закрывается, если минимум свечи пробивает стоп, шорт — если максимум свечи пересекает стоповый уровень.
- **Тейк-профит** — выставляется симметрично. При достижении целевой цены в пределах текущей свечи позиция фиксируется.
- **Перевод в безубыток** — после прохождения расстояния `BreakevenPips` стратегия включает режим защиты: возврат цены к точке входа закрывает сделку в ноль.
- **Очистка заявок** — перед открытием нового входа отменяются все активные ордера.

## Параметры
| Параметр | Описание |
|----------|----------|
| `CandleType` | Тип свечей, используемых в расчётах. |
| `UseMovingAverage` | Включение/выключение фильтра на основе EMA. |
| `FastMaPeriod`, `SlowMaPeriod`, `VerySlowMaPeriod` | Периоды для быстрой, медленной и очень медленной EMA. |
| `UseStochastic` | Включение фильтра на основе стохастика. |
| `StochasticKPeriod`, `StochasticDPeriod`, `StochasticSlowing` | Настройки периодов стохастика. |
| `StochasticUpperLevel`, `StochasticLowerLevel` | Границы перекупленности/перепроданности для %K. |
| `UseRsi` | Включение фильтра RSI. |
| `RsiPeriod` | Период сглаживания RSI. |
| `RsiUpperLevel`, `RsiLowerLevel` | Уровни перекупленности и перепроданности для RSI. |
| `StopLossPips`, `TakeProfitPips` | Расстояние до стоп-лосса и тейк-профита в пунктах. |
| `BreakevenPips` | Дистанция до активации режима безубытка. |
| `Volume` | Объём сделки при отправке рыночного ордера. |

## Особенности реализации
- Размер пункта автоматически рассчитывается исходя из шага цены и количества знаков после запятой. Для инструментов с 3 или 5 знаками применяется стандартный коэффициент ×10, как и в оригинальном MQL-советнике.
- Индикаторы подключаются через `BindEx`, поэтому логика срабатывает только на полностью сформированных свечах.
- Стратегия всегда выравнивает текущую позицию перед сменой направления, что исключает наложение противоположных сделок.
