# Стратегия Stop Loss Take Profit
[English](README.md) | [中文](README_cn.md)

Перенос советника MetaTrader «Stop Loss Take Profit». Стратегия подбрасывает монету, когда позиция отсутствует, и открывает сделку в выбранном направлении по рынку. Сразу после исполнения выставляются стоп-лосс и тейк-профит в пипсах. При срабатывании стопа следующий вход увеличивает объём вдвое (в пределах ограничений инструмента), а тейк-профит возвращает объём к исходному. Такой подход повторяет мартингейл в оригинале, но реализован через высокоуровневый API StockSharp.

## Логика торговли

- **Рынок данных**: Используется параметр `CandleType` (по умолчанию минутные свечи) для точек принятия решений.
- **Правила входа**:
  - При `Position == 0` и отсутствии активной заявки генерируется псевдослучайный булев флаг.
  - `true` — покупка через `BuyMarket(volume)`, `false` — продажа через `SellMarket(volume)`.
- **Правила выхода**:
  - Защитные стоп и тейк регистрируются сразу после получения сделки.
  - Срабатывание стопа удваивает объём следующей позиции, тейк возвращает его к стартовому значению.
  - Если расстояние до стопа или тейка равно `0`, соответствующий ордер не ставится.
- **Управление объёмом**:
  - `InitialVolume` задаёт базовый размер заявки.
  - После убыточной сделки объём удваивается, но ограничивается `Security.MaxVolume`, если значение задано.
  - Объём нормализуется по `VolumeStep`, `MinVolume` и `MaxVolume`, чтобы заявки всегда проходили проверку брокера.
- **Обработка пипсов**:
  - По умолчанию пип вычисляется из `PriceStep` и `Decimals` инструмента (для пяти знаков это 0.0001).
  - Параметр `PipSize` позволяет вручную задать размер пипса в абсолютных ценовых единицах.

## Параметры

| Имя | Значение по умолчанию | Описание |
| --- | --------------------- | -------- |
| `CandleType` | минутные свечи | Таймфрейм, на котором генерируются сигналы. |
| `StopLossPips` | 1 | Расстояние до стоп-лосса в пипсах. Значение `0` отключает стоп. |
| `TakeProfitPips` | 1 | Расстояние до тейк-профита в пипсах. Значение `0` отключает тейк. |
| `InitialVolume` | 0.01 | Начальный объём сделки. Удваивается после стопа и сбрасывается после профита. |
| `PipSize` | 0 (авто) | Необязательный ручной размер пипса в абсолютных единицах цены. |

## Особенности использования

- Работает в обе стороны и изначально нейтральна к направлению рынка.
- Защитные ордера отменяются при закрытии позиции, чтобы не оставалось «хвостов».
- Генератор случайных чисел инициализируется `Environment.TickCount`, поэтому последовательность сделок меняется от запуска к запуску.
- Подходит для демонстрации управления риском и мартингейла, но требует дополнительных фильтров перед промышленным применением.
