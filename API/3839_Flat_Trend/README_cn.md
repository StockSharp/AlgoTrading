# 平滑趋势策略

## 概述
**平滑趋势策略** 通过多速率趋势过滤器、ADX 强度确认以及标准差 “juice” 波动性过滤器，重现了原 Flat Trend 专家的核心思想。策略关注价格脱离盘整并出现动量扩张的瞬间，以动态风控方式参与趋势行情。

## 交易逻辑
1. **趋势过滤器** – 三条可配置周期的指数移动平均线（EMA）分别作为触发线、第一过滤线和第二过滤线。根据价格相对 EMA 的位置以及 EMA 的斜率为每条 EMA 定义状态：
   - 强势多头：价格在 EMA 之上且 EMA 向上倾斜。
   - 温和多头：价格在 EMA 之上但斜率趋于平缓。
   - 强势空头：价格在 EMA 之下且 EMA 向下倾斜。
   - 温和空头：价格在 EMA 之下但斜率趋于平缓。
2. **入场规则**
   - 做多必须得到触发 EMA 与第一过滤 EMA 的多头状态确认，可选地要求第二过滤 EMA 也满足条件。
   - 做空规则与多头对称。
   - 可选的 ADX 过滤器要求平均方向性指数超过阈值，并在启用方向过滤时确认 +DI 与 −DI 的顺势关系。
   - “juice” 过滤器验证标准差高于阈值，避免在波动极低的阶段交易。
   - 可选的交易时间窗口可限制策略只在特定小时段内运行。
3. **离场规则**
   - 当触发 EMA 出现反向状态时离场；若启用严格模式则等待最强的反向信号。
   - 动态止损在价格触及虚拟止损水平时立即平仓。

## 风险控制
- **初始止损** – 可以使用固定点数，也可以参考平均真实波幅（ATR）动态调整，模拟原策略的 ADR 止损逻辑。
- **移动止损** – 使用 ATR 乘以除数，根据入场后的最高价或最低价不断跟踪。
- **保本** – 当价格达到设定的盈利距离后，将止损移动到入场价之上（或之下）并锁定一小段利润。

## 参数列表
| 参数 | 说明 |
| --- | --- |
| `TriggerLength` | 触发 EMA 的周期。 |
| `FilterLength1` | 第一过滤 EMA 的周期。 |
| `FilterLength2` | 第二过滤 EMA 的周期。 |
| `UseOnlyPrimaryIndicators` | 仅使用触发和第一过滤 EMA 进行判定。 |
| `IgnoreModerateForEntry` | 入场时只接受强势趋势状态。 |
| `IgnoreModerateForExit` | 离场时只接受强势反向信号。 |
| `UseTradingHours` | 启用交易时间过滤。 |
| `TradingHourBegin` / `TradingHourEnd` | 交易窗口的开始和结束小时。 |
| `UseJuiceFilter`、`JuicePeriod`、`JuiceThreshold` | 标准差 “juice” 过滤器设置。 |
| `UseAdxFilter`、`AdxPeriod`、`AdxThreshold`、`UseDirectionalFilter` | ADX 强度与方向过滤设置。 |
| `UseAdrForStop`、`StopLossPips` | 初始止损设置。 |
| `TrailingDivisor` | 移动止损使用的 ATR 乘数。 |
| `BreakEvenPips`、`BreakEvenLockPips` | 保本触发距离与锁定利润。 |
| `AtrPeriod` | ATR 波动性估算周期。 |
| `CandleType` | 使用的主图周期。 |

## 指标组合
- **指数移动平均线（EMA）** – 三条不同周期用于趋势判定。
- **标准差** – 实现 "juice" 波动性突破过滤。
- **平均真实波幅（ATR）** – 测量波动用于止损与移动止损。
- **平均方向性指数（ADX）** – 确认趋势强度并配合 +DI / −DI。

## 使用建议
1. 确保交易品种具有 `PriceStep` 定义；若缺失，策略将默认使用 0.0001 作为点值计算基础。
2. 策略通过市价单 (`BuyMarket`/`SellMarket`) 入场，并在反向时自动平掉已有仓位后再开新仓。
3. 动态止损为内部模拟，一旦价格越过虚拟止损水平立即平仓。
4. 合理设置交易时间窗口与严格模式，可帮助聚焦流动性充足的交易时段并减少震荡行情影响。
