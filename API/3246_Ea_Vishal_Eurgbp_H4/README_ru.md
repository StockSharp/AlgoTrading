# Стратегия EA Vishal EURGBP H4

## Обзор
**EA Vishal EURGBP H4** — это перенос оригинального советника MetaTrader, сочетающего вход по пересечению стохастика и выход по пробою полос Envelope. Стратегия работает с четырёхчасовыми свечами (по умолчанию) и задействует виртуальные уровни риска в пунктах (стоп-лосс, тейк-профит и опциональный трейлинг-стоп), чтобы максимально точно воспроизвести поведение MT4 на открытии новых баров.

## Логика торговли
- **Вход** – анализируются две последние завершённые свечи. Если линия %K стохастика пересекает %D сверху вниз между барами *n-2* и *n-1*, открывается длинная позиция; обратное пересечение формирует короткую. Одновременно поддерживается только одна позиция.
- **Выход** – управление позицией происходит в несколько этапов:
  1. **Пробой Envelope** – если следующая свеча открывается за пределами предыдущей полосы, тогда как ещё одна свеча назад открывалась внутри, позиция закрывается.
  2. **Виртуальные стоп-уровни** – стоп-лосс и тейк-профит рассчитываются от цены входа с учётом выбранного расстояния в пунктах и исполняются рыночными ордерами при достижении.
  3. **Опциональный трейлинг** – при включении и наличии стоп-лосса уровень подтягивается к максимуму/минимуму предыдущего бара с поправкой на стоп-расстояние.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --------------------- | -------- |
| `Volume` | 0.5 | Объём сделки в лотах. |
| `StopLossPips` | 0 | Расстояние до стоп-лосса в пунктах (0 — без стопа). |
| `TakeProfitPips` | 22 | Расстояние до тейк-профита в пунктах (0 — без цели). |
| `UseTrailingStop` | false | Включает виртуальный трейлинг-стоп (требует `StopLossPips` &gt; 0). |
| `StochasticKPeriod` | 6 | Длина расчёта %K стохастика. |
| `StochasticDPeriod` | 3 | Период сглаживания %D. |
| `StochasticSlowing` | 1 | Коэффициент замедления %K. |
| `EnvelopePeriod` | 32 | Период SMA, служащей базой для Envelope. |
| `EnvelopeDeviationPercent` | 0.3 | Отклонение полос Envelope в процентах от SMA. |
| `CandleType` | H4 | Тип свечей, используемых стратегией (по умолчанию 4 часа). |

## Дополнительно
- Все параметры доступны для оптимизации в StockSharp Studio.
- Стопы и цели контролируются виртуально и приводят к закрытию позиции при пересечении диапазона свечи, как в оригинальном советнике.
- Работа только с завершёнными свечами обеспечивает повторяемость результатов в тестах и на реальном рынке.
