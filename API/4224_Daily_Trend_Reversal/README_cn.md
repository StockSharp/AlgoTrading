# Daily Trend Reversal

## 概述
Daily Trend Reversal 是 MetaTrader 4 策略 `dailyTrendReversal_D1` 的移植版本。策略以当日的开盘价、最高价和最低价为参照，只在价格行为与商品通道指数（CCI）共同指向同一方向时参与交易。策略限定在可配置的 GMT 交易时段内执行，达到每日盈利目标后可以自动停止，并在过滤条件反向时立即平仓。

## 策略逻辑
### 日内偏向过滤
* **阶梯过滤** —— 最多三个条件用于验证当天的趋势：
  1. 当前价格到当日极值的距离必须大于设定的风险阈值（以点为单位）。
  2. 当日开盘价到另一侧极值的距离也必须大于风险阈值，同时当前价格需保持在开盘价上下 10 点以内。
  3. （可选）当前 K 线需要在趋势方向上收盘，并且价格仍位于开盘价上下 10 点以内。
* **区间主导** —— 比较开盘价到最高价与开盘价到最低价的距离，较长的一侧定义当前趋势。
* **CCI 趋势** —— 最近三个已完成的 CCI 数值需单调上升（做多）或单调下降（做空）。

### 入场规则
* **做多**
  * 仅在交易时段内且为工作日时启用。
  * 价格高于开盘价，阶梯过滤判定为上升趋势，区间主导与 CCI 同时指向上行。
  * 仅在当前净头寸为空或为空头时开多（若存在空头仓位，会在建多时反向买入平仓）。
* **做空**
  * 条件镜像：价格低于开盘价，阶梯过滤、区间主导和 CCI 均确认下行趋势。
  * 仅在净头寸为空或为多头时开空。

### 出场规则
* **固定止盈 / 止损** —— 以点数定义相对入场价的距离，填 `0` 表示关闭。
* **时段与持仓控制** —— 到达收盘时间或超过持仓时长后，盈利仓位立即平仓；亏损仓位进入保本模式，价格回到入场价即退出。
* **反向平仓（可选）** —— 启用后，当下行条件满足（价格跌破开盘价，日内和 CCI 均转空）时多单立即离场；空单规则相反。
* **每日 Profit Stop** —— 将当日已实现收益与浮动盈亏相加，达到阈值后全部平仓并暂停开仓，直至手动重新开启。

## 参数说明
* **Auto Trading** —— 是否允许自动开仓。
* **Reversal Exit** —— 是否在趋势反转时立即平仓。
* **Trend Steps** —— 需要满足的过滤步骤数量（1–3）。
* **Volume** —— 市价单的下单数量。
* **Take Profit (pips)** —— 止盈距离，`0` 表示关闭。
* **Stop Loss (pips)** —— 止损距离，`0` 表示关闭。
* **Profit Stop** —— 每日盈利目标（价格单位），`0` 表示不限制。
* **GMT Diff** —— 图表时间减去 GMT 的小时差，用于换算交易时段。
* **Start Hour / End Hour** —— 允许开仓的 GMT 小时范围。
* **Closing Hour** —— GMT 收盘小时，之后策略会平仓或转入保本模式。
* **Holding Hours** —— 单笔交易允许的最长持仓时间。
* **Risk (pips)** —— 阶梯过滤使用的风险阈值（点）。
* **CCI Period** —— CCI 指标的周期长度。
* **Candle Type** —— 计算所用的时间框架（默认 15 分钟 K 线）。

## 其他说明
* 策略根据标的的最小报价步长自动识别点值，能够适配 5 位和 3 位报价的外汇品种。
* 每个新交易日的第一根 K 线会重置当日盈亏基准，重新计算每日 Profit Stop。
* 本目录仅提供 C# 实现，暂不包含 Python 版本。
