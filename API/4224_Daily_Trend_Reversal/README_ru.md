# Daily Trend Reversal

## Обзор
Daily Trend Reversal — порт советника MetaTrader 4 `dailyTrendReversal_D1`. Стратегия ориентирует внутридневную торговлю на текущие дневные уровни открытия, максимума и минимума. Сделки разрешаются только тогда, когда ценовое движение и индикатор Commodity Channel Index (CCI) подтверждают одно направление. Торговля ограничена настраиваемой GMT-сессией, может быть приостановлена после достижения дневной цели по прибыли и умеет немедленно выходить из позиции при смене фильтров на противоположный тренд.

## Логика стратегии
### Фильтры дневного смещения
* **Пошаговый фильтр** — до трёх условий проверяют силу дневного импульса:
  1. Расстояние от текущей цены до дневного экстремума должно превышать заданный риск (в пунктах).
  2. Расстояние от цены открытия до противоположного экстремума также должно быть больше риска, а текущая цена обязана оставаться в пределах 10 пунктов от дневного открытия.
  3. (Опционально) Текущая свеча должна закрыться в сторону тренда, пока цена остаётся не далее 10 пунктов от открытия дня.
* **Доминирование диапазона** — сравнивает длину движения вверх (open → high) и вниз (open → low); преобладающая сторона определяет активный тренд.
* **Тренд CCI** — три последних завершённых значения CCI должны монотонно расти (для лонга) или падать (для шорта).

### Правила входа
* **Лонги**
  * Разрешены только в пределах торгового окна (GMT) и по будням.
  * Цена выше дневного открытия, пошаговый фильтр подтверждает восходящее направление, доминирование диапазона указывает вверх, а тренд CCI растущий.
  * Позиция открывается лишь тогда, когда текущая чистая позиция нулевая или короткая (при наличии шорта он перекрывается входом в лонг).
* **Шорты**
  * Зеркальные условия: цена ниже открытия, пошаговый фильтр показывает спад, доминирование диапазона — вниз, CCI снижается.
  * Открывается при нулевой или длинной позиции.

### Правила выхода
* **Фиксированные TP/SL** — задаются в пунктах относительно цены входа; значение `0` отключает соответствующий уровень.
* **Контроль сессии и времени удержания** — после наступления времени закрытия (GMT) или по истечении лимита удержания прибыльные сделки закрываются. Убыточные позиции переводятся в режим безубытка и закрываются при возврате к цене входа.
* **Выход по развороту (опционально)** — при включении лонг закрывается, когда фильтры переходят в «медвежий» режим (цена ниже открытия, дневной и CCI-тренд вниз). Для шорта условия зеркальны.
* **Дневной Profit Stop** — суммирует реализованную прибыль с начала дня и текущий плавающий результат. При достижении порога все позиции закрываются, новые входы блокируются до ручного повторного включения.

## Параметры
* **Auto Trading** — разрешает или запрещает автоматическое открытие сделок.
* **Reversal Exit** — включает мгновенное закрытие при появлении противоположного тренда.
* **Trend Steps** — количество шагов фильтра (от 1 до 3), необходимых для подтверждения тренда.
* **Volume** — объём заявок при входе по рынку.
* **Take Profit (pips)** — расстояние до цели, `0` отключает.
* **Stop Loss (pips)** — расстояние до стоп-лосса, `0` отключает.
* **Profit Stop** — дневная цель по прибыли (в ценовых единицах); `0` — без ограничения.
* **GMT Diff** — разница между временем графика и GMT в часах.
* **Start Hour / End Hour** — границы торгового окна в часах GMT.
* **Closing Hour** — час GMT, после которого стратегия закрывает или страхует активные позиции.
* **Holding Hours** — максимальное время удержания позиции до срабатывания логики сессии.
* **Risk (pips)** — порог в пунктах, используемый в пошаговом фильтре.
* **CCI Period** — период индикатора CCI.
* **Candle Type** — таймфрейм расчётов (по умолчанию 15-минутные свечи).

## Дополнительная информация
* Размер пункта определяется автоматически на основе шага цены инструмента; для пяти- и трёхзнаковых валютных пар пороги переводятся в корректные приращения.
* Дневная прибыль пересчитывается при первой свече нового торгового дня — текущее значение PnL фиксируется как базовое.
* В составе пакета представлена только C#-реализация; версия на Python отсутствует.
