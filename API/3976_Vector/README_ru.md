# Стратегия Vector (порт из MT4)

В этой папке находится реализация советника **Vector** из MetaTrader 4 (`MQL/8305/Vector.mq4`), переписанная на высокоуровневом API StockSharp. Стратегия одновременно анализирует до четырёх валютных пар (основная EURUSD и дополнительные GBPUSD, USDCHF, USDJPY) и открывает позиции только при согласованном направлении тренда.

## Логика торговли

1. **Сглаженные скользящие средние (SMMA)** – для каждого инструмента рассчитываются две SMMA: быстрая с периодом 3 и медленная с периодом 7. Используются медианные цены свечей выбранного таймфрейма (по умолчанию 15 минут).
2. **Векторное суммирование тренда** – разницы между быстрыми и медленными SMA по всем доступным инструментам суммируются. Положительный итог означает синхронное восходящее движение, отрицательный – общее снижение.
3. **Правила входа** – сделки совершаются рыночными ордерами, когда выполняются условия:
   - Суммарный тренд положительный и быстрая SMMA инструмента выше медленной (покупка).
   - Суммарный тренд отрицательный и быстрая SMMA ниже медленной (продажа).
4. **Цель по пипсам от свечи H4** – для каждого инструмента дополнительно подписывается 4-часовой таймфрейм. Пятая часть диапазона последней H4-свечи (но не более 13 пунктов) задаёт целевую прибыль по позиции, что повторяет подход из оригинального советника.
5. **Глобальный контроль капитала** – параметры `TakeProfitPercent` и `MaxDrawdownPercent` закрывают все позиции при достижении заданной прибыли или просадки по портфелю.

## Отличия от оригинального советника

- Используются **подписки на свечи и связывание индикаторов** (`SubscribeCandles().Bind(...)`), вместо опроса истории как в MT4.
- Дополнительные инструменты становятся **необязательными параметрами** – можно торговать только основную пару или подключить весь набор.
- Расчёт объёма от свободной маржи заменён параметром `BaseVolume`, который автоматически нормализуется по шагу и минимальному объёму конкретного инструмента.
- Цена входа хранится через события `OnNewMyTrade`, что соответствует ограничениям по использованию индикаторов в StockSharp.

## Параметры

| Имя | Значение по умолчанию | Описание |
| --- | --------------------- | -------- |
| `CandleType` | `TimeSpan.FromMinutes(15)` | Таймфрейм для расчёта SMMA и условий входа. |
| `RangeCandleType` | `TimeSpan.FromHours(4)` | Старший таймфрейм для вычисления целевого количества пунктов. |
| `SecondSecurity` | `null` | Дополнительный инструмент (обычно GBPUSD). |
| `ThirdSecurity` | `null` | Дополнительный инструмент (обычно USDCHF). |
| `FourthSecurity` | `null` | Дополнительный инструмент (обычно USDJPY). |
| `BaseVolume` | `1` | Запрашиваемый объём сделки, нормализуется под ограничения биржи. |
| `TakeProfitPercent` | `0.5` | Рост капитала в процентах, при котором закрываются все позиции. |
| `MaxDrawdownPercent` | `30` | Допустимая просадка капитала в процентах перед принудительным закрытием. |

## Рекомендации

- Перед запуском привяжите к стратегии портфель и коннектор, доступные для всех указанных инструментов.
- Проверьте, что источник данных отдаёт свечи обоих таймфреймов для каждой валютной пары.
- Если дополнительные инструменты не заданы, расчёт суммарного тренда автоматически адаптируется к оставшимся данным.
- Выход всегда выполняется рыночными ордерами, как и в исходном советнике.

## Содержимое

- `CS/VectorStrategy.cs` — реализация стратегии на C#.
- `README.md`, `README_ru.md`, `README_cn.md` — подробное описание на английском, русском и китайском языках.
