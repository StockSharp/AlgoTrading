# Стратегия Color JFATL Digit TM

## Общая информация
**Color JFATL Digit TM** — это перенос оригинального эксперта MetaTrader 5. Стратегия использует фильтр FATL (Fast Adaptive Trend Line), сглаженный индикатором Jurik, и реагирует на изменения «цвета» наклона линии. Каждый завершённый бар классифицируется как бычий (цвет = 2), медвежий (цвет = 0) или нейтральный (цвет = 1). Переходы между цветами запускают открытие и закрытие сделок с учётом торговых сессий и защитных стопов.

## Логика работы
1. **Воссоздание индикатора**
   - FATL вычисляется свёрткой выбранной цены с таблицей из 39 коэффициентов, как в оригинальном индикаторе.
   - Результат сглаживается `JurikMovingAverage`. Если в библиотеке StockSharp есть свойство `Phase`, оно задаётся через отражение, чтобы повторить параметры MT5.
   - Значение округляется к шагу цены умноженному на `10^DigitRounding`, что соответствует параметру `Digit` в MQL5.
   - Разница между текущим и предыдущим округлённым значением определяет цвет: рост — 2, падение — 0, отсутствие изменения — наследование предыдущего цвета (по умолчанию 1).

2. **Генерация сигналов**
   - В кольцевом буфере хранятся последние цвета. Параметр `SignalBar` задаёт, сколько закрытых баров пропустить (по умолчанию 1 — предыдущий бар).
   - **Открытие лонга**: предыдущий цвет равен 2, текущий цвет < 2.
   - **Открытие шорта**: предыдущий цвет равен 0, текущий цвет > 0.
   - **Выход из лонга**: предыдущий цвет становится 0.
   - **Выход из шорта**: предыдущий цвет становится 2.
   - Если позиция уже открыта, новые входы игнорируются, что соответствует «однопозиционному» поведению оригинального эксперта.

3. **Сессии и защита позиции**
   - Фильтр `EnableTimeFilter` полностью повторяет часовую логику MT5, включая ночные сессии (начало позже окончания).
   - При выходе за пределы торгового окна все позиции закрываются немедленно, как в исходной версии.
   - Стоп-лосс и тейк-профит задаются в пунктах, переводятся в цену через шаг цены и передаются в `StartProtection`.

## Параметры
- `OrderVolume` — объём сделки.
- `EnableTimeFilter`, `StartHour`, `StartMinute`, `EndHour`, `EndMinute` — настройки торговой сессии.
- `StopLossPoints`, `TakeProfitPoints` — расстояния защитных приказов в пунктах (0 отключает соответствующий уровень).
- `BuyOpenEnabled`, `SellOpenEnabled`, `BuyCloseEnabled`, `SellCloseEnabled` — активация сигналов на вход/выход для лонгов и шортов.
- `SignalCandleType` — таймфрейм свечей для вычисления индикатора (по умолчанию H4).
- `JmaLength`, `JmaPhase` — параметры сглаживания Jurik (фаза применяется, если поддерживается библиотекой).
- `AppliedPriceMode` — тип цены, полностью совпадающий с набором MT5 (close, open, median, trend-follow, Demark и др.).
- `DigitRounding` — множитель для округления, аналог параметра `Digit` в MQL5.
- `SignalBar` — количество закрытых баров, используемых при анализе изменения цветов.

## Особенности реализации
- Используются высокоуровневые подписки (`SubscribeCandles`) и методы `BuyMarket` / `SellMarket`, как предписывает инструкция по конверсии.
- Настройка фазы Jurik выполняется через отражение; если свойство отсутствует, применяется стандартное поведение.
- Для корректного округления необходим `Security.PriceStep`. При его отсутствии значения не квантируются.
- Python-версия не создавалась согласно требованиям.

## Как использовать
1. Подключите стратегию к инструменту и источнику данных, предоставляющему свечи `SignalCandleType`.
2. Настройте тип цены, параметры Jurik, торговый интервал и защитные расстояния.
3. Запустите стратегию — она будет управлять одной позицией, открывая и закрывая сделки по описанным цветовым сигналам и применяя стоп-лосс/тейк-профит.
