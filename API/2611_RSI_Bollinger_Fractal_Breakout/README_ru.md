# Стратегия RSI Bollinger Fractal Breakout

## Обзор
Стратегия переносит эксперт "RSI and Bollinger Bands" для MetaTrader в инфраструктуру StockSharp. Bollinger Bands строятся не по цене, а по значению RSI. После появления подтверждённого фрактала выставляются отложенные стоп-заявки с заданным отступом, а открытые позиции сопровождаются динамическим трейлингом на основе Parabolic SAR.

## Используемые индикаторы
- **RSI** (по умолчанию 8 периодов) — основной осциллятор, уровни перекупленности и перепроданности отменяют соответствующие отложенные заявки.
- **Bollinger Bands на RSI** (14 периодов, отклонение 1.0) — сигнал возникает, только когда RSI закрывается за верхней или нижней полосой.
- **Фракталы Билла Вильямса** — находятся последние подтверждённые верхний и нижний фракталы (5 свечей) и служат базовыми уровнями пробоя.
- **Parabolic SAR** (шаг 0.003, максимум 0.2) — служит источником динамического стоп-лосса после открытия позиции.

## Правила входа
1. Работа ведётся только по завершённым свечам выбранного таймфрейма (по умолчанию 4 часа).
2. При появлении **верхнего фрактала** и закрытии RSI выше **верхней полосы Bollinger** (при этом предыдущая свеча остаётся ниже фрактала) выставляется **buy stop**:
   - Цена входа = максимум фрактала + `IndentPips`.
   - Стоп-лосс = цена входа − `StopLossPips` (если значение > 0).
   - Тейк-профит = цена входа + `TakeProfitPips` (если значение > 0).
3. Симметрично при **нижнем фрактале**, RSI ниже **нижней полосы Bollinger** и закрытии выше уровня фрактала ставится **sell stop** ниже фрактала.
4. Возврат RSI внутрь канала отменяет отложенные заявки:
   - RSI < `RsiLower` удаляет buy stop.
   - RSI > `RsiUpper` удаляет sell stop.

## Управление позицией
- Фиксированные стоп-лосс и тейк-профит задаются в пипсах; значение `0` отключает соответствующую защиту.
- Parabolic SAR с учётом параметра `SarTrailingPips` подтягивает стоп только в сторону прибыли и лишь тогда, когда расстояние между ценой и SAR превышает заданный порог.
- Срабатывание трейлинг-стопа или достижение тейк-профита закрывает позицию рыночной заявкой.
- При исполнении сделки противоположные отложенные ордера отменяются, а значения стопа и тейка фиксируются для последующего сопровождения.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `RsiPeriod` | Период сглаживания RSI. | 8 |
| `BandsPeriod` | Период Bollinger по RSI. | 14 |
| `BandsDeviation` | Множитель стандартного отклонения. | 1.0 |
| `SarStep` | Шаг ускорения Parabolic SAR. | 0.003 |
| `SarMax` | Максимальное ускорение Parabolic SAR. | 0.2 |
| `TakeProfitPips` | Дистанция тейк-профита в пипсах. | 50 |
| `StopLossPips` | Дистанция стоп-лосса в пипсах. | 135 |
| `IndentPips` | Отступ от уровня фрактала при установке ордера. | 15 |
| `RsiUpper` | Уровень RSI для отмены sell stop. | 70 |
| `RsiLower` | Уровень RSI для отмены buy stop. | 30 |
| `SarTrailingPips` | Минимальное расстояние (в пипсах) между ценой и SAR для трейлинга. | 10 |
| `CandleType` | Таймфрейм обрабатываемых свечей. | 4 часа |

## Дополнительно
- Python-версия намеренно не создаётся.
- Объём позиции задаётся параметром `Volume` базовой стратегии (по умолчанию 1).
- Рекомендуемый таймфрейм соответствует оригинальному сет-файлу (`EURUSD H4`).
