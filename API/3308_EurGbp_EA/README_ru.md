# Стратегия EurGbp EA

## Обзор
Стратегия EurGbp EA повторяет оригинального советника MetaTrader: она сравнивает часовые значения MACD по парам EUR/USD и GBP/USD и совершает сделки по основному инструменту (чаще всего EUR/GBP). Таким образом отслеживается относительная сила евро и фунта, что помогает раньше увидеть движение на кроссе.

## Индикаторы
* **MACD (12, 26, 9)** для EUR/USD — используется линия сигнала и гистограмма.
* **MACD (12, 26, 9)** для GBP/USD — используется линия сигнала и гистограмма.

Обе серии рассчитываются на таймфрейме, выбранном параметром `Candle Type` (по умолчанию 1 час).

## Логика торговли
1. Подписка на свечи по основному инструменту, EUR/USD и GBP/USD.
2. Расчет сигнальных линий и гистограмм MACD для обеих валютных пар.
3. **Покупка:**
   * гистограмма EUR/USD меньше гистограммы GBP/USD;
   * сигнальная линия EUR/USD выше сигнальной линии GBP/USD;
   * нет текущей длинной позиции (либо открытый шорт будет закрыт встречной сделкой).
4. **Продажа:**
   * гистограмма GBP/USD меньше гистограммы EUR/USD;
   * сигнальная линия GBP/USD выше сигнальной линии EUR/USD;
   * нет текущей короткой позиции (либо открытый лонг закрывается встречной сделкой).
5. На каждую свечу допускается не более одной сделки в каждом направлении, чтобы исключить дублирование.
6. После входа сразу выставляются стоп-лосс и тейк-профит согласно заданным расстояниям в шагах цены.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | -------- | --------------------- |
| Candle Type | Таймфрейм для всех подписок. | 1 час |
| EURUSD Security | Инструмент с данными EUR/USD. | Требуется указать |
| GBPUSD Security | Инструмент с данными GBP/USD. | Требуется указать |
| Volume | Объем сделки (лоты). | 0.01 |
| Stop Loss | Стоп-лосс в шагах цены. | 75 |
| Take Profit | Тейк-профит в шагах цены. | 46 |

## Управление рисками
* Значения стоп-лосса и тейк-профита измеряются в `PriceStep` торгуемого инструмента, убедитесь что этот параметр задан.
* При старте вызывается `StartProtection()`, что активирует встроенное управление защитными ордерами.
* Если какое-либо расстояние равно нулю, соответствующий защитный ордер не формируется.

## Рекомендации по использованию
* Перед запуском назначьте основной торговый инструмент (например, EUR/GBP).
* Параметры `EURUSD Security` и `GBPUSD Security` должны ссылаться на доступные источники данных.
* Для корректных сигналов требуется синхронное получение свечей по всем трем инструментам на выбранном таймфрейме.
* Стратегия использует только рыночные ордера и закрывает противоположные позиции обратной сделкой.

## Примечания по конверсии
* Параметры `_Lots`, `_SL`, `_TP`, `_MagicNumber`, `_Comment`, `_OnlyOneOpenedPos`, `_AutoDigits` перенесены в параметры StockSharp или заменены стандартным поведением платформы.
* Вспомогательные функции закрытия ордеров из MQL заменены высокоуровневым управлением защитными ордерами.
* Циклы обработки ошибок и повторных попыток из MQL не потребовались, так как в StockSharp обработка состояний ордеров происходит автоматически.
