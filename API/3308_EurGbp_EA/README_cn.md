# EurGbp EA 策略

## 概述
EurGbp EA 策略重现了原始 MetaTrader 智能交易的思路：比较 EUR/USD 与 GBP/USD 在选定小时周期上的 MACD 动量，并在主要交易品种（通常为 EUR/GBP）上开仓。策略利用欧元与英镑主要货币对之间的相对强弱，提前捕捉交叉盘的潜在走势。

## 指标
* **MACD (12, 26, 9)**：用于 EUR/USD，获取信号线与柱状图。
* **MACD (12, 26, 9)**：用于 GBP/USD，获取信号线与柱状图。

两条指标均使用 `Candle Type` 参数指定的同一时间框架（默认 1 小时）。

## 交易逻辑
1. 同时订阅交易标的、EUR/USD、GBP/USD 的蜡烛数据。
2. 分别计算两组 MACD 的信号线与柱状图数值。
3. **买入条件：**
   * EUR/USD 柱状图 &lt; GBP/USD 柱状图，且
   * EUR/USD 信号线 &gt; GBP/USD 信号线，且
   * 当前无多头仓位（或存在空头仓位时可被抵消）。
4. **卖出条件：**
   * GBP/USD 柱状图 &lt; EUR/USD 柱状图，且
   * GBP/USD 信号线 &gt; EUR/USD 信号线，且
   * 当前无空头仓位（或存在多头仓位时可被抵消）。
5. 每根 K 线每个方向只允许一次开仓，避免重复下单。
6. 开仓后立即按照设定的点数距离挂出止损与止盈。

## 参数
| 名称 | 说明 | 默认值 |
| ---- | ---- | ------ |
| Candle Type | 三个品种共用的时间框架。 | 1 小时 |
| EURUSD Security | 提供 EUR/USD 数据的证券对象。 | 必须设置 |
| GBPUSD Security | 提供 GBP/USD 数据的证券对象。 | 必须设置 |
| Volume | 下单手数。 | 0.01 |
| Stop Loss | 按价格最小变动单位计算的止损距离。 | 75 |
| Take Profit | 按价格最小变动单位计算的止盈距离。 | 46 |

## 风险管理
* 止损与止盈均以交易标的的 `PriceStep` 为单位，请确保该属性有效。
* 策略启动时会调用 `StartProtection()`，自动启用保护单管理。
* 若止损或止盈设为 0，则对应保护单不会创建。

## 使用说明
* 启动前请将策略的主交易证券设为目标品种（例如 EUR/GBP）。
* 为 `EURUSD Security` 和 `GBPUSD Security` 指定连接中可用的数据源。
* 需要三个品种在所选时间框架上同步更新，才能稳定产生信号。
* 策略仅使用市价单，若方向相反则通过反向下单来平掉已有仓位。

## 转换说明
* 原始输入参数 `_Lots`、`_SL`、`_TP`、`_MagicNumber`、`_Comment`、`_OnlyOneOpenedPos`、`_AutoDigits` 均映射为 StockSharp 参数或内置功能。
* MQL 中的订单关闭辅助函数被高层保护单逻辑所取代。
* MQL 版本的错误重试循环在 StockSharp 中由订单生命周期管理自动处理，因此无需保留。
