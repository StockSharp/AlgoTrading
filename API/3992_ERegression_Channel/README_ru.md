# Стратегия E Regression Channel
[English](README.md) | [中文](README_cn.md)

## Общее описание
**E Regression Channel Strategy** — реализация советника MetaTrader «e-Regr» на базе высокоуровневого API StockSharp. Стратегия строит полиномиальную регрессию по последним ценам закрытия, формирует симметричные каналы по стандартному отклонению остатков и реагирует на пробой границ. Алгоритм ориентирован на возврат цены к средней с дополнительными фильтрами по волатильности и торговым сессиям.

## Логика работы
1. Подписка на основной таймфрейм (`Candle Type`) и расчёт регрессионного канала на `Regression Length` последних свечах.
2. Средняя линия — значение регрессии, верхняя и нижняя границы смещаются на `Std Dev Multiplier` стандартных отклонений.
3. Если цена закрытия поднимается выше средней линии — закрываются все длинные позиции; при падении ниже средней линии — закрываются короткие позиции.
4. При касании текущим минимумом нижней границы открывается покупка (предварительно закрывается короткая позиция, если она есть).
5. При касании текущим максимумом верхней границы открывается продажа (после закрытия длинной позиции, если она существует).
6. При включённом трейлинг-стопе уровни подтягиваются после движения в прибыль на величину `Trailing Activation`, поддерживая дистанцию `Trailing Distance`.
7. Новые сделки пропускаются, если диапазон предыдущей дневной свечи превышает `Daily Range Filter` или текущее время вне интервала `[Trade Start, Trade End)`.

## Параметры
- `Volume` – объём заявки при входе (перед разворотом позиция закрывается).
- `Trade Start` / `Trade End` – рабочий торговый интервал, поддерживает переход через полночь.
- `Regression Length` – количество свечей для расчёта регрессии.
- `Degree` – степень полинома (1–6).
- `Std Dev Multiplier` – множитель стандартного отклонения для построения каналов.
- `Enable Trailing` – включение трейлинг-стопа.
- `Trailing Activation` – число пунктов прибыли, после которого активируется трейлинг.
- `Trailing Distance` – дистанция (в пунктах), поддерживаемая трейлинг-стопом.
- `Stop Loss` – защитный стоп-лосс в пунктах (0 отключает).
- `Take Profit` – защитный тейк-профит в пунктах (0 отключает).
- `Daily Range Filter` – максимальный допустимый диапазон предыдущей дневной свечи.
- `Candle Type` – основной таймфрейм (по умолчанию 30 минут).

## Значения по умолчанию
- `Volume` = 0.1
- `Trade Start` = 03:00
- `Trade End` = 21:20
- `Regression Length` = 250
- `Degree` = 3
- `Std Dev Multiplier` = 1.0
- `Enable Trailing` = false
- `Trailing Activation` = 30 пунктов
- `Trailing Distance` = 30 пунктов
- `Stop Loss` = 0 пунктов
- `Take Profit` = 0 пунктов
- `Daily Range Filter` = 150 пунктов
- `Candle Type` = 30-минутные свечи

## Дополнительная информация
- Стратегия использует только завершённые свечи и не открывает несколько сделок в рамках одного бара.
- Трейлинг-стоп закрывает позицию по рынку при касании внутреннего уровня.
- Если предыдущий день слишком волатилен, позиции закрываются и новые сигналы игнорируются до следующего бара.
- Регрессионные линии перерисовываются на графике для визуального контроля средней и границ канала.
