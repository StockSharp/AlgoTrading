# Стратегия Exp XWPR Histogram Vol Direct

## Общее описание

Стратегия является портом MetaTrader-советника **Exp_XWPR_Histogram_Vol_Direct** на платформу StockSharp. Логика сохраняет
взвешивание Williams %R по объёму, сглаживание индикатора и открытие сделок при смене цвета гистограммы. Сделки выполняются
только на закрытых свечах, доступны опциональные стоп-лосс и тейк-профит в шагах цены.

## Основные этапы

1. Расчёт Williams %R на выбранном таймфрейме.
2. Смещение осциллятора на +50, умножение на выбранный тип объёма (тик или реальный) и сглаживание указанный скользящей средней.
3. Параллельное сглаживание исходного объёма тем же методом для восстановления границ индикатора (HighLevel2/1, LowLevel1/2).
4. Отслеживание цвета наклона гистограммы: 0 — значение растёт, 1 — значение падает. Стратегия хранит небольшую историю цветов
   с учётом параметра `SignalShift`.
5. Реакция на смену цвета:
   - Переход `0 → 1`: закрытие шортов (если разрешено) и, при необходимости, открытие лонга.
   - Переход `1 → 0`: закрытие лонгов (если разрешено) и, при необходимости, открытие шорта.

Классификация зоны (Нейтральная/Бычья/Медвежья/Экстремальная) используется для логирования и соответствует оригинальному советнику,
который анализирует только буфер цветов.

## Параметры

| Параметр | Описание |
| --- | --- |
| `WilliamsPeriod` | Длина расчёта Williams %R. |
| `HighLevel2`, `HighLevel1`, `LowLevel1`, `LowLevel2` | Множители сглаженного объёма для построения каналов индикатора. |
| `SmoothingType` | Тип скользящей средней для потоков взвешенных значений и объёма (SMA, EMA, SMMA, WMA, Hull, VWMA, DEMA, TEMA). |
| `SmoothingLength` | Длина скользящей средней. |
| `SignalShift` | Насколько далеко брать завершённые цвета (1 — как в MetaTrader). |
| `EnableLongEntries` / `EnableShortEntries` | Разрешение на открытие длинных/коротких позиций. |
| `EnableLongExits` / `EnableShortExits` | Разрешение на закрытие длинных/коротких позиций. |
| `VolumeSource` | Источник объёма: тиковый счётчик или реальный объём. |
| `StopLossPoints` / `TakeProfitPoints` | Опциональные стоп и тейк в шагах цены. |
| `CandleType` | Тип и таймфрейм свечей для анализа и торговли. |

Размер позиции задаётся свойством `Volume`. При развороте позиция увеличивается на абсолютную величину текущей позиции, как в
исходном советнике.

## Практические рекомендации

- Параметр `MA_Phase` из версии MetaTrader не поддерживается — стандартные индикаторы StockSharp не содержат его.
- Перед запуском убедитесь, что в историю загружено достаточно свечей, чтобы скользящие средние сформировались.
- Стратегия подходит для любых инструментов, поддерживаемых StockSharp; установите `CandleType` на желаемый таймфрейм (например,
  4 часа по умолчанию).
- Для работы с тиковым объёмом источник данных должен передавать количество тиков в сообщениях свечей; иначе используйте реальный
  объём.

## Журнал и визуализация

Стратегия отображает свечи и индикатор Williams %R на графике. В журнал записываются зона сигнала и значение сглаженной
гистограммы, что облегчает сравнение с MetaTrader-версией.
