# Стратегия Mc Valute Cloud

В этой папке находится порт стратегии MetaTrader "Mc_valute" для StockSharp. Оригинальный советник сочетал короткую экспоненциальную
скользящую среднюю с тремя сглаженными скользящими, фильтром Ichimoku и несколькими MACD, постепенно наращивая позицию по тренду.
Версия для StockSharp сохраняет ключевую систему подтверждений, но упрощает управление позицией до одной сделки в каждом направлении,
чтобы логика органично вписалась в высокоуровневый API.

## Логика торговли

1. **EMA-фильтр цены** – EMA с длиной `FilterMaLength` должна находиться выше (для покупок) или ниже (для продаж) двух сглаженных
   скользящих (`BlueMaLength` и `LimeMaLength`). Эти кривые имитируют линии "blue" и "lime" из шаблона MT4.
2. **Подтверждение облаком Ichimoku** – EMA обязана располагаться вне облака. Для покупок фильтр должен быть выше обеих линий
   Senkou, для продаж – ниже нижней границы облака.
3. **Проверка импульса MACD** – основная линия MACD должна быть выше сигнальной линии для входа в покупки и ниже для входа в
   продажи. Используется только первый набор параметров MACD, потому что остальные версии были отключены в финальной MQL-версии.
4. **Одна позиция** – при появлении сигнала стратегия закрывает противоположную позицию и открывает новую сделку с объемом `Volume`.
   Защитные ордера обновляются сразу после отправки рыночного ордера.
5. **Анализ закрытых свечей** – все индикаторы работают на таймфрейме `CandleType`. Решения принимаются только по завершённым
   свечам, что соответствует обработчику `start()` в MT4.

## Управление рисками

- `TakeProfit` и `StopLoss` задаются в ценовых пунктах. После каждого входа вызываются `SetTakeProfit` и `SetStopLoss` с ожидаемым
  итоговым объемом позиции, аналогично тому, как стопы привязывались к сделкам в MT4.
- В исходном советнике использовалась пирамида до трёх усредняющих ордеров через расстояние `Step`. В StockSharp-версии оставлена
  одна позиция, чтобы использовать высокоуровневые помощники работы с ордерами. Для имитации усреднения можно увеличить `Volume`
  или запустить несколько копий стратегии.

## Параметры

| Параметр | Описание |
| --- | --- |
| `Volume` | Базовый объём сделки для вызовов `BuyMarket`/`SellMarket`. |
| `CandleType` | Таймфрейм свечей, по которым работают индикаторы и принимаются решения. |
| `FilterMaLength` | Длина EMA-фильтра тренда. |
| `BlueMaLength`, `LimeMaLength` | Длины двух сглаженных скользящих, формирующих коридор. |
| `MacdFastLength`, `MacdSlowLength`, `MacdSignalLength` | Настройки EMA для подтверждения MACD. |
| `TenkanLength`, `KijunLength`, `SenkouLength` | Параметры Ichimoku Kinko Hyo для облака. |
| `TakeProfit`, `StopLoss` | Размеры защитных ордеров в пунктах. |

## Особенности использования

1. **Смещения индикаторов** – в MetaTrader сглаженные скользящие могли иметь ненулевой параметр "shift". В StockSharp индикаторы
   работают по текущей свече, поэтому порт игнорирует смещения, сохраняя исходные периоды.
2. **Варианты MACD** – в исходнике объявлено три блока MACD, но в торговле участвовал только первый. Порт повторяет такое поведение;
   при необходимости дополнительные фильтры можно добавить отдельным биндингом.
3. **Усреднение** – MQL-робот открывал до трёх усредняющих позиций на расстоянии `Step`. В документации отмечено это отличие, но
   функциональность намеренно исключена, потому что высокоуровневые стратегии работают с суммарной позицией.
4. **Защитный блок** – `StartProtection()` вызывается один раз при запуске, чтобы инфраструктура автоматически сопровождала стопы
   и тейк-профиты после переподключений.

## Файлы

- `CS/McValuteCloudStrategy.cs` – реализация на C# с биндингом индикаторов и комментариями на английском языке.
- `README.md` – документация на английском языке.
- `README_cn.md` – перевод на китайский.
- `README_ru.md` – документ на русском (этот файл).
