# RSI Eraser 策略
[English](README.md) | [Русский](README_ru.md)

RSI Eraser 策略直接移植自 Vladimir Karputov 编写的 MetaTrader 5 专家顾问。
策略使用小时级别的 K 线来计算相对强弱指标 (RSI)，并在 RSI 穿越 50 的过程中寻找均值回归式的入场点。
在进入市场之前会检查上一交易日的高低点区间，同时按照账户权益的一定百分比计算下单手数。

## 策略要点

- **主级别**：1 小时 K 线负责生成指标数值和交易信号。
- **过滤级别**：通过日线数据获取昨日的最高价和最低价。
- **指标**：经典 RSI，周期可配置。
- **方向判定**：RSI 高于中轴则做多，RSI 低于中轴则做空。
- **仓位管理**：根据入场价到止损价的距离和风险百分比计算下单数量。

## 入场逻辑

1. 等待小时 K 线收盘后计算 RSI。
2. 确认已经有至少一根完整的日线数据。
3. **多头条件**：
   - RSI 必须严格大于中轴值（默认 50）。
   - 计划止损价（入场价 − 止损距离）不能低于昨日低点减去缓冲点数。
   - 如果当天已经开过一笔多头，则拒绝新的多头信号。
4. **空头条件**：
   - RSI 必须严格小于中轴值。
   - 计划止损价（入场价 + 止损距离）不能高于昨日高点加上缓冲点数。
   - 如果当天已经开过一笔空头，则拒绝新的空头信号。
5. 当条件满足时发送市价单并按风险计算手数。
   若当前持有反向仓位，会在同一次操作中平掉旧仓并反向开仓。

## 离场逻辑

- 初始止损与止盈由设置的点数和利润倍数计算得到。
- 策略在每根收盘 K 线上检查：
  - 多头：价格触及止损或止盈时平仓。
  - 空头：价格触及止损或止盈时平仓。
- **保本机制**：一旦浮动利润达到初始止损距离，止损价会移动到入场价，实现无风险持仓。
- 当没有持仓时会清理所有内部的止损/止盈记录，防止沿用旧数据。

## 风险控制

- `RiskPercent` 参数指定每笔交易愿意承担的账户权益比例。
- 手数计算公式为 `risk_amount / stop_distance`，若无法获取权益信息，则退回到基础 `Volume` 参数。
- 日线缓冲区为昨日区间提供额外安全边界，避免止损过于靠近最近的波动极值。

## 默认参数

- `RsiPeriod` = 14
- `RsiNeutralLevel` = 50
- `StopLossPips` = 50
- `TakeProfitMultiplier` = 3
- `DailyBufferPips` = 10
- `RiskPercent` = 5%
- `CandleType` = 1 小时
- `DailyCandleType` = 1 天

## 实现细节

- 策略通过 StockSharp 的高级 API 同时订阅小时与日线 K 线。
- 所有代码注释与日志信息均为英文，以符合仓库规范。
- 保本移动和“每天每个方向仅一笔交易”的限制完全复现了原始 MT5 版本的行为。
