# Стратегия NNFX Auto Trade

## Обзор
**NNFX Auto Trade Strategy** переносит панель ручной торговли NNFX из MetaTrader 4 в StockSharp. Вместо графического интерфейса используются параметры стратегии: трейдер включает входы, переводит позицию в безубыток и запускает трейлинг одним кликом.

Особенности:

- Расчёт объёма по ATR с возможностью задать фиксированные значения стопа и тейк-профита.
- Вход делится на две части: первая закрывается по цели, вторая остаётся в рынке для дальнейшего сопровождения.
- Команды безубытка и трейлинга выполняются по требованию, повторяя логику исходного советника.
- В расчёт риска можно включить внешний капитал, как это делалось в MQL-версии.

## Логика торговли
1. **ATR** – стратегия подписывается на выбранные свечи и считает Average True Range. При активном параметре `UsePreviousDailyAtr` в первые 12 часов нового дня используется значение ATR предыдущей сессии.
2. **Риск-менеджмент** – при ручной команде `Buy` или `Sell` рассчитывается денежный риск, после чего определяется объём сделки.
3. **Деление позиции** – половина объёма закрывается по целевому уровню, оставшаяся часть остаётся в позиции.
4. **Стопы** – начальные уровни хранятся во внутреннем состоянии, команды позволяют перенести стоп в ноль или подтянуть его по формуле NNFX.
5. **Выходы** – `CloseAll` мгновенно закрывает позицию, стопы и цели срабатывают при достижении цены.

## Параметры
| Параметр | Значение | Описание |
|----------|----------|----------|
| `RiskPercent` | `2.0` | Доля капитала (с учётом `AdditionalCapital`), которую допускается потерять в одной сделке. |
| `AdditionalCapital` | `0` | Дополнительный капитал, участвующий в расчёте риска. |
| `UseAdvancedTargets` | `false` | Использовать фиксированные пипсовые расстояния вместо коэффициентов ATR. |
| `AdvancedStopPips` | `0` | Расстояние до стопа (в пипсах) при включённом ручном режиме. |
| `AdvancedTakeProfitPips` | `0` | Расстояние до тейк-профита (в пипсах) при включённом ручном режиме. |
| `UsePreviousDailyAtr` | `true` | В первые 12 часов нового дня использовать ATR предыдущей дневной свечи. |
| `AtrPeriod` | `14` | Период ATR. |
| `AtrStopMultiplier` | `1.5` | Множитель ATR для расчёта стопа. |
| `AtrTakeProfitMultiplier` | `1.0` | Множитель ATR для расчёта тейк-профита. |
| `CandleType` | `1 Minute` | Тип свечей для расчётов. |
| `BuyCommand` | `false` | Ручная команда на открытие длинной позиции. После обработки сбрасывается. |
| `SellCommand` | `false` | Ручная команда на открытие короткой позиции. После обработки сбрасывается. |
| `BreakevenCommand` | `false` | Команда перевода стопа в безубыток. |
| `TrailingCommand` | `false` | Команда разового подтягивания стопа по правилам NNFX. |
| `CloseAllCommand` | `false` | Команда немедленного закрытия всех позиций. |

## Рекомендации по использованию
- Для корректного расчёта объёмов требуются актуальные `Step`, `StepPrice` и `VolumeStep` инструмента.
- Команды обрабатываются на закрытии свечи, поэтому после переключения параметра необходимо дождаться следующего обновления данных.
- При ручном режиме стопа и цели заполните оба параметра (`AdvancedStopPips` и `AdvancedTakeProfitPips`), иначе стратегия продолжит использовать ATR.
