# Стратегия NTK 07 Range Trader

Стратегия NTK 07 Range Trader представляет собой конвертацию MetaTrader-советника «NTK 07». Алгоритм поддерживает симметричные отложенные заявки вокруг текущей цены и управляет открытыми позициями при помощи настраиваемых правил трейлинг-стопа и тейк-профита. Цель — захватывать прорывы, возникающие у границ или в центре краткосрочного диапазона, при строгом контроле риска.

## Основные идеи

- **Триггеры входа**. В плоском состоянии стратегия анализирует диапазон с заданным количеством свечей. Если цена находится на границе диапазона либо около его середины (зависит от режима), выставляются buy stop и sell stop с указанным смещением в шагах цены.
- **Учёт диапазона**. Максимум и минимум последних *N* завершённых свечей задают рабочий коридор. Значение `0` отключает фильтр, и заявки размещаются сразу.
- **Адаптивный риск**. Каждая первичная заявка использует базовый объём, а при включённом множителе стратегия дозапускает дополнительные стоп-заявки в сторону текущей позиции. Глобальный лимит объёма не позволяет превысить суммарное плечо.
- **Управление выходом**. После исполнения одной стороны противоположная заявка отменяется. Далее выставляются защитный стоп и при необходимости тейк-профит. Трейлинг может ориентироваться на экстремумы предыдущей свечи, на значение скользящей средней или на фиксированное смещение.
- **Торговая сессия**. Сделки допускаются только между заданными часами и автоматически блокируются в выходные.

## Параметры

| Параметр | Описание |
|----------|----------|
| **Entry Volume** | Базовый объём каждой входной заявки. |
| **Total Volume Limit** | Максимальный совокупный объём; `0` снимает ограничение. |
| **Net Step** | Смещение стоп-заявок относительно рынка в шагах цены. |
| **Stop Loss** | Первоначальная дистанция стоп-лосса в шагах цены. |
| **Take Profit** | Дистанция тейк-профита, `0` отключает его. |
| **Trailing Stop** | Шаг для расчёта трейлинг-стопа. |
| **Lot Multiplier** | Множитель объёма при пирамидинге. |
| **Trail High/Low** | Использовать экстремумы предыдущей свечи для трейлинга. |
| **Trail Moving Average** | Использовать скользящую среднюю для трейлинга; режимы взаимоисключающие. |
| **Trading Start/End Hour** | Временное окно торговли (включительно). |
| **Range Bars** | Количество завершённых свечей для расчёта диапазона, `0` — без фильтра. |
| **Trade Mode** | `EdgesOfRange` требует касания границ; `CenterOfRange` ждёт сближения с серединой диапазона. |
| **MA Period** | Период скользящей средней. |
| **Candle Type** | Тип свечей, используемых в расчётах. |

## Последовательность работы

1. **Подписка на данные**. Стратегия подписывается на выбранный тип свечей, рассчитывает скользящую среднюю, максимум и минимум диапазона.
2. **Отсутствие позиции**. При выполнении условий диапазона выставляются парные buy stop и sell stop с заданным смещением, при этом учитывается общий лимит объёма.
3. **Сопровождение позиции**. После входа противоположная заявка отменяется, ставятся защитный стоп и при необходимости тейк. Каждый новый бар обновляет трейлинг-стоп.
4. **Пирамидинг**. Если множитель объёма > `1` и лимит объёма не исчерпан, добавляется новая стоп-заявка в сторону текущей позиции.
5. **Выход**. Исполнение стопа или тейка закрывает позицию и отменяет оставшиеся защитные заявки. Далее алгоритм снова ждёт сигнала диапазона.

## Дополнительно

- Все смещения выражены в шагах цены, поэтому стратегия адаптируется к инструментам с различным тиком.
- Торговля автоматически отключается в субботу и воскресенье, как и в оригинальном MQL-решении.
- Попытка включить оба режима трейлинга приведёт к ошибке конфигурации при запуске.
