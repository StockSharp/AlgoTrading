# Стратегия «New Random»

## Общее описание
**Стратегия «New Random»** полностью воспроизводит оригинальный советник MetaTrader и предлагает три режима выбора направления для следующей позиции. Одновременно открыта только одна сделка: после входа алгоритм ждёт полного закрытия позиции, а затем генерирует новое направление. Стратегия подписывается на поток Level 1, использует последние значения bid/ask для имитации исполнения по рынку и автоматически пересчитывает стоп-лосс и тейк-профит в пунктах, учитывая специфику трёх- и пятизначных котировок.

## Режимы входа
1. **Генератор случайных чисел** — каждое решение формируется псевдослучайно, генератор инициализируется при старте стратегии.
2. **Цикл Buy-Sell-Buy** — направления строго чередуются: первая сделка открывается в лонг, затем следует шорт, потом снова лонг и так далее.
3. **Цикл Sell-Buy-Sell** — аналогичное чередование, но стартовая сделка — шорт.

## Параметры
- **Random Mode** (`Mode`) — выбор одного из трёх перечисленных режимов. По умолчанию используется генератор случайных чисел.
- **Minimal Lot Count** (`MinimalLotCount`) — множитель минимального объёма инструмента (`Security.VolumeMin`). Значение `1` соответствует одному минимальному лоту, большие значения пропорционально увеличивают объём заявки.
- **Stop Loss (pips)** (`StopLossPips`) — расстояние до стоп-лосса в пунктах от цены входа. Ноль отключает защитный стоп.
- **Take Profit (pips)** (`TakeProfitPips`) — расстояние до тейк-профита в пунктах от цены входа. Ноль отключает фиксирование прибыли.

## Логика работы
1. После запуска стратегия подписывается на Level 1 и хранит последние значения bid, ask и цены последней сделки.
2. При отсутствии открытой позиции и активных заявок определяется направление следующего входа согласно выбранному режиму.
3. Заявка отправляется по рынку (BuyMarket/SellMarket); сразу вычисляются уровни стоп-лосса и тейк-профита исходя из параметров в пунктах.
4. Пока позиция открыта, новые входы не инициируются, что гарантирует строго одно активное плечо.

## Управление позицией
- Для длинной позиции закрытие инициируется, если текущая цена опускается до стоп-лосса либо достигает тейк-профита.
- Для короткой позиции закрытие выполняется при росте до стоп-уровня или падении до тейк-профита.
- Для контроля используется последняя доступная цена сделки; если она недоступна, применяются соответствующие bid/ask.
- После выхода внутренние переменные сбрасываются, цикл для последовательных режимов сдвигается и алгоритм ждёт следующего обновления котировки.

## Дополнительные замечания
- В стратегии отсутствует усреднение или наращивание позиции — открывается ровно один лотный блок за раз.
- Случайный режим использует системный тик как сид, что обеспечивает уникальную последовательность сделок при каждом запуске.
- В исходном коде добавлены подробные комментарии на английском языке, как того требуют правила репозитория.
