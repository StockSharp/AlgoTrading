# 随机方向策略

## 概述
**随机方向策略** 完整移植自 MetaTrader 的 “New Random” 专家顾问，提供三种不同的建仓方向选择模式。策略在任意时刻只保持一笔仓位，等待仓位完全平仓后才会评估下一次信号。通过订阅一级行情数据实时获取最新买价、卖价与成交价，并以最佳买卖价作为市价单的执行参考，同时依据点数参数自动计算止损与止盈距离，对 3 位或 5 位报价的外汇品种进行和原始脚本一致的调整。

## 入场模式
1. **随机生成** – 在策略启动时使用当前时间作为随机数种子，每次机会都通过抛硬币的方式在做多和做空之间随机选择。
2. **买-卖-买循环** – 方向严格交替，首笔交易为买单，其后依次为卖单、买单……
3. **卖-买-卖循环** – 方向严格交替，但首笔交易为卖单，随后为买单、卖单循环往复。

## 参数说明
- **Random Mode**（`Mode`） – 选择上述三种入场模式之一，默认使用随机生成模式。
- **Minimal Lot Count**（`MinimalLotCount`） – 以标的的最小交易量为基础的倍数。取值为 `1` 时下单量等于 `Security.VolumeMin`，更大的数字会按照最小交易量的整数倍放大。
- **Stop Loss (pips)**（`StopLossPips`） – 入场价与止损价之间的点数距离，设置为 `0` 表示不启用止损。
- **Take Profit (pips)**（`TakeProfitPips`） – 入场价与止盈价之间的点数距离，设置为 `0` 表示不启用止盈。

## 交易流程
1. 订阅并监听一级行情，保存最新的买价、卖价以及成交价。
2. 当不存在持仓且没有挂单时，根据所选模式确定下一次的交易方向。
3. 使用当前的最佳买价或卖价发送市价单，并立即按照参数换算出止损与止盈价格。
4. 策略始终只持有单笔仓位，直到当前仓位完全平仓后才会评估新的信号。

## 仓位管理
- 多头仓位在价格跌破止损或升破止盈时平仓。
- 空头仓位在价格升破止损或跌破止盈时平仓。
- 比较价格时优先采用最新成交价；若暂时没有成交价，则多头使用买价、空头使用卖价作为参考。
- 平仓后策略会重置内部状态，并根据循环模式更新下一次方向，随后等待新的行情报价。

## 注意事项
- 策略不会加仓或网格化，循环模式的行为完全可预测。
- 随机模式以系统 Tick 计数作为种子，每次运行都会产生不同的交易序列。
- 源码中的所有注释和日志均为英文，以符合仓库的统一规范。
