# Five MA Multi-Timeframe 策略

## 概述
**Five MA Multi-Timeframe Strategy** 在 StockSharp 平台中复刻 MT4 的 “5matf” 专家顾问。策略在三个时间框架（信号、确认、趋势）上同时计算 5 条简单移动平均线，并结合 Accelerator Oscillator 加速指标来评估多空力量。当所有时间框架都指向同一方向且强度达到阈值时，策略会开仓或平仓。

## 指标与数据
- **简单移动平均线（SMA）**：每个时间框架使用周期 5、8、13、21、34。
- **Accelerator Oscillator（AC）**：在信号时间框架和趋势时间框架上应用，用于捕捉动量加速。
- **时间框架**：默认设置为 15 分钟（信号）、60 分钟（确认）和 240 分钟（趋势过滤），可通过参数自由调整。

## 信号逻辑
1. 对每条 SMA 比较当前收盘值与上一根完成 K 线的值，判断斜率方向。
2. AC 指标使用最近四个数值识别加速上升或下降的形态。
3. 将斜率计数与 AC 结果转换成百分比得分，分别对应三个时间框架。
4. 当三个时间框架的多头得分同时超过 50% 时生成 **BUY** 信号；超过 75% 时视为强信号。
5. 空头方向使用相同阈值生成 **SELL** 信号。
6. 如果持有仓位，当相反方向的信号超过 `CloseLevel` 时立即平仓。为了与原版 EA 保持一致，策略只在空仓状态下开新仓位。

## 参数
| 名称 | 默认值 | 说明 |
| --- | --- | --- |
| `CandleType` | 15 分钟 K 线 | 生成交易信号的主要时间框架。 |
| `HigherTimeframe1` | 60 分钟 K 线 | 第一个较高时间框架，用于确认。 |
| `HigherTimeframe2` | 240 分钟 K 线 | 最慢时间框架，用于趋势过滤。 |
| `FirstPeriod` – `FifthPeriod` | 5、8、13、21、34 | 各时间框架上使用的 SMA 周期。 |
| `OpenLevel` | 0 | 开仓所需的最小信号等级。 |
| `CloseLevel` | 1 | 平仓所需的反向信号等级。 |

## 使用提示
- 策略使用市价单，并且不会在同一根 K 线上直接反向开仓，先平仓再等待新信号。
- 请为所有选定的时间框架提供历史数据，保证指标同步计算。
- 在不同品种或波动环境下运行时，可以优化 SMA 周期与阈值来匹配市场特性。

## 转换说明
该实现完整保留了 MT4 “5matf” 的核心逻辑，并利用 StockSharp 的订阅与绑定机制实现高阶封装。与原始版本相同，AC 指标需要至少四根完成的 K 线才会产生有效信号。
