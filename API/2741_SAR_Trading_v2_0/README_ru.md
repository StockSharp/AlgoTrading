# Стратегия SAR Trading v2.0

**SAR Trading v2.0** — адаптация классического советника Cronex для платформы StockSharp. Стратегия использует простую скользящую среднюю (SMA) и Parabolic SAR для определения направления сделки, а также управляет позицией с помощью фиксированных стопов и трейлинг-стопа, измеряемого в пунктах.

- Индикаторы: Simple Moving Average, Parabolic SAR.
- Таймфрейм по умолчанию: 15-минутные свечи (можно изменить через параметр `CandleType`).
- Рынок: любой инструмент, у которого задан корректный `PriceStep`.

## Логика торговли
- Входы рассматриваются только при отсутствии открытой позиции.
- **Лонг:** либо значение Parabolic SAR находится ниже SMA, либо цена закрытия `MaShift` свечей назад ниже SMA. Это повторяет условие `SAR < MA || Close[shift] < MA` из оригинального кода.
- **Шорт:** либо значение Parabolic SAR выше SMA, либо цена закрытия `MaShift` свечей назад выше SMA.
- После отправки приказа на выход стратегия ждёт, пока позиция полностью закроется, прежде чем анализировать новые сигналы, что обеспечивает работу только с одной позицией, как и в MQL-версии.

## Управление рисками
- `StopLossPips` и `TakeProfitPips` преобразуют пункты в абсолютное расстояние по цене через `Security.PriceStep`.
- `TrailingStopPips` удерживает защитный стоп на фиксированном расстоянии в пунктах после выхода позиции в прибыль.
- `TrailingStepPips` требует дополнительного движения цены прежде, чем подтянуть трейлинг-стоп, полностью повторяя логику «шага» из MQL.
- При достижении уровней стоп-лосса или тейк-профита позиция закрывается рыночной заявкой.

## Параметры
- `MaPeriod` (значение по умолчанию **18**) — период SMA.
- `MaShift` (по умолчанию **2**) — сколько свечей назад брать цену закрытия для сравнения со SMA.
- `SarStep` (по умолчанию **0.02**) — коэффициент ускорения Parabolic SAR.
- `SarMaxStep` (по умолчанию **0.2**) — максимальный коэффициент ускорения Parabolic SAR.
- `StopLossPips` (по умолчанию **50**) — фиксированный стоп-лосс в пунктах.
- `TakeProfitPips` (по умолчанию **50**) — фиксированный тейк-профит в пунктах.
- `TrailingStopPips` (по умолчанию **15**) — расстояние трейлинг-стопа в пунктах.
- `TrailingStepPips` (по умолчанию **5**) — дополнительное изменение цены для переноса трейлинг-стопа.
- `CandleType` — тип свечей, используемых в расчётах.

## Дополнительные замечания
- Стратегия хранит внутреннюю историю закрытий, чтобы воспроизвести вызов `iClose(shift)` из MQL.
- Все решения принимаются только по завершённым свечам, что обеспечивает совпадение с поведением оригинального советника.
- Объём сделки берётся из свойства `Volume`; по умолчанию каждое срабатывание открывает позицию объёмом 1.

