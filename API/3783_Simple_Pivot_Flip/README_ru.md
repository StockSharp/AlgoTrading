# Простая стратегия разворота по пивоту

## Обзор
Стратегия представляет собой высокоуровневый порт советника MetaTrader 4 из файла `MQL/7610/Simplepivot_www_forex-instruments_info.mq4`. В оригинале на каждом новом баре берётся его цена открытия и сравнивается с диапазоном предыдущей свечи, после чего советник открывает или переворачивает позицию. В версии для StockSharp та же логика реализована с помощью высокоуровневых вызовов `SubscribeCandles`, `Bind`, `BuyMarket`, `SellMarket` и `ClosePosition`.

Пошаговая схема работы:

1. Ожидание закрытия свечи, чтобы получить её open/high/low.
2. Вычисление пивота как середины диапазона предыдущего бара.
3. Если новый бар открылся в нижней половине диапазона либо сделал разрыв вверх, открывается длинная позиция.
4. Если открытие находится в верхней половине предыдущего диапазона, открывается короткая позиция.
5. Перед сменой направления текущая позиция закрывается — тем самым сохраняется логика одного тикета, как и в MQL.

В оригинальном советнике нет стоп-лоссов и тейк-профитов, поэтому позиция разворачивается только на следующем сигнале.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --------------------- | -------- |
| `OrderVolume` | 1 | Объём рыночного ордера при входе. |
| `CandleType` | Таймфрейм 1 минута | Тип свечей, которые запрашиваются у источника данных. |

## Детали торговой логики
1. Первая полностью сформированная свеча сохраняется и используется как эталон. Пока нет предыдущей свечи, стратегия не торгует.
2. Для каждой следующей завершённой свечи:
   - Рассчитывается `pivot = (previousHigh + previousLow) / 2`.
   - Если `Open < previousHigh` и одновременно `Open > pivot`, выбирается короткое направление.
   - Во всех остальных случаях выбирается длинное направление (нижняя половина диапазона, равенство пивоту, гэпы вверх/вниз).
3. Если уже открыта позиция в нужную сторону, сигнал пропускается, чтобы не платить спрэд повторно. Это соответствует проверке `prevTradeOp` в MQL.
4. При смене направления вызывается `ClosePosition()`, после чего отправляется новый рыночный ордер объёмом `OrderVolume`.
5. Диапазон предыдущей свечи обновляется значениями текущего бара и используется в следующей итерации.

## Управление риском
Алгоритм не содержит защитных стопов и целей по прибыли. Управление риском сводится к настройке объёма `OrderVolume` или внешним мерам контроля со стороны портфеля/счёта.

## Визуализация
При наличии области графика стратегия отображает свечи и собственные сделки, что облегчает проверку корректности разворотов по пивоту в тестах.
