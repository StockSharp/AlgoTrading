# Стратегия Zone Recovery Formula

## Общее описание

**Zone Recovery Formula Strategy** – порт советника MetaTrader 4 «Zone Recovery Formula». Алгоритм определяет направление тренда по пересечению скользящих средних и применяет «зональное» усреднение для выхода из просадки. Суть подхода – поочередно открывать длинные и короткие позиции с увеличивающимся объёмом, пока цена не покинет восстановительную зону и не зафиксирует прибыль.

## Логика работы

1. **Определение сигнала.** Стратегия подписывается на свечи выбранного таймфрейма (по умолчанию 15 минут) и рассчитывает быструю и медленную простые скользящие средние. Пересечение вверх запускает «бычий» цикл восстановления, пересечение вниз – «медвежий».
2. **Первый ордер.** При старте цикла открывается рыночная позиция с базовым объёмом. Уровни тейк-профита и восстановительной зоны переводятся из пунктов в цену инструмента с учётом шага цены.
3. **Зона восстановления.** Если рынок движется против позиции на величину восстановительной зоны, стратегия разворачивает направление и увеличивает объём согласно исходной формуле (до заданного числа шагов). Последовательность чередующихся позиций компенсирует убытки при возврате цены в сторону тейк-профита.
4. **Управление прибылью.** Стратегия отслеживает нереализованную прибыль:
   - Денежный и процентный тейк-профит закрывают позицию сразу.
   - Опциональное трейлинг-сопровождение активируется после достижения заданной прибыли и защищает её стопом в деньгах.
5. **Сброс цикла.** После фиксации прибыли или закрытия по трейлингу цикл сбрасывается и стратегия ожидает нового сигнала по средним.

## Ключевые параметры

- **Use TP Money / TP Money** – включение и величина тейк-профита в деньгах.
- **Use TP % / TP Percent** – включение и величина тейк-профита в процентах от баланса портфеля.
- **Enable Trailing / Trailing TP / Trailing SL** – активация трейлинг-управления и настройка уровня срабатывания и защитной дистанции.
- **TP Pips / Zone Pips** – дистанция тейк-профита и ширина зоны восстановления в пунктах.
- **Base Volume / Max Trades** – базовый объём и число допустимых шагов восстановления.
- **Fast MA / Slow MA** – периоды скользящих средних для сигналов.
- **Profit Offset** – дополнительный сдвиг в формуле расчёта объёмов.

## Примечания

- Используется высокоуровневый API StockSharp с подпиской на свечи и привязкой индикаторов.
- Хеджирование имитируется через переворот чистой позиции и масштабирование объёма, что соответствует неттинговой модели учёта в StockSharp.
- Трейлинг и денежные тейк-профиты рассчитываются по нереализованной прибыли относительно средней цены позиции. Настраивайте денежные значения под специфику инструмента.
- Перед использованием на реальном счёте протестируйте стратегию на демо или в тестере.

## Файлы

- `CS/ZoneRecoveryFormulaStrategy.cs` – реализация стратегии на C#.
- `README.md` – документация на английском.
- `README_ru.md` – данная документация на русском.
- `README_cn.md` – документация на китайском.
