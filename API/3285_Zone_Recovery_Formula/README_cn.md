# Zone Recovery Formula 策略

## 概述

**Zone Recovery Formula Strategy** 是 MetaTrader 4 "Zone Recovery Formula" 智能交易系统的移植版本。策略通过快慢移动平均线判断趋势方向，并在价格进入不利区域时使用“分区恢复”算法反向加仓，直到价格重新回到目标区间，实现亏损回补与获利。

## 工作流程

1. **信号识别**：订阅指定周期的K线（默认15分钟），计算快慢简单移动平均线。快线向上突破慢线时启动多头恢复循环，反之启动空头循环。
2. **初始建仓**：循环启动后，根据基础手数乘数在市场价成交。根据点值设置，将止盈距离和恢复区间转换为真实价格距离。
3. **恢复区间**：若价格逆势运行超过恢复区宽度，策略将反向并按公式增加下一个手数（直至达到最大交易次数），形成交替的多空仓位，帮助在价格回到目标后弥补亏损。
4. **收益管理**：
   - 可按资金或账户百分比设定止盈，达到条件即平仓。
   - 可选的跟踪管理在收益达到阈值后启用，并以金额形式的回撤保护盈利。
5. **循环重置**：当达到利润目标或跟踪止损触发后，平仓并重置循环，等待新的移动平均信号。

## 主要参数

- **Use TP Money / TP Money**：是否按金额止盈及其目标值。
- **Use TP % / TP Percent**：是否按账户百分比止盈及其目标值。
- **Enable Trailing / Trailing TP / Trailing SL**：启用跟踪管理、设置启动收益与保护回撤距离。
- **TP Pips / Zone Pips**：止盈距离与恢复区间宽度（点数）。
- **Base Volume / Max Trades**：初始手数与恢复循环允许的最大步骤。
- **Fast MA / Slow MA**：用于信号的快慢均线周期。
- **Profit Offset**：恢复手数公式中的可选修正项。

## 注意事项

- 策略使用 StockSharp 的高级 API，通过烛线订阅与指标绑定完成计算。
- 对冲通过在净头寸模型下翻转方向并扩大量来模拟，适配 StockSharp 的净持仓账户方式。
- 跟踪与止盈基于当前持仓的未实现盈亏，请根据合约规格调整金额参数。
- 在真实账户使用前，请先在模拟环境或回测工具中充分验证。

## 文件列表

- `CS/ZoneRecoveryFormulaStrategy.cs` – 策略的 C# 实现。
- `README.md` – 英文说明。
- `README_ru.md` – 俄文说明。
- `README_cn.md` – 中文说明。
