# VR Moving Distance 策略
[English](README.md) | [Русский](README_ru.md)

该 StockSharp 策略复刻了 MetaTrader 5 的 VR-Moving 智能交易程序。策略监控一条可配置的均线，当价格偏离均线达到设定点差时触发交易。它可以通过放大追加订单的基础手数来加仓趋势，并在只持有一笔仓位时使用简单的止盈逻辑。

## 策略概览
- 通过单一的 K 线订阅处理指定品种的数据。
- 计算带有可调周期、平滑方式和价格来源的移动平均线。
- 使用合约的最小价格步长将点差型参数（距离、止盈）转换为价格单位。
- 当价格上穿均线并超过设定距离时加多单；当价格下穿均线并超过设定距离时加空单。
- 反向开仓前先平掉当前净头寸，使策略在净持仓模式下也能运行。

## 指标与数据
- 单一移动平均指标（支持 `Simple`、`Exponential`、`Smoothed`、`Weighted`、`VolumeWeighted`）。
- 所有计算和交易决策均基于配置的 `Candle Type` K 线数据流。

## 入场逻辑
1. 每根 K 线收盘后，等待移动平均线完全形成。
2. 如果该柱最高价至少高于均线 `DistancePips` 个点，则触发做多信号。
3. 如果该柱最低价至少低于均线 `DistancePips` 个点，则触发做空信号。
4. 当方向反转时，在新的市价单中附加足够的手数以平掉原有持仓。

## 加仓与手数控制
- 首笔订单使用参数 `BaseVolume` 指定的手数。
- 同方向的后续订单使用 `BaseVolume * VolumeMultiplier` 手数。
- 策略记录多单的最高进场价和空单的最低进场价，只有当价格再次远离这些极值 `DistancePips` 点时才会继续加仓。

## 离场逻辑
- 当且仅当存在一笔多单时，在进场价上方 `TakeProfitPips` 点设置止盈，若后续 K 线最高价触及该价位则平仓。
- 空单同理，在进场价下方 `TakeProfitPips` 点设置止盈，若后续最低价触及该价位则平仓。
- 如果已经加仓形成多笔订单，策略会继续持有仓位等待新的加仓信号，本移植版本不执行加权退出。

## 风险控制说明
- 启动时调用 `StartProtection()` 以接入 StockSharp 标准的保护机制。
- 距离和止盈参数均以点（pip）为单位。对于三位或五位小数报价，策略会将价格步长乘以 10，以匹配 MetaTrader 的点值定义。
- 未设置自动止损，请通过参数或外部风控约束控制风险。

## 参数列表
- **Candle Type** – K 线数据类型。
- **MA Length** – 移动平均周期。
- **MA Type** – 移动平均的平滑方式。
- **Price Source** – 计算移动平均所使用的价格字段。
- **Distance (pips)** – 触发进场所需的最小点差距离。
- **Take Profit (pips)** – 单笔仓位下的止盈距离。
- **Volume Multiplier** – 加仓订单的手数倍率。
- **Base Volume** – 首次下单的基础手数。
