# Стратегия Polish Layer

## Обзор
**Polish Layer** — это порт оригинального советника MetaTrader из `MQL/17484` на высокоуровневый API StockSharp. Стратегия ориентирована на краткосрочное продолжение тренда на валютных парах и работает со свечами 5 или 15 минут. Направление тренда определяется положением быстрой и медленной экспоненциальных средних и наклоном RSI, рассчитанного по предыдущим барам. Для входа требуется одновременное подтверждение осцилляторами Stochastic, DeMarker и Williams %R.

## Индикаторы
- **EMA (Exponential Moving Average)** — быстрая (`ShortEmaPeriod`) и медленная (`LongEmaPeriod`) скользящие для фильтра тренда.
- **RSI (Relative Strength Index)** — фильтр импульса по разнице между значениями предыдущих свечей.
- **Stochastic Oscillator** — отслеживает пробои уровней перепроданности/перекупленности по линии %K.
- **DeMarker** — подтверждает накопление или распределение.
- **Williams %R** — фиксирует разворот импульса в крайних зонах.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `ShortEmaPeriod` | 9 | Период быстрой EMA. |
| `LongEmaPeriod` | 45 | Период медленной EMA. |
| `RsiPeriod` | 14 | Длина RSI для оценки наклона. |
| `StochasticKPeriod` | 5 | Период линии %K. |
| `StochasticDPeriod` | 3 | Период сглаживания %D. |
| `StochasticSlowing` | 3 | Финальное сглаживание %K. |
| `WilliamsRPeriod` | 14 | Окно расчёта Williams %R. |
| `DeMarkerPeriod` | 14 | Окно расчёта DeMarker. |
| `TakeProfitPoints` | 17 | Размер тейк-профита в пунктах цены (`PriceStep`). |
| `StopLossPoints` | 77 | Размер стоп-лосса в пунктах цены. |
| `CandleType` | 5 минут | Тип свечей, с которыми работает стратегия. |
| `Volume` | 1 | Объём сделки при входе. |

## Логика торговли
1. **Фильтр тренда** — для покупок быстрая EMA (значение предыдущей свечи) должна быть выше медленной, а RSI предыдущей свечи — выше значения двумя барами ранее. Для продаж выполняется зеркальное условие.
2. **Подтверждение осцилляторами** — вход возможен только при отсутствии открытых позиций и выполнении всех условий:
   - Линия %K стохастика пересекает уровень 19 снизу вверх для лонга или 81 сверху вниз для шорта.
   - Индикатор DeMarker пересекает уровень 0.35 вверх (лонг) или 0.63 вниз (шорт).
   - Williams %R пересекает уровень -81 вверх (лонг) или -19 вниз (шорт).
3. **Исполнение** — используется рыночный вход `BuyMarket(Volume)` или `SellMarket(Volume)` с автоматическим выставлением стоп-лосса и тейк-профита через `StartProtection`.

## Управление рисками
- `StartProtection` преобразует значения `TakeProfitPoints` и `StopLossPoints` в абсолютные расстояния на основе `Security.PriceStep` и сопровождает позицию защитными ордерами.
- Пока позиция не закрыта защитными ордерами, стратегия не открывает новых сделок, что повторяет поведение оригинального эксперта.

## Рекомендации по использованию
- Наилучшие результаты достигаются на ликвидных валютных парах с таймфреймом 5 или 15 минут.
- Убедитесь, что у инструмента корректно задан шаг цены, иначе скорректируйте значения тейк-профита и стоп-лосса.
- Перед запуском на реальном счёте рекомендуется провести форвард-тестирование из-за чувствительности условий к сглаживанию индикаторов и точности котировок.
