# EES Hedger Strategy

## Overview

The EES Hedger strategy mirrors the behaviour of the classic MetaTrader expert advisor that automatically hedges positions created by another trading system or by manual traders. Whenever the monitored account opens a position that matches the configured filter, the strategy immediately opens an opposite position with its own parameters. By doing so it neutralises directional exposure while still allowing the original trade to run.

The algorithm is built on the high level StockSharp API. It listens to account trades, opens hedge positions, and manages protective orders through stop-loss, take-profit and trailing stop logic. Trailing management follows the original implementation closely, only advancing the stop when price movement exceeds both the stop distance and the trailing increment.

## Parameters

| Name | Description |
| --- | --- |
| `HedgeVolume` | Fixed volume for the hedge order. It does not depend on the external trade size. |
| `StopLossPips` | Distance in pips for the protective stop-loss of the hedge. Set to zero to skip the initial stop. |
| `TakeProfitPips` | Distance in pips for the take-profit order. Set to zero to omit the target. |
| `TrailingStopPips` | Distance in pips used for trailing once price moves favourably. |
| `TrailingStepPips` | Minimum pip movement required before moving the trailing stop again. Must be positive when trailing is active. |
| `OriginalOrderComment` | Optional comment filter. Only trades whose comment matches this value (case-insensitive) will be hedged. Leave empty to react to every trade. |
| `HedgerOrderComment` | Optional comment used to recognise the strategy's own hedge trades. When supplied, trades carrying the same comment are ignored to prevent re-hedging. |

## Behaviour

1. **Trade detection** – the strategy subscribes to `NewMyTrade` events of the connector. Each trade that comes from the selected security and passes the comment filters is treated as an external entry signal.
2. **Hedge execution** – as soon as a qualifying trade is seen, the strategy submits a market order in the opposite direction using `HedgeVolume`.
3. **Protection setup** – after each own fill the algorithm cancels existing protective orders and registers new stop-loss and take-profit orders according to the current average position price.
4. **Trailing stop** – every incoming trade tick is used to evaluate the trailing rules. Once the price has moved by at least `TrailingStopPips + TrailingStepPips` in favour of the hedge, the stop is moved closer to price. For long positions the stop trails below the market, for shorts above it.
5. **Position reset** – when the hedge position is fully closed (for example by stop or target), the strategy automatically cancels the remaining protective orders and waits for the next external trade.

## Usage Notes

- The strategy assumes that the account connector reports all account trades, including those generated by other systems.
- Pip calculation adapts to the instrument price step and multiplies by ten for 3- or 5-digit quotes, imitating the MQL point adjustment.
- Set `OriginalOrderComment` to match the comment of the primary system if only specific trades should be mirrored. When hedging manual trades, leave it empty.
- Ensure that `TrailingStepPips` remains greater than zero whenever trailing is enabled to avoid premature termination at start-up.
- Because the hedger always uses a fixed volume, you may wish to tune `HedgeVolume` so that the hedge covers the average exposure generated by the primary system.
