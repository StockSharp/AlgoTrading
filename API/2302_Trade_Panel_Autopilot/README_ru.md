# Стратегия Trade Panel Autopilot

## Обзор

Стратегия повторяет основную логику оригинального эксперта MQL4 "trade panel with autopilot". Она анализирует направление цены на нескольких таймфреймах и открывает либо закрывает позицию в зависимости от преобладающего настроения рынка.

Отслеживаются две последние свечи на восьми таймфреймах (M1, M5, M15, M30, H1, H4, D1, W1). Для каждой пары свечей выполняются сравнения по следующим компонентам:

- Open
- High
- Low
- (High + Low) / 2
- Close
- (High + Low + Close) / 3
- (High + Low + Close + Close) / 4

Каждое сравнение увеличивает счётчик **покупки** или **продажи**. Затем счётчики суммируются по всем таймфреймам и переводятся в проценты. При превышении порога открытия стратегия входит в позицию. Существующая позиция закрывается, когда противоположный процент опускается ниже порога закрытия.

## Параметры

- `Autopilot` — включает или отключает автоматическую торговлю.
- `OpenThreshold` — уровень процента для открытия новой позиции. По умолчанию: 85.
- `CloseThreshold` — уровень процента для закрытия позиции. По умолчанию: 55.
- `LotFixed` — фиксированный объём заявки при активном `UseFixedLot`.
- `LotPercent` — объём как процент от стоимости портфеля, если `UseFixedLot` отключён.
- `UseFixedLot` — переключение между фиксированным и процентным объёмом.
- `UseStopLoss` — при включении запускает защиту позиции.

## Логика торговли

1. Подписка на свечи всех заданных таймфреймов.
2. Расчёт счётчиков покупки/продажи при появлении завершённой свечи.
3. Суммирование счётчиков и вычисление процентов покупки/продажи.
4. При отключённом `Autopilot` стратегия только отслеживает показатели.
5. Если позиция отсутствует и процент покупки превышает `OpenThreshold`, открывается длинная позиция. Если процент продажи превышает порог, открывается короткая позиция.
6. При наличии длинной позиции и снижении процента покупки ниже `CloseThreshold` позиция закрывается. Для короткой позиции используется процент продажи.

## Примечания

- В любой момент времени открыта не более одной позиции.
- При `UseStopLoss = true` вызывается `StartProtection()` для управления стоп-приказами.
