# MultiHedg 1 (тайминговый мультивалютный хедж)

## Обзор
- Конверсия эксперта MetaTrader 4 **MultiHedg_1** в стратегию StockSharp на высокоуровневом API.
- Выполняет синхронные входы до десяти валютных инструментов по расписанию.
- Предназначена для ручного выбора направления (покупка или продажа) всей корзины.

## Логика торговли
1. **Окно входа по времени** – как только время текущей свечи попадает в интервал `[TradeHour:TradeMinute, TradeHour:TradeMinute + DurationSeconds]`, стратегия отправляет рыночные заявки по каждому включенному инструменту. При наличии встречной позиции объём увеличивается так, чтобы итоговая позиция совпала с заданным лотом.
2. **Опциональное тайм-закрытие** – при активном `UseCloseTime` тот же интервал длительности используется для окна выхода (`CloseHour:CloseMinute`). В этот промежуток стратегия закрывает все управляемые позиции через `ClosePosition`.
3. **Защита по equity** – параметр `CloseByPercent` сравнивает текущее значение портфеля (`Portfolio.CurrentValue`) с последним зафиксированным балансом при нулевых позициях. При росте выше `PercentProfit`% или просадке ниже `PercentLoss`% корзина закрывается целиком.
4. **Обновление базового баланса** – после каждой полной ликвидации или когда все инструменты обнулены, эталонный баланс пересчитывается, что воспроизводит поведение `AccountBalance()` из оригинального советника.

## Параметры
| Группа | Параметр | Описание |
|--------|----------|----------|
| Orders | `Sell` | При `true` открываются продажи, иначе покупки. |
| Schedule | `TradeHour`, `TradeMinute` | Время открытия окна входа (по времени терминала). |
| Schedule | `DurationSeconds` | Длительность окна входа и выхода (общая для обоих). |
| Schedule | `UseCloseTime` | Включает окно принудительного закрытия. |
| Schedule | `CloseHour`, `CloseMinute` | Время начала окна закрытия. |
| Risk | `CloseByPercent` | Активирует защиту по доходности портфеля. |
| Risk | `PercentProfit`, `PercentLoss` | Процентные пороги прибыли и убытка относительно контрольного баланса. |
| Data | `CandleType` | Таймфрейм, по которому выполняется проверка расписания (рекомендуется 1 минута). |
| Symbols | `UseSymbolN` | Включение N-го слота (по умолчанию активны первые шесть). |
| Symbols | `SymbolN` | Инструмент, назначенный слоту. Необходимо задать до запуска стратегии. |
| Symbols | `SymbolNVolume` | Объём заявки для слота (по умолчанию 0.1 … 1.0 лота). |

## Рекомендации
- Настройте объекты `Security` для каждого слота с `UseSymbolN = true`; пустые слоты игнорируются автоматически.
- Механизм MT4 «magic number» не переносился – стратегия закрывает позиции только по указанным инструментам.
- Таймфрейм `CandleType` должен соответствовать торговой сессии брокера, используемой оригиналом. Для нескольких коннекторов подписывайте каждый инструмент на одинаковый таймфрейм.
- Защита по equity требует, чтобы адаптер портфеля предоставлял корректные `CurrentValue`/`BeginValue`.
- Python-версия намеренно не создавалась по запросу.
