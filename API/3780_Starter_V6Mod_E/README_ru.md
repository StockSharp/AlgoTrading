# Starter V6 Mod E

**Starter V6 Mod E** — перенос советника MetaTrader 4 `Starter_v6mod_e_www_forex-instruments_info.mq4` на высокоуровневый API StockSharp. Стратегия сохраняет оригинальное сочетание экстремумов Laguerre, двойного EMA-фильтра, индикатора CCI и ограничения по углу EMA, при этом логика исполнения адаптирована под событийную модель StockSharp.

## Логика торговли

- **Трендовый фильтр**: рассчитывается наклон 34-периодной EMA между настраиваемыми сдвигами. Наклон переводится в пункты: положительный разрешает только покупки, отрицательный — только продажи, а плоский запретит новые входы.
- **Экстремумы Laguerre**: реализован собственный Laguerre RSI (γ = 0.7 по умолчанию) с диапазоном 0–1. Для входа в лонг текущие и предыдущие значения должны быть ниже `Laguerre Oversold`, для входа в шорт — выше `Laguerre Overbought`.
- **Фильтр EMA**: медленная (120) и быстрая (40) EMA по цене MEDIAN обязаны одновременно расти для покупок и падать для продаж.
- **Подтверждение CCI**: CCI с периодом 14 должен опуститься ниже `-CCI Threshold` для лонга и подняться выше `+CCI Threshold` для шорта — аналог переменной `Alpha` из MQL.
- **Пятничная защита**: после `Friday Block Hour` новые сделки блокируются, а в момент `Friday Exit Hour` оставшиеся позиции закрываются перед выходными.

## Управление риском

- Настраиваемые расстояния до стоп-лосса, тейк-профита и трейлинг-стопа (в пунктах) воспроизводят блок управления капиталом исходного советника.
- Трейлинг-стоп отслеживает максимальную/минимальную цену после входа и закрывает позицию при заданном откате.
- Закрытия выполняются командами `SellMarket`/`BuyMarket`, что соответствует требованиям высокоуровневого API.

## Параметры

| Параметр | Описание |
|----------|----------|
| `Volume` | Объём заявки при входе по рынку. |
| `StopLossPips` | Дистанция стоп-лосса в пунктах. |
| `TakeProfitPips` | Цель по прибыли в пунктах. |
| `TrailingStopPips` | Дистанция трейлинг-стопа (0 отключает). |
| `SlowEmaPeriod` | Период медленной EMA по PRICE_MEDIAN. |
| `FastEmaPeriod` | Период быстрой EMA по PRICE_MEDIAN. |
| `AngleEmaPeriod` | Период EMA для расчёта наклона. |
| `AngleStartShift` / `AngleEndShift` | Сдвиги баров для вычисления наклона EMA. |
| `AngleThreshold` | Минимальный наклон (в пунктах), разрешающий торговлю. |
| `CciPeriod` / `CciThreshold` | Период и абсолютный порог индикатора CCI. |
| `LaguerreGamma` | Параметр γ Laguerre-осциллятора. |
| `LaguerreOversold` / `LaguerreOverbought` | Пороговые уровни Laguerre в диапазоне 0–1. |
| `CandleType` | Тип свечей (по умолчанию 1 минута). |
| `FridayBlockHour` / `FridayExitHour` | Часы локального времени для пятничных ограничений. |

## Особенности конверсии

- Laguerre реализован по исходной рекуррентной формуле, что сохраняет диапазон 0–1 и сглаживание γ.
- Наклон EMA заменяет MQL-функцию угла, вычисляясь как разность исторических значений в пунктах.
- Элементы управления капиталом типа сетки/маржинальных порогов опущены — в предоставленной версии MT4 они не использовались, а StockSharp подразумевает явный контроль портфеля.
- Обработчик `OnNewMyTrade` фиксирует цену сделок для обновления трейлинг-стопа и экстремумов позиции.
