# Стратегия Sensitive MACD Trailing

## Описание
Стратегия является переносом советника «Sensitive» для MetaTrader 5 на платформу StockSharp. Основная идея — отрабатывать пересечения линий MACD вблизи нулевой отметки и сопровождать позицию набором защитных инструментов: фиксированными стоп-лоссом и тейк-профитом, а также ступенчатым трейлинг-стопом в пунктах. Вся логика работает только на закрытых свечах и использует высокоуровневый API.

## Используемые данные и индикаторы
- **MACD (Moving Average Convergence Divergence)** с настраиваемыми периодами быстрой, медленной EMA и сигнальной линии.
- **Свечи** выбранного таймфрейма (параметр `CandleType`).

## Правила входа
1. Новый сигнал анализируется только после завершения очередной свечи.
2. Из привязанного MACD получаем значения основной и сигнальной линий.
3. **Покупка** выполняется, если выполняются условия:
   - Линия MACD пересекла сигнальную снизу вверх (текущее `macd > signal`, предыдущее `macd < signal`).
   - Значение MACD остаётся отрицательным.
   - Модуль MACD больше `MacdOpenLevel * Point`, что отсекает слабые колебания.
   - Текущая позиция не длинная (`Position <= 0`). При наличии короткой позиции выполняется разворот за один рыночный ордер.
4. **Продажа** симметрична покупкам:
   - MACD пересекает сигнал сверху вниз, оставаясь положительным.
   - Модуль MACD превышает порог.
   - Нет активной короткой позиции (`Position >= 0`), при необходимости выполняется разворот из лонга.

## Управление сделкой
- **Тейк-профит** рассчитывается в момент входа по параметру `TakeProfitPips`. Длинная позиция закрывается, когда максимум свечи достигает целевой цены, короткая — когда минимум уходит ниже целевого уровня.
- **Стоп-лосс** строится аналогично по `StopLossPips`. Для лонга выход происходит при касании стоп-уровня минимумом свечи, для шорта — при пробое максимума.
- **Трейлинг-стоп** активируется, если `TrailingStopPips > 0`. После того как цена прошла в сторону позиции не менее `TrailingStopPips + TrailingStepPips` пунктов, стоп подтягивается вслед за ценой, сохраняя расстояние `TrailingStopPips`. Каждый следующий шаг выполняется только при дополнительном продвижении на величину `TrailingStepPips`. Если трейлинг включён, но шаг равен нулю, стратегия выводит сообщение об ошибке и останавливается.
- После закрытия позиции внутренние переменные (`_entryPrice`, `_stopLoss`, `_takeProfit`) очищаются, чтобы избежать повторного срабатывания старых уровней.

## Объём сделок
Количество контрактов задаётся параметром `Volume` (по умолчанию 0.1). При развороте позиция закрывается и открывается новое направление одной рыночной заявкой: к целевому объёму прибавляется абсолютное значение текущей позиции.

## Параметры
| Параметр | Назначение | Значение по умолчанию |
|----------|------------|------------------------|
| `FastLength` | Период быстрой EMA в MACD | 12 |
| `SlowLength` | Период медленной EMA в MACD | 26 |
| `SignalLength` | Период сигнальной EMA | 9 |
| `MacdOpenLevel` | Минимальная величина MACD (в ценовых пунктах) для открытия сделки | 3 |
| `StopLossPips` | Дистанция стоп-лосса в пунктах | 35 |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах | 75 |
| `TrailingStopPips` | Базовое расстояние трейлинг-стопа (0 — выключено) | 5 |
| `TrailingStepPips` | Минимальный шаг цены для обновления трейлинг-стопа | 5 |
| `CandleType` | Тип и таймфрейм свечей | Свечи 1 минуты |
| `Volume` | Торговый объём (лоты/контракты) | 0.1 |

## Дополнительные сведения
- Пункты и величина `Point` вычисляются из шага цены и количества знаков инструмента; для трёх- и пятизнаковых форекс-символов величина пункта автоматически масштабируется.
- Все комментарии в коде на английском языке, реализация использует только высокоуровневые методы, как предписано в инструкциях.
- Стратегия предполагает мгновенное исполнение рыночных ордеров. Если необходимо учитывать частичное исполнение или проскальзывание, логику можно доработать.
