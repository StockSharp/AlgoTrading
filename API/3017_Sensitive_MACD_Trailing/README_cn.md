# 敏感型 MACD 跟踪策略

## 概述
该策略是 MetaTrader 5 平台上 “Sensitive” MACD 智能交易系统的 StockSharp 版实现。策略结合了 MACD 金叉/死叉信号与可配置的风控模块（固定止损、止盈以及按点数计算的移动止损）。所有决策仅基于已完成的 K 线，并通过高级 API 订阅所需周期。

## 指标与数据
- **MACD 指标**：快速、慢速以及信号 EMA 周期均可独立配置。
- **K 线数据**：通过 `CandleType` 参数选择任意时间框架。

## 入场逻辑
1. 仅在新 K 线收盘后才进行判断，避免盘中噪声。
2. 绑定 MACD 指标后得到两个值：
   - `macd`：MACD 主线数值。
   - `signal`：MACD 信号线（主线差值的 EMA）。
3. **做多条件**：
   - MACD 主线从下向上穿越信号线（当前 `macd > signal`，上一根仍满足 `macd < signal`）。
   - MACD 仍位于零轴下方 (`macd < 0`)。
   - `|macd|` 大于 `MacdOpenLevel * Point`，确保信号幅度足够大。
   - 当前净持仓不为多头（`Position <= 0`）。若持有空头，则一次市价单反向并开多。
4. **做空条件**：
   - MACD 主线从上向下跌破信号线，且仍位于零轴上方。
   - `|macd|` 超过阈值。
   - 当前净持仓不为空头（`Position >= 0`）。若已有多头则先反手再建空。

## 离场与风控
- **止盈**：建仓后保存目标价，距离由 `TakeProfitPips` 控制。多头若最高价触及目标则平仓，空头则由最低价触发。
- **止损**：根据 `StopLossPips` 计算保护价。多头价格跌至止损价即市价离场，空头在价格升至止损价时平仓。
- **移动止损**：当 `TrailingStopPips` 不为零时启动。价格相对于入场至少推进 `TrailingStopPips + TrailingStepPips` 点后开始锁定利润，随后每次刷新收盘价都会尝试把止损上移（或下移），始终保持预设距离。若启用移动止损却将 `TrailingStepPips` 设为零，策略会记录错误并停止。
- 持仓归零时，内部跟踪变量全部重置，等待下一次交易。

## 仓位管理
交易数量由内置的 `Volume` 参数决定（默认 0.1）。反向开仓时会自动把当前持仓绝对值加到目标数量上，确保一次市价单即可完成反手并建仓。

## 参数列表
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `FastLength` | MACD 快速 EMA 周期 | 12 |
| `SlowLength` | MACD 慢速 EMA 周期 | 26 |
| `SignalLength` | MACD 信号线 EMA 周期 | 9 |
| `MacdOpenLevel` | 触发交易所需的最小 MACD 振幅（按价格点计算） | 3 |
| `StopLossPips` | 固定止损距离（点） | 35 |
| `TakeProfitPips` | 固定止盈距离（点） | 75 |
| `TrailingStopPips` | 移动止损基础距离（点，0 表示关闭） | 5 |
| `TrailingStepPips` | 移动止损启动所需的额外位移（点） | 5 |
| `CandleType` | 计算所使用的 K 线类型 | 1 分钟 K 线 |
| `Volume` | 下单数量（手数或合约数） | 0.1 |

## 其他说明
- 策略根据品种的最小报价步长和小数位推导出点值；针对 3 位或 5 位报价的外汇品种会自动放大一个数量级，以匹配常规 “pip” 定义。
- 代码中的注释全部使用英文，并严格采用项目要求的高级 API 结构。
- 策略默认假设市价单即时成交，未额外处理部分成交或滑点，可根据实际需求扩展。
