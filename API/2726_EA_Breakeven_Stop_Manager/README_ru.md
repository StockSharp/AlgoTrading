# Стратегия EA Breakeven Stop Manager
[English](README.md) | [中文](README_cn.md)

Утилитарная стратегия повторяет работу советника MetaTrader 5 `eaBreakeven`. Она **не** открывает сделки самостоятельно. Её задача — следить за текущей позицией и, когда накопленная прибыль достигает заданного порога, переносить защитный стоп на цену входа с дополнительным запасом, тем самым фиксируя часть прибыли.

## Основная идея

- Подходит трейдерам, которые хотят доверить StockSharp управление стопами, оставив открытие позиций другой системе.
- Работает как с длинными, так и с короткими позициями на любых инструментах, предоставляющих котировки bid/ask.
- Использует минимальный шаг цены инструмента, преобразуя «пункты» в реальные изменения цены — аналогично оригиналу на MQL5.

## Алгоритм работы

1. Подписывается на поток Level1 и отслеживает последние значения лучшего bid и лучшего ask.
2. Пока позиции нет — стратегия ничего не делает.
3. Для **длинной позиции**:
   - Ждёт, пока лучший bid не оторвётся от средней цены входа минимум на `BreakevenPoints` пунктов.
   - После срабатывания условия запоминает уровень стопа `цена входа + DistancePoints`.
   - Если bid возвращается к этому уровню, позиция закрывается рыночным ордером, чтобы сохранить прибыль.
4. Для **короткой позиции**:
   - Ждёт, пока лучший ask опустится на `BreakevenPoints` ниже средней цены входа.
   - Устанавливает защитный уровень `цена входа - DistancePoints`.
   - При возврате ask к этому уровню короткая позиция закрывается рыночным ордером.
5. При включённом параметре логируется уведомление о каждом переносе стопа в безубыток.

В оригинальном советнике стоп-лосс модифицировался на стороне терминала. В StockSharp стратегия просто отправляет рыночный ордер при достижении вычисленного уровня, что приводит к идентичному финансовому результату.

## Параметры

- `BreakevenPoints` (по умолчанию **15**)
  - Количество пунктов плавающей прибыли, необходимое для перевода стопа в безубыток.
  - Отрицательное значение полностью отключает перенос стопа.
- `DistancePoints` (по умолчанию **5**)
  - Дополнительный буфер в пунктах от цены входа, определяющий размер фиксируемой прибыли.
- `EnableNotifications` (по умолчанию **true**)
  - При включении стратегия пишет сообщение в лог при каждом обновлении стоп-уровня.

## Сигналы и заявки

- **Входы**: отсутствуют, стратегия рассчитывает на внешнюю логику открытия.
- **Выходы**: рыночные заявки при достижении сохранённого уровня безубытка.
- **Типы заявок**: только рыночные, без отложенных ордеров.

## Управление рисками

- Безубыток активируется лишь после накопления достаточной прибыли, что предотвращает преждевременные выходы.
- Буфер фиксирует результат чуть выше цены входа, а не ровно в точке открытия.
- После закрытия позиции внутреннее состояние очищается и новая сделка начинается «с чистого листа».

## Практические советы

- Комбинируйте с любой стратегией, которая передаёт управление стопами внешнему модулю.
- Работает как в реальной торговле, так и в тестах, при условии наличия данных Level1.
- Убедитесь, что у инструмента корректно задан `PriceStep`, иначе расчёт пунктов будет неточным.

## Базовые фильтры

- Категория: Управление рисками
- Направление: Лонг и Шорт
- Индикаторы: Нет
- Стопы: Безубыток
- Сложность: Начальный уровень
- Таймфрейм: Не зависит (подходит для тиковых, внутридневных и дневных данных)
- Сезонность: Нет
- Нейросети: Нет
- Дивергенции: Нет
- Уровень риска: Низкий
