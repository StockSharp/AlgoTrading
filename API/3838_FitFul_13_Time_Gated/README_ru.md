# FitFul 13 с временными фильтрами

## Обзор
**FitFul 13 с временными фильтрами** — порт эксперта MetaTrader 4 «FitFul_13» на платформу StockSharp. Стратегия строит лестницу недельных пивотов (PP, R0.5, R1, R1.5, R2, R2.5, R3 и симметричные уровни поддержки) по максимуму, минимуму и закрытию предыдущей недели. Торговые решения принимаются на основном таймфрейме (по умолчанию 1 час) и подтверждаются более быстрым таймфреймом (по умолчанию 15 минут). Новые позиции разрешены только в заданные минуты часа, что повторяет логику исходного советника.

## Логика сигналов
1. **Расчёт недельных пивотов**
   - После закрытия каждой недельной свечи пересчитывается весь набор уровней.
   - Стоп и тейк рассчитываются от базовых уровней с учётом настраиваемого отступа в пунктах.
2. **Условия на основном таймфрейме**
   - Последняя завершённая свеча должна быть бычьей для поиска лонга или медвежьей для поиска шорта.
   - Предыдущая свеча обязана пересекать соответствующий уровень пивота (для лонга — открыть ниже и закрыть выше, для шорта наоборот).
3. **Условия на подтверждающем таймфрейме**
   - При бычьей текущей подтверждающей свече минимумы двух предыдущих свечей должны пробивать уровень и закрываться выше него.
   - При медвежьей подтверждающей свече максимумы двух предыдущих свечей должны пробивать уровень и закрываться ниже него.
4. **Временные фильтры**
   - Сделка открывается только если минута открытия завершённой основной свечи равна одному из четырёх настроенных значений (по умолчанию 0, 15, 30 или 45).
   - Чистая позиция ограничена значением `MaxNetPositions × Volume`, что имитирует максимум три ордера у версии MT4.

## Управление рисками
- **Стоп и тейк** — назначаются сразу после открытия позиции, используя ближайшие уровни пивотов.
- **Трейлинг-стоп** — при движении цены на заданное количество пунктов стоп подтягивается в сторону прибыли.
- **Ограничение по времени** — прибыльные позиции закрываются, если время удержания превысило установленный порог (по умолчанию 48 часов).
- **Правило пятницы** — в пятницу все позиции закрываются в выбранном интервале времени (по умолчанию 21:50–21:59).

## Параметры
| Имя | Описание |
| --- | --- |
| `PrimaryCandleType` | Таймфрейм для поиска пересечения пивотов. |
| `ConfirmationCandleType` | Быстрый таймфрейм для подтверждения реакции на уровень. |
| `Volume` | Объём рыночной заявки. |
| `MaxNetPositions` | Максимальная чистая позиция в кратных значениях `Volume`. |
| `OffsetPoints` | Отступ в пунктах для расчёта стопов и тейков. |
| `TrailingStopPoints` | Размер трейлинг-стопа в пунктах. |
| `CloseAfter` | Максимальное время удержания прибыльной позиции. |
| `CloseHour`, `CloseMinuteFrom`, `CloseMinuteTo` | Временное окно принудительного закрытия в пятницу. |
| `EntryMinute0..3` | Допустимые минуты часа для открытия новых позиций. |

## Примечания
- В портированной версии сохранены недельные пивоты и дискретный тайминг входов оригинального советника.
- Управление капиталом упрощено: параметр `Volume` напрямую задаёт объём сделки вместо сложного расчёта лота в MT4.
- Все комментарии в коде написаны на английском языке согласно требованиям репозитория.
