# PosNegDiCrossoverStrategy

## Обзор
**PosNegDiCrossoverStrategy** — это перенос MetaTrader-советника `_HPCS_PosNegDIsCrossOver_Mt4_EA_V01_WE` на платформу StockSharp.
Алгоритм анализирует пересечения линий +DI и -DI индикатора ADX, открывая сделки в сторону нового лидера. Каждая позиция
страхуется симметричными стоп-лоссом и тейк-профитом (в пунктах), а серия убыточных сделок сопровождается мартингейл-петлей:
объём умножается на заданный коэффициент до достижения прибыли или лимита попыток.

## Логика работы
1. **Определение сигнала.** После закрытия свечи стратегия получает свежие значения ADX и сравнивает текущие +DI/-DI с
   предыдущими. Пересечение +DI вверх даёт сигнал на покупку, пересечение вниз — на продажу. Как и в оригинальном коде, на одну
   свечу приходится только один стартовый вход.
2. **Временной фильтр.** Новые сделки разрешены только внутри окна `StartTime`–`StopTime`. Вне интервала стратегия продолжает
   сопровождать открытые позиции (виртуальные стопы и цели), но не запускает новые циклы и не продолжает мартингейл.
3. **Выставление заявок.** При появлении сигнала отправляется рыночная заявка объёмом `OrderVolume`. После исполнения значения
   `TakeProfitPips` и `StopLossPips` переводятся в абсолютные цены с учётом шага цены инструмента (для трёх- и пятизнаковых
   котировок используется множитель 10) и сохраняются для дальнейшей проверки.
4. **Сопровождение позиции.** По завершении каждой свечи проверяется диапазон: для лонга пробой минимума ниже стопа или достижение
   максимума выше цели приводит к закрытию рыночной заявкой; для шорта условия зеркальные. Такой подход позволяет мгновенно
   классифицировать исход сделки.
5. **Мартингейл.** Если выход был убыточным, объём умножается на `MartingaleMultiplier`, счётчик цикла увеличивается и выполняется
   повторный вход в ту же сторону (при условии, что время всё ещё подходит). После прибыльного выхода или при достижении
   `MartingaleCycleLimit` цикл сбрасывается и стратегия ждёт следующего пересечения ADX.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --------------------- | -------- |
| `CandleType` | таймфрейм 15 минут | Свечи, по которым рассчитывается ADX и проверяются стоп/тейк. |
| `AdxPeriod` | 14 | Длина индикатора ADX. |
| `UseTimeFilter` | `true` | Включает фильтр торгового окна. |
| `StartTime` | 00:00 | Начало торгового окна (биржевое время). |
| `StopTime` | 23:59 | Конец торгового окна (биржевое время). |
| `OrderVolume` | 0,1 | Базовый объём рыночных заявок. |
| `TakeProfitPips` | 10 | Дистанция до цели в пунктах (переводится в цену). |
| `StopLossPips` | 10 | Дистанция до стоп-лосса в пунктах. |
| `MartingaleMultiplier` | 2 | Множитель объёма после убыточной сделки. |
| `MartingaleCycleLimit` | 5 | Максимальное число мартингейл-попыток для одного сигнала. |

## Дополнительные сведения
- Перед выставлением заявок вызывается `IsFormedAndOnlineAndAllowTrading()`, чтобы убедиться в готовности подключений и разрешении
  торговли.
- Виртуальные защитные уровни повторяют механику MetaTrader, где стоп и тейк задаются для позиции напрямую; обработка выполняется
  на закрытии свечей и не требует низкоуровневых API.
- Если `StartTime` и `StopTime` совпадают или `UseTimeFilter` отключён, стратегия работает круглосуточно, как и исходный эксперт с
  параметрами `is_start`/`is_stop`, охватывающими весь день.
