# Стратегия New Bar Event

## Обзор
**New Bar Event Strategy** — это пример на StockSharp, показывающий, как отлавливать момент появления новой свечи. Логика полностью повторяет оригинальный MQL-скрипт: мы сравниваем время открытия текущей свечи с ранее сохранённым значением и таким образом определяем, началась ли новая свеча. Стратегия не совершает сделок и предназначена как наглядный модуль, который можно встроить в более сложные торговые сценарии для повторного использования события «новая свеча».

## Логика работы
1. Стратегия подписывается на свечи согласно параметру `Candle Type`.
2. После закрытия каждой свечи вызывается обработчик `ProcessCandle`.
3. В обработчике берётся время открытия пришедшей свечи и сравнивается с предыдущим сохранённым временем.
4. Если сохранённое значение отсутствует, это первая свеча после запуска. Логика соответствует ветке "первого тика" в MQL, и в журнал записывается отдельное сообщение.
5. Если время открытия отличается от сохранённого, фиксируется наступление обычной новой свечи и снова создаётся запись в журнале.
6. После обработки время открытия сохраняется для следующего сравнения.

Стратегия анализирует только завершённые свечи, поэтому обработчик не вызывает повторно для той же свечи. Тем не менее, защитная проверка всё равно оставлена — это помогает сохранить предсказуемость и облегчает расширение кода.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Candle Type` | Тип (DataType) и таймфрейм свечей, по которым отслеживается событие новой свечи. | Таймфрейм 1 минута |

Параметр оформлен через `StrategyParam<DataType>`, поэтому его легко менять из пользовательского интерфейса и задействовать в оптимизации, что соответствует стандартам других конвертированных стратегий.

## Сигналы и действия
- **Первая свеча:** при получении первой завершённой свечи после запуска формируется подробное информационное сообщение. Оно напоминает, что график мог находиться в середине бара.
- **Обычная новая свеча:** каждая следующая свеча с иным временем открытия также записывается в журнал. В этом месте удобно добавлять реальную торговую логику, обновление индикаторов и т. п.

Автоматической регистрации заявок не происходит — модуль рассчитан на расширение в составе других стратегий.

## Рекомендации по использованию
1. Подключите стратегию к инструменту и выберите нужный тип свечей.
2. Запустите стратегию и следите за сообщениями в журнале — каждая новая свеча будет отображаться отдельной строкой.
3. Встраивайте модуль в более сложные решения, чтобы избавиться от ручных таймеров и перейти к событийной обработке свечей.
4. При необходимости дополните метод `ProcessCandle` торговыми правилами: например, снимайте слепки индикаторов или сбрасывайте параметры сопровождения позиции.

## Ограничения
- Работа ведётся только со свечными данными; генерация тиков или микросвечей не выполняется.
- Поскольку пример демонстрационный, дополнительные механизмы защиты и оптимизации не реализованы.
- Сообщения выводятся через `LogInfo` в журнал StockSharp; при необходимости архивирования или уведомлений потребуется собственное расширение.
