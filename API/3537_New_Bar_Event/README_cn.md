# 新K线事件策略

## 概述
**新K线事件策略** 是一个使用 StockSharp 高级 API 编写的示例，用于演示如何在收到新的蜡烛线时触发逻辑。它完整复刻了原始 MQL 脚本的思路：比较当前蜡烛的开盘时间与缓存的上一根蜡烛时间，从而判断是否出现了新的K线。策略本身不会下单，而是专注于把检测流程写得清晰，便于开发者在更复杂的系统中复用“新K线”事件触发器。

## 策略逻辑
1. 根据参数 `Candle Type` 订阅指定周期的蜡烛线数据。
2. 每当一根蜡烛收盘时都会调用 `ProcessCandle` 处理函数。
3. 处理函数读取蜡烛的开盘时间，并与上一次缓存的时间进行比较。
4. 如果缓存为空，说明这是策略启动后收到的第一根蜡烛，对应原始 MQL 中“首次收到 Tick” 的分支，策略会记录专门的日志信息。
5. 如果开盘时间与缓存不同，则说明出现了正常的新K线，策略同样会记录日志。
6. 每次检测结束后都会刷新缓存的开盘时间，确保下一根蜡烛可以正确比较。

策略只处理已经收盘的蜡烛，因此不会出现同一根蜡烛重复触发的情况。不过代码仍然保留了防御性判断，以保持与原始逻辑一致。

## 参数
| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `Candle Type` | 指定要监控的新K线周期（DataType）。 | 1分钟周期 |

该参数通过 `StrategyParam<DataType>` 暴露，便于在界面中调整或用于优化流程，与其他已转换策略的风格保持一致。

## 信号与行为
- **检测到第一根蜡烛：** 策略启动后收到的第一根蜡烛会触发详细的日志信息，提示当前可能处于蜡烛进程的中途。
- **检测到新K线：** 之后每当出现开盘时间不同的新蜡烛时都会记录日志，开发者可以在日志调用之后插入实际的交易或指标处理逻辑。

策略不会自动发送任何订单，它的定位是作为可扩展的基础模块。

## 使用建议
1. 将策略附加到某个标的上，并设置需要的蜡烛周期。
2. 启动策略，在日志窗口中观察每一次新K线的提示。
3. 在更复杂的策略中使用这一模块，以可靠的蜡烛事件替代自定义的计时器检查。
4. 如需在新K线开始时执行交易规则，可在 `ProcessCandle` 方法中扩展相应逻辑（例如重新计算指标或重置跟踪变量）。

## 限制
- 策略依赖蜡烛数据，不会尝试在内部构造 Tick 级别的信息。
- 作为演示代码，并未包含性能优化或风险控制细节。
- 日志通过 `LogInfo` 输出，在 StockSharp 的日志面板中可见；若需持久化或通知功能，需要自行扩展。
