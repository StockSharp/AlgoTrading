# Стратегия Neuro Nirvaman

## Общее описание
Стратегия Neuro Nirvaman представляет собой конвертацию эксперта MetaTrader 5 *NeuroNirvamanEA*. Логика полностью повторяет исходный код: решения принимаются с помощью трёх «перцептронов», которые получают сигналы от четырёх сглаженных Laguerre показателей положительного направленного движения (+DI) и двух индикаторов SilverTrend. Робот работает только по завершённым свечам, выставляет рыночные заявки и рассчитывает цели/стопы в пунктах. Одновременно может существовать только одна позиция.

## Используемые данные и индикаторы
- **AverageDirectionalIndex (4 экземпляра)** – для каждого Laguerre-потока создаётся свой ADX. Используется только линия +DI, которая пропускается через фильтр Лагерра.
- **LaguerrePlusDiState** – внутренний класс, реализующий алгоритм `laguerre_plusdi.mq5` (четыре стадии фильтрации, расчёт `CU / (CU + CD)`).
- **SilverTrendState (2 экземпляра)** – перенос `silvertrend_signal.mq5`. Окно `SSP = 9` анализирует последние 10 свечей, формируя стрелки (`1` – продажа, `-1` – покупка, `0` – отсутствие сигнала).
- **Поток свечей** – подписка на выбранный тип свечей (`CandleType`), обработка только состояний `Finished`.

## Алгоритм работы
1. **Подготовка сигналов**
   - Значения Laguerre преобразуются в три состояния с помощью `ComputeTensionSignal`: выше `0.5 + distance/100` → `-1`, ниже `0.5 - distance/100` → `1`, иначе `0`.
   - SilverTrend обновляется на каждой свече; параметры `Risk1`, `Risk2` изменяют ширину рабочего диапазона так же, как и в MT5.
2. **Перцептроны**
   - **Перцептрон 1**: первая пара Laguerre + SilverTrend с весами `X11 - 100` и `X12 - 100`.
   - **Перцептрон 2**: вторая пара Laguerre + SilverTrend с весами `X21 - 100` и `X22 - 100`.
   - **Перцептрон 3**: третье и четвёртое Laguerre, веса `X31 - 100` и `X32 - 100`.
3. **Supervisor (`Pass`)**
   - `Pass = 3`: требуется `Perceptron3 > 0`. Если дополнительно `Perceptron2 > 0`, открывается лонг с параметрами `TakeProfit2` / `StopLoss2`. Иначе, если `Perceptron1 < 0`, открывается шорт с `TakeProfit1` / `StopLoss1`.
   - `Pass = 2`: при `Perceptron2 > 0` – покупка (вторая группа рисков). Если `Perceptron2 <= 0` – продажа с первой группой рисков.
   - `Pass = 1`: при `Perceptron1 < 0` – продажа, иначе покупка; используются параметры первой группы.
4. **Управление позицией**
   - Входы выполняются методами `BuyMarket` / `SellMarket`, объём задаётся параметром `TradeVolume`.
   - Уровни прибыли и стопа рассчитываются от цены закрытия сигнальной свечи: `entry ± points * PriceStep`. На каждой новой завершённой свече проверяются `High`/`Low`, что имитирует срабатывание MT5-ордеров.
   - Пока позиция открыта, новые сигналы игнорируются.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `CandleType` | `DataType` | 15 минут | Тип свечей для расчёта. |
| `TradeVolume` | `decimal` | 0.1 | Объём сделки. |
| `Risk1`, `Risk2` | `int` | 3 / 9 | Параметры риска SilverTrend, задающие ширину канала. |
| `Laguerre1Period` – `Laguerre4Period` | `int` | 14 | Периоды ADX для каждого Laguerre. |
| `Laguerre1Distance` – `Laguerre4Distance` | `decimal` | 0 | Ширина нейтральной зоны в процентах. |
| `X11`, `X12`, `X21`, `X22`, `X31`, `X32` | `decimal` | 100 | Весовые коэффициенты (из них вычитается 100). |
| `TakeProfit1`, `StopLoss1`, `TakeProfit2`, `StopLoss2` | `int` | 100 / 50 | Цели и стопы в пунктах. |
| `Pass` | `int` | 3 | Режим работы Supervisor. |

## Практические рекомендации
- Значения весов, равные 100, «обнуляют» соответствующий вход перцептрона. Чтобы получить сигналы, нужно смещать веса от 100.
- SilverTrend хранит внутреннее состояние между свечами, поэтому стрелки появляются в те же моменты, что и в оригинальном индикаторе.
- Проверка достижения целей выполняется по данным завершённой свечи и не учитывает внутрисвечные экстремумы между тиками.
- Стратегия рассчитана на один инструмент и не ведёт одновременную торговлю по разным бумагам.
- Перед запуском желательно протестировать набор параметров на истории и при необходимости использовать встроенные возможности оптимизации.

## Запуск
1. Скомпилируйте проект и подключите стратегию через лаунчер StockSharp или собственное приложение.
2. Назначьте инструмент, укажите тип свечей и настройте параметры (веса перцептронов, уровни риска, цели/стопы).
3. Запустите стратегию. При наличии графика автоматически отрисуются свечи, Laguerre-индикаторы и собственные сделки.
4. Следите за результатами и при необходимости останавливайте стратегию для изменения параметров.
