# Стратегия Backtesting Trade Assistant Panel

## Обзор
**Backtesting Trade Assistant Panel Strategy** — перенос эксперта MetaTrader 4 *Backtesting Trade Assistant Panel V1.10*, который в тестере предоставлял панель с кнопками BUY/SELL и полями для ввода лота, стоп-лосса и тейк-профита. В версии для StockSharp визуальные элементы заменены на параметры стратегии и публичные методы, но сценарий работы остаётся тем же: трейдер вручную инициирует сделки, а стратегия автоматически навешивает защитные ордера.

Ключевые возможности:

- Хранит настраиваемый объём заявки, а также расстояние до стоп-лосса и тейк-профита в MetaTrader-пунктах (points).
- Позволяет мгновенно открыть длинную или короткую позицию через методы `ManualBuy()` и `ManualSell()`.
- После каждой операции рассчитывает цену защитных ордеров и вызывает `SetStopLoss` / `SetTakeProfit`, повторяя механику MT4.
- Предоставляет вспомогательные методы `SetOrderVolume`, `SetStopLoss`, `SetTakeProfit`, чтобы менять параметры прямо во время работы стратегии — аналог текстовых полей в оригинальной панели.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `OrderVolume` | Объём (в лотах), который используется при отправке рыночных заявок. Значение также записывается в `Strategy.Volume`. | `0.1` |
| `StopLossPips` | Расстояние до стоп-лосса в пунктах MT4. Если указать `0`, стоп-лосс не выставляется автоматически. | `50` |
| `TakeProfitPips` | Расстояние до тейк-профита в пунктах MT4. Значение `0` отключает автоматический тейк-профит. | `100` |
| `MagicNumber` | Магический номер, сохранённый для совместимости с исходным экспертом. StockSharp напрямую его не использует, но можно применить в расширениях или логах. | `99` |

## Ручные действия
В MT4 действия выполнялись нажатием кнопок, здесь используются методы:

- `SetOrderVolume(decimal volume)` — обновляет параметр объёма и синхронизирует `Strategy.Volume`.
- `SetStopLoss(decimal pips)` / `SetTakeProfit(decimal pips)` — изменяют расстояние до защитных ордеров (в пунктах) на лету.
- `ManualBuy()` — отправляет рыночную заявку на покупку с текущим объёмом и автоматически выставляет стоп/профит, пересчитанные из пунктов в цену по данным инструмента.
- `ManualSell()` — симметричная операция для продажи.
- `CloseAllPositions()` — мгновенно закрывает текущую позицию по рынку, как это делалось в панели тестера.

При переводе пунктов в цену используется стандарт MT4: для инструментов с тремя или пятью знаками после запятой величина point равна `PriceStep * 10`, для остальных — `PriceStep`. Если биржевая информация отсутствует, применяется значение по умолчанию `0.0001`, чтобы сохранить предсказуемость.

## Особенности поведения
- Стратегия подписывается на Level1-данные и использует лучшие bid/ask. Если они недоступны, берётся последняя цена сделки.
- Никакой автоматической логики входа не реализовано — это чисто вспомогательный модуль для ручных операций.
- `MagicNumber` присутствует для совместимости; при необходимости его можно использовать в собственных фильтрах или отчётности.
- Перед вызовом `ManualBuy()`/`ManualSell()` можно менять объём и уровни защитных ордеров, полностью повторяя поведение исходной панели.

## Отличия от оригинального эксперта
- Графический интерфейс заменён на параметры и методы; управление осуществляется программно.
- Ограничение по проскальзыванию (50 пунктов в вызове `OrderSend`) не перенесено, потому что `BuyMarket`/`SellMarket` в StockSharp не поддерживают явный параметр проскальзывания. При необходимости настройте контроль на стороне коннектора или риск-модуля.
- Защитные ордера создаются через высокоуровневые методы StockSharp `SetStopLoss` и `SetTakeProfit`, что соответствует принятой архитектуре платформы.

## Рекомендации по использованию
1. Настройте инструмент, портфель и соединение в StockSharp, затем запустите стратегию.
2. Через интерфейс параметров или методы измените `OrderVolume`, `StopLossPips`, `TakeProfitPips` под текущие задачи.
3. При появлении ручного сигнала вызовите `ManualBuy()` или `ManualSell()`. Стратегия сама добавит соответствующие защитные заявки.
4. Для быстрого выхода из позиции воспользуйтесь `CloseAllPositions()` — удобно как в бэктестах, так и при живых тренировках.
