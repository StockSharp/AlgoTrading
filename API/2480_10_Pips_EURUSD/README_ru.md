# Стратегия Ten Pips EURUSD

## Общее описание
**Ten Pips EURUSD** — это стратегия пробоя диапазона предыдущей свечи. Логика полностью повторяет одноимённого советника для MetaTrader: после закрытия свечи выставляются отложенные stop-заявки выше и ниже диапазона в расчёте на движение на 10 и более пунктов. Реализация использует высокоуровневые подписки StockSharp на свечи и стакан, поэтому алгоритм легко переносится на любые торговые площадки.

## Алгоритм работы
1. Подписаться на выбранный тип свечей и дождаться появления новой активной свечи.
2. При закрытии свечи сохранить её максимум и минимум. В этот же момент отменяются все отложенные заявки — советник допускает их жизнь только в рамках одного бара.
3. На первом тике новой свечи выполнить проверки:
   - Открытие новой свечи находится внутри диапазона предыдущей (фильтр ценовых разрывов).
   - Текущая цена отстоит от экстремумов как минимум на три пункта — приблизительная оценка минимально допустимого стопа у брокера.
4. Рассчитать актуальный спред по лучшим Bid/Ask. Если поток котировок недоступен, использовать величину пункта.
5. Выставить две отложенные заявки:
   - **Buy Stop** на уровне `high прошлого бара + 2 × спред` со стопом `StopLossPips` и, если трейлинг отключён, тейк-профитом `TakeProfitPips` выше цены активации.
   - **Sell Stop** на уровне `low прошлого бара − спред` с зеркальными параметрами.
6. После завершения свечи повторить процедуру для следующего бара.

### Управление позицией
- Пока позиция открыта, стратегия отслеживает лучшие цены покупки/продажи и корректирует защитные уровни.
- При отключенном трейлинг-стопе позиция закрывается при достижении фиксированного стоп-лосса или тейк-профита.
- При включённом трейлинге:
  - Для лонга трейлинг активируется, когда цена проходит `TrailingStopPips` в прибыль. Стоп переносится на `bid − TrailingStopPips` и двигается при каждом дополнительном движении минимум на `TrailingStepPips`.
  - Для шорта используется зеркальная логика относительно цены `ask`.
- Если позиция закрыта вручную или по рынку, защитные уровни сбрасываются. Оставшаяся противоположная stop-заявка остаётся активной до завершения свечи, что имитирует поведение оригинального советника.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `Volume` | `0.01` | Объём ордеров в лотах или контрактах. |
| `StopLossPips` | `50` | Дистанция от входа до стоп-лосса в пунктах. |
| `TakeProfitPips` | `150` | Дистанция до тейк-профита (работает только без трейлинга). |
| `UseTrailing` | `false` | Включение трейлинг-стопа. |
| `TrailingStopPips` | `50` | Первоначальная дистанция трейлинга в пунктах. |
| `TrailingStepPips` | `25` | Шаг, на который должна продвинуться цена, чтобы подтянуть стоп. |
| `CandleType` | `15 минут` | Тип свечей, по которым рассчитывается диапазон. |

## Дополнительные замечания
- Размер пункта определяется автоматически на основе `Security.PriceStep`, что позволяет корректно работать с инструментами в 3 и 5 знаков.
- Все расстояния переводятся в денежные единицы инструмента перед размещением заявок, поэтому стратегию можно применять не только на валютном рынке при наличии заданного шага цены.
- Минимальный уровень стопа по умолчанию равен трём пунктам, что повторяет поведение MT5-советника при отсутствии данных от брокера.
- Поскольку заявки действуют только в течение одной свечи, важно обеспечивать непрерывный поток данных по выбранному таймфрейму.
- Перед использованием на реальном счёте рекомендуется провести тесты с реальными спредами, комиссиями и проскальзыванием.
