# Ten Pips EURUSD 策略

## 概述
**Ten Pips EURUSD** 是一套复制自 MetaTrader 专家的区间突破策略。策略记录上一根已完成 K 线的最高价与最低价，然后在区间上下各挂一组止损单，并使用点数(pip)来设定止损及止盈距离。通过 StockSharp 的高级烛图订阅与盘口数据，代码保持了原始 EA 的行为，同时可以在任意券商环境下运行。

## 交易流程
1. 订阅选定的烛图类型，等待新的蜡烛进入激活状态。
2. 当蜡烛收盘时，保存其最高价与最低价，并取消所有尚未执行的挂单——原 EA 仅允许挂单存续一个周期。
3. 在新蜡烛的第一个报价上执行以下检查：
   - 开盘价必须落在上一根蜡烛的范围内，以过滤跳空情况。
   - 当前价格距离上一根蜡烛的高点与低点至少三个点，用于模拟经纪商最小止损距离的限制。
4. 通过最新的买一/卖一报价计算当前点差。如无盘口数据，则退回到预估的点值。
5. 同时挂出两张 Stop 订单：
   - **Buy Stop** 触发价为 `上一高点 + 2 × 点差`，止损为 `StopLossPips` 点，若未启用追踪止损，则在 `TakeProfitPips` 点处设定止盈。
   - **Sell Stop** 触发价为 `上一低点 − 点差`，止损与止盈设置对称。
6. 当蜡烛收盘或挂单全部完成/取消后，进入下一周期重复上述流程。

### 持仓管理
- 持仓期间，策略在每次盘口刷新时检查最新的买价或卖价并调整保护水平。
- 若未启用追踪止损，则价格触及固定的止损或止盈后立即平仓。
- 若启用追踪止损：
  - 多头在盈利达到 `TrailingStopPips` 点后启动追踪止损，止损价被设为 `买价 − TrailingStopPips`，并在盈利额外超过 `TrailingStepPips` 点时向上移动。
  - 空头逻辑以卖价为基准镜像多头处理。
- 若通过市价或其他方式退出，所有保护参数将重置，而剩余的反向挂单会保留到蜡烛结束，以保持与原 EA 相同的“跨栏”效果。

## 参数说明
| 参数 | 默认值 | 描述 |
| --- | --- | --- |
| `Volume` | `0.01` | 委托数量，单位为手或合约。 |
| `StopLossPips` | `50` | 入场价到止损价之间的点数距离。 |
| `TakeProfitPips` | `150` | 固定止盈距离，仅在关闭追踪止损时生效。 |
| `UseTrailing` | `false` | 是否启用追踪止损。 |
| `TrailingStopPips` | `50` | 追踪止损的初始距离，单位为点。 |
| `TrailingStepPips` | `25` | 触发追踪止损更新所需的额外盈利点数。 |
| `CandleType` | `15 分钟` | 用于计算突破区间的蜡烛类型。 |

## 使用建议
- 点值根据 `Security.PriceStep` 自动推导，并复刻了 MT5 中对 3 位及 5 位报价的处理方式。
- 所有点数在下单前会换算成价格增量，因此策略同样适用于非外汇品种，只要定义了最小报价单位。
- 当经纪商未提供最小止损限制时，策略默认使用三个点作为安全缓冲，与原始 EA 保持一致。
- 请确保所选时间框架的数据流连续，因为挂单仅在单根蜡烛内有效。
- 实盘前务必在模拟环境下测试不同的点差、佣金与滑点设置，合理控制风险。
