# Waddah Attar Win Grid Strategy
[English](README.md) | [中文](README_cn.md)

**Waddah Attar Win Grid Strategy** повторяет эксперта MetaTrader 4 из файла `MQL/8210`. Стратегия постоянно поддерживает симметричную сетку из отложенных заявок buy limit и sell limit вокруг текущих цен bid/ask. Когда цена подходит к последнему уровню сетки, автоматически добавляется новая заявка на расстоянии одного шага, при желании с увеличением объёма. Плавающая прибыль контролируется при каждом обновлении стакана, и как только достигается заданный прирост капитала, все позиции и активные заявки закрываются одновременно.

## Как работает алгоритм

1. **Инициализация**
   - Подписка на обновления стакана, чтобы мгновенно реагировать на изменения bid/ask.
   - Запоминание текущей стоимости портфеля как базового уровня капитала.
   - Активация встроенной подсистемы защиты StockSharp.
2. **Управление базовым балансом**
   - Когда нет активных заявок и позиция равна нулю, последняя стоимость портфеля становится новой опорной величиной. Это повторяет подход оригинального советника, который на каждом тике сохранял баланс счёта.
3. **Первое построение сетки**
   - При разрешённой торговле и отсутствии активных заявок выставляются две отложенные заявки:
     - Buy limit на расстоянии `Step Points` ниже текущей цены ask.
     - Sell limit на расстоянии `Step Points` выше текущей цены bid.
   - Обе заявки используют объём `First Volume`.
4. **Наращивание сетки**
   - Когда цена ask подходит к последнему buy limit ближе, чем на пять минимальных шагов цены, ставится новая buy limit ещё на один шаг ниже предыдущей.
   - Когда цена bid подходит к последнему sell limit ближе, чем на пять минимальных шагов цены, ставится новая sell limit ещё на один шаг выше предыдущей.
   - Каждый новый уровень увеличивает объём на величину `Increment Volume`, что позволяет построить пирамиду ордеров.
5. **Фиксация прибыли**
   - Плавающая прибыль вычисляется как разница между текущей стоимостью портфеля и сохранённым базовым балансом.
   - После превышения `Min Profit` отменяются все активные заявки и выполняется принудительное закрытие позиций через `CloseAll`.
   - Опорный баланс обновляется, позволяя стратегии начать цикл заново.

## Особенности

- **Рыночные данные**: используется только лучший bid/ask из стакана (уровень 1).
- **Типы заявок**: формируются только лимитные ордера; рыночные входы не генерируются автоматически.
- **Позиционирование**: допускается одновременное наличие длинных и коротких позиций в хеджинговых портфелях.
- **Управление риском**: отсутствуют жёсткие стоп-лоссы; контроль ведётся через целевую плавающую прибыль и внешние ограничения.
- **Повторный вход**: после закрытия позиций или ручной отмены заявок сетка автоматически строится заново при следующем проходе цикла.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `Step Points` | `120` | Расстояние между соседними уровнями сетки в пунктах (в шагах цены инструмента). |
| `First Volume` | `0.1` | Объём первой пары отложенных заявок. |
| `Increment Volume` | `0.0` | Увеличение объёма для каждого нового уровня; оставьте 0, чтобы объёмы были одинаковыми. |
| `Min Profit` | `450` | Плавающая прибыль (в валюте счёта), при достижении которой стратегия закрывает все позиции и заявки. |

## Замечания и ограничения

- Убедитесь, что `PriceStep` инструмента настроен корректно: фактические цены вычисляются как произведение `Step Points` на шаг цены.
- Частые отмены и перерегистрации заявок могут столкнуться с ограничениями брокера или биржи по количеству отложенных ордеров.
- Алгоритм не защищён от глубокой просадки — рекомендуется подключать внешнее управление рисками.
- При сильном тренде сетка может расширяться без остановки; выбирайте `Increment Volume` с учётом доступной маржи.

## Файлы

- `CS/WaddahAttarWinGridStrategy.cs` — реализация стратегии на C#.
- `README.md` — документация на английском языке.
- `README_ru.md` — данный файл с описанием на русском языке.
- `README_cn.md` — перевод описания на китайский язык.
