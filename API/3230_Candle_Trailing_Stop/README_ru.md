# Стратегия Candle Trailing Stop

**Candle Trailing Stop** — это порт оригинального эксперта MetaTrader на платформу StockSharp. Алгоритм сочетает многофреймовый
анализ тренда, фильтр по моментуму и агрессивный трейлинг стопов по экстремумам свечей. Перенос выполнен на высокоуровневом API
S# и сохраняет основную логику советника, предоставляя все ключевые параметры через свойства стратегии.

## Основная логика

1. **Подписки на данные**: рабочий таймфрейм используется для сигналов и трейлинга, более старший — для фильтрации L W M A и
   моментума, а третий поток строит MACD на медленном таймфрейме (по умолчанию месяц).
2. **Согласование тренда**: сделки открываются только при строгом порядке быстрой, средней и медленной LWMA на обоих таймфреймах
   (восходящем для покупок и нисходящем для продаж).
3. **Фильтр моментума**: хотя бы одно из трёх последних значений моментума на старшем таймфрейме должно быть близко к 100.
4. **Подтверждение MACD**: покупки разрешены при `MACD > Signal`, продажи — при обратном условии.
5. **Триггер входа**: цена должна коснуться быстрой LWMA на предыдущей свече и закрыться по другую сторону средней на текущей
   свече, при этом учитывается ограничение по суммарной позиции.
6. **Управление рисками**: стоп-лосс и тейк-профит задаются в пунктах, есть переход в безубыток, трейлинг по свечам или по
   фиксированному шагу, а также денежные цели и защита капитала.

## Параметры

Подробные описания параметров полностью совпадают с английской версией README и доступны в таблице выше. Все значения по умолчанию
повторяют настройки эксперта MetaTrader: лоты, периоды LWMA, моментума, MACD, уровни безубытка и трейлинга, а также денежные и
процентные лимиты.

## Допущения и отличия

- Перевод «пункты → шаг цены» выполняется через размер тика инструмента. Если один пункт не равен одному тіку, скорректируйте
  параметры `StopLossPips`, `TakeProfitPips` и другие дистанции.
- Денежные фильтры работают с приближённым нереализованным PnL: `(Close - средняя цена входа) * позиция`. Свопы и комиссии не
  учитываются.
- Стопы фиксируются рыночными заявками при достижении расчётного уровня; лимитные тейк-профиты регистрируются при входе.
- Все комментарии в коде оставлены на английском языке, как требует руководство проекта.
