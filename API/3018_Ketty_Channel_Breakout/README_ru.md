# Стратегия Ketty Channel Breakout

## Обзор
Ketty Channel Breakout — это прямая конвертация эксперта Ketty.mq5 в C#. Стратегия строит краткосрочный ценовой канал в заданное время перед началом торгов и ожидает резкого выхода цены за его пределы. После такого импульса выставляется стоп-заявка на противоположной стороне канала. Дополнительно создаются защитные стоп-лосс и тейк-профит ордера, что полностью повторяет механику отложенных заявок оригинального советника.

## Логика работы
1. **Ежедневный сброс**. На первой свече каждого торгового дня стратегия удаляет активные отложенные заявки (а при отсутствии позиции — и защитные ордера) и обнуляет статистику по каналу.
2. **Построение канала**. В промежутке между `ChannelStartHour:ChannelStartMinute` и `ChannelEndHour:ChannelEndMinute` вычисляются максимальные и минимальные значения выбранного таймфрейма `CandleType`. Полученный диапазон используется как канал пробоя до конца текущего дня.
3. **Цены заявок**. Планируемый buy stop равен `channelHigh + OrderPriceShiftPips`, а sell stop — `channelLow - OrderPriceShiftPips`. Пересчёт пипсов в цену совпадает с алгоритмом из MQL5: если у инструмента 3 или 5 знаков после запятой, один pip соответствует десяти ценовым шагам, иначе используется один шаг.
4. **Обнаружение сигнала**. Как только канал сформирован и текущее время попадает в диапазон `PlacingStartHour`–`PlacingEndHour`, анализируется последняя завершённая свеча. Сигнал на покупку появляется, если минимум свечи пробил канал вниз не менее чем на `ChannelBreakthroughPips`. Сигнал на продажу возникает, когда максимум свечи превысил верхнюю границу на ту же величину.
5. **Управление отложенными ордерами**. Одновременно активна только одна заявка. При появлении нового сигнала предыдущая заявка отменяется и регистрируется новая. После наступления `PlacingEndHour` все отложенные ордера автоматически снимаются.
6. **Защитные ордера**. После исполнения отложенной заявки стратегия немедленно отправляет соответствующий стоп-лосс (если `StopLossPips` больше нуля) и тейк-профит (если `TakeProfitPips` больше нуля). Эти ордера удаляются при полном закрытии позиции.

## Параметры
- `EntryVolume` — базовый объём заявок.
- `StopLossPips` — расстояние от цены входа до стоп-лосса; ноль отключает защиту.
- `TakeProfitPips` — расстояние от цены входа до тейк-профита; ноль отключает защиту.
- `ChannelStartHour` / `ChannelStartMinute` — начало периода расчёта канала.
- `ChannelEndHour` / `ChannelEndMinute` — окончание периода расчёта канала. Реализация корректно обрабатывает переход через полночь.
- `PlacingStartHour` — час, с которого допускается размещение отложенных заявок.
- `PlacingEndHour` — час, после которого все отложенные заявки снимаются.
- `ChannelBreakthroughPips` — буфер пробоя, который должна преодолеть последняя свеча перед постановкой заявки.
- `OrderPriceShiftPips` — дополнительный сдвиг цены при размещении стоп-ордера.
- `VisualizeChannel` — при включении на графике отображаются две горизонтальные линии канала.
- `CandleType` — таймфрейм, используемый для расчёта и мониторинга канала.

## Дополнительные замечания
- Стратегия рассчитана на непрерывный поток данных. При отсутствии свечей внутри временного окна канал будет достраиваться по мере появления новых данных.
- Защитные приказы регистрируются отдельными стоп/лимит ордерами уже после входа в позицию, потому что в StockSharp нельзя прикрепить SL/TP к отложенной заявке так же, как в MetaTrader.
- Значение `EntryVolume` должно соответствовать шагу лота у брокера. Рекомендуется выбирать насыщенный таймфрейм — исходная версия использовала минутные свечи.
