# Стратегия Global Stop Timer
[English](README.md) | [中文](README_cn.md)

Global Stop Timer — это конвертация советника MetaTrader `Exp_GStop_Tm`, выполняющая роль защитного модуля.
Она отслеживает стоимость портфеля на закрытии каждой свечи и прекращает торговлю, когда достигается глобальная
прибыль или допускается максимальная просадка. Дополнительно стратегия способна ограничивать торговлю указанным
временем сессии и принудительно закрывать позицию при выходе за его пределы.

## Логика работы

- При запуске стратегия запоминает текущее значение портфеля и использует его как базовую точку.
- После закрытия каждой подписанной свечи вычисляется разница между текущей стоимостью портфеля и исходным значением.
- В зависимости от режима `StopCalculationMode` эта разница переводится в проценты или используется как абсолютная
  величина в валюте счёта.
- Если убыток превысил `StopLoss`, либо прибыль превысила `TakeProfit`, стратегия помечает себя как остановленную,
  выводит сообщение и отправляет рыночные заявки для закрытия оставшейся позиции.
- При включённом торговом окне стратегия также закрывает позицию, если текущее время выходит за пределы окна.
  После того как позиция становится нулевой, флаг останова сбрасывается и торговля может возобновиться при следующем
  входе во временное окно.

Стратегия не генерирует торговых сигналов. Её назначение — сопровождать другие стратегии или ручные сделки, защищая
портфель от чрезмерных потерь и фиксируя совокупную прибыль.

## Логика торгового окна

Временной фильтр повторяет оригинальный алгоритм:

- Если час начала меньше часа окончания, торговля разрешена от минуты начала (включительно) до минуты окончания
  (не включительно) в тот же день.
- Если час начала и час окончания равны, торговля возможна только когда текущая минута находится в диапазоне
  `StartMinute` (включительно) — `EndMinute` (не включительно).
- Если час начала больше часа окончания, окно переходит через полночь: торговля включена от времени старта до
  полуночи, а затем продолжается с полуночи до времени окончания следующего дня.

## Параметры

- `StopCalculationMode` — выбор между процентным и валютным глобальным стопом.
- `StopLoss` — максимальный допустимый убыток. В режиме процентов трактуется как значение в процентах, иначе как сумма
  в валюте счёта.
- `TakeProfit` — целевая прибыль, измеряется в тех же единицах, что и `StopLoss`.
- `UseTradingWindow` — включает или выключает временной фильтр.
- `StartHour` / `StartMinute` — время начала разрешённой торговой сессии.
- `EndHour` / `EndMinute` — время завершения торговой сессии.
- `CandleType` — тип свечей, определяющий частоту проверки состояния счёта.

## Особенности

- Для быстрого реагирования стоит выбирать небольшой таймфрейм, например одну минуту, чтобы проверка условий
  выполнялась чаще.
- Стратегия закрывает только позицию, управляемую этим экземпляром. Для контроля нескольких инструментов запустите
  отдельные экземпляры.
- Модуль можно использовать совместно с другими стратегиями, подключая его как родительскую стратегию либо запуская
  на том же инструменте для обеспечения глобальной защиты.
