# Стратегия Exp TEMA

**Exp TEMA** — это порт на StockSharp экспертного советника MetaTrader `Exp_TEMA.mq5`. Оригинальная система анализирует несколько валютных пар и отслеживает знак наклона Triple Exponential Moving Average (TEMA). При смене знака наклона советник либо открывает позицию по направлению нового тренда, либо закрывает противоположную. В C# версии сохранена логика индикатора, но торговля выполняется по одному инструменту, который назначается стратегии в StockSharp.

## Логика торговли

Стратегия работает с завершёнными свечами, полученными от выбранного параметра `CandleType`. На закрытии каждой свечи рассчитывается TEMA с периодом `TemaPeriod`. Для воспроизведения схемы определения наклона из MQL5 сравниваются три подряд идущих значения индикатора:

1. `tema[0]` — значение на текущей свече, `tema[1]` — на предыдущей, `tema[2]` — два бара назад.
2. Краткосрочный наклон — `d1 = tema[1] - tema[2]`, более старый наклон — `d2 = tema[2] - tema[3]`.
3. **Покупка** срабатывает, когда наклон разворачивается вверх (`d2 < 0` и `d1 > 0`). Перед входом закрываются короткие позиции, затем отправляется рыночная заявка объёмом `Volume + |Position|`.
4. **Продажа** выполняется при развороте наклона вниз (`d2 > 0` и `d1 < 0`). Сначала закрываются длинные позиции, после чего выставляется рыночная продажа объёмом `Volume + |Position|`.
5. Защитные выходы повторяют оригинальные флаги остановки: отрицательный `d1` закрывает лонг, положительный `d1` закрывает шорт.

Такое построение позволяет сохранить момент генерации сигналов, не обращаясь напрямую к историческим буферам и соблюдая требования к использованию высокоуровневого API StockSharp.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `TemaPeriod` | 15 | Период Triple Exponential Moving Average. |
| `TradeVolume` | 1 | Базовый торговый объём. При реверсе фактический объём равен `TradeVolume + |Position|`. |
| `StopLossPoints` | 1000 | Дистанция стоп-лосса в шагах цены. Передаётся в `StartProtection`, если значение положительное. |
| `TakeProfitPoints` | 2000 | Дистанция тейк-профита в шагах цены. Передаётся в `StartProtection`, если значение положительное. |
| `CandleType` | 15-минутные свечи | Тип свечей для расчёта индикатора. Выберите таймфрейм, соответствующий графику из MetaTrader. |

Все параметры созданы через `StrategyParam<T>`, поэтому их можно оптимизировать в Designer.

## Отличия от MQL5-версии

- В MT5 советник обрабатывает до двенадцати символов одновременно. В StockSharp стратегия привязана к конкретному `Security`, поэтому порт работает с одним инструментом. Для мультивалютной торговли запустите несколько экземпляров стратегии.
- Управление ордерами реализовано через `BuyMarket`/`SellMarket` и `StartProtection`, что соответствует рыночным заявкам, стопам и тейк-профитам оригинала, но в терминах высокоуровневого API.
- Индикатор подключается через `SubscribeCandles().Bind(...)`, без ручного копирования буферов, что соответствует внутренним рекомендациям репозитория.

## Рекомендации по использованию

1. Назначьте стратегии нужный инструмент и установите `CandleType`, совпадающий с рабочим таймфреймом.
2. Подберите расстояния `StopLossPoints` и `TakeProfitPoints` исходя из волатильности инструмента.
3. При необходимости используйте оптимизацию параметров `TemaPeriod`, `StopLossPoints` и `TakeProfitPoints`, чтобы повторить подбор настроек из MetaTrader.
4. Контролируйте работу стратегии через встроенную область графика с ценой, индикатором TEMA и отмеченными сделками.
