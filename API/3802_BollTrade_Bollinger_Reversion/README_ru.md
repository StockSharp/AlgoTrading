# Стратегия BollTrade Bollinger Reversion

## Обзор

**BollTrade Bollinger Reversion Strategy** — это конвертация оригинального эксперта BollTrade из MetaTrader в высокоуровневую стратегию StockSharp. Стратегия торгует одним инструментом по сигналам индикатора полос Боллинджера и ожидает, когда цена выйдет за границы полосы на величину дополнительного буфера в пунктах. Если свеча закрывается выше верхней полосы, стратегия открывает короткую позицию, а если закрывается ниже нижней полосы — длинную позицию. Расчёты выполняются только по завершённым свечам, чтобы избежать реакции на незавершённые данные.

## Логика торговли

1. Подписаться на выбранный тип свечей и рассчитать Bollinger Bands с заданным периодом и отклонением.
2. Вычислить дополнительное смещение в пунктах, чтобы повторить буфер, использовавшийся в оригинальном советнике.
3. При закрытии свечи ниже нижней полосы минус смещение открыть длинную позицию. При закрытии выше верхней полосы плюс смещение открыть короткую позицию.
4. Для каждой позиции сохранить уровни стоп-лосса и тейк-профита, заданные в пунктах. Это имитирует закрытие сделок при достижении заданной прибыли или убытка в версии MetaTrader.
5. Закрывать позицию, если диапазон свечи пересекает уровни стоп-лосса или тейк-профита. Дополнительного наращивания позиции не выполняется.

## Управление капиталом

* Параметр `Lots` задаёт базовый объём сделки.
* При включенном `LotIncrease` объём увеличивается пропорционально росту стоимости портфеля относительно значения на момент запуска стратегии, но не более 500 лотов. Это повторяет логику масштабирования из MetaTrader.

## Параметры

| Параметр | Описание |
|----------|----------|
| **Take Profit (pips)** | Расстояние в пунктах для расчёта тейк-профита от цены входа. Ноль отключает тейк-профит. |
| **Stop Loss (pips)** | Расстояние в пунктах для расчёта стоп-лосса от цены входа. Ноль отключает стоп-лосс. |
| **Band Offset** | Дополнительное расстояние в пунктах сверх полос Боллинджера перед открытием сделки. |
| **Bollinger Period** | Количество свечей в расчёте среднего Bollinger Bands. |
| **Bollinger Deviation** | Множитель стандартного отклонения для ширины полос. |
| **Base Volume** | Базовый торговый объём в лотах. |
| **Scale Volume** | При включении увеличивает объём заявок при росте стоимости портфеля. |
| **Candle Type** | Тип свечей (таймфрейм), по которым формируются сигналы. |

## Примечания

* Стратегия работает только по завершённым свечам, поэтому ей необходима историческая подкачка данных для прогрева.
* Проверка стоп-лоссов и тейк-профитов выполняется по диапазону свечей, что приблизительно повторяет тиковую логику оригинала при использовании высокоуровневого API.
* Защитный механизм `StartProtection` активирован для предотвращения нежелательных позиций при остановке стратегии.
