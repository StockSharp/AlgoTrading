# Стратегия Avalanche AV
[English](README.md) | [中文](README_cn.md)

Avalanche AV — это рандомизированная мартингейловая стратегия. После заданного количества завершённых свечей она с равной вероятностью открывает длинную или короткую позицию. Каждая сделка получает фиксированные уровни стоп-лосса и тейк-профита в пунктах. Если сделка закрылась с убытком, объём следующей увеличивается в соответствии с коэффициентом мартингейла; прибыльные сделки возвращают объём к исходному значению, как только баланс достигает нового максимума. Дополнительно стратегия контролирует максимальную просадку по открытой позиции и принудительно закрывает её при превышении порога.

Исходник на MQL работал по тикам. Перенос на StockSharp сохраняет ту же вероятностную модель, но использует завершённые свечи, что облегчает тестирование и реалтрейд на баровых данных.

## Правила торговли

- **Интервал решений.** Стратегия ждёт указанное число завершённых свечей, прежде чем рассматривать новую сделку. Если позиция уже открыта, счётчик продолжает идти, но новый вход не выполняется.
- **Направление входа.** Генерируется случайное число; значение выше 16384 инициирует покупку, иначе выполняется продажа. Сделка открывается только при отсутствии активной позиции.
- **Размер позиции.** Стартовый объём задаётся параметром `InitialVolume`. После каждого убыточного закрытия объём умножается на `MartingaleMultiplier` и приводится к допустимому шагу объёма. Прибыльные сделки сбрасывают объём к начальному уровню, если текущий баланс превысил предыдущий максимум, иначе рост объёма продолжается.
- **Стоп и тейк.** Уровни рассчитываются в пунктах от цены входа. Один пункт равен шагу цены инструмента.
- **Просадка по счёту.** Пока позиция открыта, стратегия отслеживает нереализованный результат. Если убыток превышает `MaxDrawdownPercent` от баланса (начальный баланс + реализованная прибыль/убыток), позиция закрывается.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `InitialVolume` | 0.1 | Стартовый объём сделки. |
| `StopLossPips` | 15 | Расстояние стоп-лосса в пунктах (0 — без стопа). |
| `TakeProfitPips` | 30 | Расстояние тейк-профита в пунктах (0 — без тейка). |
| `MaxDrawdownPercent` | 75 | Максимальная допустимая плавающая просадка в процентах. |
| `MartingaleMultiplier` | 1.6 | Множитель объёма после убытка. |
| `DecisionInterval` | 9 | Количество завершённых свечей между решениями. |
| `CandleType` | Таймфрейм 1 минута | Тип свечей для расчётов. |

## Примечания

- Объём автоматически нормализуется по `VolumeStep`, `MinVolume` и `MaxVolume` инструмента. Если привести объём к допустимому значению не удаётся, он сбрасывается на стартовый.
- Стоп и тейк рассчитываются через `PriceStep`, поэтому для экзотических инструментов нужно проверить шаг цены.
- Контроль просадки требует наличия `PriceStep` и `StepPrice`; при отсутствии этих данных защита отключается.
- Из-за использования генератора случайных чисел результаты могут отличаться от запуска к запуску при одинаковых данных.
