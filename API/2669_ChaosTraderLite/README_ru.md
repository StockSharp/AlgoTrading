# Стратегия Chaos Trader Lite

Стратегия Chaos Trader Lite воспроизводит три техники входа Билла Уильямса («три мудреца») с использованием высокоуровневого API StockSharp. На каждой завершённой свече выбранного таймфрейма (по умолчанию 1 час) выполняются проверки и выставляются отложенные ордера при выполнении любого из условий:

1. **Первый мудрец — дивергентный бар**: определяет бычьи или медвежьи дивергентные свечи и требует минимальный зазор между ценой и линией губ Alligator.
2. **Второй мудрец — ускорение Awesome Oscillator**: ожидает пять последовательных значений индикатора, подтверждающих нарастание импульса.
3. **Третий мудрец — пробой фрактала**: подтверждает фрактал двумя барами ранее и проверяет, что цена находится достаточно далеко от линии зубов Alligator, прежде чем подготовить ордер на пробой.

При появлении сигнала на покупку стратегия отменяет активные sell stop, закрывает короткие позиции, ставит новый buy stop чуть выше максимума свечи и фиксирует защитный стоп ниже минимума. Для продаж выполняется зеркальная последовательность. Защитные уровни проверяются на каждой свече: при пересечении цены открытая позиция закрывается рыночным ордером.

## Индикаторы и расчёты

- **Губы Alligator**: сглаженная средняя (SMMA) длиной 5 по медианной цене со смещением на три бара вперёд. Значения сохраняются в очереди, чтобы смещение совпадало с реализацией MetaTrader.
- **Зубы Alligator**: сглаженная средняя длиной 8 по медиане со смещением на пять баров вперёд; используется как фильтр третьего мудреца.
- **Awesome Oscillator**: встроенный индикатор (разница SMA 5 и SMA 34 от медианы) формирует последовательность импульса для второго мудреца.
- **Фракталы**: анализируется свеча, находящаяся на две позиции левее текущей. Фрактал подтверждается, если её максимум (минимум) выше (ниже) максимумов и минимумов двух соседних баров.

## Торговая логика

1. Подписка на заданный тип свечей и обработка только завершённых баров.
2. Обновление индикаторов Alligator и Awesome Oscillator и сохранение смещённых значений.
3. Проверка условий мудрецов:
   - Дивергентный бар должен закрыться в верхней (для покупок) или нижней (для продаж) половине свечи, а расстояние до губ превышать `MagnitudePips * PriceStep`.
   - Ускорение AO требует пяти значений: `AO[1] > AO[2] > AO[3] > AO[4]` и `AO[4] < AO[5]` для лонга и зеркально для шорта.
   - Пробой фрактала требует закрытия выше (ниже) подтверждённого фрактала и выше (ниже) зубов Alligator плюс пороговое расстояние.
4. При выполнении условия регистрируется `BuyStop` или `SellStop` объёмом `Volume` на уровне максимума свечи плюс один шаг цены (или минимума минус шаг). Противоположные стопы отменяются, противоположные позиции закрываются.
5. Обновляются защитные стопы: для длинных они подтягиваются вверх, для коротких опускаются вниз. При пробое уровня позиция закрывается по рынку.

## Параметры

- `MagnitudePips` *(по умолчанию 10)* — минимальное расстояние в пунктах между дивергентной свечой и губами Alligator.
- `UseFirstWiseMan` *(по умолчанию true)* — включение/отключение входа по дивергентным барам.
- `UseSecondWiseMan` *(по умолчанию true)* — включение/отключение входа по ускорению Awesome Oscillator.
- `UseThirdWiseMan` *(по умолчанию true)* — включение/отключение входа по пробою фрактала.
- `Volume` *(по умолчанию 0.01)* — объём стоп-ордеров.
- `CandleType` *(по умолчанию 1 час)* — тип свечей, обрабатываемых стратегией.

## Примечания

- Проверки bid/ask из оригинального MQL4 заменены использованием цены закрытия свечи.
- Контроль маржи и валидаторы объёма из MetaTrader опущены, поскольку в StockSharp проверка заявок выполняется на стороне движка.
- Отложенные ордера противоположного направления отменяются при появлении нового сигнала, что соответствует поведению функции `CloseAll` в исходном советнике.
