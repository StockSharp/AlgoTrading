
# Стратегия MACD + Stochastic с трейлинг-стопом

## Обзор
- Конвертирована из эксперта MetaTrader 4 `MQL/7637/3_lccfpgubwykd__www_forex-instruments_info.mq4`.
- Использует **три таймфрейма**: часовые свечи обновляют обе линии MACD, 15-минутные свечи питают два стохастика, а минутные свечи подтверждают пробои и сопровождают трейлинг-стоп.
- Построена на высокоуровневом API StockSharp (`SubscribeCandles(...).Bind(...)` / `BindEx(...)`) без ручного перебора данных.
- Сделки открываются рыночными ордерами, управление позицией полностью реализовано внутри стратегии, тестовая инфраструктура не изменялась.

## Индикаторы и параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --------------------- | -------- |
| `LongStopLoss` | `decimal` | `17` | Дистанция первичного стоп-лосса для покупок в пунктах инструмента. |
| `ShortStopLoss` | `decimal` | `40` | Первичный стоп-лосс для продаж (в пунктах). |
| `LongTrailingStop` | `decimal` | `88` | Размер трейлинг-стопа для длинных позиций. |
| `ShortTrailingStop` | `decimal` | `76` | Размер трейлинг-стопа для коротких позиций. |
| `OrderVolume` | `decimal` | `0.1` | Базовый объём сделки (лоты), перенесённый из параметра `Lots`. |
| `MacdCandleType` | `DataType` | `H1` | Таймфрейм для MACD (наборы `22/27/9` и `19/77/9`). |
| `StochasticCandleType` | `DataType` | `M15` | Таймфрейм для стохастиков (`5/3/11` и `9/3/19`). |
| `EntryCandleType` | `DataType` | `M1` | Таймфрейм, который подтверждает пробои и управляет выходами. |

Все точечные параметры умножаются на `PriceStep` инструмента, что соответствует использованию `Point` в MetaTrader.

## Торговые правила
### Покупка
1. MACD(22,27,9) на H1 растёт относительно предыдущего значения и остаётся ниже нуля.
2. Стохастик M15 (%K=5,%D=3,slowing=11) ниже 26 и растёт относительно предыдущей точки.
3. Закрытие текущей минутной свечи выше максимума предыдущей минутной свечи.
4. При выполнении условий и отсутствии позиции открывается покупка объёмом `OrderVolume`, при необходимости закрывая обратный шорт.

### Продажа
1. MACD(19,77,9) на H1 снижается относительно предыдущей точки, при этом предыдущее значение выше нуля.
2. Стохастик M15 (%K=9,%D=3,slowing=19) превышает 70.
3. Закрытие текущей минутной свечи ниже минимума предыдущей минутной свечи.
4. Открывается короткая позиция с тем же механизмом реверса, что и в оригинальном советнике.

### Выходы и трейлинг
- Первичные стопы совпадают с параметрами MQL по пунктам.
- Трейлинг активируется после прохождения цены на заданную дистанцию в прибыльную сторону и пересчитывается на каждой завершённой минутной свече.
- При касании текущего стоп-уровня позиция закрывается рыночным ордером.

## Особенности реализации
- Раздельные подписки по таймфреймам сохраняют последовательность обновления индикаторов, полностью повторяя многофреймовую логику советника.
- Сравнение `Bid/Ask` из MQL аппроксимировано максимумами и минимумами минутных свечей — это максимально близкая модель в рамках свечного API.
- Стратегия следует правилам репозитория: табуляция, пространство имён `StockSharp.Samples.Strategies`, комментарии на английском и объявление параметров через `Param(...)` в конструкторе.
