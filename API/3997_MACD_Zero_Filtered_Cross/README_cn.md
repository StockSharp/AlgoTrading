# MACD 零轴过滤交叉策略

## 概览
MACD 零轴过滤交叉策略是 MetaTrader4 智能交易系统 `Robot_MACD_12.26.9` 的 C# 版本移植。原始 EA 监控 MACD 主线与信号线的交叉，并要求做多信号只在两条线都位于零轴下方时触发、做空信号只在两条线都位于零轴上方时触发。StockSharp 版本完整保留该核心思想，并结合框架提供的统一风控功能：可配置的账户余额过滤、点差单位的止盈管理以及支持优化的参数系统。

策略基于可配置周期的收盘 K 线工作。通过高层 API 的 `BindEx` 机制直接接收 `MovingAverageConvergenceDivergenceSignal` 指标输出，避免手动调用 `GetValue`，完全符合仓库的代码规范。

## 策略逻辑
### 指标计算
* **MACD 主线** – 默认使用 12 与 26 周期指数均线之差。
* **信号线** – 对 MACD 主线再做一次 9 周期指数平滑。
* **零轴过滤** – 判断两条线相对零轴的位置，用于筛选哪些交叉可以产生交易。

### 入场规则
* **做多**
  * `MACD[t-1] < Signal[t-1]` 且 `MACD[t] > Signal[t]`，表示 MACD 向上穿越信号线。
  * 穿越后 MACD 与信号线都在零轴下方。
  * 当前净仓位必须为零或为空头；若存在空头，会先平仓再等待下一次机会。
  * 可选的余额过滤器要求组合价值高于 `MinimumBalancePerVolume * LotVolume`。
* **做空**
  * `MACD[t-1] > Signal[t-1]` 且 `MACD[t] < Signal[t]`，表示 MACD 向下穿越信号线。
  * 穿越后两条线都在零轴上方。
  * 当前净仓位必须为零或多头；若持有多头会先平仓。
  * 余额过滤器同样适用于空头信号。

### 出场规则
* **反向交叉离场** – 一旦 MACD 线向持仓反方向穿越信号线，立即以市价平仓，完全对应原 EA 的离场逻辑。
* **固定止盈** – 通过 `StartProtection` 设置以“点”为单位的止盈值，对应 MT4 参数 `TakeProfit`。

### 风险管理
* **交易量** – `LotVolume` 参数等价于 MT4 的手数设置，每次下单使用相同的数量。
* **余额过滤** – `MinimumBalancePerVolume` 与交易量相乘得到所需的最低账户价值。如果组合价值不足，策略会写日志并跳过该次交易。
* **数据完整性** – 仅处理已完成的 K 线，并确保 `IsFormedAndOnlineAndAllowTrading()` 返回真值后才执行逻辑。

## 参数说明
| 参数 | 描述 |
|------|------|
| `FastPeriod` | MACD 快速 EMA 的周期。 |
| `SlowPeriod` | MACD 慢速 EMA 的周期。 |
| `SignalPeriod` | MACD 信号线的平滑周期。 |
| `TakeProfitPoints` | 以点为单位的止盈距离，设置为 `0` 表示关闭止盈。 |
| `LotVolume` | 下单手数，与 MT4 版本保持一致。 |
| `MinimumBalancePerVolume` | 每单位交易量所需的最低账户价值，设置为 `0` 可关闭过滤器。 |
| `CandleType` | 用于计算指标的 K 线周期。 |

## 其他说明
* 策略全部注释均为英文，符合仓库要求。
* 仅提供 C# 实现，本目录没有 Python 版本。
* 若要复现 MT4 上的表现，请选择与原图表一致的时间周期，并保持相同的手数设置。
