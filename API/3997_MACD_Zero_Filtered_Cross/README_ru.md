# MACD с фильтром по нулевой линии

## Обзор
Стратегия «MACD с фильтром по нулевой линии» представляет собой порт MetaTrader 4-советника `Robot_MACD_12.26.9`. Исходный робот
отслеживает пересечения линии MACD и сигнальной линии, но разрешает открывать длинные позиции только тогда, когда обе линии
остаются ниже нуля, а короткие позиции — только при нахождении обеих линий выше нуля. Реализация на StockSharp сохраняет эти
фильтры, добавляет встроенную систему управления риском (контроль баланса портфеля и фиксированный тейк-профит в пунктах) и
вынесена в параметры, пригодные для оптимизации.

Стратегия работает с завершёнными свечами выбранного таймфрейма. Индикатор `MovingAverageConvergenceDivergenceSignal` подключается
через `BindEx`, что позволяет получить значения MACD и сигнальной линии в одном колбэке без ручного обращения к `GetValue`.

## Логика стратегии
### Расчёт индикаторов
* **Линия MACD** — разница между быстрой и медленной EMA (по умолчанию 12 и 26 периодов).
* **Сигнальная линия** — EMA от MACD (по умолчанию 9 периодов).
* **Фильтр по нулю** — проверяет знак обоих значений и решает, допускается ли вход по текущему пересечению.

### Правила входа
* **Покупка**
  * MACD пересекает сигнал снизу вверх (`MACD[t-1] < Signal[t-1]`, `MACD[t] > Signal[t]`).
  * После пересечения обе линии остаются ниже нуля.
  * Текущая позиция должна быть пустой или короткой; при наличии шорта он закрывается и только затем допускается новый вход.
  * Дополнительно проверяется баланс портфеля: `CurrentValue` должен быть не меньше `MinimumBalancePerVolume * LotVolume`.
* **Продажа**
  * MACD пересекает сигнал сверху вниз (`MACD[t-1] > Signal[t-1]`, `MACD[t] < Signal[t]`).
  * Обе линии выше нулевой отметки.
  * Позиция должна быть пустой или длинной; лонги закрываются до отправки новой продажи.
  * Балансовый фильтр действует симметрично.

### Правила выхода
* **Пересечение в противоположную сторону** — закрывает текущую позицию рыночной заявкой, полностью повторяя поведение оригинала.
* **Фиксированный тейк-профит** — задаётся в пунктах и запускается через `StartProtection`, аналог параметра `TakeProfit` в МТ4.

### Управление риском
* **Объём сделки** — `LotVolume` соответствует параметру `Lots` в МТ4 и используется для каждой заявки.
* **Фильтр баланса** — `MinimumBalancePerVolume` задаёт минимальное значение портфеля на единицу объёма. При недостатке средств
стратегия выводит диагностическое сообщение и пропускает сигнал.
* **Контроль данных** — обработка ведётся только по закрытым свечам и после того, как `IsFormedAndOnlineAndAllowTrading()`
подтверждает готовность соединения и индикаторов.

## Параметры
| Параметр | Описание |
|----------|----------|
| `FastPeriod` | Период быстрой EMA в расчёте MACD. |
| `SlowPeriod` | Период медленной EMA в расчёте MACD. |
| `SignalPeriod` | Период сглаживания сигнальной линии. |
| `TakeProfitPoints` | Расстояние до тейк-профита в пунктах (0 — отключить). |
| `LotVolume` | Объём заявки, эквивалентный лотам в MT4. |
| `MinimumBalancePerVolume` | Требуемый баланс портфеля на единицу объёма (0 — фильтр отключён). |
| `CandleType` | Таймфрейм свечей, используемых для расчётов. |

## Дополнительно
* Все комментарии в исходном коде написаны на английском языке согласно общим требованиям.
* Python-версии стратегии не существует, реализована только C#-модификация.
* Для максимального сходства с MT4 рекомендуется выбрать тот же таймфрейм и объём, что использовались в исходном советнике.
