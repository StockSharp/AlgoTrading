# Стратегия Moving Average Money

## Обзор
Данная реализация представляет собой конвертацию советника MetaTrader «Moving Average Money» под инфраструктуру StockSharp. Стратегия анализирует только полностью сформированные свечи и реагирует на пересечение смещённой простой скользящей средней предыдущим баром. Поддерживаются длинные и короткие позиции, обработка сигналов построена на высокоуровневых подписках на свечи.

## Логика торговли
- Рассчитывается простая скользящая средняя по ценам закрытия с настраиваемым периодом и горизонтальным смещением.
- В работу принимаются только завершённые свечи, что исключает повторные сделки внутри одного бара.
- **Сигнал на продажу:** предыдущая свеча открылась выше смещённой средней и закрылась ниже неё.
- **Сигнал на покупку:** предыдущая свеча открылась ниже средней и закрылась выше неё.
- Стратегия не наращивает позицию; при появлении обратного сигнала активная позиция закрывается и только затем открывается новая.

## Управление рисками
- Расстояние до стоп-лосса вычисляется на основе параметра `MaximumRiskPercent`, текущей стоимости портфеля, шага цены и стоимости шага.
- Если доступны лучшие котировки, из расчётного расстояния вычитается текущий спред.
- Уровень тейк-профита равен произведению стоп-дистанции на коэффициент `ProfitLossFactor`.
- Исполнение стопов и тейков контролируется по закрытию свечей; при достижении любого уровня позиция закрывается рыночным ордером.

## Параметры
- `CandleType` – тип и таймфрейм обрабатываемых свечей.
- `MovingPeriod` – период простой скользящей средней.
- `MovingShift` – количество полностью сформированных свечей, на которое линия средней смещается вправо.
- `MaximumRiskPercent` – доля стоимости портфеля, которую допускается потерять в одной сделке.
- `ProfitLossFactor` – множитель для расчёта тейк-профита относительно стоп-лосса.
- `TradeVolume` – базовый объём рыночных заявок (учитывается шаг объёма инструмента).

## Особенности реализации
- Позиция отслеживается в обработчике `OnOwnTradeReceived`, что позволяет заново выставлять уровни защиты после исполнения сделок.
- При отсутствии портфельной оценки или котировок стратегия не открывает новые позиции, чтобы не нарушать риск-модель.
- Смещение скользящей средней моделируется внутренним буфером, обеспечивая поведение, идентичное версии для MetaTrader.
