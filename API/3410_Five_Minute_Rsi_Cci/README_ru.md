# Стратегия FiveMinuteRsiCci

`FiveMinuteRsiCciStrategy` — порт советника MetaTrader 4 **5Mins Rsi Cci EA.mq4** на платформу StockSharp. Оригинальный алгоритм торгует пятиминутные свечи, комбинируя пробой уровней RSI с фильтром из сглаженной/экспоненциальной средних по цене открытия и полярностью двух индикаторов CCI. Перенос сохраняет торговые правила и использует высокоуровневый API StockSharp для подписки на данные, расчёта индикаторов и управления рисками.

## Логика торговли

1. Подписка на выбранный таймфрейм (по умолчанию 5 минут) и одновременный пересчёт пяти индикаторов: RSI, сглаженной MA по цене открытия, EMA по цене открытия, а также быстрого и медленного CCI от типичной цены.
2. Анализируется только закрытая свеча, когда нет открытой позиции и текущий спред меньше `MaxSpreadPoints` (значение переводится в денежные единицы).
3. Сигнал на покупку формируется при выполнении условий:
   - сглаженная MA находится выше EMA;
   - RSI между предыдущей и текущей свечой пересекает уровень `BullishRsiLevel` снизу вверх;
   - оба значения CCI положительные.
4. Сигнал на продажу требует обратных условий (MA ниже EMA, RSI пробивает `BearishRsiLevel` сверху вниз, оба CCI отрицательны).
5. Объём сделки воспроизводит динамическую формулу советника: `LotCoefficient × sqrt(Equity / EquityDivisor)` с округлением к `VolumeStep` и учётом ограничений `VolumeMin`/`VolumeMax` инструмента.
6. Метод `StartProtection` автоматически добавляет стоп-лосс, тейк-профит и трейлинг-стоп, преобразуя метатрейдеровские пункты в абсолютные ценовые смещения.

## Параметры

| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `CandleType` | `TimeSpan.FromMinutes(5).TimeFrame()` | Таймфрейм для расчёта индикаторов и сигналов. |
| `RsiPeriod` | `14` | Количество свечей в расчёте RSI. |
| `FastSmmaPeriod` | `2` | Период быстрой сглаженной средней по цене открытия. |
| `SlowEmaPeriod` | `6` | Период медленной EMA по цене открытия. |
| `FastCciPeriod` | `34` | Период быстрого CCI от типичной цены `(H+L+C)/3`. |
| `SlowCciPeriod` | `175` | Период медленного CCI от типичной цены. |
| `BullishRsiLevel` | `55` | Уровень RSI, который должен быть пробит снизу вверх для допуска лонгов. |
| `BearishRsiLevel` | `45` | Уровень RSI, который должен быть пробит сверху вниз для допуска шортов. |
| `StopLossPoints` | `60` | Дистанция стоп-лосса в пунктах MetaTrader (`0` — без стопа). |
| `TakeProfitPoints` | `0` | Дистанция тейк-профита в пунктах MetaTrader (`0` оставляет тейк отключённым, как в оригинале). |
| `TrailingStopPoints` | `20` | Дистанция трейлинг-стопа в пунктах MetaTrader (`0` отключает трейлинг). |
| `LotCoefficient` | `0.01` | Базовый коэффициент динамического мани-менеджмента. |
| `EquityDivisor` | `10` | Делитель внутри квадратного корня (`sqrt(Equity / EquityDivisor)`). |
| `MaxSpreadPoints` | `18` | Максимально допустимый спред в пунктах MetaTrader. |

## Особенности

- Фильтр по спреду использует поток Level1. Пока нет котировок best bid/ask, стратегия ожидает и не открывает позицию.
- Пересчёт пунктов в цену учитывает `PriceStep` и точность инструмента; для пяти- и трёхзнаковых символов шаг умножается на 10, что соответствует значению `Point` в MetaTrader.
- Защитные приказы обслуживает встроенный движок StockSharp c рыночными выходами, что повторяет поведение `OrderModify` в исходном советнике.
