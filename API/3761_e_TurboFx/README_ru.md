# Стратегия e-TurboFx — импульсное истощение

## Обзор
**e-TurboFx** — это порт оригинального советника MetaTrader 4, анализирующего серию последних завершённых свечей. Идея заключается в поиске направленных «пробегов», где тела свечей с каждой новой свечой становятся всё больше. Растущие медвежьи свечи указывают на истощение продавцов и возможный разворот вверх, тогда как увеличивающиеся бычьи свечи сигнализируют о перегрете покупок и возможности для короткой позиции. Реализация на StockSharp работает в событийной модели: подписывается на свечи нужного таймфрейма, отслеживает их закрытие и автоматически добавляет защитные приказы по желанию пользователя.

## Торговая логика
1. Подписка на выбранный тип свечей (`CandleType`) и обработка только завершённых свечей.
2. Ведение двух независимых счётчиков — для медвежьих и для бычьих свечей.
3. Для каждой свечи вычисляется абсолютный размер тела (`|Close - Open|`).
4. При появлении свечи противоположного направления сбрасывается противоположный счётчик.
5. Внутри каждого счётчика допускаются только строго растущие тела: каждая новая свеча должна быть больше предыдущей, иначе последовательность перезапускается с 1.
6. Когда длина последовательности достигает `DepthAnalysis`, открывается рыночная сделка в противоположную сторону (покупка после серии медвежьих свечей, продажа после серии бычьих).
7. При наличии открытой позиции генерация новых сигналов приостанавливается до её закрытия. В `OnStarted` вызывается `StartProtection`, чтобы при необходимости выставлять стоп-лосс и тейк-профит в шагах цены.

Такой алгоритм полностью повторяет MQL4-вариант, где советник проверял `N` последних свечей на предмет совпадения направления и увеличения тела у каждой более новой свечи.

## Особенности реализации
- Используется высокоуровневый API: `SubscribeCandles` + `Bind`, никаких прямых запросов к индикаторам или коллекциям.
- Внутреннее состояние хранится в примитивных полях (`_bearishSequence`, `_bullishSequence`, `_previousBearishBody`, `_previousBullishBody`), что упрощает перенос и соответствует правилам репозитория.
- `StartProtection` вызывается единожды при старте, что позволяет быстро задать защитные дистанции в шагах цены. Ноль отключает соответствующий приказ — как и в оригинальной версии.
- В исходном коде добавлены подробные комментарии на английском языке, поясняющие логику сбросов и условий входа.
- При запуске в Designer дополнительно строится область графика со свечами и сделками для наглядности.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `DepthAnalysis` | Количество подряд завершённых свечей в одном направлении с растущими телами, необходимое для входа. | `3` |
| `TakeProfitSteps` | Дистанция тейк-профита в шагах цены (тик). Значение `0` отключает тейк. | `120` |
| `StopLossSteps` | Дистанция стоп-лосса в шагах цены (тик). Значение `0` отключает стоп. | `70` |
| `TradeVolume` | Объём рыночных заявок. При изменении автоматически обновляет `Strategy.Volume`. | `0.1` |
| `CandleType` | Тип свечей (таймфрейм), по которым ведётся анализ. | `1 час` |

Все числовые параметры снабжены метаданными для оптимизации, поэтому стратегию легко подбирать в оптимизаторе StockSharp.

## Рекомендации
- Выбор таймфрейма напрямую влияет на частоту сигналов: чем он меньше, тем больше сделок, но тем выше требования к точности защитных приказов.
- Для корректной работы защитных шагов убедитесь, что у инструмента задан `PriceStep`.
- Перед боевым использованием протестируйте стратегию в Designer, чтобы убедиться в корректности пересчёта стопов и целей.
- Стратегия поддерживает только одну открытую позицию. После закрытия сделки счётчики сбрасываются и паттерн строится заново, как и в оригинале.
