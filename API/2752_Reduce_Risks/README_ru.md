# Стратегия Reduce Risks

## Описание
Reduce Risks — адаптация советника MetaTrader «Reduce_risks.mq5» для платформы StockSharp. Стратегия анализирует минутные свечи для поиска точки входа и использует подтверждающие фильтры на 15-минутном и часовом таймфреймах. Алгоритм ориентирован на валютные пары с маленьким спредом (EURUSD, USDCHF, USDJPY) и стремится входить в тренд только при низкой волатильности и подтверждённой структуре движения.

## Таймфреймы и инструменты
- **Основной таймфрейм:** свечи M1.
- **Подтверждение:** свечи M15.
- **Фильтр тренда:** свечи H1.
- **Рекомендуемые инструменты:** EURUSD, USDCHF, USDJPY либо инструменты с аналогичным размером пункта.

## Используемые данные
- SMA(5), SMA(8), SMA(13), SMA(60) по типичной цене на M1.
- SMA(4), SMA(5), SMA(8) по типичной цене на M15.
- SMA(24) по типичной цене на H1.
- Свечные характеристики (длина тела, тени, диапазон) для M1 и M15.
- Отслеживание максимальной/минимальной цены после входа для имитации оригинального трейлинг-алгоритма.

## Правила входа
### Покупка
1. Последние три свечи на M1 и M15 должны иметь диапазон меньше 20 и 30 пунктов соответственно; ширина канала последних трёх свечей M15 не превышает 30 пунктов.
2. Предыдущая свеча M1 активнее, но не более чем в 3 раза, и текущая цена пробивает максимумы предыдущих свечей M1 и M15.
3. Иерархия скользящих средних указывает на восходящий тренд: SMA5 > SMA8 > SMA13, SMA60 растёт, цена закрытия выше всех четырёх SMA.
4. На M15 SMA4 находится выше SMA8 и растёт; текущая цена выше SMA4(M15) и SMA24(H1).
5. Подтверждение «начала волны»: значение SMA8 (M1) попадало внутрь диапазона любой из трёх предыдущих свечей M1, SMA5 (M15) находится внутри диапазона предыдущей свечи M15.
6. Свечной фильтр: предыдущие свечи M1 и M15 имеют бычьи тела больше половины диапазона, формируют более высокие максимумы, откат не превышает 25 % диапазона, присутствуют тени.
7. Все условия должны выполняться одновременно, открытых позиций нет — отправляется рыночная заявка Buy.

### Продажа
Условия симметричны: диапазоны свечей ограничены, цена пробивает локальные минимумы, скользящие средние выстроены нисходящим образом (SMA5 < SMA8 < SMA13, SMA60 снижается), цена ниже всех SMA. Предыдущие свечи подтверждают нисходящую структуру (большие медвежьи тела, пониженные минимумы, маленькие откаты, наличие теней). При выполнении условий открывается рыночная заявка Sell.

## Правила выхода
- Стоп-лосс и тейк-профит в пунктах устанавливаются автоматически через механизм StartProtection.
- Дополнительные условия закрытия повторяют оригинальную логику:
  - Закрытие длинной позиции, если текущая свеча M1 упала минимум на 10 пунктов от цены открытия или после минуты от входа появилась мощная медвежья свеча.
  - Фиксация прибыли при приросте от входа ≥10 пунктов либо при откате ≥20 пунктов от максимума после входа (при условии, что максимум был выше цены входа).
  - Закрытие при просадке ≥20 пунктов или при достижении порогового уровня просадки по счёту.
  - Для коротких позиций условия зеркальные.

## Управление рисками
- Стратегия блокирует новые входы, если текущая стоимость портфеля ≤ `InitialDeposit * (1 - RiskPercent/100)`, и принудительно закрывает открытые позиции при повторном достижении порога.
- Проверки соединения и торговых разрешений из оригинального советника не требуются, так как StockSharp управляет ими автоматически.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `StopLossPips` | Размер стоп-лосса в пунктах. | `30` |
| `TakeProfitPips` | Размер тейк-профита в пунктах. | `60` |
| `InitialDeposit` | Базовый депозит для расчёта лимита просадки. | `10000` |
| `RiskPercent` | Максимальная допустимая просадка от базового депозита. | `5` |
| `M1CandleType` | Тип свечей для M1. | Таймфрейм 1 минута |
| `M15CandleType` | Тип свечей для M15. | Таймфрейм 15 минут |
| `H1CandleType` | Тип свечей для H1. | Таймфрейм 1 час |

## Примечания
- При работе с инструментами с другим размером пункта корректируйте параметры в пунктах.
- В проекте присутствует только C# версия стратегии; Python-реализация и соответствующая папка не создаются согласно заданию.
