# RPM5 BullsBearsEyes 策略

## 概述
**RPM5 BullsBearsEyes 策略** 是 MetaTrader 4 专家顾问 *Rpm5_mt4v1* 的 C# 版本。原始 EA 通过 Bulls Power 与 Bears Power 构建自定义的 BullsBearsEyes 指标，并根据该指标的多空倾向持有单一仓位。本移植版使用 StockSharp 高阶 API 重现相同行为，同时保留原有的风险参数、移动止损逻辑和信号阈值。

## 指标重建
- 计算配置周期上的 **Bulls Power** 与 **Bears Power** 指标。
- 将二者的和送入与 MT4 指标相同的四级 IIR 平滑器，平滑系数 `Gamma` 决定振荡器的响应速度。
- 平滑输出被压缩在 **0** 与 **1** 之间。数值高于阈值表示多头占优，低于阈值则代表空头占优。当任一方完全耗尽时会出现精确的 0 或 1，与原指标的极端情况一致。

## 交易规则
1. 订阅所选时间框（默认 5 分钟），仅处理已经收盘的 K 线。
2. 空仓时评估 BullsBearsEyes 数值：
   - **做多**：当前值严格大于 `Threshold`（默认 0.5）。
   - **做空**：当前值严格小于 `Threshold`。
   - 策略始终只持有一个仓位，在风险控制平仓之前会忽略反向信号。
3. 持仓后仅由止损、止盈或跟踪止损触发退出，不会主动换向。

## 风险控制
- **止损 / 止盈**：完全复刻原始 25 / 150 点设置。每次建仓时都会利用标的的 `PriceStep` 将点值换算为价格距离。
- **ATR 跟踪止损**：每根完成的 K 线都会计算周期为 `AtrPeriod`（默认 5）的平均真实波幅。跟踪距离 = 1 点 + `AtrMultiplier × ATR`。当收盘价超过该距离时，保护性止损会上移或下移以保持同样的间隔，对应 MT4 中反复调用 `OrderModify` 的逻辑。
- 在处理新信号之前优先检查保护性价位，确保退出始终先于新的入场决定。

## 参数
| 名称 | 默认值 | 说明 |
| --- | --- | --- |
| `Bulls/Bears Period` | 13 | Bulls Power 与 Bears Power 的均线周期。 |
| `Gamma` | 0.5 | BullsBearsEyes 振荡器使用的四级 IIR 平滑系数。 |
| `Threshold` | 0.5 | 多头（> 阈值）与空头（< 阈值）区域的分界线。 |
| `ATR Period` | 5 | ATR 跟踪止损的计算周期。 |
| `ATR Multiplier` | 1.5 | ATR 的乘数，用于得到跟踪距离。 |
| `Stop Loss (pips)` | 25 | 止损距离（以点数表示，建仓时转换为价格）。 |
| `Take Profit (pips)` | 150 | 止盈距离（以点数表示，建仓时转换为价格）。 |
| `Trade Volume` | 1 | 每次建仓使用的市价单数量。 |
| `Candle Type` | 5 分钟 K 线 | 策略处理的时间框。 |

## 说明
- MT4 中绘制的日内通道线仅用于视觉辅助，因此在该移植版本中省略。
- 源码中的注释全部使用英文。
- 测试脚本保持不变，如需验证请运行解决方案级检查。
