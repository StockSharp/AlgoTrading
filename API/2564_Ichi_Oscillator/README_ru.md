# Стратегия Ichi Oscillator

## Обзор
- Конверсия эксперта MetaTrader 5 **Exp_ICHI_OSC** на высокоуровневый API StockSharp.
- Работа ведётся на настраиваемых свечах, сигналы формируются по осциллятору, построенному на линиях Ichimoku.
- Исходное значение осциллятора рассчитывается как `((Close - SenkouA) - (Tenkan - Kijun)) / Step` и затем сглаживается выбранным методом скользящей средней.
- Лотовая логика и контроль просадки из MQL заменены стандартными возможностями StockSharp по управлению позицией и объёмом.

## Параметры
| Параметр | Описание |
| --- | --- |
| `CandleType` | Таймфрейм свечей, по которым рассчитываются индикаторы. |
| `IchimokuBase` | Базовый период, задающий длины Tenkan (`base * 0.5`), Kijun (`base * 1.5`) и Senkou B (`base * 3`). |
| `Smoothing Method` | Метод сглаживания осциллятора: `Simple`, `Exponential`, `Smoothed`, `Weighted`, `Jurik`, `Kaufman`. |
| `Smoothing Length` | Период выбранного сглаживающего индикатора. |
| `Smoothing Phase` | Параметр совместимости (сохранён из MQL, в текущих методах сглаживания не используется). |
| `Signal Bar` | Количество баров назад от текущего завершённого бара для считывания цветов осциллятора (по умолчанию `1`). |
| `Enable Buy Entries / Enable Sell Entries` | Разрешение на открытие длинных или коротких позиций. |
| `Enable Buy Exits / Enable Sell Exits` | Разрешение на закрытие существующих длинных или коротких позиций. |
| `Stop Loss (points)` | Размер стоп-лосса в шагах цены. |
| `Take Profit (points)` | Размер тейк-профита в шагах цены. |
| `Order Volume` | Базовый объём рыночных заявок. |

## Логика торговли
1. Подписка на свечи заданного таймфрейма и расчёт Tenkan, Kijun и Senkou A с использованием производных периодов.
2. Построение осциллятора по разнице между ценой, Senkou A, Tenkan и Kijun и последующее сглаживание выбранной скользящей средней.
3. Присвоение цвета сглаженному значению:
   - `0` — осциллятор выше нуля и растёт.
   - `1` — осциллятор выше нуля и падает.
   - `2` — нейтральное состояние (около нуля или без изменений).
   - `3` — осциллятор ниже нуля и снижается.
   - `4` — осциллятор ниже нуля и растёт.
4. Чтение двух цветов: бара `SignalBar + 1` (предыдущий цвет) и бара `SignalBar` (текущий цвет).
   - Если предыдущий цвет равен `0` или `3`, закрываются шорты (если разрешено) и открывается лонг, когда текущий цвет равен `2`, `1` или `4`.
   - Если предыдущий цвет равен `4` или `1`, закрываются лонги (если разрешено) и открывается шорт, когда текущий цвет равен `0`, `1` или `3`.
5. Ордера выставляются на заданный объём. Лонги и шорты не накапливаются: открытия оцениваются только после выполнения логики выхода в рамках того же бара.

## Управление рисками
- Защита позиции выполняется через `StartProtection`, стоп и тейк задаются в шагах цены.
- Трейлинг и частичные выходы отсутствуют.

## Примечания
- Лотовый менеджмент из оригинального эксперта исключён; используется фиксированный объём, заданный параметром.
- Методы сглаживания, отсутствующие в StockSharp (JurX, ParMA, VIDYA, T3), недоступны; выбирайте наиболее близкий из реализованных вариантов.
- Во всех сообщениях журнала время сигнала соответствует времени закрытия свечи плюс один полный период свечи, повторяя логику `TimeShiftSec` в MQL.
