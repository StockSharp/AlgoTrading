# 条件持仓开启策略

## 概述
**条件持仓开启策略** 复刻了原始的 MetaTrader 脚本“当没有持仓时开多单”的思路。策略的核心非常直接：当手动开关允许做多或做空时，只有在对应方向上没有敞口时才发送市价单，从而避免重复建仓，让仓位始终符合选择的方向。

StockSharp 版本依靠框架的高级蜡烛订阅以及内置的风控助手实现，经纪商无关。止损与止盈距离以点值（价格步长）表示，因此可以适配任意品种。

## 策略逻辑
1. 订阅配置好的蜡烛序列，作为周期性触发心跳。
2. 在每根完成的蜡烛上检查当前净头寸。
3. 如果多头开关开启且仓位为空或净空，则发送买入市价单。
4. 如果空头开关开启且仓位为空或净多，则发送卖出市价单。
5. 通过 `StartProtection` 自动处理保护性订单，将点值距离转换为实际价格偏移。

由于 StockSharp 使用净持仓模型，同时开启两个方向时会先尝试建立多头，再在成交后若仍为空仓时尝试建立空头，这与原始脚本避免每个方向重复下单的意图一致。

## 参数
| 名称 | 默认值 | 说明 |
| --- | --- | --- |
| `Volume` | `1` | 每次入场的下单数量。|
| `StopLossPips` | `100` | 以价格步长表示的止损距离，设为 0 可关闭。|
| `TakeProfitPips` | `200` | 以价格步长表示的止盈距离，设为 0 可关闭。|
| `EnableBuy` | `false` | 当为 `true` 时，若没有多头敞口可开多单。|
| `EnableSell` | `false` | 当为 `true` 时，若没有空头敞口可开空单。|
| `CandleType` | `1 分钟周期` | 用于驱动周期性检查的蜡烛序列。|

## 备注
- 距离值会使用合约的 `PriceStep` 转换为实际价格偏移；若交易所未提供步长，则直接使用原始点值作为绝对距离。
- `StartProtection` 会在成交后自动附加止损与止盈，无需额外的手工订单管理。
- 策略专注于参数化的手动触发流程，可作为主观交易模板使用。
