# Стратегия «Условное открытие позиций»

## Обзор
**Условное открытие позиций** полностью повторяет логику оригинального скрипта MetaTrader «Open a buy position if there's no open position». Если соответствующий переключатель активирован, стратегия отправляет рыночную заявку только при отсутствии позиции в выбранном направлении. Это исключает дублирующие входы и удерживает позицию в соответствии с заданным флагом.

Порт на StockSharp использует высокоуровневую подписку на свечи и встроенный механизм защиты, поэтому остается независимым от конкретного брокера. Расстояния до стоп-лосса и тейк-профита задаются в пунктах (шаги цены), что позволяет применять стратегию к любому инструменту.

## Логика стратегии
1. Подписаться на выбранный тип свечей и использовать его как регулярный триггер.
2. После закрытия каждой свечи проверить текущую чистую позицию.
3. Если переключатель на покупку включен и позиция отсутствует или короткая, отправить рыночную заявку на покупку.
4. Если переключатель на продажу включен и позиция отсутствует или длинная, отправить рыночную заявку на продажу.
5. Вызов `StartProtection` автоматически формирует защитные заявки и переводит пунктовые расстояния в реальные ценовые смещения.

Поскольку StockSharp оперирует чистыми позициями, одновременное включение обеих сторон сначала попытается открыть длинную сделку, а затем — при отсутствии позиции после исполнения — короткую. Это соответствует идее MQL-скрипта, не допускавшего нескольких ордеров в одном направлении.

## Параметры
| Название | Значение по умолчанию | Описание |
| --- | --- | --- |
| `Volume` | `1` | Объем каждой рыночной заявки. |
| `StopLossPips` | `100` | Расстояние до стоп-лосса в шагах цены; `0` отключает уровень. |
| `TakeProfitPips` | `200` | Расстояние до тейк-профита в шагах цены; `0` отключает уровень. |
| `EnableBuy` | `false` | При `true` стратегия может открыть длинную позицию, если нет длинного экспонирования. |
| `EnableSell` | `false` | При `true` стратегия может открыть короткую позицию, если нет короткого экспонирования. |
| `CandleType` | `таймфрейм 1 минута` | Серия свечей, определяющая момент проверки. |

## Примечания
- Расстояния конвертируются в абсолютные цены с помощью `PriceStep`. При отсутствии данных по шагу используется исходное значение пунктов.
- `StartProtection` автоматически выставляет защитные заявки после каждой сделки, поэтому дополнительное управление ордерами не требуется.
- Стратегия предназначена для параметрического ручного запуска и может служить шаблоном для дискретионной торговли.
