# Стратегия Fibonacci Time Zones

## Описание

Стратегия представляет собой портирование советника MetaTrader "Fibonacci Time Zones" на платформу StockSharp. Основная идея сохранена: фильтрация сигналов по старшему таймфрейму MACD, выход по полосам Боллинджера и многоуровневое управление позицией. Логика реализована на высокоуровневом API — индикаторы подключаются через `Bind`/`BindEx`, а данные поступают из двух подписок на свечи.

## Алгоритм работы

1. **MACD-фильтр**. Для выбранного медленного таймфрейма вычисляется MACD (12/26/9). Пересечение основной линии выше сигнальной формирует намерение открыть длинную позицию, пересечение вниз — короткую. Открытие происходит на следующей свечке рабочего таймфрейма, чтобы не дублировать заявки.
2. **Открытие сделок**. При появлении сигнала отправляется заданное количество рыночных заявок. Если уже есть позиция противоположного направления, она закрывается перед открытием новой.
3. **Закрытие позиции**. Используется несколько правил:
   - **Полосы Боллинджера**: для длинных позиций выход при достижении верхней полосы, для коротких — нижней.
   - **Классические стопы**: фиксированные уровни стоп-лосса, тейк-профита и трейлинг-стопа в пунктах автоматически переводятся в цену и передаются в `StartProtection`.
   - **Перевод в безубыток**: после прохождения указанного количества пунктов стоп переносится на цену входа плюс отступ.
   - **Денежный трейлинг**: суммарная (реализованная + плавающая) прибыль отслеживается, при достижении порога включается защита прибыли с допустимым откатом.
   - **Целевые значения по прибыли**: по желанию можно включить закрытие всех позиций при достижении абсолютной или процентной цели по счету.

## Настройки

- `UseTakeProfitMoney`, `TakeProfitMoney` — закрыть позицию при достижении заданной денежной прибыли.
- `UseTakeProfitPercent`, `TakeProfitPercent` — аналогичная цель, но в процентах от начального капитала.
- `EnableTrailingProfit`, `TrailingTakeProfitMoney`, `TrailingStopLossMoney` — параметры денежного трейлинг-стопа.
- `UseStop`, `StopLossPips`, `TakeProfitPips`, `TrailingStopPips` — основные стоповые параметры в пунктах.
- `UseMoveToBreakEven`, `WhenToMoveToBreakEven`, `PipsToMoveStopLoss` — контроль перевода в безубыток.
- `NumberOfTrades` — сколько заявок отправлять на каждый сигнал (порт повторяет возможность наращивать позицию несколькими ордерами).
- `CandleType`, `MacdCandleType` — рабочий таймфрейм и таймфрейм фильтра MACD.

## Отличия от оригинала

- Кнопки на графике и построение самих "Fibonacci Time Zones" не реализованы; стратегия ориентирована на автоматическое исполнение.
- В оригинале вход осуществлялся вручную нажатием кнопок, здесь — автоматически по пересечениям MACD.
- Функции управления счетом переписаны под `Portfolio` и `PnL` StockSharp.

## Рекомендации по использованию

1. Перед запуском выберите подходящие типы свечей. По умолчанию используется 15-минутный рабочий таймфрейм и месячный фильтр MACD.
2. Настройте значения в пунктах в соответствии с шагом цены инструмента — стратегия автоматически переводит их в абсолютные цены.
3. Если требуется больше гибкости, можно отключить денежные цели и оставить только выход по полосам Боллинджера.
