# Pipsover

## Обзор
Pipsover — стратегия на разворот импульса, реагирующая на экстремальные значения осциллятора Чайкина. Исходный эксперт MetaTrader 5 открывает сделку тогда, когда осциллятор формирует выраженный всплеск, а предыдущая свеча откатывается к простой скользящей средней с периодом 20. Порт на C# сохраняет ту же идею: значение осциллятора пересчитывается через линию накопления/распределения и пару экспоненциальных средних. Для управления рисками используются те же дистанции стоп-лосса и тейк-профита, что и в оригинальном советнике.

## Индикаторы и инструменты
- **Простая скользящая средняя (SMA 20)** — базовая линия возврата к среднему, которой должна коснуться предыдущая свеча.
- **Осциллятор Чайкина (EMA 3 – EMA 10 от ADL)** — измеряет давление покупателей и продавцов. Сильные отрицательные значения готовят покупки, сильные положительные значения — продажи.
- **Линия накопления/распределения (ADL)** — источник данных для осциллятора. Быстрая и медленная EMA применяются к ADL, что повторяет работу функции `iChaikin` из MQL5.

## Логика торговли
### Вход в покупку
1. Дождаться завершённой свечи, чтобы все показатели были финальными.
2. Убедиться, что предыдущая свеча закрылась ростом (`Close > Open`).
3. Проверить, что минимум предыдущей свечи опускался ниже SMA20.
4. Значение осциллятора Чайкина на предыдущей свече должно быть ниже `-OpenLevel`.
5. При отсутствии открытой позиции выполняется рыночная покупка.

### Вход в продажу
1. Дождаться завершённой свечи.
2. Предыдущая свеча должна закрыться падением (`Close < Open`).
3. Максимум предыдущей свечи должен быть выше SMA20.
4. Осциллятор Чайкина на предыдущей свече должен быть выше `OpenLevel`.
5. При отсутствии позиции отправляется рыночная продажа.

### Выход из позиции
- **Длинные позиции** закрываются, если следующая свеча формируется в пользу продавцов (закрытие ниже открытия), её максимум остаётся выше SMA20, а Чайкин поднимается выше `CloseLevel`.
- **Короткие позиции** закрываются, если следующая свеча становится бычьей, минимум опускается ниже SMA20, а Чайкин падает ниже `-CloseLevel`.
- Дополнительно каждая свеча проверяет срабатывание стоп-лосса и тейк-профита. Для лонга позиция закрывается при достижении стоп-цены или цели; для шорта проверки зеркальны.

## Управление позицией
- Одновременно может быть открыта только одна чистая позиция. Перед новым входом отменяются все активные заявки, что повторяет логику «одна позиция» из MQL5.
- Стоп-лосс и тейк-профит вычисляются через шаг цены инструмента. Для покупок стоп размещается на `StopLossPoints * PriceStep` ниже цены входа, тейк-профит — на `TakeProfitPoints * PriceStep` выше. Для продаж значения симметричны, но расположены в противоположных направлениях.

## Параметры
| Название | Значение по умолчанию | Описание |
| --- | --- | --- |
| `TradeVolume` | 0.1 | Объём каждой рыночной заявки. |
| `MaLength` | 20 | Период фильтра по скользящей средней. |
| `StopLossPoints` | 65 | Отступ стоп-лосса от цены входа в шагах цены. |
| `TakeProfitPoints` | 100 | Отступ тейк-профита от цены входа в шагах цены. |
| `OpenLevel` | 100 | Порог по модулю Чайкина для открытия позиций. |
| `CloseLevel` | 125 | Порог по модулю Чайкина для закрытия позиций. |
| `ChaikinFastLength` | 3 | Период быстрой EMA в расчёте осциллятора. |
| `ChaikinSlowLength` | 10 | Период медленной EMA в расчёте осциллятора. |
| `CandleType` | 1 час | Период свечей, по которым ведутся вычисления. |

## Особенности реализации
- Подписка `SubscribeCandles().Bind(...)` синхронно передаёт значения ADL и SMA в обработчик, что избавляет от ручного обращения к буферам.
- Значения осциллятора Чайкина пересчитываются внутри `ProcessCandle`, соблюдая требования руководства по конвертации.
- Хранятся данные последней завершённой свечи, а также значения SMA и Чайкина, чтобы воспроизвести обращение к бару с `shift=1`, как в MQL5 (`iClose`, `iLow`, `iChaikin`).
- Уровни стопа и цели фиксируются во внутренних переменных стратегии, что обеспечивает одинаковое поведение в тестах и на реальном счёте.
