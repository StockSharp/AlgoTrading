# Стратегия Sample Detect Economic Calendar

## Общее описание
**Sample Detect Economic Calendar** — порт оригинального советника MetaTrader `SampleDetectEconomicCalendar.mq5`. Стратегия отслеживает вручную заданные события экономического календаря и при приближении важной новости для выбранной валюты выставляет симметричную пару стоп-заявок. Логика стоп-лосса, тейк-профита и трейлинг-стопа повторяет исходный код.

В версии StockSharp нет прямого доступа к календарю MetaTrader, поэтому список событий задаётся пользователем через параметр `CalendarDefinition`.

## Принцип работы
1. Подписка на котировки Level1 для получения лучших цен Bid/Ask.
2. При запуске каждая строка из `CalendarDefinition` разбирается в отдельное событие.
3. Для событий с важностью High и валютой, соответствующей `BaseCurrency`, стратегия:
   - ждёт наступления окна за `LeadMinutes` минут до релиза;
   - рассчитывает объём ордеров (фиксированный или по риску);
   - выставляет buy stop и sell stop на расстояниях `BuyDistancePoints` и `SellDistancePoints` от текущих цен.
4. После публикации новости висящие заявки отменяются по истечении `PostMinutes` либо при достижении общей границы `ExpiryMinutes`.
5. При исполнении одной заявки противоположная снимается, а позиция сопровождается стоп-лоссом, тейк-профитом и трейлинг-стопом.

## Параметры
| Параметр | Описание |
|----------|----------|
| `TradeNews` | Включает постановку заявок вокруг новостей. |
| `OrderVolume` | Фиксированный объём при отключённом управлении капиталом. |
| `StopLossPoints` | Расстояние стоп-лосса в пунктах (0 — отключить). |
| `TakeProfitPoints` | Расстояние тейк-профита в пунктах (0 — отключить). |
| `TrailingStopPoints` | Шаг трейлинг-стопа в пунктах (0 — выключен). |
| `ExpiryMinutes` | Максимальное время жизни заявок после релиза (минуты). |
| `UseMoneyManagement` | Использовать риск-менеджмент на базе баланса. |
| `RiskPercent` | Доля капитала, которую допускается потерять в одной сделке. |
| `BuyDistancePoints` | Отступ для buy stop относительно Ask. |
| `SellDistancePoints` | Отступ для sell stop относительно Bid. |
| `LeadMinutes` | За сколько минут до новости размещать заявки. |
| `PostMinutes` | Через сколько минут после новости снять неисполненные ордера. |
| `BaseCurrency` | Валютный код события (по умолчанию `USD`). |
| `CalendarDefinition` | Многострочное описание календаря. |

## Формат событий
Каждое событие записывается отдельной строкой:

```
yyyy-MM-dd HH:mm;CUR;High;Название события
```

* `yyyy-MM-dd HH:mm` — время события в UTC (поддерживаются секунды и альтернативные форматы `yyyy/MM/dd`, `dd.MM.yyyy`).
* `CUR` — валютный код (например, `USD`). Торгуются только события, совпадающие с `BaseCurrency`.
* `High` — уровень важности (`High`, `Medium`, `Low`, `Nfp`). Сделки открываются только на `High`.
* `Название события` — произвольная подпись, отображаемая в логах.

Пример:

```
2024-06-12 18:00;USD;High;FOMC Statement
2024-07-05 12:30;USD;Nfp;Non-Farm Payrolls
```

## Управление риском
* При выключенном `UseMoneyManagement` используется фиксированный объём `OrderVolume`.
* При включённом `UseMoneyManagement` объём рассчитывается исходя из `RiskPercent` капитала и величины `StopLossPoints`. Соблюдаются биржевые ограничения по минимальному/максимальному объёму и шагу.
* Трейлинг-стоп активируется после прохождения ценой `TrailingStopPoints` пунктов в прибыльную сторону и закрывает позицию при откате, также учитываются уровни стоп-лосса и тейк-профита.

## Отличия от версии MetaTrader
* События необходимо вводить вручную в параметр `CalendarDefinition`.
* Каждый экземпляр стратегии обслуживает одну валютную пару.
* Время истечения заявок реализовано внутренними таймерами `PostMinutes`/`ExpiryMinutes`, так как в StockSharp отсутствует режим `ORDER_TIME_SPECIFIED`.

## Рекомендации по использованию
1. Перед запуском заполните `CalendarDefinition`, время указывается в UTC.
2. Активируйте `TradeNews` и настройте рисковые параметры.
3. Убедитесь в наличии данных Level1, чтобы стратегия могла выставить ордера в нужный момент.
4. Контролируйте журнал сообщений, чтобы подтверждать корректную постановку и отмену ордеров по каждому событию.
