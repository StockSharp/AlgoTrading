# Стратегия балансировки экспозиции d'Alembert

## Общее описание

Стратегия переносит на StockSharp многовалютную систему MetaTrader "E04LC07". Торгуются три валютные пары
(EURUSD, EURGBP, GBPUSD), при этом контролируется суммарная экспозиция по EUR, GBP и USD. Для определения точки входа и
выхода применяется упрощённый фильтр Heikin-Ashi, а управление объёмом ведётся по схеме d'Alembert: после прибыльной сделки
уровень снижается, после убыточной — повышается.

Направления открытия позиций совпадают с оригинальным советником: покупка EURUSD, продажа EURGBP и продажа GBPUSD. Параметр
`InvertSignals` позволяет полностью инвертировать корзину. Когда позиция закрывается с прибылью, следующий объём уменьшается;
при убытке — увеличивается. Дополнительные ограничения на позицию и экспозицию не дают корзине "перекоситься".

## Логика торговли

1. Подписаться на выбранный тип свечей и рассчитать значения Heikin-Ashi для каждой пары.
2. Выжидать заданный интервал между решениями по одному инструменту.
3. Открывать позицию, если направление Heikin-Ashi совпадает с базовым и лимиты по позиции/экспозиции позволяют это сделать.
4. Закрывать длинную позицию, когда:
   - Heikin-Ashi разворачивается вниз;
   - достигнута заданная доля прибыли;
   - цена падает ниже порога защитного выхода.
5. Для короткой позиции используются симметричные условия.
6. После полного закрытия позиции обновлять уровень d'Alembert: уменьшать после прибыли, увеличивать после убытка.
7. Постоянно пересчитывать текущую экспозицию по валютам и проверять её на превышение лимитов.

## Параметры

| Параметр | Описание |
| -------- | -------- |
| `EurUsd`, `EurGbp`, `GbpUsd` | Инструменты корзины. |
| `CandleType` | Таймфрейм для фильтра Heikin-Ashi. |
| `InvertSignals` | Инвертировать базовые направления. |
| `BaseVolume` | Базовый минимальный объём сделки. |
| `LotMultiplier` | Множитель, применяемый к базовому объёму. |
| `StartLevel` | Стартовый уровень d'Alembert (не менее 1). |
| `MaxPositionPerSymbol` | Максимальная абсолютная позиция по инструменту. |
| `MaxExposurePerCurrency` | Максимальная абсолютная экспозиция по отдельной валюте. |
| `ManageTakeProfit` | Включить автоматическое сопровождение тейк-профита. |
| `ManageLoss` | Включить защитный выход при убытке. |
| `TakeProfitPercent` | Целевой процент прибыли от цены входа. |
| `LossPercent` | Допустимая доля просадки от цены входа. |
| `CooldownSeconds` | Пауза между решениями по одному инструменту. |

## Примечания

- Предполагается стандартная шестисимвольная запись валютных пар (например, `EURUSD`).
- Экспозиция считается в лотах; при необходимости можно добавить пересчёт в базовую валюту портфеля.
- При инверсии корзины логика управления объёмами и рисками остаётся прежней.
- Версия на Python не создаётся согласно требованиям репозитория.
