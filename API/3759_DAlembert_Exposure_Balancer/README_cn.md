# D'Alembert 暴露均衡策略

## 概述

本策略是 MetaTrader "E04LC07" d'Alembert 多货币系统的 StockSharp 移植版。策略交易三个货币对
（EURUSD、EURGBP、GBPUSD），并在它们共享的货币之间控制净敞口。策略使用简化的平均足趋势过滤器决定
何时入场或离场，并使用 d'Alembert 资金管理模型在盈利后降低手数、亏损后提高手数。

默认方向与原始 MQL 模板一致：做多 EURUSD、做空 EURGBP、做空 GBPUSD。通过 `InvertSignals` 参数可以全
部反向。当一笔交易以盈利结束时，下次下单的级别降低；当发生亏损时，下单级别提高。仓位与敞口的上限保
证篮子保持平衡。

## 交易逻辑

1. 为每个货币对订阅指定类型的K线，并计算平均足数值。
2. 在同一品种内的两次决策之间等待设定的冷却时间。
3. 当平均足方向与默认偏向一致、且仓位与敞口限制均允许时开仓。
4. 对于多单，在以下任一条件成立时平仓：
   - 平均足转为看跌；
   - 价格达到设定的获利百分比；
   - 价格跌破设定的止损百分比。
5. 对于空单使用对称的规则。
6. 每次仓位完全平仓后，按盈亏调整 d'Alembert 级别：盈利减少一级，亏损增加一级。
7. 实时维护 EUR、GBP、USD 的敞口映射，确保每种货币的绝对敞口不超过上限。

## 参数

| 名称 | 说明 |
| ---- | ---- |
| `EurUsd`、`EurGbp`、`GbpUsd` | 篮子中使用的证券。 |
| `CandleType` | 计算平均足的K线类型。 |
| `InvertSignals` | 是否反转默认方向。 |
| `BaseVolume` | 计算手数时使用的最小基准手。 |
| `LotMultiplier` | 乘以基准手的倍数。 |
| `StartLevel` | d'Alembert 起始级别（至少为 1）。 |
| `MaxPositionPerSymbol` | 单个品种允许的最大净仓量。 |
| `MaxExposurePerCurrency` | 单个货币允许的最大绝对敞口。 |
| `ManageTakeProfit` | 是否启用自动止盈。 |
| `ManageLoss` | 是否启用自动止损/亏损退出。 |
| `TakeProfitPercent` | 以入场价为基准的获利目标百分比。 |
| `LossPercent` | 以入场价为基准的允许最大回撤百分比。 |
| `CooldownSeconds` | 同一品种两次决策之间的冷却时间（秒）。 |

## 说明

- 策略假定证券代码符合标准外汇六字符格式（例如 `EURUSD`）。
- 为简化起见，敞口以手数单位计算；如需，可以扩展为转换成单一货币。
- 当篮子方向被反转时，资金管理与敞口控制逻辑保持不变。
- 根据仓库要求，本策略未提供 Python 版本。
