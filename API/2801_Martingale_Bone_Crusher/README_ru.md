# Стратегия Martingale Bone Crusher

## Обзор

**Martingale Bone Crusher Strategy** переносит логику оригинального советника MetaTrader в среду StockSharp. Стратегия определяет направление торговли по сравнению быстрой и медленной скользящих средних и использует модель мартингейла, увеличивая объем следующей сделки после убыточного исхода. Для управления рисками предусмотрены фиксированные денежные цели, цели в процентах, перенос стопа в безубыток, классические стоп-лосс/тейк-профит в шагах цены и защитный трейлинг по прибыли в деньгах.

## Торговая логика

- **Генерация сигналов.** На основной серии свечей рассчитываются две простые скользящие средние. Если быстрая ниже медленной — ищется покупка; если выше — продажа. Новые сделки не открываются, пока позиция не закрыта.
- **Мартингейл.** После каждой закрытой сделки рассчитывается объем следующего входа. Убыток приводит к увеличению объема (по множителю или с шагом), прибыль возвращает объем к начальному значению.
- **Режимы работы.** Доступны два варианта мартингейла:
  - `Martingale1` — каждая новая сделка следует текущему направлению скользящих средних.
  - `Martingale2` — после убытка следующая сделка открывается в противоположную сторону, как в оригинальном советнике.
- **Защита позиции.** Во время удержания позиции стратегия контролирует:
  - фиксированные стоп-лосс и тейк-профит в шагах цены;
  - опциональный трейлинг по экстремумам с фиксированным отступом;
  - перенос стопа в безубыток после прохождения заданного расстояния;
  - закрытие по суммарной плавающей прибыли в деньгах и процентах;
  - трейлинг по прибыли в деньгах после достижения заданного порога.

## Параметры

| Параметр | Описание |
|----------|----------|
| `UseTakeProfitMoney` | Включает денежный тейк-профит. |
| `TakeProfitMoney` | Величина прибыли, при которой позиция закрывается (если `UseTakeProfitMoney = true`). |
| `UseTakeProfitPercent` | Включает тейк-профит в процентах от начального капитала. |
| `TakeProfitPercent` | Значение процента для `UseTakeProfitPercent`. |
| `EnableTrailing` | Включает трейлинг-стоп по прибыли в деньгах. |
| `TrailingTakeProfitMoney` | Плавающая прибыль, необходимая для активации денежного трейлинга. |
| `TrailingStopMoney` | Допустимая просадка прибыли после активации денежного трейлинга. |
| `MartingaleMode` | Выбор режима `Martingale1` или `Martingale2`. |
| `UseMoveToBreakeven` | Включает перенос стопа в безубыток. |
| `MoveToBreakevenTrigger` | Количество шагов цены до активации безубытка. |
| `BreakevenOffset` | Отступ от цены входа при установке безубытка. |
| `Multiply` | Множитель объема после убыточной сделки (используется при `DoubleLotSize = true`). |
| `InitialVolume` | Базовый объем первой сделки и сделок после прибыли. |
| `DoubleLotSize` | Выбор между умножением (`true`) и приращением (`false`) объема. |
| `LotSizeIncrement` | Приращение объема после убытка, если `DoubleLotSize = false`. |
| `TrailingStopSteps` | Отступ трейлинг-стопа в шагах цены. |
| `StopLossSteps` | Стоп-лосс в шагах цены. |
| `TakeProfitSteps` | Тейк-профит в шагах цены. |
| `FastPeriod` | Период быстрой SMA. |
| `SlowPeriod` | Период медленной SMA. |
| `CandleType` | Тип свечей для расчетов. |

## Примечания

- Объем автоматически приводится к шагу объема и ограничивается допустимыми минимумом и максимумом инструмента.
- Расчет прибыли в деньгах опирается на `PriceStep` и `StepPrice`. Если значения равны нулю, денежные ограничения пропускаются.
- По требованию предоставлена только C# версия, Python-реализация не создавалась.
