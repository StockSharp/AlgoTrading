# Стратегия Percentage Crossover
[English](README.md) | [中文](README_cn.md)

Стратегия повторяет работу оригинального эксперта MetaTrader `Exp_PercentageCrossover`. Она торгует направление индикатора Percentage Crossover, который строит тянущуюся за ценой линию и позволяет ей смещаться лишь в пределах фиксированного процентного коридора от текущего закрытия. Наклон линии определяет состояние рынка и формирует торговые сигналы.

## Концепция

1. На каждой завершённой свече индикатор сохраняет предыдущее значение линии.
2. Бычье обновление происходит, когда закрытие выталкивает линию выше её прежнего уровня как минимум на `percent` процентов.
3. Медвежье обновление происходит, когда закрытие опускает линию ниже предыдущего уровня на тот же процент.
4. Если закрытие остаётся внутри коридора, линия остаётся горизонтальной и сохраняет последний цвет.

Цвет линии интерпретируется так же, как в MetaTrader:

- **Индекс цвета 0 (фиолетовый)** – линия растёт, сигнализируя о бычьем контексте.
- **Индекс цвета 1 (оранжевый)** – линия снижается, сигнализируя о медвежьем контексте.

## Правила торговли

### Входы в покупки
- Срабатывают только при `BuyPosOpen = true`.
- Анализируется бар, указанный параметром `SignalBar` (значение 1 соответствует последнему закрытому бару).
- Длинная позиция открывается, когда этот бар меняет цвет с 1 на 0.

### Входы в продажи
- Срабатывают только при `SellPosOpen = true`.
- Анализируется тот же бар `SignalBar`.
- Короткая позиция открывается, когда бар меняет цвет с 0 на 1.

### Управление позицией
- При `BuyPosClose = true` открытая длинная позиция закрывается, как только анализируемый бар имеет цвет 1.
- При `SellPosClose = true` открытая короткая позиция закрывается, как только бар имеет цвет 0.
- Если `UseTimeFilter = true` и текущее время выходит за пределы торгового окна, стратегия немедленно закрывает позицию и игнорирует новые сигналы до возвращения рынка в допустимый интервал.
- Заявки отправляются методами `BuyMarket()` и `SellMarket()`. Объём сделки задаётся свойством `Volume` стратегии.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `Percent` | Процентная ширина коридора вокруг цены. Чем выше значение, тем медленнее реагирует линия. | `1` |
| `SignalBar` | Номер анализируемого закрытого бара (1 = последний закрытый). Должен быть больше нуля. | `1` |
| `BuyPosOpen` / `SellPosOpen` | Включение входов в длинные или короткие позиции. | `true` |
| `BuyPosClose` / `SellPosClose` | Включение выхода из длинных или коротких позиций. | `true` |
| `UseTimeFilter` | Активация торгового окна. | `true` |
| `StartHour` / `StartMinute` | Час и минута начала торгового окна при активном фильтре. | `0` / `0` |
| `EndHour` / `EndMinute` | Час и минута окончания торгового окна. | `23` / `59` |
| `CandleType` | Таймфрейм свечей, на котором рассчитывается индикатор и сигналы. | `4h` |

## Особенности

- Временной фильтр полностью повторяет логику оригинального советника. При `StartHour > EndHour` формируется ночное окно, однако оно становится активным только после того, как минуты достигают `StartMinute`.
- Параметр `SignalBar` анализирует исключительно закрытые свечи. Значение `1` соответствует стандартной настройке MetaTrader.
- Стратегия не накладывает собственных стоп-лоссов или тейк-профитов. Контроль риска нужно организовать внешними средствами либо за счёт настройки процента и торгового окна.
