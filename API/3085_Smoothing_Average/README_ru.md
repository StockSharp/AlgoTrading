# Стратегия Smoothing Average

## Обзор
Стратегия Smoothing Average повторяет логику исходного советника **Smoothing Average (barabashkakvn's edition)** для MQL5. В основе лежит сглаженная скользящая средняя и ценовой фильтр, измеряемый в пунктах. Когда цена отклоняется от средней на заданную дистанцию, стратегия открывает позицию по направлению движения (или в противоположную сторону, если включен реверс). Выход выполняется при возврате цены через расширенный канал вокруг средней.

## Логика торговли
### Основной режим (`ReverseSignals = false`)
- **Вход в лонг:** закрытие свечи выше уровня `MA - Entry Delta (pips)`.
- **Вход в шорт:** закрытие свечи ниже уровня `MA + Entry Delta (pips)`.
- **Выход из шорта:** закрытие свечи выше уровня `MA + Entry Delta (pips) × Close Delta Coefficient`.
- **Выход из лонга:** закрытие свечи ниже уровня `MA - Entry Delta (pips) × Close Delta Coefficient`.

### Режим реверса (`ReverseSignals = true`)
- **Вход в лонг:** закрытие свечи ниже уровня `MA + Entry Delta (pips)`.
- **Вход в шорт:** закрытие свечи выше уровня `MA - Entry Delta (pips)`.
- **Выход из лонга:** закрытие свечи ниже уровня `MA - Entry Delta (pips) × Close Delta Coefficient`.
- **Выход из шорта:** закрытие свечи выше уровня `MA + Entry Delta (pips) × Close Delta Coefficient`.

Скользящая средняя может быть сдвинута вперед на несколько баров. В стратегии это реализовано буфером последних значений индикатора: для расчётов берётся значение `MaShift` баров назад, что соответствует линии, которую строит оригинальный индикатор в MetaTrader.

## Параметры
- `Candle Type` — тип свечей, используемых в расчётах.
- `MA Length` — период сглаженной средней.
- `MA Shift` — число баров, на которое линия средней сдвигается вперёд.
- `MA Type` — метод расчёта средней (простая, экспоненциальная, сглаженная, линейно-взвешенная).
- `Price Source` — ценовой источник для средней (по умолчанию типичная цена).
- `Entry Delta (pips)` — дистанция от средней для входа в сделку. Переводится в цену через размер пункта инструмента.
- `Close Delta Coefficient` — множитель для расчёта выходного канала.
- `Reverse Signals` — включает зеркальную логику входов/выходов.
- `Trade Volume` — фиксированный объём сделки для обоих направлений.

## Управление рисками
- Все заявки отправляются с объёмом `Trade Volume`; усреднение и наращивание позиции не выполняется.
- Выходы основаны на правилах. Стопы и тейк-профиты не выставляются, но вызывается `StartProtection()` для включения стандартной защиты в платформе.
- Режим реверса позволяет торговать против тренда без изменения остальных параметров.

## Особенности реализации
- Размер пункта рассчитывается по `Security.PriceStep`. Для инструментов с тремя или пятью знаками используется корректировка ×10, как и в коде MQL5.
- Средняя использует выбор `Price Source`, что позволяет воспроизвести любые настройки применяемой цены.
- Для проверок условий используется цена закрытия свечи — она служит аналогом bid/ask из оригинального советника.
- Все комментарии внутри C#-кода написаны на английском языке, согласно требованиям инструкции.
