# RRS Chaotic 策略

## 概览
原始的 **RRS Chaotic EA** 会在每个 tick 上随机挑选交易品种和手数，然后立刻下市价单。移植到 StockSharp 后，我们保留了“受控混沌”的思想：策略监听所选证券的 K 线，当一根 K 线收盘时根据随机数决定方向与仓位大小，同时完全复制 MQL4 中的风险管理逻辑。

## 主要特性
- **随机进场**：每根完成的 K 线都会生成 0~10 的随机整数。数值为 `6` 或 `9` 时买入，为 `3` 或 `8` 时卖出，与 MT4 版本一致。
- **动态手数**：交易量在 *MinVolume* 与 *MaxVolume* 之间均匀抽样，并自动对齐到证券的最小交易步长。
- **点差过滤**：当当前点差（以点为单位）大于 *MaxSpreadPoints* 时禁止开新仓。
- **止盈止损**：基于点数的止盈/止损与原始 EA 的参数一一对应，可选择关闭（设为 0）。
- **风险控制**：未实现盈亏实时与固定金额或账户百分比比较，一旦触发阈值会取消挂单并强制平仓。

## 参数说明
| 参数 | 说明 |
|------|------|
| `CandleType` | 用于驱动策略逻辑的 K 线类型（默认 1 分钟）。 |
| `MinVolume` / `MaxVolume` | 随机手数的上下限。 |
| `TakeProfitPoints` | 止盈距离（点）。设为 0 则禁用。 |
| `StopLossPoints` | 止损距离（点）。设为 0 则禁用。 |
| `MaxOpenTrades` | 允许持有的最大净仓位量，以成交量步长计。 |
| `MaxSpreadPoints` | 允许的最大点差（点）。 |
| `SlippagePoints` | 保留的滑点参数，仅作展示。 |
| `RiskControlMode` | 风险模式：`FixedMoney` 或 `BalancePercentage`。 |
| `RiskValue` | 触发强平的金额或百分比，取决于风险模式。 |
| `TradeComment` | 附加在订单上的备注，方便追踪。 |

## 执行流程
1. 订阅指定的 K 线序列，仅在蜡烛完成时处理。
2. 计算当前未实现损益并进行风险校验，若超过阈值则撤单并平仓。
3. 根据最新成交价更新止盈与止损目标，模拟 MT4 的订单参数。
4. 当允许交易且点差满足条件时，投掷随机数决定是否开多或做空。
5. 使用 `MaxOpenTrades` 限制叠加仓位，避免净头寸超出限制。

## 与 MQL4 版本的差异
- MT4 版本会在多个品种之间随机轮换；StockSharp 策略仅操作单一证券，因此随机性只作用于方向与手数。
- 止盈与止损通过蜡烛收盘时的市价单执行，而不是委托级别的 `StopLoss`/`TakeProfit`。
- 点差判断使用实时买卖价差，而非 `MarketInfo` 返回值。
- 所有订单都会附加 `TradeComment` 字段，起到类似 Magic Number 的标记作用。

## 使用建议
- 请确保证券配置了正确的 `PriceStep`、`MinStep` 与 `VolumeStep`，否则点值换算会出错。
- 默认的 1 分钟 K 线可以带来较高的随机频率，同时避免 tick 级数据过载。可以根据需要调整时间框架。
- 风险管理基于净仓位的未实现盈亏，StockSharp 采用净额制度，因此无法像 MT4 那样同时持有多空双向仓。
