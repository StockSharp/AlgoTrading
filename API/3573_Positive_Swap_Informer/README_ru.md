# Стратегия Positive Swap Informer

## Обзор
**Positive Swap Informer Strategy** — порт скрипта MetaTrader `Swap Informer` (MQL/41693) на платформу StockSharp. Стратегия периодически сканирует настраиваемый список инструментов в «Обзоре рынка» и выводит все бумаги с положительным свопом по длинной или короткой позиции. Решение предназначено для трейдеров, отслеживающих возможности кэрри-трейда и инструменты с положительным овернайт-финансированием.

Стратегия не выставляет заявки. Она служит только для информирования: каждый тик таймера формирует сводный отчет, который записывается в журнал стратегии и может быть использован вручную либо в последующих автоматизированных сценариях.

## Логика работы
1. При запуске формируется список отслеживаемых инструментов из основного `Strategy.Security` (опционально) и идентификаторов, указанных в параметре `SymbolsList`.
2. Для каждого инструмента запрашиваются данные Level1, чтобы коннектор наполнил метаданные значениями свопов.
3. Таймер с периодом `RefreshInterval` запускает регулярную проверку. На каждом срабатывании считываются поля свопов из `Security.ExtensionInfo`.
4. Если обнаружено положительное значение, в отчет добавляется строка вида:
   ```
   <SecurityId>: Swap Long (Buy) = <value>
   <SecurityId>: Swap Short (Sell) = <value>
   ```
5. Если положительные свопы отсутствуют, выводится сообщение `Positive swap report: no symbols with a positive swap were found.`

Формат сообщений полностью повторяет оригинальный скрипт MetaTrader, что позволяет переиспользовать существующие процессы обработки текста.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `SymbolsList` | Дополнительные инструменты для мониторинга. Допустимые разделители: запятая, точка с запятой, пробел, табуляция, перевод строки. | `""` |
| `RefreshInterval` | Интервал между сканированиями. При значении ≤ 0 автоматически устанавливается 1 секунда. | `00:00:10` |
| `IncludePrimarySecurity` | При `true` основной инструмент `Strategy.Security` автоматически добавляется в список сканирования. | `true` |

## Требования к данным
* Брокер или источник данных должен передавать свопы через `Security.ExtensionInfo`. Стратегия ищет ключи `SwapBuy`, `SwapLong`, `SwapBuyPoints`, `SwapLongPoints`, `SwapSell`, `SwapShort`, `SwapSellPoints`, `SwapShortPoints` (без учета регистра).
* Если используются другие ключи, добавьте их в множества `_longSwapKeys` и `_shortSwapKeys` в коде стратегии.
* Исторические данные не требуются — стратегия работает исключительно с метаданными.

## Порядок использования
1. Добавьте стратегию в терминал StockSharp или сервер стратегий и при необходимости назначьте портфель.
2. При желании заполните `SymbolsList` списком идентификаторов, которые нужно отслеживать. Они должны совпадать с кодами в `SecurityProvider`.
3. При необходимости измените `RefreshInterval`, если стандартные 10 секунд не подходят.
4. Запустите стратегию. После первого срабатывания таймера в журнале появится список инструментов с положительным свопом или сообщение об их отсутствии.
5. Просматривайте журнал либо перенаправьте сообщения в собственную систему уведомлений.

## Ограничения
* Стратегия не нормализует величины свопа. Разные провайдеры публикуют значения в пунктах, денежном выражении или процентах — ориентируйтесь на спецификацию брокера.
* Некоторые коннекторы заполняют свопы только после первой сделки или наступления определенного биржевого события, поэтому отчет может оставаться пустым до обновления данных.
* Стратегия выполняет только операции чтения и может работать параллельно с торговыми стратегиями без влияния на заявки и позиции.
* Отчет формируется заново при каждом тике таймера и не использует кэш, чтобы не пропустить внезапные изменения.

## Соответствие скрипту MetaTrader
| Концепция MetaTrader | Реализация в StockSharp |
|----------------------|-------------------------|
| `SymbolsTotal(true)` | Поиск через `SecurityProvider` плюс опциональное добавление основного инструмента |
| `SymbolInfoDouble(..., SYMBOL_SWAP_LONG/SHORT)` | Чтение заранее определенных ключей в `Security.ExtensionInfo` |
| `Comment()` | Вызовы `LogInfo()` |
| `EventSetTimer(1)` | Таймер с периодом `RefreshInterval` (по умолчанию 10 секунд) |

## Возможности расширения
* Добавляйте собственные названия ключей в `_longSwapKeys` и `_shortSwapKeys`, если ваш источник данных использует другую терминологию.
* При необходимости замените `LogInfo` на собственный механизм уведомлений (почта, сообщения, панель мониторинга и т.д.).
* Логику таймера можно модифицировать через методы `StartTimer` и `StopTimer`, например, для пакетной выгрузки результатов.

## Проверка
Стратегия не оказывает влияния на торги, поэтому отдельные тесты не прилагаются. Для проверки подключитесь к брокеру, предоставляющему данные по свопам, запустите стратегию и убедитесь, что журнальные записи соответствуют ожидаемому поведению.
