# FX-CHAOS 剥头皮策略

## 概述
FX-CHAOS 剥头皮策略复制了 MT5 专家顾问的逻辑，将 Awesome Oscillator 与基于分形的 ZigZag 水平相结合。移植到 StockSharp 后，策略订阅小时级别的 K 线用于交易执行，同时订阅日线用于高周期过滤。内置的跟踪器通过检测五根 K 线的分形形态来重建 “ZigZag on Fractals” 指标，并把识别出的波峰和波谷连接成交替的摆动点。

## 流程
1. **数据采集**
   - 小时 K 线驱动入场判定和风控。
   - 日线提供更高周期的 ZigZag 水平过滤。
   - 在小时数据上计算 Awesome Oscillator（5，34）。
2. **分形 ZigZag 跟踪**
   - 每根收盘的 K 线都会推入一个包含 5 根 K 线的滑动窗口。
   - 当窗口中部的 K 线满足上/下分形条件时，更新当前的 ZigZag 摆动点；同方向出现更极端的分形时，会替换之前的极值。
3. **信号判定（按小时收盘）**
   - 做多信号要求：当前 K 线开盘价低于上一根高点、收盘价突破该高点、收盘价位于最近的小时 ZigZag 摆动之下、站在最新的日线 ZigZag 之上，同时 Awesome Oscillator 为负值。
   - 做空信号为镜像条件：使用上一根低点，且 Awesome Oscillator 为正值。
4. **下单与持仓管理**
   - 若存在反向持仓，先平仓再根据信号开新仓，使用配置的交易量。
   - 记录入场价格，以便计算止损与止盈。

## 参数
| 名称 | 说明 |
| --- | --- |
| `Volume` | 每次下单的交易量（手数）。 |
| `Stop Loss (pts)` | 止损距离（点）。将与标的的最小报价单位相乘；填 0 表示禁用。 |
| `Take Profit (pts)` | 止盈距离（点）。计算方式与止损相同；填 0 表示禁用。 |
| `Trading Candle` | 执行信号的主要周期（默认 1 小时）。 |
| `Daily Candle` | 用于 ZigZag 过滤的高周期（默认 1 天）。 |

## 风险控制
- 每根小时 K 线收盘时都会检查价格是否触及根据入场价计算出的止损或止盈水平。
- 一旦触发保护水平，会立即平掉当前仓位并清除入场标记，避免同一根 K 线内再次进场。
- 出现反向信号时，会先平掉当前仓位，再根据新信号重新建仓。

## 实现细节
- ZigZag 跟踪器仅使用最少的本地状态，并基于蜡烛订阅执行，不直接访问指标缓冲区。
- 在 ZigZag 形成之前（至少需要前后各两根 K 线）策略不会交易。
- Awesome Oscillator 通过 `BindEx` 绑定，策略只在指标输出为最终值时才评估信号。
- 止损/止盈距离会乘以 `Security.PriceStep`。当标的没有定义步长时，会退回到 1 点的倍数。

## 文件列表
- `CS/FxChaosScalpStrategy.cs` —— 策略实现，包含 ZigZag 跟踪、Awesome Oscillator 过滤与下单逻辑。
- `README.md` —— 英文文档。
- `README_ru.md` —— 俄文文档。
