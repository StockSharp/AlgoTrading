# Стратегия Fibo Pivot MultiVal

## Обзор

**Fibo Pivot MultiVal** — это портирование на StockSharp эксперта MetaTrader 4 `_Fibo_Pivot_multiVal.mq4`. Алгоритм совмещает
дневные уровни разворота с коэффициентами Фибоначчи, чтобы автоматически выставлять лимитные заявки внутри каждого ценового
коридора вокруг дневного пивота. Расписание торгов, цели по прибыли и правила остановки соответствуют оригинальному советнику,
поэтому переход на новую платформу проходит максимально гладко.

## Основные идеи

1. **Расчёт уровней**: на основе максимумов, минимумов и закрытия предыдущего дня формируются классические уровни (P, R1-R3,
   S1-S3). Дополнительно вычисляются промежуточные точки Фибоначчи и расширения R3/S3 для отработки возможных пробоев.
2. **Контроль закрытий**: стратегия анализирует свечи выбранного таймфрейма (по умолчанию 15 минут). Как только закрытие
   попадает внутрь конкретной зоны, активируется набор лимитных заявок для этой области.
3. **Лимитные заявки**: внутри каждой зоны размещаются заявки в обе стороны, при этом направление для участков R1-R2 и S1-S2
   можно ограничить параметром `MidZoneOrderMode`.
4. **Гибкие цели**: при включённом `UseReversalTargets` фиксация прибыли выполняется внутри диапазона, ориентируясь на
   возврат. Если параметр выключен, предыдущий дневной диапазон сравнивается с порогами `LimitPointOut` и `LimitPointIn` — в
   зависимости от этого выбираются дальние цели (расширения) или возврат к пивоту.
5. **Ограничения по риску**: когда прибыль или число сделок за день/инструмент достигают лимита, стратегия останавливает набор
   позиции и снимает все заявки. Торговля возобновляется на следующей сессии до наступления `StartTime`.
6. **Сеансовая логика**: в `StartTime` происходит запуск и очистка статистики, после `FinishTime` новые заявки не создаются, а
   в `CloseAllTime` закрываются все позиции и отменяются заявки.

## Параметры

| Параметр | Значение по умолчанию | Описание |
| -------- | --------------------- | -------- |
| `CandleType` | Свечи 15 минут | Таймфрейм анализа. |
| `OrderVolume` | `0.1` | Объём каждой лимитной заявки. |
| `StartTime` | `00:01` | Время запуска торговли и сброса счётчиков. |
| `FinishTime` | `08:00` | Время остановки генерации новых входов. |
| `CloseAllTime` | `12:00` | Время принудительного закрытия позиций и снятия заявок. |
| `UseReversalTargets` | `true` | Использовать внутренние цели в пределах зоны. |
| `LimitPointIn` | `150` | Порог дневного диапазона (в пунктах), после которого цели смещаются к пивоту. |
| `LimitPointOut` | `50` | Порог диапазона, при котором предпочтительнее работать на пробой. |
| `LevelPf1` | `33` | Деление отрезка Pivot–R1 / Pivot–S1. |
| `LevelF1F2` | `50` | Деление отрезков R1–R2 и S1–S2. |
| `LevelF2F3` | `33` | Деление отрезков R2–R3 и S2–S3. |
| `LevelF3Out` | `40` | Расширение уровней R3/S3. |
| `MidZoneOrderMode` | `"bs"` | Допустимые направления в средних зонах (`"b"` — только покупки, `"s"` — только продажи, `"bs"` — оба направления). |
| `DailyProfitTarget` | `50` | Лимит дневной прибыли (в пунктах). |
| `DailyTradeTarget` | `35` | Максимальное число закрытых сделок в день. |
| `SymbolProfitTarget` | `150` | Ограничение прибыли по инструменту (в пунктах). |
| `SymbolTradeTarget` | `15` | Максимум сделок по инструменту в день. |

## Управление ордерами

* Каждая зона хранит собственные заявки на вход, тейк-профит и (опционально) стоп. После исполнения входа заявка на выход
  перестраивается согласно параметрам зоны.
* Закрытые сделки обновляют дневную и инструментальную статистику. Достижение любого лимита блокирует новые входы до следующего
  сброса.
* При наступлении временных границ лимитные заявки отменяются автоматически. В момент `CloseAllTime` позиции закрываются по
  рынку.

## Рекомендации

* Убедитесь, что у инструмента корректно задан шаг цены (`PriceStep`) — это важно для пересчёта пунктов в цену.
* Для рынков с иной волатильностью адаптируйте `LimitPointIn` и `LimitPointOut`, чтобы сбалансировать режимы пробоя и возврата.
* Если в средней зоне нужно торговать только в одну сторону, выставьте `MidZoneOrderMode` в `"b"` или `"s"`.
* Параметры стратегии позволяют оптимизацию; используйте возможности StockSharp Designer для подбора коэффициентов Фибоначчи и
  лимитов риска.

## Отличия от оригинального советника

* Один экземпляр стратегии обслуживает только один инструмент; для мультивалютной торговли запустите несколько копий.
* Объём заявок задаётся в фактических торговых единицах, а не в «лотах» MetaTrader. Настройте `OrderVolume` в соответствии с
  требованиями брокера.
* Исполнение ордеров происходит через высокоуровневый API StockSharp (`BuyLimit`, `SellLimit` и т. п.), поэтому возможны
  отличия от MetaTrader — протестируйте стратегию на тестовой среде перед запуском на реальном счёте.

