# Стратегия FT TIME BIGDOG (пробой диапазона)

## Обзор
**FT TIME BIGDOG** — это пробойная стратегия сессии Лондона, перенесённая из советника MetaTrader 4 `FT_TIME_BIGDOG.mq4` (каталог `MQL/9259`).
Стратегия измеряет ценовой коридор между заданными часами начала и окончания, а затем выставляет отложенные стоп-заявки выше и ниже диапазона после закрытия окна.
Порт на StockSharp сохраняет исходную логику и добавляет параметры для настройки времени, фильтра диапазона и управления рисками.

## Логика торговли
1. Для каждого торгового дня фиксируются максимумы и минимумы закрытых свечей, открывающихся между **StartHour** и **StopHour** (включительно).
2. После закрытия свечи на часе **StopHour**, если ширина диапазона меньше **RangeLimitPoints**, становятся доступны две отложенные заявки:
   - **Buy Stop** на уровне зафиксированного максимума.
   - **Sell Stop** на уровне зафиксированного минимума.
3. Заявка выставляется только если текущая цена удалена от уровня входа минимум на **OrderBufferPoints**. Используются лучшие bid/ask из потока Level1, при их отсутствии берётся цена закрытия свечи.
4. Каждая заявка получает стоп-лосс на противоположной границе диапазона и тейк-профит, рассчитанный по **TakeProfitPoints**.
5. После входа в позицию противоположная заявка отменяется. Открытая позиция отслеживается по закрытиям свечей: при достижении стоп-лосса или тейк-профита позиция закрывается рыночной заявкой.
6. Цикл выполняется не более одного раза в день; в начале нового дня состояние сбрасывается.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `StartHour` | 14 | Час (0–23), с которого начинается накопительный диапазон. |
| `StopHour` | 16 | Час, после которого допускается выставление стоп-заявок. Должен быть ≥ `StartHour`. |
| `RangeLimitPoints` | 50 | Максимальная ширина диапазона в пунктах брокера (пункт × `PointMultiplier`). Если диапазон шире — сделок нет. |
| `TakeProfitPoints` | 50 | Размер тейк-профита в пунктах брокера. |
| `OrderBufferPoints` | 20 | Минимальное расстояние от текущей цены до отложенной заявки. Предотвращает вход слишком близко к рынку. |
| `PointMultiplier` | 1 | Множитель для учёта пятизначных котировок (установите 10 для 5-значных форекс-инструментов). |
| `Volume` | 0.1 | Объём ордеров для обеих стоп-заявок. |
| `CandleType` | 1 час | Тип свечей, по которым рассчитывается диапазон. |

## Управление рисками и сделками
- Стоп-лосс для длинных позиций = нижняя граница диапазона, для коротких — верхняя граница.
- Тейк-профит рассчитывается от уровня входа с использованием `TakeProfitPoints` и шага цены инструмента.
- Все проверки выполняются на закрытии свечи, поэтому внутрисвечные проколы могут привести к задержке выхода.

## Отличия от оригинального советника
- В MT4 советник работает по тиковым данным, в StockSharp используется закрытие свечей и поток Level1. Возможно небольшое расхождение внутри свечи.
- Перевод пунктов использует `Security.PriceStep`, умноженный на `PointMultiplier`; перед реальной торговлей убедитесь, что шаг цены указан верно.
- Поддерживаются только окна, где `StartHour <= StopHour`. Пересечение полуночного рубежа в данной версии не реализовано.

## Рекомендации по использованию
1. Выберите инструмент и убедитесь, что поставщик данных отдаёт поток Level1 для корректной проверки буфера.
2. Настройте часы под серверное время брокера.
3. Перед запуском на реале протестируйте стратегию в симуляции, чтобы проверить пересчёт пунктов и тайминг.
4. Перед ручной модификацией отложенных заявок остановите стратегию, чтобы избежать рассинхронизации состояния.

## Файлы
- `CS/FtTimeBigdogStrategy.cs` — порт стратегии на StockSharp с подробными комментариями.
- `MQL/9259/FT_TIME_BIGDOG.mq4` — исходный код советника MetaTrader.
