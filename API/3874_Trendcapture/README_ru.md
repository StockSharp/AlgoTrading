# 3874 Trendcapture

## Общее описание

**Trendcapture** — это перенос советника MetaTrader `MQL/7772/Trendcapture.mq4` на высокоуровневый API StockSharp. Исходный алгоритм отслеживает направление Parabolic SAR и открывает сделки только тогда, когда ADX показывает слабый тренд. После закрытия позиции он выбирает направление следующей сделки по результату предыдущей, а при достижении небольшой прибыли переносит стоп-лосс в точку безубытка.

Версия для StockSharp сохраняет эти особенности, используя связки индикаторов и вспомогательные методы регистрации заявок. Сигналы рассчитываются исключительно на закрытых свечах выбранного таймфрейма.

## Логика торговли

1. **Индикаторы**
   - Parabolic SAR (`ParabolicSar`) с настраиваемым шагом и максимальным ускорением.
   - Average Directional Index (`AverageDirectionalIndex`), откуда берётся основное значение ADX.
2. **Вход в позицию**
   - Открытой может быть только одна позиция.
   - Длинная позиция открывается, если:
     - Текущая «желаемая» ориентация (по итогу последней сделки) — покупка.
     - Свеча закрылась выше значения SAR.
     - ADX ниже `20`, что соответствует условию слабого тренда в оригинале.
   - Короткая позиция строится зеркально: желаемое направление — продажа, закрытие ниже SAR, ADX ниже `20`.
3. **Управление позицией**
   - После исполнения заявки выставляются стоп-лосс и тейк-профит на расстояниях `StopLossPoints` и `TakeProfitPoints`, пересчитанных через шаг цены инструмента.
   - Как только плавающая прибыль достигает `GuardPoints`, стоп переносится на цену входа — аналог `OrderModify` из MQL.
   - При закрытии позиции направление обновляется: прибыльная сделка сохраняет ориентацию, убыточная или нулевая — меняет её на противоположную.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `CandleType` | Тип свечей для расчёта сигналов. | Часовые свечи |
| `SarStep` | Начальный шаг Parabolic SAR. | `0.02` |
| `SarMax` | Максимальное ускорение Parabolic SAR. | `0.2` |
| `AdxPeriod` | Период сглаживания ADX. | `14` |
| `TakeProfitPoints` | Дистанция до тейк-профита в шагах цены. | `180` |
| `StopLossPoints` | Дистанция до стоп-лосса в шагах цены. | `50` |
| `GuardPoints` | Количество пунктов до перевода стопа в безубыток. | `5` |
| `MaximumRisk` | Коэффициент масштабирования объёма (значение `0.03` повторяет размер лота из оригинала). | `0.03` |

## Рекомендации по использованию

- Убедитесь, что для инструмента задан `PriceStep` или хотя бы `MinStep`, иначе пересчёт пунктов в цены будет некорректным.
- Свойство `Volume` задаёт базовый объём при `MaximumRisk = 0.03`. Увеличение коэффициента риска пропорционально увеличит подаваемый объём.
- Стратегия работает только рыночными ордерами и сразу выставляет защитные заявки, поэтому при отсутствии позиции в стакане не остаётся «забытых» ордеров.
- Перенос стопа в безубыток реализован через отмену текущей стоп-заявки и постановку новой по цене входа, что полностью повторяет поведение эксперта MetaTrader.

## Файлы

- `CS/TrendcaptureStrategy.cs` — реализация стратегии на C#.
- `README.md` — описание на английском языке.
- `README_cn.md` — перевод на китайский язык.
