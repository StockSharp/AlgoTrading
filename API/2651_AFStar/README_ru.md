# Стратегия AFStar
[English](README.md) | [中文](README_cn.md)

Стратегия AFStar отслеживает смену импульса, комбинируя поиск пересечений
семейства быстрых и медленных EMA с фильтром на основе прорыва канала
Williams %R. Торговый сигнал появляется только тогда, когда оба компонента
совпадают по направлению.

Бычий сигнал формируется, если хотя бы одна быстрая EMA из диапазона
`[Start Fast, End Fast]` пересекает сверху совместимую медленную EMA из
`[Start Slow, End Slow]` при шаге `Step Period`, а осциллятор
Williams %R, рассчитанный для значений риска из `[Start Risk, End Risk]`
с шагом `Risk Step`, выходит вверх из нижней границы после пребывания в
нейтральной зоне. Медвежий сигнал работает зеркально. Исполнение заявок
откладывается на количество баров, указанное в параметре **Signal Bar**, что
полностью повторяет поведение исходного эксперта MetaTrader.

После открытия позиции стратегия при желании устанавливает защитный стоп-лосс
и тейк-профит в шагах цены. Проверка срабатывания этих уровней происходит на
каждой закрывшейся свече. Управление капиталом упрощено: используется постоянный
объём **Order Volume**, поэтому сложные правила расчёта лота из версии MQL5 не
переносились.

## Условия входа

- **Покупка:**
  - Быстрая EMA из заданного диапазона пересекает снизу медленную EMA.
  - Williams %R фиксирует выход из нижнего канала после периода консолидации.
  - При включённом **Enable Sell Exits** перед входом закрываются короткие
    позиции.
- **Продажа:**
  - Зеркальные условия для медвежьего пересечения и прорыва верхнего канала.
  - При активном **Enable Buy Exits** сначала закрываются длинные позиции.

## Условия выхода

- Сигнал противоположного направления закрывает позицию, если соответствующий
  флаг выхода включён (покупка закрывает шорты, продажа — лонги).
- Дополнительно позиция может быть закрыта по стоп-лоссу или тейк-профиту,
  заданным в шагах цены.

## Параметры

- **Order Volume** – объём рыночных заявок.
- **Candle Type** – используемый таймфрейм (по умолчанию 4 часа).
- **Start Fast / End Fast / Step Period** – диапазон быстрых EMA.
- **Start Slow / End Slow** – диапазон медленных EMA.
- **Start Risk / End Risk / Risk Step** – границы перебора параметра риска для
  Williams %R.
- **Signal Bar** – задержка в барах перед исполнением сигнала.
- **Stop Loss (pips)** – расстояние стоп-лосса в шагах цены.
- **Take Profit (pips)** – расстояние тейк-профита в шагах цены.
- **Enable Buy Entries / Enable Sell Entries** – включение лонгов или шортов.
- **Enable Buy Exits / Enable Sell Exits** – разрешение закрытия позиций
  сигналами противоположного направления.

## Примечания

- Для расчётов хранится до 512 последних свечей.
- Если у инструмента отсутствует шаг цены, для расчёта защитных уровней
  используется значение 1.
- Очередь сигналов позволяет задать мгновенное исполнение при **Signal Bar = 0**
  или задержку на указанное количество завершённых баров при больших значениях.
