# Простая стратегия копирования сделок

## Обзор

**Простая стратегия копирования сделок** дублирует ручные или внешние сделки, которые попадают в тот
же коннектор и портфель StockSharp. Когда появляется новая сделка без заданного префикса, стратегия
оценивает изменение исходной позиции и отправляет пропорциональный приказ на копирование с учётом
выбранного множителя. Все копии получают настраиваемый префикс в комментарии, что упрощает их
идентификацию и контроль.

Решение представляет собой адаптацию MQL4-советника `trade_copier_v.mq4` на высокоуровневый API
StockSharp. Стратегия опирается на события `Connector.NewMyTrade`, поддерживает любые инструменты,
передаваемые в портфель, и автоматически синхронизирует исходную и скопированную экспозиции.

## Ключевая логика

1. **Отслеживание сделок** – Каждый новый `MyTrade` анализируется. Сделки с настроенным префиксом
   рассматриваются как уже скопированные, остальные воспринимаются как источник для зеркалирования.
2. **Учёт позиций** – Стратегия ведёт отдельные словари по исходным и копируемым позициям, а также
   фиксирует объём ожидающих корректировок, чтобы не дублировать приказы во время исполнения.
3. **Копирование приказов** – Если исходная и копируемая экспозиции расходятся, стратегия вычисляет
   разницу, проверяет ограничение по проскальзыванию и отправляет рыночный приказ с соответствующей
   стороной и объёмом.
4. **Обслуживание** – Идентификаторы обработанных сделок кэшируются на настраиваемый период, чтобы
   избежать повторной реакции при получении исторических данных. Параметр `CheckInterval`,
   унаследованный из MQL-версии, задаёт длительность этого окна.

## Параметры

- **Slippage** – Допустимое отклонение в тиках между последней ценой и ценой исходной сделки. Если
  разница больше порога, копирующий приказ не отправляется.
- **Multiplier** – Множитель объёма для копируемых приказов. Значение `1` даёт полное зеркалирование,
  `2` – удвоенный объём и т. д.
- **MaxOrderAge** – Максимально допустимая «возраст» исходной сделки. События, пришедшие позже этого
  срока, игнорируются, чтобы не копировать задержанные или исторические данные.
- **CommentPrefix** – Префикс для комментариев копирующих приказов. Также служит маркером, позволяющим
  распознавать уже созданные копии.
- **CheckInterval** – Наследованный из MQL интервал таймера. В версии StockSharp синхронизация
  происходит мгновенно, а параметр определяет, как долго хранятся обработанные идентификаторы сделок.

## Рекомендации по использованию

1. Запустите стратегию на том же коннекторе и портфеле, куда поступают исходные сделки.
2. Настройте параметры в соответствии с требованиями площадки: скорректируйте множитель, допуск по
   проскальзыванию и префикс комментария.
3. После запуска стратегия немедленно начнёт отслеживать сделки и поддерживать скопированную
   экспозицию в актуальном состоянии.
4. Чтобы исключить отдельные сделки из копирования, добавьте заданный префикс в их комментарий перед
   отправкой на биржу.

## Дополнительная информация

- Стратегия совместима с любыми инструментами, поддерживаемыми StockSharp, и не требует вручную
  задавать список тикеров.
- Для копирования используются рыночные приказы, что соответствует логике исходного MQL-советника.
- Закрытие позиции на исходном счёте вызывает противоположный приказ, возвращающий копируемую позицию
  к нулю.
- Стратегия полностью событийная; внутренние коллекции защищены блокировками, что обеспечивает
  корректную работу при большом потоке сделок.
