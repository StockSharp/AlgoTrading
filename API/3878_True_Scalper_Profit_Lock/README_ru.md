# Стратегия True Scalper Profit Lock

## Обзор

Стратегия True Scalper Profit Lock представляет собой портирование эксперта MetaTrader 4 **TrueScalperProfitLock.mq4** на API StockSharp. Комбинация пересечения экспоненциальных скользящих средних (3 и 7 периодов) и двух режимов RSI используется для поиска краткосрочных разворотов. После открытия позиции система автоматически выставляет фиксированные уровни стоп-лосса и тейк-профита, а также может переносить стоп в безубыток при достижении заданной прибыли.

## Торговая логика

- **Фильтр тренда.** Быстрая EMA, рассчитанная на предыдущей свече, должна находиться выше (для покупок) или ниже (для продаж) медленной EMA. Разница между средними должна превышать один шаг цены, чтобы исключить флэтовые участки.
- **Подтверждение RSI.** Реализованы оба метода из оригинального советника. Метод A отслеживает пересечение 2-периодного RSI с порогом между двумя последними закрытыми свечами. Метод B проверяет, находится ли RSI двух свечей назад выше или ниже порога. Методы можно использовать по отдельности или совместно.
- **Направление сделок.** Для входа в лонг требуется, чтобы быстрая EMA была выше медленной, а RSI указывал на перепроданность (значение ниже порога). Для шорта условия зеркальные.

## Управление позицией

- **Начальная защита.** После открытия рассчитываются уровни стоп-лосса и тейк-профита на фиксированном расстоянии в шагах цены (по умолчанию 90 и 44). 
- **Profit Lock.** При активации функция переносит стоп-лосс в область безубытка плюс смещение `BreakEvenOffsetPoints`, если цена прошла `BreakEvenTriggerPoints` шагов в нужном направлении.
- **Таймер отказа.** Параметр `AbandonBars` определяет, через сколько закрытых свечей позиция закрывается принудительно. Метод A дополнительно инициирует противоположный вход, метод B просто фиксирует результат и ждёт нового сигнала.
- **Управление капиталом.** Формула расчёта объёма полностью повторяет версию MT4: используется баланс портфеля, процент риска, тип счёта (мини/стандарт) и ограничения «боевого» режима. При отключении `UseMoneyManagement` применяется фиксированный объём.

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Таймфрейм анализируемых свечей. |
| `FixedVolume` | Базовый объём заявки при отключённом ММ. |
| `TakeProfitPoints` / `StopLossPoints` | Дистанция до тейк-профита и стоп-лосса в шагах цены. |
| `UseRsiMethodA` / `UseRsiMethodB` | Переключатели двух режимов подтверждения RSI. |
| `RsiThreshold` | Пороговое значение RSI. |
| `AbandonMethodA` / `AbandonMethodB` | Варианты логики принудительного выхода. |
| `AbandonBars` | Количество закрытых свечей до срабатывания отказа. |
| `UseMoneyManagement`, `RiskPercent`, `AccountIsMini`, `LiveTradingMode` | Настройки управления капиталом. |
| `UseProfitLock`, `BreakEvenTriggerPoints`, `BreakEvenOffsetPoints` | Параметры переноса стоп-лосса в безубыток. |
| `MaxOpenTrades` | Максимальное число одновременных позиций (по умолчанию одна). |

## Рекомендации по использованию

1. Анализ ведётся только на закрытых свечах, что соответствует обращению к барам со смещением в исходном эксперте.
2. Комбинируйте режимы RSI в зависимости от желаемой чувствительности фильтра.
3. Перенос стопа и логика отказа опираются на экстремумы свечей. На длинных таймфреймах учитывайте возможные внутридневные проскальзывания.
4. Для работы управления капиталом необходим портфель с заполненным `BeginValue`. При его отсутствии стратегия использует фиксированный объём.

## Файлы

- `CS/TrueScalperProfitLockStrategy.cs` – реализация стратегии на C#.
- `README.md` – документация на английском языке.
- `README_cn.md` – документация на китайском языке.

