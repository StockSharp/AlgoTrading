# Стратегия Monday Typical Breakout

## Общее описание

**Monday Typical Breakout** — порт советника MetaTrader `yi1ywioff50qr6` (ID 8187) на платформу StockSharp. Оригинальный алгоритм анализирует часовые свечи и в каждый понедельник открывает длинную позицию, если новая свеча стартует выше типичной цены предыдущей (`(High + Low + Close) / 3`). В данной реализации используется высокоуровневый API StockSharp, что позволяет гибко настраивать объем позиции и защитные ордера.

## Логика торговли

1. Стратегия подписывается на выбранный поток свечей (по умолчанию 1 час).
2. После формирования каждой свечи выполняются проверки:
   - День недели — понедельник.
   - Час открытия совпадает со значением параметра *Open Hour* (по умолчанию 09:00).
   - Отсутствуют открытые позиции и активные заявки.
   - Цена открытия текущей свечи выше типичной цены предыдущей.
3. Если условия соблюдены, стратегия выставляет рыночную заявку на покупку с объемом, рассчитанным блоком управления капиталом, и включает автоматическую защиту `StartProtection` с заданными стоп-уровнями.

Стратегия не продает и открывает не более одной сделки на каждую подходящую свечу понедельника.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `FixedVolume` | Фиксированный объем сделки. Значение `0` активирует лестничное масштабирование по капиталу. | `0.1` |
| `OpenHour` | Час (0–23), в который проверяется сигнал. | `9` |
| `StopLossPoints` | Стоп-лосс в пунктах. `0` отключает стоп. | `50` |
| `TakeProfitPoints` | Тейк-профит в пунктах. `0` отключает тейк. | `20` |
| `InitialEquity` | Минимальная величина капитала для запуска динамического расчета объема. | `600` |
| `EquityStep` | Прирост капитала, после которого объем увеличивается на шаг. | `300` |
| `InitialStepVolume` | Объем позиции при первом выполнении условия по капиталу. | `0.4` |
| `VolumeStep` | Приращение объема для каждого шага капитала. | `0.2` |
| `CandleType` | Тип свечей, используемый для расчетов (по умолчанию часовые). | `1 час` |

## Управление капиталом

- При `FixedVolume > 0` используется фиксированный объем.
- При `FixedVolume = 0` стратегия анализирует значение `Portfolio.CurrentValue`:
  - Если капитал ниже `InitialEquity`, выставляется минимальный допустимый объем инструмента.
  - Когда капитал достигает порога, используется `InitialStepVolume`; далее каждые `EquityStep` добавляют к объему `VolumeStep`.
  - Результат приводится к минимальному и шаговому объему инструмента.

## Управление риском

В методе `OnStarted` вызывается `StartProtection`, которая преобразует расстояние в пунктах в реальные ценовые уровни через `PriceStep`. Установка значения `0` отключает соответствующий стоп или тейк.

## Практические рекомендации

- Алгоритм разрабатывался для часовых свечей. На меньших таймфреймах за один час может быть несколько свечей, однако стратегия все равно пропустит сигналы, если уже есть открытая позиция или активные заявки.
- Для корректной работы динамического расчета объема требуется доступ к актуальной стоимости портфеля.
- Необходимо обеспечить получение свечей указанного типа и поток заявок уровня Level1 для исполнения рыночных приказов.

## Особенности портирования

- Проверка магического номера в MQL заменена контролем позиции (`Position`) и списком активных заявок (`ActiveOrders`).
- Временные условия используют `DateTimeOffset.OpenTime.ToLocalTime()`, что обеспечивает соответствие локальному времени графика.
- Постановка защитных ордеров реализована через высокоуровневый метод `StartProtection` вместо ручной регистрации лимитных заявок.

