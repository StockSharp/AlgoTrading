# 周一典型突破策略

## 概述

**周一典型突破策略** 是 MetaTrader 专家顾问 `yi1ywioff50qr6`（仓库编号 8187）的 C# 版本。原始脚本在每根小时 K 线收盘后判断下一根开盘价是否高于上一根的典型价格 `(最高 + 最低 + 收盘) / 3`，若条件满足且无持仓，则在周一固定时刻开多。本实现使用 StockSharp 高级策略框架复刻该逻辑，并提供详细的参数用于仓位管理与风险控制。

## 交易逻辑

1. 订阅参数指定的 K 线序列（默认 1 小时）。
2. 每当一根 K 线结束时执行以下检查：
   - 当前 K 线属于周一。
   - K 线开盘小时与参数 *Open Hour*（默认 09:00）相同。
   - 当前没有持仓或挂单。
   - 开盘价高于上一根 K 线的典型价格。
3. 若全部条件成立，则按照资金管理模块计算出的手数市价买入，同时通过 `StartProtection` 设置止损与止盈距离。

策略只做多，每根符合条件的周一 K 线最多触发一次交易。

## 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `FixedVolume` | 固定下单手数；设为 `0` 则启用权益分级手数表。 | `0.1` |
| `OpenHour` | 用于判定信号的小时数（0-23）。 | `9` |
| `StopLossPoints` | 止损距离（价格点），为 `0` 时禁用止损。 | `50` |
| `TakeProfitPoints` | 止盈距离（价格点），为 `0` 时禁用止盈。 | `20` |
| `InitialEquity` | 启动权益分级手数的最低权益阈值。 | `600` |
| `EquityStep` | 每增加多少权益提升一次手数。 | `300` |
| `InitialStepVolume` | 当权益达到阈值时使用的基础手数。 | `0.4` |
| `VolumeStep` | 每达到一个权益阶梯增加的额外手数。 | `0.2` |
| `CandleType` | 用于计算信号的 K 线类型（默认 1 小时）。 | `1 小时时间框架` |

## 资金管理

- 当 `FixedVolume` 大于零时，策略始终使用该固定手数。
- 当 `FixedVolume` 等于零时，策略按照以下步骤计算仓位：
  - 若权益低于 `InitialEquity`，使用合约的最小手数。
  - 若权益达到或超过阈值，从 `InitialStepVolume` 开始，并且每超过一个 `EquityStep` 增加 `VolumeStep` 手。
  - 计算结果会根据交易品种的最小/步进手数进行对齐。

## 风险管理

在 `OnStarted` 中调用 `StartProtection`，将止损与止盈点数自动转换为基于 `PriceStep` 的价格距离。将任一参数设为零即可关闭对应保护。

## 使用提示

- 原脚本针对小时级别设计。若选择更低周期，可能在同一小时内出现多根 K 线；策略仍会在持仓存在或挂单未清的情况下忽略新的信号。
- 若启用动态手数，请确保投资组合的权益数据 (`Portfolio.CurrentValue`) 可用。
- 需要订阅 `CandleType` 指定的 K 线数据以及一级行情以便发送市价单。

## 转换说明

- MQL 中基于魔术号的订单过滤被 `Position` 和 `ActiveOrders` 检查取代。
- 时间比较使用蜡烛的 `DateTimeOffset` 并调用 `.ToLocalTime()`，以保持与图表时区一致。
- 止损/止盈由 StockSharp 的 `StartProtection` 高级接口管理，省去手工下单。

