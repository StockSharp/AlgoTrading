# Стратегия Sniper Jaw

**Sniper Jaw Strategy** переносит советник MetaTrader 4 `SniperJawEA.mq4` на высокоуровневый API StockSharp. Система анализирует индикатор Аллигатор Билла Вильямса на медианной цене свечи. Сделка инициируется только тогда, когда три сглаженные скользящие средние (челюсть, зубы и губы) расположены в строгом бычьем или медвежьем порядке и одновременно движутся в ту же сторону, что и на предыдущей завершённой свече.

## Логика торговли

1. **Восстановление Аллигатора** – три индикатора `SmoothedMovingAverage` рассчитывают линии челюсти, зубов и губ по медиане свечи `(High + Low) / 2`. Каждая линия сдвигается вперёд на своё количество баров, чтобы повторить отображение в MetaTrader.
2. **Подтверждение тренда** – длинный сигнал появляется, когда выполнено условие `jaw < teeth < lips` и каждая линия выше, чем на предыдущей свече. Для короткого сигнала требуется `jaw > teeth > lips`, при этом все три линии должны снижаться относительно предыдущего бара.
3. **Управление входом** – стратегия удерживает только одну позицию. Если включён параметр `UseEntryToExit`, при появлении сигнала противоположного направления сначала закрывается текущая позиция, а новая заявка отправляется на следующем сигнале.
4. **Защитные выходы** – стоп-лосс и тейк-профит задаются в пунктах и пересчитываются через `PriceStep` инструмента. Открытые позиции проверяются на каждой завершённой свече и закрываются, как только цена достигает одного из уровней.
5. **Фильтр повторных сигналов** – оригинальный советник не допускал повторных входов в пределах одной свечи. Порт сохраняет время последнего сигнального бара и пропускает дополнительные заявки в течение той же свечи.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `OrderVolume` | `0.1` | Объём сделки в лотах или контрактах, передаваемый в `BuyMarket`/`SellMarket`. |
| `EnableTrading` | `true` | Главный переключатель: разрешает или запрещает новые входы, сохраняя контроль рисков. |
| `UseEntryToExit` | `true` | Закрывает текущую позицию перед подготовкой противоположного сигнала (аналог флага «Entry to Exit»). |
| `StopLossPips` | `20` | Расстояние защитного стопа от цены входа. Ноль отключает стоп. |
| `TakeProfitPips` | `50` | Расстояние тейк-профита от цены входа. Ноль отключает цель. |
| `MinimumBars` | `60` | Минимальное число завершённых свечей перед первой проверкой сигналов. |
| `JawPeriod` / `TeethPeriod` / `LipsPeriod` | `13 / 8 / 5` | Длины сглаженных скользящих средних Аллигатора. |
| `JawShift` / `TeethShift` / `LipsShift` | `8 / 5 / 3` | Сдвиг вперёд (в барах) для каждой линии, совпадает с настройками MetaTrader. |
| `CandleType` | `таймфрейм 1 час` | Основная серия свечей. Измените при необходимости, чтобы совпасть с графиком из MetaTrader. |

## Примечания по эксплуатации

- Обрабатываются только завершённые свечи (`CandleStates.Finished`), чтобы избегать частичных значений.
- Уровни стопа и цели отслеживаются внутри стратегии; при срабатывании отправляется рыночная заявка на закрытие позиции.
- Пересчёт пунктов учитывает стандарт форекс-инструментов: для 5- и 3-знаковых котировок один пункт равен десяти шагам цены.
- Для визуальной проверки подключите стратегию к схеме вместе с коннектором, портфелем и инструментом. В графической панели будут отображаться свечи и линии Аллигатора, что упрощает сравнение с шаблоном MetaTrader.
