# Стратегия XPeriod Candle System TM Plus

## Обзор

Стратегия представляет собой перенос эксперта MetaTrader `Exp_XPeriodCandleSystem_Tm_Plus` на платформу StockSharp. Исходная версия использует индикатор *XPeriod Candle System*, который сглаживает цены свечей и раскрашивает бары в зависимости от прорыва полос Боллинджера. Перевод воспроизводит ту же идею: экспоненциальное сглаживание OHLC-данных, поддержка всех режимов расчётных цен и работа по цветовым состояниям, дополненная временным фильтром и защитными приказами.

## Логика торговли

1. **Сглаженные свечи** – экспоненциальные скользящие средние с настраиваемой длиной формируют синтетические значения open/high/low/close.
2. **Выбор цены** – перед подачей в полосы Боллинджера можно выбрать одну из 12 формул (close, open, median, trend-following, Demark и др.).
3. **Полосы Боллинджера** – длина и ширина полос задаются параметрами, сигналы формируются только на завершённых значениях индикатора.
4. **Цвета** –
   - Бычащий бар выше верхней полосы → цвет `0` (прорыв вверх).
   - Медвежий бар ниже нижней полосы → цвет `4` (прорыв вниз).
   - Прочие бычьи бары → цвет `1`, прочие медвежьи → цвет `3`.
   - Дополнительное смещение `Deviation` (учитывает шаг цены) помогает избежать ложных сигналов.
5. **Входы** – анализируется свеча `SignalBar` и предыдущая:
   - Если предыдущая окрашена в `0`, а текущая не `0`, разрешается открывать длинную позицию (при включённом флаге `BuyPosOpen`).
   - Если предыдущая окрашена в `4`, а текущая не `4`, разрешается открывать короткую позицию (`SellPosOpen`).
6. **Выходы** –
   - Цвет `> 2` закрывает длинные позиции (`BuyPosClose`).
   - Цвет `< 2` закрывает короткие позиции (`SellPosClose`).
   - При активном `TimeTrade` позиции закрываются по истечении `HoldingMinutes` минут.
7. **Риск-менеджмент** – `StartProtection` активирует абсолютные стоп-лосс и тейк-профит. Нулевые значения отключают защитные приказы.

## Параметры

| Параметр | Назначение | Значение по умолчанию |
|----------|------------|-----------------------|
| `OrderVolume` | Базовый объём сделки. | 0.1 |
| `BuyPosOpen` / `SellPosOpen` | Разрешение на открытие длинных/коротких позиций. | `true` |
| `BuyPosClose` / `SellPosClose` | Разрешение на закрытие длинных/коротких позиций. | `true` |
| `TimeTrade` | Активация тайм-аута по времени удержания. | `true` |
| `HoldingMinutes` | Максимальное время удержания позиции в минутах. | 960 |
| `CandleType` | Тип свечей/таймфрейм для анализа. | 4 часа |
| `Period` | Длина экспоненциального сглаживания. | 5 |
| `BollingerLength` | Количество баров в окне полос Боллинджера. | 20 |
| `BandsDeviation` | Множитель ширины полос. | 1.001 |
| `AppliedPriceMode` | Формула расчётной цены для индикатора. | Close |
| `SignalBar` | Индекс бара для генерации сигналов (1 = последняя завершённая свеча). | 1 |
| `StopLoss` / `TakeProfit` | Абсолютные расстояния до стоп-лосса и тейк-профита. | 1000 / 2000 |
| `Deviation` | Дополнительное смещение для проверки прорыва. | 10 |

## Рекомендации

- Значение `Period` влияет на степень сглаживания: маленькие значения ближе к реальной цене, большие – подчёркивают тренд.
- `SignalBar` должен укладываться в доступную историю (хранится до 14 прошлых цветов). При превышении лимита сигналы игнорируются.
- Если у инструмента задан `PriceStep`, параметр `Deviation` автоматически переводится в денежное выражение через шаг цены.
- `StopLoss` и `TakeProfit` измеряются в абсолютных ценовых единицах; установите `0`, чтобы отключить защитные приказы.
- Python-реализация пока отсутствует, в каталоге размещена только C#-версия.
