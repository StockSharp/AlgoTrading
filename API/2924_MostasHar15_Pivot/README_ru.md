# Стратегия MostasHaR15 Pivot

## Общее описание
Стратегия переносит логику оригинального советника **MostasHaR15 Pivot** (MQL5) на высокоуровневый API StockSharp. Используются дневные уровни floor-pivot, индикатор ADX, разница двух EMA и гистограмма MACD (OsMA). Торговля ведётся по внутридневным свечам (по умолчанию 1 час), а для каждой новой свечи пересчитывается сетка из предыдущей завершённой дневной свечи.

## Логика торговли
- **Сетка pivot** – предыдущий дневной High/Low/Close формируют центральный уровень P, три сопротивления R1–R3, три поддержки S1–S3 и промежуточные уровни M0–M5. Текущая цена закрытия определяется относительно этих уровней, чтобы выбрать соответствующую поддержку и сопротивление. Сохранена особенность оригинального советника: диапазон между M5 и R3 сводится к паре уровней S3/M0.
- **Фильтр расстояния** – сделки допускаются только если расстояние до ближайшей цели больше `MinimumDistancePips` (14 пунктов по умолчанию), что соответствует условиям `dif1`/`dif2` в MQL-версии.
- **Условия для покупки**:
  - Основная линия ADX выше `AdxThreshold` (20), +DI растёт и находится выше –DI.
  - EMA(5) по ценам закрытия минимум на `EmaSlopePips` (5 пунктов) выше EMA(8) по ценам открытия; на предыдущей свече наблюдалась такая же бычья расстановка.
  - Гистограмма MACD (OsMA) растёт относительно предыдущей свечи.
- **Условия для продажи** зеркальны: доминирует –DI, EMA(8) по открытиям выше EMA(5) по закрытиям, гистограмма MACD снижается.
- Разрешён только один нетто-позиционный объём. Сделки открываются по рынку (`BuyMarket()` / `SellMarket()`).

## Управление позицией
- **Стоп-лосс** – опциональный, на расстоянии `StopLossPips` пунктов от цены входа. Значение `0` отключает стоп, как и в оригинале.
- **Тейк-профит** – фиксируется по ближайшей границе того pivot-диапазона, внутри которого находится цена входа.
- **Трейлинг-стоп** – полностью повторяет MQL-логику: после движения в нашу сторону более чем на `TrailingStopPips + TrailingStepPips` стоп подтягивается, сохраняя расстояние `TrailingStopPips`. Если `TrailingStopPips = 0`, трейлинг не используется.
- При достижении стопа/тейка в рамках свечи позиция закрывается в конце этой свечи.

## Параметры стратегии
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `CandleType` | Тип внутридневных свечей для торговли. | 1 час |
| `DailyCandleType` | Тип дневных свечей для расчёта pivot. | 1 день |
| `StopLossPips` | Размер стоп-лосса в пунктах (0 – без стопа). | 20 |
| `TrailingStopPips` | Расстояние трейлинг-стопа. | 5 |
| `TrailingStepPips` | Минимальный шаг для обновления трейлинг-стопа (при включении должен быть >0). | 5 |
| `MinimumDistancePips` | Минимальное расстояние до цели перед входом. | 14 |
| `EmaSlopePips` | Минимальный разрыв между EMA по закрытию и по открытию. | 5 |
| `AdxThreshold` | Пороговое значение ADX для сделок. | 20 |
| `AdxPeriod` | Период расчёта ADX. | 14 |
| `EmaClosePeriod` | Период EMA по ценам закрытия. | 5 |
| `EmaOpenPeriod` | Период EMA по ценам открытия. | 8 |
| `MacdFastPeriod` | Быстрая EMA в MACD. | 12 |
| `MacdSlowPeriod` | Медленная EMA в MACD. | 26 |
| `MacdSignalPeriod` | Сигнальная EMA в MACD. | 9 |

## Примечания к конверсии
- Специфическая логика диапазона M5–R3 сохранена для совпадения с результатами исходного советника.
- Все расчёты выполняются только на закрытых свечах, без хранения больших коллекций – состояние держится в полях класса согласно требованиям репозитория.
- Комментарии в коде оставлены на английском языке по инструкции.

## Рекомендации по использованию
- Подбирайте `CandleType` и `DailyCandleType` под доступные интервалы вашего инструмента.
- Поскольку управление позицией происходит на закрытии свечи, в быстрых рынках возможна дополнительная просадка из-за задержки по сравнению с тиковым исполнением в MT5.
