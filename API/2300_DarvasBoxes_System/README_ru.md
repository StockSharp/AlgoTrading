# Стратегия Darvas Boxes System

## Обзор

Стратегия реализует пробойный подход на основе классической концепции **Darvas Boxes**. Для построения динамического ценового диапазона используется индикатор **Donchian Channels**. При закрытии цены выше верхней границы коробки открывается длинная позиция. При закрытии ниже нижней границы открывается короткая позиция. Дополнительно поддерживаются уровни стоп-лосса и тейк-профита для управления рисками.

## Как это работает

1. Для каждой свечи индикатор Donchian Channels рассчитывает верхнюю и нижнюю границы на основе параметра `BoxPeriod`.
2. Стратегия отслеживает предыдущие значения границ для обнаружения пробоя.
3. Если текущая цена закрытия пересекает сверху предыдущую верхнюю границу:
   - Закрывается открытая короткая позиция (если разрешено).
   - Открывается длинная позиция (если разрешено).
4. Если текущая цена закрытия пересекает снизу предыдущую нижнюю границу:
   - Закрывается открытая длинная позиция (если разрешено).
   - Открывается короткая позиция (если разрешено).
5. Открытые позиции контролируются на предмет достижения стоп-лосса или тейк-профита.

## Параметры

- **BoxPeriod** (`int`): Количество свечей для расчёта коробки. По умолчанию 20.
- **StopLoss** (`decimal`): Расстояние от цены входа до уровня стоп-лосса. По умолчанию 1000.
- **TakeProfit** (`decimal`): Расстояние от цены входа до уровня тейк-профита. По умолчанию 2000.
- **AllowBuyEntry** (`bool`): Разрешить открытие длинных позиций. По умолчанию `true`.
- **AllowSellEntry** (`bool`): Разрешить открытие коротких позиций. По умолчанию `true`.
- **AllowBuyExit** (`bool`): Разрешить закрытие длинных позиций по обратному сигналу или риску. По умолчанию `true`.
- **AllowSellExit** (`bool`): Разрешить закрытие коротких позиций по обратному сигналу или риску. По умолчанию `true`.
- **CandleType** (`DataType`): Тип свечей, используемых в расчётах. По умолчанию 4-часовые свечи.

## Использование

1. Подключите стратегию к инструменту и настройте параметры.
2. Запустите стратегию. Она подпишется на нужную серию свечей и начнёт обработку данных.
3. Сделки выполняются рыночными ордерами при выполнении условий пробоя.
4. Стоп-лосс и тейк-профит контролируют открытые позиции.

## Примечания

- Используется высокоуровневый API с методом `BindEx` для получения значений индикатора.
- Внутренние коллекции не используются; все расчёты основаны на передаваемых значениях.
- Обрабатываются только завершённые свечи для надёжных сигналов.
- Комментарии в коде приведены на английском языке, как требуется.

