# Color PEMA Envelopes Digit System
[English](README.md) | [中文](README_cn.md)

**Color PEMA Envelopes Digit System** — это перенос на StockSharp эксперта
`Exp_Color_PEMA_Envelopes_Digit_System.mq5`. Стратегия анализирует цветовые коды
индикатора Color PEMA Envelopes: когда свеча закрывается выше/ниже канала,
индикатор меняет цвет. После возврата цены внутрь канала открывается сделка
в сторону первоначального пробоя.

## Как это работает
1. Рассчитывается восьмиступенчатый Polynomial EMA (PEMA) с дробной длиной, как в оригинальном индикаторе. Значение округляется с учётом параметра `Digit` и смещается на `PriceShift`.
2. Вокруг PEMA строятся верхняя и нижняя оболочки через процентное отклонение `DeviationPercent`.
3. Каждая закрытая свеча получает цветовой код в зависимости от положения относительно смещённых оболочек:
   - `4`/`3`: закрытие выше верхней границы (бычье/медвежье тело).
   - `1`/`0`: закрытие ниже нижней границы (бычье/медвежье тело).
   - `2`: цена находится внутри канала.
4. Стратегия читает цвет `SignalBar + 1` свечи (аналог вызова `CopyBuffer` в MQL5) и сравнивает его с цветом `SignalBar` свечи.
5. Если более старая свеча показала пробой вверх, а следующая вернулась в канал, разрешается вход в лонг (если включено) и закрывается шорт. Для коротких позиций применяется зеркальная логика.
6. Управление стоп-лоссом и тейк-профитом выполняется через модуль защиты StockSharp.

## Параметры
- `CandleType` – используемый таймфрейм.
- `TradeVolume` – объём рыночных ордеров.
- `EmaLength` – дробная длина каждого уровня EMA в PEMA.
- `AppliedPrices` – источник цены (close, open, median, weighted, trend-follow, DeMark и т.д.).
- `DeviationPercent` – процентное отклонение для построения оболочек.
- `Shift` – количество свечей для смещения сравнения с каналом.
- `PriceShift` – дополнительное абсолютное смещение PEMA.
- `Digit` – количество добавочных знаков при округлении PEMA.
- `SignalBar` – на сколько свечей назад смотреть текущий цвет (цвет `SignalBar + 1` используется как «предыдущий»).
- `AllowBuyOpen` / `AllowSellOpen` – разрешить открытие длинных/коротких позиций.
- `AllowBuyClose` / `AllowSellClose` – разрешить закрытие длинных/коротких позиций по встречному сигналу.
- `StopLossPoints` – расстояние стоп-лосса в пунктах (умножается на `PriceStep`).
- `TakeProfitPoints` – расстояние тейк-профита в пунктах.

## Значения по умолчанию
- `CandleType = TimeSpan.FromHours(4).TimeFrame()`
- `TradeVolume = 1m`
- `EmaLength = 50.01m`
- `AppliedPrices = AppliedPrices.Close`
- `DeviationPercent = 0.1m`
- `Shift = 1`
- `PriceShift = 0m`
- `Digit = 2`
- `SignalBar = 1`
- `AllowBuyOpen = true`
- `AllowSellOpen = true`
- `AllowBuyClose = true`
- `AllowSellClose = true`
- `StopLossPoints = 1000m`
- `TakeProfitPoints = 2000m`

## Фильтры
- **Категория**: Пробой / Возврат в канал
- **Направление**: Лонг и Шорт
- **Индикаторы**: Полиномиальные EMA-оболочки
- **Стопы**: Да (стоп и тейк в пунктах)
- **Таймфрейм**: Свинг (по умолчанию 4H)
- **Риск**: Средний — сделки возникают только после возврата цены из экстремума
- **Сезонность**: Нет
- **Нейросети**: Нет
- **Дивергенции**: Нет
