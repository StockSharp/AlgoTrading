# Стратегия Mean Reversion Momentum

## Обзор
Стратегия Mean Reversion — порт эксперта MetaTrader *Mean reversion.mq4*. В версии для StockSharp сохранена исходная идея: покупки выполняются после серии понижающихся закрытий, продажи — после последовательного роста. Сигналы подтверждаются сочетанием двух линейно-взвешенных средних, импульсом на старшем таймфрейме и месячным MACD.

После входа стратегия повторяет правила управления позицией из оригинала: стоп-лосс и тейк-профит в пунктах, опциональный перевод в безубыток и трейлинг-стоп, фиксирующий прибыль по мере движения цены.

## Торговая логика
1. **Рабочий таймфрейм** — выбираемый ряд свечей (по умолчанию 15 минут).
2. **Поиск истощения** — анализируется `BarsToCount` последних закрытий. Для покупки требуется, чтобы текущее закрытие было ниже каждого из предыдущих; для продажи — выше.
3. **Фильтр тренда** — быстрая LWMA (`FastMaLength`) должна быть выше медленной (`SlowMaLength`) для лонга и ниже — для шорта.
4. **Импульсный фильтр** — индикатор Momentum (`MomentumLength`) считается на «метатрейдеровском» старшем таймфрейме (M15 → H1, H1 → D1 и т.д.). Минимум одно из трёх последних значений должно отклоняться от 100 больше, чем `MomentumThreshold`.
5. **Подтверждение MACD** — месячный MACD (12/26/9) обязан иметь основную линию выше сигнальной для покупок и ниже — для продаж.

При выполнении условий открывается позиция объёмом `OrderVolume`. Обратный сигнал закрывает текущую позицию перед разворотом.

## Управление позицией
- **Стоп-лосс и тейк-профит** — задаются в пунктах параметрами `StopLossPips` и `TakeProfitPips`.
- **Безубыток** — при активации стоп переносится к цене входа плюс `BreakEvenOffsetPips`, как только прибыль превысит `BreakEvenTriggerPips`.
- **Трейлинг-стоп** — если `EnableTrailing = true` и прибыль превышает `TrailingStopPips`, стоп сопровождает цену с шагом `TrailingStepPips`.

Расчёт пунктов выполняется исходя из шага цены инструмента, как в MetaTrader.

## Параметры
| Название | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `OrderVolume` | Объём рыночных заявок. | `1` |
| `CandleType` | Основной ряд свечей. | `M15` |
| `BarsToCount` | Количество закрытий для проверки истощения. | `10` |
| `FastMaLength` | Период быстрой LWMA. | `6` |
| `SlowMaLength` | Период медленной LWMA. | `85` |
| `MomentumLength` | Период Momentum на старшем таймфрейме. | `14` |
| `MomentumThreshold` | Минимальное отклонение Momentum от 100. | `0.3` |
| `StopLossPips` | Размер стоп-лосса в пунктах. | `20` |
| `TakeProfitPips` | Размер тейк-профита в пунктах. | `50` |
| `UseBreakEven` | Включение переноса стопа в безубыток. | `false` |
| `BreakEvenTriggerPips` | Прибыль для активации безубытка. | `30` |
| `BreakEvenOffsetPips` | Дополнительный запас при переносе стопа. | `30` |
| `EnableTrailing` | Включение трейлинг-стопа. | `true` |
| `TrailingStopPips` | Прибыль для запуска трейлинга. | `40` |
| `TrailingStepPips` | Дистанция трейлинг-стопа. | `40` |

## Примечания
- Старший таймфрейм для Momentum копирует шаги MetaTrader: M1→M15, M5→M30, M15→H1, M30→H4, H1→D1, H4→W1, D1→MN1, W1→MN1.
- MACD всегда рассчитывается на месячном таймфрейме (MN1).
- Стратегия требует свечных таймфреймов; тиковые и диапазонные бары не поддерживаются.
