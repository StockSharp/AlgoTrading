# Myfriend Forex Instruments 策略

**Myfriend Forex Instruments** 策略复刻了 2006 年的 MetaTrader "MyFriend" 智能交易系统。策略默认在 EUR/USD 30 分钟周期上运行，通过结合上一交易日的枢轴位、Donchian 通道扩张以及 3/9 周期收盘价动量差来寻找入场机会。当价格强势穿越枢轴位或 Donchian 通道突然放宽，并且方向与动量偏差一致时，系统会开出唯一的一笔订单，并立即设定保护性止损与止盈。

## 交易流程

1. **日内枢轴图**：使用前一日的最高价、最低价和收盘价计算经典的枢轴点（`Pivot`、`R1`、`S1`）。这些水平在当日保持不变，界定了预期的波动区间。
2. **动量脉冲**：分别对收盘价计算 3 与 9 周期简单移动平均，将它们的差值乘以 1000（与原始指标一致），判断多空力量孰强孰弱。
3. **突破过滤器**：
   - *枢轴冲击*：若上一根蜡烛实体超过 12 点并穿越枢轴，同时当前蜡烛收盘延续突破方向，则触发信号。
   - *Donchian 扩张*：当 16 周期 Donchian 通道宽度突破 `R1 - S1` 的范围且价格配合方向移动时，同样触发信号。
4. **订单管理**：始终只保留一个持仓。做多时将止损设置在前一根蜡烛的最低价减去缓冲，止盈固定为 70 点；做空时使用对称逻辑。
5. **离场规则**：
   - *时间窗口出场*：进场后的第 3 到第 4 根蜡烛之间，如果上一根收盘价逆向移动超过 3 点，则提前平仓。
   - *移动止损*：当浮盈超过 5 点且 Donchian 边界继续向有利方向移动时，将止损沿通道加减 1 点缓冲跟踪。
   - *硬性目标*：价格触及设定的止损或止盈时立即平仓。

## 参数

| 参数 | 说明 | 默认值 |
| ---- | ---- | ------ |
| `BaseVolume` | 每次开仓使用的合约数量。 | `1` |
| `TakeProfitPoints` | 止盈距离（以 MetaTrader 点为单位）。 | `70` |
| `StopLossBufferPoints` | 在前一根蜡烛极值之外附加的止损缓冲。 | `13` |
| `ChannelPeriod` | Donchian 通道周期，用于宽度检测与移动止损。 | `16` |
| `UseTrailingStop` | 是否启用 Donchian 移动止损。 | `true` |
| `TrailingStartPoints` | 启用移动止损前所需的最小浮盈（点）。 | `5` |
| `TrailingBufferPoints` | 沿 Donchian 边界移动止损时使用的点数缓冲。 | `1` |
| `UseTimeClose` | 是否启用 3–4 根蜡烛的时间出场规则。 | `true` |
| `CandleType` | 主图周期（默认 30 分钟）。 | `M30` |
| `DailyCandleType` | 计算枢轴时使用的日线周期。 | `D1` |

## 注意事项

- 策略为 EUR/USD 和 30 分钟周期量身打造，其他品种或周期可能需要重新调参。
- 所有以“点”表示的参数都会乘以标的的 `PriceStep`。若行情源未提供 `PriceStep`，则退化为 1 个价格单位。
- 仅处理已收盘的蜡烛，与原版 MetaTrader 专家的行为保持一致。
