# Стратегия Myfriend Forex Instruments

**Myfriend Forex Instruments** — это точная адаптация советника MetaTrader «MyFriend» (2006 года). Стратегия рассчитана на EUR/USD и таймфрейм M30. Она сочетает прошлодневные pivot-уровни, расширение канала Donchian и расхождение между короткой и длинной скользящими средними по закрытиям. Сигнал появляется, когда свеча мощно пробивает pivot или когда диапазон Donchian резко увеличивается и совпадает с направлением импульса. В этот момент открывается единственная позиция с заранее установленными защитными уровнями.

## Логика торговли

1. **Карта дневных pivot-уровней.** Максимум, минимум и закрытие предыдущего дня образуют уровни `Pivot`, `R1`, `S1`. Они фиксируются на всю торговую сессию и задают ориентиры для цены.
2. **Импульсная оценка.** Две SMA по закрытиям (3 и 9 периодов) формируют спред, умножаемый на 1000 — точная копия показателя `MP` в MetaTrader. Знак спреда показывает, какая сторона рынка доминирует.
3. **Фильтры пробоя.**
   - *Рывок через pivot*: если свеча пересекает pivot с телом более 12 пунктов и следующая свеча закрывается в том же направлении, формируется сигнал.
   - *Расширение Donchian*: когда 16-периодный канал шире диапазона `R1 - S1`, а цена движется в сторону расширения, сигнал подтверждается.
4. **Управление ордерами.** В рынке допускается только одна позиция. Для покупок стоп ставится под минимум предыдущей свечи минус буфер, тейк — фиксированные 70 пунктов. Продажи симметричны.
5. **Выход из позиции.**
   - *Временное окно*: между третьей и четвёртой свечами после входа, если предыдущая свеча сдвигается против позиции на 3 пункта, сделка закрывается досрочно.
   - *Трейлинг по Donchian*: при профите более 5 пунктов и продолжающемся движении границы канала стоп подтягивается к Donchian с буфером в 1 пункт.
   - *Жёсткие цели*: достижение стопа или тейка немедленно закрывает сделку.

## Параметры

| Параметр | Описание | Значение по умолчанию |
| -------- | -------- | --------------------- |
| `BaseVolume` | Объём ордера для новой позиции. | `1` |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах MetaTrader. | `70` |
| `StopLossBufferPoints` | Буфер к экстремуму предыдущей свечи для стоп-лосса. | `13` |
| `ChannelPeriod` | Период канала Donchian для сигналов и трейлинга. | `16` |
| `UseTrailingStop` | Включает трейлинг-стоп по каналу Donchian. | `true` |
| `TrailingStartPoints` | Минимальный профит (в пунктах) для активации трейлинга. | `5` |
| `TrailingBufferPoints` | Буфер (в пунктах) при переносе стопа вдоль канала. | `1` |
| `UseTimeClose` | Активирует выход в окне 3–4 свечи. | `true` |
| `CandleType` | Основной таймфрейм (по умолчанию M30). | `M30` |
| `DailyCandleType` | Дневной таймфрейм для пересчёта pivot-уровней. | `D1` |

## Дополнительно

- Стратегия ориентирована на EUR/USD и M30. Для других инструментов параметры следует адаптировать.
- Все точечные значения умножаются на `PriceStep` инструмента. Если поставщик данных не задаёт шаг цены, используется единичный шаг.
- Обработка ведётся только по завершённым свечам, что сохраняет поведение исходного советника.
