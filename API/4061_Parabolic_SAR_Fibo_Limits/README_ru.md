# Parabolic SAR Fibo Limits

## Обзор
Parabolic SAR Fibo Limits — порт стратегии MetaTrader 4 `FT_0tk80i9uw4ep_Parabolic` на платформу StockSharp. Исходный эксперт сочетает две версии индикатора Parabolic SAR и уровни Фибоначчи, чтобы выставлять лимитные заявки в точках отката. Реализация на C# сохраняет поэтапную постановку заявок, встроенную защиту (перенос в безубыток и трейлинг-стоп) и опциональный фильтр торговой сессии, поэтому при работе на закрытых свечах поведение соответствует оригинальному советнику.

## Логика стратегии
### Подготовка сигналов
* **Согласование двух Parabolic SAR** — на выбранном таймфрейме рассчитываются быстрый и медленный SAR. Быстрая кривая служит ранним предупреждением, медленная подтверждает смену состояния. Если быстрый SAR поднимается выше цены, пока медленный остается ниже, формируется потенциальная длинная настройка. Если быстрый SAR уходит ниже цены, а медленный выше, формируется короткая настройка. Как только медленный SAR пересекает цену, соответствующая настройка сбрасывается.
* **Поиск свингов** — стратегия использует максимум и минимум за окно длиной `Bar Search`, что воспроизводит вспомогательную функцию `MaximumMinimum` из EA. Противоположный экстремум (`High[1]` или `Low[1]`) берётся из предыдущей завершённой свечи и служит базой для расчёта уровней Фибоначчи.

### Постановка и сопровождение заявок
* **Лимитные заявки по Фибоначчи** — когда обе кривые SAR оказываются по одну сторону от цены и настройка активирована, стратегия выставляет лимитную заявку на уровне 50% (`Entry Fibonacci %`) от найденного свинга. Защитный стоп размещается на заданное количество пунктов дальше экстремума, а тейк-профит — на расширении Фибоначчи (`Target Fibonacci %`). Заявка регистрируется только в том случае, если текущая цена, будущий стоп и цель находятся минимум в пяти шагах цены друг от друга, что повторяет фильтр `Point*5` в MT4.
* **Автоматическое снятие заявок** — если быстрый SAR возвращается на другую сторону от цены, активная лимитка по соответствующему направлению отменяется, чтобы не войти в рынок поздно. Исполнение лимитки автоматически отменяет противоположную отложенную заявку.

### Управление рисками
* **Начальные стоп и цель** — после исполнения лимитки стратегия закрепляет рассчитанные уровни стоп-лосса и тейк-профита, имитируя параметры SL/TP исходного эксперта.
* **Переход в безубыток** — при ненулевом параметре `Break Even (points)` стоп переносится к цене входа (плюс или минус один шаг цены) после набора указанного количества пунктов прибыли, что соответствует функции BBU.
* **Трейлинг-стоп** — если включён параметр `Trailing Stop (points)`, стоп следует за ценой на фиксированном расстоянии. Обновление выполняется только при улучшении прежнего стопа минимум на `Trailing Step (points)`, аналогично `TrailingShag` в MT4.
* **Принудительное закрытие** — при касании рассчитанного стопа или цели на закрытой свече позиция закрывается рыночной заявкой, тем самым эмулируя автоматическое исполнение в MetaTrader.

### Фильтр торговой сессии
* **Опциональное ограничение по времени** — параметр `Use Time Filter` разрешает открывать новые сделки только между `Start Hour` и `Stop Hour` (включительно) во времени площадки. Защитные механизмы (безубыток, трейлинг, выходы) продолжают работать и вне торгового окна, как и в MQL-версии.

## Параметры
* **Use Time Filter** — включение фильтра торговой сессии.
* **Start Hour / Stop Hour** — границы торгового окна при активном фильтре.
* **Fast SAR Step / Fast SAR Max** — коэффициент ускорения и его максимум для быстрого Parabolic SAR.
* **Slow SAR Step / Slow SAR Max** — коэффициент ускорения и его максимум для медленного Parabolic SAR.
* **Bar Search** — количество свечей, используемых при поиске свинговых максимумов/минимумов.
* **Offset (points)** — отступ в пунктах за пределы экстремума при расчёте стоп-лосса.
* **Entry Fibonacci %** — процент Фибоначчи для цены лимитной заявки.
* **Target Fibonacci %** — процент Фибоначчи для расчёта тейк-профита.
* **Break Even (points)** — прибыль в пунктах, после которой стоп переносится в безубыток (± один шаг). Значение `0` отключает функцию.
* **Trailing Stop (points)** — дистанция между ценой и трейлинг-стопом. Значение `0` отключает трейлинг.
* **Trailing Step (points)** — минимальное улучшение (в пунктах) перед очередным сдвигом трейлинг-стопа.
* **Candle Type** — таймфрейм, используемый для расчёта индикаторов и свингов.
* **Volume** — базовый объём заявок, наследуемый от класса `Strategy` (по умолчанию `0.1`).

## Дополнительные сведения
* Все параметры, выраженные в пунктах, автоматически переводятся в денежные величины через шаг цены инструмента, поэтому значения из MT4 можно применять без перерасчёта.
* Стратегия обрабатывает только завершённые свечи выбранного таймфрейма, полностью повторяя баровое исполнение оригинального эксперта.
* Python-реализация отсутствует, доступна только C# версия в составе каталога API.
