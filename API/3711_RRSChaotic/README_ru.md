# Стратегия RRS Chaotic

## Обзор
Оригинальный **RRS Chaotic EA** каждую секунду бросает «кубик», выбирая случайный инструмент и размер лота, после чего открывает рыночные сделки. В версии StockSharp сохранена концепция управляемого хаоса: торговые сигналы формируются по завершённым свечам выбранного актива, а направление и объём сделки определяются случайно. Дополнительно реализованы все ключевые правила управления капиталом из MQL4-версии.

## Ключевые особенности
- **Случайные входы.** По закрытию каждой свечи генерируется число от 0 до 10. Значения `6` или `9` приводят к покупке, `3` или `8` — к продаже, что полностью повторяет логику MT4.
- **Переменный объём.** Лот выбирается равномерно в диапазоне *MinVolume*…*MaxVolume* и приводится к шагу объёма инструмента.
- **Фильтр спреда.** Новые сделки блокируются, если текущий спред (в пунктах) превышает *MaxSpreadPoints*.
- **Стоп-лосс и тейк-профит.** Точечные уровни позволяют эмулировать параметры `StopLoss` и `TakeProfit` исходного эксперта.
- **Контроль просадки.** Нереализованная прибыль/убыток сравнивается с установленным денежным лимитом или процентом от баланса. При превышении лимита позиции закрываются и активные заявки отменяются.

## Параметры
| Параметр | Описание |
|----------|----------|
| `CandleType` | Таймфрейм свечей, по которым принимаются решения (по умолчанию 1 минута). |
| `MinVolume` / `MaxVolume` | Диапазон случайного объёма сделки. |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах. Ноль отключает цель. |
| `StopLossPoints` | Дистанция стоп-лосса в пунктах. Ноль отключает защиту. |
| `MaxOpenTrades` | Максимальное чистое число объёмных шагов, допускаемое в рынке одновременно. |
| `MaxSpreadPoints` | Допустимый спред в пунктах. |
| `SlippagePoints` | Информационный параметр проскальзывания, сохранён для совместимости. |
| `RiskControlMode` | Режим контроля риска: фиксированная сумма либо процент от капитала. |
| `RiskValue` | Сумма или процент просадки в зависимости от выбранного режима. |
| `TradeComment` | Комментарий, добавляемый к заявкам для удобства отслеживания. |

## Логика работы
1. Подписаться на выбранные свечи и ждать их закрытия.
2. Проверить соблюдение лимитов просадки. При превышении лимита отменить активные заявки и закрыть позицию.
3. Обновить целевые уровни стоп-лосса и тейк-профита, соответствующие параметрам MT4.
4. Если торговля разрешена и спред не превышает порог, сгенерировать случайное число и решить, открывать ли длинную или короткую позицию.
5. Ограничить совокупную экспозицию, не допуская превышения `MaxOpenTrades` по количеству шагов объёма.

## Отличия от версии MT4
- В MT4 советник случайным образом выбирал разные символы. В StockSharp стратегия работает с одним инструментом, случайность применяется только к направлению и объёму.
- Защитные уровни реализованы через рыночные заявки по факту закрытия свечи, а не через параметры ордеров `StopLoss`/`TakeProfit`.
- Для оценки спреда используется актуальный бид/аск вместо функции `MarketInfo`.
- Каждая заявка содержит текст *TradeComment*, что выступает аналогом MT4-комментариев и Magic Number.

## Рекомендации
- Убедитесь, что у инструмента корректно заполнены `PriceStep`, `MinStep` и `VolumeStep`, иначе расчёт пунктов будет некорректным.
- Таймфрейм по умолчанию — одна минута, что даёт эффект случайных входов без перегрузки тестов. При необходимости увеличьте интервал.
- Контроль риска рассчитан на суммарную позицию. Одновременное удержание разнонаправленных сделок, как в MT4, платформой StockSharp не поддерживается и приводит к неттингу.
