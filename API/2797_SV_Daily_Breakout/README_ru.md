# Стратегия SV Daily Breakout

## Обзор
**SV Daily Breakout** — точная конверсия советника MetaTrader 5 «SV v.4.2.5» на C#. Стратегия анализирует рынок после закрытия каждой свечи и допускает не более одной сделки в сутки. Входы разрешены только после наступления заданного времени. Алгоритм пропускает последние `Shift` баров, затем рассматривает следующие `Interval` баров и сравнивает их экстремумы с двумя сглаженными скользящими средними, чтобы определить глубину отклонения цены от средних значений.

## Правила торговли
### Условия входа
- **Дневной фильтр** — пока серверное время меньше *Start Hour*/*Start Minute*, сигналы игнорируются. В течение дня возможен только один вход.
- **Окно анализа** — из расчёта исключаются `Shift` последних баров, а для следующих `Interval` баров определяется максимум и минимум.
- **Покупка** — если максимум анализируемого диапазона находится ниже медленной MA, а минимум — ниже быстрой MA, стратегия закрывает шорты и открывает длинную позицию.
- **Продажа** — если минимум диапазона выше медленной MA, а максимум — выше быстрой MA, закрываются лонги и открывается короткая позиция.

### Управление позицией
- **Стоп-лосс** — задаётся на расстоянии `Stop Loss (pips)` от цены входа. При достижении уровня позиция закрывается.
- **Тейк-профит** — фиксируется на расстоянии `Take Profit (pips)` от цены входа. Достижение уровня приводит к фиксации прибыли.
- **Трейлинг-стоп** — активируется, если заданы ненулевые `Trailing Stop` и `Trailing Step`. Для лонга стоп переносится на уровень `Close − Trailing Stop`, когда прибыль превышает `Trailing Stop + Trailing Step`. Для шорта логика зеркальная.
- **Суточный запрет** — после закрытия сделки в текущие сутки новых входов не будет.

### Расчёт объёма
- **Ручной режим** — при `Use Manual Volume = true` используется фиксированный объём *Volume* (корректируется под шаг объёма инструмента).
- **Режим по риску** — при `Use Manual Volume = false` объём рассчитывается по формуле риска `Risk %`. Берётся доля капитала, делится на денежную стоимость стоп-лосса с учётом шага цены и шага стоимости шага.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| Use Manual Volume | `false` | Использовать фиксированный объём вместо расчёта по риску. |
| Volume | `0.1` | Объём сделки в ручном режиме. |
| Risk % | `5` | Процент капитала, выделяемый на одну сделку. |
| Stop Loss (pips) | `50` | Размер стоп-лосса в пунктах (0 — отключено). |
| Take Profit (pips) | `50` | Размер тейк-профита в пунктах (0 — отключено). |
| Trailing Stop (pips) | `5` | Размер трейлинг-стопа в пунктах. Требует ненулевого `Trailing Step`. |
| Trailing Step (pips) | `5` | Минимальное приращение прибыли для сдвига трейлинг-стопа. |
| Start Hour | `19` | Час начала поиска сигналов (время биржи). |
| Start Minute | `0` | Минута начала поиска сигналов (время биржи). |
| Shift | `6` | Число последних баров, которые исключаются из расчёта диапазона. |
| Interval | `27` | Число баров, по которым вычисляются максимум и минимум. |
| Fast MA Period | `14` | Период быстрой скользящей средней. |
| Fast MA Shift | `0` | Горизонтальный сдвиг значения быстрой MA (в барах). |
| Fast MA Method | `Smma` | Метод расчёта быстрой MA. |
| Fast Applied Price | `Median` | Тип цены для быстрой MA. |
| Slow MA Period | `41` | Период медленной скользящей средней. |
| Slow MA Shift | `0` | Горизонтальный сдвиг значения медленной MA (в барах). |
| Slow MA Method | `Smma` | Метод расчёта медленной MA. |
| Slow Applied Price | `Median` | Тип цены для медленной MA. |
| Candle Type | `1 hour` | Используемый таймфрейм свечей. |

## Дополнительная информация
- Алгоритм полностью сохраняет идею оригинального советника — анализ диапазона после задержки на `Shift` баров позволяет фильтровать последние всплески волатильности.
- Трейлинг-стоп обновляется по цене закрытия свечи, что имитирует тиковую логику MetaTrader. При необходимости скорректируйте параметры под специфику инструмента.
- Для корректного расчёта объёма в режиме риска заполните у инструмента поля `PriceStep`, `StepPrice` и `VolumeStep`.
- Метод `StartProtection()` уже вызван, поэтому можно дополнять стратегию стандартными средствами риск-менеджмента StockSharp.
- Чтобы результаты совпадали с версией MetaTrader, используйте одинаковый часовой пояс сервера для данных и торгового счёта, на который ориентированы параметры *Start Hour* и *Start Minute*.
