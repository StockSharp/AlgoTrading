# Channel EA Limits 策略

## 概述
- **来源**：由 MetaTrader 5 专家顾问 `ChannelEA1.mq5` 转换而来。
- **目标**：在两个用户定义的交易时段之间监控日内价格通道，并在时段结束时挂出通道边界的限价单。
- **方法**：在会话期间持续记录最高价和最低价，结束时根据该区间同时布置买入和卖出限价单，以捕捉价格回到区间另一端的机会。

该策略适合日内存在均值回归特征的品种。设计为净额账户工作方式：`SellLimit` 成交时会先平掉现有多头，再开出新的空头，反之亦然。

## 参数
| 参数 | 默认值 | 说明 |
| --- | --- | --- |
| `BeginHour` | `1` | 开始统计区间的小时（0-23）。达到该时间时会取消所有挂单并平掉头寸。 |
| `EndHour` | `10` | 结束统计区间的小时（0-23）。此时根据累计的价格区间挂出新的限价单。若 `BeginHour > EndHour` 则区间跨越午夜。 |
| `OrderVolume` | `1` | 每个限价单的下单量。 |
| `CandleType` | 1 小时 K 线 | 构建通道所使用的 K 线类型，可根据需要调整为其他周期。 |

## 交易逻辑
1. **会话处理**
   - 根据 `BeginHour` 和 `EndHour` 结合 K 线时间计算出当前会话的起止时间；当开始时间晚于结束时间时，结束时间会顺延到下一天。
   - 当第一根收盘时间达到起始边界的 K 线完成时，策略会取消所有挂单、平掉当前头寸，并重置统计数据。
2. **区间构建**
   - 只有开盘时间落在会话窗口内的 K 线才会参与统计。策略维护区间内的最高价、最低价以及 K 线数量。
   - 至少需要两根完成的 K 线才能认定区间有效，这与原始 MQL5 策略中的 `n > 2` 条件保持一致。
3. **会话结束时下单**
   - 当某根完成的 K 线跨越结束边界时，若区间已形成且最低价小于最高价，就会挂出两张限价单：
     - 在记录的会话最低价挂 `BuyLimit`，数量为 `OrderVolume`。
     - 在记录的会话最高价挂 `SellLimit`，数量相同。
   - 这些挂单会一直保留到下一次会话开始。由于采用净额账户模型，这些限价单既是潜在的入场点，也是已有头寸的止盈点。
4. **准备下一会话**
   - 到达下一次开始时间时，策略会清理未成交挂单、平掉剩余头寸，然后重新开始计算新的日内通道。

## 补充说明
- 策略没有内置止损，风险控制需通过下单量、外部保护或人工干预实现。
- 仅处理状态为 `CandleStates.Finished` 的 K 线，以忠实复现原始 EA 的行为。
- 请确认行情源的时区与预期一致，因为会话边界基于交易所/数据源时间来计算。
- 在进行参数优化时，需要同时考虑交易时间窗口与 K 线周期，二者共同决定区间的宽度。
