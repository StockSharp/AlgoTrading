# Стратегия Channel EA Limits

## Общее описание
- **Происхождение**: конвертация эксперта MetaTrader 5 `ChannelEA1.mq5`.
- **Задача**: отслеживать внутридневной ценовой канал между двумя заданными часами и выставлять лимитные заявки на границах канала по завершении сессии.
- **Подход**: стратегия фиксирует экстремальные значения (максимум и минимум) за выбранное торговое окно и размещает симметричные лимитные ордера, рассчитывая на возврат цены к противоположной границе диапазона.

Подходит для инструментов с выраженной среднерыночной динамикой внутри дня. Работает в режиме неттинга: исполненный `SellLimit` закроет текущую длинную позицию до открытия новой короткой и наоборот.

## Параметры
| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `BeginHour` | `1` | Час (0-23), когда начинается построение диапазона. В этот момент стратегия снимает все активные заявки и закрывает позицию. |
| `EndHour` | `10` | Час (0-23), когда диапазон фиксируется и выставляются новые лимитные заявки. Поддерживается ночная сессия: если `BeginHour > EndHour`, диапазон пересекает полуночь. |
| `OrderVolume` | `1` | Объём для каждой лимитной заявки. |
| `CandleType` | таймфрейм 1 час | Тип свечей, используемых для построения канала. Можно выбрать любой доступный таймфрейм StockSharp. |

## Логика торговли
1. **Управление сессией**
   - Временные границы рассчитываются по параметрам `BeginHour` и `EndHour` на основе времени свечей. Если `BeginHour > EndHour`, конец сессии переносится на следующий день.
   - При первой завершённой свече, время закрытия которой достигает стартовой границы, стратегия отменяет все активные заявки, закрывает текущую позицию и обнуляет статистику диапазона.
2. **Построение канала**
   - В расчёт попадают только свечи, чьё время открытия лежит внутри сессии. Поддерживаются накопительные значения максимума и минимума, а также счётчик свечей.
   - Для формирования канала требуется минимум две завершённые свечи — как и в оригинальном советнике (условие `n > 2`).
3. **Выставление заявок в конце сессии**
   - Когда завершённая свеча пересекает конечную границу, стратегия проверяет, что диапазон сформирован и минимум строго меньше максимума.
   - Затем размещаются две лимитные заявки:
     - `BuyLimit` по зафиксированному минимуму с объёмом `OrderVolume`.
     - `SellLimit` по зафиксированному максимуму с тем же объёмом.
   - Заявки остаются активными до следующего открытия сессии. В режиме неттинга они работают как точки входа и выхода: `SellLimit` закроет открытую длинную позицию на уровне максимума, прежде чем открыть новую короткую.
4. **Подготовка к следующей сессии**
   - В момент следующей стартовой границы стратегия закрывает все позиции, отменяет оставшиеся заявки и начинает построение нового диапазона.

## Дополнительные замечания
- Стоп-лосс не устанавливается. Управляйте рисками через объём позиции, внешнюю защиту или ручное сопровождение.
- Используются только завершённые свечи (`CandleStates.Finished`), чтобы повторить поведение оригинального советника.
- Важно учитывать часовую зону источника котировок: границы сессии рассчитываются во времени биржи/поставщика данных.
- При оптимизации одновременно анализируйте часы работы и выбранный таймфрейм — ширина диапазона напрямую зависит от длительности свечей.
