# Стратегия MACD EA

Стратегия представляет собой портирование советника MetaTrader 5 `MACD EA (barabashkakvn's edition).mq5` из папки `MQL/20010` на платформу StockSharp. Реализована вся логика оригинала: сигналы по MACD, частичная фиксация прибыли и управление объёмом, но с использованием высокоуровневого API StockSharp.

## Торговая логика

* **Источник сигнала.** Индикатор MACD с настраиваемыми периодами быстрых, медленных и сигнальных средних. Анализируется разница между линией MACD и сигнальной линией на двух и четырёх завершённых свечах назад. Переход разницы из отрицательной области в положительную открывает покупку, обратное условие — продажу.
* **Сопровождение позиции.** Для каждого входа задаются стоп-лосс и тейк-профит в пунктах. Значения переводятся в цены через шаг цены инструмента; при трёх или пяти знаках после запятой шаг дополнительно умножается на десять, как и в исходном коде.
* **Частичное закрытие.** При достижении прибыли в `PartialProfitPips` пунктов стратегия закрывает половину объёма, оставляя остальную часть позиции в рынке.
* **Перевод в безубыток.** После прохождения `BreakevenPips` пунктов активируется защита безубытка. Если цена возвращается к цене входа, позиция закрывается по ней — аналогично переносу стопа в оригинальном советнике.
* **Обратный сигнал MACD.** Любое оставшееся плечо закрывается при обратном пересечении MACD, чтобы не держать позицию против индикатора.

## Управление капиталом

При включении `UseMoneyManagement` объём следующей сделки увеличивается после серии убытков. Множитель зависит от длины серии (x2 после одного убытка, x3 после двух и т.д. до x7 после шести и более). Множитель перемножается с параметром `RiskMultiplier`, что повторяет мартингейл-подход оригинала. Любая прибыльная сделка обнуляет счётчик убытков.

## Параметры

| Параметр | Описание |
|----------|----------|
| `FastPeriod` / `SlowPeriod` / `SignalPeriod` | Периоды расчёта MACD.
| `StopLossPips` | Дистанция до стоп-лосса в пунктах (0 — без стопа).
| `TakeProfitPips` | Дистанция до тейк-профита в пунктах (0 — без тейка).
| `PartialProfitPips` | Пункты до частичного закрытия (0 — без частичного выхода).
| `BreakevenPips` | Порог для перевода в безубыток (0 — отключено).
| `UseMoneyManagement` | Включает динамическое наращивание объёма.
| `RiskMultiplier` | Дополнительный множитель при активном управлении капиталом.
| `BaseVolume` | Базовый объём позиции до масштабирования.
| `CandleType` | Тип свечей, по которым рассчитывается индикатор.

## Примечания

* Используется подписка на свечи и привязка индикаторов через высокоуровневый API.
* Версия на Python не подготовлена — реализован только C# вариант в каталоге `CS`.
* Модульные тесты не добавлялись и не изменялись согласно заданию.
