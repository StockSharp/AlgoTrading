# Стратегия MACD Multi-Timeframe Expert

## Обзор
Стратегия переносит советник MetaTrader "MACD Expert" в инфраструктуру StockSharp. Она сверяет направление MACD одновременно на четырёх таймфреймах — 5 минут, 15 минут, 1 час и 4 часа — и открывает позицию только при полном совпадении сигналов. Такой подход позволяет торговать согласованный импульс и избегать сделок при расширенном спреде.

## Данные и индикаторы
- **Свечи**: 5-минутные (исполнение), а также 15-минутные, часовые и четырёхчасовые подтверждения. Обрабатываются только завершённые бары.
- **Индикатор**: `MovingAverageConvergenceDivergenceSignal` с параметрами 12/26/9, отдельный экземпляр для каждого таймфрейма.
- **Уровень 1**: подписка на лучшие bid/ask цены для контроля спреда перед открытием позиции.

## Логика торговли
1. Дождаться финальных значений MACD на всех четырёх таймфреймах.
2. Определить, выше или ниже находится сигнальная линия относительно линии MACD на каждом из них.
3. Проверить, что текущий спред в пунктах не превышает `MaxSpreadPoints`.
4. Одновременно допускается только одна позиция; новая сделка возможна лишь после закрытия предыдущей по стопу или тейку.

### Условия для лонга
- Сигнальная линия MACD выше основной линии на всех таймфреймах.
- Спред не превышает лимит `MaxSpreadPoints`.
- На закрытии последней 5-минутной свечи покупается `OrderVolume` лотов.

### Условия для шорта
- Сигнальная линия MACD ниже основной линии на всех таймфреймах.
- Спред не превышает лимит `MaxSpreadPoints`.
- На закрытии последней 5-минутной свечи продаётся `OrderVolume` лотов.

### Управление позицией
- Для длинных позиций цель находится на `TakeProfitPoints` пунктов выше входа, стоп — на `StopLossPoints` пунктов ниже.
- Для коротких позиций цель находится на `TakeProfitPoints` пунктов ниже входа, стоп — на `StopLossPoints` пунктов выше.
- Выход выполняется, когда максимум или минимум завершённой 5-минутной свечи достигает соответствующего уровня.
- Во время сделки встречные сигналы игнорируются, что полностью соответствует поведению исходного MQL-советника.

## Параметры
| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `OrderVolume` | 0.1 | Размер позиции в лотах (аналог параметра `Lots` в MQL). |
| `StopLossPoints` | 200 | Расстояние до защитного стоп-лосса в пунктах. |
| `TakeProfitPoints` | 400 | Расстояние до тейк-профита в пунктах. |
| `MaxSpreadPoints` | 20 | Максимально допустимый спред в пунктах. |
| `FastPeriod` | 12 | Период быстрой EMA в MACD. |
| `SlowPeriod` | 26 | Период медленной EMA в MACD. |
| `SignalPeriod` | 9 | Период сигнальной EMA в MACD. |
| `FiveMinuteCandleType` | 5-минутные свечи | Основной таймфрейм для входов. |
| `FifteenMinuteCandleType` | 15-минутные свечи | Первое подтверждение. |
| `HourCandleType` | Часовые свечи | Второе подтверждение. |
| `FourHourCandleType` | Четырёхчасовые свечи | Третье подтверждение. |

## Особенности реализации
- Используется `BindEx`, что позволяет работать с типизированными значениями MACD без вызовов `GetValue`.
- Вспомогательный метод преобразует соотношение линий MACD в флаги `{-1, 0, 1}`, упрощая проверку синхронности.
- Проверка спреда переводит разницу между ask и bid в пункты с помощью `Security.PriceStep`, что соответствует терминалу MetaTrader.
- Все входы и выходы протоколируются через `LogInfo` для удобства анализа в Designer/Runner.
- По заданию реализована только C#-версия; папка и код на Python отсутствуют.
