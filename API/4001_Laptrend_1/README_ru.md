# Стратегия Laptrend_1

## Общее описание
Laptrend_1 переносит торговую логику советника **Laptrend_1.mq4** на платформу StockSharp. Стратегия объединяет фильтр LabTrend на двух таймфреймах, импульс по преобразованию Фишера и фильтр силы тренда ADX на 15-минутных свечах. Сделки открываются только при совпадении направления LabTrend на Н1 и М15, подтверждении импульса Fisher Transform и росте ADX. Позиции закрываются при развороте импульса, смене LabTrend или при переходе рынка в боковой режим, когда ADX и компоненты DI сближаются.

## Логика входов и выходов
- **Основные данные** — сигналы считаются по 15-минутным свечам, а часовые свечи используются для фильтрации тренда LabTrend.
- **Канал LabTrend** — реализует логику индикатора `LabTrend1_v2.1`: строится канал из `ChannelLength` свечей, который сужается коэффициентом `RiskFactor`. Закрытие выше верхней границы фиксирует восходящий тренд, ниже нижней границы — нисходящий. Для открытия позиции направления М15 и Н1 должны совпадать.
- **Преобразование Фишера** — пользовательский индикатор `Fisher_Yur4ik` на М15 отслеживает импульс. Пересечения нулевой линии переключают бычий/медвежий режим, а пересечения уровней ±0.25 формируют сигналы выхода.
- **Фильтр ADX** — 15-минутный ADX должен расти, а доминирующий DI подтверждать направление сделки. Если ADX, +DI и –DI отличаются менее чем на `Delta` пунктов, стратегия считает рынок плоским, сбрасывает флаги импульса и закрывает позицию.
- **Управление позицией** — перед открытием новой сделки стратегия закрывает встречные позиции и выставляет объём из параметра. Выход происходит при смене LabTrend, срабатывании сигналов Fisher или обнаружении флэта.

## Управление рисками
- **Stop Loss / Take Profit** — задаются в пунктах инструмента (аналог «пипсов» в MetaTrader) и сравниваются с максимумами/минимумами свечей, имитируя защитные ордера оригинального советника.
- **Trailing Stop** — при движении цены в прибыльную сторону уровень стопа подтягивается на расстояние `TrailingStopPoints` от текущего закрытия. Пробой этого уровня инициирует немедленное закрытие позиции по рынку.
- **Объём** — все заявки используют фиксированный параметр `Volume`.

## Параметры
- `Volume` – объём сделки в лотах. По умолчанию 1.
- `AdxPeriod` – период расчёта ADX. По умолчанию 14.
- `FisherLength` – длина окна для преобразования Фишера. По умолчанию 10.
- `ChannelLength` – количество свечей в канале LabTrend. По умолчанию 9.
- `RiskFactor` – коэффициент сужения канала (в оригинале диапазон 1..10). По умолчанию 3.
- `Delta` – максимальная разница между ADX и DI, при которой рынок считается флэтовым. По умолчанию 7.
- `StopLossPoints` – расстояние стоп-лосса в пунктах. По умолчанию 100.
- `TakeProfitPoints` – расстояние тейк-профита в пунктах. По умолчанию 40.
- `TrailingStopPoints` – дистанция трейлинг-стопа в пунктах. По умолчанию 100.
- `SignalCandleType` – тип свечей для расчёта сигналов (по умолчанию М15).
- `TrendCandleType` – тип свечей для фильтра по тренду (по умолчанию Н1).

## Примечания
- В оригинальном MQL коде вычисления выполнялись на каждом тике; в этом переносе анализ производится на закрытии 15-минутных свечей, что делает результаты повторяемыми и сохраняет исходную логику индикаторов.
- Stop Loss, Take Profit и трейлинг реализованы как рыночные выходы при достижении соответствующих ценовых уровней свечи, поэтому отдельные защитные ордера не выставляются.
- Перед запуском убедитесь, что источник данных предоставляет обе серии свечей, указанные в параметрах (М15 и Н1).
