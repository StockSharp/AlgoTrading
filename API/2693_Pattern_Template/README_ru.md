# Шаблонная стратегия Pattern
[English](README.md) | [中文](README_cn.md)

**Pattern Template Strategy** — дословная адаптация эксперта «pattern.mq5» из MQL5. Первоначальный код задумывался как учебный каркас, показывающий, как разделить торгового робота на независимые блоки: управление капиталом, генерацию сигналов, подтверждение заявок и сопровождение позиции. Версия для StockSharp сохраняет эту архитектуру, но подключает блоки к высокоуровневому API платформы (`SubscribeCandles`, `StrategyParam<T>`, `LogInfo` и т. д.). В результате получается «живая» документация, готовая к расширению до полноценной торговой системы.

По умолчанию стратегия **не отправляет никаких заявок**. Каждый компонент только пишет подробные сообщения в журнал, позволяя понять очередность вызовов. Чтобы превратить шаблон в рабочий алгоритм, замените содержимое компонент на реальные вычисления.

## Логика работы

1. **Инициализация**
   - `OnStarted` вызывает `InitializeComponents`, пересоздавая четыре ключевых блока (управление капиталом, генератор сигналов, проверка заявок и сопровождение позиции) и фиксируя это в логе.
   - Значение параметра `LotVolume` копируется в базовое поле `Strategy.Volume`, чтобы дальнейшая торговая логика могла использовать его без дополнительной настройки.
   - Создаётся подписка на свечи через `SubscribeCandles(CandleType)`, обработка передаётся методу `ProcessCandle`.
2. **Обработка свечей**
   - `ProcessCandle` реагирует только на завершённые свечи, журналирует их время и цену закрытия, проверяет готовность стратегии, а затем запускает конвейер шаблона.
   - Блок управления капиталом возвращает фиксированный объём (`LotVolume`).
   - Генератор сигналов чередует рекомендации «покупка/продажа», демонстрируя место для собственной логики.
   - Обработчик заявок записывает параметры контекста и всегда подтверждает операцию.
   - Модуль сопровождения позиции сообщает о выполнении контрольного прохода.
3. **События сделок**
   - Метод `OnNewMyTrade` срабатывает при появлении собственных сделок (например, после того как вы добавите реальные заявки). Он повторно запускает сопровождение позиции, сохраняя поведение MQL5-версии.
4. **Жизненный цикл**
   - Дополнительные сообщения в `OnReseted` и `OnStopped` помогают проследить весь жизненный цикл шаблона.

## Параметры

| Название | Тип | Значение по умолчанию | Описание |
| -------- | --- | --------------------- | -------- |
| `CandleType` | `DataType` | минутные свечи | Определяет подписку на данные, которая инициирует запуск конвейера. Измените таймфрейм или тип данных под нужный инструмент. |
| `LotVolume` | `decimal` | `1` | Объём, возвращаемый блоком управления капиталом и копируемый в `Strategy.Volume`. Параметр доступен для оптимизации (от 0.5 до 5 с шагом 0.5). |

## Компоненты

- **FixedVolumeMoneyManagement** — возвращает заданный объём и поясняет в журнале, когда он использован.
- **TemplateSignalGenerator** — поочерёдно рекомендует покупку и продажу, подчёркивая, куда нужно вставить индикаторную логику.
- **LoggingTradeRequestHandler** — принимает любую заявку, фиксируя её объём и направление. Здесь можно реализовать фильтры по спреду, времени или лимитам риска.
- **LoggingPositionSupport** — вызывается после каждой свечи и события сделки; в реальном проекте замените его управлением стопами или хеджированием.

## Соответствие MQL5

| Компонент MQL5 | Эквивалент StockSharp | Комментарий |
| -------------- | --------------------- | ----------- |
| `CVolume::Lots()` | `FixedVolumeMoneyManagement.GetVolume()` | Возвращает фиксированный лот. |
| `CSignal::Generator()` | `TemplateSignalGenerator.GenerateSignal()` | Формирует заглушку направления. |
| `CRequest::Request()` | `LoggingTradeRequestHandler.TryHandle()` | Логирует заявку и всегда подтверждает её. |
| `CSupport::Support()` | `LoggingPositionSupport.MaintainPosition()` | Вызывается после свечи и после сделки. |
| `CStrategy::OnInitStrategy()` | `OnStarted()` | Связывает все блоки между собой. |
| `CStrategy::OnTickStrategy()` | `ProcessCandle()` | Основной цикл обработки данных. |
| `CStrategy::OnTradeStrategy()` | `OnNewMyTrade()` | Реакция на появление сделок. |

## Рекомендации по расширению

1. **Индикаторы** — реализуйте генератор сигналов на основе SMA, RSI, Bollinger Bands или других индикаторов из StockSharp.
2. **Управление капиталом** — модифицируйте `FixedVolumeMoneyManagement`, чтобы вычислять объём через ATR, доступный баланс или маржинальные требования.
3. **Фильтрация заявок** — добавьте в `LoggingTradeRequestHandler` проверки спреда, расписания торгов или блоки риск-менеджмента.
4. **Сопровождение** — реализуйте трейлинг-стопы, частичное закрытие или хеджирование в `LoggingPositionSupport`.
5. **Диагностика** — используйте текущие сообщения `LogInfo` для отладки или замените их на структурированное логирование.

## Дополнительные заметки

- Пока вы не добавите методы `BuyMarket`, `SellMarket` и т. п., стратегия остаётся полностью безопасной и не торгует.
- Все компоненты объявлены как приватные вложенные классы: их легко заменить, изменив содержимое `InitializeComponents` или подключив внешний контейнер зависимостей.
- Код соответствует требованиям репозитория: пространство имён в формате file-scoped, табуляция, английские комментарии и использование высокоуровневого API.
- Версия на Python намеренно отсутствует во исполнение задания.

Используйте шаблон для обучения, тестирования архитектурных идей или быстрого прототипирования новых стратегий без необходимости начинать с нуля.
