# JS Chaos 策略

## 概述
JS Chaos 策略在 StockSharp 高级 API 中复刻了 MetaTrader 专家顾问 “JS-Chaos” 的行为。策略围绕比尔·威廉姆斯的短吻鳄结构与分形突破构建入场，辅以 Awesome Oscillator 与 Acceleration/Deceleration 指标确认，并通过追踪止损、保本与复杂的时间过滤器管理持仓。

## 核心逻辑
1. **指标体系**
   - 使用 13/8/5 周期、8/5/3 位移的平滑移动平均构成的短吻鳄指标（以中价为输入）。
   - Awesome Oscillator 及其 5 周期 SMA 推导出的 AC 指标。
   - 21 周期平滑均线作为追踪止损的核心。
   - 10 周期标准差作为追踪触发条件之一。
   - 最近五根 K 线高低点的分形检测，记录 10 根 K 线内最新形成的分形。
2. **信号生成**
   - 多头背景：`AO[0] > AO[1] > 0` 且 `Lips > Teeth > Jaw`。
   - 空头背景：`AO[0] < AO[1] < 0` 且 `Lips < Teeth < Jaw`。
3. **挂单布置**
   - 条件满足且当前时间允许交易时，同向布置两笔突破单：主单使用 2× 基础手数，次单使用 1× 基础手数，触发价为最近符合条件且位于短吻鳄唇线之外的分形价。
   - 主单止盈为 `Lips ± (Fractal − Lips) * Fibo1`，次单止盈使用 `Fibo2` 倍数。
4. **仓位管理**
   - 可选：当唇线突破上一根 K 线开盘价时强制平仓对应方向持仓。
   - 追踪止损：当标准差、AO 与 AC 同向走强时，将止损推至 21 周期 SMMA。
   - 保本逻辑：主单离场且价格已行进到设定额外点数后，将次单止损移至保本位。
   - 通过监控价格区间，当触及止盈/止损时以市价单平仓。
5. **时间过滤器**
   - 通过开盘/收盘小时（支持跨日）限定交易窗口，并包含季节性约束：周一 03:00 之前禁用、周五 18:00 之后禁用、1 月前 9 天及 12 月 20 日之后禁用。`UseTime=false` 可完全关闭过滤。

## 参数
| 参数 | 说明 |
| ---- | ---- |
| `UseTime` | 是否启用时间过滤。 |
| `OpenHour` / `CloseHour` | 交易时段的起止小时（0-23）。 |
| `BaseVolume` | 基础下单手数（主单 2×、次单 1×）。 |
| `IndentingPips` | 分形挂单的偏移量（以点数表示）。 |
| `Fibo1` / `Fibo2` | 计算止盈目标的斐波那契比例。 |
| `UseClosePositions` | 当唇线穿越上一根 K 线开盘价时是否强制平仓。 |
| `UseTrailing` | 是否启用基于均线与振荡指标的追踪止损。 |
| `UseBreakeven` | 是否启用次单的保本逻辑。 |
| `BreakevenPlusPips` | 移动到保本位时在入场价基础上增加的点数。 |
| `CandleType` | 策略所处理的 K 线类型/周期。 |

## 说明
- 转换保留了原 MQL5 机器人分批挂单和仓位管理的结构，同时利用 StockSharp 的 K 线订阅流程。
- 所有计算基于已收盘 K 线，原策略的盘中触发通过在价格突破后发送市价单模拟实现。
- 点值换算会根据报价精度（3 或 5 位小数）自动调整，适用于外汇品种。
