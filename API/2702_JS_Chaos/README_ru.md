# Стратегия JS Chaos

## Общее описание
Стратегия JS Chaos переносит функциональность советника MetaTrader "JS-Chaos" на платформу StockSharp. Логика строится вокруг структуры аллигатора Билла Уильямса и прорывов по фракталам, подтверждается осцилляторами AO и AC, а управление позицией выполняется через трейлинг, перевод в безубыток и гибкую фильтрацию по времени.

## Основные элементы
1. **Набор индикаторов**
   - Аллигатор: сглаженные скользящие средние с периодами 13/8/5 и смещениями 8/5/3, рассчитываемые по средней цене свечи.
   - Awesome Oscillator и его 5-периодная SMA для получения Acceleration/Deceleration.
   - 21-периодная SMMA для трейлинга.
   - 10-периодное стандартное отклонение как дополнительный фильтр для подтягивания стопа.
   - Определение фракталов на последних пяти максимумах/минимумах с хранением актуальных значений в течение десяти баров.
2. **Формирование сигналов**
   - Для покупок требуется `AO[0] > AO[1] > 0` и расположение линий аллигатора `Lips > Teeth > Jaw`.
   - Для продаж требуется `AO[0] < AO[1] < 0` и `Lips < Teeth < Jaw`.
3. **Постановка заявок**
   - При совпадении условий и разрешённом времени торговли выставляются две стоп-заявки в направлении сигнала: основная (объём 2× базового) и дополнительная (1× базового), обе на уровне последнего фрактала, находящегося за линией губ.
   - Цели по прибыли рассчитываются как `Lips ± (Fractal − Lips) * Fibo1` для основной и `Fibo2` для дополнительной заявки.
4. **Менеджмент позиций**
   - Опциональное закрытие позиций, если линия губ пересекает цену открытия предыдущей свечи.
   - Трейлинг подтягивает стоп к 21-периодной SMMA при одновременном росте стандартного отклонения, AO и AC в сторону позиции.
   - Логика безубытка переносит стоп дополнительной сделки к цене входа с запасом по заданному числу пунктов, когда первая сделка закрылась и цена прошла нужное расстояние.
   - Стоп-лоссы и тейк-профиты контролируются вручную: при достижении уровней позиции закрываются рыночными приказами.
5. **Фильтр по времени**
   - Торговое окно задаётся часами открытия/закрытия (поддерживается переход через полночь) и сезонными ограничениями: торговля запрещена до 03:00 понедельника, после 18:00 пятницы, в первые девять дней января и после 20 декабря. Параметр `UseTime = false` отключает фильтр полностью.

## Параметры
| Параметр | Значение |
| -------- | -------- |
| `UseTime` | Включение фильтра времени. |
| `OpenHour` / `CloseHour` | Часовые границы торговли (0-23). |
| `BaseVolume` | Базовый объём, используемый для расчёта ступенчатых входов (2× и 1×). |
| `IndentingPips` | Отступ от уровня фрактала в пунктах. |
| `Fibo1` / `Fibo2` | Множители для расчёта целей по прибыли. |
| `UseClosePositions` | Принудительное закрытие позиций при пересечении губ предыдущего открытия. |
| `UseTrailing` | Активация трейлинг-стопа. |
| `UseBreakeven` | Перевод дополнительной позиции в безубыток. |
| `BreakevenPlusPips` | Запас в пунктах при переносе стопа в безубыток. |
| `CandleType` | Тип/период используемых свечей. |

## Дополнительно
- Конвертация сохраняет двухэтапную структуру входа и алгоритмы управления из оригинального MQL5-советника, используя подписку на свечи StockSharp.
- Расчёты выполняются по закрытым свечам; внутрибаравая логика оригинала имитируется отправкой рыночных приказов после подтверждения диапазона.
- Пересчёт пунктов автоматически адаптируется к инструментам с трёх- и пятизначными квотами.
