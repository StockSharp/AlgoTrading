# Стратегия Linear Regression Channel (Fibo)

## Описание
Стратегия представляет собой перенос советника MetaTrader **«linear regression channel»** на платформу StockSharp. Для определения направления используются линейно-взвешенные скользящие средние, фильтр по индикатору Momentum на более старшем таймфрейме и месячный MACD. Блок управления капиталом повторяет оригинал: денежные цели по плавающей прибыли, трейлинг накопленного результата, перевод в безубыток и стоп по просадке капитала.

## Логика входов
1. **Базовый таймфрейм** – настраиваемый тип свечей (по умолчанию 15 минут), на котором рассчитываются все сигналы.
2. **Трендовый фильтр** – сравнение быстрой и медленной LWMA, рассчитанных по типичной цене. Для покупок требуется, чтобы быстрая LWMA была выше медленной, для продаж – наоборот.
3. **Подтверждение Momentum** – индикатор оценивается на более старшем таймфрейме (M1→M15, M5→M30, M15→H1, M30→H4, H1→D1, H4→W1, D1→MN1). Рассматриваются три последних значения и их отклонение от уровня 100. Если хотя бы одно из значений превышает порог для покупок/продаж, фильтр считается выполненным.
4. **Месячный MACD** – сделки на покупку разрешены только при условии, что основная линия MACD(12,26,9) выше сигнальной; продажи – при обратном соотношении.
5. **Открытие позиции** – при выполнении всех фильтров стратегия выставляет рыночный ордер. При появлении противоположного сигнала позиция закрывается и может быть развернута.

## Управление позицией
- **Фиксированные стоп и тейк** – расстояния в пунктах задаются параметрами и проверяются на каждой закрытой свече.
- **Трейлинг-стоп** – опционально активируется после достижения заданной прибыли и тянет стоп на указанном расстоянии от экстремума.
- **Перевод в безубыток** – после достижения триггера стоп переносится к цене входа с заданным запасом.
- **Денежный тейк** – при превышении целевой плавающей прибыли вся позиция закрывается.
- **Процентный тейк** – цель рассчитывается как доля от стартового капитала стратегии.
- **Трейлинг по прибыли** – после достижения пороговой прибыли фиксируется максимум; если текущая прибыль упала больше чем на заданную величину, позиция закрывается.
- **Стоп по капиталу** – когда плавающий убыток превышает процент от максимальной достигнутой стоимости портфеля, позиция ликвидируется.

## Параметры
| Параметр | Назначение |
| -------- | ---------- |
| `Candle Type` | Рабочий таймфрейм стратегии. |
| `Fast LWMA` / `Slow LWMA` | Периоды быстрых и медленных LWMA. |
| `Momentum Length` | Длина расчета Momentum на старшем таймфрейме. |
| `Momentum Buy Threshold` / `Momentum Sell Threshold` | Минимальное отклонение от уровня 100 для подтверждения покупок/продаж. |
| `Take Profit (points)` / `Stop Loss (points)` | Фиксированные значения тейк-профита и стоп-лосса в пунктах. |
| `Use Trailing`, `Trailing Activation`, `Trailing Offset` | Параметры трейлинг-стопа. |
| `Use Break-even`, `Break-even Trigger`, `Break-even Offset` | Настройки перевода в безубыток. |
| `Max Trades` | Максимальное количество входов за запуск стратегии. |
| `Order Volume` | Базовый объем заявок. |
| `Use Money TP`, `Money Take Profit` | Денежная цель по плавающей прибыли. |
| `Use Percent TP`, `Percent Take Profit` | Цель как процент от стартового капитала. |
| `Enable Money Trailing`, `Money Trailing Trigger`, `Money Trailing Stop` | Защита накопленной прибыли от отката. |
| `Use Equity Stop`, `Equity Risk %` | Ограничение просадки капитала. |

## Дополнительно
- Стратегия удерживает единственную суммарную позицию и может разворачиваться при смене сигнала.
- Метод `GetWorkingSecurities()` автоматически подписывает необходимые старшие таймфреймы для Momentum и MACD.
- Комментарии в коде выполняются только на английском языке, как требует репозиторий.
