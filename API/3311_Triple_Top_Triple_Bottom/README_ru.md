# Стратегия Triple Top Triple Bottom

**Triple Top Triple Bottom** — это адаптация одноимённого советника MetaTrader. Исходная логика сочетает фильтрацию тренда,
подтверждение силы импульса и проверку MACD перед открытием позиции. Версия на StockSharp сохраняет ключевые элементы и позволяет
гибко управлять параметрами напрямую из конструктора стратегии.

## Логика работы

1. **Фильтр тренда** — две линейно взвешенные скользящие средние, рассчитанные по типичной цене (High+Low+Close)/3. Для покупок
   быстрая LWMA должна находиться выше медленной, для продаж — ниже.
2. **Подтверждение импульса** — индикатор Momentum с настраиваемым периодом обязан отклоняться от базового уровня 100 минимум на
   заданный порог в течение трёх последних завершённых свечей. Это защищает от входов в боковых диапазонах.
3. **Фильтр MACD** — классический MACD 12/26/9. Сделки на покупку допускаются только при пересечении линии MACD выше сигнальной,
   а на продажу — при обратном соотношении.
4. **Риск-менеджмент** — стратегия автоматически выставляет стоп-лосс и тейк-профит в абсолютных ценовых величинах. Если один из
   уровней равен нулю, защита отключается. Дополнительно, при обработке свечей стратегия закрывает позицию, если цена достигла
   соответствующего уровня риска.

## Параметры

- **Entry Candle** — тип свечей, по которым рассчитываются индикаторы и принимаются решения.
- **Fast LWMA / Slow LWMA** — периоды быстрой и медленной линейно взвешенных средних.
- **Momentum Period / Momentum Threshold** — длина окна Momentum и минимальное отклонение от уровня 100.
- **Stop Loss / Take Profit** — дистанции защитных ордеров в абсолютных ценовых единицах. Значения передаются в `SetStopLoss`
  и `SetTakeProfit`, поэтому брокер удерживает их даже при остановке стратегии.

## Отличия от MQL-версии

- Убраны функции управления капиталом (мартингейл, контроль просадки, трейлинг по свечам, перевод в безубыток) и работа с
  графическими объектами, зависящими от интерфейса MetaTrader.
- Стопы и цели задаются в абсолютных ценах, что упрощает перенос между брокерами с различными размерами пункта.
- Для визуализации используются области StockSharp: цена, LWMA, Momentum и MACD.

## Рекомендации по применению

1. Перед стартом стратегии выберите инструмент и подходящий тип свечей.
2. Настройте порог Momentum и защитные дистанции в соответствии с волатильностью инструмента.
3. Стратегия работает с одной чистой позицией: при появлении противоположного сигнала текущая позиция закрывается, исключая
   одновременные лонг и шорт.

Код снабжён комментариями на английском языке и следует требованиям к высокоуровневому API StockSharp.
