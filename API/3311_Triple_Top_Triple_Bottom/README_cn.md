# 三重顶与三重底策略

**三重顶与三重底策略**移植自同名的 MetaTrader 智能交易系统。原始版本在开仓前会同时检查趋势方向、动量强度以及
MACD 过滤。本移植版本保留了相同的核心思想，并将关键阈值暴露为可配置参数，方便在 StockSharp 框架中进行优化
与回测。

## 策略逻辑

1. **趋势过滤**：基于典型价 (高+低+收)/3 计算两条线性加权移动平均线。只有当快线位于慢线上方时才允许做多，位于
   下方时才允许做空。
2. **动量确认**：内置的 Momentum 指标需要在最近三根收盘 K 线内至少有一次偏离中性值 100 超过设定的阈值，用于
   避免在震荡市中交易。
3. **MACD 过滤**：采用 12/26/9 参数的 MACD。只有当 MACD 主线高于信号线时才买入，当主线低于信号线时才卖出，
   以避免逆势操作。
4. **风险控制**：市价单会同时设置止损和止盈，单位为绝对价格。参数可以设为 0 来禁用。策略在每根完成 K 线时也
   会检查价格是否触及这些阈值，从而确保在服务器无法维护保护单时仍能及时退出。

## 参数说明

- **Entry Candle** – 决定策略运行时间框架的 DataType。
- **Fast LWMA / Slow LWMA** – 快速与慢速线性加权移动平均线的周期。
- **Momentum Period / Momentum Threshold** – Momentum 指标的回溯长度以及确认交易所需的最小偏离。
- **Stop Loss / Take Profit** – 止损与止盈距离，单位为绝对价格，同时会通过 `SetStopLoss` 和 `SetTakeProfit`
  提交至交易柜台。

## 与 MQL 版本的差异

- 为保持 StockSharp 端的简洁性，移除了原始版本中的加倍下单、资金回撤保护、蜡烛图跟踪、保本移动以及依赖图形对
  象的趋势线判断。
- 风险阈值以绝对价格表示而非点值。这样可避免不同经纪商的点值定义差异，用户只需根据合约的价格步长自行换算。
- 图表输出使用 StockSharp 的图形区域绘制 K 线、移动平均线、动量和 MACD。

## 使用建议

1. 在启动策略前选择交易标的并设定合适的蜡烛类型。
2. 根据品种波动率调整动量阈值和止损/止盈距离。
3. 策略仅保持一个净头寸，若出现反向信号会先平仓，避免多空同时持有。

代码遵循仓库中的高层 API 指南，并提供了英文注释以便阅读与维护。
