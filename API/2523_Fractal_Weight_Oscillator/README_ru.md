# Стратегия Fractal Weight Oscillator

## Обзор
Стратегия является конверсией советника "Exp_Fractal_WeightOscillator".
Она объединяет четыре осциллятора (RSI, Money Flow Index, Williams %R и
DeMarker) в единый сглаженный сигнал и сравнивает его с уровнями
`HighLevel` / `LowLevel`. В зависимости от выбранного режима `TrendMode`
стратегия работает по тренду или против него. Все расчёты выполняются на
указанном таймфрейме свечей через высокоуровневый API StockSharp.

## Набор индикаторов
- **RSI** – рассчитывается по указанному источнику цены.
- **MFI** – использует выбранную цену и объём свечи.
- **Williams %R** – строится по максимумам/минимумам и закрытию.
- **DeMarker** – пересобран вручную на основе максимумов/минимумов с простым
  сглаживанием.
- **Сглаживающая скользящая средняя** – необязательный постфильтр (SMA, EMA,
  SMMA или LWMA).

Композитный осциллятор представляет собой взвешенное среднее четырёх
компонентов. Уровни `HighLevel` и `LowLevel` задают зоны перекупленности и
перепроданности, а параметр `SignalBar` позволяет смотреть сигнал на более
старых закрытых барах.

## Торговая логика
### TrendMode = Direct (по тренду)
- **Покупка / закрытие шорта** – когда осциллятор опускается от значений выше
  `LowLevel` до уровня `LowLevel` или ниже (при включённых
  `BuyOpenEnabled` и `SellCloseEnabled`).
- **Продажа / закрытие лонга** – когда осциллятор поднимается от значений ниже
  `HighLevel` до уровня `HighLevel` или выше (требуются `SellOpenEnabled` и
  `BuyCloseEnabled`).

### TrendMode = Counter (против тренда)
- **Покупка / закрытие шорта** – при пробое вверх уровня `HighLevel`.
- **Продажа / закрытие лонга** – при пробое вниз уровня `LowLevel`.

Сигналы анализируются на баре, заданном `SignalBar`. При развороте позиции
покупается/продаётся объём `Volume + |Position|`, чтобы сначала закрыть текущую
позицию.

## Управление рисками
После открытия позиции рассчитываются стоп-лосс и тейк-профит по параметрам
`StopLossPoints` и `TakeProfitPoints`. Значения умножаются на `MinPriceStep`.
На каждой завершённой свече проверяются минимум/максимум; при достижении
стопа или цели позиция закрывается и внутренние уровни риска сбрасываются.

## Параметры
| Параметр | Описание |
| -------- | -------- |
| `TrendMode` | Режим торговли: по тренду или против тренда. |
| `SignalBar` | Сколько закрытых баров назад анализируется сигнал. |
| `Period` | Базовый период для RSI, MFI, Williams %R и DeMarker. |
| `SmoothingLength` | Длина окна сглаживающей скользящей средней. |
| `SmoothingMethod` | Тип сглаживания (`None`, `Sma`, `Ema`, `Smma`, `Lwma`). |
| `RsiPrice`, `MfiPrice` | Источники цены для компонентов. |
| `MfiVolume` | Тип объёма для MFI (tick/real используют объём свечи). |
| `RsiWeight`, `MfiWeight`, `WprWeight`, `DeMarkerWeight` | Вес каждого индикатора в суммарном осцилляторе. |
| `HighLevel`, `LowLevel` | Верхний и нижний порог для поиска сигналов. |
| `BuyOpenEnabled`, `SellOpenEnabled` | Разрешение на открытие лонгов/шортов. |
| `BuyCloseEnabled`, `SellCloseEnabled` | Разрешение закрывать позиции при обратном сигнале. |
| `StopLossPoints`, `TakeProfitPoints` | Расстояние до стоп-лосса и тейк-профита (в шагах цены, 0 отключает уровень). |
| `CandleType` | Тип/таймфрейм обрабатываемых свечей. |
| `Volume` *(свойство стратегии)* | Объём сделки; при развороте добавляется абсолютное значение текущей позиции. |

## Особенности использования
- Значение `SignalBar = 1` соответствует оригинальному советнику и использует
  последний полностью сформированный бар. Увеличение значения добавляет задержку
  для подтверждения сигналов.
- `SmoothingMethod` позволяет отключить сглаживание (`None`) или подобрать тип
  скользящей средней, аналогичный MQL-версии.
- Рассчёт MFI всегда использует совокупный объём свечи из потока данных.
  Отдельный счётчик тиков в стандартных свечах StockSharp недоступен, поэтому
  варианты `Tick` и `Real` работают с одним и тем же значением.
- Все комментарии в исходнике на английском языке согласно требованиям.
