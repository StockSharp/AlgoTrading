# Стратегия Hans123 Trader v2
[English](README.md) | [中文](README_cn.md)

Hans123 Trader v2 — это адаптация одноимённого эксперта Владимира Карпутова на платформу StockSharp. Стратегия отслеживает выход цены из 80-свечного диапазона и работает через отложенные ордера Buy Stop и Sell Stop. После входа позиции применяются стоп-лосс, тейк-профит и трейлинг-стоп, что полностью повторяет оригинальную логику в MetaTrader.

## Основная идея

- Используются свечи выбранного типа (по умолчанию — часовые).
- В торговый интервал рассчитываются максимумы и минимумы за последние *N* свечей (80 по умолчанию).
- Если цена находится на достаточном расстоянии от текущих Bid/Ask, на уровне максимума размещается Buy Stop, а на уровне минимума — Sell Stop.
- Количество активных отложенных ордеров ограничено параметром, чтобы избежать избыточной экспозиции.
- При срабатывании одного ордера противоположные заявки отменяются, а на позицию устанавливаются защитные ордера с возможностью трейлинга.

## Управление сделкой

- **Входы**: Ордеры выставляются только тогда, когда время свечи попадает в интервал между начальным и конечным часом (границы включительно/исключительно, как в оригинале).
- **Защита позиции**: После открытия позиции создаются стоп-лосс и тейк-профит на расстоянии, заданном в пунктах.
- **Трейлинг**: При движении цены в прибыль на величину больше трейлинга плюс шаг, стоп-ордер перевыставляется ближе к рынку.
- **Очистка ордеров**: Закрытие позиции приводит к отмене защитных ордеров, а новая позиция сразу убирает все противоположные отложенные ордера — аналогично MQL-версии.

## Параметры

| Параметр | Описание |
|----------|----------|
| `Volume` | Торговый объём для входов и защитных ордеров. |
| `StopLossPips` | Расстояние от входа до стоп-лосса в пунктах (0 — без стопа). |
| `TakeProfitPips` | Расстояние до тейк-профита в пунктах (0 — без тейка). |
| `TrailingStopPips` | Размер начального трейлинга в пунктах (0 — трейлинг отключён). |
| `TrailingStepPips` | Минимальный дополнительный профит в пунктах перед очередным переносом стопа. Должен быть > 0 при включённом трейлинге. |
| `StartHour` | Час начала торговой сессии, с которого разрешено ставить отложенные ордера. |
| `EndHour` | Час окончания торговой сессии (ордеры не ставятся, если время свечи >= этого часа). |
| `MaxPendingOrders` | Максимальное количество одновременно активных отложенных ордеров. |
| `BreakoutPeriod` | Количество свечей в расчёте максимума и минимума. |
| `CandleType` | Тип обрабатываемых свечей (таймфрейм или иной источник данных). |

## Дополнительно

- Размер пункта вычисляется из шага цены инструмента. Для 3- и 5-значных форекс-символов шаг умножается на 10, чтобы соответствовать определению пункта в MQL.
- Если стакан не доступен, проверка расстояния до рынка выполняется по цене закрытия текущей свечи.
- При изменении стоп-лосса заявка отменяется и создаётся заново, что соответствует вызову `PositionModify` в оригинале.
- В рамках задачи создана только C#-версия стратегии, папка для Python не добавлялась.
