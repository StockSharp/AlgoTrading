# Hans123 Trader v2 策略
[English](README.md) | [Русский](README_ru.md)

Hans123 Trader v2 是 Vladimir Karputov 编写的 MetaTrader 策略在 StockSharp 平台上的移植版本。策略利用最近 80 根 K 线的最高价和最低价设置买入/卖出止损单，在价格突破区间时跟随动量入场，并提供与原始 EA 相同的风控和拖尾逻辑。

## 核心思路

- 处理可配置的蜡烛类型（默认 1 小时）。
- 在允许交易的时间窗口内，计算最近 *N* 根蜡烛的最高价和最低价（默认 80 根）。
- 当市场价格与当前买价/卖价拉开足够距离时，在最高价放置 Buy Stop，在最低价放置 Sell Stop。
- 同时激活的挂单数量受 `MaxPendingOrders` 限制，避免过度暴露。
- 挂单成交后立即撤销反向挂单，并为持仓设置止损、止盈和可选的拖尾止损。

## 持仓管理

- **入场**：只有当蜡烛时间处于 `StartHour` 和 `EndHour` 之间时才会提交新的挂单；时间窗口之外不会开仓。
- **风控**：新建仓位后立即根据点数距离挂出止损和止盈单。
- **拖尾止损**：若启用，当浮动盈利超过拖尾距离加上步长时，取消原有止损并在更优位置重新挂单。
- **清理**：平仓后撤销所有风控单；出现新的建仓信号时撤销与方向相反的挂单，保持与 MQL 实现一致。

## 参数说明

| 参数 | 说明 |
|------|------|
| `Volume` | 下单和保护性订单所使用的数量。 |
| `StopLossPips` | 入场价到止损价的点数距离，0 表示不使用止损。 |
| `TakeProfitPips` | 入场价到止盈价的点数距离，0 表示不使用止盈。 |
| `TrailingStopPips` | 初始拖尾止损距离（点），0 表示关闭拖尾。 |
| `TrailingStepPips` | 每次重新移动拖尾前所需的附加盈利（点）。启用拖尾时必须大于 0。 |
| `StartHour` | 允许挂出突破订单的起始小时（含）。 |
| `EndHour` | 停止挂单的小时（不含），必须大于起始小时。 |
| `MaxPendingOrders` | 同时允许存在的突破挂单最大数量。 |
| `BreakoutPeriod` | 计算最高价和最低价的回溯蜡烛数量。 |
| `CandleType` | 策略处理的蜡烛类型或时间框架。 |

## 额外说明

- 点值基于证券的价格步长推导。对于 3 位和 5 位报价的外汇品种，会按照 MQL 的定义将步长乘以 10。
- 如果行情中缺少最佳买卖价信息，会退回使用当前蜡烛的收盘价来判断距离要求。
- 当需要移动止损时，策略会取消旧单并重新挂单，以模拟原程序中的 `PositionModify` 调用。
- 本任务仅提供 C# 版本，未创建 Python 文件夹或实现。
