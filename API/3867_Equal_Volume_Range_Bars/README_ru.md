# Равный объём и рэндж-бары

## Обзор
Стратегия «Равный объём и рэндж-бары» переносит в StockSharp скрипт MetaTrader 4 `equalvolumebars.mq4`. Оригинальная программа строила офлайн-графики, где свеча закрывалась после заданного количества тиков либо после прохождения ценой указанного диапазона. Порт полностью воспроизводит этот алгоритм внутри StockSharp: подписывается на поток сделок, при необходимости подготавливает историю по минутным свечам и записывает подробный лог при формировании каждой синтетической свечи.

## Логика построения свечей
* **Два режима работы** – `EqualVolumeBars` завершает свечу, когда накопленный объём тиков превосходит порог. `RangeBars` ждёт, пока диапазон «High–Low» (в шагах цены инструмента) превысит тот же порог.
* **Обновление по каждому тику** – каждая сделка пересчитывает максимум, минимум, цену закрытия и тиковый объём текущей свечи. Если следующая сделка привела бы к переполнению порога, стратегия завершает предыдущую свечу с уже накопленной статистикой и сразу же начинает новую, используя текущий тик как первую запись.
* **Инициализация минутной историей (опционально)** – при включённом параметре `FromMinuteHistory` завершённые M1-свечи проигрываются в виде последовательности синтетических тиков («open → экстремумы → close»). Это заменяет подготовку офлайн-графика в MT4 и не требует внешних CSV-файлов с тиками.
* **Строго возрастающие метки времени** – генератор гарантирует монотонный рост времени, поэтому журналы и последующие модули не встретят дубликаты по таймстемпам.

## Параметры
* **Work Mode** – выбор между режимами `EqualVolumeBars` и `RangeBars`.
* **Ticks In Bar** – количество тиков в свече (для равного объёма) или диапазон в шагах цены (для рэндж-баров).
* **Use Minute History** – воспроизводить ли завершённые M1-свечи перед получением живых тиков.
* **Minute Candle Type** – тип свечного подписки для инициализации историей (по умолчанию минутный таймфрейм).

## Дополнительные замечания
* Стратегия определяет величину шага цены через `Security.PriceStep` (либо `Security.MinPriceStep`, либо значение `0.0001`, если данные отсутствуют), что соответствует константе `_Point` в MetaTrader.
* Вместо записи `.hst` и принудительного обновления окна C#-порт логирует каждую готовую свечу с полным набором OHLCV-значений. Это упрощает сопоставление с офлайн-графиком MT4 или передачу данных в другие компоненты.
* Заявки никогда не выставляются: класс выполняет исключительно преобразование данных, как и оригинальный скрипт.
* Реализована только C#-версия. Папка и файлы Python намеренно не создавались согласно требованиям.
