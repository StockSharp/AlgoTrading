# Стратегия N Candles v5

## Обзор
Стратегия N Candles v5 ищет последовательности из одинаковых свечей и открывает
сделку в их направлении, как только найден необходимый отрезок. Оригинальная
версия на MQL, написанная Владимиром Карпутовым, перенесена на высокоуровневый
API StockSharp. Логика работает только с закрытыми свечами и может применяться
на любом таймфрейме, по умолчанию используется часовой.

## Торговая логика
1. После закрытия свечи она классифицируется как бычья (close > open), медвежья
   (close < open) или нейтральная (close = open).
2. Последовательные бычьи свечи увеличивают счётчик бычьей серии и обнуляют
   медвежий счётчик, и наоборот. Нейтральные свечи сбрасывают оба счётчика.
3. Когда счётчик бычьей серии достигает `CandlesCount`, а текущая позиция отсутствует
   или открыта в шорт, стратегия покупает по рынку. Сначала закрывается шортовая
   позиция, затем добавляется объём `TradeVolume` для открытия лонга.
4. Когда счётчик медвежьей серии достигает `CandlesCount`, а позиция отсутствует
   или открыта в лонг, стратегия продаёт по рынку. Сначала закрывается лонг,
   затем открывается шорт.
5. Входы выполняются только внутри торгового окна между `StartHour` и `EndHour`,
   если активирован флаг `UseTradingHours`. При этом защита позиции (тейк, стоп,
   трейлинг) продолжает работать вне торгового окна.
6. Объём позиции ограничивается параметром `MaxNetVolume`, что повторяет защиту
   от чрезмерного увеличения позиции в исходном MQL-скрипте.

## Управление рисками
- **Тейк-профит / стоп-лосс** – задаются в пунктах и автоматически переводятся в
  абсолютные цены через шаг цены инструмента. Значение 0 отключает уровень.
- **Трейлинг-стоп** – активируется после движения цены на `TrailingStopPips`
  пунктов от цены входа. После активации стоп подтягивается при каждом
  дополнительном продвижении на `TrailingStepPips` пунктов.
- **Торговая сессия** – параметр `UseTradingHours` включает фильтр по часам.
  Вне окна стратегия не открывает новые позиции, но продолжает сопровождать
  существующие.
- **Ограничение объёма** – модуль позиции не превышает `MaxNetVolume`.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `TradeVolume` | Объём заявки при входе. | `1` |
| `CandlesCount` | Количество подряд идущих одинаковых свечей для сигнала. | `3` |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах (0 отключает). | `50` |
| `StopLossPips` | Дистанция стоп-лосса в пунктах (0 отключает). | `50` |
| `TrailingStopPips` | Сдвиг, активирующий трейлинг-стоп (0 отключает). | `10` |
| `TrailingStepPips` | Дополнительное движение, необходимое для подтягивания трейлинга. | `4` |
| `UseTradingHours` | Флаг включения фильтра по времени. | `true` |
| `StartHour` | Начальный час (0–23), когда разрешены новые входы. | `11` |
| `EndHour` | Конечный час (0–23), когда разрешены новые входы. | `18` |
| `MaxNetVolume` | Максимальный модуль позиции. | `2` |
| `CandleType` | Тип свечей для анализа. По умолчанию часовые. | `TimeSpan.FromHours(1)` |

## Рекомендации по использованию
- Стратегия подписывается на свечи через `SubscribeCandles` и может работать с
  любыми инструментами, предоставляющими свечные ряды.
- Так как логика основана на закрытых барах, стратегия хорошо подходит для
  внутридневной и более высокой периодичности, где шум между закрытиями менее
  значим.
- Подбирайте значения тейк-профита, стоп-лосса и трейлинга с учётом шага цены
  конкретного инструмента и текущего спреда.
- Перед запуском на инструментах с широкими или плавающими спредами проверяйте
  параметры трейлинга, чтобы избежать ложных срабатываний.

