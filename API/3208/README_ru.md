# Стратегия маркетмейкера BITEX.ONE

## Обзор
**BitexOneMarketMakerStrategy** — это конверсия эксперта MetaTrader 5 «BITEX.ONE MarketMaker». Стратегия поддерживает симметричные лестницы лимитных заявок вокруг опорной (ведущей) цены и перераспределяет объём так, чтобы итоговая позиция оставалась около заданной цели. Решение предназначено для высокочастотного маркетмейкинга на спотовых или деривативных рынках, где основную доходность дают спред и ребейты биржи.

## Логика торговли
1. Определяет ведущую цену на основе выбранной стороны стакана (bid, ask или midpoint) для торгуемого инструмента или указанного ведущего инструмента.
2. Рассчитывает ценовые смещения для каждого уровня котирования, используя коэффициенты `PriceShift` (горизонтальный сдвиг) и `VerticalShift` (вертикальный сдвиг).
3. Вычисляет, какой объём следует выставить на уровне, с учётом `MaxVolumePerLevel`, текущей `Position` и целевой `DesiredPosition`.
4. Размещает или обновляет лимитные заявки на покупку и продажу по каждому уровню, соблюдая шаг цены и ограничения по объёму.
5. Постоянно отслеживает изменения стакана и статусы заявок. Если цена или объём ушли дальше чем на половину тика/шага, заявка отменяется и выставляется заново.
6. Если остаточного объёма не хватает до минимального лота, стратегия пропускает текущий уровень до тех пор, пока объём не накопится.

## Параметры
- **MaxVolumePerLevel** – максимальный объём (в лотах) на каждом уровне котирования. Одновременно задаёт ширину доступного инвентаря для распределения по сторонам.
- **PriceShift** – относительный коэффициент, определяющий расстояние между уровнями относительно ведущей цены. Например, `0.001` соответствует 0.1% от ведущей цены.
- **VerticalShift** – дополнительный множитель, который смещает обе стороны котировок вверх или вниз.
- **LevelCount** – количество уровней лимитных заявок на каждую сторону.
- **DesiredPosition** – целевая позиция. Положительные значения смещают баланс в сторону покупок, отрицательные — в сторону продаж.
- **LeadSecurityId** – необязательный идентификатор инструмента, от которого берётся ведущая цена (например, индекс или mark). Если оставить пустым, используется торгуемый инструмент.
- **LeadPriceSide** – сторона стакана, используемая как опорная цена: `Bid`, `Ask` или `Midpoint`.

## Подписки на данные
Стратегия подписывается на стакан торгуемого инструмента. Если задан `LeadSecurityId`, дополнительно происходит подписка на стакан ведущего инструмента. Оба потока нужны для расчёта котировок.

## Управление заявками
- Заявки размещаются с помощью `BuyLimit` и `SellLimit`.
- Когда цена или объём отклоняются от нужных значений, заявка отменяется и создаётся заново на следующем цикле.
- После получения статуса «исполнено», «отменено» или «ошибка» заявка немедленно удаляется из внутреннего списка.

## Рекомендации по эксплуатации
- Убедитесь, что выбранные инструменты предоставляют рыночную глубину и корректные шаги цены/объёма.
- Запускайте стратегию после установления соединения и получения потоков данных.
- Настраивайте `MaxVolumePerLevel` и `LevelCount` исходя из лимитов риска и желаемого инвентаря.
- Защиту позиции стратегия активирует один раз при старте; при необходимости добавьте собственные стопы или хедж.

