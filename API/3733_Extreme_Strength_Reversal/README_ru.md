# Стратегия Extreme Strength Reversal

## Краткое описание
- Реверсивная система, перенесённая из советника MetaTrader EXSR.
- Использует экстремальные значения индикаторов Bollinger Bands и RSI для поиска истощения тренда.
- Размер позиции рассчитывается по проценту от капитала, стоп и тейк фиксированы в пунктах (pips).

## Логика торговли
1. Стратегия подписывается на выбранный таймфрейм свечей (по умолчанию 1 час).
2. Для каждой свечи вычисляются полосы Боллинджера (период, отклонение) и RSI.
3. После закрытия свечи:
   - Для покупки: RSI ниже уровня перепроданности, но больше нуля; минимум свечи пробивает нижнюю полосу; свеча закрывается ростом (close > open).
   - Для продажи: RSI выше уровня перекупленности; максимум свечи пробивает верхнюю полосу; свеча закрывается снижением (close < open).
4. Одновременно допускается только одна позиция. При смене направления противоположная позиция закрывается.
5. Стоп-лосс и тейк-профит рассчитываются от цены входа с использованием расстояния в пунктах. На каждой следующей свече проверяется достижение уровней и при срабатывании позиция закрывается.

## Управление рисками
- Если свойство `Volume` стратегии больше нуля, используется фиксированный объём. При нулевом значении объём вычисляется из `RiskPercent` и величины стопа.
- Для расчёта риска применяется текущая стоимость портфеля (резервно — баланс или начальный капитал). Расстояние стопа конвертируется в денежный эквивалент через шаг цены и стоимость шага.
- Итоговый объём нормализуется по минимальному, максимальному и шаговому размеру лота инструмента.

## Параметры
| Название | Описание | Значение по умолчанию |
| -------- | -------- | ---------------------- |
| Risk Percent | Процент капитала под риск в одной сделке. | 1% |
| Stop Loss (pips) | Дистанция стоп-лосса в пунктах. | 150 |
| Take Profit (pips) | Дистанция тейк-профита в пунктах. | 300 |
| Bollinger Period | Количество свечей для расчёта полос Боллинджера. | 20 |
| Bollinger Deviation | Множитель стандартного отклонения. | 2.0 |
| RSI Period | Количество свечей для расчёта RSI. | 14 |
| RSI Overbought | Уровень, обозначающий экстремальную перекупленность RSI. | 80 |
| RSI Oversold | Уровень, обозначающий экстремальную перепроданность RSI. | 20 |
| Candle Type | Таймфрейм свечей для анализа. | 1 час |

## Примечания
- Для корректного расчёта объёма убедитесь, что инструмент предоставляет шаг цены, стоимость шага и шаг объёма; при их отсутствии используются безопасные допущения.
- Управление рисками продолжает работать даже при временно отключённых сделках, поэтому защитные ордера остаются активными.
- Обработка ведётся только по завершённым свечам, что соответствует логике оригинального советника, анализирующего предыдущий бар.
