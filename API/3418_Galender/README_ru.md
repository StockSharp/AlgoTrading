# Стратегия Galender

## Общее описание

**Galender Strategy** переносит функциональность эксперта MQL5 «Galender» в инфраструктуру StockSharp. Стратегия подписывается на поток экономических новостей, отфильтровывает сообщения по диапазону дат, валютам, ключевому слову и важности, после чего фиксирует каждое подходящее событие в хронологическом списке. Таким образом воспроизводится табличный список календаря, доступный в оригинальном советнике.

> **Важно**
> Стратегия носит аналитический характер и не отправляет торговые заявки. Она предназначена для трейдеров, которые контролируют выход макроэкономических показателей непосредственно из терминала на базе StockSharp.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `DateFrom` | Нижняя граница временного диапазона (UTC). Новости с более ранним временем публикации игнорируются. | `2020-07-01T00:00:00Z` |
| `DateTo` | Верхняя граница временного диапазона (UTC). Сообщения с более поздним временем пропускаются. | `2020-09-01T00:00:00Z` |
| `CurrencyFilter` | Список валют через запятую. Стратегия ищет эти коды в заголовке и тексте новости. Пустое значение отключает фильтр. | `USD` |
| `KeywordFilter` | Ключевое слово или фраза, которые должны присутствовать в тексте. Регистр не учитывается. Пустая строка отключает проверку. | `interest` |
| `ImportanceFilter` | Требуемая важность: `None`, `Low`, `Moderate`, `High` или `All`. Определяется по наличию соответствующих меток в тексте новости. | `All` |

## Алгоритм работы

1. **Инициализация.** При запуске стратегия очищает накопленные события и подписывается на новости по выбранному инструменту.
2. **Обработка сообщений.** Каждое входящее сообщение `NewsMessage` проходит проверки:
   - принадлежит ли его время публикации диапазону `DateFrom`–`DateTo`;
   - упоминаются ли нужные валюты в заголовке или тексте;
   - присутствует ли ключевое слово;
   - содержится ли требуемая метка важности (`HIGH`, `MODERATE`, `LOW`, `NONE`).
3. **Сохранение результата.** Подходящие новости преобразуются в записи календаря с указанием времени, валюты, заголовка, словесной оценки влияния (Positive/Negative/None) и фрагментов текста после маркеров `Previous`, `Forecast`, `Actual`. Список записей сортируется по времени.
4. **Логирование.** Для каждого совпадения формируется подробная запись в журнале (на английском языке) со всеми извлечёнными полями.

## Отличия от версии MQL5

- Визуальное окно со списком заменено на журнал, поскольку стратегии StockSharp работают без графического интерфейса.
- Вместо специализированного календаря MetaTrader используется поток новостей провайдера данных. Определение важности основано на ключевых словах в тексте.
- Числовые значения (`Previous`, `Forecast`, `Actual`) извлекаются эвристически. Если формат данных отличается, поля остаются пустыми, что исключает неверные данные.

## Рекомендации по использованию

- Привяжите стратегию к инструменту, соответствующему отслеживаемой валюте, чтобы подписка на новости прошла успешно.
- Перечисляйте несколько валют через запятую (`USD,EUR,GBP`). Фильтр ищет каждую валюту отдельно и учитывает границы слов.
- Значение `ImportanceFilter = All` соответствует режиму «All» из MQL5. Остальные значения ограничивают список по уровню важности.
- Оставьте `KeywordFilter` пустым, если нужно видеть все новости по выбранным валютам.

## Возможные расширения

- Подключить графический интерфейс (WPF, Avalonia) и визуализировать список событий.
- Использовать структурированные поля важности и числовых значений, если их предоставляет поставщик данных.
- Передавать список новостей другим стратегиям и приостанавливать торговлю перед важными событиями.
