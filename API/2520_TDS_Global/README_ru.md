# Стратегия TDS Global
[English](README.md) | [中文](README_cn.md)

Стратегия воспроизводит оригинального советника MetaTrader «TDSGlobal», построенного на концепции Triple Screen Александра
Элдера. Работа ведётся по дневным свечам: направление тренда определяется наклоном MACD (12, 23, 9), а фильтрация входов
осуществляется с помощью Williams %R за 24 периода. Длинные сделки разрешаются, когда MACD растёт и %R указывает на перепроданность,
короткие — когда MACD падает и %R выходит в зону перекупленности.

При появлении сигнала стратегия выставляет отложенный стоп-ордер за максимум или минимум предыдущей свечи. Для сохранения дистанции
до рынка используется настраиваемый буфер (аналог исходного «16 пунктов»). После срабатывания ордера позиция сопровождается
защитным стопом, опциональным тейк-профитом и трейлинг-стопом, измеряемыми в шагах цены.

## Логика торговли

- **Данные**: по умолчанию дневные свечи (можно выбрать другой таймфрейм).
- **Фильтр тренда**: сравниваются два последних значения основной линии MACD. Рост даёт приоритет покупкам, падение — продажам.
- **Осциллятор**: используется предыдущее значение Williams %R. Ниже `WilliamsBuyLevel` (по умолчанию -75) разрешается поиск
  длинных входов, выше `WilliamsSellLevel` (по умолчанию -25) — коротких.
- **Входы**:
  - Long: buy stop на шаг выше максимума предыдущей свечи. Если получившийся уровень ближе к рынку, чем `EntryBufferSteps`
    шагов цены, ордер переносится дальше на требуемое расстояние.
  - Short: sell stop на шаг ниже минимума предыдущей свечи. При недостаточной дистанции уровень смещается на `EntryBufferSteps`
    шагов ниже последнего закрытия.
- **Управление риском**:
  - Стоп-лосс изначально привязывается к противоположному экстремуму предыдущей свечи (минимум для лонга, максимум для шорта).
  - Тейк-профит отстоит на `TakeProfitSteps` шагов цены. Значение 999 имитирует очень далёкую цель исходного советника.
  - Трейлинг-стоп активен при `TrailingStopSteps` > 0 и подтягивается только в прибыльную сторону.
- **Обработка заявок**:
  - При изменении уровней входа или защитных ордеров существующие стоп-заявки отменяются и выставляются заново.
  - Смена направления MACD приводит к отмене неактуальных отложенных ордеров.
  - После открытия позиции сохранённые уровни используются для инициализации рабочего стопа и тейка.
- **Смещение по минутам**: опция `UseSymbolStagger` включает исходную логику распределения минут для пар EURUSD, GBPUSD,
  USDCHF и USDJPY, чтобы ордера не выставлялись одновременно.

## Параметры

- `MacdFastLength`, `MacdSlowLength`, `MacdSignalLength` — периоды MACD для оценки наклона.
- `WilliamsLength` — период расчёта Williams %R.
- `WilliamsBuyLevel`, `WilliamsSellLevel` — пороги перепроданности/перекупленности.
- `EntryBufferSteps` — минимальное смещение входного стоп-ордера от текущей цены (в шагах).
- `TakeProfitSteps` — дистанция до тейк-профита в шагах (уменьшите, чтобы включить фиксированную цель).
- `TrailingStopSteps` — расстояние трейлинг-стопа; 0 отключает сопровождение.
- `UseSymbolStagger` — включает оконные интервалы по инструментам.
- `CandleType` — тип свечей для расчётов.

## Примечания

- Объём контролируется стандартным параметром `Volume`; при отсутствии значения используется 1 лот.
- Отложенные ордера и сопровождение позиций рассчитываются по завершённым свечам, поэтому заполнение между закрытиями
  аппроксимируется сохранённой ценой входа.
- Значение тейк-профита по умолчанию оставлено большим, как у исходного бота; измените его, если нужен конкретный таргет.
