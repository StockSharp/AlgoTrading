# Стратегия AdaptiveTrader Pro

## Общее описание
AdaptiveTrader Pro — это многотаймфреймовая трендовая стратегия, перенесённая из эксперта MetaTrader 5 *AdaptiveTrader_Pro_Final_EA.mq5*. Она сочетает RSI, ATR и две скользящие средние, чтобы торговать по направлению доминирующего тренда и одновременно контролировать риски.

Стратегия работает на настраиваемом основном таймфрейме (по умолчанию 5 минут) и подтверждает направление тенденции с помощью скользящей средней на старшем таймфрейме (по умолчанию 1 час). Сигналы на вход формируются при экстремальных значениях RSI, если цена расположена по правильную сторону обеих скользящих средних.

## Правила торговли
- **Покупка**: RSI опускается ниже 30, а цена закрытия свечи находится выше SMA на основном и старшем таймфреймах.
- **Продажа**: RSI поднимается выше 70, а цена закрытия свечи находится ниже обеих SMA.
- **Одна позиция**: В рынке поддерживается только одна направленная позиция; перед разворотом противоположная позиция закрывается.

## Управление рисками и сделками
- **Размер позиции**: Рассчитывается автоматически из капитала портфеля, доли риска и дистанции стопа на базе ATR.
- **Стопы**: Используется плавающий стоп по ATR, который при движении цены в прибыльную сторону подтягивается к точке безубыточности после достижения заданного множителя ATR.
- **Частичная фиксация**: Доля позиции фиксируется на первом целевом уровне (множитель ATR), остаток управляется трейлинг-стопом.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `MaxRiskPercent` | Процент капитала, рискуемый в одной сделке. | `0.2` |
| `RsiPeriod` | Период RSI на основном таймфрейме. | `14` |
| `AtrPeriod` | Период ATR на основном таймфрейме. | `14` |
| `AtrMultiplier` | Множитель ATR для расчёта изначального стопа. | `1.5` |
| `TrailingStopMultiplier` | Множитель ATR для трейлинг-стопа. | `1.0` |
| `TrailingTakeProfitMultiplier` | Множитель ATR для первой цели по прибыли. | `2.0` |
| `TrendPeriod` | Период SMA на основном таймфрейме. | `20` |
| `HigherTrendPeriod` | Период SMA на старшем таймфрейме. | `50` |
| `BreakEvenMultiplier` | Множитель ATR, при котором стоп переносится в безубыток. | `1.5` |
| `PartialCloseFraction` | Доля позиции, закрываемая на первой цели. | `0.5` |
| `MaxSpreadPoints` | Максимально допустимый спред в шагах цены для открытия сделок. | `20` |
| `CandleType` | Тип свечей основного таймфрейма. | `5-минутные свечи` |
| `HigherCandleType` | Тип свечей старшего таймфрейма. | `1-часовые свечи` |

## Дополнительно
- Стратегия использует высокоуровневый API StockSharp: свечные подписки и привязку индикаторов.
- Контроль спреда выполняется по лучшим котировкам Bid/Ask; если спред превышает лимит, новые сделки не открываются.
- По требованию Python-версия не создаётся.
