# Arttrader Strategy

## Обзор
Arttrader — порт советника MetaTrader 4 `Arttrader_v1_5`. Стратегия работает на часовых свечах и ищет плавные направленные движения, измеряя наклон экспоненциальной скользящей средней (EMA) по ценам открытия. Входы допускаются только при выполнении условий по наклону EMA и положению цены внутри свечи, а специальный фильтр волатильности блокирует сделки после сильных ценовых разрывов на открытии. Управление позицией включает «умный» тайм-аут-стоп, жёсткий аварийный стоп и тейк-профит, а также защиту по недостаточному объёму.

Реализация в StockSharp сохраняет исходные параметры и использует высокоуровневые рыночные приказы. Все расчёты ведутся на закрытых свечах; минутные задержки из оригинального эксперта аппроксимируются сравнением заданного количества минут с фактической длительностью свечи.

## Логика стратегии
### Индикатор
* **EMA по ценам открытия** — единственная EMA с настраиваемым периодом, рассчитываемая по цене открытия свечи. Разница между текущим и предыдущим значением EMA задаёт наклон в пунктах.

### Фильтры
* **Диапазон наклона** — наклон EMA должен находиться между минимальным (`Slope Min`) и максимальным (`Slope Max`) порогами. Слишком слабые и слишком резкие движения игнорируются.
* **Позиционирование внутри свечи** — для покупки требуется закрытие свечи не выше цены открытия и расположение около минимума с учётом допуска `Entry Slip`. Продажи выполняются зеркально относительно максимума. Параметры `Entry Delay` и `Exit Delay` считаются выполненными, если длительность текущей свечи не меньше заданного количества минут.
* **Контроль скачков** — анализирует разницы цен открытия за пять последних свечей. Если единичный разрыв превышает `Big Jump` пунктов или двухсвечный разрыв превышает `Double Jump`, сигналы на текущей свече блокируются.

### Входы
* **Покупка** — исполняется при выполнении всех фильтров, положительном наклоне EMA и отсутствии позиции. Сохранённая синтетическая цена входа корректируется параметром `Spread Adjust`, имитируя исходную поправку на спред.
* **Продажа** — зеркальное условие: требуется отрицательный наклон EMA и отсутствие позиции.

### Выходы
* **Тайм-аут-стоп** — активируется только после выполнения `Exit Delay`. Для длинной позиции цена закрытия должна быть выше цены открытия и близка к максимуму, а убыток в пунктах относительно синтетической цены входа должен превышать `Smart Stop`.
* **Проверка объёма** — если объём предыдущей свечи меньше либо равен `Min Volume`, позиция закрывается на следующей свече.
* **Аварийный стоп / тейк-профит** — при открытии сделки сохраняются уровни аварийного стопа и тейк-профита. Если диапазон свечи достигает одного из уровней, позиция немедленно закрывается.

## Параметры
* **Order Volume** — размер сделки для рыночных приказов.
* **EMA Period** — период EMA по ценам открытия.
* **Big Jump (pips)** — максимально допустимый одномоментный разрыв цен открытия.
* **Double Jump (pips)** — максимально допустимый двухсвечный разрыв цен открытия.
* **Smart Stop (pips)** — расстояние в пунктах для срабатывания тайм-аут-стопа.
* **Emergency Stop (pips)** — жёсткий стоп-лосс, контролируемый на каждой свече.
* **Take Profit (pips)** — фиксированный тейк-профит, контролируемый на каждой свече.
* **Slope Min / Slope Max (pips)** — границы наклона EMA для допуска сделок.
* **Entry Delay (min)** — минимальная длительность свечи до разрешения входа.
* **Exit Delay (min)** — минимальная длительность свечи до разрешения тайм-аут-стопа.
* **Entry Slip / Exit Slip (pips)** — допуски между ценой закрытия и экстремумами при проверке условий.
* **Min Volume** — минимальный объём предыдущей свечи; при его нарушении позиция закрывается.
* **Spread Adjust (pips)** — корректировка синтетической цены входа на спред.
* **Slippage (pips)** — справочная настройка для совместимости с MetaTrader.
* **Candle Type** — тип свечей, используемых для расчётов (по умолчанию часовые).

## Примечания
* В StockSharp сделки открываются и закрываются методами `BuyMarket`/`SellMarket`, что отражает однопозиционный режим оригинального советника.
* Из-за работы по закрытым свечам минутные задержки из MetaTrader заменены сравнением заданных интервалов с фактической длительностью свечи.
* Аварийный стоп и тейк-профит контролируются по максимумам и минимумам свечей, что воспроизводит серверные защитные ордера исходного эксперта.
