# Стратегия AOCCI

## Обзор
AOCCI — это прямой перенос советника MetaTrader 4 «AOCCI». Стратегия комбинирует индикаторы импульса (Awesome Oscillator) и отклонения от среднего (Commodity Channel Index) с дневным пивотом предыдущей сессии. Перенос выполнен на высокоуровневом API StockSharp и сохраняет защитные механизмы оригинала.

## Логика работы
1. **Подготовка данных**
   - Для формирования сигналов используются внутридневные свечи (по умолчанию часовые).
   - Дневные свечи применяются для расчёта пивота предыдущего дня по формуле (High + Low + Close) / 3.
   - Хранятся последние шесть цен открытия внутридневных свечей для контроля крупных гэпов.
2. **Фильтр гэпов**
   - Если разница между соседними открытиями превышает порог *Big Jump Filter*, сигнал пропускается.
   - Если разница между открытиями через одну свечу превышает *Double Jump Filter*, сигнал также игнорируется.
3. **Проверка индикаторов**
   - На текущей свече AO должен быть больше нуля, а CCI — не ниже нуля.
   - На предыдущей свече хотя бы одно условие должно выполняться: AO < 0, CCI ≤ 0 или цена закрытия ниже пивота.
4. **Фильтр направления**
   - Закрытие текущей свечи должно находиться выше пивота.
5. **Правила входа**
   - В оригинальном советнике условие на продажу совпадает с условием на покупку, поэтому реально открываются только длинные позиции. Конвертация сохраняет такую же логику.
   - Объём рыночного ордера задаётся параметром *Order Volume*.
6. **Защитные механизмы**
   - Начальные стоп-лосс и тейк-профит задаются в шагах цены.
   - Опциональный трейлинг-стоп подтягивает стоп, когда цена проходит заданное расстояние в прибыльную сторону.

## Параметры
| Название | Описание |
| --- | --- |
| `CciPeriod` | Период расчёта индикатора CCI (по умолчанию 55). |
| `SignalCandleOffset` | Дополнительное смещение при обращении к историческим дневным свечам (по умолчанию 0). |
| `StopLossPoints` | Размер стоп-лосса в шагах цены. |
| `TakeProfitPoints` | Размер тейк-профита в шагах цены. |
| `TrailingStopPoints` | Дистанция трейлинг-стопа в шагах цены (0 — отключен). |
| `BigJumpPoints` | Максимально допустимый гэп между соседними открытиями в шагах цены. |
| `DoubleJumpPoints` | Максимально допустимый совокупный гэп между открытиями через одну свечу. |
| `OrderVolume` | Объём заявок при входе в позицию. |
| `CandleType` | Тип внутридневных свечей (по умолчанию часовые). |
| `DailyCandleType` | Тип дневных свечей для расчёта пивота. |

## Рекомендации по использованию
- Необходимо подписывать стратегию одновременно на внутридневные и дневные данные.
- Минимальный шаг цены инструмента используется для пересчёта параметров, заданных в пунктах.
- Управление трейлинг-стопом выполняется по факту закрытия свечи, что соответствует поведению MQL4 версии.
- Поскольку исходный советник не открывает короткие позиции, портированная стратегия также работает только в длинную сторону.
