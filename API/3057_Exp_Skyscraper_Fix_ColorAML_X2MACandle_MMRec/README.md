# Exp Skyscraper Fix + ColorAML + X2MA Candle MMRec Strategy

## Overview
- C# conversion of the MetaTrader expert **Exp_Skyscraper_Fix_ColorAML_X2MACandle_MMRec**.
- Combines three independent colour-based filters (Skyscraper Fix channel, ColorAML adaptive level, X2MA double-smoothed candles).
- Each filter can open or close trades on its own while sharing the same symbol, enabling cooperative trend following and rapid reversals.
- Includes a simplified money management module: when the latest trades of one direction lose repeatedly the module switches to the reduced volume (`SmallMM`).

## Strategy Logic
### Skyscraper Fix Block
1. Builds the Skyscraper Fix trailing channel by analysing the ATR range and the chosen price source (high/low or close).
2. When the channel colour turns bullish the block:
   - closes any outstanding short position (if `Skyscraper Close Shorts` is enabled);
   - may open a new long position after the configured signal delay (if `Skyscraper Buy` is enabled).
3. When the colour turns bearish the logic mirrors the steps for short trades.
4. The high/low envelopes, ATR multiplier (`Kv`) and percentage offset reproduce the behaviour of the original indicator.

### ColorAML Block
1. Calculates the Adaptive Market Level (AML) by measuring the range of two consecutive fractal windows and smoothing the composite price.
2. The indicator outputs three colours: `2` (bullish), `0` (bearish) and `1` (neutral). Neutral candles do not trigger any action.
3. A bullish colour closes shorts (if allowed) and may open a long when the colour changed away from bullish on the previous inspected candle.
4. A bearish colour performs the symmetric actions for short trades.

### X2MA Candle Block
1. Cascades two configurable moving averages over each OHLC component (open, high, low, close) to build a synthetic candle.
2. The colour is determined by the smoothed candle body: bullish when close > open, bearish when close < open, neutral otherwise.
3. A small gap threshold (in price steps) flattens very small candle bodies to avoid rapid colour flips.
4. Bullish colours close shorts and can open longs, bearish colours perform the opposite.

### Money Management
1. Each block keeps an independent history of its own trades for long and short directions.
2. After a trade is closed the module records whether it ended with a loss.
3. If the last `Loss Trigger` trades for a direction were all losses, the next order from that block switches to the reduced volume (`SmallMM`).
4. When a profitable or neutral trade breaks the losing streak the module automatically returns to the normal volume (`MM`).

## Parameters
| Section | Name | Description | Default |
| --- | --- | --- | --- |
| Skyscraper | `Skyscraper Candle` | Timeframe used to sample candles for the Skyscraper Fix indicator. | 4h |
| Skyscraper | `Skyscraper Length` | ATR averaging window (number of candles). | 10 |
| Skyscraper | `Skyscraper Kv` | Sensitivity multiplier applied to the ATR step. | 0.9 |
| Skyscraper | `Skyscraper Percentage` | Additional percentage added to/removed from the midline. | 0 |
| Skyscraper | `Skyscraper Mode` | Price source (High/Low or Close) used for envelopes. | High/Low |
| Skyscraper | `Skyscraper Signal Bar` | Number of already closed candles to wait before acting on a colour. | 1 |
| Skyscraper | `Skyscraper Buy` / `Skyscraper Sell` | Allow opening long / short trades. | true |
| Skyscraper | `Skyscraper Close Long` / `Skyscraper Close Short` | Allow this block to exit long / short trades. | true |
| Skyscraper | `Skyscraper Normal Volume` | Base order volume (`MM` in the EA). | 0.1 |
| Skyscraper | `Skyscraper Reduced Volume` | Reduced order volume used after a loss streak (`SmallMM`). | 0.01 |
| Skyscraper | `Skyscraper Buy Loss Trigger` / `Skyscraper Sell Loss Trigger` | Number of consecutive losses that switch to the reduced volume. | 2 |
| ColorAML | `ColorAML Candle` | Candle type used by the ColorAML indicator. | 4h |
| ColorAML | `ColorAML Fractal` | Fractal window (in bars) used for the range calculation. | 6 |
| ColorAML | `ColorAML Lag` | Lag parameter that controls the adaptive smoothing. | 7 |
| ColorAML | `ColorAML Signal Bar` | Candle offset applied before evaluating colours. | 1 |
| ColorAML | `ColorAML Buy` / `ColorAML Sell` | Enable long / short entries generated by ColorAML. | true |
| ColorAML | `ColorAML Close Long` / `ColorAML Close Short` | Allow ColorAML to close long / short positions. | true |
| ColorAML | `ColorAML Normal Volume` / `ColorAML Reduced Volume` | Base and reduced volumes for this block. | 0.1 / 0.01 |
| ColorAML | `ColorAML Buy Loss Trigger` / `ColorAML Sell Loss Trigger` | Consecutive losses that activate the reduced volume. | 2 |
| X2MA | `X2MA Candle` | Timeframe used for the X2MA candle reconstruction. | 4h |
| X2MA | `First Method` / `Second Method` | Smoothing methods for the first and second moving averages. | SMA / JJMA |
| X2MA | `First Length` / `Second Length` | Periods of the two smoothing stages. | 12 / 5 |
| X2MA | `First Phase` / `Second Phase` | Compatibility phases used by Jurik moving averages. | 15 |
| X2MA | `Gap Points` | Gap threshold (in price steps) that flattens small candle bodies. | 10 |
| X2MA | `X2MA Signal Bar` | Candle offset applied before reacting to colours. | 1 |
| X2MA | `X2MA Buy` / `X2MA Sell` | Allow opening long / short trades from the X2MA block. | true |
| X2MA | `X2MA Close Long` / `X2MA Close Short` | Allow the block to exit long / short positions. | true |
| X2MA | `X2MA Normal Volume` / `X2MA Reduced Volume` | Base and reduced volumes for X2MA trades. | 0.1 / 0.01 |
| X2MA | `X2MA Buy Loss Trigger` / `X2MA Sell Loss Trigger` | Number of consecutive losses before switching to the reduced volume. | 2 |

## Usage Tips
1. Adjust candle types to match the market's volatility (e.g., 1h for intraday trading, 4h for swing trading).
2. The three modules can be tuned independentlyâ€”disabling one block still leaves the others active.
3. The money management thresholds are intentionally conservative. Increase the triggers if the instrument trends strongly and you want to maintain the base volume longer.
4. Because the strategy relies on finished candles, always feed it with candle data that matches the configured timeframes.
