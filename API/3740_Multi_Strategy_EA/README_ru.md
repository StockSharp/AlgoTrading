# MultiStrategyEA v1.2 (порт для StockSharp)

## Обзор
Эта стратегия представляет собой порт советника **MultiStrategyEA v1.2** с платформы MetaTrader на высокоуровневый API StockSharp. В оригинальной реализации используется семь осцилляторов, несколько сеток ордеров, восстановление позиций и автоматический манименеджмент. В портированной версии основное внимание уделено генерации сигналов: стратегия управляет одной совокупной позицией и принимает решения на основе согласия модулей. Сетки, усреднение, профили лотов и другие сервисные блоки MT5 намеренно опущены, чтобы сохранить простоту и совместимость с Designer/Runner.

## Модули
Стратегия рассчитывает следующие индикаторы на выбранном таймфрейме:

1. **Acceleration/Deceleration Oscillator (AC)** – разница между Awesome Oscillator и его SMA(5). Сигнал формируется, когда значение превышает `AcLevel` и продолжает расти/падать относительно предыдущего бара.
2. **Average Directional Index (ADX)** – подтверждает тренд, если ADX выше `AdxTrendLevel`, а доминирующее направление (+DI или –DI) превышает `AdxDirectionalLevel`.
3. **Awesome Oscillator (AO)** – фиксирует импульс при пересечении порога `AoLevel` с дальнейшим движением в ту же сторону.
4. **DeMarker** – отслеживает развороты при выходе из зон перепроданности (`100 - DeMarkerThreshold`) и перекупленности (`DeMarkerThreshold`).
5. **Force Index + Bollinger Bands** – требует касания полос Боллинджера и одновременного подтверждения импульса Force Index выше `ForceConfirmationLevel`. Параметр `BandDistanceFilter` задаёт минимальную/максимальную ширину полос (в пипсах).
6. **Money Flow Index (MFI)** – аналогично DeMarker, но использует денежные потоки.
7. **MACD + Stochastic** – объединяет MACD (`MacdLevel`) и Stochastic (`StochasticLevel`): обе кривые должны указывать в одну сторону (MACD относительно сигнальной линии, Stochastic относительно линии %D).

Каждый модуль отдаёт голос «покупка», «продажа» или «нет сигнала» для последней завершённой свечи.

## Логика консенсуса
- При `TradeAllStrategies = true` стратегия ждёт, пока количество голосов «покупка» (или «продажа») не достигнет `RequiredConfirmations`, причём противоположных голосов быть не должно.
- При `TradeAllStrategies = false` достаточно одного голоса.
- Если активирован `CloseInReverse`, противоположная позиция закрывается до открытия новой.

Порт работает только с одной чистой позицией и не пытается воссоздать раздельный учёт заявок по каждому модулю, как в MT5.

## Управление рисками
- `StopLossPips` и `TakeProfitPips` конвертируются в цену через `PriceStep`. Для инструментов с 3/5 знаками после запятой размер пипса автоматически умножается на 10.
- Стопы и цели проверяются на закрытых свечах по максимуму/минимуму. При достижении уровня вся позиция закрывается.

## Отличия от версии MT5
- Нет сеток, мартингейла и восстановления объёмов — размер сделки задаётся параметром `Volume`.
- Варианты закрытия (`CloseOrdersType`) не реализованы; выход выполняется по стопу/тейку или при перевороте сигнала (если включён `CloseInReverse`).
- Для каждого модуля реализована наиболее распространённая логика вместо многочисленных режимов, присутствующих в оригинальном коде.
- Блоки автолотов, контроля прибыли по символам и защитных алгоритмов опущены.

## Параметры
| Параметр | Описание |
|----------|----------|
| `CandleType` | Таймфрейм свечей для всех индикаторов. |
| `Volume` | Объём сделки при срабатывании консенсуса. |
| `TradeAllStrategies` | Включает требование согласия нескольких модулей. |
| `RequiredConfirmations` | Количество совпадающих голосов для входа при включённом консенсусе. |
| `CloseInReverse` | Закрывать текущую позицию перед разворотом. |
| `StopLossPips` / `TakeProfitPips` | Стоп-лосс и тейк-профит в пипсах. |
| Настройки `UseAcModule`, `AcLevel` и т.д. | Управляют соответствующими индикаторными модулями (порогами, периодами, коэффициентами). |

## Рекомендации по использованию
1. Обеспечьте наличие истории для формирования всех индикаторов.
2. Настройте таймфрейм и пороги под свой рынок; значения по умолчанию соответствуют входным параметрам MT5.
3. При отключении модулей снизьте `RequiredConfirmations`, чтобы стратегия продолжила генерировать сигналы.
4. Порт торгует одной позицией и подходит для Designer, Runner и других инструментов StockSharp без дополнительной маршрутизации.

## Примечание
Результаты будут отличаться от оригинального советника из-за отсутствия сеток и сложного манименеджмента. Порт создан как отправная точка для дальнейшей адаптации в экосистеме StockSharp, поэтому акцент сделан на повторении логики сигналов и прозрачности параметров.
