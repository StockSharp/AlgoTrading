# HPCS Inter4 策略 (3518)

## 概述

该策略将 MetaTrader 专家顾问“_HPCS_IntFourth_MT4_EA_V01_WE”移植到 StockSharp 高级 API。原版脚本在启动后立即建立多头仓位，按照 MetaTrader 点（pip）设置止损和止盈，并在持仓时间达到预设阈值后强制平仓。C# 版本通过保护管理器与 1 秒计时器的组合，完整复刻了上述流程。

## 交易逻辑

1. **初始化阶段**
   - 启动时根据交易品种的 `PriceStep` 与小数位数计算 MetaTrader 点值（对于 5 位或 3 位报价的品种会乘以 10）。
   - 调用 `StartProtection` 设置止损和止盈距离，其中止损距离包含原 EA 中使用 `OrderModify` 添加的额外缓冲。
   - 交易量固定，由 `OrderVolume` 参数提供。

2. **入场**
   - 策略启动后立即发送一张市价买单，不再追加新的建仓指令。
   - 当收到首笔成交时记录成交时间，用于后续的持仓计时。

3. **出场**
   - 计时器每秒检查一次当前仓位状态。
   - 当持仓时间达到 `CloseDelaySeconds` 指定的阈值且仍持有多头时，发送市价卖单强制平仓。
   - 止损与止盈由保护管理器维护，并使用市价方式执行，与原脚本中调用 `OrderClose` 的行为一致。

整体逻辑仅参与做多，与 MetaTrader 原策略保持一致。

## 参数

| 名称 | 说明 | 默认值 | 可优化 |
| --- | --- | --- | --- |
| `OrderVolume` | 发送初始市价买单时使用的固定交易量。 | `1` | 否 |
| `StopLossPips` | 初始止损的 MetaTrader 点距离。 | `10` | 否 |
| `ExtraStopPips` | 建仓后额外再向下调整的 MetaTrader 点数。 | `10` | 否 |
| `TakeProfitPips` | 止盈目标的 MetaTrader 点距离。 | `10` | 否 |
| `CloseDelaySeconds` | 持仓达到该秒数后触发强制平仓，`0` 表示关闭该功能。 | `30` | 否 |

## 实现细节

- 点值计算会在 3 位或 5 位报价品种上乘以 10，以匹配 MetaTrader 的 pip 定义。
- `StartProtection` 以 `UnitTypes.Price` 为单位管理止损和止盈，并使用市价平仓方式复现原始脚本。
- 在 `OnNewMyTrade` 中记录首次买入成交时间，并在仓位完全平掉时重置状态，确保计时逻辑正确运行。
- 采用 1 秒周期的计时器来模拟原脚本 `OnTick` 中的时间检查，即便市场暂时没有报价也能继续倒计时。
- 源码中的注释全部为英文，遵循仓库的统一规范。
