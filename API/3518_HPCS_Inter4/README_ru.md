# Стратегия HPCS Inter4 (3518)

## Обзор

Данная стратегия переносит советника MetaTrader "_HPCS_IntFourth_MT4_EA_V01_WE" на высокоуровневый API StockSharp. Оригинальный скрипт мгновенно открывает длинную позицию, выставляет защитные уровни в метатрейдеровских пунктах (pip) и закрывает сделку после короткого промежутка времени. В версии на C# те же действия выполняются с помощью встроенного менеджера защитных ордеров и таймера с периодом в одну секунду, который отслеживает время с момента входа.

## Логика торговли

1. **Инициализация**
   - При запуске определяется размер MetaTrader-пункта на основе `PriceStep` инструмента и количества десятичных знаков (для 5- и 3-значных котировок применяется множитель 10).
   - Метод `StartProtection` настраивается с учётом выбранных дистанций для тейк-профита и стоп-лосса. В стоп включена дополнительная «просадка», которую оригинальный советник применял через `OrderModify`.
   - Объём сделки фиксированный и задаётся параметром `OrderVolume`.

2. **Вход**
   - Сразу после старта отправляется одна рыночная заявка на покупку. Повторных входов не происходит.
   - После получения первой сделки запоминается время исполнения для дальнейшего контроля.

3. **Выход**
   - Таймер проверяет состояние позиции каждую секунду.
   - Когда длительность удержания достигает `CloseDelaySeconds`, стратегия закрывает длинную позицию рыночной продажей при наличии открытого объёма.
   - Защитные стоп-лосс и тейк-профит автоматически поддерживаются менеджером защиты и исполняются по рынку, как и в исходном советнике через `OrderClose`.

Стратегия работает только в длинную сторону, полностью повторяя оригинал.

## Параметры

| Имя | Описание | Значение по умолчанию | Оптимизация |
| --- | --- | --- | --- |
| `OrderVolume` | Фиксированный объём для стартовой рыночной покупки. | `1` | Нет |
| `StopLossPips` | Базовая дистанция стоп-лосса в MetaTrader-пунктах. | `10` | Нет |
| `ExtraStopPips` | Дополнительный отступ стопа, применяемый после входа. | `10` | Нет |
| `TakeProfitPips` | Дистанция тейк-профита в MetaTrader-пунктах. | `10` | Нет |
| `CloseDelaySeconds` | Количество секунд до принудительного закрытия позиции (`0` отключает таймер). | `30` | Нет |

## Особенности реализации

- Расчёт размера пункта умножает `PriceStep` на 10 для инструментов с 3 или 5 десятичными знаками, чтобы параметры сохраняли масштаб MetaTrader.
- `StartProtection` использует расстояния типа `UnitTypes.Price`, поэтому защитные выходы выполняются рыночными заявками и повторяют поведение `OrderClose`.
- В `OnNewMyTrade` сохраняется время первой покупки и сбрасывается состояние после полного выхода из позиции, что позволяет корректно отсчитывать задержку.
- Таймер с шагом в одну секунду заменяет проверку `OnTick`, поэтому логика продолжает работать даже при отсутствии новых котировок.
- Все комментарии в исходном коде написаны на английском языке в соответствии с требованиями репозитория.
