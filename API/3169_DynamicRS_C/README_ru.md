# Стратегия DynamicRS_C
[English](README.md) | [中文](README_cn.md)

Эта стратегия переносит советник MetaTrader **Exp_DynamicRS_C** на высокоуровневый API StockSharp. Она анализирует переходы цветов пользовательского индикатора DynamicRS_C, чтобы отслеживать динамическую поддержку и сопротивление. Когда линия окрашивается в пурпурный цвет (индекс `0`), стратегия рассматривает сигнал на покупку, а при переходе к синему фону (индекс `2`) — сигнал на продажу. Порт сохранит исходные параметры сигналов, флаги разрешений и логику стопов/тейков из оригинального робота.

## Подробности

- **Условия входа**:
  - **Покупка**: Закрытая свеча, выбранная параметром `SignalBar`, меняет цвет индикатора с любого, кроме `0`, на `0`. При этом стратегия закрывает открытую короткую позицию (если разрешено `AllowSellExit`) и затем открывает длинную позицию, если активирован `AllowBuyEntry`.
  - **Продажа**: Рассматриваемая свеча меняет цвет индикатора с любого, кроме `2`, на `2`. Стратегия закрывает длинную позицию (при включённом `AllowBuyExit`) и затем открывает короткую при разрешении `AllowSellEntry`.
- **Направления торговли**: Работа в обе стороны рынка с независимыми переключателями для входов и выходов.
- **Условия выхода**:
  - Длинные позиции закрываются при появлении сигнала на продажу и включённом `AllowBuyExit`, либо при срабатывании стоп-лосса/тейк-профита.
  - Короткие позиции закрываются при появлении сигнала на покупку и включённом `AllowSellExit`, либо при достижении защитных уровней.
- **Стопы**: `StopLossPoints` и `TakeProfitPoints` задают абсолютные смещения цены от точки входа. Нулевое значение отключает соответствующий лимит.
- **Фильтры**:
  - `SignalBar` определяет, сколько закрытых свечей назад анализируется изменение цвета. Это повторяет вызов `CopyBuffer(..., SignalBar, 2)` из MQL.
  - `CandleType` задаёт таймфрейм, на котором работают индикатор и торговая логика (по умолчанию 4 часа, как в советнике).

## Параметры

- `CandleType` – Ряд свечей, обрабатываемых стратегией.
- `Length` – Глубина истории для сравнения максимумов и минимумов индикатором DynamicRS_C (`Length` в MQL).
- `SignalBar` – Количество завершённых свечей назад для поиска сигнала (аналог входного параметра `SignalBar`).
- `AllowBuyEntry` / `AllowSellEntry` – Разрешение на открытие длинных/коротких позиций при соответствующем сигнале.
- `AllowBuyExit` / `AllowSellExit` – Разрешение на закрытие существующих длинных/коротких позиций при появлении противоположного сигнала.
- `StopLossPoints` – Абсолютное расстояние для фиксации убытка относительно цены входа. Положительное значение закрывает лонг ниже и шорт выше входа.
- `TakeProfitPoints` – Абсолютное расстояние для фиксации прибыли. Положительное значение закрывает лонг выше и шорт ниже цены входа.
- `Volume` – Базовый объём сделок из `Strategy.Volume`. При реверсе автоматически добавляется объём для закрытия противоположной позиции.

## Логика индикатора

Встроенный `DynamicRsCIndicator` полностью воспроизводит буферную логику MetaTrader:

- Хранятся последние максимумы и минимумы за период `Length`, а также значения предыдущей свечи.
- Если локальный максимум ниже предыдущего максимума и ниже максимума `Length` свечей назад, а также ниже предыдущего значения индикатора, буфер переключается на цвет `0`, и значение приравнивается к этому максимуму.
- Если локальный минимум выше предыдущего минимума и выше минимума `Length` свечей назад, и при этом выше предыдущего значения индикатора, буфер принимает цвет `2`, а значение переходит к этому минимуму.
- В остальных случаях индикатор удерживает предыдущее значение. Нейтральный цвет `1` служит промежуточным состоянием между трендами, точно как в исходном алгоритме.

Через привязку `BindEx` стратегия получает одновременно числовое значение и дискретный индекс цвета, что обеспечивает совпадение моментов сигналов и торговли с поведением оригинального советника.
