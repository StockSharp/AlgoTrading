# Стратегия LCS MACD Trader

Стратегия представляет собой портирование советника "LCS-MACD-Trader" для MetaTrader 4 на StockSharp. Торговля ведётся по пересечениям MACD ниже/выше нулевой линии с опциональным подтверждением индикатором Стохастик. Реализованы исходные торговые сессии и логика трейлинга/перевода в безубыток, характерная для MetaTrader.

## Логика работы

- Покупка выполняется, когда линия MACD пересекает сигнал снизу в отрицательной зоне. При активном фильтре требуется, чтобы за указанное количество свечей %D находилась выше %K и на текущей свече вновь опустилась ниже.
- Продажа выполняется, когда линия MACD пересекает сигнал сверху в положительной зоне. При включённом фильтре %D должна недавно быть ниже %K и на текущей свече подняться обратно выше неё.
- Сделки разрешены только внутри трёх настраиваемых внутридневных окон, соответствующих настройкам оригинального советника.
- Значения стопов, тейк-профита, перевода в безубыток и трейлинга задаются в пунктах и автоматически переводятся в цену согласно шагу инструмента.
- StockSharp использует неттинг: одновременное удержание разнонаправленных позиций не поддерживается. Наращивание в сторону сигнала разрешено вплоть до лимита `MaxOrders`, противоположные сигналы ожидают закрытия текущей позиции правилами управления риском.

## Параметры

| Имя | Описание | По умолчанию |
| --- | --- | --- |
| `CandleType` | Тип свечей для расчётов. | Таймфрейм 15 минут |
| `FastEmaPeriod` | Период быстрой EMA в MACD. | 12 |
| `SlowEmaPeriod` | Период медленной EMA в MACD. | 26 |
| `SignalPeriod` | Период сигнальной линии MACD. | 9 |
| `UseStochasticFilter` | Требовать подтверждение стохастиком. | true |
| `BarsToCheckStochastic` | Количество свечей, в течение которых должна наблюдаться противоположная связь %K/%D. | 5 |
| `StochasticKPeriod` | Период расчёта %K. | 5 |
| `StochasticDPeriod` | Период сглаживания %D. | 3 |
| `StochasticSlowing` | Дополнительное сглаживание %K. | 3 |
| `TradeVolume` | Объём сделки. | 0.1 |
| `TakeProfitPips` | Тейк-профит в пунктах. | 100 |
| `StopLossPips` | Стоп-лосс в пунктах. | 100 |
| `MaxOrders` | Максимальное количество добавлений к позиции. | 5 |
| `EnableTrailing` | Включить трейлинг стоп. | false |
| `TrailingActivationPips` | Прибыль для активации трейлинга (в пунктах). | 50 |
| `TrailingDistancePips` | Расстояние трейлинг-стопа (в пунктах). | 25 |
| `BreakEvenActivationPips` | Прибыль для перевода в безубыток. | 25 |
| `BreakEvenOffsetPips` | Добавочные пункты при установке стопа в безубыток. | 1 |
| `Session1Start/End`, `Session2Start/End`, `Session3Start/End` | Внутридневные торговые окна. | 08:15-08:35, 13:45-14:42, 22:15-22:45 |

## Примечания

- Стратегия рассчитана на неттинговый режим работы. Как и в оригинальном советнике, закрытие позиций происходит за счёт стопов, перевода в безубыток и трейлинга, но без одновременных разнонаправленных сделок.
- Конвертация пунктов автоматически учитывает шаг цены инструмента и корректно масштабирует значения для пятизначных валютных пар.
- Проверка условий трейлинга и безубытка выполняется на закрытых свечах, при этом используются максимум и минимум свечи для имитации тикового исполнения MetaTrader.
