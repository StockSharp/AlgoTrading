# Стратегия Explosion

Стратегия повторяет логику советника MetaTrader «Explosion». Она отслеживает диапазон каждой завершённой свечи и входит в рынок, когда очередной бар «взрывается» — его высота более чем вдвое превышает диапазон предыдущей свечи. Направление сделки задаётся телом свечи: бычье тело открывает покупку, медвежье — продажу.

## Правила торговли

1. Обрабатываются только завершённые свечи из подписки `CandleType`.
2. Текущий диапазон рассчитывается как `High - Low` и сравнивается с диапазоном предыдущей свечи.
3. **Покупка** открывается, когда `currentRange > previousRange * 2`, а закрытие выше открытия.
4. **Продажа** открывается, когда `currentRange > previousRange * 2`, а закрытие ниже открытия.
5. При включённом `OnlyOnePositionPerBar` допускается не более одной сделки на время открытия свечи. Повторные сигналы в рамках того же бара игнорируются.
6. Стратегия работает с единой нетто-позицией, поэтому встречная сделка автоматически закрывает текущую экспозицию и затем разворачивается в новую сторону.
7. Защитные механизмы:
   - `StopLossPips` и `TakeProfitPips` задают виртуальные уровни выхода в пунктах от цены входа.
   - `TrailingStopPips` и `TrailingStepPips` подтягивают стоп после прохождения ценой заданной дистанции и каждого дополнительного шага.
   - Опциональный множитель пунктов имитирует MQL-функцию автоопределения разрядности, умножая размер пункта на 10 для инструментов с 3 и 5 знаками после запятой.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `TradeVolume` | `0.01` | Объём рыночных заявок при входе. |
| `StopLossPips` | `20` | Расстояние до стоп-лосса в пунктах. Ноль отключает уровень. |
| `TakeProfitPips` | `10` | Расстояние до тейк-профита в пунктах. Ноль отключает уровень. |
| `TrailingStopPips` | `25` | Дистанция активации трейлинг-стопа в пунктах. Ноль отключает трейлинг. |
| `TrailingStepPips` | `5` | Дополнительное движение в пунктах перед очередным подтягиванием стопа. Должно быть положительным при включённом трейлинге. |
| `UseAutoPipMultiplier` | `true` | Умножать размер пункта на 10 для инструментов с 3 или 5 десятичными знаками. |
| `OnlyOnePositionPerBar` | `true` | Запретить более одной сделки на одну свечу. |
| `CandleType` | `TimeSpan.FromMinutes(1).TimeFrame()` | Тип свечей, используемых в расчётах. |

## Особенности конверсии

- StockSharp использует неттинг, поэтому удержание одновременных разнонаправленных ордеров, возможное в оригинальном советнике, не поддерживается. Поведение соответствует включённому параметру `OnlyOneOpenedPos` в MQL.
- Трейлинг-стоп обновляется по закрытиям свечей, а не по каждому тику. Пороговые условия идентичны оригиналу и совместимы с высокоуровневым API.
- Множитель пунктов воспроизводит автоматическое определение разрядности и масштабирует расстояния на инструментах с пятизначными котировками.

## Рекомендации по применению

1. Выберите инструмент и таймфрейм, соответствующие оригинальному советнику (например, M15/M30 по валютным парам).
2. Настройте параметры риск-менеджмента в пунктах согласно волатильности выбранного инструмента.
3. Включите логирование, чтобы отслеживать моменты подтягивания трейлинг-стопа и пересчёта защитных уровней.
