# Простая панель хеджирования
[English](README.md) | [中文](README_cn.md)

Стратегия «Простая панель хеджирования» переносит функциональность советника MetaTrader 5 Simple Hedge Panel в инфраструктуру StockSharp. В оригинале трейдер настраивал до пяти блоков сделок: для каждого выбирался инструмент, объём и направление. Кнопка «Open Hedge Positions» открывала рыночные позиции по всем заполненным блокам, а кнопка «Close Hedge Positions» закрывала их. В данной реализации запуск стратегии выполняет роль кнопки открытия, а остановка стратегии или ручной вызов метода закрытия полностью повторяют логику исходной панели.

Это решение предназначено для полуавтоматической работы. В нём нет расчёта индикаторов и свечных фильтров — стратегия лишь помогает быстро выставить серию рыночных ордеров с заранее заданными параметрами. Такой подход удобен при хеджировании коррелированных инструментов, при распределении объёма между несколькими активами или при ручном балансировании портфеля между длинными и короткими позициями.

## Порядок работы

1. Укажите количество активных слотов от 1 до 5 через параметр `Slots`.
2. Для каждого слота заполните:
   - Инструмент (`Slot N Security`).
   - Объём сделки в лотах (`Slot N Volume`).
   - Направление (`Slot N Buy`: `true` — покупка, `false` — продажа).
3. Назначьте портфель и, при необходимости, основной инструмент стратегии — он используется, если конкретный слот оставлен без выбранного инструмента.
4. Запустите стратегию. Все корректно настроенные слоты отправят рыночные ордера одновременно, как и при нажатии кнопки открытия в MT5.
5. Остановите стратегию или вызовите метод `CloseConfiguredPositions()`, чтобы закрыть позиции по выбранным слотам. Метод можно запускать и во время работы стратегии для имитации кнопки закрытия.

## Параметры

- **Slots** — количество обрабатываемых слотов. Значения вне диапазона 1–5 автоматически ограничиваются, что фиксируется в журнале.
- **Slot N Security** — инструмент для слота. Если оставить поле пустым, стратегия использует инструмент из свойства `Security`.
- **Slot N Volume** — объём рыночного ордера. Для отправки заявки значение должно быть больше нуля.
- **Slot N Buy** — направление сделки: `true` — покупка, `false` — продажа.

Каждый слот работает независимо. Вы можете сочетать покупки и продажи по разным инструментам. Если слот заполнен некорректно, стратегия пропускает его и выводит пояснение в лог, поэтому оператор сразу видит причину.

## Логика торговли

- Заявки отправляются только при наличии назначенного портфеля. Если портфель не выбран, выводится сообщение об ошибке, и торговля не выполняется.
- Проверка параметров выполняется при каждом открытии или закрытии. Ошибки в одном слоте не мешают обработке остальных.
- Флаг `_positionsOpened` предотвращает повторную отправку тех же ордеров до тех пор, пока позиции не будут закрыты, что полностью соответствует ручной работе с панелью.
- `CloseConfiguredPositions()` ищет текущий размер позиции по каждому инструменту и отправляет рыночную заявку на закрытие, когда остаток отличается от нуля. Метод доступен в любой момент времени.

## Дополнительные замечания

- Стратегия не подписывается на свечи и индикаторы, потому что целиком ориентирована на ручной ввод параметров.
- Возможно использовать один и тот же инструмент в нескольких слотах или совмещать уникальные активы с инструментом по умолчанию.
- Все сервисные сообщения выводятся на английском языке, чтобы соответствовать общим требованиям к стратегиям.
- Параметры слотов не предназначены для оптимизации — решение рассчитано на живые торговые сессии, где трейдер сам инициирует открытие и закрытие позиций.
