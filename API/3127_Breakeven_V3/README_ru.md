# Менеджер Breakeven v3

## Обзор
Менеджер Breakeven v3 — порт советника MetaTrader 5 `Breakeven v3 (barabashkakvn's edition)`.
Стратегия не открывает сделки. Вместо этого она непрерывно рассчитывает цену безубыточности по выбранному инструменту
и сдвигает защитные ордера (стоп-лосс или тейк-профит) для всех открытых длинных и коротких позиций так, чтобы весь портфель
закрывался рядом с этой ценой с учётом заданного зазора.

## Логика стратегии
* **Восстановление безубыточности** – при каждом исполнении заявки или обновлении котировки заново вычисляется
  взвешенная средняя цена для длинных и коротких позиций. Учёт комиссий ведётся через данные `MyTrade`, что повторяет
  поведение оригинального MQL-советника.
* **Расчёт целевой цены** – к цене безубыточности прибавляется или вычитается параметр `Delta (points)` в пунктах MetaTrader.
  При положительной чистой позиции смещение добавляется, при отрицательной — вычитается, что полностью соответствует
  параметру Delta исходного кода.
* **Установка защитных ордеров** –
  * При чистом лонге выставляется **sell limit** тейк-профит на общий объём длинных позиций и **buy stop** стоп-лосс
    на суммарный объём коротких позиций по той же цене.
  * При чистом шорте ставится **buy limit** тейк-профит на весь шорт и **sell stop** стоп-лосс для длинных хеджей.
  * Если суммарная позиция равна нулю, все защитные заявки отменяются.
* **Мониторинг котировок и диагностика** – подписка на Level1 используется для расчёта расстояния до цели и оценки
  текущей плавающей прибыли. При включённом `Enable Logging` значения пишутся в журнал стратегии, имитируя вывод комментариев
  на графике MetaTrader.

## Параметры
* **Delta (points)** – смещение относительно цены безубыточности в пунктах MetaTrader (для пятизнаковых котировок — 0.1 пипса).
  Значение по умолчанию: `100`.
* **Enable Logging** – включает подробный лог с информацией о текущей безубыточности, расстоянии до цели и плавающей прибыли.
  Значение по умолчанию: `true`.

## Рекомендации по использованию
* Стратегия является менеджером позиций. Её следует запускать поверх существующих сделок или другого алгоритма.
  Рыночные ордера она не отправляет.
* При старте считываются открытые позиции в портфеле и создаются синтетические лоты по каждой стороне с использованием
  средней цены из StockSharp. Чтобы поддерживать точность, держите стратегию запущенной при появлении новых сделок.
* Платформа не предоставляет данные о свапах, поэтому в расчёте безубыточности учитываются только комиссии.
  Ночные свопы нужно обрабатывать отдельно, если они взимаются брокером.
* Предполагается режим хеджирования (одновременные лонги и шорты). Для неттинговых счетов агрегированные объёмы будут
  вести себя так же, как в MetaTrader.
* Python-реализация отсутствует, доступна только версия на C#.
