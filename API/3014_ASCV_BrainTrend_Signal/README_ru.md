# Стратегия ASCV BrainTrend Signal

**ASCV BrainTrend Signal** — конвертированная версия советника MetaTrader, торгующего по сигналам индикатора BrainTrend1. В реализации на StockSharp используются высокоуровневые бинды индикаторов: ATR, стохастического осциллятора и сглаживания Jurik Moving Average. Такой набор позволяет отслеживать развороты импульса и оформлять сделки с фиксированными и трейлинг-стопами.

## Идея

1. ATR измеряет текущую волатильность и задаёт динамический порог подтверждения сигнала.
2. Закрытия свечей сглаживаются JMA и сравниваются с значением две свечи назад.
3. Если разница JMA превышает `ATR / 2.3`, анализируется стохастик:
   - `%K` ниже **47** переключает систему в режим поиска короткой позиции.
   - `%K` выше **53** переводит её в режим поиска длинной позиции.
4. Сигнал исполняется на следующей завершённой свече. Параметр **ReverseSignals** позволяет инвертировать логику.
5. Уровни стоп-лосса, тейк-профита и трейлинг-стопа задаются в пипсах (кратных минимальному шагу цены).

## Правила входа и выхода

- **Покупка**: на предыдущей свече был сформирован сигнал на покупку и текущая позиция не длинная. Объём равен `Volume + |Position|`, поэтому при наличии шорта он сначала закрывается.
- **Продажа**: на предыдущей свече был сигнал на продажу и нет открытой короткой позиции.
- **Стоп-лосс**: `entry ± StopLossPips * шаг_цены`. При пробитии уровня внутри новой свечи позиция закрывается рыночной заявкой.
- **Тейк-профит**: `entry ± TakeProfitPips * шаг_цены`, если параметр больше нуля.
- **Трейлинг-стоп**: активируется, когда `TrailingStopPips > 0` и `TrailingStepPips > 0`. После прохождения цены на `TrailingStopPips + TrailingStepPips` в сторону позиции стоп переносится на расстояние `TrailingStopPips`.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `AtrPeriod` | Период ATR для оценки волатильности. | 14 |
| `StochasticPeriod` | Базовый период стохастика. | 12 |
| `JmaLength` | Длина сглаживания Jurik MA. | 7 |
| `StopLossPips` | Размер стоп-лосса в пипсах. | 15 |
| `TakeProfitPips` | Размер тейк-профита в пипсах. | 46 |
| `TrailingStopPips` | Дистанция трейлинг-стопа. | 0 (выключен) |
| `TrailingStepPips` | Шаг смещения трейлинг-стопа. | 5 |
| `ReverseSignals` | Инверсия торговых сигналов. | false |
| `CandleType` | Рабочий таймфрейм (по умолчанию 15 минут). | 15m |

## Особенности

- Расчёты выполняются только на завершённых свечах, что уменьшает шум в середине бара.
- Если `Security.MinPriceStep` недоступен, используется значение `0.0001` для пересчёта пипсов в цену.
- На график выводятся свечи, стохастик и JMA, что помогает контролировать работу алгоритма.
- Логика трейлинг-стопа повторяет оригинальный советник: уровень двигается только в сторону прибыли и требует одновременного выполнения условий по дистанции и шагу.

## Рекомендации

- Подбирайте `AtrPeriod` и `StochasticPeriod` под волатильность торгуемого инструмента.
- Для инструментов с крупным шагом цены увеличивайте стопы и тейки, чтобы избежать преждевременных выходов.
- Используйте `ReverseSignals`, если необходимо запустить советник в обратном режиме.
- Добавляйте внешние средства контроля рисков при реальной торговле.
