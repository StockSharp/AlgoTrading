# Стратегия Accelerator Trailing TP & SL

## Обзор
Accelerator Trailing TP & SL — это перенос советника "Accelerator Trailing TP&SL" с платформы MetaTrader на высокоуровневый API StockSharp. Стратегия сочетает осциллятор ускорения Билла Уильямса, подтверждение по импульсу старшего таймфрейма и месячный фильтр MACD. Сделки наращиваются геометрической прогрессией, а выходы объединяют фиксированные стоп/тейк, трейлинг и перенос стопа в безубыток.

## Логика торговли
- **Импульсный фильтр** — 14-периодный индикатор Momentum на старшем таймфрейме должен отклониться от уровня 100 минимум на заданное значение на любой из трёх последних завершённых свечей.
- **Осциллятор ускорения** — для покупок требуется положительное значение индикатора на рабочем таймфрейме, для продаж — отрицательное.
- **Скользящие средние** — быстрая линейно-взвешенная скользящая должна находиться выше медленной для лонгов и ниже для шортов, что повторяет фильтр тренда оригинального советника.
- **Месячный MACD** — по умолчанию анализируются месячные свечи. Для лонга главная линия MACD должна быть выше сигнальной (даже если обе отрицательны), для шорта — ниже.
- **Лестничное наращивание** — стратегия способна открывать несколько позиций в одну сторону до заданного лимита. Каждый новый вход умножается на коэффициент LotExponent, что воспроизводит мартингейл-подход из MQL.

## Управление рисками
- **Фиксированный стоп/тейк** — расстояния в пунктах соответствуют параметрам Stop Loss и Take Profit из исходного кода.
- **Трейлинг-стоп** — при активации стоп двигается вслед за максимальной выгодной ценой на заданное количество пунктов.
- **Перенос в безубыток** — после достижения прибыли в заданном размере стоп переносится на новую отметку, закрепляя результат.
- **Выход по MACD** — при смене сигнала MACD против текущей позиции стратегия может немедленно закрыть сделки, аналогично ручному выходу в советнике.

## Параметры
| Параметр | Описание |
| --- | --- |
| `FastMaLength` / `SlowMaLength` | Периоды быстрой и медленной LWMA на рабочем таймфрейме. |
| `MomentumThreshold` | Минимальное абсолютное отклонение импульса от уровня 100 на старшем таймфрейме. |
| `StopLossPips` / `TakeProfitPips` | Расстояние до стоп-лосса и тейк-профита в пунктах. |
| `TrailingStopPips` | Шаг трейлинг-стопа в пунктах. |
| `BreakEvenTriggerPips` / `BreakEvenOffsetPips` | Настройки переноса стопа в безубыток. |
| `MaxTrades` | Максимальное число доливок в одну сторону. |
| `BaseVolume` | Объём первой позиции в серии. |
| `LotExponent` | Множитель объёма для каждой следующей доливки. |
| `EnableTrailing` | Включает или выключает трейлинг-стоп. |
| `UseBreakEven` | Включает или выключает перенос в безубыток. |
| `CloseOnMacdFlip` | Закрывать ли позиции при развороте сигнала MACD. |
| `CandleType` | Рабочий таймфрейм (по умолчанию 15 минут). |
| `MomentumCandleType` | Таймфрейм для фильтра Momentum (по умолчанию 1 час). |
| `MacdCandleType` | Таймфрейм для фильтра MACD (по умолчанию месяц). |

## Особенности
- Для пересчёта пунктов в цену стратегия использует свойство `PriceStep` инструмента. Перед запуском убедитесь, что шаг цены указан корректно.
- StockSharp оперирует чистой позицией, поэтому доливки выполняются последовательными рыночными ордерами до достижения лимита, а выход полностью закрывает позицию — так же, как в функции полного закрытия в оригинальном советнике.
- Таймфрейм MACD можно изменить через параметр `MacdCandleType`, адаптируя стратегию под другие инструменты и тесты.
