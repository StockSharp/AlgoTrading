# Стратегия Forex Fraus M1

## Обзор
Стратегия Forex Fraus M1 переносит советника MetaTrader 5 «Forex Fraus M1» в инфраструктуру StockSharp. Это контртрендовая система, которая отслеживает осциллятор Williams %R с большим периодом (360) на минутных свечах. Когда индикатор достигает экстремальных значений, алгоритм пытается развернуть движение, рассчитывая на быстрый возврат к среднему уровню диапазона. В реализации сохранены все элементы управления рисками из оригинального советника: ограничение по времени торговли, фиксированные стоп-лосс и тейк-профит в пунктах, а также трейлинг-стоп.

## Торговая логика
- **Индикатор**: Williams %R с периодом 360.
- **Покупка**: при значении Williams %R ниже `-99.9` рынок считается сильно перепроданным. Стратегия отправляет рыночную заявку на покупку, если длинной позиции нет. При активном флаге `CloseOppositePositions` короткий объём закрывается в той же заявке.
- **Продажа**: при значении Williams %R выше `-0.1` рынок перекуплен. Отправляется рыночная заявка на продажу; при необходимости длинная позиция закрывается сразу.
- **Фильтр по времени**: при включённом `UseTimeControl` сигналы обрабатываются только между `StartHour` (включительно) и `EndHour` (не включая). Если начало сессии позже её окончания (`StartHour > EndHour`), торговля разрешена с `StartHour` до 23 часов и с 0 до `EndHour - 1`.

## Управление рисками
- **Стоп-лосс**: уровень рассчитывается как `StopLossPips * PipSize` ниже (для покупок) или выше (для продаж) цены входа. Если минимум свечи достигает уровня стопа, позиция закрывается по рынку.
- **Тейк-профит**: уровень определяется как `TakeProfitPips * PipSize` выше (для покупок) или ниже (для продаж) цены входа. При достижении максимума/минимума свечи фиксируется прибыль.
- **Трейлинг-стоп**: при положительных `TrailingStopPips` и `TrailingStepPips` стоп подтягивается каждый раз, когда цена проходит не менее `TrailingStopPips + TrailingStepPips` пунктов в прибыльную сторону. Для длинных позиций стоп следует за закрытием свечи на расстоянии `TrailingStopPips`; для коротких — над закрытием.
- **Размер пункта**: параметр `PipSize` задаёт стоимость одного пункта. Для пятизначных валютных пар используйте `0.0001`, для трёхзначных пар с JPY — `0.01` и т. д.

Проверка уровней стоп-лосса и тейк-профита выполняется по максимумам и минимумам завершённых свечей. Если в пределах одной свечи задеты оба уровня, приоритет отдаётся стоп-лоссу — это повторяет консервативный подход исходного советника.

## Параметры
| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `OrderVolume` | `0.1` | Объём сделки для открытия новых позиций. |
| `StopLossPips` | `50` | Расстояние стоп-лосса в пунктах от цены входа. Ноль отключает стоп. |
| `TakeProfitPips` | `150` | Расстояние тейк-профита в пунктах. Ноль отключает тейк. |
| `TrailingStopPips` | `1` | Базовое расстояние трейлинг-стопа в пунктах. Ноль отключает сопровождение. |
| `TrailingStepPips` | `1` | Минимальное дополнительное движение цены, после которого стоп подтягивается. |
| `UseTimeControl` | `true` | Включает фильтр торговых часов. |
| `StartHour` | `7` | Час начала торговой сессии (0-23). |
| `EndHour` | `17` | Час окончания сессии (1-24, не включая). |
| `CloseOppositePositions` | `true` | При включении стратегия полностью разворачивает позицию одной заявкой. |
| `WilliamsPeriod` | `360` | Период расчёта Williams %R. |
| `CandleType` | `1 minute` | Тип свечей, используемых в вычислениях. |
| `PipSize` | `0.0001` | Стоимость одного пункта в ценовых единицах. |

## Дополнительные сведения
- Используется высокоуровневый API StockSharp: подписка на свечи и привязка индикатора позволяют избежать ручной работы с буферами.
- Все проверки стопов и трейлинга выполняются только на завершённых свечах, чтобы не реагировать на незакрытые данные.
- Метод `StartProtection()` вызывается один раз при запуске стратегии согласно требованиям проекта; основной контроль рисков реализован внутри стратегии.
- Обязательно адаптируйте `PipSize` под торгуемый инструмент, чтобы пункты корректно пересчитывались в цену.
