# Open Oscillator Cloud MMRec — стратегия
[English](README.md) | [中文](README_cn.md)

Стратегия переносит советник MetaTrader **Exp_Open_Oscillator_Cloud_MMRec** на высокоуровневый API StockSharp. Торговая логика использует пересечение индикатора Open Oscillator Cloud: текущая цена открытия сравнивается с ценами открытия максимумов и минимумов в скользящем окне и значения сглаживаются выбранным типом скользящей средней.

## Логика стратегии

### Построение индикатора
- Формируется окно завершённых свечей (`Oscillator Period`, по умолчанию 20) на выбранном таймфрейме.
- Определяются свечи с наибольшим максимумом и наименьшим минимумом, сохраняются их цены открытия.
- Для текущей свечи вычисляются два значения:
  - **Верхняя линия** = текущее открытие − открытие свечи с максимумом.
  - **Нижняя линия** = открытие свечи с минимумом − текущее открытие.
- Обе серии сглаживаются выбранной скользящей средней (`Smoothing Method`, `Smoothing Length`). Поддерживаются простая, экспоненциальная, сглаженная и взвешенная средние.
- История сглаженных значений сохраняется и сигналы смещаются на `Signal Bar` полностью закрытых свечей (по умолчанию 1), что повторяет задержку в оригинальном советнике.

### Условия входа
- **Покупка**: на предыдущей свече верхняя линия была выше нижней и на текущем смещённом значении происходит пересечение вниз (`upper ≤ lower`). Можно отключить через `Enable Long Entries`.
- **Продажа**: на предыдущей свече верхняя линия была ниже нижней и на текущем смещённом значении происходит пересечение вверх (`upper ≥ lower`). Можно отключить через `Enable Short Entries`.

### Условия выхода
- **Закрытие покупок**: на предыдущей свече верхняя линия ниже нижней (медвежий режим). Управляется параметром `Enable Long Exits`.
- **Закрытие продаж**: на предыдущей свече верхняя линия выше нижней (бычий режим). Управляется параметром `Enable Short Exits`.
- **Риск-менеджмент**: при ненулевых `Stop Loss Points` или `Take Profit Points` позиция закрывается, когда цена достигает соответствующего расстояния в шагах цены от точки входа.

### Работа с заявками
- Используются только рыночные заявки. Перед открытием новой позиции противоположная позиция закрывается, чтобы сохранить однонаправленный режим как в MetaTrader.
- Параметр `Trade Volume` задаёт фиксированный объём каждой сделки.

## Параметры
- `Candle Type` — таймфрейм свечей для расчёта индикатора (по умолчанию 1 час).
- `Oscillator Period` — размер окна анализа (по умолчанию 20 свечей).
- `Smoothing Method` — тип скользящей средней (Simple, Exponential, Smoothed, Weighted).
- `Smoothing Length` — период сглаживания (по умолчанию 10).
- `Signal Bar` — количество полностью закрытых свечей для задержки сигнала (по умолчанию 1).
- `Enable Long Entries` / `Enable Short Entries` — разрешение на открытие длинных/коротких позиций.
- `Enable Long Exits` / `Enable Short Exits` — разрешение на автоматическое закрытие длинных/коротких позиций.
- `Trade Volume` — объём рыночной заявки (по умолчанию 1 контракт/лот).
- `Stop Loss Points` — дистанция стоп-лосса в шагах цены (0 отключает, по умолчанию 1000).
- `Take Profit Points` — дистанция тейк-профита в шагах цены (0 отключает, по умолчанию 2000).

## Особенности реализации
- Реализованы наиболее распространённые типы сглаживания из оригинального советника. Экзотические варианты (JJMA, T3, VIDYA, AMA) не перенесены, поскольку в StockSharp уже есть богатый набор альтернатив для оптимизации.
- Сигналы оцениваются только на событиях `CandleStates.Finished`, чтобы не реагировать на незавершённые свечи.
- История значений хранится внутри стратегии, без обращения к буферам индикаторов, что соответствует рекомендуемому высокоуровневому подходу StockSharp.
- Защитные уровни очищаются при переходе позиции в ноль, чтобы исключить повторное срабатывание старых стопов.

## Поведение по умолчанию
- Торговля в обоих направлениях с подтверждением по завершённой свече, что уменьшает шум.
- Постоянный объём (`Trade Volume`) с поддержкой стоп-лосса и тейк-профита аналогично версии MetaTrader.
- Подходит как шаблон для экспериментов с другими типами сглаживания или добавления фильтров.
