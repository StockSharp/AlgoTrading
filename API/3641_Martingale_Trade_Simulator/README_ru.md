# Стратегия Martingale Trade Simulator

## Общее описание

`MartingaleTradeSimulatorStrategy` переносит советник «Martingale Trade Simulator» из MetaTrader в экосистему StockSharp. Стратегия выступает в роли ручной панели управления: позволяет мгновенно отправлять рыночные заявки, запускать мартингейловое усреднение одной кнопкой и управлять трейлинг-стопом без дополнительного кода. Все переключатели реализованы через параметры и реагируют в режиме реального времени, что делает стратегию удобной для визуального тестирования.

## Логика работы

### Ручные рыночные заявки
- Параметры `Buy` и `Sell` имитируют кнопки панели. При установке значения `true` стратегия отправляет рыночный ордер объёмом `Order Volume` и затем автоматически сбрасывает флаг обратно в `false`.
- Используются только рыночные ордера, что полностью повторяет поведение исходного советника в визуальном тестере MetaTrader.

### Мартингейл-усреднение
- Опция `Enable Martingale` позволяет задействовать усреднение. Для проверки условий необходимо переключить параметр `Martingale` в `true` — после обработки он сбрасывается.
- В зависимости от текущей позиции выполняется проверка:
  - **Длинная позиция:** если текущая цена Ask опустилась минимум на `Martingale Step (points)` ниже самой дешёвой покупки, отправляется дополнительный рыночный buy-ордер.
  - **Короткая позиция:** если текущая цена Bid поднялась минимум на `Martingale Step (points)` выше самой дорогой продажи, отправляется рыночный sell-ордер.
- Объём каждой новой ступени равен `Order Volume × (Martingale Multiplier)^N`, где `N` — число последовательных входов в текущем направлении.
- После активации мартингейла стратегия пересчитывает уровень тейк-профита относительно средней цены позиции и добавляет смещение `Martingale TP Offset (points)` для покрытия просадки.

### Трейлинг-стоп
- Параметр `Enable Trailing` включает автоматический трейлинг-стоп.
- Стоп устанавливается на расстоянии `Trailing Stop (points)` от текущей цены и сдвигается только тогда, когда цена проходит вперёд не менее чем на `Trailing Step (points)`.
- При касании трейлинг-уровня позиция закрывается встречной рыночной заявкой целиком.

### Стоп-лосс и тейк-профит
- Параметры `Stop Loss (points)` и `Take Profit (points)` повторяют базовые защитные уровни оригинального советника.
- Для лонгов стоп размещается ниже средней цены входа, тейк — выше; для шортов уровни зеркальны.
- Защитные выходы исполняются рыночными заявками, что сохраняет совместимость с любыми коннекторами StockSharp.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `Order Volume` | Базовый объём для ручных рыночных ордеров. | `1` |
| `Stop Loss (points)` | Расстояние до стоп-лосса (0 — отключить). | `500` |
| `Take Profit (points)` | Расстояние до тейк-профита (0 — отключить). | `500` |
| `Enable Trailing` | Включить / выключить трейлинг-стоп. | `true` |
| `Trailing Stop (points)` | Расстояние от цены до трейлинг-стопа. | `50` |
| `Trailing Step (points)` | Минимальный шаг продвижения трейлинга. | `20` |
| `Enable Martingale` | Разрешить мартингейл по кнопке `Martingale`. | `true` |
| `Martingale Multiplier` | Множитель объёма для каждой ступени усреднения. | `1.2` |
| `Martingale Step (points)` | Требуемое неблагоприятное движение цены перед усреднением. | `150` |
| `Martingale TP Offset (points)` | Дополнительное смещение тейк-профита при мартингейле. | `50` |
| `Buy` | Установите `true`, чтобы отправить рыночный buy-ордер (автосброс). | `false` |
| `Sell` | Установите `true`, чтобы отправить рыночный sell-ордер (автосброс). | `false` |
| `Martingale` | Установите `true`, чтобы выполнить проверку и при необходимости усредниться (автосброс). | `false` |

## Рекомендации по использованию

1. Выберите инструмент, задайте `Order Volume` и запустите стратегию в тестере или на реальном подключении.
2. Для имитации ручных действий устанавливайте `Buy` или `Sell` в `true` — стратегия немедленно отправит рыночный ордер.
3. Когда цена движется против открытой позиции, переключите `Martingale` в `true`, чтобы стратегия проверила условия и добавила усредняющий ордер с повышенным объёмом.
4. Настраивайте трейлинг и защитные уровни, чтобы полностью повторить механику оригинального советника либо протестировать альтернативные параметры.

## Примечания

- Стратегия использует данные Level1 (лучшие цены и последняя сделка) для оценки ситуации на рынке.
- Все комментарии в исходном коде написаны на английском языке в соответствии с требованиями репозитория.
