# Стратегия ReInitChart
[English](README.md) | [中文](README_cn.md)

Стратегия переносит утилиту MetaTrader **ReInitChart** в StockSharp. Исходный эксперт добавлял на каждый график кнопку, которая временно переключала таймфрейм, принуждая платформу пересчитать индикаторы. В адаптации для StockSharp эта идея реализована через параметр ручного обновления и необязательный таймер, которые сбрасывают состояние скользящей средней и фиксируют событие в журнале. Дополнительно встроено простое правило следования за трендом, чтобы показать работу после повторной инициализации.

## Как работает

1. **Основной поток данных** — стратегия подписывается на таймфрейм из параметра `CandleType` и рассчитывает простую скользящую среднюю длиной `SmaLength`.
2. **Ручной сброс** — при установке `ManualRefreshRequest = true` скользящая средняя обнуляется, флаг возвращается в `false`, а в журнал добавляется запись с исходными метаданными кнопки (`RefreshCommandName`, `RefreshCommandText`, `TextColorName`, `BackgroundColorName`).
3. **Автоматический сброс** — если `AutoRefreshEnabled = true`, то каждые `AutoRefreshInterval` индикатор сбрасывается повторно, что повторяет таймер из MetaTrader.
4. **Торговая логика** — после формирования SMA стратегия удерживает не более одной позиции: покупает при закрытии выше средней и разворачивается в шорт при закрытии ниже неё, предварительно закрывая противоположную позицию.

Таким образом достигается тот же эффект «переинициализации» графиков, но средствами StockSharp: прямым сбросом индикатора и логированием без переключения таймфреймов.

## Параметры

| Параметр | Описание |
| --- | --- |
| `CandleType` | Рабочий таймфрейм для подписки на свечи. |
| `SmaLength` | Количество свечей в скользящей средней, пересчитываемой после каждого сброса. |
| `AutoRefreshEnabled` | Включает периодический автоматический сброс. |
| `AutoRefreshInterval` | Интервал между автоматическими сбросами. |
| `ManualRefreshRequest` | Установите `true`, чтобы инициировать немедленный сброс; стратегия сама вернёт параметр в `false`. |
| `RefreshCommandName` | Имя кнопки из MetaTrader, выводится в журнале при сбросе. |
| `RefreshCommandText` | Подпись кнопки, также отражается в журнале. |
| `TextColorName` | Сохранённый цвет текста кнопки из MQL для справки и логов. |
| `BackgroundColorName` | Сохранённый цвет фона кнопки из MQL для справки и логов. |

## Использование

1. Настройте `CandleType` и `SmaLength` под нужный инструмент и горизонт анализа.
2. Включите `AutoRefreshEnabled` и задайте `AutoRefreshInterval`, если требуются регулярные переинициализации; оставьте отключённым для полностью ручного контроля.
3. При необходимости повторного расчёта переведите `ManualRefreshRequest` в `true`. Параметр автоматически вернётся к `false`, а индикатор начнёт накапливать данные заново.
4. Запустите стратегию — она подпишется на рынок, отрисует свечи, SMA и сделки, после чего начнёт торговать по правилу пересечения цены и средней.

## Отличия от исходного MQL-скрипта

- В StockSharp нет прямого аналога кнопок на графике, поэтому триггер реализован через параметры стратегии.
- Вместо переключения между M1 и M5 индикатор обнуляется напрямую, что надёжнее в архитектуре StockSharp.
- Название и цвета кнопки сохранены только как метаданные для журналирования, визуальных элементов в платформе не создаётся.
