# Crossover MA 策略

## 概述

本策略是 MetaTrader 5 专家顾问 **CrossoverMA.mq5** 的 StockSharp 移植版。原始 EA 只在 K 线突破移动平均线并且均线与突破方向一致时开仓。移植版本完全保留这一思想，同时使用 StockSharp 的高级 API 来处理数据订阅、指标更新以及图表绘制。

## 交易逻辑

1. 订阅参数指定的蜡烛序列，并在收盘价上计算简单移动平均线（SMA）。
2. 当收到一根收盘完成的蜡烛时，计算以下信息：
   - 蜡烛开盘价和收盘价相对于 SMA 的距离；
   - 当前 SMA 与上一根 SMA 之间的差值，用来判断均线斜率。
3. 触发信号：
   - **看涨突破**：开盘价在 SMA 下方，收盘价在 SMA 上方，同时 SMA 向上倾斜。策略会平掉所有空头仓位并建立/加仓多头。
   - **看跌突破**：开盘价在 SMA 上方，收盘价在 SMA 下方，同时 SMA 向下倾斜。策略会平掉所有多头仓位并建立/加仓空头。
4. 如果信号方向与当前持仓相同，则忽略该信号，避免重复下单。

策略只处理完全收盘的蜡烛，并且会等待至少两根均线数值才能判断斜率，与原始 EA 的行为一致。

## 参数

| 名称 | 说明 | 默认值 | 备注 |
| ---- | ---- | ------ | ---- |
| `Candle Type` | 用于计算的蜡烛类型/周期。 | 1 分钟 | 可以选择任何 StockSharp 支持的蜡烛数据类型。 |
| `MA Length` | 参与均线计算的已完成蜡烛数量。 | 12 | 对应 MetaTrader 版本的默认周期。 |
| `Trade Volume` | 市价单的下单手数。 | 1 | 下单前会先平掉相反方向的持仓。 |

所有参数都可以在 StockSharp Designer 或 Runner 中参与优化。

## 实现细节

- 使用 `SubscribeCandles` + `Bind`，指标数值会自动推送到处理函数，无需手动维护历史缓存。
- SMA 保存在私有字段中，若图表可用则会绘制在图表上。
- 只有当 `IsFormedAndOnlineAndAllowTrading()` 返回 `true` 时才会处理信号，保证遵守全局交易开关。
- 当方向反转时，先平掉原有仓位，再按照参数数量开立新仓，延续 MetaTrader 框架的做法。

## 文件结构

- `CS/CrossoverMaStrategy.cs`：C# 版策略源码。
- `README.md`：英文说明。
- `README_cn.md`：中文说明（本文件）。
- `README_ru.md`：俄文说明。

## 移植差异

- 原 EA 依赖的资金管理、移动止损等模块在 StockSharp 中由外部系统处理，因此省略，仅保留 `Trade Volume` 参数来控制手数。
- MetaTrader 使用单独的 Open/Close 数据序列；StockSharp 的蜡烛对象直接提供这两个价格，不需要额外指标。
- 指标创建、验证和生命周期管理由 StockSharp 自动完成，大幅减少了 MQL 版本中的模板代码。
