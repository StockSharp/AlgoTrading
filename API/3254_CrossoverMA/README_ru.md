# Стратегия Crossover MA

## Обзор

Данная стратегия — порт эксперта **CrossoverMA.mq5** из MetaTrader 5 на платформу StockSharp. Оригинальный советник открывает позиции только тогда, когда свеча пересекает скользящую среднюю, а сама средняя наклонена в сторону пробоя. Реализация на StockSharp сохраняет эту логику и использует высокоуровневые API для подписки на свечи, получения значений индикаторов и визуализации.

## Логика торговли

1. Подписываемся на свечи с выбранным таймфреймом и рассчитываем простую скользящую среднюю (SMA) по ценам закрытия.
2. После закрытия каждой свечи измеряем:
   - Насколько цены открытия и закрытия удалены от SMA.
   - Наклон SMA, сравнивая текущий и предыдущий значения индикатора.
3. Формируем сигналы:
   - **Бычий пробой** — свеча открылась ниже SMA, закрылась выше, SMA растёт. Стратегия закрывает короткие позиции и открывает/увеличивает длинную позицию.
   - **Медвежий пробой** — свеча открылась выше SMA, закрылась ниже, SMA падает. Стратегия закрывает длинные позиции и открывает/увеличивает короткую позицию.
4. Повторяющиеся сигналы, не меняющие направление позиции, игнорируются, чтобы избежать лишних сделок.

Перед первым сигналом стратегия ждёт минимум два значения SMA, чтобы корректно определить наклон, как и оригинальный советник.

## Параметры

| Имя | Описание | Значение по умолчанию | Примечание |
| --- | -------- | --------------------- | ---------- |
| `Candle Type` | Тип/таймфрейм свечей для расчёта. | 1 минута | Можно выбрать любой тип свечей, поддерживаемый StockSharp. |
| `MA Length` | Количество завершённых свечей в расчёте SMA. | 12 | Соответствует настройке MetaTrader. |
| `Trade Volume` | Объём рыночных заявок. | 1 | Перед открытием новой позиции противоположное плечо закрывается. |

Все параметры доступны для оптимизации в StockSharp Designer и Runner.

## Особенности реализации

- Использование `SubscribeCandles` и `Bind` позволяет получать значения индикатора напрямую в обработчик без ручного управления буферами.
- Экземпляр SMA хранится в поле класса, чтобы при наличии графика вывести кривую индикатора вместе со свечами и сделками.
- Сигналы обрабатываются только после проверки `IsFormedAndOnlineAndAllowTrading()`, что уважает глобальные настройки торговли.
- При смене направления сначала закрывается текущая позиция, затем открывается новая с заданным объёмом — аналогично поведению фреймворка MetaTrader.

## Структура файлов

- `CS/CrossoverMaStrategy.cs` — код стратегии на C#.
- `README.md` — описание на английском языке.
- `README_cn.md` — описание на китайском языке.
- `README_ru.md` — описание на русском языке (текущий файл).

## Отличия от оригинала

- Компоненты управления капиталом и трейлинг-стопа из MetaTrader не переносились: в StockSharp размер позиции задаётся параметром `Trade Volume`, а расширенные модули риска подключаются отдельно.
- В MetaTrader использовались отдельные ряды цен открытия и закрытия. В StockSharp эти значения присутствуют внутри свечи, поэтому дополнительные индикаторы не требуются.
- Инициализация и валидация индикаторов выполняется автоматически инфраструктурой StockSharp, что значительно сокращает объём шаблонного кода по сравнению с MQL.
