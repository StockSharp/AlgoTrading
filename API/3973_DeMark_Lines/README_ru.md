# Стратегия DeMark Lines

## Обзор
Стратегия DeMark Lines представляет собой конвертацию индикатора MetaTrader «DeMark_lines» (MQL/8296). Исходный код строил демарковские трендовые линии по последним экстремумам и подавал сигналы при их пробое. В версии для StockSharp визуальные элементы заменены на автоматическую торговую логику: стратегия отслеживает активные линии поддержки и сопротивления, построенные по подтверждённым пивотам, и совершает сделки при уверенном пробое.

## Логика торговли
1. **Поиск пивотов**. Обрабатываются только завершённые свечи. Свеча признаётся локальным максимумом, если её максимум строго выше двух предыдущих максимумов и не ниже двух последующих. Для минимума условия зеркальны.
2. **Построение трендовых линий**. Два последних максимума формируют нисходящую линию сопротивления, два последних минимума — восходящую линию поддержки. Если новый пивот слишком близок к предыдущему, он игнорируется во избежание «дёргания» линий.
3. **Фильтрация пробоев**. Стратегия вычисляет теоретическое значение трендовой линии на текущем баре и требует, чтобы цена закрытия ушла за неё минимум на *BreakoutBuffer* пунктов.
4. **Совершение сделок**. При пробое сопротивления закрываются короткие позиции и открывается длинная позиция базовым объёмом стратегии. При пробое поддержки выполняется зеркальное действие. Одна и та же линия не генерирует повторный сигнал, пока не появится новый пивот и линия не будет перестроена.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `PivotDepth` | Количество свечей по обе стороны, необходимое для подтверждения пивота. Определяет «ширину» искомых экстремумов. | 2 |
| `MinBarsBetweenPivots` | Минимальный интервал между пивотами одного типа. Защищает от появления почти совпадающих опорных точек. | 5 |
| `BreakoutBuffer` | Дополнительный фильтр пробоя в пунктах, компенсирует рыночный шум. | 2 |
| `CandleType` | Тип свечей (таймфрейм), на основе которых строятся трендовые линии и сигналы. | 30-минутные свечи |

## Особенности конверсии
- Графические объекты, звуковые и почтовые уведомления оригинального индикатора не реализованы. На графике отображаются свечи и собственные сделки стратегии.
- Реализация использует высокоуровневую подписку на свечи и внутренние буферы, что полностью соответствует требованиям проекта и исключает обращение к запрещённым методам истории индикаторов.
- При появлении обратного сигнала стратегия автоматически разворачивает позицию, используя свойство `Volume` базового класса.

## Практические рекомендации
- На «шумных» инструментах увеличивайте `BreakoutBuffer`, чтобы снизить количество ложных пробоев. На спокойных рынках его можно уменьшить.
- Увеличение `PivotDepth` уменьшает частоту сделок, но делает трендовые линии устойчивее к рыночному шуму.
- Для управления рисками и фиксации прибыли используйте дополнительные модули StockSharp или пользовательские надстройки, поскольку изначальный индикатор решал только задачу определения пробоя.
