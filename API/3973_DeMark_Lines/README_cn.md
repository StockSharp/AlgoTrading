# 德马克趋势线策略

## 概述
德马克趋势线策略基于 MetaTrader 指标“DeMark_lines”（MQL/8296）。原始程序负责在图表上绘制由摆动高点和摆动低点组成的德马克趋势线，并在价格突破时触发提醒。本移植版本将绘图逻辑转换为 StockSharp 自动化策略：它持续跟踪由最新枢轴点确定的上升与下降趋势线，并在收盘价有效突破时执行交易。

## 交易思路
1. **枢轴识别**：按照时间顺序处理已完成的蜡烛。若某根蜡烛的最高价高于前 *PivotDepth* 根蜡烛的最高价且不低于随后 *PivotDepth* 根蜡烛的最高价，则认定为摆动高点。摆动低点采用相反条件判断最低价。
2. **趋势线构建**：最近两个摆动高点组成当前的下降趋势压力线，最近两个摆动低点组成上升趋势支撑线。当新的枢轴距离前一个枢轴过近时会被忽略，以保持趋势线稳定。
3. **突破过滤**：根据当前柱编号计算理论趋势线价格，只有当收盘价超过（或跌破）趋势线并额外超出 *BreakoutBuffer* 点数后，突破才算有效。
4. **下单逻辑**：出现看涨突破时，策略先平掉所有空头头寸，再按策略 Volume 参数开立多单；看跌突破逻辑完全对称。每条趋势线只有在新的枢轴重绘后才会再次触发信号，避免价格在水平附近震荡时重复入场。

## 参数
| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `PivotDepth` | 枢轴确认所需的左右蜡烛数量，控制摆动识别的严格程度。 | 2 |
| `MinBarsBetweenPivots` | 同类枢轴之间的最小柱数间隔，防止锚点过于密集。 | 5 |
| `BreakoutBuffer` | 在判定有效突破前需要额外突破的点数。 | 2 |
| `CandleType` | 用于分析和信号生成的蜡烛数据类型（时间框架）。 | 30 分钟蜡烛 |

## 转换说明
- 指标中的图形对象、声音/邮件提醒未被复刻，策略仅在图表区域绘制价格和自身成交。
- 根据项目规范，策略使用高层级的蜡烛订阅 API，并通过内部缓冲区验证枢轴，而不是访问受限的历史指示器数据。
- 突破信号会遵循基础 `Volume` 设置，并在出现反向突破时自动反手。

## 使用建议
- 在更高周期上可以适当增大 `PivotDepth`，以要求更宽的摆动区间并提高趋势线可靠性。
- `BreakoutBuffer` 应结合品种波动性调整：数值越小信号越敏捷，越大则能过滤噪音。
- 若需要止盈/止损等退出规则，可结合外部资金管理模块，因为原指标主要聚焦于突破提示而非仓位管理。
