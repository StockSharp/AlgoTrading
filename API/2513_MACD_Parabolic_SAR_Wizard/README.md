# MACD Parabolic SAR Wizard Strategy

## Overview
This strategy is a StockSharp conversion of the MetaTrader Expert Advisor generated by the MQL5 Wizard that combines MACD momentum with Parabolic SAR trend direction. The logic reproduces the wizard's scoring mechanism by assigning a normalized score (0..100) to each indicator and then weighting the contributions before making trading decisions.

## Trading Logic
- **Indicators**
  - *MACD (12, 24, 9)*: the histogram sign defines whether bullish momentum (histogram > 0) or bearish momentum (histogram < 0) is active.
  - *Parabolic SAR (0.02, 0.2)*: the closing price above the SAR point is interpreted as an uptrend, and below the SAR point as a downtrend.
- **Score construction**
  - MACD produces either 100 (bullish) or 0 (bearish) points for the long side. The inverse values are used for the short side.
  - Parabolic SAR behaves the same, providing 100 points when the trend agrees with the respective direction.
  - Both scores are combined via the user-defined weights (`MacdWeight` and `SarWeight`). With the default weights (0.9 and 0.1) the MACD dominates the final decision just like in the wizard template.
- **Entry rules**
  - Compute the bullish score: `bullScore = macdBull * MacdWeight + sarBull * SarWeight`.
  - Compute the bearish score: `bearScore = macdBear * MacdWeight + sarBear * SarWeight`.
  - Open a long position (or reverse from short) when `bullScore >= OpenThreshold` (default `20`).
  - Open a short position (or reverse from long) when `bearScore >= OpenThreshold`.
- **Exit rules**
  - Long positions are closed when the bearish score reaches the strong confirmation level `CloseThreshold` (default `100`).
  - Short positions are closed when the bullish score reaches `CloseThreshold`.
  - Exit signals are evaluated before entry signals to mimic the behaviour of the original expert that prioritises closing conflicting trades.

## Risk Management
- `StopLossPoints` and `TakeProfitPoints` replicate the wizard's point-based money management. Both values are converted to price units using the instrument `PriceStep` and then passed to `StartProtection`.
- Set either parameter to `0` to disable the corresponding protective order.

## Parameters
| Parameter | Description | Default |
|-----------|-------------|---------|
| `MacdFastPeriod` | Fast EMA period for MACD. | 12 |
| `MacdSlowPeriod` | Slow EMA period for MACD. | 24 |
| `MacdSignalPeriod` | Signal SMA period for MACD. | 9 |
| `MacdWeight` | Weight of the MACD score (0..1). | 0.9 |
| `SarWeight` | Weight of the Parabolic SAR score (0..1). | 0.1 |
| `OpenThreshold` | Minimum score to open/reverse positions. | 20 |
| `CloseThreshold` | Minimum opposite score to exit positions. | 100 |
| `SarStep` | Parabolic SAR acceleration step. | 0.02 |
| `SarMax` | Parabolic SAR maximum acceleration. | 0.2 |
| `StopLossPoints` | Stop-loss distance in price points. | 50 |
| `TakeProfitPoints` | Take-profit distance in price points. | 115 |
| `CandleType` | Candle data source for indicator calculations. | 15-minute time frame |

## Usage Notes
- The default parameters mirror the `.mq5` template, so the strategy behaves consistently with the original wizard-generated expert.
- Adjust the `MacdWeight`, `SarWeight`, and thresholds to change the sensitivity of entries and exits. For example, increasing `OpenThreshold` will require stronger confirmation before opening new trades.
- The internal fields `_lastBullScore` and `_lastBearScore` are updated each bar and can be logged or exposed if you need to monitor how the combined score evolves over time.
- Because the strategy depends on finished candles, make sure your data feed provides complete candle updates for the selected `CandleType`.
- Money management is expressed in points; ensure the chosen instrument uses the expected price step so that protective orders align with the intended distances.
