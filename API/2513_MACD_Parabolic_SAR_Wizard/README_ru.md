# Стратегия MACD Parabolic SAR Wizard

## Общее описание
Стратегия реализует в StockSharp советник «MACD + Parabolic SAR», созданный мастером MQL5. Логика полностью повторяет систему взвешенных оценок: каждому индикатору присваивается нормированная оценка от 0 до 100, после чего оценки объединяются по заданным весам для формирования торгового решения.

## Логика работы
- **Индикаторы**
  - *MACD (12, 24, 9)*: знак гистограммы определяет преобладающее направление импульса. Положительный histogram → бычий импульс, отрицательный → медвежий.
  - *Parabolic SAR (0.02, 0.2)*: закрытие выше точки SAR указывает на восходящий тренд, ниже — на нисходящий.
- **Формирование оценок**
  - MACD выдаёт 100 баллов в сторону текущего импульса и 0 баллов в противоположную. Для коротких позиций оценки инвертируются.
  - Parabolic SAR работает аналогично, давая 100 баллов, когда цена подтверждает соответствующее направление тренда.
  - Финальные оценки считаются по формуле: `bullScore = macdBull * MacdWeight + sarBull * SarWeight`, `bearScore = macdBear * MacdWeight + sarBear * SarWeight`. При дефолтных весах (0.9 и 0.1) доминирует MACD, как и в шаблоне мастера.
- **Условия входа**
  - Открыть или перевернуться в лонг, когда `bullScore >= OpenThreshold` (по умолчанию 20).
  - Открыть или перевернуться в шорт, когда `bearScore >= OpenThreshold`.
- **Условия выхода**
  - Закрыть длинную позицию, если `bearScore >= CloseThreshold` (по умолчанию 100).
  - Закрыть короткую позицию, если `bullScore >= CloseThreshold`.
  - Сначала проверяются выходы, затем входы, что воспроизводит приоритет завершения конфликтующих сделок в оригинальном советнике.

## Управление рисками
- `StopLossPoints` и `TakeProfitPoints` соответствуют пунктовым стоп- и тейк-уровням из MQL5. Значения умножаются на `PriceStep` инструмента и передаются в `StartProtection`.
- Значение `0` отключает соответствующую защиту.

## Параметры
| Параметр | Назначение | Значение по умолчанию |
|----------|------------|-----------------------|
| `MacdFastPeriod` | Быстрый период EMA для MACD | 12 |
| `MacdSlowPeriod` | Медленный период EMA для MACD | 24 |
| `MacdSignalPeriod` | Период сглаживания сигнальной линии | 9 |
| `MacdWeight` | Вес оценки MACD (0..1) | 0.9 |
| `SarWeight` | Вес оценки Parabolic SAR (0..1) | 0.1 |
| `OpenThreshold` | Порог открытия/реверса позиции | 20 |
| `CloseThreshold` | Порог закрытия позиции в противоположную сторону | 100 |
| `SarStep` | Шаг ускорения Parabolic SAR | 0.02 |
| `SarMax` | Максимальное ускорение Parabolic SAR | 0.2 |
| `StopLossPoints` | Дистанция стоп-лосса в пунктах | 50 |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах | 115 |
| `CandleType` | Тип свечей для расчёта индикаторов | 15 минут |

## Рекомендации по использованию
- Все параметры совпадают с исходным файлом `.mq5`, поэтому конвертированная стратегия ведёт себя аналогично мастеру MQL5.
- Изменяйте веса и пороги, чтобы адаптировать чувствительность. Повышение `OpenThreshold` снижает количество сделок, тогда как уменьшение `CloseThreshold` ускорит выход из позиции.
- Поля `_lastBullScore` и `_lastBearScore` обновляются на каждой свече — их можно использовать для журналирования или дополнительной визуализации качества сигналов.
- Стратегия работает только по закрытым свечам. Убедитесь, что источник данных передаёт финальные значения для выбранного `CandleType`.
- Защитные приказы задаются в пунктах: проверьте, что шаг цены инструмента соответствует ожиданиям, чтобы стопы и тейки размещались корректно.
