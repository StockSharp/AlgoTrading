# Стратегия Starter Triple Stochastic

Эта стратегия переносит эксперт **Starter.mq5** на высокий уровень API StockSharp. Она синхронизирует три стохастических
осциллятора (быстрый, нормальный, медленный) с соответствующими скользящими средними на разных таймфреймах. Сделка
разрешена только тогда, когда все фильтры подтверждают одно направление и цена находится по правильную сторону от каждой
смещённой скользящей средней.

## Логика торговли

1. Подписка на три потока свечей:
   - **Быстрый таймфрейм** (по умолчанию `M5`).
   - **Нормальный таймфрейм** (по умолчанию `M30`).
   - **Медленный таймфрейм** (по умолчанию `H2`).
2. Для каждого потока строится скользящая средняя (метод, период и источник цены настраиваются) и стохастик с одинаковыми
   параметрами `%K`, `%D` и `Slowing`.
3. Медленный таймфрейм управляет выполнением. После закрытия медленной свечи сравниваются последние значения всех
   таймфреймов:
   - Покупка: `%K > %D` у каждого стохастика, все `%K` ниже `50`, цена ниже каждой смещённой средней.
   - Продажа: `%K < %D` у каждого стохастика, все `%K` выше `50`, цена выше каждой смещённой средней.
4. Сигналы можно инвертировать через `ReverseSignals`. При входе стратегия либо разворачивает позицию (`CloseOppositePositions = true`),
   либо игнорирует сигнал до закрытия противоположной позиции.
5. После исполнения хранятся уровни стоп-лосса и тейк-профита. Трейлинг-стоп копирует логику MQL: сначала требуются
   `TrailingStopPips + TrailingStepPips` пунктов прибыли, затем стоп сдвигается на `TrailingStopPips` пунктов.
6. Управление капиталом повторяет режим `lot/risk` из MetaTrader. При `RiskPercent` объём сделки рассчитывается по стоимости
   портфеля, проценту риска и расстоянию до стоп-лосса в пунктах.

## Параметры

| Параметр | Значение | Описание |
|----------|----------|----------|
| `StopLossPips` | `45` | Расстояние защитного стопа в пунктах (0 — отключить). |
| `TakeProfitPips` | `105` | Расстояние тейк-профита в пунктах (0 — отключить). |
| `TrailingStopPips` | `5` | Смещение трейлинг-стопа в пунктах. |
| `TrailingStepPips` | `5` | Минимальный ход цены в пунктах до сдвига трейлинга. |
| `MoneyMode` | `RiskPercent` | Режим мани-менеджмента: фиксированный лот или процент риска. |
| `MoneyValue` | `3` | Размер лота при `FixedLot` либо процент риска при `RiskPercent`. |
| `FastCandleType` | `M5` | Свечной тип для быстрого набора индикаторов. |
| `NormalCandleType` | `M30` | Свечной тип для промежуточного набора. |
| `SlowCandleType` | `H2` | Свечной тип, на котором выполняются сделки. |
| `MaPeriod` | `20` | Период всех скользящих средних. |
| `MaShift` | `1` | Смещение скользящих средних в барах. |
| `MaMethod` | `Simple` | Метод сглаживания: `Simple`, `Exponential`, `Smoothed`, `Weighted`. |
| `MaPriceType` | `Close` | Тип цены для расчёта скользящей. |
| `StochasticKPeriod` | `5` | Период `%K` для стохастика. |
| `StochasticDPeriod` | `3` | Период сглаживания `%D`. |
| `StochasticSlowing` | `3` | Финальное сглаживание `%K`. |
| `ReverseSignals` | `false` | Инвертировать условия входа. |
| `CloseOppositePositions` | `false` | Закрывать противоположную позицию одним ордером при новом сигнале. |

## Управление капиталом

- `FixedLot` отправляет заявки с объёмом `MoneyValue`.
- `RiskPercent` вычисляет риск как `СтоимостьПортфеля * MoneyValue / 100`. Объём равен `Риск / (StopLossPips * размер пункта)`.
  Если стоп равен нулю или значение портфеля неизвестно, сделки блокируются.

## Защита и трейлинг

- Стоп-лосс и тейк-профит отслеживаются по максимумам/минимумам свечи, что соответствует работе ордеров в MetaTrader.
- Трейлинг активируется только после прибыли, превышающей `TrailingStopPips + TrailingStepPips` пунктов, полностью
  повторяя оригинальную реализацию.

## Согласование таймфреймов

Индикаторы обновляются на каждой закрытой свече своего таймфрейма. Медленный поток ждёт готовности всех значений и
использует последнее смещённое значение скользящей, что соответствует параметру `shift` функции `iMA` в MetaTrader.
