# Tunnel Method EMA 策略
[English](README.md) | [Русский](README_ru.md)

## 概述
**Tunnel Method EMA** 策略基于原版 MetaTrader「Tunnel Method」专家顾问，并使用 StockSharp 的高级 API 实现。策略运行在 1 小时 K 线之上，比较以下三条基于收盘价的指数移动平均线（EMA）：

- **快速 EMA（12）**：跟踪最新动量变化。
- **中速 EMA（144）**：构成“通道”中轨，用于确认做空信号。
- **慢速 EMA（169）**：定义长周期趋势，用作做多过滤器。

策略在任意时刻仅持有单向仓位（多头或空头），并通过硬性止损、止盈以及移动止损来控制风险。

## 交易逻辑
### 多头入场
1. 等待 K 线收盘（不在未完成的 K 线上决策）。
2. 当快速 EMA（12）从下方上穿慢速 EMA（169）时触发信号。
3. 若当前无持仓，则按配置手数提交市价买单。

### 空头入场
1. 等待 K 线收盘。
2. 当快速 EMA（12）从上方下穿中速 EMA（144）时触发信号。
3. 若当前无持仓，则提交市价卖单。

### 仓位管理
- **止损**：价格相对开仓价逆向运行 `StopLossPoints`（按合约最小价格步长折算）时平仓。
- **止盈**：价格顺向运行 `TakeProfitPoints` 时获利了结。
- **移动止损**：当浮盈达到 `TrailingTriggerPoints` 后启动，并以 `TrailingStopPoints` 的距离跟随价格。多头跟踪自进场以来的最高价，空头跟踪最低价；一旦价格回落到移动止损位置即平仓。
- **状态重置**：每次出场后都会清除内部跟踪变量，避免影响下一笔交易。

## 默认参数
| 参数 | 默认值 | 说明 |
|------|--------|------|
| `CandleType` | `TimeSpan.FromHours(1).TimeFrame()` | 使用 1 小时 K 线计算 EMA。 |
| `FastLength` | 12 | 快速 EMA 周期。 |
| `MediumLength` | 144 | 中速 EMA 周期，用于空头确认。 |
| `SlowLength` | 169 | 慢速 EMA 周期，用于多头确认。 |
| `StopLossPoints` | 25 | 止损距离（以价格点计）。 |
| `TakeProfitPoints` | 230 | 止盈距离（以价格点计）。 |
| `TrailingStopPoints` | 35 | 移动止损距离。 |
| `TrailingTriggerPoints` | 20 | 启动移动止损所需的最小浮盈。 |

## 策略特性
- **类型**：趋势跟随型均线交叉策略。
- **标的**：适用于提供小时级行情并具备明确价格步长的品种。
- **方向**：可做多亦可做空，始终保持单向仓位。
- **时间框架**：默认 1 小时，可通过 `CandleType` 参数调整。
- **风险控制**：内置硬止损、止盈以及移动止损。
- **数据需求**：仅依赖 K 线收盘价，无需额外市场深度或成交数据。

## 补充说明
- 所有指标均使用 StockSharp 内置 EMA，实现方式符合高阶 API 的使用规范。
- 策略忽略未完成的 K 线，避免重复触发信号或使用部分数据。
- 移动止损价格通过 `ShrinkPrice` 调整到有效的最小价格步长，确保挂单价格有效。
- 默认参数保持与原始 MQL 版本一致，同时支持通过 StockSharp 的参数优化工具进行调优。
