# Стратегия SMC Trader Camel CCI MACD

## Обзор

Данная стратегия представляет собой портирование советника MetaTrader 4 **"Steve Cartwright Trader Camel CCI MACD"** на платформу StockSharp.
Алгоритм повторяет исходную логику: используется «верблюжий» канал из экспоненциальных средних по максимумам и минимумам,
фильтр тренда MACD и пороговые значения индикатора CCI. Все решения принимаются только на завершённых свечах,
что обеспечивает детерминированное поведение и повторяет бар-за-баром модель работы в MQL4.

## Логика торговли

1. **Индикаторы**
   - Две экспоненциальные скользящие средние одинаковой длины рассчитываются по максимумам и минимумам свечей, формируя
     канал Camel. Пробой предыдущего закрытия выше/ниже этих линий сигнализирует о силе импульса.
   - Индикатор MACD подтверждает направление тренда (быстрая EMA, медленная EMA и сигнальная линия).
   - Индикатор CCI подтверждает импульс через уровни перекупленности/перепроданности ±100 (по умолчанию).
2. **Вход в длинную позицию**
   - Закрытие предыдущей свечи выше верхней линии канала Camel.
   - Значение MACD основной линии на предыдущей свече выше нуля и выше сигнальной линии.
   - Значение CCI на предыдущей свече выше положительного порога.
   - Позиция отсутствует и с момента последнего выхода прошло не менее одной свечи (защита от повторных входов).
3. **Вход в короткую позицию**
   - Закрытие предыдущей свечи ниже нижней линии канала Camel.
   - Значение MACD основной линии на предыдущей свече ниже нуля и ниже сигнальной линии.
   - Значение CCI на предыдущей свече ниже отрицательного порога.
   - Дополнительно выполняются условия отсутствия позиции и тайм-аут после выхода.
4. **Выходы**
   - Длинная позиция закрывается при пересечении основной линии MACD ниже сигнальной либо при падении CCI ниже положительного порога.
   - Короткая позиция закрывается при пересечении основной линии MACD выше сигнальной.
   - После любого выхода запускается тайм-аут продолжительностью в одну свечу, который блокирует немедленный новый вход.

Благодаря использованию значений с предыдущей свечи стратегия совершает не более одной сделки за бар.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `CandleType` | Тип свечей и таймфрейм, используемые для расчётов индикаторов. | Свечи с периодом 1 час |
| `CamelLength` | Длина EMA-канала по максимумам и минимумам. | 34 |
| `CciPeriod` | Период индикатора CCI. | 20 |
| `MacdFastPeriod` | Период быстрой EMA MACD. | 12 |
| `MacdSlowPeriod` | Период медленной EMA MACD. | 26 |
| `MacdSignalPeriod` | Период сглаживания сигнальной линии MACD. | 9 |
| `CciThreshold` | Абсолютный порог CCI для открытия позиций (используется симметрично). | 100 |

Все параметры подготовлены к оптимизации через `SetOptimize`, что упрощает подбор значений в оптимизаторе StockSharp.

## Управление рисками

- Заявки отправляются методами `BuyMarket` и `SellMarket`, объём берётся из свойства `Volume` стратегии.
- Метод `StartProtection()` активирует стандартные защитные механизмы StockSharp.
- В алгоритме не предусмотрены фиксированные стоп-лосс или тейк-профит; закрытие выполняется только по сигналам индикаторов.

## Визуализация

Стратегия автоматически выводит на график канал Camel, MACD, CCI и собственные сделки, чтобы повторить визуальную поддержку,
которую использовал оригинальный советник.

## Дополнительные замечания

- Тайм-аут после выхода вычисляется на основе длительности свечи из `CandleType.Arg`. При смене таймфрейма убедитесь,
  что аргумент типа данных содержит корректный `TimeSpan`.
- Использование значений только с предыдущего бара эквивалентно вызовам `iMACD`, `iCCI` и `iMA` с `shift = 1` в оригинальном MQL-советнике.
