# Стратегия «Matrix Machine Learning»

## Описание
Matrix Machine Learning — это пример из образовательного проекта «MQL5Book» для MetaTrader 5. Оригинальный скрипт загружает окно последних тиков, превращает последовательность приращений цены в бинарный поток и обучает рекуррентную сеть Хопфилда. Затем веса проверяются на обучающем и форвардном сегменте, после чего направление первой компоненты прогноза (`+1` — рост, `-1` — падение) используется для открытия позиции.

Перенос на C# выполнен с использованием высокоуровневого API StockSharp. Вместо тиков применяются закрытые свечи, что обеспечивает предсказуемую работу в разных источниках данных. При каждом закрытии свечи стратегия обновляет бинарный паттерн, заново обучает сеть, рассчитывает статистику точности и формирует онлайн-прогноз.

## Детали алгоритма
1. Собрать `HistoryDepth` последних закрытий свечей. Последние `ForwardDepth` значений образуют форвардный набор, остальные — обучающую выборку.
2. Преобразовать последовательность разностей закрытий в бинарный ряд: неотрицательные изменения становятся `+1`, отрицательные — `-1`.
3. По каждому окну длиной `PredictorLength + ForecastLength` вычислить внешнее произведение векторов входа и ответа и просуммировать его — так строится матрица весов сети Хопфилда.
4. Оценить веса на обучающем и форвардном сегментах. Метрика совпадает с оригиналом: усреднённый скалярный результат между прогнозом и фактическим ответом переводится в процент точности.
5. Построить свежий бинарный паттерн, запустить итерационный цикл Хопфилда (tanh-активация и контроль сходимости) и использовать первую компоненту прогноза для принятия торгового решения.

## Параметры
- **History Depth** — объём истории закрытий, хранящейся в памяти сети. Должен быть больше `ForwardDepth` и не меньше `PredictorLength + ForecastLength + 1`.
- **Forward Depth** — размер форвардного окна для проверки модели. Требует минимум `ForecastLength + 1` свечей.
- **Predictor Length** — длина бинарного входного вектора нейросети.
- **Forecast Length** — количество шагов, которые предсказывает выходной вектор.
- **Candle Type** — тип свечей StockSharp, запрашиваемых у коннектора.
- **Debug Log** — при активации выводит подробные данные о расчётах и прогнозах.

## Торговая логика
- Если первая компонента прогноза положительна и текущая позиция ≤ 0, стратегия покупает объём `Volume + |Position|`, переворачиваясь в лонг.
- Если первая компонента отрицательна и позиция ≥ 0, выполняется продажа тем же объёмом для перехода в шорт.
- Нулевые прогнозы игнорируются, чтобы не создавать излишние операции.

При наличии графической панели стратегия автоматически рисует свечи и сделки. Переобучение сети на каждой закрытой свече позволяет весам оперативно подстраиваться под актуальную рыночную динамику.
