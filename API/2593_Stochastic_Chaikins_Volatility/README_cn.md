# Stochastic Chaikin's Volatility 策略

## 概述
本策略是 MetaTrader 指标专家 `Exp_Stochastic_Chaikins_Volatility` 的 StockSharp 版本。策略先计算每根 K 线高低价之间的区间，并通过可配置的移动平均线进行平滑处理，再将结果以类似随机指标 (Stochastic) 的方式标准化。交易逻辑保持原始 EA 的逆势思路：在振荡指标出现拐点时入场，振荡恢复原方向时出场。

## 指标构建
1. **Chaikin 式波动率**：`High-Low` 差值通过“第一平滑”移动平均处理。可选方法包括 SMA、EMA、SMMA、LWMA 以及 Jurik。
2. **随机标准化**：最近 `Stochastic Length` 个平滑值用于确定最高值与最低值，再将当前平滑值映射到 0–100 之间。
3. **再次平滑**：对标准化后的结果应用“第二平滑”移动平均，得到主振荡线；信号线等于上一根已完成 K 线的主振荡值，与 MQL 指标缓存完全一致。

## 交易规则
- **进场**
  - *做多*：当振荡指标在上一根 K 线形成顶部且当前值向下穿越该顶部时触发逆势多单。
  - *做空*：当振荡指标在上一根 K 线形成底部且当前值向上穿越该底部时触发逆势空单。
- **离场**
  - 多头仓位在前一根 K 线的振荡值低于更早一次的值时平仓，表明下行动量恢复。
  - 空头仓位在前一根 K 线的振荡值高于更早一次的值时平仓，表明上行动量恢复。
- `Signal Shift` 参数决定使用第几根已完成 K 线进行比较；默认值 1 复现了 MQL 脚本的行为。

## 参数说明
| 名称 | 说明 |
| --- | --- |
| `Candle Type` | 计算所用的 K 线类型/周期，默认 4 小时时间周期。 |
| `Primary Method` / `Primary Length` | 第一层平滑（高低价差）的移动平均类型与周期。 |
| `Secondary Method` / `Secondary Length` | 第二层平滑（标准化结果）的移动平均类型与周期。 |
| `Stochastic Length` | 用于归一化的窗口长度，决定最高值和最低值的回溯范围。 |
| `Signal Shift` | 生成信号时回看已完成 K 线的数量，需 ≥1。 |
| `Allow Long/Short Entry` | 是否允许开多 / 开空。 |
| `Allow Long/Short Exit` | 是否允许在振荡器反转时平多 / 平空。 |
| `High/Middle/Low Level` | 来自原始指标的参考水平线，仅用于图形展示。 |

## 使用提示
- StockSharp 版本使用平台内置的移动平均线。MQL 中的 ParMA、VIDYA、AMA 等特殊算法会被映射到最接近的可选项；如需更平滑的响应，可选择 Jurik。
- 仓位规模由基础策略的 `Volume` 决定，原 EA 中的自动止损/止盈函数未移植，可结合 `StartProtection` 或其他风险控制模块使用。
- 指标仅基于已完成的 K 线计算，请确保数据源能够提供所选周期的足够历史，以便完成两层平滑和随机窗口的预热。
