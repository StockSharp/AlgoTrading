# Стратегия Suffic369

## Описание
Suffic369 — трендовая пробойная стратегия, сочетающая две короткие скользящие средние и широкие полосы Боллинджера. Длинная позиция открывается, когда быстрая SMA по ценам закрытия пересекает сверху SMA по максимумам и при этом цена закрытия находится ниже нижней полосы Боллинджера. Короткая позиция появляется, когда быстрая SMA опускается ниже SMA по минимумам, а цена закрытия располагается над верхней полосой. Перенос в StockSharp полностью повторяет оригинальную логику MQL и строится на высокоуровневых подписках на свечи.

## Индикаторы
- **Быстрая SMA (Close, период 3)** — отслеживает краткосрочное направление цены закрытия.
- **SMA по максимумам (High, период 5)** — отражает локальные уровни сопротивления.
- **SMA по минимумам (Low, период 5)** — используется как ориентир поддержки для шортов.
- **Полосы Боллинджера (период 156, отклонение 1)** — выделяют экстремальные значения цены относительно волатильности.

Все индикаторы обрабатываются только на завершённых свечах. Предыдущие значения кэшируются, чтобы воспроизвести сдвиг на один бар, применённый в MetaTrader.

## Правила торговли
### Вход в лонг
1. Предыдущее значение быстрой SMA (close) ниже предыдущей SMA по максимумам.
2. Текущее значение быстрой SMA (close) выше текущей SMA по максимумам.
3. Цена закрытия свечи ниже нижней полосы Боллинджера.

### Вход в шорт
1. Предыдущая быстрая SMA (close) выше предыдущей SMA по минимумам.
2. Текущая быстрая SMA (close) ниже текущей SMA по минимумам.
3. Цена закрытия свечи выше верхней полосы Боллинджера.

### Выходы
- **Противоположный сигнал:** открытая позиция закрывается при появлении сигнала противоположного направления.
- **Стоп-лосс:** опциональное ограничение убытков в шагах цены.
- **Тейк-профит:** опциональная фиксация прибыли в шагах цены.
- **Трейлинг-стоп:** опциональное подтягивание стопа вслед за движением цены, полностью повторяющее логику модификации ордеров из MQL.

Одновременно удерживается только одна позиция. После срабатывания стопа, тейка или противоположного сигнала новые входы рассматриваются только на следующей завершённой свече.

## Параметры
| Имя | Значение по умолчанию | Описание |
|-----|-----------------------|----------|
| `FastMaLength` | 3 | Период быстрой SMA по закрытиям. |
| `HighMaLength` | 5 | Период SMA по максимумам. |
| `LowMaLength` | 5 | Период SMA по минимумам. |
| `BollingerLength` | 156 | Окно расчёта полос Боллинджера. |
| `BollingerDeviation` | 1 | Множитель стандартного отклонения для полос. |
| `UseStopLoss` | true | Включить блок стоп-лосса. |
| `StopLossPoints` | 30 | Дистанция стопа в шагах цены. |
| `UseTakeProfit` | true | Включить блок тейк-профита. |
| `TakeProfitPoints` | 60 | Дистанция тейк-профита в шагах цены. |
| `UseTrailingStop` | true | Включить трейлинг-стоп. |
| `TrailingStopPoints` | 30 | Отступ трейлинг-стопа в шагах цены. |
| `CandleType` | Таймфрейм 15 минут | Тип свечей для расчётов. |

Все числовые параметры оформлены как `StrategyParam<T>`, поэтому их можно оптимизировать средствами StockSharp.

## Управление рисками
- Для перевода параметров в пунктах используется шаг цены инструмента (`Security.PriceStep`).
- Трейлинг-стоп активируется только тогда, когда цена ушла дальше заданного расстояния, повторяя оригинальную проверку `OrderOpenPrice - Bid`/`Ask`.
- В `OnStarted` вызывается `StartProtection()`, чтобы активировать встроенные защитные механизмы StockSharp.

## Рекомендации по использованию
- Подписывайте стратегию на инструмент, поддерживающий выбранный тип свечей.
- Заранее задайте требуемый объём сделки через свойство `Volume`.
- Стратегия начинает торговать только после формирования всех индикаторов; первые свечи используются для прогрева расчётов.
