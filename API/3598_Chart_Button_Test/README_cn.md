# 图表按钮测试策略

## 概述
**图表按钮测试策略** 在 StockSharp 中模拟了原始 MQL 示例里的可拖拽图表按钮。策略使用一个虚拟的价格区间来表示按钮位置，区间中心跟随最新的市场数据，并通过日志消息还原手动拖动按钮时的反馈。

策略不会发送任何订单。将其附加到任意标的后，策略会监控已完成蜡烛的收盘价是否位于跟踪区间内，并在状态发生变化时写入日志，方便操作者基于日志建立告警或进一步自动化逻辑。

## 工作原理
1. 当第一根蜡烛收盘时，策略以该蜡烛的收盘价为中心创建虚拟按钮，同时记录起始时间并根据“选择时长”计算结束时间。
2. 每当新的蜡烛收盘时都会更新区间：
   * 若关闭 **Lock Time**，时间窗口将随着新蜡烛一起向前滚动。
   * 无论是否锁定时间，都会按照最新收盘价与“价格填充”参数重新计算区间上、下边界。
3. 当收盘价穿越区间边界时，日志会记录价格进入或离开该区域的提示。
4. 运行过程中修改参数会立即触发重新计算，并在日志中给出说明。

该行为对应 MQL 指标中可拖动的矩形按钮，此处借助自动数据更新来模拟拖动，同时保留了可调节的参数界面。

## 参数
| 参数 | 说明 |
|------|------|
| **Candle Type** | 策略处理的蜡烛数据类型，默认使用 5 分钟周期。 |
| **Price Padding** | 从中心价到上下边界的半宽度，默认 10 个价格单位，需为正值。 |
| **Selection Length** | 虚拟按钮覆盖的时间长度，从起始时间开始向后延伸。默认 1 小时。 |
| **Lock Time** | 开启后保持时间窗口固定；关闭时每根完成蜡烛都会移动时间窗口。 |

## 使用步骤
1. 将策略加载到投资组合并指定目标证券。
2. 根据标的波动情况设置蜡烛类型以及区间宽度参数。
3. 启动策略，等待第一根蜡烛收盘，检查日志了解初始化细节。
4. 运行过程中可随时调整 **Price Padding** 或 **Selection Length**，日志会确认每次调整。
5. 关注日志中的“进入”或“离开”提示，以判断市场价格是否处于跟踪区间内。

## 与 MQL 版本的差异
- StockSharp 策略不会在图表上绘制真实按钮，而是通过内部计算与日志模拟交互过程。
- 鼠标拖动被参数调整所替代，符合 StockSharp 的高阶 API 使用方式。
- 脚本不提交任何交易指令，与原始示例的行为保持一致。

## 备注
- 可以在此基础上增加告警或在价格进入/离开时触发交易。
- 策略基于收盘数据运行，建议选择合适的蜡烛周期以满足响应需求。
