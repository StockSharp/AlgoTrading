# Стратегия GoldWarrior02b
[English](README.md) | [中文](README_cn.md)

Алгоритмическая стратегия, конвертированная из советника MetaTrader *GoldWarrior02b*.
Комбинирует импульсный индикатор, Commodity Channel Index (CCI) и упрощённый ZigZag для торговли
в последние секунды каждого 15-минутного блока.

Реализация использует высокоуровневый API StockSharp и работает с чистой позицией.
Многоуровневый хеджинг оригинальной версии не реализован, так как StockSharp оперирует неттинговыми позициями.

## Концепция

- Пользовательский индикатор импульса усредняет разницу между ценами открытия и закрытия свечей.
- Значения CCI помогают обнаруживать развороты перекупленности/перепроданности и резкие импульсы.
- Направление ZigZag по недавним максимумам/минимумам фильтрует сделки против доминирующего движения.
- Сигналы проверяются только в финальные секунды (>= 45 сек) минут 14, 29, 44 и 59.
- Управление рисками включает стоп, тейк, трейлинг и общий целевой профит.

## Правила входа

Сделка рассматривается только при отсутствии открытой позиции и закрытии текущей свечи внутри указанного окна.

### Покупка
- Направление ZigZag вниз (текущий минимум ниже предыдущего).
- Выполняется одно из условий:
  - CCI растёт относительно предыдущего значения, при этом прежний CCI ниже -50, текущий ниже -30,
    импульс становится положительным, а прежний импульс был отрицательным.
  - Либо CCI опускается ниже -200, прежний CCI ещё ниже, импульс остаётся ниже положительного порога,
    а предыдущий импульс слабее текущего.

### Продажа
- Направление ZigZag вверх (текущий максимум выше предыдущего).
- Выполняется одно из условий:
  - CCI падает относительно предыдущего значения, при этом прежний CCI выше 50, текущий выше 30,
    импульс становится отрицательным, а прежний импульс был положительным.
  - Либо CCI поднимается выше 200, предыдущий CCI ещё выше, импульс остаётся выше отрицательного порога,
    а предыдущий импульс сильнее текущего.

Если предыдущий импульс попадает между порогами покупки и продажи, сигнал игнорируется.

## Правила выхода

- **Стоп-лосс**: закрывает позицию при пересечении уровня стопа.
- **Тейк-профит**: закрывает позицию при достижении целевого уровня прибыли.
- **Трейлинг**: после прохождения `(TrailingStop + TrailingStep)` пунктов трейлинг фиксируется
  на расстоянии `TrailingStop` пунктов. Пересечение уровня закрывает позицию.
- **Общий профит**: закрывает позицию при превышении нереализованной прибыли заданного значения (в валюте счёта).

## Параметры

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `BaseVolume` | Размер входа. | `0.1` |
| `StopLossPoints` | Стоп в пунктах. | `100` |
| `TakeProfitPoints` | Тейк-профит в пунктах. | `150` |
| `TrailingStopPoints` | Базовое расстояние трейлинга. | `5` |
| `TrailingStepPoints` | Дополнительное смещение перед активацией трейлинга. | `5` |
| `ImpulsePeriod` | Период для CCI и импульса. | `21` |
| `ZigZagDepth` | Минимум баров между переломами ZigZag. | `12` |
| `ZigZagDeviation` | Минимальный ход (в пунктах) для подтверждения перелома. | `5` |
| `ZigZagBackstep` | Минимум баров до принятия нового перелома. | `3` |
| `ProfitTarget` | Порог нереализованной прибыли для принудительного выхода. | `300` |
| `ImpulseSellThreshold` | Порог импульса для продаж (обычно отрицательный). | `-30` |
| `ImpulseBuyThreshold` | Порог импульса для покупок (обычно положительный). | `30` |
| `CandleType` | Таймфрейм расчёта. | `5 минут` |

## Примечания

- Импульсный индикатор — это скользящее среднее разницы open-close, масштабированное на `PriceStep` инструмента.
- Для расчёта трейлинга и PnL используются свойства `PriceStep` и `StepPrice` инструмента, переводящие пункты в валюту счёта.
- В оригинальном советнике реализованы наращивание объёма и хеджирование.
  В данной версии поддерживается только одна неттинговая позиция, соответствующая модели StockSharp.
- Для приближения поведения к оригиналу следует подписывать 15-минутные свечи и учитывать задержки данных.

## Отказ от ответственности

Пример предназначен для обучения. Перед использованием на реальном счёте протестируйте стратегию
на исторических и потоковых данных с учётом комиссий и задержек.
