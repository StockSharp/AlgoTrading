# Стратегия Williams Percent Directional Index

## Общее описание
**Williams Percent Directional Index Strategy** — это порт StockSharp для эксперта MetaTrader 5 «Mt5 Williams % Directional Index EA». Логика построена на сочетании Williams %R и направленного движения ADX для поиска смены импульса, а закрытие позиций контролируется индикаторами Money Flow Index (MFI) и Stochastic Oscillator. Реализация работает только с полностью сформированными свечами и использует механизмы `BindEx`, поэтому решения принимаются на основе окончательных значений индикаторов.

## Логика торговли
1. **Подтверждение тренда**
   - Для покупок Williams %R на двух предыдущих свечах должен расти (значение две свечи назад выше, чем одну свечу назад). Для продаж условие зеркальное.
   - Разница между линиями +DI и -DI (часть ADX) на последней закрывшейся свече обязана пересечь ноль: переход из отрицательной области в положительную подтверждает бычий импульс, переход из положительной в отрицательную — медвежий.
2. **Условия входа**
   - Если оба бычьих фильтра выполнены и стратегия не имеет длинной позиции, открывается покупка по рынку.
   - Если оба медвежьих фильтра выполнены и нет короткой позиции, открывается продажа по рынку.
   - В редком случае одновременных сигналов направление пропускается, чтобы избежать конфликтов.
3. **Условия выхода**
   - Длинная позиция закрывается, когда MFI двух свечей назад превышает уровень перекупленности либо когда %K стохастика формирует локальный «V-образный» разворот (`K[-2] > K[-1] < K[0]`).
   - Короткая позиция закрывается, когда MFI двух свечей назад падает ниже зеркального уровня перепроданности (`100 - уровень`) либо когда стохастик образует локальный максимум (`K[-2] < K[-1] > K[0]`).
4. **Управление рисками**
   - В рамках конвертации сохранены только правила входа/выхода. Стоп-лоссы, трейлинг и временные фильтры из MQL-версии не реализованы и при необходимости должны быть добавлены отдельно средствами StockSharp.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Candle Type` | Тип/таймфрейм свечей для расчётов. | 15-минутные свечи |
| `Williams %R Period` | Период расчёта индикатора Williams %R. | 42 |
| `Directional Period` | Период ADX (влияет на +DI и -DI). | 20 |
| `MFI Period` | Период индикатора Money Flow Index. | 19 |
| `MFI Level` | Уровень перекупленности для закрытия. Уровень перепроданности вычисляется как `100 - значение`. | 79 |
| `Stochastic %K` | Период %K стохастика. | 22 |
| `Stochastic %D` | Период %D стохастика. | 16 |
| `Stochastic Smoothing` | Дополнительное сглаживание (slowing) стохастика. | 21 |

Все параметры представлены через `StrategyParam`, поэтому их можно изменять и оптимизировать в интерфейсе StockSharp без правки кода.

## Рекомендации по использованию
- Перед запуском назначьте инструмент и объём, с которым стратегия будет работать.
- Обработка выполняется только по свечам в состоянии `CandleStates.Finished`, что исключает пересчёт незавершённых баров.
- При наличии графика стратегия отображает цену, Williams %R, ADX, MFI, стохастик и сделки для визуального контроля.
- Если необходимо повторить поведение оригинального эксперта по стоп-менеджменту, добавьте `StartProtection` или собственный модуль управления рисками.

## Отличия от версии MQL
- Используются встроенные индикаторы StockSharp и их привязка через `BindEx`, но математическая логика (пересечения нуля и трёхсвечные паттерны) полностью соответствует MQL-реализации.
- Код сессий, повторных попыток отправки ордеров и трейлинг-стопа опущен, чтобы сосредоточиться на ключевых сигналах, как и требовалось в задаче.
