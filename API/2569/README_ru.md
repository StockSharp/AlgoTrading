# Стратегия Elli Ichimoku ADX

## Описание
Порт эксперта MetaTrader 5 «Elli» (редакция barabashkakvn) на платформу StockSharp. Стратегия объединяет индикатор Ichimoku Kinko Hyo и фильтр по линии +DI индекса направленного движения (ADX). Сделки открываются только при наличии мощного импульса, подтверждённого упорядоченным расположением линий Ichimoku и резким ростом положительного направленного индекса.

В реализации для StockSharp сохранена работа с двумя потоками свечей: анализ Ichimoku выполняется на старшем таймфрейме (по умолчанию 1 час), а ADX рассчитывается на более быстром ряду (по умолчанию 1 минута). Рыночные заявки сопровождаются фиксированными стоп-лоссом и тейк-профитом в шагах цены, как в исходном советнике.

## Индикаторы и данные
- **Ichimoku** (Tenkan 19, Kijun 60, Senkou Span B 120 по умолчанию).
- **Average Directional Index (ADX)** – используется только линия +DI, как в оригинале.
- На графике отображаются свечи выбранного таймфрейма, облако Ichimoku и линия ADX.

Создаются две подписки на свечи:
1. `IchimokuCandleType` (по умолчанию H1) – для расчёта Ichimoku и генерации сигналов.
2. `AdxCandleType` (по умолчанию M1) – для расчёта ADX и хранения текущего/предыдущего значения +DI.

## Параметры
| Параметр | Значение по умолчанию | Назначение |
|----------|-----------------------|------------|
| `TakeProfitPoints` | 60 | Дистанция тейк-профита в шагах цены. 0 – отключить. |
| `StopLossPoints` | 30 | Дистанция стоп-лосса в шагах цены. 0 – отключить. |
| `TenkanPeriod` | 19 | Период линии Tenkan-sen. |
| `KijunPeriod` | 60 | Период линии Kijun-sen. |
| `SenkouSpanBPeriod` | 120 | Период линии Senkou Span B. |
| `AdxPeriod` | 10 | Период индикатора ADX. |
| `PlusDiHighThreshold` | 13 | Минимальное значение текущего +DI. |
| `PlusDiLowThreshold` | 6 | Максимальное значение предыдущего +DI. |
| `BaselineDistanceThreshold` | 20 | Минимальный зазор между Tenkan и Kijun в шагах цены. |
| `IchimokuCandleType` | Свечи 1 часа | Таймфрейм для расчёта Ichimoku. |
| `AdxCandleType` | Свечи 1 минуты | Таймфрейм для расчёта ADX. |

## Логика торговли
1. Дождаться закрытия свечи Ichimoku.
2. Проверить наличие двух последних значений ADX и факта пробоя по +DI (`предыдущее +DI < PlusDiLowThreshold` и `текущее +DI > PlusDiHighThreshold`).
3. Перевести расстояние между Tenkan и Kijun в шаги цены и убедиться, что оно превышает `BaselineDistanceThreshold`.
4. Если уже есть открытая позиция, новые заявки не выставляются.
5. **Покупка** выполняется, когда:
   - Tenkan > Kijun;
   - Kijun > Senkou Span A;
   - Senkou Span A > Senkou Span B (бычье облако);
   - Цена закрытия > Kijun.
6. **Продажа** выполняется при зеркальной конфигурации (Tenkan < Kijun < Senkou Span A < Senkou Span B и цена закрытия ниже Kijun).
7. Выход из позиции происходит по защитным ордерам, устанавливаемым через `StartProtection`. Дополнительные условия выхода не используются, что соответствует оригинальному советнику.

## Управление риском
Метод `StartProtection` запускается один раз при старте. Если стоп или тейк установлен в 0, соответствующий ордер не активируется. Заявки размещаются рыночными ордерами (`BuyMarket`/`SellMarket`) с заданными уровнями SL/TP.

## Особенности реализации
- Входы в обе стороны фильтруются только по +DI, поскольку в исходном коде блок с -DI был закомментирован.
- Линия Chikou напрямую не контролируется: для проверки структуры облака достаточно соотношения Senkou Span A и B.
- Последние значения +DI сохраняются во внутренних переменных, без обращения к `GetValue`, что соответствует рекомендациям по высокоуровневому API.
- Если таймфреймы Ichimoku и ADX совпадают, используется одна подписка на свечи.

## Рекомендации по применению
- Для воспроизведения оригинала оставьте быстрый ADX (`AdxCandleType`) и более медленный Ichimoku (`IchimokuCandleType`).
- Увеличивайте `BaselineDistanceThreshold` на волатильных рынках, чтобы требовать большего отрыва Tenkan от Kijun.
- Советник открывает только одну позицию, поэтому при работе с несколькими инструментами добавьте портфельный контроль риска.
