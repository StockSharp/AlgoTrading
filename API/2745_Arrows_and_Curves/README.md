# Arrows and Curves Strategy

## Overview
This strategy is a C# port of the MetaTrader 5 "Arrows and Curves" expert advisor (EA). It replicates the original indicator-based logic inside StockSharp using the high-level API. The system trades a single symbol and reacts to the custom channel signals generated by the Arrows and Curves indicator. Only one position can be active at a time, and every new signal either opens a fresh trade or closes an existing one.

## Strategy Logic
- Candles from the configurable timeframe are streamed via `SubscribeCandles`. The processing routine only works with finished candles to mirror the EA behaviour on new bar openings.
- The Arrows and Curves channel is rebuilt inside the strategy: the algorithm scans the highest high and lowest low for the `SSP` lookback window, shifted by the `Relay` offset just like the MT5 indicator. From those values two envelopes are derived (`Channel %` for the outer band and `Channel Stop %` for the inner band).
- The indicator state variables (`uptrend` and `uptrend2`) are updated exactly in the same order as in the original MQL code. Whenever the previous candle produces a Sell arrow the strategy prepares a long entry, and whenever it produces a Buy arrow the strategy prepares a short entry. This mirrors the EA behaviour where the signals are read with an index of 1 on the next bar.
- When no position is open, the stored signal from the previous bar is used to open a market order in the opposite direction of the arrow (Sell arrow → Buy trade, Buy arrow → Sell trade).
- When a position already exists and an opposite signal appears, the current position is closed but a reverse position is **not** opened immediately, matching the MT5 source where closing happens first and entries are evaluated again on the next bar.

## Risk Management
- Stop loss and take profit distances are defined in pips and converted to absolute price offsets using the instrument `PriceStep`. For instruments quoted with 3 or 5 decimal places the conversion multiplies the step by ten, reproducing the pip adjustments of the EA.
- Trailing stop functionality mirrors the EA: once the floating profit exceeds `Trailing Stop + Trailing Step`, the protective stop is trailed by the configured distance while respecting the minimum step.
- Protective levels are checked on every completed candle by using the candle high/low to approximate intrabar triggers.
- Position sizing can be fixed via the `Volume` parameter. When `Volume` is set to zero, the strategy derives a dynamic quantity by risking `Risk %` of the portfolio value against the configured stop-loss distance.

## Parameters
- `Volume`: fixed order size. Set to zero to enable risk-based sizing.
- `Risk %`: percentage of portfolio value to risk when volume is zero.
- `Stop Loss (pips)`: distance of the protective stop in pips.
- `Take Profit (pips)`: distance of the profit target in pips.
- `Trailing Stop (pips)`: trailing stop distance in pips; set to zero to disable.
- `Trailing Step (pips)`: minimum additional move required before the trailing stop is shifted again.
- `SSP`: number of candles used to calculate the channel range.
- `Channel %`: outer envelope percentage, identical to the MT5 setting.
- `Channel Stop %`: inner envelope percentage used to flip the secondary state.
- `Relay`: shift applied to the channel calculation.
- `Candle Type`: timeframe or candle type that feeds the indicator.

## Implementation Notes
- The strategy stores only the minimal amount of historical highs, lows and closes required by the indicator (`SSP + Relay + 5` bars).
- All comments and helper methods are written in English to match repository guidelines.
- Unlike MT5, stop-loss and take-profit orders are simulated on candle data, so intrabar fills may differ from the original EA. Everything else follows the same decision rules, making the port faithful to the source script.
