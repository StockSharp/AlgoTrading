# Стратегия XOSignal Re-Open
[English](README.md) | [中文](README_cn.md)

Стратегия переносит советник MetaTrader *Exp_XOSignal_ReOpen* в среду StockSharp и использует высокоуровневый API. Работа ведётся по свечам выбранного инструмента и таймфрейма с помощью индикатора XO, построенного на ATR(13). Появление стрелки вверх закрывает короткие позиции, при необходимости открывает длинную и добавляет новые лоты при каждом движении цены на заданное число тиков. Стрелка вниз действует симметрично для коротких позиций. Для каждого уровня пирамиды задаются фиксированные стоп-лоссы и тейк-профиты в тиках.

## Логика

- Формируется XO-канал, ширина которого равна `Range * PriceStep`. Пробой границы обновляет канал и задаёт направление тренда.
- ATR(13) определяет удаление виртуальных уровней входа: стрелка вверх располагается на `Low - ATR * 3/8`, стрелка вниз на `High + ATR * 3/8`.
- Обрабатываются только закрытые свечи. Сигналы могут быть отложены на `SignalBar` баров, как в оригинале.

## Условия входа

- **Покупка**: исполняется при появлении стрелки вверх, если разрешён вход (`EnableBuyEntries = true`), нет открытых шортов и сигнал ещё не использован. Объём равен параметру `Volume`.
- **Добор в лонг**: пока позиция открыта, каждый рост на `PriceStepTicks` тиков (по цене закрытия свечи) инициирует дополнительную покупку, пока не будет достигнут предел `MaxPyramidingPositions`. После каждого добора пересчитываются защитные уровни.
- **Продажа и добор в шорт**: зеркально описанному выше сценарию.

## Условия выхода

- **Сигнальные выходы**: стрелка вверх закрывает шорты при `EnableSellExits = true`; стрелка вниз закрывает лонг при `EnableBuyExits = true`.
- **Риск-менеджмент**: все открытые слои имеют одинаковые стоп-лосс и тейк-профит (`StopLossTicks`, `TakeProfitTicks`). При пробое уровня внутри свечи позиция полностью закрывается.
- **Разворот**: противоположный вход автоматически ликвидирует старое направление перед открытием нового.

## Управление позицией

- Объём каждой заявки фиксирован параметром `Volume`.
- Стоп и тейк задаются в тиках инструмента; нулевое значение отключает соответствующую защиту.
- Счётчик уровней пирамиды обнуляется после полного выхода, чтобы новая серия начиналась с первого ордера.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `Volume` | Объём каждой заявки | `1` |
| `StopLossTicks` | Стоп-лосс в тиках (0 — выключен) | `1000` |
| `TakeProfitTicks` | Тейк-профит в тиках (0 — выключен) | `2000` |
| `PriceStepTicks` | Минимальное движение в прибыль для добора | `300` |
| `MaxPyramidingPositions` | Максимум слоёв пирамиды (включая первый) | `10` |
| `EnableBuyEntries` / `EnableSellEntries` | Разрешение на открытие лонгов/шортов | `true` |
| `EnableBuyExits` / `EnableSellExits` | Разрешение на закрытие при противоположной стрелке | `true` |
| `CandleType` | Рабочий таймфрейм | `H4` |
| `Range` | Высота XO-бокса в тиках | `10` |
| `AppliedPrice` | Цена, используемая в расчёте XO | `Close` |
| `SignalBar` | Сколько закрытых баров ждать перед исполнением сигнала | `1` |

Перед использованием подберите значения в тиках под волатильность выбранного инструмента и убедитесь, что шаг цены задан корректно.
