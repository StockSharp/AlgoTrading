# ENewsLuckyw 策略

## 概述
**ENewsLuckyw 策略** 是从 MetaTrader 智能交易系统 *e-News-Lucky$* 移植而来的定时突破策略。它会在预设时间在当前价格上下提交对称的买入止损和卖出止损单，并在挂单同时保持两者围绕价格移动。同时，策略会复制原始 MQL 逻辑中的持仓管理、可选的移动止损以及收盘清理。

## 交易逻辑
- **定时布置对敲挂单。** 到达 `SetOrdersTime` 时，策略会撤销现有挂单，获取当前蜡烛收盘价，并在距离 `DistancePips` 的位置提交新的对称止损单。
- **持续校准挂单。** 当两张挂单都处于激活状态时，每根完成的蜡烛都会重新调整价格，使对敲始终围绕市场中心，就像原始专家在每根新柱上所做的那样。
- **入场准备。** 止损和可选的止盈会提前计算，在持仓打开后立即附加；一旦出现仓位，会立刻删除与仓位方向相反的挂单。
- **移动止损保护。** 当 `UseTrailing` 启用时，价格每向盈利方向前进 `TrailingStepPips`，止损就按 `TrailingStopPips` 向内移动。如果 `ProfitTrailing` 为真，只有当未实现利润超过移动止损距离时才开始移动，等同于 MQL 中的 “ProfitTrailing” 选项。
- **收盘清理。** 到达 `DeleteOrdersTime` 时，会撤销所有挂单并平掉当前持仓，避免隔夜风险。

## 参数
| 名称 | 说明 |
| --- | --- |
| `Volume` | 两张止损挂单使用的交易量（手数）。 |
| `StopLossPips` | 保护性止损距离，设为 0 表示不使用。 |
| `TakeProfitPips` | 可选的止盈距离，设为 0 表示不使用。 |
| `DistancePips` | 买卖止损挂单与当前价格的偏移量。 |
| `UseTrailing` | 是否在开仓后启用移动止损。 |
| `ProfitTrailing` | 是否要求未实现利润超过移动距离后再移动止损。 |
| `TrailingStopPips` | 移动止损与价格之间保持的距离。 |
| `TrailingStepPips` | 每次移动止损前所需的最小盈利增量。 |
| `SetOrdersTime` | 提交对敲挂单的时间。 |
| `DeleteOrdersTime` | 撤销挂单并平仓的时间。 |
| `CandleType` | 用于时间跟踪和维护的蜡烛订阅类型。 |

## 使用说明
1. 将策略附加到目标标的，并设置 `CandleType` 为希望使用的维护周期（默认 1 分钟蜡烛）。
2. 根据新闻事件或交易时段调整定时参数。
3. 根据标的波动性调整距离与风险控制。对于外汇品种，请确保正确配置 `PriceStep`，以便 `StopLossPips`、`TakeProfitPips` 与 `DistancePips` 转换为期望的价格偏移。
4. 策略使用止损和限价单进行退出。如果交易所不支持这些委托方式，请在实盘前改为市价或模拟委托。
5. 策略以交易日为单位进行重置。如果交易跨越交易所时区的午夜，请确认整个交易窗口位于同一交易日内。

## 转换说明
- 该策略完整复刻了原始 MQL 结构：定时下单 (`SetOrders`)、新柱刷新 (`ModifyOrders`)、删除相反挂单 (`DeleteOppositeOrders`)、移动止损 (`TrailingPositions`) 以及日终清理。
- MQL 中基于点差的价格计算在此版本中通过最新蜡烛收盘价近似实现，因为 StockSharp 会按照 `PriceStep` 对价格进行归一化。
- 原脚本的声音提醒、账户号检查和颜色设置在高层 API 中没有直接对应，因此被省略。
