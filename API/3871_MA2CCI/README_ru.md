# Стратегия пересечения MA2CCI
[English](README.md) | [中文](README_cn.md)

MA2CCI переносит классический советник MetaTrader, построенный на взаимодействии двух скользящих средних и индикатора CCI. Фильтрация сделок происходит через пересечение нулевой линии CCI, а защитные стопы рассчитываются по ATR. Получается трендовая система с быстрой реакцией на смену направления.

Версия для StockSharp сохраняет торговую логику оригинала, но адаптирует управление рисками под .NET. Размер позиции рассчитывается по правилу «доля капитала на тысячу» и дополнительно уменьшается после серии убыточных сделок. Каждый вход сопровождается волатильностным стопом на расстоянии одной величины ATR от цены открытия, что повторяет подход в MQL.

## Логика торговли

- **Индикаторы**
  - Быстрая SMA (период 4).
  - Медленная SMA (период 8).
  - CCI с периодом 4 для фильтрации.
  - ATR с периодом 4 для постановки стопа.
- **Условия входа**
  - **Покупка**: быстрая SMA пересекает медленную снизу вверх, а CCI на предыдущей свече переходит из отрицательной области в положительную.
  - **Продажа**: быстрая SMA пересекает медленную сверху вниз, а CCI опускается ниже нуля на предыдущей свече.
- **Условия выхода**
  - Обратное пересечение SMA закрывает позицию даже без формирования нового сигнала.
  - Стоп по ATR: длинные позиции закрываются при падении цены до `entry - ATR`, короткие — при росте до `entry + ATR`.

## Управление рисками

- Базовый объём сделки настраивается, по умолчанию 0.1 лота.
- Динамический расчёт объёма использует значение `свободный капитал * MaxRiskPerThousand / 1000`, если портфель предоставляет такие данные.
- После более чем одной подряд убыточной сделки объём уменьшается пропорционально `losses / DecreaseFactor`.
- Стопы по волатильности анализируются на закрытии свечи; проколы внутри бара приводят к рыночному выходу при следующем вызове стратегии.

## Параметры

| Название | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Рабочий таймфрейм для расчёта индикаторов. | Свечи 1 час |
| `OrderVolume` | Минимальный размер позиции при отсутствии данных о капитале. | 0.1 |
| `FastMaPeriod` | Период быстрой SMA. | 4 |
| `SlowMaPeriod` | Период медленной SMA. | 8 |
| `CciPeriod` | Период индикатора CCI. | 4 |
| `AtrPeriod` | Период ATR для стопа. | 4 |
| `MaxRiskPerThousand` | Доля свободного капитала на сделку (в расчёте на тысячу). | 0.02 |
| `DecreaseFactor` | Делитель, уменьшающий объём после серии убытков. | 3 |

## Особенности

1. Стратегия обрабатывает только закрытые свечи — аналогично условию `Volume[0] > 1` в MQL, что исключает повторные решения внутри бара.
2. Стопы моделируются внутри стратегии и реализуются рыночным выходом, как и в исходном советнике.
3. Для визуального анализа подключите отображение свечей, SMA, CCI и сделок в StockSharp Designer.
