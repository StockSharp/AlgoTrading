# AK-47 剥头皮策略

## 概述
**AK-47 剥头皮策略** 源自 MQL4 专家顾问 “AK-47 Scalper EA”，在 StockSharp 平台上实现为高级 API 策略。策略始终在盘口中保持一个止损单：要么在行情下方挂出卖出止损，要么在上方挂出买入止损。挂单价格与当前买/卖价之间始终保持为止损距离的一半，从而追随点差并捕捉短线突破。

## 交易逻辑
1. 订阅所选的 K 线类型（默认 1 分钟）并读取最新的买卖报价。
2. 在允许的交易时间段内，策略维护一个方向固定的挂单。挂单价格距离当前买价或卖价半个止损距离，与原版 EA 的逻辑完全一致。
3. 当挂单被触发后，立即重建止损和可选的止盈订单。随着行情向有利方向发展，止损会向价格移动，但始终保持相同的点数间距。
4. 如果时间过滤器失效或点差超过阈值，策略会撤销当前挂单；当条件恢复正常时，会重新下单。

## 风险管理
- **StopLossPips** – 设置止损距离（点），同时决定挂单与行情之间的偏移量。止损启用时还会驱动后续的追踪止损逻辑。
- **TakeProfitPips** – 可选的止盈目标（点）。设为 `0` 可关闭止盈，仅保留止损管理。
- **UseRiskPercent / RiskPercent / FixedVolume** – 复刻原始 EA 的仓位控制方式。启用 `UseRiskPercent` 时，仓位大小根据可用资金和风险百分比计算；否则直接使用 `FixedVolume`。
- **MaxSpreadPoints** – 当当前点差（以价格最小变动点为单位）超过阈值时阻止新开仓。策略会根据标的的最小价格跳动自动换算实际价格差。
- 每次成交（包括部分成交）都会重建保护性订单，以确保全部仓位受保护。

## 参数
| 参数 | 说明 | 默认值 |
|------|------|--------|
| `Direction` | 挂单方向：卖出止损或买入止损。 | `SellStop` |
| `UseRiskPercent` | 是否根据风险百分比计算仓位。 | `true` |
| `RiskPercent` | 用于计算仓位的风险百分比。 | `3` |
| `FixedVolume` | 未启用风险百分比时使用的基础手数。 | `0.01` |
| `StopLossPips` | 止损距离（点），同时决定挂单偏移。 | `3.5` |
| `TakeProfitPips` | 止盈距离（点），0 表示禁用。 | `7` |
| `MaxSpreadPoints` | 允许的最大点差（以最小价格变动点为单位）。 | `5` |
| `UseTimeFilter` | 是否启用交易时间过滤。 | `true` |
| `StartHour` / `StartMinute` | 交易时段开始时间（平台时区）。 | `02:30` |
| `EndHour` / `EndMinute` | 交易时段结束时间。 | `21:00` |
| `CandleType` | 用于管理逻辑的 K 线类型。 | `1 分钟` |

## 备注
- 对于 5 位或 3 位小数报价，策略会自动将最小价格跳动乘以 10，得到与 MetaTrader 相同的“点”大小。
- 需要实时盘口数据，以便更新最新买卖价并执行点差过滤。
- 本目录仅提供 C# 版本，没有 Python 版本。
