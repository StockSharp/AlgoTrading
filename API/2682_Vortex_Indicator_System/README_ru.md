# Стратегия Vortex Indicator System

## Общее описание
- **Источник**: Конвертация советника MetaTrader 5 "Vortex Indicator System" (MQL ID 19137).
- **Идея**: Использует индикатор Vortex для поиска пересечения линий VI+ и VI-, после чего выставляет пробойные триггеры по максимуму или минимуму свечи пересечения.
- **Тип входа**: Стратегия следует за пробоем — сделки открываются только при подтверждении пересечения ценой.
- **Рынки и таймфреймы**: Работает на любых инструментах и таймфреймах, где доступен индикатор Vortex и свечные данные.
- **Типы заявок**: Рыночные ордера `BuyMarket` и `SellMarket`. Перед активацией нового триггера стратегия закрывает противоположные позиции.

## Логика торговли
1. Подписка на выбранный тип свечей и расчёт индикатора Vortex с заданной длиной.
2. Бычье пересечение: `VI+` становится выше `VI-`, при этом на предыдущей свече `VI+` был не выше `VI-`.
   - Закрыть текущую короткую позицию через `ClosePosition()`.
   - Запомнить максимум свечи пересечения как цену активации лонга.
   - Сбросить возможный шорт-триггер.
3. Медвежье пересечение: `VI-` становится выше `VI+`, при этом на предыдущей свече `VI-` был не выше `VI+`.
   - Закрыть текущую длинную позицию.
   - Запомнить минимум свечи пересечения как цену активации шорта.
   - Сбросить возможный лонг-триггер.
4. Пока активен триггер, проверять закрывшиеся свечи:
   - Если максимум свечи превышает лонг-триггер и позиция плоская либо короткая, выставить `BuyMarket` на объём, достаточный для реверса.
   - Если минимум свечи пробивает шорт-триггер и позиция плоская либо длинная, выставить `SellMarket` на объём, достаточный для реверса.
5. После исполнения ордера соответствующий триггер очищается. Одновременно может существовать только один тип триггера.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `Length` | 14 | Период индикатора Vortex. Полностью соответствует входному параметру `VI_Length` в оригинальном советнике. |
| `CandleType` | Свечи 60 минут | Тип свечей для расчёта индикатора и проверки триггеров. Можно менять на любой доступный таймфрейм. |
| `Volume` | Значение из базового свойства `Strategy.Volume` | Объём рыночных заявок. Настраивается пользователем до запуска стратегии. |

### Как параметры влияют на поведение
- Увеличение `Length` сглаживает линии Vortex, снижает количество пересечений, но повышает надёжность сигналов.
- Уменьшение `Length` делает систему более чувствительной и увеличивает число сделок.
- `CandleType` желательно выбирать в соответствии с таймфреймом, на котором тестировался оригинальный советник.

## Управление рисками
- В советнике отсутствуют стоп-лосс и тейк-профит. Конверсия сохраняет это поведение, поэтому управление рисками должно выполняться внешними средствами или через расширение стратегии.
- При появлении противоположного сигнала стратегия сперва закрывает текущую позицию (`ClosePosition()`), а затем ждёт подтверждающего пробоя.
- Система всегда находится либо без позиции, либо в одной сделке; усреднение или наращивание не используется.

## Инструкция по применению
1. Добавьте стратегию в проект StockSharp и убедитесь, что доступна библиотека `StockSharp.Algo.Indicators`.
2. Настройте подключение к брокеру/источнику данных и выберите торгуемый инструмент.
3. Выставьте параметры `CandleType`, `Length` и `Volume` перед запуском (или используйте оптимизацию).
4. Запустите стратегию. Сигналы появятся после формирования достаточного числа свечей для индикатора и получения онлайн-данных.

## Особенности реализации
- Используется высокоуровневый API `SubscribeCandles` с привязкой индикатора через `Bind`, что упрощает обработку сигналов.
- Переменные для предыдущих значений индикатора повторяют логику MQL-сценария и позволяют точно фиксировать моменты пересечения.
- Триггеры на вход реализованы в виде nullable-полей, что делает код читаемым и исключает ложные повторные входы.
- В коде добавлены поясняющие комментарии на английском языке, как требует инструкция.

## Возможные доработки
- Добавление стоп-лосса/тейк-профита (например, на основе ATR) для более строгого контроля риска.
- Введение временного тайм-аута, по истечении которого неактивный триггер сбрасывается.
- Фильтрация сигналов по волатильности или трендовым индикаторам, чтобы избегать флетовых периодов.
