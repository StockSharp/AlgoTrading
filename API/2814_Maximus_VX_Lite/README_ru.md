# Стратегия Maximus vX Lite
[English](README.md) | [中文](README_cn.md)

Конверсия советника MetaTrader 5 «maximus_vX lite» на высокоуровневый API StockSharp.
Стратегия ищет зоны консолидации выше и ниже текущей цены и ждёт, пока цена не уйдёт на заданное число пунктов
от границ зоны, прежде чем открыть сделку. Размер позиции рассчитывается по необязательному проценту риска,
а при достижении плавающей прибыли все позиции могут быть принудительно закрыты.

## Логика стратегии

1. **Исторический анализ** – на каждой завершённой свече стратегия хранит до `HistoryDepth` свечей и с помощью
   окна длиной `RangeLookback` находит компактные максимумы и минимумы, формирующие зоны консолидации.
2. **Верхний канал** – если найден допустимый верхний блок, канал центрируется вокруг текущего закрытия с шириной
   `RangePoints`. Если подходящего блока нет, используется синтетический канал той же ширины, привязанный к текущей цене.
3. **Нижний канал** – нижний блок либо берётся напрямую из истории (если выполнены условия по диапазону), либо,
   при отсутствии подходящих данных, формируется синтетически вокруг цены минус `RangePoints`.
4. **Входы в лонг** – доступны два сценария:
   - Пробой нижней консолидации: цена должна превысить `_lowerMax` на величину `DistancePoints`, при этом верхний канал
     обязан существовать. Тейк-профит рассчитывается как две трети расстояния между `_lowerMax` и `_upperMin`, но не меньше
     `RangePoints`.
   - Пробой верхнего канала: цена должна превысить `_upperMax` на `DistancePoints`. Тейк-профит равен `2 * RangePoints`.
5. **Входы в шорт** – зеркальная логика при падении цены ниже `_upperMin` или `_lowerMin` на величину `DistancePoints`.
   Основной шорт использует динамическую цель «две трети», вторичный — фиксированные `2 * RangePoints`.
6. **Стопы и выходы** – параметр `StopLossPoints` задаёт фиксированный стоп (если больше нуля). `MinProfitPercent`
   отслеживает разницу между текущей стоимостью портфеля и балансом в момент отсутствия позиций и закрывает сделки при
   превышении порога. Проверка стопов и целей выполняется вручную, повторяя поведение исходного советника.
7. **Размер позиции** – при `RiskPercent` > 0 и наличии стопа объём рассчитывается от стоимости портфеля и расстояния
   до стопа. В противном случае используется базовое свойство `Volume`.

## Параметры

- `DelayOpen` (по умолчанию `2`) – количество таймфреймов, в течение которых допускается усреднение в ту же сторону.
- `DistancePoints` (по умолчанию `850`) – минимальное расстояние от границы зоны консолидации для входа.
- `RangePoints` (по умолчанию `500`) – ширина прямоугольников консолидации.
- `HistoryDepth` (по умолчанию `1000`) – число сохраняемых свечей для анализа истории.
- `RangeLookback` (по умолчанию `40`) – длина окна для поиска локальных максимумов и минимумов.
- `CandleType` (по умолчанию `TimeSpan.FromMinutes(15).TimeFrame()`) – рабочий таймфрейм.
- `RiskPercent` (по умолчанию `5m`) – процент капитала, используемый под риск на сделку. Ноль отключает расчёт риска.
- `StopLossPoints` (по умолчанию `1000`) – расстояние до стоп-лосса; ноль отключает стоп.
- `MinProfitPercent` (по умолчанию `1m`) – порог плавающей прибыли для принудительного закрытия всех позиций.

## Дополнительная информация

- **Направление**: Лонг и шорт
- **Выход**: Фиксированный стоп/тейк, плюс закрытие по прибыли `MinProfitPercent`
- **Стопы**: Опциональный фиксированный стоп `StopLossPoints`
- **Индикаторы**: Нет (анализ чистой цены с использованием скользящего окна)
- **Таймфрейм**: Настраивается параметром `CandleType` (по умолчанию 15 минут)
- **Сложность**: Средняя (исторический анализ, динамические цели и риск-менеджмент)
- **Уровень риска**: Повышенный при использовании процентного риска из-за пробойной природы стратегии
