# Order Escort Trailing Manager
[English](README.md) | [中文](README_cn.md)

Утилитарная стратегия, повторяющая логику советника «Order Escort». Она не открывает новые позиции, а отслеживает уже открытую позицию по выбранному инструменту и после каждой завершённой свечи сдвигает защитный стоп (и при необходимости тейк-профит). Длина трейлинга увеличивается по выбранной кривой (линейной, параболической или экспоненциальной) вплоть до заданного числа баров.

## Подробности

- **Условия входа**: отсутствуют. Позиция предполагается открытой вручную или другой системой.
- **Направление торговли**: поддерживаются длинные и короткие позиции.
- **Условия выхода**:
  - Закрытие при достижении трейлинг-стопа.
  - Закрытие при достижении сопровождаемого тейк-профита.
  - Принудительное закрытие после заданного количества баров (`CloseBar`).
- **Стопы**: автоматически пересчитываемый трейлинг-стоп, основанный на количестве баров.
- **Значения по умолчанию**:
  - `TargetBar` = 35
  - `DeltaPoints` = 80
  - `TrailingMode` = Linear
  - `Exponent` = 0.5
  - `EBase` = 2.718
  - `EscortTakeProfit` = true
  - `CloseBar` = 15
  - `CandleType` = таймфрейм 1 минута
- **Фильтры**:
  - Категория: Управление позицией
  - Направление: Оба
  - Индикаторы: Нет
  - Стопы: Трейлинг-стоп и сопровождаемый тейк-профит
  - Сложность: Средняя
  - Таймфрейм: Настраиваемый
  - Сезонность: Нет
  - Нейросети: Нет
  - Дивергенция: Нет
  - Уровень риска: зависит от исходных защитных приказов

## Как работает

1. Подписывается на выбранные свечи и считает количество завершённых баров с момента запуска.
2. Рассчитывает общую длину трейлинга в пунктах по одной из трёх прогрессий:
   - **Линейная** — равномерное увеличение смещения на `DeltaPoints / TargetBar` за каждый бар.
   - **Параболическая** — степенная кривая с показателем `Exponent`.
   - **Экспоненциальная** — умножение расстояния с использованием базы `EBase`.
3. При наличии позиции фиксирует исходные уровни стопа и тейк-профита по цене закрытия первой завершённой свечи после входа.
4. На каждой свече переводит трейлинг из пунктов в цену (через шаг цены инструмента) и обновляет уровни стопа и тейк-профита.
5. Если цена пересекает один из уровней, позиция закрывается рыночной заявкой. При достижении `CloseBar` позиция закрывается принудительно.

## Примечания

- Стратегия предназначена для сопровождения сделок и хорошо сочетается с дискретионными входами или другими автоматическими сигналами.
- Наилучший результат достигается, когда изначальные стопы и тейки расположены близко к желаемым защитным уровням, так как трейлинг смещает зафиксированные опорные точки.
- Шаг цены берётся из `Security.PriceStep`; при отсутствии значения используется шаг 1.
