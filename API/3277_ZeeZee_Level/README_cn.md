# ZeeZee Level 策略

## 概述

ZeeZee Level 策略按照原始 MetaTrader “ZeeZee Level” 智能交易程序的行为，使用 StockSharp 高级 API 重新实现。策略在所选周期上分析 ZigZag 波动点，并依据最近一次确认的极值方向入场。止损、止盈以及移动止损均以点数表示；仓位规模在出现亏损时按照马丁公式递增。

## 交易逻辑

1. 按照 `CandleType` 参数订阅指定周期的蜡烛图数据。
2. 使用可配置深度、偏离值和回溯参数的 `ZigZagIndicator` 识别最新的波峰与波谷。
3. 当没有持仓时，策略在 `ZigZagIdInterval` 范围内比较最近的 ZigZag 高点和低点：
   - 如果最近的波峰比最近的波谷更新，则开立空头仓位。
   - 如果最近的波谷比最近的波峰更新，则开立多头仓位。
4. 同一时间只持有一个方向的仓位，入场数量会根据标的的交易步长自动对齐。
5. 开仓后立即根据参数设置止损、止盈以及可选的移动止损距离。移动止损仅在行情向有利方向发展时跟随新的极值移动。
6. 一旦价格触及止损或止盈水平即平仓。当同一根 K 线同时触发两条防守线时，优先执行距离入场价更近的那个水平。
7. 平仓后，如果交易盈利则恢复到初始手数；若发生亏损则将下一笔交易手数乘以马丁系数。

## 参数

| 参数 | 说明 |
|------|------|
| `ZigZagDepth` | 搜索 ZigZag 波动点时考虑的蜡烛数量。 |
| `ZigZagDeviation` | 确认新波动点所需的最小价格偏离（按价格步长计）。 |
| `ZigZagBackstep` | ZigZag 在切换方向前至少等待的柱数。 |
| `ZigZagIdInterval` | 回溯 ZigZag 最新高低点时允许的最大柱数。 |
| `StopLossPips` | 止损距离（点）。设为 0 可关闭。 |
| `TakeProfitPips` | 止盈距离（点）。设为 0 可关闭。 |
| `TrailingStopPips` | 移动止损距离（点）。设为 0 可关闭。 |
| `InitialVolume` | 马丁循环开始时使用的初始手数。 |
| `MartingaleMultiplier` | 出现亏损后下一笔仓位手数的放大系数。 |
| `CandleType` | 用于分析的蜡烛类型及周期。 |

## 资金管理

- 仓位数量会根据交易品种的最小变动手数对齐，并受交易所规定的最小/最大手数限制。
- 盈利交易后手数重置为 `InitialVolume`；亏损交易则将手数乘以 `MartingaleMultiplier`。

## 风险管理

- 每根已完成的蜡烛都会重新评估止损、止盈和移动止损水平。
- 移动止损仅向盈利方向移动，从不向相反方向回退。
- 当尚未获得有效的 ZigZag 高低点，或仍有持仓时，策略将暂停新的入场信号。

## 备注

- 策略仅使用已收盘的蜡烛，以贴近原始智能交易程序的行为。
- 点值换算依赖品种的 `PriceStep` 信息，启动前请确保相关合约元数据已经加载。
