# Стратегия ZeeZee Level

## Обзор

Стратегия ZeeZee Level переносит логику оригинального эксперта MetaTrader «ZeeZee Level» на высокоуровневый API StockSharp. Алгоритм анализирует экстремумы индикатора ZigZag на выбранном таймфрейме и открывает позицию в сторону последнего подтверждённого экстремума. Уровни стоп-лосса, тейк-профита и трейлинг-стопа задаются в пунктах, а объём сделки увеличивается по принципу мартингейла после убыточных сделок.

## Логика работы

1. Подписка на свечи выполняется согласно параметру `CandleType`.
2. Индикатор `ZigZagIndicator` с настраиваемыми параметрами глубины, отклонения и backstep отслеживает новые максимумы и минимумы.
3. При отсутствии открытой позиции стратегия сравнивает давность последнего ZigZag-хая и лоу в пределах окна `ZigZagIdInterval`:
   - если последний максимум оказался свежее последнего минимума — открывается короткая позиция;
   - если последний минимум свежее последнего максимума — открывается длинная позиция.
4. Одновременно удерживается только одна позиция, причём объём приводится к шагу объёма инструмента.
5. После открытия сделки выставляются уровни стоп-лосса, тейк-профита и при необходимости трейлинг-стопа. Трейлинг-стоп смещается только по направлению прибыльного движения.
6. Сделка закрывается при достижении стоп-лосса или тейк-профита. Если в одной свече достигаются оба уровня, выбирается тот, который ближе к цене входа.
7. После закрытия прибыльной сделки объём возвращается к `InitialVolume`, а после убыточной умножается на `MartingaleMultiplier`.

## Параметры

| Параметр | Описание |
|----------|----------|
| `ZigZagDepth` | Количество свечей, используемых при поиске новых экстремумов ZigZag. |
| `ZigZagDeviation` | Минимальное ценовое отклонение (в шагах цены) для подтверждения экстремума. |
| `ZigZagBackstep` | Минимальное число баров, через которое ZigZag может сменить направление. |
| `ZigZagIdInterval` | Максимальная глубина поиска последних ZigZag-хая и лоу. |
| `StopLossPips` | Дистанция стоп-лосса в пунктах. Ноль отключает уровень. |
| `TakeProfitPips` | Дистанция тейк-профита в пунктах. Ноль отключает уровень. |
| `TrailingStopPips` | Дистанция трейлинг-стопа в пунктах. Ноль отключает сопровождение. |
| `InitialVolume` | Базовый объём первой сделки в цикле мартингейла. |
| `MartingaleMultiplier` | Множитель объёма для следующей сделки после убытка. |
| `CandleType` | Тип и таймфрейм свечей, используемых в расчётах. |

## Управление капиталом

- Объём округляется к шагу объёма и ограничивается биржевыми минимальными и максимальными значениями.
- Прибыльная сделка сбрасывает объём к `InitialVolume`, убыточная — умножает объём на `MartingaleMultiplier`.

## Управление рисками

- На каждой закрытой свече пересчитываются уровни стоп-лосса, тейк-профита и трейлинг-стопа.
- Трейлинг-стоп перемещается только в сторону прибыльного движения и никогда не отступает назад.
- Новые сделки не открываются, пока нет подтверждённых ZigZag-экстремумов в пределах окна или уже есть открытая позиция.

## Примечания

- Стратегия работает только с закрытыми свечами, что позволяет повторить поведение исходного эксперта.
- Конвертация пунктов опирается на параметр `PriceStep`. Перед запуском убедитесь, что данные об инструменте загружены.
