# Стратегия Color Fisher M11

## Обзор
Color Fisher M11 повторяет советник Exp_ColorFisher_m11 для MetaTrader 5 и использует изменённый индикатор Fisher Transform с пятицветной раскраской. Индикатор помогает выделить периоды сильного импульса и задаёт торговые сигналы после задержки на заданное количество закрытых свечей. Дополнительные флаги позволяют отдельно отключать открытия и закрытия для длинной и короткой стороны.

## Логика индикатора
Стратегия рассчитывает индикатор Color Fisher на лету:

- Находит максимум и минимум за окно **Range Periods**.
- Нормализует среднюю цену текущей свечи в этом диапазоне и сглаживает её коэффициентом **Price Smoothing** по принципу EMA.
- Применяет преобразование Фишера и дополнительное сглаживание **Index Smoothing** для получения итогового значения.
- Классифицирует значение в пять дискретных состояний по порогам **High Level** и **Low Level**:
  - `0` – сильный бычий импульс выше верхнего порога.
  - `1` – умеренное бычье движение между нулём и верхним порогом.
  - `2` – нейтральная зона возле нуля.
  - `3` – умеренное медвежье движение между нулём и нижним порогом.
  - `4` – сильный медвежий импульс ниже нижнего порога.

Сигнал оценивается по свечам, отстоящим на `Signal Bar` назад, как и в оригинальном советнике. Предыдущее состояние цвета также хранится, чтобы фиксировать новые переходы в экстремальные зоны.

## Правила торговли
- **Вход в лонг** – возможен при включённом `Enable Buy Entry`, если отложенный цвет равен `0`, а предыдущее состояние отличается от `0`. При наличии шорта позиция полностью разворачивается в лонг.
- **Вход в шорт** – возможен при включённом `Enable Sell Entry`, если отложенный цвет равен `4`, а предыдущее состояние отличается от `4`. При наличии лонга позиция разворачивается в шорт.
- **Выход из лонга** – выполняется при активном `Enable Buy Exit`, когда отложенный цвет переходит в `3` или `4`, что сигнализирует о преимуществе продавцов.
- **Выход из шорта** – выполняется при активном `Enable Sell Exit`, когда отложенный цвет переходит в `0` или `1`, что указывает на доминирование покупателей.

Чтобы не выставлять несколько заявок на одном сигнале, стратегия запоминает момент закрытия следующей свечи для каждого направления и запрещает новые входы до завершения следующего бара.

## Управление рисками
Параметры `Stop Loss (pts)` и `Take Profit (pts)` переводят исходные значения в пунктах в абсолютные шаги цены с учётом шага инструмента. Если указан положительный размер, активируется встроенная защита `StartProtection`. Нулевое значение отключает соответствующий защитный ордер.

## Параметры
- **Range Periods** – длина окна для расчёта диапазона максимумов и минимумов (по умолчанию 10).
- **Price Smoothing** – коэффициент сглаживания до преобразования Фишера, 0…0.99 (по умолчанию 0.3).
- **Index Smoothing** – коэффициент сглаживания после преобразования, 0…0.99 (по умолчанию 0.3).
- **High Level / Low Level** – пороги, определяющие бычьи и медвежьи экстремумы (по умолчанию +1.01 и –1.01).
- **Signal Bar** – задержка сигнала в количестве закрытых свечей (по умолчанию 1).
- **Enable Buy Entry / Enable Sell Entry** – флаги разрешения открытия длинных или коротких позиций.
- **Enable Buy Exit / Enable Sell Exit** – флаги разрешения закрытия по индикатору.
- **Stop Loss (pts) / Take Profit (pts)** – защитные расстояния в шагах цены.
- **Candle Type** – таймфрейм подписки на свечи, по умолчанию четырёхчасовые.

## Примечания
- Используется высокоуровневое API StockSharp (`SubscribeCandles().BindEx`), дополнительные коллекции не создаются, кроме минимальной истории цветов для задержки сигнала.
- В данной поставке отсутствует Python-версия, как и требовалось.
- Для наглядности можно добавить стратегию на график и отрисовать индикатор вместе с ценой.
