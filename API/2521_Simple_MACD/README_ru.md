# Simple MACD
[English](README.md) | [中文](README_cn.md)

Стратегия Simple MACD — это перенос советника MQL5 `Simple_MACD.mq5` в инфраструктуру StockSharp. Алгоритм отслеживает наклон основной линии MACD на закрытых свечах и накапливает позицию в направлении текущего тренда.

## Обзор

- **Рынки**: валюты, акции, фьючерсы и любые инструменты с регулярными свечными данными.
- **Базовый индикатор**: MACD с экспоненциальными средними 12 и 26 и сигнальной EMA 9.
- **Методика**: анализ изменения основной линии MACD между двумя последними завершёнными барами. Рост линии => покупки, падение => продажи.
- **Типы ордеров**: только рыночные. Объём заявки включает ликвидацию противоположной позиции и добавление заданного объёма, как в оригинальном советнике.

## Особенности конверсии

- В MQL5 сравнивались значения `MACD(1)` и `MACD(2)` на открытии новой свечи. В StockSharp сравнение выполняется после закрытия свечи, поэтому сигнал появляется до начала следующего бара.
- Проверка хеджингового режима и расчёт допустимого объёма в MQL5 заменены на управление позицией через `TradeVolume` и методы `BuyMarket`/`SellMarket`.
- StockSharp хранит чистую позицию, поэтому дополнительный обход всех открытых позиций не требуется.

## Торговые правила

### Вход и наращивание позиции

1. Для каждой закрытой свечи рассчитывается значение основной линии MACD.
2. Хранятся два последних значения индикатора.
3. Если `MACD(1) > MACD(2)`:
   - Покупается объём `TradeVolume + max(0, -Position)` (закрываются шорты и добавляется новая длинная позиция).
4. Если `MACD(1) < MACD(2)`:
   - Продаётся объём `TradeVolume + max(0, Position)` (закрываются лонги и открывается новая короткая позиция).
5. При равенстве значений новых ордеров нет.

### Управление позицией

- Позиция наращивается при каждом сигнале, пока наклон MACD сохраняется в ту же сторону.
- При смене направления сначала закрывается существующая позиция, затем формируется новая в противоположную сторону.
- В стратегии нет встроенных стопов и тейков — контроль риска выполняется внешними средствами.

### Дополнительные защиты

- Сделки возможны только после формирования индикатора MACD.
- Обрабатываются только завершённые свечи (`CandleStates.Finished`).
- В журнал записываются значения MACD, по которым был принят торговый сигнал.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `FastPeriod` | 12 | Период быстрой EMA в MACD. |
| `SlowPeriod` | 26 | Период медленной EMA в MACD. |
| `SignalPeriod` | 9 | Период сигнальной EMA, сохранённый для совместимости с оригиналом. |
| `TradeVolume` | 0.1 | Объём, добавляемый к позиции при каждом сигнале. |
| `CandleType` | Таймфрейм 1 минута | Тип свечей, на основе которых рассчитывается MACD. |

Все параметры доступны для оптимизации.

## Визуализация

- При наличии чартов создаётся область с ценовыми свечами, где отображается MACD и сделки стратегии.
- Это помогает увидеть, как часто стратегия наращивает позицию при устойчивых трендах.

## Рекомендации по использованию

- Лучше применять на трендовых участках рынка. На флэте стратегия может часто разворачиваться и генерировать лишние сделки.
- Используйте внешние ограничения по риску, так как стоп-лосс не предусмотрен.
- Рекомендуется оптимизировать параметры MACD и торговый объём под конкретный инструмент и таймфрейм.

## Состав папки

- `CS/SimpleMacdStrategy.cs` — реализация стратегии на C#.
- `README.md`, `README_ru.md`, `README_cn.md` — документация на трёх языках.

