# Стратегия MultiTrader Currency Strength (3253)

## Обзор
Стратегия представляет собой перенос на StockSharp высокоуровневого MQL-панеля «MultiTrader» (код 24786). Исходный эксперт был интерактивной доской, показывающей относительную силу восьми основных валют, подававшей сигналы при экстремальных значениях и предлагавшей подходящие валютные пары для торговли. В реализации на StockSharp эти расчёты автоматизированы, а при желании можно сразу открывать сделки по связке «самая сильная против самой слабой».

Для каждого инструмента вычисляется доля текущей цены закрытия в диапазоне свечи. Затем стратегия усредняет соответствующие кроссы и получает силу AUD, CAD, CHF, EUR, GBP, JPY, NZD и USD. Когда одна валюта поднимается выше заданного порога покупки, а другая падает ниже порога продажи, формируется рекомендация по соответствующей паре. Если эта пара присутствует в настроенной вселенной, можно автоматически отправить рыночный ордер.

## Модель силы валют
Формула для процента по инструменту:

```
percent = 100 * (Close - Low) / (High - Low)
```

Каждая валюта складывается из семи кроссов по той же схеме, что и в MQL. Если валюта стоит в котируемой части пары, применяется инверсия `100 - percent`:

| Валюта | Кроссы |
| --- | --- |
| AUD | AUDJPY, AUDNZD, AUDUSD, 100-EURAUD, 100-GBPAUD, AUDCHF, AUDCAD |
| CAD | CADJPY, 100-NZDCAD, 100-USDCAD, 100-EURCAD, 100-GBPCAD, 100-AUDCAD, CADCHF |
| CHF | CHFJPY, 100-NZDCHF, 100-USDCHF, 100-EURCHF, 100-GBPCHF, 100-AUDCHF, 100-CADCHF |
| EUR | EURJPY, EURNZD, EURUSD, EURCAD, EURGBP, EURAUD, EURCHF |
| GBP | GBPJPY, GBPNZD, GBPUSD, GBPCAD, 100-EURGBP, GBPAUD, GBPCHF |
| JPY | 100-AUDJPY, 100-CHFJPY, 100-CADJPY, 100-EURJPY, 100-GBPJPY, 100-NZDJPY, 100-USDJPY |
| NZD | NZDJPY, 100-GBPNZD, NZDUSD, NZDCAD, 100-EURNZD, 100-AUDNZD, NZDCHF |
| USD | 100-AUDUSD, USDCHF, USDCAD, 100-EURUSD, 100-GBPUSD, USDJPY, 100-NZDUSD |

Стратегия использует только завершённые свечи. После получения новой закрытой свечи пересчитываются проценты и силы валют.

## Торговля и оповещения
1. Как только доступны данные по всем восьми валютам, в журнале появляется снимок (от самой сильной к самой слабой).
2. Если сильнейшая валюта **≥ BuyLevel**, а слабейшая **≤ SellLevel**, строится рекомендация.
3. В первую очередь ищется прямая пара «сильная валюта в базе, слабая в котировке». При её отсутствии рассматривается обратный порядок и, в крайнем случае, пары с участием USD.
4. Результат записывается в лог. Если `EnableAutoTrading = true` и `OrderVolume > 0`, стратегия отправит рыночный ордер. При наличии встречной позиции объём увеличивается для закрытия старого и открытия нового направления.

Последний предложенный инструмент и направление запоминаются, чтобы избежать повторяющихся сигналов, пока рынок не выйдет из зоны порогов.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `Universe` | Набор инструментов `Security`, участвующих в расчётах (рекомендуется 28 основных кроссов). | Обязательно |
| `CandleType` | Тип свечей для анализа (день, неделя, месяц и т. п.). | Дневные свечи |
| `BuyLevel` | Порог, выше которого валюта считается перекупленной. | 90 |
| `SellLevel` | Порог, ниже которого валюта считается перепроданной. | 10 |
| `EnableAutoTrading` | Включить автоматическое исполнение сделок. | false |
| `OrderVolume` | Объём рыночных заявок при автоторговле. | 1 |
| `SymbolPrefix` | Приставка к тикеру, требуемая брокером/биржей (например, `m.`). | "" |
| `SymbolSuffix` | Суффикс тикера (например, `.FX`). | "" |

## Настройка
1. **Вселенной инструментов.** Добавьте в Universe 28 основных форекс-пар. Коды должны совпадать с стандартными обозначениями (`EURUSD`, `GBPJPY` и т. д.). При наличии префиксов/суффиксов заполните соответствующие параметры.
2. **Выбор таймфрейма.** Укажите `CandleType`. Дневные, недельные и месячные свечи соответствуют режимам исходного панели.
3. **Настройка порогов.** Измените `BuyLevel` и `SellLevel`, чтобы определить требуемую степень перекупленности/перепроданности.
4. **Автоторговля (опционально).** Установите `EnableAutoTrading = true` и задайте `OrderVolume`. При необходимости только аналитики оставьте флаг выключенным.

## Особенности переноса
- Графический интерфейс MQL-версии не переносился — все результаты выдаются через журнал стратегии.
- Push/Email/Popup-оповещения заменены на записи `LogInfo`.
- Автоматические расчёты стоп-лоссов и тейк-профитов не реализованы. Рекомендуется использовать защиту `StartProtection` или отдельные риск-модули.
- DES-шифрование и вспомогательные функции лицензирования удалены.

## Рекомендации по использованию
- Запускайте стратегию в связке с коннектором, который предоставляет исторические и текущие свечи по всем выбранным инструментам.
- Можно дополнительно вывести график рекомендованной пары для визуального контроля.
- Для управления риском воспользуйтесь встроенной защитой `StartProtection` или отдельными стратегиями.

## Тестирование
- Убедитесь, что поставщик данных передаёт завершённые свечи выбранного таймфрейма — незакрытые бары игнорируются.
- Отсутствие хотя бы одной пары во вселенной делает расчёт соответствующей валюты невозможным, следовательно сигнал не будет создан.
- В бэктестах держите состав Universe постоянным на всём горизонте, чтобы не возникало разрывов в силах валют.
