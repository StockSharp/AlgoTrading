# Стратегия Open Time

## Обзор
Стратегия повторяет логику советника MetaTrader «OpenTime». Она выставляет рыночные заявки в заданный момент времени, при необходимости закрывает позиции в отдельном окне выхода и применяет простые правила управления риском: фиксированный стоп-лосс, тейк-профит и трейлинг-стоп. Портирование выполнено на высокоуровневом API StockSharp, что упрощает использование стратегии совместно с другими компонентами платформы.

## Принцип работы
1. После подписки на свечи выбранного таймфрейма стратегия обрабатывает только закрытые свечи.
2. Если текущее время попадает в торговое окно, отправляются рыночные заявки для всех разрешённых направлений:
   - При включённом одном направлении стратегия увеличивает существующую позицию или разворачивается, пока не будет достигнут целевой объём.
   - При включённых покупках и продажах заявки отправляются последовательно в рамках одного окна. В Netting-модели StockSharp вторая заявка сначала закрывает противоположную позицию, а затем открывает новую.
3. Во время окна закрытия вызывается `ClosePosition()` — это гарантирует однократное принудительное закрытие текущего объёма.
4. Значения стоп-лосса, тейк-профита и трейлинг-стопа передаются в `StartProtection`, которая управляет защитными заявками с помощью рыночных выходов.

## Параметры
- **Enable Close Window** – аналог флага `TimeClose`. Определяет, нужно ли закрывать позиции в отдельном временном интервале.
- **Close Position Time** – время начала окна закрытия (по умолчанию 20:50).
- **Trading Time** – время начала окна открытия позиций (по умолчанию 18:50).
- **Window Length** – длительность как торгового, так и закрывающего окон (по умолчанию 5 минут; соответствует параметру `Duration`).
- **Allow Sell Entries** – включает короткие позиции, соответствует параметру `Sell` (по умолчанию включено).
- **Allow Buy Entries** – включает длинные позиции, соответствует параметру `Buy` (по умолчанию выключено).
- **Order Volume** – целевой нетто-объём каждой новой сделки (по умолчанию 0.1 лота). При смене направления добавляется модуль текущей позиции, чтобы выполнить разворот одной сделкой.
- **Stop-Loss Points** – расстояние до стоп-лосса в пунктах (0 отключает стоп).
- **Take-Profit Points** – расстояние до тейк-профита в пунктах (0 отключает цель).
- **Use Trailing Stop** – включает логику трейлинг-стопа из функции `SimpleTrailing` оригинального эксперта.
- **Trailing Stop Points** – базовое расстояние трейлинг-стопа в пунктах (по умолчанию 300).
- **Trailing Step Points** – дополнительное движение цены, необходимое для сдвига трейлинга (по умолчанию 3).
- **Candle Type** – таймфрейм свечей, по которым выполняются проверки времени (по умолчанию одна минута).

## Особенности
- Размер пункта вычисляется по минимальному шагу цены инструмента. Для инструментов с тремя и пятью десятичными знаками шаг дополнительно умножается на 10, повторяя обработку пипсов в MQL-скрипте.
- `StartProtection` запускается только при наличии положительных дистанций. Если включён только трейлинг-стоп, его значение используется как стартовый защитный уровень.
- Попытки повторной отправки заявок и ручная обработка ошибок в портированной версии не нужны: StockSharp сам управляет повторной регистрацией рыночных заявок.
