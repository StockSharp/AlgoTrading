# Стратегия CCFp Currency Strength

## Общее описание
Стратегия переносит классический советник CCFp из MetaTrader на высокоуровневый API StockSharp. Для каждой из восьми основных валют (USD, EUR, GBP, CHF, JPY, AUD, CAD, NZD) вычисляется показатель относительной силы на основе отношения быстрого и медленного простого скользящего среднего по семи основным парам с долларом США (EURUSD, GBPUSD, AUDUSD, NZDUSD, USDCAD, USDCHF, USDJPY). Когда разница между силой двух валют превышает заданный порог, стратегия открывает рыночные позиции, выражающие силу одной валюты против слабости другой.

Реализация построена на высокоуровневом подходе: для каждого инструмента создаётся собственная подписка на свечи, индикаторы подключаются через `Bind`, заявки отправляются через `RegisterOrder` как рыночные. Комментарии к заявкам сохраняют формат `(TOPDOWN)`, используемый в MQL-версии, что облегчает сопоставление сделок.

## Необходимые инструменты
Перед запуском нужно привязать следующие инструменты к параметрам стратегии:

- `EURUSD`
- `GBPUSD`
- `AUDUSD`
- `NZDUSD`
- `USDCAD`
- `USDCHF`
- `USDJPY`

Все пары должны обрабатываться на одном и том же таймфрейме, который задаётся параметром `Candle Type`.

## Параметры
| Параметр | Описание |
| --- | --- |
| `Fast MA` | Период быстрого скользящего среднего, участвующего в расчёте силы. |
| `Slow MA` | Период медленного скользящего среднего. |
| `Strength Step` | Минимальная разница между силами валют, необходимая для появления сигнала. |
| `Close Opposite` | При включении сначала закрываются встречные позиции, затем открывается новая. |
| `Candle Type` | Тип свечей, который используется индикаторами. |
| Базовый `Volume` | Используется значение `Strategy.Volume` и применяется ко всем заявкам. |

## Логика торговли
1. Для каждой из семи USD-пар создаются по два простых скользящих средних (быстрое и медленное).
2. После прихода завершённой свечи отношение медленного и быстрого средних преобразуется в синтетический показатель силы, аналогичный значениям индикатора CCFp.
3. Когда обновлены все семь пар, пересчитываются восемь значений силы валют.
4. Если разница между «сильной» и «слабой» валютой пересекает уровень `Strength Step` снизу вверх, при этом сила первой растёт, а второй падает, фиксируется возможность для входа.
5. Стратегия открывает рыночные позиции, отражающие покупку сильной валюты и продажу слабой:
   - Если сильной оказывается USD, выставляется одна заявка по соответствующей паре (например, продажа `EURUSD`).
   - Если слабой становится USD, стратегия покупает пару, где сильная валюта стоит первой (например, покупка `EURUSD`).
   - Если обе валюты не содержат USD, отправляются две заявки: покупка сильной валюты против USD и продажа слабой валюты против USD.
6. При активном флаге `Close Opposite`, если по инструменту есть встречная позиция, сначала выставляется рыночная заявка на её закрытие.

## Управление рисками
- Автоматических стоп-лоссов и тейк-профитов не устанавливается; контроль рисков осуществляется за счёт флага `Close Opposite` и внешних инструментов управления портфелем.
- Размер входа задаётся свойством `Volume`. Его следует настроить в соответствии с размером счёта и желаемой нагрузкой на позицию.

## Отличия от оригинального советника MQL
- Расчёт силы валют выполняется через индикаторы `SimpleMovingAverage` на одном таймфрейме. Каскадирование таймфреймов из оригинального индикатора можно приблизить подбором периодов `Fast MA` и `Slow MA`.
- Автоматическое сопровождение стопов не реализовано: стратегия сосредоточена на воспроизведении логики входа/выхода и передаёт расширенное управление рисками на уровень портфеля StockSharp.
- Заявки отправляются через `RegisterOrder` с использованием объектов `Security`, вместо прямого взаимодействия с торговыми объектами MetaTrader.
