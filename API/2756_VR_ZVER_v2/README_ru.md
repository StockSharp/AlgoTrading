# Стратегия VR-ZVER v2
[English](README.md) | [中文](README_cn.md)

VR-ZVER v2 — порт оригинального советника MetaTrader под StockSharp. Логика тройного подтверждения сохранена: для сделки требуется согласие скользящих средних, стохастика и RSI. Пока все активированные фильтры не дадут сигнал в одну сторону, стратегия не откроет позицию.

## Логика торговли

- Сигналы рассчитываются только на закрытии свечи. Внутридневные колебания используются лишь для проверки стопов и тейков.
- При включённом фильтре скользящих три экспоненциальные средние (быстрая, медленная, самая медленная) должны располагаться в правильном порядке, подтверждая тренд.
- Стохастик ждёт пересечения %K и %D возле заданных верхнего и нижнего уровней.
- RSI должен выйти из нейтральной зоны: ниже нижнего уровня для покупок и выше верхнего для продаж.
- Сигнал принимается только тогда, когда каждый включённый фильтр голосует в одну сторону. Если кто-то не согласен, сделка пропускается.
- Открывается только одна позиция. Хеджирование и наращивание позиции отсутствуют: после выхода стратегия ждёт нового согласованного сигнала.

## Управление позицией

- Тейк-профит и стоп-лосс задаются в пунктах. Начальный стоп устанавливается на две трети от заданного расстояния — как в исходном советнике.
- Уровень безубытка (в пунктах) переносит стоп в точку входа, когда прибыль достигает указанного значения.
- Трейлинг использует расстояние и дополнительный шаг. Шаг не даёт стопу двигаться при каждом небольшом росте и повторяет логику MT5.
- Лонги и шорты управляются симметрично, используя максимумы и минимумы свечи.

## Размер позиции

- `FixedVolume` больше нуля — фиксированный объём каждой сделки.
- Если `FixedVolume` равен нулю, объём рассчитывается по `RiskPercent`, текущей стоимости портфеля и расстоянию до стопа. Для перевода пунктов в денежный риск берутся `PriceStep` и `StepPrice` инструмента.
- Объём округляется с учётом ограничений `VolumeMin`, `VolumeMax` и `VolumeStep`. Если рассчитанный объём слишком мал, сделка пропускается.

## Параметры

| Параметр | Описание |
| -------- | -------- |
| `CandleType` | Таймфрейм, используемый для сигналов (по умолчанию 15 минут). |
| `FixedVolume`, `RiskPercent` | Выбор между фиксированным и риск-ориентированным объёмом. |
| `StopLossPips`, `TakeProfitPips` | Базовые защитные расстояния в пунктах. |
| `TrailingStopPips`, `TrailingStepPips`, `BreakevenPips` | Пороговые значения сопровождения позиции. |
| `AllowLongs`, `AllowShorts` | Разрешение отдельных направлений. |
| `UseMovingAverageFilter`, `FastMaPeriod`, `SlowMaPeriod`, `VerySlowMaPeriod` | Фильтр по тройному EMA. |
| `UseStochastic`, `StochasticKPeriod`, `StochasticDPeriod`, `StochasticSmooth`, `StochasticUpperLevel`, `StochasticLowerLevel` | Настройки стохастика. |
| `UseRsi`, `RsiPeriod`, `RsiUpperLevel`, `RsiLowerLevel` | Зоны подтверждения по RSI. |

## Примечания

- Пересчёт пунктов повторяет оригинал: для трёх- и пятизначных котировок шаг цены умножается на десять перед вычислением пунктов.
- Порт под StockSharp использует только рыночные ордера. Функции «замка» и отложенных заявок из версии MetaTrader опущены, чтобы соответствовать высокоуровневому API.
- При подключении к графику автоматически отображаются EMA, стохастик и RSI вместе с сделками.
