# Стратегия Bruno
[English](README.md) | [中文](README_cn.md)

Bruno — это трендовая стратегия, перенесённая из MetaTrader 5. Она использует ту же последовательность фильтров: индикатор Average Directional Index (ADX) с линиями +DI/-DI, экспоненциальные скользящие средние (EMA 8 и EMA 21), MACD (13, 34, 8), осциллятор Стохастик (21, 3, 3) и наклон параболического SAR с параметрами (0.055, 0.21). Каждый фильтр, который подтверждает направление, умножает базовый объём сделки на заданный коэффициент. Если на одной свече усиливаются оба направления, сделка пропускается, чтобы избежать конфликта сигналов.

### Логика входов

- **Направление тренда**
  - Длинные сделки усиливаются, когда `+DI > -DI` и `+DI > 20`.
  - Короткие сделки усиливаются, когда `+DI < -DI` и `+DI < 40`.
- **Моментум**
  - Для покупок EMA(8) должна находиться выше EMA(21), стохастик %K выше %D и ниже уровня перекупленности (по умолчанию 80).
  - Для продаж EMA(8) должна быть ниже EMA(21), стохастик %K ниже %D и выше уровня перепроданности (по умолчанию 20).
- **MACD**
  - Сигнал на покупку: MACD выше нуля и основная линия выше сигнальной.
  - Сигнал на продажу: MACD ниже нуля и основная линия ниже сигнальной.
- **Наклон Parabolic SAR**
  - Покупки подтверждаются, если два предыдущих значения SAR растут при условии EMA(8) > EMA(21).
  - Продажи подтверждаются, если два предыдущих значения SAR падают при EMA(8) < EMA(21).

Каждое выполненное условие умножает базовый объём `BaseVolume` на `SignalMultiplier` (по умолчанию 1.6). Одновременно может сработать только одно направление. При окончательном сигнале стратегия закрывает противоположную позицию, открывает рыночный ордер с новым объёмом и фиксирует цену закрытия свечи как точку входа.

### Управление позицией

- **Стоп-лосс и тейк-профит** — фиксированные расстояния в пересчитанных пунктах, полностью соответствующие оригинальной версии. При касании уровня внутри свечи позиция немедленно закрывается.
- **Трейлинг-стоп** — активируется после того, как прибыль превышает сумму `TrailingStop + TrailingStep` пунктов. Затем стоп переносится на расстояние `TrailingStop` пунктов от цены и подтягивается только при приросте прибыли минимум на `TrailingStep` пунктов.
- **Конфликт сигналов** — если одновременно усиливаются покупка и продажа, новая сделка не открывается.

### Параметры

| Группа | Название | Описание |
| --- | --- | --- |
| Торговля | `BaseVolume` | Базовый лот до применения коэффициентов. |
| Торговля | `SignalMultiplier` | Множитель объёма для каждого подтверждающего фильтра. |
| Риск | `StopLossPips` / `TakeProfitPips` | Расстояния до стоп-лосса и тейк-профита в пересчитанных пунктах. Ноль отключает уровень. |
| Риск | `TrailingStopPips` / `TrailingStepPips` | Дистанция трейлинга и минимальный шаг подтяжки. |
| Индикаторы | `AdxPeriod`, `AdxPositiveThreshold`, `AdxNegativeThreshold` | Период ADX и пороги для +DI. |
| Индикаторы | `FastEmaPeriod`, `SlowEmaPeriod` | Длины EMA для подтверждения тренда. |
| Индикаторы | `MacdFastPeriod`, `MacdSlowPeriod`, `MacdSignalPeriod` | Настройки MACD. |
| Индикаторы | `StochasticPeriod`, `StochasticKsmoothing`, `StochasticDsmoothing`, `StochasticOverbought`, `StochasticOversold` | Параметры стохастика. |
| Общее | `CandleType` | Таймфрейм для всех расчётов (по умолчанию 1 час). |

### Особенности

- Пересчёт пункта повторяет MetaTrader: для инструментов с 3 или 5 знаками после запятой размер шага умножается на 10.
- Параболический SAR использует шаг ускорения `0.055` и максимум `0.21`, как в оригинале.
- Масштабирование объёма сохраняется, но фактически вся позиция учитывается как один нетто-объём StockSharp.
