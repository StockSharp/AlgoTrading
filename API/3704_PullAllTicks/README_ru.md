# Стратегия Pull All Ticks

## Общее описание

**Pull All Ticks Strategy** — порт скрипта MetaTrader `pull all ticks.mq5` (ID 56324) на платформу StockSharp. Оригинальный инструмент ищет у брокера самые старые доступные тики и скачивает всю историю блоками, попутно сохраняя прогресс на диск. Переписанная версия повторяет тот же процесс через высокоуровневые подписки StockSharp: стратегия непрерывно принимает тики, фиксирует минимальные и максимальные отметки времени и записывает состояние в файл, чтобы можно было возобновить загрузку после перезапуска.

Это утилитарная стратегия без торговых операций. Она подписывается на поток тиков выбранного инструмента, регулярно обновляет файл состояния и автоматически завершает работу, когда достигнута заданная нижняя граница по дате.

## Логика работы

1. При старте рассчитывается путь к файлу состояния на основе параметров `ManagerFolder` и `StatusFileName`.
2. Если файл существует, восстанавливаются сохранённые временные отметки, счётчик тиков и число обработанных пакетов.
3. Оформляется подписка на тики через `SubscribeTrades().Bind(ProcessTrade).Start()`, что обеспечивает обработку каждого тика в хронологическом порядке.
4. Каждый тик обновляет информацию о самой ранней и самой поздней отметке времени, увеличивает счётчик тиков и инициирует сохранение, когда набрано полное количество тиков в пакете (`TickPacketSize`).
5. Прогресс записывается в текстовом формате key-value и выводится через `LogInfo`, что соответствует сообщениям `Comment` в MetaTrader.
6. Когда самая старая обработанная отметка времени опускается ниже `OldestLimit` (при включённом `LimitDate`), стратегия останавливается автоматически.

## Параметры

| Параметр | Назначение |
|----------|------------|
| `LimitDate` | Включает остановку после достижения заданной нижней границы. Аналог входа `limitDate` в MQL. |
| `OldestLimit` | Нижняя граница по времени. При её достижении стратегия прекращает работу. |
| `TickPacketSize` | Сколько тиков формируют пакет перед сохранением состояния. Соответствует `tick_packets`. |
| `RequestDelay` | Минимальная пауза между обновлениями статуса. Заменяет задержку `Sleep(44)` из исходного кода. |
| `ManagerFolder` | Папка для хранения файла прогресса (`MANAGER_FOLDER` в MQL). |
| `StatusFileName` | Имя файла состояния (`MANAGER_STATUS_FILE`). |

Все параметры задаются через `StrategyParam<T>`, поддерживают оптимизацию и могут изменяться в Designer, Shell или Runner.

## Использование

1. Задайте инструмент в свойстве `Security` до запуска.
2. При необходимости скорректируйте параметры (например, укажите собственную папку для статуса).
3. Запустите стратегию. Если файл состояния существует, данные восстановятся, далее будут приниматься тики и периодически обновляться файл.
4. В любой момент стратегию можно остановить вручную — при остановке прогресс записывается, чтобы следующее включение продолжило процесс.

## Отличия от версии MetaTrader

- Вместо таймера `OnTimer` используется подписка на поток тиков, поэтому нет отдельного цикла опроса.
- Файл прогресса хранится в читаемом текстовом виде, а не в бинарном формате.
- Частота обновлений регулируется параметром `RequestDelay`, что позволяет обойтись без явных вызовов `Sleep`.
- Работа с файловой системой реализована через .NET (`Directory.CreateDirectory`, `File.WriteAllText`).

## Требования

- Подключение StockSharp с доступом к тиковой истории выбранного инструмента.
- Права на запись в указанную папку `ManagerFolder`.

При выполнении этих условий стратегия воспроизводит процесс массового скачивания тиков из оригинального MQL-скрипта и интегрируется в экосистему StockSharp.
