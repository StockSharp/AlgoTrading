# Стратегия Parallax Sell

## Обзор
Parallax Sell — это конвертированная в StockSharp короткая маржинальная стратегия из советника MetaTrader `parallax_sell`. Исходный робот торговал кроссы с JPY (CAD/JPY и CHF/JPY) и использовал сочетание индикаторов Williams %R, MACD и стохастика для поиска перекупленных участков рынка. Выходы строятся на признаках ослабления импульса по Williams %R или медленному стохастику, а схема управления объёмом с элементами мартингейла увеличивает позицию после убыточных серий.

## Логика входа
- Работает на настраиваемом таймфрейме (по умолчанию свечи 1 час).
- Ожидает закрытия новой свечи.
- Требует, чтобы Williams %R с периодом 350 поднялся выше порога перекупленности (по умолчанию -10).
- Требует, чтобы основная линия MACD (12/120/9) находилась выше заданного порога (по умолчанию 0.178), что подтверждает восходящий импульс перед продажей.
- Отслеживает пересечение сверху вниз быстрой линии стохастика %K (период 10, замедление 3) ниже входного уровня (по умолчанию 90). Только такое пересечение инициирует новую короткую позицию.
- Каждый сигнал открывает дополнительный рыночный ордер на продажу, что позволяет накапливать несколько коротких сделок в соответствии с логикой мартингейла.

## Логика выхода
- Рассчитывает плавающую прибыль всех открытых шортов в пунктах относительно размера пункта инструмента.
- Если открыт только один шорт и средняя прибыль превышает целевой уровень одиночной сделки (по умолчанию 10 пунктов) **и** Williams %R падает ниже порога выхода (по умолчанию -80), позиция закрывается.
- Если открыто более одной короткой позиции и средняя прибыль корзины превышает целевой уровень (по умолчанию 15 пунктов) **и** медленный стохастик %K (период 90, замедление 1) падает ниже триггера перепроданности (по умолчанию 12), закрывается вся корзина.
- Дополнительно используется страховочный тейк-профит: корзина закрывается, когда средняя прибыль достигает заданного расстояния (по умолчанию 100 пунктов).

## Управление объёмом
- Стартовый объём — базовый лот (по умолчанию 0.01).
- После прибыльного цикла (рост реализованной прибыли) следующий ордер возвращается к базовому объёму.
- После убыточного цикла (снижение реализованной прибыли) объём следующего ордера умножается на коэффициент мартингейла (по умолчанию 1.6). Значения автоматически приводятся к шагу объёма инструмента.

## Риск-менеджмент
- Регистрируется защитный тейк-профит на заданном расстоянии в пунктах. Жёсткий стоп-лосс не используется — выходы управляются индикаторами.
- Защита (`StartProtection`) запускается один раз, в соответствии с требованиями к конвертации.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Таймфрейм расчётов. | Свечи 1 часа |
| `EntryWilliamsLength` | Период Williams %R для входов. | 350 |
| `ExitWilliamsLength` | Период Williams %R для выходов. | 350 |
| `EntryStochasticLength` / `Signal` / `Slowing` | Параметры быстрого стохастика для входа. | 10 / 1 / 3 |
| `ExitStochasticLength` / `Signal` / `Slowing` | Параметры медленного стохастика для выхода. | 90 / 7 / 1 |
| `MacdFastLength` / `MacdSlowLength` / `MacdSignalLength` | Настройки MACD. | 12 / 120 / 9 |
| `EntryWilliamsThreshold` | Минимальное значение Williams %R перед открытием шорта. | -10 |
| `ExitWilliamsThreshold` | Значение Williams %R, подтверждающее выход из одиночного шорта. | -80 |
| `EntryStochasticTrigger` | Уровень, ниже которого должна упасть %K для входа. | 90 |
| `ExitStochasticTrigger` | Уровень, ниже которого должен опуститься медленный стохастик для выхода. | 12 |
| `MacdThreshold` | Минимальное значение основной линии MACD. | 0.178 |
| `SingleTradeTargetPips` | Цель по прибыли (пункты) для одной позиции. | 10 |
| `MultiTradeTargetPips` | Цель по прибыли (пункты) для корзины. | 15 |
| `TakeProfitPips` | Жёсткий тейк-профит (пункты). | 100 |
| `InitialVolume` | Базовый объём сделки. | 0.01 |
| `MartingaleMultiplier` | Множитель объёма после убытка. | 1.6 |
| `UseMartingale` | Включение логики мартингейла. | true |

## Примечания
- Стратегия работает только в короткую сторону и предполагает форексную трактовку пунктов.
- Средняя прибыль вычисляется как среднее арифметическое по входным ценам, как и в исходном советнике.
- Для снижения риска на волатильных парах измените пороги или отключите мартингейл (`UseMartingale = false`).
