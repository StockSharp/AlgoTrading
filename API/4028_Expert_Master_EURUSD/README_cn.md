# Expert Master EURUSD 策略

## 概述

Expert Master EURUSD 策略复刻了 MetaTrader 4 上的 *Expert Master* 智能交易系统。  
策略通过 MACD 主线和信号线（快 EMA = 5、慢 EMA = 15、信号 EMA = 3）上的四根 K 线形态来确认动量变化，  
先让指标在一个方向上积累动能，再在反向突破时入场。

## 交易逻辑

### 多头条件
1. MACD 信号线在之前三根 K 线上保持下降，并在当前 K 线转为上行。  
2. MACD 主线形成类似 "V" 字的结构，当前值大于前三个历史值。  
3. 上一根主线值低于可配置的下阈值（默认 −0.00020）。  
4. 最早的主线值低于零，同时当前值高于上阈值（默认 0.00020）。

### 空头条件
1. MACD 信号线在之前三根 K 线上保持上升，并在当前 K 线转为下行。  
2. MACD 主线形成倒 "V" 结构，当前值低于前三个历史值。  
3. 上一根主线值高于上阈值（默认 0.00020）。  
4. 最早的主线值高于零，同时当前值跌破空头阈值（默认 −0.00035）。

## 仓位管理

- **动量反转平仓：** 当前 MACD 主线低于上一值时平掉多头；  
  当前主线高于上一值时平掉空头。  
- **移动止损：** 当价格朝有利方向运行达到设定点数后启动移动止损。  
  每根收盘 K 线都会用收盘价减/加移动距离来更新止损，  
  价格回撤触发止损时通过市价单离场。

## 风险管理

- 默认使用固定手数下单；也可以通过 **Risk Percent** 参数启动资金占比下单。  
  启用后，策略会以投资组合资产的一定比例来计算手数，  
  与原始 EA 的风险设置保持一致。

## 参数

| 名称 | 说明 | 默认值 |
| --- | --- | --- |
| `TrailingPoints` | 移动止损距离（点）。 | 25 |
| `FixedVolume` | 当无法计算风险手数时使用的固定手数。 | 1 |
| `RiskPercent` | 每笔交易使用的资金占比。 | 0.01 |
| `MacdFastPeriod` | MACD 主线的快 EMA 长度。 | 5 |
| `MacdSlowPeriod` | MACD 主线的慢 EMA 长度。 | 15 |
| `MacdSignalPeriod` | MACD 指标的信号 EMA 长度。 | 3 |
| `UpperMacdThreshold` | 入场所需的 MACD 正阈值。 | 0.00020 |
| `LowerMacdThreshold` | 多头信号使用的 MACD 负阈值。 | −0.00020 |
| `ShortCurrentThreshold` | 空头当前值使用的 MACD 负阈值。 | −0.00035 |
| `CandleType` | 计算指标所用的 K 线类型。 | 1 分钟 K 线 |

## 备注

- 仅在 K 线收盘后做出交易决策，以符合 StockSharp 高层 API 的处理方式。  
- 转换保留了原 EA 的风险和移动止损逻辑，同时提供更丰富的参数以便优化。
