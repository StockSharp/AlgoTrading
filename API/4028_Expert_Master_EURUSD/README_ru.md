# Стратегия Expert Master EURUSD

## Обзор

Стратегия Expert Master EURUSD повторяет работу советника *Expert Master* для MetaTrader 4.  
Она отслеживает конфигурацию из четырёх завершённых свечей по основной и сигнальной линиям MACD (EMA 5/15/3).  
Индикатор должен накопить импульс в одном направлении, после чего стратегия входит по пробою в противоположную сторону.

## Логика торговли

### Условия для покупок
1. Сигнальная линия MACD три свечи подряд снижается и на текущей свече разворачивается вверх.  
2. Основная линия MACD образует «V»-образную форму, а текущее значение выше предыдущих трёх.  
3. Предыдущее значение основной линии ниже настраиваемого нижнего порога (по умолчанию −0.00020).  
4. Самое старое значение основной линии ниже нуля, а текущее превышает верхний порог (по умолчанию 0.00020).

### Условия для продаж
1. Сигнальная линия MACD три свечи подряд растёт и на текущей свече разворачивается вниз.  
2. Основная линия MACD образует перевёрнутую «V», а текущее значение ниже предыдущих трёх.  
3. Предыдущее значение основной линии выше верхнего порога (0.00020).  
4. Самое старое значение основной линии выше нуля, а текущее опускается ниже порога для коротких позиций (−0.00035).

## Управление позицией

- **Выход при потере импульса.** Длинная позиция закрывается, когда текущее значение основной линии MACD падает ниже предыдущего.  
  Короткая позиция закрывается, когда текущее значение превышает предыдущий бар.  
- **Трейлинг-стоп.** После прохождения ценой заданного количества пунктов активируется плавающий стоп.  
  На каждой закрытой свече стоп обновляется на величину «цена закрытия ± трейлинг».  
  При возврате цены к стопу позиция закрывается рыночной заявкой.

## Управление рисками

- По умолчанию ордер открывается фиксированным объёмом.  
  Параметр **Risk Percent** включает динамическое определение объёма как доли стоимости портфеля, что воспроизводит поведение исходного советника.

## Параметры

| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `TrailingPoints` | Расстояние трейлинг-стопа в пунктах. | 25 |
| `FixedVolume` | Резервный объём сделки, если риск-менеджмент недоступен. | 1 |
| `RiskPercent` | Доля капитала, используемая для расчёта объёма. | 0.01 |
| `MacdFastPeriod` | Длина быстрой EMA для основной линии MACD. | 5 |
| `MacdSlowPeriod` | Длина медленной EMA для основной линии MACD. | 15 |
| `MacdSignalPeriod` | Период EMA сигнальной линии MACD. | 3 |
| `UpperMacdThreshold` | Порог положительного MACD для входа. | 0.00020 |
| `LowerMacdThreshold` | Порог отрицательного MACD для длинных сигналов. | −0.00020 |
| `ShortCurrentThreshold` | Отрицательный порог MACD для текущего значения при шортах. | −0.00035 |
| `CandleType` | Тип свечей для расчётов. | Таймфрейм 1 минута |

## Примечания

- Решения принимаются только после закрытия свечи, что соответствует высокоуровневому API StockSharp.  
- Конверсия сохраняет оригинальные правила управления риском и трейлинг-стопом, дополняя их расширенными параметрами для оптимизации.
