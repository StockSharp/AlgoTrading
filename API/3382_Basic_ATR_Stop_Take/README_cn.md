# Basic ATR Stop Take

## 概述
Basic ATR Stop Take 将 MetaTrader 4 专家顾问 **“Basic ATR stop_take expert adviser”** 移植到 StockSharp 的高级策略 API。策略刻意保持极简：在指定方向上仅开立一笔市场仓位，基于订阅蜡烛计算平均真实波幅（ATR），并按 ATR 倍数生成止损与止盈。仓位一旦被任一价格水平触发平仓，策略立即等待下一根蜡烛收盘，准备同向的下一次入场。

## 策略逻辑
### 指标基础
* **平均真实波幅（ATR）** – 在可配置的蜡烛类型上计算。指标衡量近期波动性，并决定止损和止盈的距离。

### 入场规则
* 仅在每根完成的蜡烛收盘后执行，且要求 ATR 已经形成。
* 若当前无持仓且方向参数为 **Buy**，按照设定手数发送市价买单。
* 若当前无持仓且方向参数为 **Sell**，按照设定手数发送市价卖单。
* 参数设为 **None** 时禁止新开仓，但会继续管理现有仓位直至平仓。

### 出场规则
* **ATR 止损** – 距离等于 `ATR × Stop Factor`。多头止损设置在入场价下方，空头止损设置在入场价上方。蜡烛极值触碰止损时以市价平仓。
* **ATR 止盈** – 距离等于 `ATR × Take Factor`。多头止盈位于入场价上方，空头止盈位于入场价下方。触及该水平即以市价止盈。
* 任一倍数设为 `0` 时，对应保护水平关闭；如果另一个水平仍启用，策略继续监控它。

### 仓位管理
* 同一时间仅允许一笔仓位。平仓后策略会等待下一根蜡烛收盘后再尝试同向入场。
* 启动时调用 `StartProtection()`，确保手动外部仓位由 StockSharp 的保护模块监控。

## 参数
* **Trade Direction** – 交易方向（`None`、`Buy` 或 `Sell`）。
* **Trade Volume** – 单次市场入场的交易量。
* **ATR Period** – ATR 指标的计算周期。
* **Stop Factor** – ATR 止损倍数，设为 0 表示不启用止损。
* **Take Factor** – ATR 止盈倍数，设为 0 表示不启用止盈。
* **Candle Type** – 用于计算 ATR 和管理交易的蜡烛时间框架。

## 其他说明
* 默认参数复现 EA 的原始设定（仅做多、0.01 手、ATR 周期 14、止损倍数 1.5、止盈倍数 2.0）。
* 止损/止盈触发基于蜡烛的最高价与最低价，因此只要该价格区间被触及即会平仓。
* 策略不会加仓或反向开仓，而是在平仓后等待下一根蜡烛收盘再重新下单。
* 本方案仅提供 C# 实现，不包含 Python 版本。
