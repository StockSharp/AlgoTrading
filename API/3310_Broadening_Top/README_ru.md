# Стратегия Broadening Top

## Описание
Broadening Top Strategy — это трендовая система, основанная на оригинальном советнике MetaTrader «Broadening top». Стратегия стремится поймать пробой после расширяющейся формации. Для фильтрации сигналов используются две линейно взвешенные скользящие средние (LWMA), индикатор Momentum и фильтр MACD.

## Логика торговли
1. **Фильтр тренда.** Быстрая LWMA должна находиться выше медленной для покупки и ниже — для продажи.
2. **Подтверждение импульса.** Индикатор Momentum анализируется по последним трём завершённым свечам. Сделка разрешается только при отклонении хотя бы одного значения от нейтрального уровня 100 не менее чем на заданный порог (отдельно для длинных и коротких сделок).
3. **Подтверждение MACD.** Лонг открывается лишь тогда, когда линия MACD выше сигнальной линии, шорт — когда ниже.
4. **Управление позицией.** Перед открытием сделки в противоположном направлении стратегия закрывает существующую позицию, чтобы одновременно была активна только одна позиция.

## Управление рисками
Защитные ордера настраиваются через `StartProtection`:
- Стоп-лосс и тейк-профит задаются в шагах цены (пунктах) и могут быть отключены.
- Доступен трейлинг-стоп с регулируемым шагом подтягивания.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `OrderVolume` | Объём ордера в лотах/контрактах. | 1 |
| `FastMaLength` | Период быстрой линейно взвешенной средней. | 6 |
| `SlowMaLength` | Период медленной линейно взвешенной средней. | 85 |
| `MomentumPeriod` | Период индикатора Momentum. | 14 |
| `MomentumBuyThreshold` | Минимальное отклонение Momentum от 100 для открытия лонга. | 0.3 |
| `MomentumSellThreshold` | Минимальное отклонение Momentum от 100 для открытия шорта. | 0.3 |
| `MacdFast` | Быстрый период EMA в MACD. | 12 |
| `MacdSlow` | Медленный период EMA в MACD. | 26 |
| `MacdSignal` | Период сигнальной EMA в MACD. | 9 |
| `TakeProfitPips` | Расстояние до тейк-профита в шагах цены. | 50 |
| `StopLossPips` | Расстояние до стоп-лосса в шагах цены. | 20 |
| `TrailingStopPips` | Дистанция трейлинг-стопа в шагах цены. | 40 |
| `TrailingStepPips` | Дополнительный путь до обновления трейлинг-стопа. | 10 |
| `CandleType` | Тип/таймфрейм свечей для расчёта. | 15-минутный таймфрейм |
| `EnableLongs` | Разрешение на лонги. | true |
| `EnableShorts` | Разрешение на шорты. | true |

## Используемые индикаторы
- **LinearWeightedMovingAverage** — быстрый и медленный фильтры тренда.
- **Momentum** — подтверждает ускорение цены относительно уровня 100.
- **MovingAverageConvergenceDivergenceSignal** — проверяет направление по линии MACD и сигнальной линии.

## Особенности
- Порог Momentum проверяется по трём последним завершённым свечам для воссоздания поведения исходного советника.
- Защитные ордера можно отключить, установив соответствующие параметры равными нулю.
- Для корректного расчёта размера пункта инструмент должен предоставлять шаг цены и количество знаков после запятой.
