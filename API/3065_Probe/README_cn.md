# Probe 策略

## 概述
Probe 策略在 StockSharp 高层框架中复刻了 MetaTrader 5 专家顾问 “Probe”。策略在可配置的时间框架上计算商品通道指数（CCI），当振荡指标突破对称通道时做出反应。出现突破信号后，策略会以设定的点距在当前价格附近挂出止损单，试图跟随突破后的动量，同时利用点距参数化的止损和跟踪止损来限制风险。

## 交易逻辑
1. 在选定的 `CandleType` 时间框架上生成蜡烛并计算 CCI。
2. 保存上一根和当前 CCI 数值，以便识别指标突破上下通道边界的瞬间。
3. 当 CCI 自下向上穿越 `-CCI Channel` 时，在最近收盘价上方 `Indent (pips)` 点的位置放置买入止损单。
4. 当 CCI 自上向下跌破 `+CCI Channel` 时，在最近收盘价下方 `Indent (pips)` 点的位置放置卖出止损单。
5. 任意时刻只允许一张挂单处于激活状态。若方向发生改变，原有挂单会被取消，在挂单激活期间新的信号会被忽略。

## 挂单管理
- 如果市场价格偏离挂单价格超过 `1.5 * Indent (pips)`，止损单将被撤销，以避免在动能减弱时保留失效订单。
- 止损单成交后，策略会记录实际成交价作为入场价，并立即撤销所有方向相反的挂单。

## 风险管理
- 初始止损基于 `Stop Loss (pips)` 参数计算，策略在内部监控该价格水平，一旦触发立即以市价平仓。
- 当浮动盈利超过 `Trailing Stop (pips) + Trailing Step (pips)` 时启动跟踪止损。之后每当盈利再次增加指定的跟踪步长，止损价位都会按最小距离进行上移或下移。
- 所有以点表示的距离会根据交易品种的报价精度自动缩放，适配 3 位或 5 位小数的品种。

## 参数
| 参数 | 说明 |
|------|------|
| `CandleType` | 用于生成蜡烛并计算 CCI 的主要时间框架。 |
| `CciLength` | CCI 指标的平均周期。 |
| `CciChannelLevel` | 构成对称通道边界的绝对 CCI 阈值。 |
| `IndentPips` | 在最近收盘价基础上偏移的点数，用于设置止损挂单价格。 |
| `StopLossPips` | 初始保护性止损的点数。 |
| `TrailingStopPips` | 启动跟踪止损所需的最小盈利点数。 |
| `TrailingStepPips` | 每次调整跟踪止损之前需要增加的额外盈利点数。 |

## 说明
- 交易手数通过策略的 `Volume` 属性设置。
- 策略按照净头寸模式运行，与原始 EA 的行为保持一致。
- 如果存在图表区域，策略会绘制蜡烛、CCI 指标以及实际成交。
