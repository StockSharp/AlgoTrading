# 截图策略

## 概述
该策略还原了 MetaTrader 5 示例：等待按下 **S** 键并保存图表截图。在 StockSharp 中，策略会监听宿主控制台应用的键盘事件。当检测到 **S** 键时，它会生成一张 PNG 图片，图片中包含占位绘制、截图时间戳以及当前绑定证券的标识。MetaTrader 中的自动滚动和图表偏移选项在 StockSharp 中没有直接替代，因此移植版本专注于截图流程。

生成的文件默认保存在输出文件夹（相对于应用程序根目录）中，文件名模式为 `<ScreenshotName>_YYYYMMDD_HHMMSS.png`。每次截图都会通过信息日志 (`AddInfoLog`) 反馈，以便桌面界面展示成功或失败的结果。

## 参数
- `ScreenshotName` – 构建文件名所用的基础名称，非法字符会被替换成下划线。
- `ScreenshotWidth` – 生成 PNG 图像的宽度（像素），小于 1 的值会被提升为 1。
- `ScreenshotHeight` – 生成 PNG 图像的高度（像素），小于 1 的值会被提升为 1。
- `OutputFolder` – 存放截图的目录。若提供相对路径，则会与进程根目录组合。

所有参数都通过 `StrategyParam<T>` 暴露，可在运行时调整；因为逻辑仅用于辅助功能，所以禁用了优化。

## 使用步骤
1. 将策略连接到所需的交易连接器，并选择需要展示的品种。
2. 启动策略，此时后台任务会开始轮询控制台的键盘缓冲区。
3. 在承载策略的控制台窗口中按下 **S** 键，每次按键都会触发截图流程。
4. 在配置的输出目录中检查生成的 PNG 文件。由于 StockSharp 在无界面模式下无法直接渲染图表，图片中包含诊断文本（时间戳与证券代码）。

当策略停止时，键盘监听会被取消。如果运行环境没有控制台输入流（例如在图形界面宿主中运行），策略会记录一次警告，并忽略该快捷键，与 MQL 中事件未触发的行为保持一致。

## 注意事项
- 实现使用 `System.Drawing` 绘制占位图片，在非 Windows 平台上需要安装对应的原生依赖（例如 libgdiplus）。
- 如果创建目录或保存文件失败，异常会通过 `AddErrorLog` 记录，便于界面提示运维人员。
- 策略不会发送任何交易指令，与原始 MetaTrader 专家顾问中空的 `OnTick` 回调保持一致。
