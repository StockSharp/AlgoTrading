# 每周回撤通道策略

## 概述
每周回撤通道策略复现了 MetaTrader 4 专家顾问 `2_Otkat_Sys_v1_1` 的核心思想。系统寻找前一次收盘价与 24 根 K 线之前的开盘价之间的大幅差距，当差距超过设定的通道阈值并且满足指定的交易日条件时，会在新交易日的最初几分钟入场。策略会设置止损/止盈，并在交易日结束前强制平仓。

## 交易逻辑
1. **数据准备**
   - 默认使用 1 分钟 K 线，亦可自定义其他周期。
   - 保存上一根 K 线的收盘价，并使用循环缓冲区记录 24 根之前的开盘价。
2. **信号判定**
   - 在指定的交易日（MetaTrader 编号：`0 = 周日`，`6 = 周六`），当本地时间处于 00:00 至 00:03 之间时评估信号。
   - 计算历史开盘价（24 根之前）与最新收盘价之间的差值；当差值超过通道阈值时发出市价单：
     - **多头**：历史开盘价减去上一收盘价大于阈值。
     - **空头**：上一收盘价减去历史开盘价大于阈值。
   - 每个交易日最多开仓一次。
3. **仓位管理**
   - 止损、止盈以点值表示，根据合约最小报价单位转换成价格偏移。
   - 多头止盈额外增加原 MT4 程序中的 3 个点距离。
   - 持仓期间持续监控 K 线高低点，若触发止损或止盈则以市价平仓。
   - 若到本地时间 22:45 仍有持仓，将立即平仓，以模拟原始程序的收盘平仓规则。

## 参数
| 名称 | 说明 | 默认值 |
|------|------|--------|
| `TakeProfitPoints` | 止盈点数，多头会额外增加 3 个点。 | `5` |
| `StopLossPoints` | 止损点数。 | `49` |
| `TradeVolume` | 市价单下单手数，将根据合约最小手数自动对齐。 | `1` |
| `CorridorPoints` | 历史开盘价与最新收盘价之间所需的最小差值。 | `10` |
| `TradeDayOfWeek` | 交易日（MetaTrader 编号，`0 = 周日` … `6 = 周六`）。 | `5`（周五） |
| `CandleType` | 用于分析的 K 线类型。 | `1 分钟` |

## 说明
- 策略仅使用已完成的 K 线，符合项目对数据处理的要求。
- 需要确保标的具备足够的历史数据，以建立 24 根 K 线的缓冲区后才可能产生信号。
- 建议根据标的的最小报价单位、最小手数和交易时间调整各项参数。
