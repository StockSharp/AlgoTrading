# Стратегия One Two Three
[English](README.md) | [中文](README_cn.md)

Стратегия One Two Three торгует прорывы осциллятора Chaikin после продолжительного бокового накопления. Алгоритм повторяет логику оригинального советника MetaTrader 5: формирует линию накопления/распределения, сглаживает её двумя EMA, проверяет, что большинство последних значений оставались возле нуля, и входит по направлению мощного импульса Chaikin. В версии StockSharp все параметры управления объёмом, стопами и трейлингом остаются настраиваемыми через свойства стратегии.

## Идея

- Рассчитать осциллятор Chaikin как разницу между быстрой и медленной EMA, применённых к линии накопления/распределения свечей.
- Хранить последние **BarsCount** значений Chaikin и считать те бары, где абсолютное значение остаётся в пределах **FlatLevel**.
- Разрешать торговлю только тогда, когда доля таких «плоских» значений превышает **FlatPercent**, что указывает на тихую фазу накопления.
- После закрытия новой свечи входить в сторону импульса Chaikin, если его величина превосходит **OpenLevel**.

## Правила входа

- **Покупка**: текущее значение Chaikin на закрытой свече ≥ **OpenLevel**, а текущая позиция ≤ 0.
- **Продажа**: текущее значение Chaikin ≤ −**OpenLevel**, а текущая позиция ≥ 0.
- Заявки выставляются по рынку. Если открыта противоположная позиция, объём ордера увеличивается так, чтобы сначала закрыть существующее направление и сразу открыть новое.

## Правила выхода

- Фиксированные стоп-лосс (**StopLossPips**) и тейк-профит (**TakeProfitPips**) пересчитываются в денежное выражение через шаг цены инструмента (1 pip = 1 шаг цены) и устанавливаются сразу после входа.
- Опциональный трейлинг-стоп переносит защитный стоп, когда цена прошла в прибыль не меньше, чем **TrailingStopPips + TrailingStepPips**. Новый стоп удерживается на расстоянии **TrailingStopPips** от текущей цены, а шаг защищает от слишком частых переносов.
- Если диапазон закрытой свечи касается стопа или цели, позиция закрывается рыночным ордером.

## Управление риском и капиталом

- **OrderVolume** задаёт базовый объём сделок. При смене направления стратегия добавляет текущий размер позиции к объёму ордера, чтобы реверс выполнялся одним приказом.
- Нулевое значение любого параметра в пипсах отключает соответствующий механизм (например, нулевой тейк-профит оставляет сделку открытой до срабатывания стопа или противоположного сигнала).

## Параметры

- **OrderVolume** – базовый объём входа.
- **StopLossPips** – расстояние от входа до защитного стопа в пипсах.
- **TakeProfitPips** – расстояние до цели в пипсах.
- **TrailingStopPips** – дистанция трейлинг-стопа в пипсах (0 отключает трейлинг).
- **TrailingStepPips** – минимальное дополнительное движение в пипсах, после которого стоп переносится повторно.
- **FastLength** – период быстрой EMA в расчёте Chaikin.
- **SlowLength** – период медленной EMA в расчёте Chaikin.
- **FlatLevel** – абсолютное значение Chaikin, считающееся признаком флэта.
- **OpenLevel** – порог Chaikin, при превышении которого разрешается вход.
- **BarsCount** – количество последних значений Chaikin для оценки флэта.
- **FlatPercent** – минимальная доля «плоских» значений для допуска к торговле.
- **CandleType** – тип или таймфрейм свечей, используемый в расчётах.

## Дополнительные замечания

- Логика трейлинг-стопа повторяет оригинал: при ненулевом **TrailingStopPips** параметр **TrailingStepPips** также должен быть положительным, иначе стоп не будет подтягиваться.
- В расчётах используется шаг цены инструмента, поэтому параметры в пипсах предполагают соответствие «1 pip = 1 шаг». При других тиках следует скорректировать значения.
- Стратегия работает только с закрывшимися свечами и не реагирует внутри бара, что совпадает с поведением советника из MetaTrader.
