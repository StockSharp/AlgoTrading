# Стратегия Universal Investor

Эта стратегия является прямой конверсией советника **Universal Investor** с платформы MetaTrader 4. Она сочетает экспоненциальную скользящую среднюю (EMA) и линейно-взвешенную скользящую среднюю (LWMA) для подтверждения краткосрочного тренда и торгует одной позицией с адаптивным размером лота.

## Логика торговли

1. Подписаться на свечи типа `CandleType` и вычислять EMA и LWMA с периодом `MovingPeriod`.
2. Сохранять два последних значения каждой средней, чтобы воспроизвести вызовы `iMA(..., shift = 1/2)` из оригинального эксперта.
3. Формировать сигнал **покупки**, когда предыдущая LWMA находится выше предыдущей EMA, обе средние росли и нет встречного сигнала на той же свече.
4. Формировать сигнал **продажи**, когда предыдущая LWMA ниже предыдущей EMA, обе средние снижались и нет встречного сигнала.
5. Закрывать длинную позицию, как только LWMA опускается ниже EMA (для короткой позиции — зеркально).
6. Рассчитывать объем сделки на основе параметра `Volume`, увеличивать его при необходимости в соответствии с `MaximumRisk` и уменьшать после серии убыточных сделок через `DecreaseFactor`.
7. Отправлять рыночные заявки `BuyMarket`/`SellMarket` и запоминать цену входа для определения результата закрытия.

Стратегия держит только одну позицию и открывает новую только после полного закрытия предыдущей, что повторяет логику скрипта MetaTrader.

## Параметры

| Имя | Описание |
| --- | --- |
| `CandleType` | Серия свечей для расчетов. |
| `MovingPeriod` | Период EMA и LWMA. |
| `MaximumRisk` | Доля капитала (0.05 = 5%), определяющая минимальный объем позиции. |
| `DecreaseFactor` | Коэффициент снижения объема после серии убытков (0 — без снижения). |
| `Volume` | Базовый объем контрактов для `BuyMarket`/`SellMarket`. |

## Индикаторы

- `ExponentialMovingAverage`
- `LinearWeightedMovingAverage`

## Примечания

- Сделки совершаются только по закрытым свечам, как и в исходном советнике, который проверял `Time[0]`.
- Алгоритм расчета объема повторяет функцию `LotsOptimized`, включая риск-ориентированную часть и учет серии убыточных сделок.
