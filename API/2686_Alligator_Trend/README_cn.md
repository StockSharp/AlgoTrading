# Alligator 趋势策略
[English](README.md) | [Русский](README_ru.md)

该策略复现了 MetaTrader 脚本 (`Alligator.mq5`) 中的经典比尔·威廉姆斯 Alligator 系统。算法基于三条在中价上计算的平滑移动平均线，并向前偏移以展示市场状态。当快速的 Lips 线位于 Teeth 之上且 Teeth 位于 Jaw 之上时开多单；当排列顺序相反时开空单。系统同一时间只允许持有一个方向的仓位。

进场后，策略会按照点数设置止损与止盈。当价格向有利方向运行并达到设定的“零轴”距离时，止损会移动到开仓价。随后启用追踪止损：多头跟随最高价，空头跟随最低价，并只有在收益改善超过最小步长时才更新，以避免频繁调整。一旦价格触及止损、追踪止损或止盈水平，仓位立即平仓。

默认配置面向 30 分钟 K 线和外汇点值，但所有参数都可以针对其他市场进行优化。由于原始 MQL 版本依赖券商的点值处理，本转换使用标的资产的 `PriceStep` 来把点数转换成实际价格差。

## 交易规则

### 入场
- **多头**：当前无持仓，且在最近一根完成的 K 线上满足 `Lips > Teeth > Jaw`。
- **空头**：当前无持仓，且在最近一根完成的 K 线上满足 `Lips < Teeth < Jaw`。

### 离场与风控
- **初始止损**：多头放在开仓价下方 `StopLossPips` 点，空头放在开仓价上方 `StopLossPips` 点。
- **止盈**：距离开仓价 `TakeProfitPips` 点。
- **零轴规则**：当盈利幅度达到 `ZeroLevelPips` 点时，把止损移动到开仓价。
- **追踪止损**：启用零轴后，止损距离最新极值 `TrailingStopPips` 点，仅当改进超过 `TrailingStepPips` 点时才更新。
- 当 K 线数据触及任一止损或止盈时，立刻退出仓位。

## 参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `CandleType` | 30 分钟周期 | 用于计算指标与信号的 K 线类型。 |
| `JawLength` | 13 | 蓝色 Jaw 线的平滑均线周期。 |
| `TeethLength` | 8 | 红色 Teeth 线的平滑均线周期。 |
| `LipsLength` | 5 | 绿色 Lips 线的平滑均线周期。 |
| `JawShift` | 8 | Jaw 线向前偏移的柱数。 |
| `TeethShift` | 5 | Teeth 线向前偏移的柱数。 |
| `LipsShift` | 3 | Lips 线向前偏移的柱数。 |
| `EnableLong` | `true` | 是否允许做多。 |
| `EnableShort` | `true` | 是否允许做空。 |
| `StopLossPips` | 45 | 距离开仓价的止损点数。 |
| `TakeProfitPips` | 145 | 距离开仓价的止盈点数。 |
| `ZeroLevelPips` | 30 | 触发移到保本所需的盈利点数。 |
| `TrailingStopPips` | 50 | 追踪止损与最新极值之间的点数距离。 |
| `TrailingStepPips` | 10 | 更新追踪止损所需的最小改善点数。 |

## 说明

- Alligator 指标基于 `(High + Low) / 2` 的中价计算，以匹配 MetaTrader 的实现。
- 通过内部缓冲来模拟指标线的前移，使得比较使用与原脚本相同的偏移值。
- 假设每根 K 线的信号在下一根出现前已完全执行，从而与原专家顾问的逐棒处理保持一致。
- 请根据交易品种的最小跳动和波动性调整点数参数。
