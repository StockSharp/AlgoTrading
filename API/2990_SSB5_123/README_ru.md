# Стратегия SSB5_123

## Общее описание
Стратегия представляет собой перенос советника MetaTrader 5 «ssb5_123» на платформу StockSharp. Исходный алгоритм из коллекции SSB (Step by Step) Юрия Решетова объединяет несколько классических осцилляторов для подтверждения пробоев. Переписанная версия использует высокоуровневый API подписки на свечи и встроенные индикаторы StockSharp, полностью сохраняя торговые правила оригинала.

Обработка выполняется только по факту закрытия свечи. Стратегия сравнивает открытие текущей свечи с предыдущей, анализирует направление и изменение Awesome Oscillator, MACD и гистограммы OsMA, проверяет положение цены относительно сглаженной скользящей средней и фильтрует сигналы с помощью стохастика, требуя, чтобы линии %K и %D находились по одну сторону от уровня 50.

## Используемые индикаторы
- **Smoothed Moving Average (SMMA, период 45)** – фильтрует направление: открытие должно находиться выше средней для лонга и ниже для шорта.
- **MACD (47 / 95 / 74)** – главная линия должна иметь правильный знак, а также расти (для покупок) или падать (для продаж) относительно предыдущей свечи.
- **OsMA** – рассчитывается как разница между главной линией MACD и сигналом. Для покупок гистограмма не должна расти, для продаж – не должна падать.
- **Awesome Oscillator** – стандартные периоды 5/34. Требуется, чтобы сам осциллятор имел нужный знак, а также чтобы разница между текущим и предыдущим значением указывала в сторону сделки.
- **Стохастик (K=25, D=12, Slowing=56)** – обе линии должны находиться выше 50 при покупках и ниже 50 при продажах.

## Логика торговли
1. Дождаться закрытия новой свечи.
2. Проверить **условия на покупку** (все должны выполняться):
   - Открытие текущей свечи меньше либо равно открытию предыдущей.
   - AO > 0 и текущее значение ниже предыдущего.
   - MACD > 0 и текущее значение выше предыдущего.
   - Гистограмма OsMA не увеличивается.
   - Открытие находится выше SMMA.
   - %K и %D стохастика ≥ 50.
3. Проверить **условия на продажу** (все должны выполняться):
   - Открытие текущей свечи больше либо равно открытию предыдущей.
   - AO < 0 и текущее значение выше предыдущего.
   - MACD < 0 и текущее значение ниже предыдущего.
   - Гистограмма OsMA не уменьшается.
   - Открытие находится ниже SMMA.
   - %K и %D стохастика ≤ 50.
4. Если позиция уже открыта, противоположный сигнал немедленно закрывает её. Это повторяет порядок действий оригинального советника.
5. При отсутствии позиции сначала рассматривается сигнал на покупку. Если внезапно оба направления выполняются (возможная ситуация при нулевых значениях индикаторов), стратегия, как и MQL-версия, открывает лонг.

## Параметры
- **SMMA Period** – период сглаженной средней (по умолчанию 45).
- **MACD Fast / Slow / Signal** – периоды EMA для MACD (47 / 95 / 74).
- **Stochastic %K / %D / Slowing** – параметры стохастика (25 / 12 / 56).
- **Order Volume** – объём рыночных заявок (по умолчанию 1).
- **Candle Type** – тип/таймфрейм свечей. По умолчанию 1 час, при необходимости выставите период, использованный в MetaTrader.

## Дополнительные замечания
- Расчёты выполняются только на закрытых свечах; внутрисессионные обновления игнорируются.
- Значения индикаторов предыдущей свечи сохраняются, чтобы сравнение направлений полностью соответствовало функциям `fao1`, `fmacd1` и `fosma1` из MQL.
- В советнике не предусмотрены стоп-лосс и тейк-профит. Управление рисками следует реализовать отдельно.
- Все настройки заданы через `StrategyParam`, поэтому доступны для оптимизации стандартными средствами StockSharp.

## Особенности переноса
- Проверка доступных лотов и "magic number" из MQL не требуются в StockSharp и были исключены.
- Порядок управления позициями сохранён: закрытие выполняется раньше, чем попытка открыть новую позицию, поэтому разворот в ту же свечу не происходит.
- Индикаторы Awesome Oscillator и MACD берутся из библиотеки StockSharp, что избавляет от ручного копирования буферов, присутствовавшего в исходном коде.
