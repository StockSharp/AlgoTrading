# WOC 0.1.2 动能策略

## 概述
本策略是 MetaTrader 专家顾问“WOC.0.1.2”的 StockSharp 高级 API 版本。策略订阅 Level 1 买一/卖一报价，监控卖一价格的快速连续跳动。当卖一价格在指定时间窗口内连续上涨或下跌达到设定次数时，系统会沿突破方向发送市价单。策略一次只会持有一个方向的仓位，与原始 MQL 代码保持一致。

## 数据与执行
- **行情来源**：Level 1 买一价和卖一价，不依赖 K 线或其他技术指标。
- **订单执行**：使用市价单。止损与移动止损在策略内部通过实时比较买一/卖一来模拟。

## 信号逻辑
1. 保存最近的卖一价格，并统计连续刷新更高价（上涨序列）或更低价（下跌序列）的次数。
2. 当任一序列的计数达到 `SequenceLength` 时，检查该序列持续的时间是否不超过 `SequenceTimeoutSeconds` 秒。
3. 如果下跌序列的计数大于上涨序列，则开空单；否则开多单。该判断完全复刻了原始 MQL 中“比较 up 与 down 计数再决定方向”的做法。
4. 每次尝试开仓后都会重置所有计数，以便下一次信号从零开始累计。

## 仓位管理
- **初始止损**：开仓后立即记录一个止损价，距离当前买一价（多头）或卖一价（空头）`StopLossTicks` 个价格步长。
- **移动止损**：当浮盈超过 `TrailingStopTicks` 个价格步长时，把止损价跟随到距离当前买一/卖一 `TrailingStopTicks` 的位置，并确保止损仍至少距离当前价两个移动步长。这一点与 MQL 策略中 “StopLoss < Bid - 2 * TrailingStop” 的条件完全一致。
- **离场方式**：当监控到买一/卖一穿越保存的止损价时，立即通过市价单平仓，同时重置内部状态。

## 仓位规模
策略提供两种下单量模式：
- **固定手数**：使用 `LotSize` 参数作为订单量。
- **自动手数**：开启 `UseAutoLotSizing` 后，根据账户资金在下表中的区间映射出对应的下单量。账户资金读取自 `Portfolio.CurrentValue`，若不可用则退回 `Portfolio.BeginValue`。

| 账户资金（大于） | 下单量 |
| ---------------- | ------ |
| 0（默认）        | `LotSize`
| 200              | 0.04
| 300              | 0.05
| 400              | 0.06
| 500              | 0.07
| 600              | 0.08
| 700              | 0.09
| 800              | 0.10
| 900              | 0.20
| 1 000            | 0.30
| 2 000            | 0.40
| 3 000            | 0.50
| 4 000            | 0.60
| 5 000            | 0.70
| 6 000            | 0.80
| 7 000            | 0.90
| 8 000            | 1.00
| 9 000            | 2.00
| 10 000           | 3.00
| 11 000           | 4.00
| 12 000           | 5.00
| 13 000           | 6.00
| 14 000           | 7.00
| 15 000           | 8.00
| 20 000           | 9.00
| 30 000           | 10.00
| 40 000           | 11.00
| 50 000           | 12.00
| 60 000           | 13.00
| 70 000           | 14.00
| 80 000           | 15.00
| 90 000           | 16.00
| 100 000          | 17.00
| 110 000          | 18.00
| 120 000          | 19.00
| 130 000          | 20.00

## 参数说明
- `StopLossTicks`：以价格步长表示的初始止损距离。
- `TrailingStopTicks`：以价格步长表示的移动止损距离，设为 0 可关闭移动止损。
- `SequenceLength`：连续刷新卖一价格所需的次数，达到后触发交易。
- `SequenceTimeoutSeconds`：允许序列持续的最长时间（秒）。
- `LotSize`：未启用自动手数时使用的固定下单量。
- `UseAutoLotSizing`：是否按上表的资金区间自动调整下单量。

## 使用建议
- 适用于卖一价格变动频繁的高流动性品种，建议使用 tick 级别数据源进行回测。
- 该策略只处理对冲账户模式，一次仅持有一个净头寸方向。
- 请确保 `Security.PriceStep` 已正确设置，否则止损与移动止损会退化为以 1 货币单位为步长的计算。
- 策略不使用蜡烛或指标，在延迟较低的环境中表现最佳。
