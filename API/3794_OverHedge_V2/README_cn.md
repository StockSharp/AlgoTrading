# OverHedge V2 网格策略
[English](README.md) | [Русский](README_ru.md)

OverHedge V2 是一个对冲型网格系统，会在多空之间交替开仓，并在每次成交后按照倍数放大手数。策略通过比较快、慢指数移动平均线 (EMA) 的位置来确定新一轮循环的起始方向。循环启动时记录当前买价，构建一个包含价差的“隧道”，然后按方向立即成交第一单，反向订单则在价格触及隧道边界时执行。

随着价格继续逆行，网格会以“买→卖→买→…”的顺序不断扩展，每一单的手数都按乘数放大，从而在反弹时更快弥补浮亏。策略使用 Level 1 报价追踪最佳买卖价，分别维护多头与空头的平均价格与持仓量，一旦浮动利润达到目标值或用户开启停机选项，就会同时平掉所有头寸并重置循环。

## 工作流程

1. **方向过滤**：在收盘 K 线计算两条 EMA，快线高于慢线时从做多开始，否则从做空开始。
2. **循环初始化**：记录当前 Bid，并按照配置的宽度加上实时点差确定隧道上下边界。第一笔顺势成交，反向交易挂在隧道另一端等待触发。
3. **网格扩张**：如果行情继续逆势运行，策略交替发送买入和卖出市价单。每一笔成交的手数都会乘以对冲倍数。
4. **利润结算**：根据当前最佳买卖价计算浮动盈亏。达到 `Profit Target` 或者 `Shutdown Grid` 被激活时，策略会立即平掉所有仓位。
5. **头寸管理**：通过跟踪多空平均价与挂单状态，避免在未完成的订单上重复下单，并确保利润计算准确。

## 默认参数

- `Base Volume` = 0.1 手 —— 第一笔订单的基础手数。
- `Hedge Multiplier` = 2.0 —— 每次新增订单的手数倍数。
- `Tunnel Width (points)` = 20 —— 在当前点差基础上额外增加的网格宽度（以点为单位）。
- `Profit Target` = 100 —— 未实现利润达到该金额时关闭整个网格。
- `Short EMA` = 8 —— 快速 EMA 周期。
- `Long EMA` = 21 —— 慢速 EMA 周期。
- `Candle Type` = 1 分钟 —— 计算 EMA 所使用的时间框架。
- `Shutdown Grid` = false —— 为 `true` 时立即平仓并停止交易。

## 说明

- 需要有 Level 1 最优买卖价数据，较大的点差会自动让隧道变宽。
- 策略会根据合约的最小交易单位调整手数，避免下出无效订单。
- 由于采用类似马丁的加倍方式，若市场长时间单边运行，浮亏和保证金压力会迅速增加。
- 重新允许交易时，请把 `Shutdown Grid` 设回 `false` 或者重新启动策略。
