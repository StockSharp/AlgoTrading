# Стратегия Move Stop Loss

## Обзор
- Конвертация советника MetaTrader 4 **MoveStopLoss.mq4 (43793)** под инфраструктуру StockSharp.
- Управляет уже открытыми позициями, передвигая защитный стоп вслед за ценой.
- Поддерживает два режима: автоматический (на основе ATR) и ручной (фиксированное расстояние).

## Логика торговли
1. Подписывается на выбранные свечи и рассчитывает ATR с заданным периодом.
2. Формирует скользящее максимальное значение последних `AtrLookback` значений ATR, что повторяет поиск максимума за 30 баров в исходном коде.
3. Определяет расстояние трейлинг-стопа:
   - При `AutoTrail = true` умножает максимум ATR на `AtrMultiplier` (по умолчанию 0.85), получая величину в ценовых единицах.
   - При `AutoTrail = false` переводит `ManualDistance`, указанное в шагах цены, в абсолютное значение.
4. Для длинной позиции:
   - Фиксирует момент открытия новой позиции и сбрасывает предыдущий стоп.
   - Ждет, пока цена не превысит сохраненную цену входа.
   - Выставляет/переносит стоп-заявку на продажу так, чтобы она отставала от последней цены закрытия на `trailDistance`.
5. Для короткой позиции выполняется зеркальная логика, поддерживающая стоп-покупку выше цены на то же расстояние.
6. При отсутствии позиции стратегия отменяет защитную заявку и очищает внутренние переменные.

## Параметры
| Параметр | Описание |
| --- | --- |
| `AutoTrail` | Включает использование ATR для расчета расстояния. При отключении применяется `ManualDistance`. |
| `ManualDistance` | Фиксированное смещение в шагах цены, используется только при отключенном `AutoTrail`. |
| `AtrMultiplier` | Множитель для максимального ATR в автоматическом режиме. |
| `AtrPeriod` | Период расчета ATR (в исходной версии равен 7). |
| `AtrLookback` | Количество значений ATR в окне поиска максимума (по умолчанию 30). |
| `CandleType` | Тип свечей, которые используются для вычислений. |

## Особенности реализации
- Стратегия не инициирует сделки, а лишь сопровождает существующую нетто-позицию при помощи стоп-заявок.
- Применяется высокоуровневый API StockSharp: `SubscribeCandles` и `BindEx` позволяют связать ATR с индикатором максимума без ручного хранения данных.
- Метод `StartProtection()` активируется для безопасного управления заявками.
- Все комментарии в коде выполнены на английском языке согласно требованиям.
