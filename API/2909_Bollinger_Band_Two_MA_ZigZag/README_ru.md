# Стратегия Bollinger Band Two MA ZigZag
[English](README.md) | [中文](README_cn.md)

Гибридная трендовая система, сочетающая развороты по полосам Боллинджера, два скользящих средних старших таймфреймов и экстремумы, найденные алгоритмом ZigZag. На каждый сигнал открываются две позиции: первая с расчётной целью по прибыли и вторая «долгоиграющая», управляемая трейлингом и переводом в безубыток.

## Детали

- **Условия входа**:
  - **Long**: предыдущая свеча закрылась выше предыдущей нижней полосы Боллинджера после закрытия ниже неё двумя барами ранее, текущая цена также выше этой полосы, и цена расположена выше обоих скользящих средних старших таймфреймов.
  - **Short**: предыдущая свеча закрылась ниже предыдущей верхней полосы Боллинджера после закрытия выше неё двумя барами ранее, текущая цена также ниже этой полосы, и цена расположена ниже обоих скользящих средних старших таймфреймов.
- **Управление позицией**:
  - По сигналу открываются две позиции объёмами `First Volume` (с тейк-профитом) и `Second Volume` (позиция-поезд).
  - Стопы привязываются к последнему экстремуму ZigZag с учётом `Pivot Offset (pts)`.
  - Защита безубытка переносит стоп на цену входа плюс `Break-even Offset (pts)`, когда плавающая прибыль превышает сумму `Break-even Threshold (pts)` и `Break-even Offset (pts)`.
  - Трейлинг-стоп активируется после движения на `Trailing Step (pts)` сверх текущего стопа, сохраняя расстояние `Trailing Stop (pts)` от цены.
- **Тейк-профит**:
  - Цель первой позиции вычисляется как процент (`Take Profit %`) от расстояния между входом и стопом.
  - Позиция-поезд фиксируется только по стопу, трейлингу или противоположному сигналу.
- **Дополнительная логика**:
  - Противоположный сигнал закрывает активные позиции противоположного направления перед открытием новых.
  - Расчёты ведутся только по закрывшимся свечам; неполные данные игнорируются.
- **Значения по умолчанию**:
  - `First Volume` = 0.1
  - `Second Volume` = 0.1
  - `Take Profit %` = 50
  - `Pivot Offset (pts)` = 10
  - `Use Break-even Move` = true
  - `Break-even Offset (pts)` = 80
  - `Break-even Threshold (pts)` = 10
  - `Trailing Stop (pts)` = 80
  - `Trailing Step (pts)` = 120
  - `Bollinger Period` = 20
  - `Bollinger Width` = 2
  - `Base Candle` = свечи 1 часа
  - `MA1 Candle` = дневные свечи
  - `MA2 Candle` = свечи 4 часов
  - `MA1 Period` = 20
  - `MA2 Period` = 20
  - `ZigZag Depth` = 12
  - `ZigZag Deviation (pts)` = 5
  - `ZigZag Backstep` = 3
- **Фильтры**:
  - Категория: Trend Following
  - Направление: Оба
  - Индикаторы: Bollinger Bands, Moving Averages, ZigZag
  - Стопы: Да (по экстремуму, безубыток, трейлинг)
  - Сложность: Продвинутая
  - Таймфрейм: Мульти-таймфрейм (база 1ч, фильтры Day и 4h)
  - Сезонность: Нет
  - Нейросети: Нет
  - Дивергенция: Нет
  - Уровень риска: Средний

## Примечания

- Для работы стратегии требуются подписки на свечи трёх таймфреймов для сигналов и управления сделками.
- Поиск экстремумов имитирует логику ZigZag MetaTrader за счёт ограничений по глубине, отклонению и минимальному числу баров между пивотами.
- Объёмы можно настраивать независимо, подбирая долю позиции с тейк-профитом и объём позиции-поезда.
