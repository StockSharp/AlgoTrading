# Стратегия Jims Close Positions

## Обзор
Эта стратегия представляет собой конвертацию советника MetaTrader **Jims Close Positions** из каталога `MQL/19364` на платформу StockSharp. Её задача — управлять уже открытыми позициями и закрывать их в соответствии с выбранным режимом. Новые входы не генерируются, что позволяет использовать стратегию совместно с другими алгоритмами или ручной торговлей.

Реализовано три взаимоисключающих режима работы:
1. Немедленно закрывать все открытые позиции.
2. Закрывать только прибыльные позиции.
3. Закрывать только убыточные позиции.

При инициализации выполняется проверка, гарантирующая, что активирован только один режим — такая же защита использовалась и в оригинальном MQL-скрипте.

## Параметры
| Название | Тип | Значение по умолчанию | Описание |
|----------|-----|------------------------|----------|
| `CloseAll` | `bool` | `true` | Закрывает любую открытую позицию сразу после получения рыночных данных. |
| `CloseAllProfit` | `bool` | `false` | Закрывает позиции только при положительном нереализованном результате. |
| `CloseAllLoss` | `bool` | `false` | Закрывает позиции только при отрицательном нереализованном результате. |

Если пользователь активирует более одного режима, стратегия выводит сообщение об ошибке и останавливается.

## Торговая логика
- Подписка на тиковые сделки через `SubscribeTrades()` позволяет проверять состояние позиции при каждом новом трейде.
- В режиме `CloseAll` позиция закрывается немедленно рыночным ордером.
- В режимах закрытия по прибыли или убытку рассчитывается нереализованный результат как разница между текущей ценой сделки и средней ценой позиции. Знак результата определяет необходимость закрытия.
- Перед выставлением ордеров на выход отменяются все активные заявки, чтобы избежать конфликтов.
- Флаг `_isClosing` защищает от повторной отправки ордеров, пока позиция не станет равной нулю.

## Особенности реализации
- Для оценки результата используется разница между средней ценой позиции и последней ценой сделки. Это позволяет определить прибыльность без дополнительных индикаторов или накопительных расчётов.
- Все комментарии в коде написаны на английском языке, согласно общим требованиям репозитория.
- Стратегия предназначена для работы с уже существующими позициями и может применяться как инструмент экстренного закрытия портфеля.

## Рекомендации по использованию
1. Привяжите стратегию к нужному инструменту и портфелю, содержащему позиции для закрытия.
2. Выберите только один режим (`CloseAll`, `CloseAllProfit` или `CloseAllLoss`).
3. Запустите стратегию и убедитесь, что доступны рыночные данные для немедленной отправки ордеров.
4. Отслеживайте сообщения журнала — уведомления «Closing profitable position» и «Closing losing position» подтверждают работу алгоритма.

## Состав
- `CS/JimsClosePositionsStrategy.cs` — реализация стратегии.
- `README.md`, `README_ru.md`, `README_cn.md` — документация на английском, русском и китайском языках.
