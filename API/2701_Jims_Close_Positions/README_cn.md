# Jims Close Positions 策略

## 概述
该策略是将 `MQL/19364` 中的 MetaTrader 专家顾问 **Jims Close Positions** 转换到 StockSharp 平台的结果。策略仅用于管理已有仓位，不会创建新的入场信号，因此可以与其他交易系统或手动操作一起使用。

策略支持三个互斥的模式：
1. 立即关闭所有持仓。
2. 仅关闭当前盈利的持仓。
3. 仅关闭当前亏损的持仓。

启动时会检查参数，确保只有一个模式被启用。这与原始 MQL 版本中的安全检查一致，可避免在界面中意外勾选多个选项。

## 参数
| 名称 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `CloseAll` | `bool` | `true` | 一旦收到市场数据就立即平掉所有仓位。 |
| `CloseAllProfit` | `bool` | `false` | 仅在持仓处于浮动盈利时才平仓。 |
| `CloseAllLoss` | `bool` | `false` | 仅在持仓处于浮动亏损时才平仓。 |

如果同时启用了多个模式，策略会记录错误并立即停止。

## 交易逻辑
- 通过 `SubscribeTrades()` 订阅逐笔成交，每出现新的成交都会重新评估当前仓位。
- 启用 `CloseAll` 时，策略直接发送市价单平仓。
- 启用盈亏模式时，策略使用平均持仓价格与最新成交价之间的差值来估算浮动盈亏；正数表示盈利，负数表示亏损。
- 在发送平仓单之前会取消所有活动订单，防止与其他挂单冲突。
- `_isClosing` 标志用于避免在同一持仓尚未平掉之前重复发送平仓指令，在仓位归零时自动复位。

## 实现细节
- 通过平均持仓价格即可判断盈亏方向，无需访问历史成交列表，也不用创建额外的集合，完全符合项目的编码准则。
- 代码中的注释全部为英文，满足仓库对语言的要求。
- 该策略非常适合在需要迅速退出市场或批量平仓时使用。

## 使用建议
1. 将策略连接到包含目标仓位的证券与投资组合。
2. 只选择一个模式（`CloseAll`、`CloseAllProfit` 或 `CloseAllLoss`）。
3. 启动策略并确保可以接收实时行情，以便立即执行市价单。
4. 通过日志消息（例如 “Closing profitable position”）确认策略动作。

## 文件列表
- `CS/JimsClosePositionsStrategy.cs`：策略实现。
- `README.md`、`README_ru.md`、`README_cn.md`：英文、俄文和中文文档。
