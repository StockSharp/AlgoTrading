# Стратегия Channels

Стратегия является прямой конвертацией советника MetaTrader 4 «Channels» из библиотеки Gordago. Она сочетает сверхбыструю экспоненциальную скользящую среднюю (EMA) с тремя каналами на базе той же EMA, чтобы находить моменты выхода цены из сжатого диапазона. После открытия удерживается только одна позиция, а сопровождение сделки ведётся стоп-ордером и при необходимости трейлинг-стопом — полностью по логике исходного MQL-кода.

## Логика торговли

- По умолчанию используются часовые свечи, на основании которых рассчитываются:
  - Быстрая EMA с периодом 2 по ценам закрытия.
  - Вторая быстрая EMA с периодом 2 по ценам открытия (нужна для условий входа в шорт).
  - Медленная EMA с периодом 220 по закрытию, служащая базой для трёх каналов ±1.0%, ±0.7% и ±0.3%.
- **Покупка** выполняется, когда быстрая EMA по закрытию удовлетворяет одному из шести проверяемых условий:
  1. Пересечение вверх нижней границы канала 1%.
  2. Пересечение вверх нижней границы канала 0.7%.
  3. Две последовательные свечи ниже нижней границы канала 0.3% (сигнал перепроданности).
  4. Пересечение вверх самой медленной EMA.
  5. Пересечение вверх верхней границы канала 0.3%.
  6. Пересечение вверх верхней границы канала 0.7%.
- **Продажа** выполняется, когда быстрая EMA по цене открытия выполняет зеркальный набор проверок:
  1. Пересечение вниз верхней границы канала 1%.
  2. Пересечение вниз верхней границы канала 0.7%.
  3. Пересечение вниз верхней границы канала 0.3%.
  4. Пересечение вниз медленной EMA.
  5. Пересечение вниз нижней границы канала 0.3%.
  6. Пересечение вниз нижней границы канала 0.7%.
- Одновременно может существовать только одна позиция: новые сигналы игнорируются, пока сделка активна, что полностью повторяет поведение исходного советника.

## Управление рисками

- Для длинных и коротких сделок задаются независимые расстояния до стоп-лосса и тейк-профита (в пунктах). Нулевое значение выключает соответствующий защитный ордер, как в оригинальной версии.
- Настраиваемый трейлинг-стоп подтягивает стоп-ордер, когда цена проходит заданное количество пунктов в прибыльную сторону.
- Все защитные ордера автоматически отменяются при закрытии позиции или остановке стратегии.

## Параметры

| Параметр | Описание |
| -------- | -------- |
| `Candle Type` | Таймфрейм, используемый для расчётов (по умолчанию 1 час). |
| `Volume` | Объём заявки при входе. |
| `Fast EMA` / `Slow EMA` | Периоды быстрой и медленной EMA. |
| `Envelope 1%`, `Envelope 0.7%`, `Envelope 0.3%` | Ширина трёх каналов в процентах. |
| `Buy Stop-Loss`, `Sell Stop-Loss` | Начальное расстояние до стоп-лосса для лонга и шорта. |
| `Buy Take-Profit`, `Sell Take-Profit` | Начальное расстояние до тейк-профита для лонга и шорта. |
| `Buy Trailing`, `Sell Trailing` | Дистанция трейлинг-стопа в пунктах. |
| `Use Trading Hours` | Включение фильтра по времени торговли. |
| `From Hour`, `To Hour` | Разрешённые часы для открытия позиций (границы включительно). Если начальный час больше конечного, окно охватывает переход через полночь. |

## Особенности использования

1. Значения в пунктах переводятся в цену через `PriceStep`, поэтому важно, чтобы минимальный шаг цены инструмента был корректно задан в системе.
2. Период быстрой EMA оставлен равным 2 для точного соответствия оригиналу. Изменение параметра существенно влияет на частоту сигналов.
3. Функции фильтрации по номеру счёта и звуковых уведомлений из MQL-версии не перенесены, поскольку они не относятся к торговой логике.
