# Стратегия Graal EMA Momentum
[English](README.md) | [中文](README_cn.md)

Эта стратегия представляет собой конвертацию советника MetaTrader 4 **0Graal-CROSSmuvingi**. Она отслеживает пересечения экспоненциальных средних: быстрая EMA считается по ценам закрытия, а медленная EMA — по ценам открытия. Сделки совершаются только тогда, когда моментум подтверждает силу пробоя, а фиксированный тейк-профит в пунктах повторяет логику исходного советника.

## Торговая идея

1. **Быстрая EMA по закрытию** отражает текущее направление цены.
2. **Медленная EMA по открытию** обеспечивает плавную базовую линию для пересечения.
3. **Осциллятор Momentum (период 14)** измеряет ускорение движения относительно уровня 100. Сигнал считается действительным, если моментум отклоняется от 100 больше заданного фильтра и продолжает усиливаться.
4. **Тейк-профит** фиксирует прибыль после прохождения заданного расстояния в пунктах (`TakeProfitPoints`).

## Условия входа

- **Покупка**
  - На текущей завершенной свече быстрая EMA выше медленной, а на предыдущей свече была ниже либо равна.
  - Значение моментума (минус 100) превышает порог `MomentumFilter` и выше предыдущего значения моментума.
  - Открытые короткие позиции закрываются перед открытием лонга. Объем заявки равен `Volume` плюс количество, необходимое для переворота.
- **Продажа**
  - Быстрая EMA опускается ниже медленной, в то время как на предыдущей свече была выше либо равна.
  - Моментум (минус 100) ниже отрицательного порога `MomentumFilter` и меньше предыдущего значения моментума.
  - Длинные позиции закрываются перед открытием шорта. Объем заявки равен `Volume` плюс количество для закрытия лонга.

## Условия выхода

- Позиция закрывается, когда цена достигает тейк-профита (`TakeProfitPoints * PriceStep`).
- Новый противоположный сигнал немедленно разворачивает позицию, так как объем ордера включает текущий размер позиции.

## Параметры

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `FastPeriod` | Период EMA по ценам закрытия. | 13 |
| `SlowPeriod` | Период EMA по ценам открытия. | 34 |
| `MomentumPeriod` | Глубина расчета моментума. | 14 |
| `MomentumFilter` | Минимальное отклонение моментума от 100. | 0.1 |
| `TakeProfitPoints` | Дистанция до тейк-профита в пунктах (умножается на `PriceStep`). | 200 |
| `CandleType` | Тип свечей для расчётов (по умолчанию 15 минут). | 15-минутные свечи |
| `Volume` | Базовый торговый объем, наследуется от базового класса. | 1 |

## Особенности реализации

- Обработка сигналов ведется только по завершенным свечам (`CandleStates.Finished`).
- Подписка на свечи выполняется через `SubscribeCandles`, а индикаторы подключаются высокоуровневым API.
- Медленная EMA обновляется вручную значениями открытия внутри колбэка, чтобы воспроизвести использование `PRICE_OPEN` в MT4.
- Контроль тейк-профита отслеживает экстремумы свечи, что имитирует точечный выход оригинального советника.
- Метод `StartProtection()` запускается при старте, защищая от неожиданных позиций до включения логики.
