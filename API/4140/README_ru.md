# FiftyFiveMedianSlopeStrategy

## Происхождение
- Стратегия создана на основе советника MetaTrader 4 **55_MA_med_FIN.mq4**.
- Основной сигнал строится на наклоне 55-периодной скользящей средней, рассчитанной по медианной цене свечи.

## Логика торговли
- Подписывается на выбранный таймфрейм (по умолчанию 1 час) и обрабатывает только завершённые свечи.
- Рассчитывает скользящую среднюю заданного типа (SMA, EMA, SMMA или LWMA) по медианной цене \((High + Low) / 2\).
- Сохраняет последние значения средней во внутреннем буфере, чтобы сравнивать значение на одну свечу назад со значением `MaShift` свечей назад.
- Если значение на одну свечу назад выше, чем `MaShift` свечей назад:
  - Сначала закрывает открытую короткую позицию.
  - Затем открывает длинную позицию, если не превышен предел `MaxOrders`.
- Если значение на одну свечу назад ниже, чем `MaShift` свечей назад, выполняется зеркальная логика для коротких позиций.
- Внутренние флаги блокируют повторное открытие в ту же сторону, пока не появится противоположный сигнал, что полностью повторяет механику оригинального советника.
- Торговля разрешена только когда час открытия свечи удовлетворяет неравенству `StartHour < hour < EndHour` (границы строго исключаются).

## Управление позицией и рисками
- `FixedVolume` задаёт базовый объём сделки. Если он равен нулю, стратегия рассчитывает объём по доле капитала `RiskPercentage`.
- `MaxOrders` ограничивает, сколько раз базовый объём можно наращивать в одном направлении. Значение 0 снимает ограничение.
- Параметры `StopLossPoints` и `TakeProfitPoints` задают расстояние до стоп-лосса и тейк-профита в шагах цены через `StartProtection`.

## Параметры
- `FixedVolume` – фиксированный объём заявки (0 включает режим по риску).
- `RiskPercentage` – процент капитала для расчёта объёма, если используется режим по риску.
- `TakeProfitPoints` / `StopLossPoints` – дистанции защитных уровней в шагах цены.
- `MaPeriod` – период скользящей средней (по умолчанию 55).
- `MaShift` – сдвиг для сравнения исторических значений (по умолчанию 13).
- `MaMethod` – тип скользящей средней: Simple, Exponential, Smoothed, LinearWeighted.
- `StartHour` / `EndHour` – границы торгового окна в часах платформы (0–23, исключая границы).
- `MaxOrders` – максимальное число одновременно открытых позиций в одном направлении.
- `CandleType` – таймфрейм, используемый для расчёта сигналов.

## Рекомендации
- Убедитесь, что инструмент содержит корректные значения шага цены и минимального шага объёма, иначе выравнивание объёма может быть отклонено биржей.
- Режим по риску опирается на текущее значение портфеля и последнюю цену закрытия. При отсутствии данных стратегия не будет открывать сделки.
- Перед открытием новой позиции стратегия всегда закрывает противоположное плечо, как и в оригинальном MQL4-советнике.
