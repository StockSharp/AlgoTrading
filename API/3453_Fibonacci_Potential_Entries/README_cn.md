# Fibonacci Potential Entries 策略

## 概述

该策略完整复刻原始的 **EA_PUB_FibonacciPotentialEntries** 智能交易系统。它会在 50% 和 61% 的斐波那契回撤位上挂出两笔限价单，并使用 StockSharp 的高级 API 管理整个生命周期。

## 交易逻辑

1. **初始下单**
   - 当买卖报价可用时，策略计算当前点差并同时提交两笔限价单：
     - 订单 #1：挂在 50% 水平位，止损设置在 61% 水平位之外（做空时相反）。
     - 订单 #2：挂在 61% 水平位，止损设置在 61% 与 100% 水平位的中点附近。
   - 仓位规模按照资金管理计算：第一单承担 0.7% 的账户风险，第二单承担剩余的 `RiskPercent` 百分比。

2. **目标管理**
   - 当价格触及 `TargetPrice` 时，策略通过市价单平掉每个持仓的一半头寸。
   - 部分离场后，剩余仓位被移动到保本价位。如果行情回撤到入场价，剩余部分会被自动平仓。

3. **方向选择**
   - `IsBullish = true` 时执行多头模板，挂买入限价单。
   - `IsBullish = false` 时执行空头模板，对应的止损与目标判断全部镜像。

## 参数

| 名称 | 说明 |
|------|------|
| `PriceOn50Level` | 第一笔限价单的价格。 |
| `PriceOn61Level` | 第二笔限价单的价格。 |
| `PriceOn100Level` | 用于计算第二笔交易止损的参考价格。 |
| `TargetPrice` | 两笔交易共用的盈利目标。 |
| `RiskPercent` | 两笔交易整体承担的账户风险百分比。 |
| `IsBullish` | 选择多头或空头场景。 |

## 转换要点

- 只使用高级接口（`SubscribeLevel1`、`BuyLimit`、`SellLimit`、`BuyMarket`、`SellMarket`），完全符合仓库的转换规范。
- 部分平仓与保本保护通过市价单实现，无需任何底层订单修改，忠实再现 MQL 机器人的处理方式。
- 按合约的交易步长对下单数量进行规范化，确保与 StockSharp 的风控和撮合保持一致。
