# Стратегия BreakOut15

## Общее описание
BreakOut15 — конвертированная с MetaTrader 4 ("BreakOut15.mq4") стратегия для таймфрейма 15 минут. Она сочетает фильтр на базе пересечения скользящих средних с пробойным входом и многоуровневым тралинг-стопом. Все заявки отправляются через высокоуровневый API StockSharp и обрабатывают только закрытые свечи.

## Логика работы
1. Рассчитываются две настраиваемые скользящие средние (быстрая и медленная) по выбранным методу, периоду, сдвигу и типу цены.
2. При пересечении быстрой средней выше медленной выставляется уровень для покупки: `Close + BreakoutLevel * PriceStep`. Пересечение вниз формирует уровень для продажи: `Close - BreakoutLevel * PriceStep`.
3. Ожидающие уровни отменяются, если исчезает условие пересечения, истекает торговый интервал или активируется противоположный пробой.
4. Рыночный вход выполняется при достижении ценой уровня пробоя при условии соблюдения требований по капиталу и рискам.
5. Открытые позиции сопровождаются стоп-лоссом, тейк-профитом и одним из трёх режимов тралинг-стопа. Обратное пересечение скользящих приводит к немедленному закрытию позиции.
6. Дополнительные фильтры ограничивают торговлю по времени и при необходимости принудительно закрывают позиции в пятницу.

## Управление капиталом
* **UseMoneyManagement / TradeSizePercent** — включает расчёт объёма по доле капитала. Объём равен целой части выражения `floor(equity * percent / 10000) / 10`, минимум 1 лот.
* **FixedVolume** — резервный объём при отключённом манименеджменте или недоступной оценке капитала.
* **MaxVolume** — верхний предел объёма.
* **MinimumEquity** — запрет на новые сделки при падении капитала ниже порога.

## Управление рисками
* **StopLossPips / TakeProfitPips** — стандартные уровни защиты в пунктах (преобразуются через шаг цены инструмента).
* **UseTrailingStop** — включает динамический пересчёт стопов при наличии позиции.
* **TrailingStopType**
  * `Immediate` — стоп следует сразу на расстоянии исходного стоп-лосса.
  * `Delayed` — ожидание прибыли `TrailingStopPips` перед включением сопровождения с тем же шагом.
  * `MultiLevel` — фиксация прибыли на трёх уровнях (`Level1/2/3TriggerPips`) и последующее сопровождение с шагом `Level3TrailingPips`.

## Торговый график
* **UseTimeLimit, StartHour, StopHour** — ограничение торговли заданным часовым интервалом.
* **UseFridayClose, FridayCloseHour** — опциональное закрытие всех позиций поздно вечером в пятницу.

## Индикаторы и данные
* **Fast/Slow moving averages** — выбор метода: простая, экспоненциальная, сглаженная, линейно-взвешенная или наименьших квадратов.
* **Applied price** — полный набор типов цен MetaTrader (close, open, high, low, median, typical, weighted).
* **CandleType** — по умолчанию 15-минутные свечи, можно заменить при необходимости.

## Дополнительные замечания
* Стратегия синхронизирует цену входа, стопы и цели с текущей средней ценой позиции, чтобы тралинг учитывал фактические сделки.
* Все расчёты зависят от `PriceStep` инструмента — убедитесь в корректности шага цены.
* Рекомендуется протестировать сценарии срабатывания пробоя, переключения тралинг-стопов и правила округления объёма в разных рыночных условиях.
