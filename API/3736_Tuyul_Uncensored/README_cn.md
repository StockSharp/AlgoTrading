# Tuyul Uncensored 策略

## 概览
Tuyul Uncensored 策略基于原始 MetaTrader 5 专家顾问重新实现，利用 StockSharp 的高级 API 运行。系统通过 ZigZag 指标追踪摆动高低点，并结合快慢指数移动平均线判定趋势。当确认新的摆动后，在最近一段的 57% 斐波那契回撤位置挂出限价单，希望在主趋势回踩时入场，同时根据摆动区间自动设定止损和止盈。

## 交易逻辑
1. **数据准备**
   - 仅订阅一个由 `K 线类型` 参数指定的蜡烛序列。
   - 根据深度、偏差、回退参数配置 ZigZag 指标，用于记录最新的摆动高点和摆动低点。
   - 9/21 默认周期的快慢 EMA 负责趋势过滤。
2. **信号检测**
   - 当 ZigZag 确认新的摆动高点或低点时，更新最近一对摆动价格。
   - 若当前没有挂单且没有持仓，则检查上一根蜡烛的 EMA 数值：
     - 快 EMA 高于慢 EMA → 多头环境。
     - 快 EMA 低于慢 EMA → 空头环境。
3. **挂单规则**
   - 多头环境下，在最近摆动低点与高点之间的 57% 回撤位置挂出买入限价单。
   - 空头环境下，在最近摆动高点与低点之间的对称 57% 回撤位置挂出卖出限价单。
   - 止损设置在相对的 ZigZag 摆动点，止盈距离等于止损距离乘以 `TP 系数`（默认 1.2）。
   - 挂单最多保留 `信号后等待的K线数` 根蜡烛，超时自动撤单以等待新机会。
4. **持仓管理**
   - 挂单成交后，策略在随后的蜡烛上监控价格，若达到止损或止盈水平即以市价平仓。做空仓位采取镜像逻辑。
   - 可通过工作日参数限制具体交易日；在禁用的日期里会撤销所有挂单，但不会强制平掉已有仓位，以保持与原始 EA 一致。

## 参数说明
| 名称 | 说明 |
|------|------|
| `Volume Per Trade` | 每次入场提交的下单数量。 |
| `TP Multiplier` | 止盈距离与止损距离的倍数关系。 |
| `ZigZag Depth` | 计算摆动时参考的蜡烛数量。 |
| `ZigZag Deviation` | ZigZag 确认新摆动所需的最小偏差（点数）。 |
| `ZigZag Backstep` | 相邻不同方向摆动之间至少需要的蜡烛数。 |
| `Wait Bars After Signal` | 挂单在市场中保持的最长蜡烛数量。 |
| `Fast EMA` | 快速指数移动平均线的周期。 |
| `Slow EMA` | 慢速指数移动平均线的周期。 |
| `Allow Monday … Allow Friday` | 各个工作日的启用或禁用开关。 |
| `Candle Type` | 策略用于分析的蜡烛类型。 |

## 备注
- 斐波那契比率固定为 57%，与源 EA 完全一致。
- 止损与止盈在蜡烛收盘时检查，若盘中突破阈值，则在下一次评估时通过市价单离场。
- 策略任意时刻仅维持一个挂单，确保逻辑与原始实现保持一致。
