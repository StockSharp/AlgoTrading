# Стратегия Tuyul Uncensored

## Общее описание
Tuyul Uncensored — это адаптация одноимённого советника MetaTrader 5 на платформу StockSharp. Стратегия отслеживает новые вершины и впадины индикатора ZigZag, определяет направление тренда по паре экспоненциальных средних и выставляет лимитный ордер на уровне 57% от последнего ценового импульса. Стоп-лосс и тейк-профит рассчитываются автоматически по ширине текущего зигзага, что позволяет торговать откат в сторону доминирующего движения.

## Логика работы
1. **Подготовка данных**
   - Подписка на один поток свечей, задаваемый параметром `Тип свечей`.
   - Индикатор ZigZag с параметрами глубины, отклонения и шага назад фиксирует последние подтверждённые экстремумы.
   - Быстрая и медленная EMA (по умолчанию 9 и 21) служат трендовым фильтром.
2. **Формирование сигнала**
   - При появлении нового зигзага обновляется пара «последний максимум — последний минимум».
   - Если нет активных ордеров и открытых позиций, анализируются значения EMA на предыдущей свече:
     - Быстрая EMA выше медленной — рассматривается покупка.
     - Быстрая EMA ниже медленной — рассматривается продажа.
3. **Размещение ордера**
   - В бычьем сценарии выставляется **buy limit** на уровне 57% между последним минимумом и максимумом.
   - В медвежьем сценарии размещается **sell limit** на зеркальном уровне между максимумом и минимумом.
   - Стоп-лосс располагается у противоположного экстремума ZigZag, тейк-профит равен дистанции стопа, умноженной на параметр `TP Multiplier` (по умолчанию 1.2).
   - Лимитный ордер действует не более `Числа свечей ожидания после сигнала`; по истечении срока он отменяется.
4. **Сопровождение позиции**
   - После исполнения ордера стратегия контролирует закрытия свечей: при достижении стоп-лосса или тейк-профита позиция закрывается рыночным ордером. Для коротких позиций используется зеркальная логика.
   - Торговлю можно ограничить по дням недели. В неразрешённые дни все отложенные ордера снимаются, а открытые позиции сохраняются — так же, как в исходном советнике.

## Параметры
| Имя | Описание |
|-----|----------|
| `Volume Per Trade` | Объём заявки для каждого входа. |
| `TP Multiplier` | Множитель тейк-профита относительно дистанции стоп-лосса. |
| `ZigZag Depth` | Количество свечей, используемое для поиска экстремумов. |
| `ZigZag Deviation` | Минимальное отклонение (в пунктах) для подтверждения нового зигзага. |
| `ZigZag Backstep` | Минимальный шаг между противоположными экстремумами. |
| `Wait Bars After Signal` | Максимальное число свечей удержания лимитного ордера. |
| `Fast EMA` | Период быстрой экспоненциальной средней. |
| `Slow EMA` | Период медленной экспоненциальной средней. |
| `Allow Monday … Allow Friday` | Флаги разрешения торговли по дням недели. |
| `Candle Type` | Тип свечей, по которым ведутся расчёты и торговые решения. |

## Особенности
- Фиксированное соотношение 57% соответствует оригинальному алгоритму.
- Контроль уровней стоп-лосса и тейк-профита выполняется на закрытиях свечей, поэтому резкие внутридневные колебания приводят к выходу при следующей проверке.
- Стратегия одновременно держит только один лимитный ордер, что повторяет поведение исходного советника.
