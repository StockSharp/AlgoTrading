# Стратегия Ten Points 3 v005

## Обзор
Стратегия переносит советник MetaTrader 4 «10points 3 v005» в инфраструктуру StockSharp. Направление определяется наклоном основной линии MACD: восходящее значение запускает длинную серию усреднений, нисходящее — короткую. В версии v005 добавлены временные фильтры, ограничения по капиталу и возможность отключить одну из сторон торговли.

## Логика торговли
- Определить направление по сравнению текущего и предыдущего значения MACD. Параметр `ReverseSignals` позволяет инвертировать интерпретацию.
- Открыть первую рыночную позицию сразу после появления сигнала. Далее добавлять ордера через каждые `EntryDistancePips` пунктов движения против открытой позиции.
- Объём каждого последующего ордера рассчитывается по схеме мартингейла с множителем `MartingaleFactor` (или `HighTradeFactor`, если допускается больше 12 сделок). Объёмы округляются к шагу инструмента и ограничиваются 100 лотами.
- При каждом входе обновляются общие уровни стоп-лосса и тейк-профита. Стартовые значения задаются параметрами `InitialStopPips` и `TakeProfitPips`, а трейлинг-стоп активируется после прохождения `EntryDistancePips + TrailingStopPips` пунктов.
- Блок защиты капитала может выровнять целевой уровень по лучшей цене входа (`ReboundLock`) и закрыть последний ордер при достижении прибыли `SecureProfit`.
- Дополнительные предохранители закрывают корзину при убытке `StopLossAmount`, превышении целевой прибыли `ProfitTarget + ProfitBuffer` или падении капитала ниже `StartProtectionLevel`.
- Торговля ведётся только в интервале `OpenHour`–`CloseHour`; по умолчанию работа по пятницам отключается (`CloseOnFriday`).

## Управление капиталом
При выключенном `UseMoneyManagement` используется фиксированный объём `LotSize`. Если параметр активен, базовый объём вычисляется из текущей стоимости портфеля и `RiskPercent`. Переключатель `IsStandardAccount` задаёт расчёт для стандартного или мини-счёта.

## Параметры
| Параметр | Описание |
|----------|----------|
| `TakeProfitPips` | Расстояние тейк-профита для каждой позиции. |
| `LotSize` | Базовый размер ордера при фиксированном объёме. |
| `InitialStopPips` | Начальное расстояние стоп-лосса. |
| `TrailingStopPips` | Расстояние трейлинг-стопа после активации. |
| `MaxTrades` | Максимальное количество ордеров в корзине. |
| `EntryDistancePips` | Минимальное движение против позиции для нового входа. |
| `SecureProfit` | Порог плавающей прибыли (в валюте) для защитного выхода. |
| `UseAccountProtection` | Включает блок защиты капитала. |
| `OrdersToProtect` | Число последних ордеров, защищаемых правилом прибыли. |
| `ReverseSignals` | Инверсия сигнала MACD. |
| `UseMoneyManagement` | Включает расчёт объёма по капиталу. |
| `RiskPercent` | Процент риска в формуле money management. |
| `IsStandardAccount` | Использовать стандартный или мини-лот. |
| `EurUsdPipValue` и т.д. | Стоимость пункта для расчёта прибыли. |
| `CandleType` | Таймфрейм свечей для сигнала. |
| `MacdFastLength`, `MacdSlowLength`, `MacdSignalLength` | Настройки MACD. |
| `EnableLong`, `EnableShort` | Разрешение длинных/коротких корзин. |
| `OpenHour`, `CloseHour`, `MinuteToStop` | Временное окно торговли. |
| `StopLossProtection`, `StopLossAmount` | Глобальный стоп по капиталу. |
| `ProfitTargetEnabled`, `ProfitTarget`, `ProfitBuffer` | Фиксация прибыли по капиталу. |
| `StartProtectionEnabled`, `StartProtectionLevel` | Минимальный уровень капитала. |
| `ReboundLock` | Выравнивание целей по лучшему входу. |
| `MartingaleFactor`, `HighTradeFactor` | Множители мартингейла. |
| `CloseOnFriday` | Отключение торговли по пятницам. |

## Примечания
- Реализация использует высокоуровневый API StockSharp, что упрощает подписку на свечи и индикаторы.
- Все защитные механизмы закрывают корзину рыночными заявками, имитируя логику оригинального советника.
- Перед использованием на реальном счёте убедитесь, что параметры соответствуют спецификациям вашего брокера (шаг цены, стоимость пункта, допустимые объёмы).
