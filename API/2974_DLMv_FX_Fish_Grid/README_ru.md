# DLMv FX Fish Grid Strategy

## Обзор

**DLMv FX Fish Grid Strategy** переносит логику одноимённого советника из MetaTrader. В основе лежит осциллятор «FX Fish 2MA»: на выбранную цену применяется преобразование Фишера, результат сглаживается скользящей средней и при пересечении индикатора с его средней на нужной стороне от нулевой линии генерируются торговые сигналы. Управление позициями повторяет «сеточный» подход оригинала — дополнительные входы выполняются с заданным интервалом, при необходимости автоматически выставляются лимитные ордера, а риск контролируется защитными параметрами.

## Алгоритм торговли

1. **Расчёт индикатора**
   - Максимум и минимум за `CalculatePeriod` свечей формируют рабочий диапазон.
   - К цене, определяемой параметром `AppliedPrice`, применяется преобразование Фишера с коэффициентом сглаживания 0.67, как в исходном MQL-скрипте.
   - Простая скользящая средняя (`MaPeriod`) от значения Фишера используется как базовая линия.
2. **Условия входа**
   - **Покупка**: две последовательные величины Фишера ниже нуля, текущая пересекает скользящую среднюю снизу вверх.
   - **Продажа**: две последовательные величины Фишера выше нуля, текущая пересекает среднюю сверху вниз.
   - При включении `ReverseSignals` условия зеркально инвертируются.
3. **Выставление ордеров**
   - По сигналу стратегия при необходимости закрывает противоположные позиции (`CloseOpposite`).
   - Количество добавочных входов ограничивается `MaxTrades`, причём каждый новый вход допускается только при соблюдении дистанции `DistancePips` от последней сделки.
   - Опция `SetLimitOrders` автоматически размещает лимитные ордера на том же расстоянии, формируя «сетку» как в оригинальном советнике.
4. **Защита позиций**
   - Параметры `StopLossPips`, `TakeProfitPips`, `TrailingStopPips` и `TrailingStepPips` переводятся в абсолютные значения через `StartProtection` и устанавливают стоп-лосс, тейк-профит и трейлинг.
   - `TimeLiveSeconds` задаёт максимальное время удержания позиции; по истечении лимита все ордера закрываются и снимаются.
   - Если `TradeOnFriday` отключён, то в пятницу стратегия прекращает торговлю и закрывает остаточные позиции.

## Параметры

| Параметр | Описание |
|----------|----------|
| `OrderVolume` | Объём каждой сделки (в лотах). |
| `StopLossPips` | Расстояние до стоп-лосса в пунктах (0 — без стопа). |
| `TakeProfitPips` | Расстояние до тейк-профита в пунктах (0 — без тейка). |
| `TrailingStopPips` | Дистанция трейлинг-стопа (0 — отключён). |
| `TrailingStepPips` | Шаг подтяжки трейлинг-стопа. |
| `MaxTrades` | Максимальное количество одновременных сделок в одном направлении (0 — без ограничения). |
| `DistancePips` | Минимальная дистанция между входами и шаг для лимитных ордеров сетки. |
| `TradeOnFriday` | Разрешение торговли по пятницам. При значении `false` позиции закрываются в день пятницы. |
| `TimeLiveSeconds` | Максимальное время жизни позиции в секундах. |
| `ReverseSignals` | Инверсия логики входа. |
| `SetLimitOrders` | Автоматическое размещение лимитных ордеров на заданном расстоянии. |
| `CloseOpposite` | Закрытие встречных позиций перед открытием новой сделки. |
| `CalculatePeriod` | Длина окна для расчёта диапазона Фишера. |
| `MaPeriod` | Период скользящей средней по значению Фишера. |
| `AppliedPrice` | Тип цены для преобразования (close, open, high, low, median, typical, weighted). |
| `CandleType` | Тип/таймфрейм свечей, которые использует стратегия. |

## Дополнительные замечания

- Преобразование пунктов в абсолютные значения выполняется как `Security.PriceStep * 10`, что соответствует обработке пятизначных котировок в MQL-версии.
- Все лимитные ордера автоматически отменяются при смене сигнала, запрете торговли в пятницу или срабатывании тайм-аута `TimeLiveSeconds`.
- Для определения пересечений стратегия хранит предыдущие значения Фишера и его скользящей средней, избегая дорогостоящих запросов к истории индикатора.
