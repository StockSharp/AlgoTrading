# Стратегия Blau C-Momentum

## Описание
Стратегия представляет собой порт советника MetaTrader **Exp_BlauCMomentum** на платформу StockSharp. Алгоритм использует свечи выбранного таймфрейма и рассчитывает тройное сглаженное значение Blau C-Momentum в одном из двух режимов:

- **Breakdown (пробой нуля)** — реагирует на пересечение индикатором уровня 0.
- **Twist (поворот)** — реагирует на изменение наклона сглаженного момента.

Индикатор может строиться по различным типам цен. Ордера открываются по рынку, при необходимости автоматически выставляются стоп-лосс и тейк-профит.

## Логика работы
1. Подписаться на свечи заданного таймфрейма.
2. Рассчитать Blau C-Momentum:
   - Базовый момент — разница между двумя прикладными ценами, разделёнными `MomentumLength` барами.
   - Результат проходит три последовательных сглаживания выбранным типом скользящей и масштабируется к размеру шага цены.
3. Сохранить историю индикатора, чтобы использовать смещения `SignalBar`.
4. Сформировать сигналы:
   - **Breakdown** — если предыдущий бар был выше нуля, а сигнальный бар ≤0 — открываем/переворачиваемся в лонг; если предыдущий бар был ниже нуля, а сигнальный ≥0 — открываем/переворачиваемся в шорт. Флаги закрытия (`EnableLongExit`, `EnableShortExit`) закрывают противоположные позиции при тех же условиях.
   - **Twist** — сравниваем два предыдущих бара. Ускорение вверх и подтверждение сигнального бара инициирует покупку, ускорение вниз — продажу.
5. Объём сделки определяется параметрами `MoneyManagement` и `MarginMode`. Отрицательное значение — фиксированный объём. Введена временная блокировка повторных входов до следующей свечи.

## Параметры
- `MoneyManagement` — доля капитала (или фиксированный лот при отрицательном значении).
- `MarginMode` — режим интерпретации money management (`FreeMarginShare`, `BalanceShare`, `FreeMarginRisk`, `BalanceRisk`). Режимы риска используют `StopLossPoints` и `Security.StepPrice`.
- `StopLossPoints`, `TakeProfitPoints` — расстояние до стоп-лосса/тейк-профита в шагах цены.
- `SlippagePoints` — допустимое проскальзывание (для совместимости, реальные заявки — рыночные).
- `EnableLongEntry`, `EnableShortEntry` — разрешение на открытие длинных/коротких позиций.
- `EnableLongExit`, `EnableShortExit` — разрешение на закрытие позиций по сигналам.
- `EntryMode` — режим работы (`Breakdown` или `Twist`).
- `CandleType` — таймфрейм для расчёта индикатора.
- `SmoothingMethod` — метод сглаживания (Simple, Exponential, Smoothed, LinearWeighted, Jurik, TripleExponential, Adaptive).
- `MomentumLength`, `FirstSmoothLength`, `SecondSmoothLength`, `ThirdSmoothLength`, `Phase` — параметры расчёта момента и сглаживания.
- `PriceForClose`, `PriceForOpen` — используемые прикладные цены.
- `SignalBar` — смещение по барам для генерации сигналов (0 — текущая закрытая свеча).

## Использование
1. Настройте подключение, портфель и инструмент в StockSharp.
2. Создайте экземпляр `BlauCMomentumStrategy`, укажите `Security`, `Portfolio` и нужные параметры.
3. Вызовите `Start()` — стратегия подпишется на свечи, начнёт расчёт индикатора и выставление ордеров.
4. При ненулевых `StopLossPoints`/`TakeProfitPoints` автоматически включается защита позиций через высокоуровневый API.

## Особенности
- Параметры money-management адаптированы под инфраструктуру StockSharp, поэтому расчёт свободной маржи приближен.
- Сложные методы сглаживания из оригинальной библиотеки (Parabolic, VIDYA, JurX) заменены ближайшими по смыслу индикаторами (`TripleExponential` ≈ Tillson T3, `Adaptive` ≈ KAMA).
- Значение `SlippagePoints` сохранено для справки, но заявки отправляются по рынку.

## Предупреждение о рисках
Стратегия предоставляется «как есть» и предназначена для обучения. Перед использованием на реальном счёте протестируйте алгоритм на исторических данных и в демо-режиме, а также адаптируйте параметры под собственные ограничения по риску.
