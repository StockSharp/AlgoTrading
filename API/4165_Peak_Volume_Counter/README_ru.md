# Стратегия Peak Volume Counter
[English](README.md) | [中文](README_cn.md)

**Peak Volume Counter** — это порт на StockSharp утилиты MetaTrader 4 из файла `MQL/9514/AIS7PVC.MQ4`. Стратегия не выставляет заявок и предназначена для мониторинга. Она отслеживает поток тиков и фиксирует импульсы суммарного объёма, которые могут предшествовать росту волатильности или выходу новостей. Логика полностью повторяет оригинальный индикатор «Peak Volume Counter» и сохраняет цветовые зоны в виде текстовых меток серьёзности.

## Как работает

1. При запуске стратегия сбрасывает счётчики, последний зафиксированный торговый ценник и таймер окна накопления.
2. Выполняется подписка на поток тиков (`DataType.Ticks`). Каждый пришедший трейд увеличивает накопленный объём. Если биржа не передаёт объём в сообщении, прибавляется единица, что соответствует подсчёту тикового объёма в MetaTrader.
3. Первый трейд задаёт начало окна накопления. Все последующие сделки расширяют окно, пока сумма объёма не достигнет порога.
4. Как только накопленный объём достигает или превышает параметр `VolumeThreshold` (по умолчанию `7`), стратегия записывает сообщение в лог: номер события, объём, длительность окна, последнюю цену, серверное и локальное время и текстовую метку серьёзности, соответствующую прежней цветовой шкале.
5. После фиксации оповещения счётчики обнуляются, и начинается отслеживание следующего окна. Это позволяет фиксировать серии всплесков без пропусков при переходе через границы минутных свечей.

Таким образом воспроизводится оригинальная MQL-реализация, которая анализировала тиковый объём соседних минутных свечей и выделяла сильные импульсы. Работа напрямую по тикам устраняет задержки, связанные с ожиданием закрытия свечи.

## Параметры

| Имя | Описание | Значение по умолчанию | Доступна оптимизация |
| --- | --- | --- | --- |
| `VolumeThreshold` | Минимальный суммарный объём, необходимый для формирования сигнала. После сигнала накопление начинается заново. | `7` | Да (5 → 20, шаг 1) |

## Оповещения

Сообщения пишутся через журнал стратегии (`LogInfo`). Пример строки:

```
Peak volume #3: volume 11 (yellow), window 4.5s, price 1.2345, server 2024-05-01T12:34:56.7890000Z, local 2024-05-01T15:34:56.7900000+03:00.
```

Текстовые уровни серьёзности соответствуют исходной цветовой градации:

| Метка | Диапазон исходного цвета | Интерпретация |
| --- | --- | --- |
| `red` | 7 – 8 тиков | Минимальный всплеск, сигнал к наблюдению. |
| `orange` | 9 – 10 тиков | Умеренное ускорение потока сделок. |
| `yellow` | 11 – 12 тиков | Повышенная активность, свидетельствует о росте интереса. |
| `lawn green` | 13 – 14 тиков | Высокая активность, часто предвещает пробой. |
| `aqua` | 15 – 16 тиков | Очень мощный поток, требующий внимания. |
| `blue` | 17 – 18 тиков | Редкие импульсы, обычно связаны с крупными событиями. |
| `violet` | 19+ тиков | Экстремальный всплеск, указывающий на серьёзный дисбаланс ликвидности. |

Длительность окна — это время между первой и последней сделкой, попавшей в импульс. При некорректной хронологии таймстампов значение принудительно обрезается до нуля, чтобы исключить отрицательные длительности.

## Рекомендации по использованию

- Подключайте стратегию к источнику реальных тиков. Без потока сделок оповещения не появятся.
- Из-за отсутствия торговых действий стратегию безопасно запускать на реальных подключениях как аналитический инструмент.
- Настраивайте `VolumeThreshold` под ликвидность выбранного инструмента: для малоликвидных активов порог можно снизить, для фьючерсов и основных валютных пар — повысить.
- Порт сохраняет непрерывное накопление объёма и не зависит от закрытия свечей, поэтому сигналы не задерживаются до конца бара.
- Используйте сообщения журнала для интеграции с собственными торговыми алгоритмами или панелями мониторинга, реагируя на текстовые уровни серьёзности.

