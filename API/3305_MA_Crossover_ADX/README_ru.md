# Стратегия MA Crossover ADX

## Общее описание
**MA Crossover ADX** — это перенос советника MetaTrader `MA_Crossover_ADX` на платформу StockSharp. Алгоритм объединяет наклон экспоненциальной скользящей средней и фильтрацию по индикатору Average Directional Index (ADX), чтобы торговать только в подтверждённых трендах. Все вычисления выполняются по завершённым свечам выбранного таймфрейма, а обработка EMA и ADX синхронизируется внутри одной свечи, исключая ложные сигналы из‑за рассинхронизации данных. При открытии позиции стратегия автоматически выставляет защитные стоп‑лосс и тейк‑профит на основе заданных дистанций в пунктах.

## Используемые индикаторы
- **EMA:** основной трендовый фильтр. Хранятся три последних значения EMA, что позволяет вычислять текущий и предыдущий наклон — прямой аналог условий `StateEMA(0)` и `StateEMA(1)` из оригинального советника.
- **ADX:** предоставляет основную линию силы тренда и направления DI+/DI-. Разница между DI+ и DI- соответствует условию `StateADX(0)`, а минимальный уровень ADX гарантирует, что сделки заключаются только при достаточной силе тренда.
- **Ряд закрытий:** предыдущее закрытие сравнивается с предыдушим значением EMA, что подтверждает отрыв цены от скользящей средней перед входом в позицию.

Все индикаторы работают на единой подписке свечей. Сигналы генерируются только тогда, когда и EMA, и ADX предоставили финальные значения для одной и той же свечи.

## Правила торговли
### Вход в длинную позицию
1. Текущий наклон EMA (`EMA[0] - EMA[1]`) положительный.
2. Предыдущий наклон EMA (`EMA[1] - EMA[2]`) также положительный, что подтверждает ускорение тренда.
3. Предыдущее закрытие выше значения EMA на предыдущей свече.
4. Основная линия ADX превышает заданный порог.
5. Значение DI+ больше DI-, т.е. доминирует восходящее направление.

При выполнении условий и отсутствии открытых позиций стратегия отправляет рыночную заявку на покупку с заданным объёмом. Если открыта короткая позиция, она закрывается при появлении длинного сигнала.

### Вход в короткую позицию
1. Текущий наклон EMA отрицательный.
2. Предыдущий наклон EMA также отрицательный.
3. Предыдущее закрытие ниже значения EMA на предыдущей свече.
4. ADX превышает пороговое значение.
5. DI- больше DI+, что указывает на преобладание нисходящего движения.

При выполнении всех условий и отсутствии открытых позиций отправляется рыночная заявка на продажу. При наличии длинной позиции она закрывается.

### Выход и риск-менеджмент
- **Закрытие лонга:** при выполнении условий для короткой позиции.
- **Закрытие шорта:** при выполнении условий для длинной позиции.
- **Защитные приказы:** метод `StartProtection` рассчитывает уровни стоп‑лосса и тейк‑профита, умножая настроенные дистанции на `PriceStep` инструмента, и выставляет их автоматически, что соответствует параметрам `StopLoss` и `TakeProfit` исходного советника.

## Параметры
| Параметр | Значение по умолчанию | Описание |
| --- | --- | --- |
| `AdxPeriod` | 33 | Количество баров в расчёте ADX. |
| `AdxThreshold` | 22 | Минимальное значение ADX для подтверждения тренда. |
| `EmaPeriod` | 39 | Период экспоненциальной скользящей средней. |
| `StopLossPoints` | 400 | Дистанция стоп‑лосса в пунктах (умножается на `PriceStep`). |
| `TakeProfitPoints` | 900 | Дистанция тейк‑профита в пунктах. |
| `TradeVolume` | 0.1 | Объём заявки при открытии новой позиции. |
| `CandleType` | Свечи 1 часа | Таймфрейм, по которому рассчитываются индикаторы. |

## Рекомендации по использованию
- Убедитесь, что у инструмента задан `PriceStep`. Если шаг цены неизвестен, стратегия использует значение `1`, чтобы защитные приказы всё равно могли быть рассчитаны.
- Все параметры отмечены как доступные для оптимизации (`SetCanOptimize(true)`), что упрощает подбор настроек при тестировании.
- Комментарии в исходном коде написаны на английском языке согласно требованиям репозитория.
