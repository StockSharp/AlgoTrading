# Стратегия Double MA Crossover

## Обзор

Стратегия переносит советник «DoubleMA Crossover» из MetaTrader в инфраструктуру StockSharp. Она отслеживает две простые скользящие средние, ожидает их пересечения и подтверждает сигнал пробоем цены на заданное количество пунктов. Одновременно допускается только одна позиция, а система управления риском включает три варианта трейлинг-стопа, полностью соответствующие оригинальной реализации.

## Логика работы

1. **Поиск сигнала** – на выбранном таймфрейме рассчитываются две SMA (по умолчанию 2 и 5). Пересечение быстрой средне вверх через медленную формирует лонговый сигнал, вниз – шортовый.
2. **Подтверждение пробоем** – после пересечения сохраняется уровень пробоя, смещённый от цены закрытия на `BreakoutPips`. Сделка открывается только тогда, когда последующие свечи достигают этого уровня, что имитирует стоп-заявки в MetaTrader.
3. **Управление позицией** – одновременно активна лишь одна позиция. Внутренние переменные моделируют исполнение стоп-лоссов и тейк-профитов, что обеспечивает воспроизводимость в тестах.
4. **Фильтр по времени** – новые сигналы формируются только в интервале `StartHour`..`StopHour`, если включён `UseTimeLimit`. Действующие позиции продолжают сопровождаться вне торгового окна.
5. **Трейлинг-стопы** – доступны три режима: немедленное сопровождение на дистанцию исходного стопа, трейлинг после прохождения `TrailingStopPips` и трёхуровневый алгоритм с переходом в классический трейлинг.

## Параметры

| Параметр | Описание |
|----------|----------|
| `FastMaPeriod`, `SlowMaPeriod` | Периоды быстрой и медленной SMA. |
| `BreakoutPips` | Смещение цены пробоя в шагах цены. |
| `StopLossPips`, `TakeProfitPips` | Размер стоп-лосса и тейк-профита в шагах цены. Значение 0 отключает тейк-профит. |
| `UseTrailingStop` | Включение трейлинг-стопа. |
| `TrailingMode` | Тип сопровождения: Type1 – расстояние исходного стопа, Type2 – фиксированная дистанция `TrailingStopPips`, Type3 – трёхуровневый режим. |
| `TrailingStopPips` | Дистанция для режима Type2. |
| `Level1TriggerPips`, `Level1OffsetPips` | Первый уровень и смещение для режима Type3. |
| `Level2TriggerPips`, `Level2OffsetPips` | Второй уровень и смещение. |
| `Level3TriggerPips`, `Level3OffsetPips` | Третий уровень и смещение, после чего включается плавающий трейлинг. |
| `UseTimeLimit`, `StartHour`, `StopHour` | Настройки торгового окна. |
| `CandleType` | Тип свечей для расчётов. |
| `TradeVolume` | Объём заявки в лотах. |

## Режимы трейлинг-стопа

- **Type1** – переносит стоп на расстояние исходного стоп-лосса после прохождения цены на эту величину.
- **Type2** – ждёт, пока цена пройдёт `TrailingStopPips`, затем фиксирует прибыль на данной дистанции.
- **Type3** – триггеры уровнями `Level1/2/3`, два первых шага позволяют выйти в ноль и зафиксировать часть прибыли, третий превращает стоп в скользящий.

## Рекомендации по использованию

- Настройте `BreakoutPips` с учётом шага цены инструмента, чтобы повторить поведение оригинального советника.
- Для круглосуточных инструментов выключите фильтр времени (`UseTimeLimit = false`), для дневной торговли скорректируйте часы.
- При использовании режима Type3 следите, чтобы смещения не превышали соответствующие уровни, иначе стоп может остаться за точкой входа.
- Стратегия не накапливает позиции; если требуется пирамидинг, добавьте дополнительную логику.
