# Стратегия пересечения EMA 5/8

## Описание
**Стратегия пересечения EMA 5/8** повторяет работу советника MetaTrader `5_8macrossv2.mq4`, сопоставляя две настраиваемые скользящие средние по одному инструменту. Бычье пересечение быстрой скользящей над медленной открывает длинную позицию, медвежье пересечение открывает короткую. Перенос использует высокоуровневый API StockSharp и добавляет управление рисками (тейк-профит, стоп-лосс, трейлинг-стоп).

## Торговая логика
- На выбранном таймфрейме рассчитываются две скользящие средние. По умолчанию используется 5-периодная экспоненциальная средняя по ценам закрытия и 8-периодная экспоненциальная средняя по ценам открытия.
- Когда быстрая средняя пересекает медленную снизу вверх на последней завершённой свече, стратегия открывает или разворачивает длинную позицию. Если открыта короткая позиция, её объём добавляется к рыночному ордеру на покупку для разворота.
- Когда быстрая средняя пересекает медленную сверху вниз, стратегия аналогично открывает или разворачивает короткую позицию.
- Параметры сдвига смещают сигналы на заданное количество закрытых свечей. Отрицательные значения приводятся к нулю, так как значения «из будущего» недоступны при онлайновом расчёте.

## Управление рисками
- **Тейк-профит** и **стоп-лосс** задаются в пунктах (шагах цены). При открытии позиции целевые уровни рассчитываются от цены входа. Для коротких позиций логика симметрична.
- **Трейлинг-стоп** также задаётся в пунктах и подтягивается в сторону прибыли только в благоприятную сторону (вверх для лонга, вниз для шорта).
- Если на завершённой свече достигается любой защитный уровень (хай достигает тейк-профита, лоу — стоп-лосса или трейлинг-стопа), позиция закрывается рыночным ордером, а внутреннее состояние стратегии сбрасывается.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `TradeVolume` | `decimal` | `0.1` | Объём ордера при открытии. При развороте добавляется абсолютная величина текущей позиции. |
| `TakeProfitPips` | `decimal` | `40` | Расстояние до тейк-профита в пунктах. `0` отключает уровень. |
| `StopLossPips` | `decimal` | `0` | Расстояние до стоп-лосса в пунктах. `0` отключает уровень. |
| `TrailingStopPips` | `decimal` | `0` | Дистанция трейлинг-стопа в пунктах. `0` отключает подтягивание. |
| `FastPeriod` | `int` | `5` | Период быстрой скользящей средней. |
| `FastShift` | `int` | `-1` | Горизонтальный сдвиг быстрой средней. Отрицательные значения приводятся к нулю. |
| `FastMethod` | `MovingAverageMethod` | `Exponential` | Тип сглаживания быстрой средней: Simple, Exponential, Smoothed, LinearWeighted. |
| `FastPrice` | `AppliedPrice` | `Close` | Цена свечи для расчёта быстрой средней. |
| `SlowPeriod` | `int` | `8` | Период медленной скользящей средней. |
| `SlowShift` | `int` | `0` | Горизонтальный сдвиг медленной средней. |
| `SlowMethod` | `MovingAverageMethod` | `Exponential` | Тип сглаживания медленной средней. |
| `SlowPrice` | `AppliedPrice` | `Open` | Цена свечи для расчёта медленной средней. |
| `CandleType` | `DataType` | `TimeSpan.FromMinutes(30).TimeFrame()` | Тип свечей, используемых в расчётах. |

## Примечания
- Расчёты выполняются только по завершённым свечам, что предотвращает ложные сигналы.
- Защитные уровни рассчитываются через `Security.PriceStep`. Если шаг цены не задан, параметры управления рисками не активируются.
- Версия на Python намеренно не создавалась в рамках задания.
