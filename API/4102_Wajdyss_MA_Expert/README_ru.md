# Стратегия Wajdyss MA Expert

## Обзор
**Wajdyss MA Expert** — это порт на C# советника MetaTrader 4 «wajdyss MA expert v3». Стратегия сравнивает две скользящие средние с независимыми периодами, методами расчёта, сдвигами и типами цен. Пересечение быстрой средней над медленной открывает длинную позицию, обратное пересечение — короткую. Реализация повторяет исходное управление капиталом, опциональное автоматическое закрытие встречных сделок и фильтры принудительного закрытия в конце дня и недели.

## Логика торговли
1. Подписаться на выбранный `CandleType` (по умолчанию 15-минутные свечи) и рассчитать быстрый и медленный мувинги с указанными параметрами `MovingAverageMethod` и `PriceSource` для каждой линии.
2. Хранить значения индикаторов только для завершённых свечей. Формировать бычий сигнал, когда быстрая средняя (с учётом её `Shift`) находится выше медленной на последней закрытой свече и ниже две свечи назад; для медвежьего сигнала условия обратные.
3. Между сделками одного направления выдерживать паузу не менее одной свечи выбранного таймфрейма — аналог MT4-версии, где использовались глобальные переменные времени.
4. При включённом **AutoCloseOpposite** сначала отменять активные заявки и разворачивать позицию одной рыночной сделкой. Новый объём включает текущую противоположную позицию, что обеспечивает мгновенный разворот.
5. Применять дневной и пятничный фильтры. После наступления `DailyCloseHour`/`DailyCloseMinute` или `FridayCloseHour`/`FridayCloseMinute` все позиции закрываются, новые сделки не открываются до следующей сессии.

## Риск-менеджмент и объём
- Параметры **TakeProfitPips**, **StopLossPips** и **TrailingStopPips** задаются в целых пунктах. Они автоматически переводятся в ценовые шаги инструмента и передаются в `StartProtection`, чтобы повторить поведение стопов и трейлинга оригинального советника.
- Включённый **UseMoneyManagement** воспроизводит формулу MT4: `объём = (баланс / BalanceReference) * InitialVolume`. Далее объём приводится к шагу и попадает в диапазон между минимально и максимально допустимыми значениями инструмента.
- При отключённом управлении капиталом используется фиксированный объём **InitialVolume**.

## Параметры
| Параметр | Тип | Значение по умолчанию | Описание |
|----------|-----|-----------------------|----------|
| `FastPeriod` | `int` | `10` | Период быстрой скользящей средней. |
| `FastShift` | `int` | `0` | Сдвиг быстрой средней при сравнении значений. |
| `FastMethod` | `MovingAverageMethod` | `Ema` | Метод сглаживания быстрой средней (`Sma`, `Ema`, `Smma`, `Lwma`). |
| `FastPriceType` | `PriceSource` | `Close` | Тип цены для быстрой средней (`Close`, `Open`, `High`, `Low`, `Median`, `Typical`, `Weighted`). |
| `SlowPeriod` | `int` | `20` | Период медленной скользящей средней. |
| `SlowShift` | `int` | `0` | Сдвиг медленной средней. |
| `SlowMethod` | `MovingAverageMethod` | `Ema` | Метод сглаживания медленной средней. |
| `SlowPriceType` | `PriceSource` | `Close` | Тип цены для медленной средней. |
| `TakeProfitPips` | `decimal` | `100` | Дистанция до тейк-профита в пунктах (0 — отключено). |
| `StopLossPips` | `decimal` | `50` | Дистанция до стоп-лосса в пунктах (0 — отключено). |
| `TrailingStopPips` | `decimal` | `0` | Ширина трейлинг-стопа в пунктах (0 — отключено). |
| `AutoCloseOpposite` | `bool` | `true` | Закрывать противоположные позиции перед открытием новой. |
| `InitialVolume` | `decimal` | `0.1` | Базовый объём сделки до применения мани-менеджмента. |
| `UseMoneyManagement` | `bool` | `true` | Включить динамический расчёт объёма от баланса. |
| `BalanceReference` | `decimal` | `1000` | Делитель баланса при расчёте динамического объёма. |
| `DailyCloseHour` | `int` | `23` | Час (0-23), после которого позиции закрываются каждый день. |
| `DailyCloseMinute` | `int` | `45` | Минута ежедневного закрытия. |
| `FridayCloseHour` | `int` | `22` | Час окончания торговли в пятницу (0-23). |
| `FridayCloseMinute` | `int` | `45` | Минута окончания торговли в пятницу. |
| `CandleType` | `DataType` | Таймфрейм 15 минут | Свечи, используемые для расчётов и контроля паузы между сделками. |

## Примечания
- Используется только высокоуровневый API StockSharp: свечи приходят через `SubscribeCandles`, индикаторы связаны напрямую, а `StartProtection` управляет стопами, тейками и трейлингом.
- Позиции закрываются рыночными заявками, что повторяет немедленное закрытие ордеров в версии MT4.
- Python-реализация отсутствует; в каталоге представлена только C# стратегия.
