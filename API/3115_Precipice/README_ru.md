# Стратегия Precipice

## Обзор
Стратегия Precipice является прямой конверсией советника MetaTrader *Precipice (barabashkakvn's edition)*. Система не анализирует рынок и не использует индикаторы: она дожидается закрытия предыдущей позиции и бросает «монетку», чтобы решить, открывать ли длинную или короткую сделку. Если разрешены оба направления, каждая завершённая свеча при отсутствии позиции даёт 50%-й шанс на появление новой сделки. Дополнительные защитные заявки повторяют логику оригинального советника, устанавливая одинаковое расстояние стоп-лосса и тейк-профита в «пунктах» для каждой сделки.

Порт на StockSharp сохраняет случайный характер оригинала и его параметры управления риском. Расстояние в пунктах автоматически переводится в родной ценовой шаг инструмента, благодаря чему стоп-лосс и тейк-профит остаются симметричными независимо от количества знаков после запятой.

## Логика торговли
1. Подписаться на серию свечей, заданную параметром `CandleType`, и обрабатывать только закрытые свечи, чтобы синхронизироваться с поведением MetaTrader после завершения бара.
2. Игнорировать сигналы, пока у стратегии есть открытая позиция. Советник допускает только одну позицию.
3. Когда позиции нет, сгенерировать случайное число для длинного сценария. Если включён `UseBuy` и число меньше 0.5, отправить рыночную заявку на покупку объёмом `TradeVolume`.
4. Если длинная сделка не открыта, сгенерировать новое случайное число для короткого сценария. При включённом `UseSell` и значении больше 0.5 отправить рыночную заявку на продажу.
5. После открытия позиции разместить при необходимости стоп-лосс и тейк-профит на расстоянии `StopLossTakeProfitPips` пунктов от цены закрытия свечи. Защитные заявки автоматически отменяются, когда позиция возвращается к нулю.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `CandleType` | `DataType` | Таймфрейм 1 минута | Основной временной интервал, обрабатываемый стратегией. |
| `TradeVolume` | `decimal` | `1` | Объём каждой рыночной заявки. |
| `StopLossTakeProfitPips` | `int` | `100` | Расстояние (в пунктах MetaTrader) между ценой входа и обоими защитными ордерами. Значение `0` отключает постановку стоп-лосса и тейк-профита. |
| `UseBuy` | `bool` | `true` | Разрешить случайные покупки. |
| `UseSell` | `bool` | `true` | Разрешить случайные продажи. |

## Отличия от оригинального советника MetaTrader
- В MetaTrader доступны уровни freeze и минимальная дистанция стопов; версия на StockSharp выполняет только преобразование пунктов и полагается на брокера в части проверки минимально допустимых расстояний.
- Оригинальный код использует текущие цены Bid/Ask. В StockSharp защитные ордера рассчитываются от цены закрытия свечи, поскольку высокоуровневый API предоставляет агрегированные свечи; учёт спреда и проскальзывания следует реализовывать отдельными механизмами.
- MetaTrader оперирует отдельными тикетами, тогда как StockSharp управляет чистой позицией. Перенос также ограничивает количество позиций одной и снимает защитные ордера при полном закрытии.

## Рекомендации по использованию
- Подберите `TradeVolume` в соответствии с минимальным шагом объёма инструмента. Конструктор также присваивает это значение свойству `Strategy.Volume`, чтобы вспомогательные методы выставляли заявки с нужным объёмом.
- Настройте `StopLossTakeProfitPips` под волатильность инструмента. Стратегия умножает количество пунктов на ценовой шаг бумаги (для трёх- и пятизначных котировок применяется соответствующий коэффициент), чтобы получить реальное ценовое расстояние.
- При необходимости ограничить торговлю одним направлением оставьте активным только `UseBuy` или `UseSell`.
- Из-за случайного характера входов имеет смысл дополнительно контролировать риски внешними фильтрами или ограничением времени удержания позиции.

## Индикаторы
- Отсутствуют. Стратегия опирается исключительно на случайную генерацию сделок и необязательные защитные ордера.
