# Развороты по пин-барам

## Описание
Стратегия представляет собой C# порт советника MetaTrader **«Reversals With Pin Bars»**. Оригинальный алгоритм ищет
свечи с длинными тенями (пин-бары) и подтверждает сигнал фильтрами по моментуму, тренду на старшем таймфрейме через
линейно-взвешенные скользящие средние (LWMA), а также направлением MACD. Версия для StockSharp сохраняет эту
мульти-таймфреймовую структуру, использует только встроенные индикаторы и предоставляет ключевые параметры управления
риском.

Реализация опирается на высокоуровневый API StockSharp: основной таймфрейм генерирует входы, а дополнительные подписки
поставляют данные старших таймфреймов. Управление риском выполняется в пунктах (pips) и включает опциональный трейлинг
и перевод стопа в безубыток.

## Условия входа
- **Пин-бар**: предыдущая завершённая свеча должна иметь тень не менее 50% от полного диапазона.
  - Для покупок анализируется длинная верхняя тень («повешенный» из оригинала).
  - Для продаж требуется доминирующая нижняя тень.
- **Фильтр тренда**: на старшем таймфрейме быстрая LWMA (`FastMaPeriod`) должна быть выше/ниже медленной (`SlowMaPeriod`).
- **Фильтр моментума**: любое из трёх последних значений моментума на старшем таймфрейме должно отклоняться от 100 более,
  чем `MomentumThreshold`.
- **Фильтр MACD**: основная линия MACD должна находиться выше/ниже сигнальной на своём таймфрейме.
- **Ограничение объёма**: суммарная позиция не превышает `MaxTrades * Volume`; каждое новое срабатывание использует
  согласованный объём `Volume`.

## Управление риском
- **Стоп/профит**: фиксированное расстояние в пунктах (`StopLossPips`, `TakeProfitPips`) от цены входа.
- **Перевод в безубыток**: при включении стоп переносится на `entry ± BreakEvenOffsetPips`, когда прибыль достигает
  `BreakEvenTriggerPips`.
- **Трейлинг-стоп**: при включении держится на расстоянии `TrailingStopPips` от последнего закрытия.
- **Принудительное закрытие**: при достижении стопа или цели позиция закрывается рыночным ордером целиком.

## Параметры
| Параметр | Значение |
| --- | --- |
| `TradeVolume` | Объём заявки, выровненный по шагу инструмента. |
| `MaxTrades` | Максимальный суммарный объём по одному направлению. |
| `StopLossPips` | Размер стоп-лосса в пунктах. |
| `TakeProfitPips` | Размер тейк-профита в пунктах. |
| `EnableTrailing` / `TrailingStopPips` | Включение трейлинг-стопа и его расстояние. |
| `EnableBreakEven` / `BreakEvenTriggerPips` / `BreakEvenOffsetPips` | Настройки перевода стопа в безубыток. |
| `FastMaPeriod` / `SlowMaPeriod` | Периоды быстрых и медленных LWMA старшего таймфрейма. |
| `MomentumPeriod` / `MomentumThreshold` | Параметры индикатора Momentum. |
| `MacdFastPeriod` / `MacdSlowPeriod` / `MacdSignalPeriod` | Настройки MACD. |
| `CandleType` | Основной тип свечей для поиска пин-баров. |
| `HigherCandleType` | Свечи для расчёта LWMA и моментума. |
| `MacdCandleType` | Свечи для расчёта MACD. |

## Отличия от версии MetaTrader
- Убраны денежные цели, трейлинг и эквити-стопы; контроль риска выполняется через пункты.
- Проверки по графическим объектам (фрактальные линии) заменены индикаторными фильтрами.
- Исключены уведомления (алерты, письма, push); оставлена только торговая логика.

## Рекомендации по применению
1. Привяжите стратегию к нужному инструменту и портфелю, подберите три таймфрейма под вашу торговую модель.
2. Убедитесь, что шаг цены инструмента соответствует понятию «пункт» (по умолчанию используется 0.0001).
3. Запустите стратегию: при закрытии свечей автоматически управляются стопы, цели, трейлинг и безубыток.
4. Корректируйте параметры моментума и LWMA в зависимости от волатильности инструмента.
