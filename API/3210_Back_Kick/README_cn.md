# Back Kick 策略

**Back Kick** 是从 MetaTrader 5 专家顾问 `Back kick.mq5` 移植而来的对冲突破策略。每当一根 K 线收盘时，系统会立即以相同的手数同时买入和卖出，从而保持双向敞口。每条腿都按照设定的点数间距应用对称的止损和止盈。由于 StockSharp 默认采用净头寸模式，移植版本通过内部状态对象分别跟踪多头和空头，使其表现尽可能接近 MT5 的对冲账户。

## 交易流程

1. 订阅所选周期的 K 线。当检测到新 K 线收盘且当前没有激活的对冲腿时，请求建立新的买卖组合。
2. 立即发送一张买入市价单和一张卖出市价单，使用相同的成交量。根据点数参数计算每条腿的保护价位。
3. 通过 Level 1 中的最优买价和卖价实时监控仓位。如果价格触发保护水平，则发送对向市价单平掉该腿，而另一条腿保持不变直至触发自己的退出条件。
4. 当两条腿全部平仓后，策略会等待下一根 K 线收盘，再次重建对冲。

这种行为与原始 EA 保持一致——通过始终持有双向仓位来捕捉价格的突然“反弹”。

## 参数

| 名称 | 说明 | 默认值 | 备注 |
| ---- | ---- | ------ | ---- |
| `OrderVolume` | 每条对冲腿的交易量。 | `0.1` | 会根据品种的 `VolumeStep` 归一化，同时检查 `MinVolume`/`MaxVolume` 限制。 |
| `StopLossPips` | 止损点数。 | `50` | 设置为 `0` 时禁用止损。 |
| `TakeProfitPips` | 止盈点数。 | `140` | 设置为 `0` 时禁用固定止盈。 |
| `CandleType` | 触发开仓的 K 线周期。 | `15m` | 支持任意可用的 `TimeFrame`。 |
| `LogDiagnostics` | 是否输出详细日志。 | `false` | 建议在调试成交顺序时启用。 |

## 实现细节

- **点值换算**：原 EA 会针对 3/5 位小数的品种放大 10 倍点值，移植版本沿用相同规则（价格步长 × 10）。
- **手工维护对冲**：由于 StockSharp 只记录净头寸，策略使用 `PositionState` 来跟踪每条腿，并在需要时发送市价单关闭对应仓位，从而模拟 MT5 的对冲模式。
- **风控**：止损和止盈均为可选项。若关闭，仓位仅会在另一条腿的保护水平触发或外部干预时被动退出。
- **保护服务**：仍然调用 `StartProtection()`，以便框架在断线等异常情况下可以接管仓位管理。

## 使用步骤

1. 将策略挂载到具备 Level 1（买卖价）和所需 K 线数据的标的上。
2. 根据风险偏好配置点数距离与下单手数。
3. 启动策略后，它会等待下一根 K 线收盘，然后提交买卖一对的市价单。
4. 通过日志或图表观察多头与空头分别如何独立退出。

## 与 MT5 版本的差异

- 未移植按风险百分比动态计算手数的功能，请直接通过 `OrderVolume` 设置仓位。
- 由于 StockSharp 的净头寸特性，对冲是通过内部记录实现的，因此在不同经纪商或撮合模式下仍能保持与原策略相近的行为。
- 未实现经纪商特定的 `FreezeLevel`/`StopsLevel` 检查；当交易所限制被违反时，体积归一化逻辑会抛出明确的异常。

## 文件说明

- `CS/BackKickStrategy.cs` —— C# 版本的策略实现。
- `README.md` —— 英文文档。
- `README_ru.md` —— 俄文文档。
- `README_cn.md` —— 中文文档（本文件）。
