# Стратегия E-Friday

## Общее описание
- Конвертирует эксперт `E-Friday.mq5` под высокоуровневый API StockSharp.
- Работает только на таймфреймах не выше **H1**. При превышении периода выводит предупреждение и не торгует.
- Использует контртрендовый вход: медвежья свеча открывает покупку, бычья свеча — продажу.
- Полностью отключает торговлю по пятницам, сохраняя защиту выходных из оригинала.
- Ограничивает работу по времени и может принудительно закрывать позиции после заданного часа.

## Логика торговли
1. После формирования каждой свечи стратегия проверяет биржевое время:
   - в пятницу торговля пропускается;
   - до часа начала стратегия находится в ожидании;
   - если активирован час закрытия и текущий час его превышает, все позиции закрываются и новые сигналы игнорируются.
2. При разрешённой торговле сигнал формируется по последней завершённой свече:
   - `Open > Close` (медвежья свеча) — готовится длинная позиция;
   - `Open < Close` (бычья свеча) — готовится короткая позиция;
   - равные `Open` и `Close` отменяют действие.
3. Перед открытием нового направления все текущие позиции закрываются, поэтому одновременно существует только одна позиция.

## Управление позицией
- **Объём** — берётся из параметра `TradeVolume` и используется в заявках `BuyMarket`/`SellMarket`.
- **Стоп-лосс и тейк-профит** — задаются в пунктах. Размер пункта рассчитывается по `Security.PriceStep` и умножается на `10` при 3 или 5 знаках после запятой, как в исходном советнике.
- **Трейлинг-стоп** — активируется после движения цены на `TrailingStopPips + TrailingStepPips` в сторону позиции и подтягивает стоп на `цена - trailing` (для лонга) или `цена + trailing` (для шорта).
- Закрытия оцениваются по экстремумам свечей:
  - длинная позиция закрывается при касании стопа минимумом или тейк-профита максимумом;
  - короткая — при касании стопа максимумом или тейк-профита минимумом.
- После наступления часа закрытия (`UseCloseHour = true`) все позиции закрываются рыночными ордерами.

## Параметры
| Параметр | Описание |
| --- | --- |
| `CandleType` | Тип свечей. Должен задавать положительный интервал и не превышать один час. |
| `TradeVolume` | Торговый объём в лотах. Значение должно быть > 0. |
| `StopLossPips` | Расстояние до стоп-лосса в пунктах. Ноль отключает стартовый стоп. |
| `TakeProfitPips` | Расстояние до тейк-профита в пунктах. Ноль отключает цель. |
| `TrailingStopPips` | Размер трейлинг-стопа в пунктах. Работает вместе с `TrailingStepPips`. |
| `TrailingStepPips` | Минимальное дополнительное движение (в пунктах) для подтягивания стопа. Должно быть > 0 при включённом трейлинге. |
| `StartHour` | Час (биржевое время), начиная с которого разрешены сделки. |
| `UseCloseHour` | Включает/отключает принудительное закрытие после времени окончания. |
| `EndHour` | Час (биржевое время), после которого стратегия закрывает позиции и не открывает новые. |

## Особенности реализации
- Использует `SubscribeCandles` и `Bind`, что облегчает добавление индикаторов в будущем.
- Проверяет корректность настроек трейлинг-стопа при запуске: шаг должен быть положительным, если трейлинг включён.
- Пересчёт пунктов полностью повторяет формулу советника (`PriceStep * 10` для трёх- и пятизнаковых инструментов).
- Вариант на StockSharp оценивает стопы и цели по завершившимся свечам. В MQL-версии проверки выполнялись на каждом тике, поэтому закрытия могут отличаться на несколько тиков, но логика идентична.
- Метод `CloseActivePosition` реализует ожидаемое закрытие после окончания торгового окна (в исходнике соответствующий код не выполнялся из-за раннего `return`).
- Используются информационные логи (`AddInfoLog`, `AddWarningLog`), чтобы в интерфейсе было видно, почему стратегия пропустила сигнал.
