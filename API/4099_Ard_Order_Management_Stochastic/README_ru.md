# Стратегия ARD Order Management Stochastic

## Обзор
**Ard Order Management** — порт MetaTrader-советника `ARD_ORDER_MANAGEMENT_EA-BETA_1` на платформу StockSharp. Исходная версия была сосредоточена на дисциплине "сначала закрыть, потом открыть" и предоставляла вспомогательные процедуры для ручной корректировки стопов и тейков. Перенос сохранил эту философию и дополнил её автоматическим генератором сигналов на основе осциллятора Стохастик.

Базовая конфигурация рассчитана на работу с пятиминутными свечами по валютным парам, однако тип свечей можно выбрать любой. Расчёты выполняются только по завершённым барам, что полностью соответствует стилю оригинального эксперта.

## Торговая логика
- Используется стохастический осциллятор с настраиваемыми периодами (по умолчанию 5/3/3).
- Если %K закрывается **выше порога покупок** (80), стратегия отменяет активные заявки, полностью закрывает шорт и открывает длинную позицию указанным объёмом.
- Если %K закрывается **ниже порога продаж** (20), отменяются заявки, закрывается лонг и открывается новая короткая позиция.
- Позиция удерживается до появления противоположного сигнала или срабатывания защитных механизмов.

## Управление ордерами и риском
- Перед любым новым входом выполняется принудительное закрытие текущей позиции рыночным ордером — аналог ветки `open_order(CLOSE)` из MQL-версии.
- Метод `StartProtection` автоматически выставляет стартовые стоп-лосс и тейк-профит на расстояниях, заданных параметрами `StopLossPips` и `TakeProfitPips`.
- Опциональная trailing-логика повторяет поведение блока `MODIFY`: после закрытия каждой свечи пересчитываются динамические уровни стопа (`ModifyStopLossPips`) и плавающего тейка (`ModifyTakeProfitPips`). При касании любого уровня позиция немедленно закрывается, что позволяет зафиксировать прибыль или ограничить убыток.
- Пересчёт пунктов выполняется по шагу цены инструмента (`PriceStep`) с поправкой на дробные пункты, благодаря чему параметры расстояний корректно переносятся между разными рынками.

## Параметры
- **Volume** — объём новой позиции; при развороте автоматически добавляется количество, необходимое для закрытия противоположной стороны.
- **TakeProfitPips / StopLossPips** — стартовые уровни фиксации прибыли и ограничения убытка (в пунктах). Нулевое значение отключает соответствующий ордер.
- **ModifyTakeProfitPips / ModifyStopLossPips** — параметры динамического обновления тейка и стопа. Нулевое значение выключает trailing.
- **StochasticPeriod / SignalPeriod / SlowingPeriod** — настройки стохастика, соответствующие аргументам функции `iStochastic` в MQL-скрипте.
- **BuyThreshold / SellThreshold** — границы перекупленности/перепроданности, активирующие вход в покупку или продажу.
- **CandleType** — тип свечей, используемый для расчётов.

Каждый параметр снабжён адекватным диапазоном оптимизации, что упрощает подбор настроек в оптимизаторе StockSharp.

## Рекомендации по применению
- Наилучшие результаты достигаются на ликвидных инструментах с чётким шагом цены (основные FX-пары, индексные CFD, популярные фьючерсы).
- Для менее волатильных рынков стоит увеличить таймфрейм, чтобы снизить количество ложных разворотов.
- Перед запуском на реальном счёте убедитесь, что выбранный объём соответствует минимальным требованиям брокера.
- Если trailing не нужен, оставьте параметры `Modify*` равными нулю — стратегия будет работать как классический вариант исходного эксперта.
- При необходимости легко добавить фильтры по тренду, волатильности или торговым сессиям: необходимые свойства уже вынесены в публичные параметры.

## Подробности конверсии
- Исходный файл: `MQL/9041/ARD_ORDER_MANAGEMENT_EA-BETA_1.mq4`.
- Воссоздана логика стохастического индикатора, упомянутая в закомментированных строках функции `start()`.
- Поведение по закрытию позиций и постановке защитных ордеров реализовано через высокоуровневый API StockSharp.
- Добавлены необязательные trailing-выходы, которые отражают ручной режим `MODIFY`, но работают в полностью событийной модели.
