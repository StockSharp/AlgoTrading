# Стратегия Signal Count With Array
[English](README.md) | [中文](README_cn.md)

Стратегия повторяет логику советника MetaTrader 4 `Signal-COunt-with array.mq4`.
Она отслеживает экстремумы канала Дончиана для набора ценовых смещений и подсчитывает,
как часто индикатор меняет значение, возвращается к «пустому» значению или снова выдаёт
сигнал. Реализация сохраняет диагностический характер исходного скрипта: заявки не
выставляются, вместо этого стратегия выводит подробную статистику при появлении нового
максимума/минимума либо при включённом построчном логировании.

## Концепция

- Вместо вызова `iCustom` индикатора `super_signals_v2_alert` используется канал Дончиана,
  который предоставляет максимум и минимум за `ChannelPeriod` свечей.
- Анализируется сетка смещений (`GapStart`, `GapStep`, `GapCount`), имитирующая перебор
  параметров в оригинальном советнике.
- Для каждого смещения ведутся шесть счётчиков, соответствующих массивам исходного кода,
  включая фиксацию переходов к пустым значениям (`2147483647` для верхнего буфера и
  `-2147483646` для нижнего).
- Результаты выводятся в виде таблицы, что позволяет быстро оценить, как часто буфер
  генерирует сигнал, очищается или покидает нулевое состояние.

## Параметры

| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | Таймфрейм 5 минут | Свечной поток для вычисления канала Дончиана. |
| `ChannelPeriod` | 24 | Количество свечей, используемых для определения экстремумов. |
| `GapStart` | 0 | Начальное смещение (в шагах цены), применяемое к виртуальным значениям сигнала. |
| `GapStep` | 1 | Шаг (в шагах цены) между соседними смещениями. |
| `GapCount` | 8 | Число анализируемых смещений (аналог цикла 0..7 в MQL). |
| `LogOnEachCandle` | false | Включает вывод статистики после каждой завершённой свечи. |

## Счётчики

Каждое смещение содержит две строки: индекс `0` отвечает за верхний буфер Дончиана
(бычий сигнал), индекс `1` — за нижний буфер (медвежий сигнал). Собираются следующие
показатели:

- **Changed** — значение индикатора отличается от предыдущего наблюдения.
- **Empty** — буфер вернул положительный «пустой» sentinel `2147483647`.
- **NegEmpty** — количество отрицательных sentinel `-2147483646` (актуально для нижнего буфера).
- **Zero** — переход от значения по умолчанию 0 к любому ненулевому значению.
- **NewFromEmpty** — реальный сигнал заменил sentinel.
- **BackToEmpty** — буфер вернулся к sentinel после периода с ненулевым значением.

Эти счётчики полностью соответствуют массивам `GetInd_iCustom_changed`, `GetInd_iCustom_maxInt`,
`GetInd_iCustom_minInt` и т.д. в исходном советнике.

## Логирование

Диагностические сообщения формируются методом `AddInfoLog` в двух случаях:

1. Когда верхняя граница Дончиана повышается или нижняя граница снижается, что означает новый экстремум.
2. После каждой завершённой свечи, если параметр `LogOnEachCandle` установлен в `true`.

Каждая запись начинается с времени свечи, далее перечисляются счётчики для всех смещений, что
позволяет сравнивать поведение различных конфигураций индикатора.

## Рекомендации

- Стратегия использует только исторические свечи и не отправляет заявок — её можно подключать к любому инструменту.
- Подбирайте `ChannelPeriod` под волатильность инструмента: увеличение периода делает сигналы более редкими, как в MT4.
- При необходимости наблюдать больше смещений увеличьте `GapCount`. При запуске массивы автоматически пересоздаются.
- Комбинируйте печать статистики с графическим отображением (свечи + канал Дончиана), чтобы визуально сопоставлять
  логи с рыночной структурой.
