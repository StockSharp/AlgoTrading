# Стратегия Hans123 Trader

## Описание
Hans123 Trader — портированная в StockSharp версия советника *Hans123_Trader* для MetaTrader 5. Алгоритм отслеживает диапазон из `RangeLength` свечей, в торговом окне выставляет отложенные стоп-заявки на пробой границ диапазона и управляет позицией через стоп-лосс, тейк-профит и трейлинг.

## Логика работы
1. Подписка на выбранный тип свечей и ожидание заполнения окна из `RangeLength` баров.
2. На каждой завершённой свече:
   - Пересчитываются максимум и минимум последнего диапазона.
   - Если текущее время находится вне интервала `[StartHour, EndHour)`, все отложенные заявки снимаются и новые не выставляются.
   - Внутри торгового окна снимаются старые заявки и размещаются новые:
     - **Buy Stop** на верхней границе диапазона объёмом `OrderVolume`;
     - **Sell Stop** на нижней границе диапазона объёмом `OrderVolume`.
3. При открытии позиции:
   - Противоположный ордер отменяется, чтобы исключить хеджирование.
   - В зависимости от настроек выставляются защитные стоп- и лимит-заявки.
4. В процессе сопровождения сделки:
   - Как только цена проходит расстояние `TrailingStopPips + TrailingStepPips`, защитный стоп подтягивается на расстояние `TrailingStopPips` в направлении прибыли.
   - При закрытии позиции все защитные ордера снимаются, внутреннее состояние сбрасывается.

## Параметры
| Параметр | Назначение | Значение по умолчанию |
| --- | --- | --- |
| `OrderVolume` | Объём входа при пробое. | `0.1` |
| `RangeLength` | Количество свечей в диапазоне. | `80` |
| `StopLossPips` | Размер стоп-лосса в пунктах (0 — отключено). | `50` |
| `TakeProfitPips` | Размер тейк-профита в пунктах (0 — отключено). | `50` |
| `TrailingStopPips` | Базовое расстояние трейлинг-стопа в пунктах (0 — без трейлинга). | `10` |
| `TrailingStepPips` | Дополнительное смещение, после которого трейлинг обновляется; должно быть > 0 при активном трейлинге. | `5` |
| `StartHour` | Час (UTC) начала торгового окна, включительно. | `6` |
| `EndHour` | Час (UTC) окончания торгового окна, не включается. | `10` |
| `CandleType` | Тип и таймфрейм свечей. | `1 час` |

## Практические замечания
- Размер пункта вычисляется динамически: для инструментов с 3 или 5 знаками после запятой применяется десятикратная поправка.
- Если стоп-лосс отключён, трейлинг-стоп создаёт защитный ордер только после прохождения ценой активационного расстояния.
- Следите за соответствием `OrderVolume` торговым ограничениям выбранного портфеля и инструмента.
- В стратегию встроена отрисовка свечей, диапазона и сделок для визуального контроля.

## Отличия от версии MT5
- Используются высокоуровневые методы StockSharp (`BuyStop`, `SellStop`, `SellLimit`, `BuyLimit`) вместо прямых MT5-запросов.
- Параметры оформлены через `StrategyParam`, что позволяет подключать оптимизацию без дополнительного кода.
- Отложенные заявки обновляются по событию закрытия свечи, так как в StockSharp обработка построена на свечном фиде.

## Рекомендации по использованию
1. Привяжите стратегию к нужному инструменту и портфелю, убедитесь, что таймфрейм соответствует исходным настройкам.
2. Отрегулируйте границы торгового окна и дистанции защитных ордеров под ликвидность конкретного рынка.
3. Запустите стратегию и контролируйте графические элементы (диапазон, сделки) для проверки корректности поведения.
4. При необходимости выполняйте оптимизацию параметров с использованием стандартных средств тестирования StockSharp.
