# Стратегия FT Bill Williams AO

## Описание
**FT Bill Williams AO** — порт MetaTrader 4-советника `FT_BillWillams_AO`, опубликованного на FORTRADER.RU. Алгоритм сочетает
фракталы Билла Вильямса, индикатор «Аллигатор» и Awesome Oscillator для поиска пробоев ранних импульсов. Версия под StockSharp
сохраняет исходную логику, но работает с одной суммарной позицией, автоматически закрывая противоположные сделки при реверсе.

На каждом завершённом баре стратегия выполняет следующий цикл:
1. Выявляет бычий и медвежий фракталы на базе нечётного количества свечей.
2. Проверяет, что уровень фрактала находится выше/ниже линии зубов Аллигатора.
3. Оценивает трёхбарное ускорение Awesome Oscillator (условия `A>B`, `B<C` и знак значений).
4. Готовит уровень пробоя над/под максимумом или минимумом свечи с учётом параметра `IndentPoints` в пунктах MetaTrader.
5. Управляет позицией через исходные правила закрытия по челюсти (`CloseDropTeeth`), обратному сигналу (`CloseReverseSignal`) и
   трейлинг по методике Грагуса (`UseTrailing`).

## Вход в позицию
### Покупка
- Сформирован бычий фрактал и его максимум выше линии зубов Аллигатора.
- Значения AO на свечах `SignalShift+2`, `SignalShift+1` и `SignalShift` положительные и образуют восходящую последовательность.
- Уровень пробоя рассчитывается как `High[SignalShift] + IndentPoints * шаг_цены`.
- Если закрывшийся бар пробивает уровень и AO продолжает расти (`C > B`), открывается длинная позиция (или выполняется разворот).

### Продажа
- Сформирован медвежий фрактал, минимум ниже линии зубов.
- Значения AO отрицательны и удовлетворяют `A < B` и `B > C`.
- Уровень пробоя: `Low[SignalShift] - IndentPoints * шаг_цены`.
- При пробое уровня и сохранении снижения AO (`C < B`) стратегия открывает короткую позицию (либо переворачивается).

## Управление рисками и выход
- Стоп-лосс и тейк-профит задаются в пунктах MetaTrader и переводятся в цену через шаг инструмента.
- Параметр **CloseDropTeeth** позволяет закрывать позиции при пересечении челюсти текущим или предыдущим закрытием.
- **CloseReverseSignal** определяет, закрывать ли позицию при появлении противоположного фрактала или при активации встречного
  пробойного сигнала.
- **UseTrailing** включает трейлинг Грагуса: если губы растут быстрее вспомогательной SMA, стоп переносится на линию губ, иначе —
  на зубы. В обоих случаях требуется расстояние не менее 12 пунктов.

## Параметры
| Параметр | Описание |
| --- | --- |
| `TradeVolume` | Объём сделки в лотах, также записывается в `Strategy.Volume`. |
| `CandleType` | Тип и таймфрейм свечей. |
| `FractalPeriod` | Нечётное число баров для подтверждения фрактала (по умолчанию 5). |
| `IndentPoints` | Смещение уровня пробоя в пунктах MetaTrader. |
| `JawPeriod`, `TeethPeriod`, `LipsPeriod` | Периоды сглаженных средних Аллигатора. |
| `JawShift`, `TeethShift`, `LipsShift` | Сдвиг линий Аллигатора вперёд (в барах). |
| `CloseDropTeeth` | Правило закрытия по челюсти: отключено, текущее закрытие или предыдущее закрытие. |
| `CloseReverseSignal` | Реакция на противоположный сигнал: отключено, по новому фракталу, либо при готовом обратном пробое. |
| `UseTrailing` | Включение трейлинга по Грагусу. |
| `TrendSmaPeriod` | Период вспомогательной SMA в трейлинге. |
| `StopLossPoints` | Первичный стоп в пунктах MetaTrader (0 отключает). |
| `TakeProfitPoints` | Первичный тейк-профит в пунктах MetaTrader (0 отключает). |
| `SignalShift` | Сдвиг по готовым барам при чтении AO и максимумов/минимумов. |

## Дополнительно
- Стратегия использует `PriceStep` инструмента, при его отсутствии берётся `MinPriceStep`, далее — значение `0.0001`.
- В StockSharp ведётся единая позиция; разворот закрывает противоположный объём и открывает новую позицию.
- Рекомендуется оставлять `FractalPeriod` нечётным, как в оригинале (5 баров).
- Параметры `IndentPoints`, `StopLossPoints` и `TakeProfitPoints` соответствуют пунктам MT4. Подбирайте их с учётом точности котировок.
