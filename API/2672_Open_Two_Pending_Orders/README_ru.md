# Стратегия «Open Two Pending Orders»

## Общее описание
Стратегия повторяет логику одноимённого советника для MetaTrader: одновременно выставляет buy stop и sell stop ордера на одинаковом расстоянии от текущего спреда. Решение построено на высокоуровневых API StockSharp, подписывается на стакан, управляет заявками и контролирует риск. Как только один из ордеров исполняется, противоположная заявка отменяется, а открытая позиция сопровождается фиксированным стоп-лоссом, тейк-профитом и при необходимости трейлинг-стопом.

## Логика торговли
1. Подписаться на поток стакана и отслеживать лучшие цены Bid и Ask.
2. При отсутствии позиции или активных входящих ордеров вычислить объём сделки и выставить две стоп-заявки:
   - Buy stop по формуле `Ask + EntryOffsetPoints × PriceStep`.
   - Sell stop по формуле `Bid − EntryOffsetPoints × PriceStep`.
3. После исполнения стоп-ордера:
   - Отменить противоположную заявку;
   - Зафиксировать цену входа;
   - Рассчитать уровни стоп-лосса и тейк-профита в шагах цены относительно входа.
4. Пока позиция открыта, анализировать стакан:
   - Для лонгов закрывать позицию по рынку при достижении стоп-лосса или тейк-профита по Bid;
   - Для шортов закрывать по рынку при достижении уровней по Ask;
   - После движения цены в прибыльную сторону на величину трейлинг-стопа подтягивать стоп-уровень.
5. После закрытия позиции обнулить внутренние состояния и выставить новую пару встречных заявок.

Выходы выполняются рыночными приказами при касании защитных уровней, что позволяет сохранить поведение оригинального эксперта без прямой модификации заявок на сервере.

## Управление капиталом
Стратегия поддерживает две схемы расчёта объёма:
- **FixedVolume** — фиксированное количество контрактов, задаваемое параметром.
- **UseMoneyManagement** — расчёт объёма по текущей стоимости портфеля, проценту риска и расстоянию до стоп-лосса. Полученное значение округляется к шагу объёма инструмента и ограничивается допустимыми минимумом и максимумом.

## Параметры
| Параметр | Описание |
|----------|----------|
| `UseMoneyManagement` | Включает процентное управление риском. По умолчанию `true`. |
| `RiskPercent` | Доля портфеля, которую допускается потерять в одной сделке при включённом риск-менеджменте. По умолчанию `2`. |
| `FixedVolume` | Объём заявки при выключенном риск-менеджменте. По умолчанию `1`. |
| `StopLossPoints` | Расстояние до стоп-лосса в шагах цены. По умолчанию `100`. |
| `TakeProfitPoints` | Расстояние до тейк-профита в шагах цены. По умолчанию `300`. |
| `TrailingStopPoints` | Дистанция трейлинг-стопа в шагах цены. `0` отключает трейлинг. По умолчанию `50`. |
| `EntryOffsetPoints` | Смещение заявок от лучшей цены в шагах цены. По умолчанию `50`. |
| `SlippagePoints` | Резерв на проскальзывание в шагах цены (информационный параметр). По умолчанию `5`. |

## Дополнительные замечания
- Для корректной работы необходим поток стакана выбранного инструмента.
- Стоп-лосс и тейк-профит исполняются по рынку сразу после касания соответствующего уровня Bid/Ask.
- Трейлинг-стоп активируется только после движения цены в прибыльную сторону на заданную величину.
- Код оформлен в соответствии с требованиями проекта: табуляция, комментарии на английском языке и использование высокоуровневых методов StockSharp.
