# Стратегия BW WiseMan-1 (прорыв по Биллу Вильямсу)

Стратегия представляет собой порт MetaTrader-советника **Exp_BW-wiseMan-1** на платформу StockSharp. Она автоматизирует логику паттерна WiseMan-1: сделка формируется, когда завершившаяся свеча выходит за пределы линий «Аллигатора» Билла Вильямса и одновременно обновляет локальные максимумы или минимумы. Дополнительный режим «против тренда» меняет местами сигналы, позволяя торговать на отбой от тех же прорывов.

## Основная идея
- Рассчитать линии «Аллигатора» как сглаженные скользящие средние от медианной цены `(High + Low) / 2`.
- Сдвинуть челюсть, зубы и губы вперёд на заданное количество баров, чтобы сохранить визуализацию оригинального индикатора.
- Подтверждать прорыв только тогда, когда текущая свеча превосходит экстремумы последних `Back` баров, что отфильтровывает случайные шумы.
- Позволить задерживать исполнение на указанное число завершённых свечей параметром `SignalBar`.

## Правила торговли
### Сигналы на покупку
1. Максимум свечи должен находиться **ниже** всех трёх линий Аллигатора (челюсти, зубов и губ).
2. Закрытие обязано располагаться в верхней половине свечи, то есть выше её медианы.
3. Минимум текущей свечи должен быть строго ниже минимумов последних `Back` баров.
4. После того как сигнал становится активным:
   - При включённом параметре «Закрывать шорты» закрыть все короткие позиции.
   - При включённом параметре «Открывать лонги» и отсутствии позиций открыть новую длинную позицию.

### Сигналы на продажу
1. Минимум свечи должен находиться **выше** всех линий Аллигатора.
2. Закрытие располагается в нижней половине свечи, то есть ниже медианы.
3. Максимум текущей свечи превосходит максимумы последних `Back` баров.
4. После активации сигнала:
   - При включённом параметре «Закрывать лонги» закрыть все длинные позиции.
   - При включённом параметре «Открывать шорты» и нулевой позиции открыть новую короткую позицию.

### Режим против тренда
Если параметр «Counter-Trend Mode» включён, условия покупки и продажи меняются местами, и стратегия торгует против направления прорыва.

## Параметры
- **Candle Type** – таймфрейм, на котором строятся свечи и рассчитываются индикаторы (по умолчанию 1 час).
- **Counter-Trend Mode** – переключение в контртрендовый режим (по умолчанию включено, как в оригинальном советнике).
- **Breakout Depth (`Back`)** – количество предыдущих баров, по которым проверяется обновление экстремумов (по умолчанию 2).
- **Jaw Length / Shift** – период сглаженной средней для челюсти и величина сдвига вперёд (13 / 8 по умолчанию).
- **Teeth Length / Shift** – период и сдвиг для зубов (8 / 5).
- **Lips Length / Shift** – период и сдвиг для губ (5 / 3).
- **Signal Bar** – сколько завершённых свечей подождать перед исполнением сигнала (по умолчанию 1).
- **Enable Long / Enable Short** – разрешения на открытие длинных и коротких позиций.
- **Close Long / Close Short** – разрешения на закрытие противоположных позиций при появлении сигнала.

## Дополнительные замечания
- Стратегия использует рыночные заявки и не выставляет фиксированные стопы или тейк-профиты. Выход происходит только по встречным сигналам или при отключении соответствующих параметров.
- Все вычисления ведутся по завершённым свечам — внутрисессионные данные игнорируются, что соответствует поведению оригинального эксперта MT5.
- Размер позиции определяется общими настройками StockSharp. При необходимости измените базовый объём в конфигурации платформы.
