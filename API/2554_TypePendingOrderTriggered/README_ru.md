# Стратегия Type Pending Order Triggered
[English](README.md) | [中文](README_cn.md)

Утилитарная стратегия, повторяющая скрипт MetaTrader *TypePendingOrderTriggered.mq5*. Она не выставляет сделки самостоятельно,
а лишь отслеживает собственные исполнения и сообщает, какой тип отложенного ордера (Buy Limit, Sell Limit, Buy Stop или Sell Stop)
привёл к сделке.

## Обзор

- **Цель**: определить тип отложенного ордера, который сработал, когда одновременно работают несколько заявок разных типов.
- **Инструменты**: работает с любым инструментом, поддерживаемым StockSharp, поскольку берёт данные из `MyTrade.Order`.
- **Поддерживаемые типы ордеров**:
  - Buy Limit и Sell Limit (`OrderTypes.Limit` + сторона ордера).
  - Buy Stop и Sell Stop (`OrderTypes.Conditional` + сторона ордера).
  - Любой другой тип помечается предупреждением, чтобы было понятно, что исполнение пришло не по отложенному ордеру.
- **Вывод**: сообщения формируются через `AddInfoLog`. Их видно в журналах стратегии, консоли или любом подключённом логгере.

## Детали работы

1. После запуска стратегия просто ждёт собственных сделок, подписки на рыночные данные не требуются.
2. Каждый `MyTrade` анализируется только один раз. Внутренний набор `_reportedOrders` не позволяет дублировать сообщения при
   частичном исполнении ордера.
3. Определяется идентификатор заявки: сначала берётся биржевой `Id`, затем `TransactionId`.
4. Используя сторону (`Sides.Buy`/`Sides.Sell`) и `Order.Type`, стратегия формирует текст и выводит сообщение в английском стиле
   MetaTrader: *«The pending order {ticket} is found! Type of order is ...»*.
5. Если заявка была неотложенной (например, рыночной), выводится предупреждение, как и в оригинале.
6. Отсутствие ссылки на ордер также фиксируется предупреждением для упрощения диагностики.

## Практическое применение

- Запускайте стратегию вместе с ручной или автоматической логикой, которая выставляет отложенные заявки. Помощник зафиксирует
  первую сделку по каждой заявке и классифицирует её.
- Поскольку стратегия не вызывает `BuyMarket`/`SellMarket`, её можно подключить к действующему коннектору без риска лишних сделок.
- Сообщения помогают при анализе отчётов об исполнении и при миграции советников с MetaTrader на StockSharp.
- Сброс или остановка стратегии очищает кэш идентификаторов, поэтому при следующем запуске новые исполнения снова будут отмечены.

## Параметры

Дополнительные параметры отсутствуют. Поведение фиксировано и максимально близко к оригинальной логике MQL.

## Заметки по миграции

- В MetaTrader использовался цикл `HistoryOrderSelect`, здесь он не нужен, потому что StockSharp передаёт ссылку на ордер в каждом
  объекте `MyTrade`.
- Вместо `Print` применяются лог-функции StockSharp (`AddInfoLog`/`AddWarningLog`). Подключите их к удобной системе логирования для
  наилучшей видимости.
