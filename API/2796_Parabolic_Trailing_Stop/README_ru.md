# Стратегия Parabolic Trailing Stop

## Описание
**Parabolic Trailing Stop Strategy** — перенос эксперта MetaTrader `Parabolic_TrailingStop.mq5` на высокоуровневый API StockSharp. Стратегия не формирует точки входа, а служит модулем управления позицией: она автоматически подтягивает стоп-уровни по значениям индикатора Parabolic SAR, фиксируя прибыль и ограничивая просадку.

В реализации задействуются свечи, полученные через `SubscribeCandles`, и индикатор Parabolic SAR, подключённый методом `Bind`. Логика полностью повторяет MQL-версию, но оформлена в соответствии с требованиями проекта: используются параметры стратегии, отсутствуют прямые обращения к буферам индикаторов и коллекциям.

## Параметры
- **Candle Type** — таймфрейм свечей, по которым рассчитывается логика подтягивания стопа. По умолчанию 5-минутные свечи.
- **SAR Step** — шаг (ускорение) Parabolic SAR. Значение применяется и как стартовый коэффициент, и как приращение. По умолчанию `0.1`.
- **SAR Max** — максимально допустимое ускорение Parabolic SAR, ограничивающее рост/падение индикатора. По умолчанию `0.11`.

Все параметры объявлены через `StrategyParam<T>`, благодаря чему их можно оптимизировать в Designer или Backtester.

## Логика работы
1. **Отслеживание позиции**
   - После закрытия каждой свечи стратегия считывает текущее значение позиции.
   - При переходе из нуля в лонг/шорт или смене направления фиксируется время входа и сбрасываются предыдущие стоп-уровни.
2. **Расчёт стопа**
   - Используется значение Parabolic SAR для предыдущей свечи (аналог `Sar_array_base[1]` в MQL), а также её High/Low и время закрытия.
   - **Для лонга** стоп переносится на уровень SAR, если он выше средней цены входа, но ниже минимума предыдущей свечи, а время SAR позже времени входа. Стоп двигается только вверх.
   - **Для шорта** стоп переносится на уровень SAR, если он ниже средней цены входа, но выше максимума предыдущей свечи, и значение получено после входа. Стоп двигается только вниз.
3. **Исполнение стопа**
   - Когда текущая свеча пробивает соответствующий уровень (Low ниже стопа в лонге, High выше стопа в шорте), стратегия отменяет активные заявки, закрывает позицию по рынку и очищает сохранённые значения.
4. **Визуализация**
   - При наличии области графика отображаются свечи, линия Parabolic SAR и сделки для визуального контроля поведения стопа.

## Рекомендации
- Стратегия рассчитана на совместное использование с другими модулями входа или с вручную открытыми позициями.
- Поскольку расчёт ведётся по закрытию свечей, внутрисвечные движения не анализируются. Для более частых обновлений выбирайте меньший таймфрейм.
- В журнал выводятся сообщения о каждом обновлении и срабатывании стопа.
- В соответствии с требованиями текущей задачи Python-версия не создаётся.
