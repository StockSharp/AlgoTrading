# 抛物线SAR移动止损策略

## 概述
**抛物线SAR移动止损策略** 是将 MetaTrader 专家顾问 `Parabolic_TrailingStop.mq5` 迁移到 StockSharp 高级 API 的版本。策略本身不会生成买入或卖出信号，而是专注于在已有仓位的基础上使用抛物线 SAR 指标动态上调或下调止损线，从而锁定利润并控制风险。策略通过订阅蜡烛图数据、绑定抛物线 SAR 指标以及自动管理仓位，完整复刻了原脚本的行为。

## 参数
- **Candle Type（蜡烛类型）** – 用于计算移动止损的时间框架，默认值为 5 分钟。
- **SAR Step（SAR 步长）** – 抛物线 SAR 的加速步长，同时作为初始加速因子和每次递增的步幅，默认值 `0.1`。
- **SAR Max（SAR 最大值）** – 抛物线 SAR 的最大加速因子，用于限制指标的推进速度，默认值 `0.11`。

所有参数均通过 `StrategyParam<T>` 暴露，方便在 Designer 或 Backtester 中进行优化与调整。

## 移动止损逻辑
1. **仓位识别**
   - 每根已完成蜡烛结束时读取当前仓位。
   - 当仓位从空仓变为多头、空仓变为空头或方向反转时，记录蜡烛收盘时间作为入场时间，并清空之前的止损水平。
2. **止损水平计算**
   - 通过 `subscription.Bind(parabolicSar, ProcessCandle)` 绑定抛物线 SAR，指标值会自动与蜡烛同步传入回调。
   - 使用上一根蜡烛的指标值、高点、低点以及时间戳，模拟 MQL 中 `Sar_array_base[1]` 的用法。
   - **多头仓位**：如果上一根蜡烛的 SAR 值高于持仓均价且低于上一根蜡烛的最低价，并且 SAR 的时间戳晚于入场时间，则将多头止损提高到该 SAR 值。
   - **空头仓位**：如果上一根蜡烛的 SAR 值低于持仓均价且高于上一根蜡烛的最高价，并且 SAR 的时间戳晚于入场时间，则将空头止损下移到该 SAR 值。
   - 止损只会向有利方向移动（多头向上、空头向下），避免降低已有保护。
3. **止损执行**
   - 当前蜡烛的最低价跌破多头止损，或最高价突破空头止损时，策略会取消挂单、按市价平仓，并重置保存的止损与入场时间。
4. **图表支持**
   - 若环境允许，策略会绘制蜡烛图、抛物线 SAR 线以及成交标记，方便可视化跟踪。

## 使用提示
- 该策略定位为移动止损模块，可与其他入场策略组合使用，也可用于手动开仓后的风险控制。
- 策略基于已完成的蜡烛运行，蜡烛内部的瞬时波动不会触发逻辑，如需更精细的跟踪可选择更短的时间框架。
- 日志中会记录每一次止损调整与触发情况，方便核对运行状态。
- 根据项目要求，目前未提供 Python 版本。
