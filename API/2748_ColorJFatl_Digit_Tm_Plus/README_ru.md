# Стратегия ColorJFatl Digit TM Plus

## Общее описание

ColorJFatl Digit TM Plus — это перенос советника MetaTrader 5
*Exp_ColorJFatl_Digit_Tm_Plus* на платформу StockSharp. Стратегия работает с
цифровым фильтром FATL (Fast Adaptive Trend Line), сглаженным индикатором Jurik
Moving Average. Цветовая раскраска фильтра (рост, нейтрально, снижение)
используется для определения направления позиции: при смене цвета на закрытом
баре стратегия синхронизирует позицию с новым уклоном.

В реализации на StockSharp полностью сохранены ключевые особенности MQL
версии: сигналы формируются только после закрытия свечи, доступны
временные фильтры выхода, а параметр `TradeVolume` отвечает за размер
рыночной заявки.

## Логика сигналов

1. **Расчёт индикатора**
   - Цена проходит через цифровой фильтр FATL из 39 коэффициентов, как в
     оригинальном индикаторе.
   - Полученная серия сглаживается Jurik Moving Average. Параметры длины,
     используемой цены и округления управляются параметрами стратегии.
   - Цвет определяется знаком разности между текущим и предыдущим сглаженным
     значением: `2` — восходящий уклон, `0` — нисходящий, `1` — без изменений.

2. **Условия входа**
   - **Покупка** (`EnableBuyEntries`) выполняется, если цвет текущего бара стал
     `2`, а предыдущий цвет был меньше `2`. При активном `EnableSellExits`
     короткая позиция закрывается перед открытием длинной.
   - **Продажа** (`EnableSellEntries`) выполняется, если цвет текущего бара
     стал `0`, а предыдущий был больше `0`. При активном `EnableBuyExits`
     длинная позиция закрывается перед открытием короткой.
   - Одновременно может существовать только одна позиция. Заявки отправляются
     на закрытии подтверждающей свечи.

3. **Условия выхода**
   - **Разворот уклона** — при смене цвета на противоположный активные флаги
     `EnableBuyExits`/`EnableSellExits` закрывают позицию.
   - **Выход по времени** — при включенном `UseTimeExit` позиция закрывается
     после удержания в течение `HoldingMinutes` минут.
   - **Защитные уровни** — параметры `StopLossPoints` и `TakeProfitPoints`
     задают расстояние в шагах цены. На каждой свечe проверяются минимум и
     максимум относительно цены входа.

## Параметры

| Параметр | Описание |
|----------|----------|
| `TradeVolume` | Объём рыночной заявки. |
| `StopLossPoints` | Стоп-лосс в шагах цены (`0` отключает). |
| `TakeProfitPoints` | Тейк-профит в шагах цены (`0` отключает). |
| `EnableBuyEntries` / `EnableSellEntries` | Разрешение входов в длинные/короткие позиции. |
| `EnableBuyExits` / `EnableSellExits` | Разрешение выходов по изменению уклона. |
| `UseTimeExit` | Включение выхода по времени удержания. |
| `HoldingMinutes` | Время удержания позиции в минутах при активном таймере. |
| `CandleType` | Тип свечей для расчёта (по умолчанию 4 часа). |
| `JmaLength` | Длина сглаживания Jurik Moving Average. |
| `AppliedPrice` | Источник цены для фильтра (close, open, median, Demark и т. д.). |
| `RoundingDigits` | Количество знаков округления линии фильтра. |
| `SignalBar` | Номер закрытого бара, по которому оценивается состояние индикатора. |

## Дополнительные замечания

- Стратегия работает только с полностью сформированными барами, что удобно для
  тестирования на истории.
- Вариант `AppliedPrice.Demark` реализует формулу из оригинального индикатора.
- Поскольку заявки в StockSharp исполняются асинхронно, внутренняя фиксация
  цены входа обновляется при открытии позиции и сбрасывается при отправке
  заявки на выход.
