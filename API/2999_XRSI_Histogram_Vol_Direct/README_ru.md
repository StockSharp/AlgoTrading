# Стратегия XRSI Histogram Vol Direct

## Описание
- **Исходник**: `Exp_XRSI_Histogram_Vol_Direct.mq5`
- **Платформа**: StockSharp (C#), высокоуровневый API стратегий
- **Идея**: поиск разворотных сигналов по изменению наклона объёмно-взвешенного RSI-гистограммы
- **Инструменты**: один тикер, один таймфрейм (по умолчанию H4)

Реализация повторяет механику буферов цвета из оригинального эксперта MT5. Мы вычисляем RSI, умножаем его на выбранный объём, сглаживаем полученную серию и отслеживаем моменты, когда наклон изменяется с роста на падение либо наоборот. В зависимости от разрешений открываются/закрываются длинные и короткие позиции.

## Схема расчёта
1. **RSI** с периодом `RsiPeriod` вычисляется по подписанным свечам и смещается на −50, чтобы колебаться вокруг нуля.
2. **Источник объёма** выбирается параметром `Use Tick Volume`: при значении `true` используется тиковый объём, иначе — фактический объём свечи.
3. **Гистограмма** — произведение центрированного RSI и выбранного объёма, что усиливает движения при активной торговле.
4. **Сглаживание** — к гистограмме и объёму применяется одинаковое скользящее среднее (`SmoothLength`, тип `SMA`/`EMA`/`SMMA`/`WMA`). Работа продолжается только после формирования обоих сглаженных значений.
5. **Цвет наклона** определяется сравнением текущего и предыдущего сглаженных значений: рост → цвет `0`, падение → цвет `1`, равенство → сохранение предыдущего цвета.

## Параметры
| Параметр | Значение по умолчанию | Назначение |
| --- | --- | --- |
| Candle Type | H4 | Таймфрейм свечей для подписки. |
| RSI Period | 14 | Период RSI. |
| Smoothing Length | 12 | Длина скользящего среднего для RSI×Volume и объёма. |
| Smoothing Method | SMA | Тип скользящего среднего (`SMA`, `EMA`, `SMMA`, `WMA`). |
| Use Tick Volume | `true` | Использовать тиковый объём (`true`) или объём сделок (`false`). |
| Allow Buy Open | `true` | Разрешить открытие длинных позиций. |
| Allow Sell Open | `true` | Разрешить открытие коротких позиций. |
| Allow Buy Close | `true` | Разрешить закрытие длинных позиций при противоположном сигнале. |
| Allow Sell Close | `true` | Разрешить закрытие коротких позиций при противоположном сигнале. |

> **Важно**: экзотические методы сглаживания (JJMA, VIDYA, AMA и др.) отсутствуют в StockSharp, поэтому доступны только стандартные MA.

## Правила торговли
1. Дождаться формирования обоих сглаживающих индикаторов.
2. Считать цвета (наклон) двух последних завершённых свечей.
3. **Если предпоследний цвет = `0` (рост)**:
   - Закрыть короткую позицию (если разрешено).
   - Если последний цвет = `1` и разрешены покупки, открыть длинную позицию.
4. **Если предпоследний цвет = `1` (падение)**:
   - Закрыть длинную позицию (если разрешено).
   - Если последний цвет = `0` и разрешены продажи, открыть короткую позицию.

При каждом сигнале стратегия действует на закрытии новой свечи, не дожидаясь дополнительных подтверждений.

## Рекомендации по применению
- Подберите таймфрейм под инструмент: на более низких периодах сигналов больше, но и шум выше.
- Для ограничения риска подключите защиту через `StartProtection` (стоп-лосс/тейк-профит).
- Для отладки полезно сопоставить наклон гистограммы в StockSharp и в оригинальном индикаторе MT5.

## Отличия от MQL5 версии
- Отказались от функций money-management из `TradeAlgorithms.mqh`, объём заявок задаётся параметрами стратегии.
- Поддерживаются лишь те виды MA, которые есть в StockSharp; прочие варианты сведены к поведению SMA.
- Нет отдельной задержки `SignalBar`/`TimeShiftSec` — сделки исполняются сразу после закрытия свечи.
- Стопы/цели не зашиты жёстко, их добавляет пользователь при необходимости.

## Ограничения
- Необходимо наличие данных по объёму или тикам; без них амплитуда сигнала не совпадёт с оригиналом.
- Стратегия не рисует саму гистограмму, фокусируется на торговых решениях и опциональной визуализации RSI.
