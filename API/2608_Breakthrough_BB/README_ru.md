# Стратегия Breakthrough BB

## Общее описание
Стратегия Breakthrough BB переносит экспертный советник *Breakthrough_BB* из MetaTrader в инфраструктуру StockSharp. Алгоритм сочетает полосы Боллинджера и простую скользящую среднюю, чтобы фиксировать импульсные прорывы, возникающие после сжатия цены у границ канала. Сигналы формируются только на закрытых свечах, что полностью повторяет логику оригинала на MQL5.

## Логика торговли
- **Фильтр тренда.** Простая скользящая средняя (SMA) с настраиваемым периодом определяет преобладающее направление. Текущее значение SMA сравнивается со значением четырёх свечей назад. Для длинных сделок требуется восходящий наклон, для коротких — нисходящий.
- **Прорыв полос Боллинджера.** Стратегия анализирует, где находилась цена закрытия четыре свечи назад относительно верхней/нижней полосы, и сравнивает это с последним закрытием. Прорыв считается валидным, если цена переместилась изнутри канала за его пределы за указанный промежуток.
- **Одна позиция.** Алгоритм удерживает не более одной позиции одновременно. Любая открытая сделка закрывается до оценки новых входов, что предотвращает накопление позиций.

## Условия входа
### Покупка
1. Цена закрытия четыре свечи назад находилась ниже верхней полосы Боллинджера.
2. Последняя закрытая свеча завершилась выше текущей верхней полосы Боллинджера.
3. Значение SMA на последней свече больше значения SMA четырёх свечей назад (наклон вверх).
4. Открытых позиций нет.

### Продажа
1. Цена закрытия четыре свечи назад находилась выше нижней полосы Боллинджера.
2. Последняя закрытая свеча завершилась ниже текущей нижней полосы Боллинджера.
3. Значение SMA на последней свече меньше значения SMA четырёх свечей назад (наклон вниз).
4. Открытых позиций нет.

При выполнении условий отправляется рыночная заявка на объём, указанный в параметре `Volume`.

## Условия выхода
- **Закрытие покупок.** Если открыта длинная позиция и последняя свеча закрылась ниже средней полосы Боллинджера, позиция немедленно закрывается рыночной продажей.
- **Закрытие продаж.** Если открыта короткая позиция и последняя свеча закрылась выше средней полосы Боллинджера, позиция покрывается рыночной покупкой.

Тем самым соблюдается логика MQL5-версии, закрывающей сделки при возврате цены к средней линии полос Боллинджера.

## Используемые индикаторы
- **SMA:** задаёт направление тренда и служит для оценки наклона на интервале в четыре свечи.
- **Полосы Боллинджера:** предоставляют верхнюю, среднюю и нижнюю границы для поиска пробоев и сопровождения позиции.

## Параметры
| Имя | Назначение | Значение по умолчанию | Оптимизация |
| --- | --- | --- | --- |
| `MaPeriod` | Период SMA для фильтра тренда. | `9` | ✔ |
| `BandsPeriod` | Длина расчёта полос Боллинджера. | `28` | ✔ |
| `Deviation` | Множитель стандартного отклонения для полос. | `1.6` | ✔ |
| `Volume` | Объём заявки (лоты или контракты). | `1` | ✔ |
| `CandleType` | Тип свечей, используемых в расчётах. | Таймфрейм 1 час | ✖ |

Параметры реализованы через `StrategyParam`, благодаря чему их можно менять из интерфейса или задействовать в оптимизации.

## Требования к данным
- Подходит для любых инструментов, предоставляющих свечные данные выбранного таймфрейма.
- Логика обрабатывает только завершённые свечи, что гарантирует повторяемость сигналов.
- По умолчанию используется часовой таймфрейм, однако можно задать любую доступную периодичность.

## Дополнительные замечания
- Исторические значения индикаторов не считываются напрямую; стратегия хранит компактный буфер последних четырёх закрытий и значений SMA, что соответствует проектным ограничениям.
- Защитные механизмы (стоп-лосс, тейк-профит) не активированы, поскольку отсутствовали в исходной реализации. Их можно добавить через `StartProtection` при необходимости.
- Поскольку используются рыночные заявки, рекомендуется выбирать инструменты с достаточной ликвидностью для минимизации проскальзывания.
