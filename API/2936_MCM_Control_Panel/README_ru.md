# Стратегия MCM Control Panel Monitor
[English](README.md) | [中文](README_cn.md)

## Общее описание

**MCM Control Panel Monitor** переносит демонстрационный советник MetaTrader на платформу StockSharp. Вместо прорисовки панели на графике стратегия подписывается на несколько таймфреймов и поток тиков выбранного инструмента и выводит подробные сообщения в журнал при появлении каждого события. Решение предназначено для мульти-таймфреймового мониторинга, проверки поставщиков данных и построения собственных панелей управления.

Стратегия не отправляет заявки и не управляет позицией. Она лишь слушает рыночные данные и повторяет логику MQL-панели, переводя каждое событие в понятную строку журнала.

## Как это работает

1. При старте стратегия оформляет подписку на основной ряд свечей и, при необходимости, на дополнительные вторичный и третичный таймфреймы. Для каждого ряда можно указать любой поддерживаемый интервал.
2. Каждая закрывшаяся свеча порождает запись в журнале: указываются инструмент, метка таймфрейма (M1, H4, D1 и т.д.), цена закрытия, объём и точное время события. Формат совпадает с сообщениями оригинальной MQL-панели.
3. Если включён параметр *Log Unfinished Candles*, промежуточные обновления фиксируются сразу при открытии новой свечи, что удобно для онлайнового анализа.
4. При активном параметре *Track Ticks* стратегия подписывается на поток сделок и выводит цену, объём и метку времени каждой сделки, заменяя событие `CHARTEVENT_TICK` из версии MetaTrader.
5. Все подписки создаются через высокоуровневые методы StockSharp (`SubscribeCandles`, `SubscribeTicks`), поэтому стратегия легко подключается в Designer, Shell или через API.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| **Primary Timeframe** | Обязательный таймфрейм, за которым ведётся наблюдение. | Свечи 5 минут |
| **Use Secondary Timeframe** | Включает вторую подписку на свечи. | Выключено |
| **Secondary Timeframe** | Таймфрейм для дополнительного ряда. | Свечи 15 минут |
| **Use Tertiary Timeframe** | Включает третью подписку на свечи. | Выключено |
| **Tertiary Timeframe** | Таймфрейм для третьего ряда. | Свечи 1 час |
| **Track Ticks** | Добавляет подписку на тики и выводит каждую сделку. | Включено |
| **Log Unfinished Candles** | Выводит сообщения по незакрытым свечам. Полезно для фиксации момента появления новой свечи. | Выключено |

## Практические рекомендации

- Перед запуском выберите нужный инструмент. В сообщениях указывается `Security.Id`, что позволяет фильтровать их в просмотрщике логов StockSharp.
- Стратегия работает только на чтение и безопасна для одновременного запуска с торговыми ботами.
- В Designer можно разместить несколько панелей логов, чтобы отслеживать синхронность разных таймфреймов в реальном времени.
- Для имитации оригинальной MCM-панели запускайте несколько экземпляров стратегии на разных инструментах либо используйте вторичный и третичный таймфреймы для наблюдения нескольких горизонтов по одному символу.
- Включайте *Log Unfinished Candles*, когда нужно зафиксировать момент открытия новой свечи. Оставляйте параметр выключенным, если важны только подтверждённые закрытия.

## Соответствие оригинальному MQL-скрипту

| Компонент MQL | Адаптация в StockSharp |
|---------------|-----------------------|
| Настройка `InitControlPanelMCM` (цвета, шрифты) | Заменена параметрами стратегии. За визуализацию отвечает стандартный логгер StockSharp. |
| Обработка `OnChartEvent` с кодами `CHARTEVENT_CUSTOM` | Подписки на выбранные таймфреймы и журнальные сообщения с метками интервалов. |
| Событие `CHARTEVENT_TICK` | Опциональная подписка на тики с аналогичным форматом сообщений. |
| Вывод `TimeToString(...) -> id=...` | Сообщения `AddInfoLog` с инструментом, таймфреймом, ценой, объёмом и меткой времени. |

## Пример сообщений журнала

```
[EURUSD] M5 closed candle price=1.09845 volume=27 time=2024-03-05T09:35:00.0000000Z
[EURUSD] Tick price=1.09852 volume=1 time=2024-03-05T09:35:07.2510000Z
```

Такой вывод подтверждает получение закрытой пятиминутной свечи и последующего тика — ровно как в MQL-версии панели.
