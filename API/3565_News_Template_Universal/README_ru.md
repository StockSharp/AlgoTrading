# Стратегия News Template Universal

## Общее описание
**News Template Universal Strategy** повторяет логику оригинального советника MQL, который приостанавливает торговлю перед
важными новостями и возобновляет её после выхода событий. Стратегия получает поток новостей через стандартную подписку
`Connector.SubscribeMarketData(Security, MarketDataTypes.News)` и отбирает релизы по валютам, важности и ключевым словам.
Флаг `IsNewsActive` сигнализирует внешнему коду, что сейчас действует «тишина перед новостями», поэтому открывать новые
позиции нельзя.

Основные отличия от MQL-версии:

* Нет запросов через `WebRequest` и разбора HTML — используется встроенный новостной канал StockSharp.
* Свечи (по умолчанию минутные) служат таймером для очистки устаревших событий и проверки текущего времени.
* Графические объекты (линии, подписи) не создаются: вся информация доступна через лог и свойства стратегии.

## Логика работы
1. При старте стратегия подписывается на новости и выбранный тип свечей.
2. Каждый завершённый бар вызывает очистку списка событий от устаревших и проверку попадания текущего времени в окно «до/после» новостей.
3. Каждое входящее сообщение `NewsMessage` разбирается. Оно сохраняется, если выполнены фильтры по важности, валютам и ключевой фразе.
4. Если свеча попадает в интервал `StopBeforeNewsMinutes` до или `StartAfterNewsMinutes` после события, устанавливается `IsNewsActive = true` и в лог выводится сообщение «News time...». После выхода из окна выводится «No news», а флаг сбрасывается.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `UseNewsFilter` | Включает или выключает логику блокировки сделок. | `true` |
| `IncludeLow` | Учитывать новости с низкой важностью (упоминание `*` или `LOW`). | `false` |
| `IncludeMedium` | Учитывать новости со средней важностью (`**`, `MEDIUM`, `MODERATE`). | `true` |
| `IncludeHigh` | Учитывать новости с высокой важностью (`***` или `HIGH`). | `true` |
| `StopBeforeNewsMinutes` | За сколько минут до новости остановить торговлю. | `30` |
| `StartAfterNewsMinutes` | Через сколько минут после новости возобновить торговлю. | `30` |
| `Currencies` | Список валют через запятую, которые ищутся в тексте новости. | `USD,EUR,CAD,AUD,NZD,GBP` |
| `CheckSpecificNews` | Включить фильтр по ключевой фразе. | `false` |
| `SpecificNewsText` | Фраза (без учёта регистра), обязательная при активном фильтре. | `employment` |
| `CandleType` | Тип свечей, которые запускают расчёт времени. | `таймфрейм 1 минута` |

## Дополнительные детали реализации
* Текст новости нормализуется в верхний регистр, поэтому фильтры не чувствительны к регистру.
* Важность определяется как по звёздам (`*`, `**`, `***`), так и по словам (`LOW`, `MEDIUM`, `HIGH`, `MODERATE`).
* Список событий сортируется после каждого добавления, что гарантирует корректный порядок обработки.
* Записи удаляются, когда текущее время превышает `StartAfterNewsMinutes` после события — память не засоряется историей.
* При остановке выполняется `UnSubscribeMarketData`, чтобы не оставлять «висячих» подписок у коннектора.

## Рекомендации по использованию
1. Наблюдайте за свойством `IsNewsActive` и блокируйте открытие позиций во время новостного окна.
2. При необходимости расширьте парсер важности или валют, если поставщик данных использует собственные обозначения.
3. В тестовой среде убедитесь, что выбранный инструмент действительно предоставляет новости.
