# Стратегия Speed MA

## Обзор
**Speed MA** — это перенос советника MetaTrader 4 `ytg_Speed_MA_ea` на платформу StockSharp. В оригинальном коде измеряется изменение простой скользящей средней между соседними барами: если наклон превышает заданный порог, эксперт открывает позицию в соответствующем направлении. Реализация на C# воспроизводит эту логику с использованием высокоуровневого API StockSharp: подписка на свечи, расчёт смещённой простой скользящей средней и открытие сделок при достаточно большом различии между соседними значениями. Объём ордера, тейк-профит и стоп-лосс задаются в тех же MetaTrader-поинтах, что и в исходном MQL4.

## Логика работы
1. Подписаться на выбранный тип свечей (по умолчанию минутный) и создать простую скользящую среднюю длиной `MovingAveragePeriod`.
2. Для каждой завершённой свечи сохранять очередное значение скользящей средней. В буфере хранятся только необходимые элементы, чтобы сравнивать значения на смещениях `Shift` и `Shift + 1`.
3. Рассчитать наклон как разность между значением скользящей средней `Shift` баров назад и значением на бар раньше (`Shift + 1`). Это эквивалентно вызовам `iMA(..., shift)` и `iMA(..., shift + 1)` в MetaTrader.
4. Преобразовать наклон в абсолютное изменение цены и сравнить его с порогом `SlopeThresholdPoints`, выраженным в поинтах. Превышение положительного порога даёт сигнал на покупку, превышение отрицательного — на продажу.
5. Включение `ReverseSignals` инвертирует направление сигналов, позволяя торговать в противоположную сторону.
6. Новая позиция открывается только при отсутствии текущей. В MQL4 версия проверяла `OrdersTotal() < 1`; в StockSharp аналогичное поведение реализовано проверкой `Position == 0`.
7. Защитные заявки управляются методом `StartProtection`. Параметры `TakeProfitPoints` и `StopLossPoints` задаются в поинтах и автоматически переводятся в абсолютные ценовые смещения по количеству знаков инструмента.

## Управление рисками
- **Стоп-лосс** — `StopLossPoints` определяет расстояние от входа до защитного стопа в поинтах. Значение `0` отключает стоп.
- **Тейк-профит** — `TakeProfitPoints` задаёт целевую прибыль в поинтах. Значение `0` отключает тейк.
- Стратегия не использует трейлинг и частичные фиксации, полностью повторяя исходный алгоритм с фиксированными стопом и тейком.
- Одновременно может быть открыта только одна позиция, что соответствует изначальному советнику с фиксированным объёмом 0.1 лота.

## Параметры
| Параметр | Описание | Значение по умолчанию |
|----------|----------|-----------------------|
| `OrderVolume` | Объём сделки, аналог 0.1 лота в MQL4. | `0.1` |
| `MovingAveragePeriod` | Период простой скользящей средней. | `13` |
| `Shift` | Количество завершённых баров для смещённого значения (сравниваются `shift` и `shift + 1`). | `1` |
| `SlopeThresholdPoints` | Минимальное изменение между смещёнными значениями, выраженное в поинтах. | `10` |
| `ReverseSignals` | Инвертировать направление сигналов. | `false` |
| `TakeProfitPoints` | Расстояние до тейк-профита в поинтах (конвертируется в цену). | `500` |
| `StopLossPoints` | Расстояние до стоп-лосса в поинтах (конвертируется в цену). | `490` |
| `CandleType` | Тип свечей для расчётов (по умолчанию 1 минута). | Таймфрейм 1 минута |

## Особенности реализации
- Значение MetaTrader-поинта восстанавливается по количеству знаков инструмента (`Decimals`), что даёт верный шаг цены для инструментов с 5 и 3 знаками.
- История скользящей средней обрезается до минимально необходимого размера, поэтому память не растёт бесконтрольно, а индексы совпадают с оригиналом.
- `StartProtection` преобразует значения в поинтах в объекты `Unit` с абсолютным смещением цены, обеспечивая эквивалентные уровни стопа и тейка.
- Используется связка `SubscribeCandles().Bind(...)`, поэтому расчёты выполняются только на завершённых свечах и не требуют прямого обращения к `GetValue()`.
- В коде добавлены комментарии на английском языке, поясняющие ключевые решения при миграции.
- В каталоге присутствует только реализация на C#, Python-версия намеренно не создавалась.

## Рекомендации по использованию
- Уменьшение `SlopeThresholdPoints` увеличивает число сделок, поскольку даже небольшие изменения скользящей средней дадут сигнал. Увеличение порога, наоборот, фильтрует шум и требует более сильного движения.
- Параметр `Shift` определяет, насколько "глубоко" измеряется наклон. Значение `0` сравнивает текущий завершённый бар с предыдущим, а большие значения анализируют более ранние отрезки.
- При необходимости можно подключать дополнительные рисковые модули StockSharp или ограничения на уровне портфеля.
- Важно, чтобы выбранный `CandleType` совпадал с таймфреймом, использованным при оптимизации MQL4-советника, иначе масштаб наклона изменится.

## Отличия от оригинального советника
- Для входа и выхода используются методы StockSharp (`BuyMarket`, `SellMarket` и `StartProtection`) вместо `OrderSend`, однако итоговая схема (один рыночный ордер с фиксированными SL/TP) полностью совпадает.
- В MetaTrader контроль позиций ведётся через количество ордеров, а в StockSharp — через суммарную позицию. Проверка на отсутствие позиции воспроизводит условие `OrdersTotal() < 1`.
- Благодаря инфраструктуре StockSharp доступны расширенные журналы, визуализация и работа с единицами измерения, не влияющие на логику торговли.

## Файлы
- `CS/SpeedMAStrategy.cs` — реализация стратегии.
- `README.md`, `README_cn.md`, `README_ru.md` — подробное описание на английском, китайском и русском языках.

Python-папка и скрипты отсутствуют согласно требованиям задачи.
