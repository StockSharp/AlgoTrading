# Стратегия Puria Method

## Общая информация
Puria Method — трендовая торговая система из платформы MetaTrader. Она использует три скользящие средние и фильтр MACD для подтверждения направления движения. При переносе в StockSharp сохранена оригинальная логика входов, добавлены встроенные механизмы управления рисками: фиксированный стоп/тейк, трейлинг и частичная фиксация прибыли.

## Логика работы
- Рассчитываются три скользящие средние с настраиваемыми периодами, типами сглаживания и источниками цен.
- Для генерации сигнала анализируется предыдущая завершённая свеча: для покупки обе быстрые средние должны находиться минимум на 0.5 пункта выше базовой, для продажи базовая средняя должна опережать быстрые.
- Дополнительное подтверждение даёт MACD. Для длинных позиций требуется положительное значение MACD на предыдущей свече и неубывающая динамика индикатора за заданное число баров. Для коротких позиций условия зеркальные.
- При появлении сигнала стратегия закрывает встречную позицию (если она есть) и открывает новую позицию в направлении сигнала.

## Управление рисками
- **Стоп-лосс и тейк-профит.** Значения задаются в пунктах относительно цены входа и автоматически нормализуются по шагу цены инструмента.
- **Трейлинг-стоп.** После прохождения расстояния `TrailingStop + TrailingStep` стоп переносится вслед за ценой с шагом `TrailingStep`.
- **Частичное закрытие.** При достижении минимального профита закрывается доля позиции, заданная коэффициентом `MinProfitFraction`.
- **Контроль экстремумов.** Стратегия отслеживает максимумы/минимумы после входа для своевременного срабатывания стопов и тейков.

## Параметры
| Параметр | Описание |
| -------- | -------- |
| `StopLossPips` | Стоп-лосс в пунктах. |
| `TakeProfitPips` | Тейк-профит в пунктах. |
| `TrailingStopPips` | Базовое расстояние трейлинг-стопа. |
| `TrailingStepPips` | Минимальный прирост прибыли для переноса стопа. |
| `MinProfitStepPips` | Минимальный профит для частичного выхода. |
| `MinProfitFraction` | Доля позиции, закрываемая при частичном выходе. |
| `CandleType` | Тип используемых свечей. |
| `Ma0Period`, `Ma1Period`, `Ma2Period` | Периоды скользящих средних. |
| `Ma0Shift`, `Ma1Shift`, `Ma2Shift` | Сдвиг по барам для каждой средней. |
| `Ma0Method`, `Ma1Method`, `Ma2Method` | Типы сглаживания (SMA, EMA, SMMA, WMA). |
| `Ma0Price`, `Ma1Price`, `Ma2Price` | Источник цены для каждой средней. |
| `MacdFastPeriod`, `MacdSlowPeriod`, `MacdSignalPeriod` | Настройки MACD. |
| `MacdTrendBars` | Количество баров для проверки тренда MACD (не менее 3). |
| `MacdPrice` | Источник цены для MACD. |

## Рекомендации
- Стратегия работает только с полностью сформированными свечами (`CandleStates.Finished`). Выбирайте таймфрейм, соответствующий исходной ТС.
- Размер пункта вычисляется автоматически на основе шага цены и количества знаков инструмента.
- Если параметры трейлинга или частичного выхода заданы нулём, соответствующие блоки будут отключены.
- Перед использованием на реальном счёте рекомендуется протестировать стратегию на исторических данных и подобрать параметры под конкретный инструмент.
