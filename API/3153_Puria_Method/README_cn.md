# Puria Method 策略

## 概述
Puria Method 是一套起源于 MetaTrader 的顺势策略，通过三条均线与 MACD 主线组合来识别动量突破。本转换版完整保留原始信号逻辑，同时提供止损、止盈、追踪止损以及分批止盈等风险控制功能，方便在 StockSharp 平台上直接使用。

## 交易逻辑
- 计算三条可配置的均线（周期、平滑方式及价格来源均可调整）。
- 使用前一根完成 K 线的数据比较快速均线与基准均线的差值：多头信号要求两条快速均线都至少高于基准均线 0.5 个最小价格单位；空头信号则要求基准均线领先快速均线。
- 借助 MACD 主线确认趋势方向。多头必须满足上一根 MACD 值为正且最近若干根 MACD 不断抬升；空头条件相反。
- 当出现进场信号时，如有反向持仓先行平仓，再以净头寸方式开立新仓位。

## 风险管理
- **止损 / 止盈：** 依据设置的点数从开仓价推算，并自动对齐交易品种的最小价位步长。
- **追踪止损：** 当浮盈超过“追踪距离 + 调整步长”后，止损价格随市价逐步上移/下移。
- **分批止盈：** 价格达到最小盈利距离后，可按比例平掉部分仓位以锁定收益。
- **仓位跟踪：** 策略记录多头的最高价与空头的最低价，用于触发止损或止盈判定。

## 参数说明
| 参数 | 含义 |
| ---- | ---- |
| `StopLossPips` | 止损点数。 |
| `TakeProfitPips` | 止盈点数。 |
| `TrailingStopPips` | 追踪止损距离。 |
| `TrailingStepPips` | 追踪止损更新所需的最小推进距离。 |
| `MinProfitStepPips` | 启动分批止盈的最小盈利点数。 |
| `MinProfitFraction` | 达到盈利条件时平仓的比例。 |
| `CandleType` | 使用的主 K 线类型。 |
| `Ma0Period`, `Ma1Period`, `Ma2Period` | 三条均线的周期。 |
| `Ma0Shift`, `Ma1Shift`, `Ma2Shift` | 均线的横向偏移量。 |
| `Ma0Method`, `Ma1Method`, `Ma2Method` | 均线平滑方式（简单、指数、平滑、加权）。 |
| `Ma0Price`, `Ma1Price`, `Ma2Price` | 均线的价格来源。 |
| `MacdFastPeriod`, `MacdSlowPeriod`, `MacdSignalPeriod` | MACD 参数。 |
| `MacdTrendBars` | 检查 MACD 单调趋势的历史柱数（最少 3）。 |
| `MacdPrice` | MACD 计算所用价格。 |

## 使用建议
- 策略仅处理 `CandleStates.Finished` 的 K 线，建议选择与原策略相同周期的蜡烛序列。
- 点值会根据品种的小数位自动换算，无需手动调整。
- 若某项风险控制参数设置为零，则相应功能（如追踪止损或分批止盈）不会触发。
- 可结合回测或优化器调整均线、MACD 及风险参数，以适配不同市场品种。
