# Стратегия Executor AO

## Обзор
Executor AO — это эксперт Advisor для MetaTrader, основанный на индикаторе Awesome Oscillator и поиске "блюдец" около нулевой
линии. Перенос на StockSharp сохраняет логику определения разворота, но использует фиксированный объём сделок. Стратегия
подписывается на свечной поток `CandleType`, отслеживает три последних закрытых значения AO и открывает один нетто-позиционный
ордер при выполнении условий для покупки или продажи. Дополнительно реализованы стоп-лосс, тейк-профит и трейлинг-стоп, что
полностью повторяет поведение оригинального советника.

## Торговая логика
1. Подписаться на свечи выбранного таймфрейма и рассчитать Awesome Oscillator с периодами `AoShortPeriod` и `AoLongPeriod`.
2. Хранить три последних финальных значения AO, чтобы воспроизвести обращение к буферам индикатора в MQL.
3. При отсутствии позиции:
   - **Покупка**: текущее значение AO больше предыдущего, предыдущее меньше значения двумя барами ранее (формируется впадина),
     а само текущее значение остаётся ниже `-MinimumAoIndent`. В этом случае отправить рыночную заявку на покупку объёмом
     `TradeVolume`.
   - **Продажа**: текущее значение AO меньше предыдущего, предыдущее выше значения двумя барами ранее (формируется пик), а
     текущее значение превышает `MinimumAoIndent`. Тогда отправить рыночную заявку на продажу тем же объёмом.
4. При наличии позиции стратегия выполняет защитные действия:
   - Рассчитывает уровни стоп-лосса и тейк-профита от цены входа, умножая параметры `StopLossPips`/`TakeProfitPips` на величину
     пункта, скорректированную для трёх- и пятизнаковых котировок.
   - Включает трейлинг, когда прибыль превышает `TrailingStopPips + TrailingStepPips` пунктов. Новый стоп устанавливается только
     если он дальше предыдущего не менее чем на `TrailingStepPips`.
   - Длинные позиции закрываются при достижении тейка, стопа либо при переходе предыдущего значения AO в положительную область.
     Короткие позиции закрываются аналогично, когда предыдущий AO становится отрицательным.
5. Все сделки — рыночные заявки. Модель StockSharp оперирует чистой позицией, поэтому одновременная торговля в двух направлениях
   исключена.

## Параметры
| Имя | Тип | Значение по умолчанию | Описание |
| --- | --- | --- | --- |
| `CandleType` | `DataType` | Свечи 5 минут | Таймфрейм для расчёта сигналов. |
| `TradeVolume` | `decimal` | `1` | Фиксированный объём каждой сделки. |
| `AoShortPeriod` | `int` | `5` | Длина быстрой скользящей средней AO. |
| `AoLongPeriod` | `int` | `34` | Длина медленной скользящей средней AO. |
| `MinimumAoIndent` | `decimal` | `0.001` | Минимальное расстояние от нулевой линии, требуемое для открытия позиции. |
| `StopLossPips` | `decimal` | `50` | Стоп-лосс в пунктах MetaTrader. Значение `0` отключает стоп. |
| `TakeProfitPips` | `decimal` | `50` | Тейк-профит в пунктах. Значение `0` отключает цель. |
| `TrailingStopPips` | `decimal` | `5` | Базовая дистанция трейлинг-стопа. Используется только при положительном значении. |
| `TrailingStepPips` | `decimal` | `5` | Минимальный шаг перемещения трейлинг-стопа. Должен быть > 0 при включённом трейлинге. |

## Отличия от оригинального советника
- В MetaTrader присутствовала опция управления риском по проценту депозита. В версии StockSharp реализован только фиксированный
  объём (`TradeVolume`) ради простоты и совместимости с оптимизатором.
- Закрытие позиций по стопу и тейку осуществляется отправкой рыночных приказов внутри стратегии после проверки свечей, а не
  постановкой отдельных защитных заявок.
- Трейлинг-стоп пересчитывается на закрытии свечи, что соответствует архитектуре высокоуровневого API StockSharp и при этом
  повторяет пороговую логику советника.
- Вместо ручного копирования буферов индикатора используется подписка `SubscribeCandles` и метод `Bind`.

## Рекомендации по использованию
- Перед запуском задайте `TradeVolume` в соответствии с шагом лота выбранного инструмента. Значение также копируется в
  `Strategy.Volume`, поэтому вспомогательные методы автоматически используют нужный объём.
- Увеличивайте `MinimumAoIndent`, если AO часто колеблется около нуля и генерирует ложные сигналы. Нулевое значение соответствует
  наиболее агрессивной торговле.
- При включении трейлинг-стопа убедитесь, что `TrailingStepPips` больше нуля — стратегия проверяет это условие и сообщает об
  ошибке при некорректных настройках.
- Для визуального контроля после портирования подключите стратегию к графику с отображением свечей и линии AO.

## Индикатор
- **Awesome Oscillator** — разность между быстрой и медленной простыми скользящими средними от медианной цены. Используются
  стандартные периоды 5 и 34, как в MetaTrader.
