# Стратегия Daily BreakPoint

## Обзор
**Daily BreakPoint Strategy** — это портирование эксперта MetaTrader 5 «Daily BreakPoint» (сборка 19498) в экосистему StockSharp. Алгоритм отслеживает расстояние между текущей ценой и дневным открытием. Когда движение от открытия превышает заданный порог, а тело последней свечи укладывается в допустимый диапазон, стратегия либо открывает позицию по направлению пробоя, либо разворачивает существующую позицию в зависимости от флага `CloseBySignal`.

Стратегия одновременно использует два типа данных:

1. Внутридневные свечи (параметр `CandleType`) для генерации торговых сигналов.
2. Дневные свечи для отслеживания актуального открытия торговой сессии.

## Логика торговли
1. После закрытия каждой внутридневной свечи стратегия получает цену открытия текущего дня и вычисляет уровни пробоя на основе `BreakPointPips` (значение переводится из пунктов в абсолютную цену через шаг цены инструмента).
2. Размер тела последней свечи должен лежать в диапазоне `[LastBarSizeMinPips, LastBarSizeMaxPips]`.
3. **Бычий сценарий**
   - Свеча закрывается выше открытия (`Close > Open`).
   - Цена закрытия как минимум на `BreakPointPips` выше дневного открытия.
   - Уровень пробоя (дневное открытие + порог) находится внутри тела свечи.
   - Если `CloseBySignal = false`, открывается длинная позиция. Если `CloseBySignal = true`, текущие лонги закрываются и открывается короткая позиция.
4. **Медвежий сценарий** симметричен: свеча закрывается ниже открытия, расстояние до дневного открытия больше `BreakPointPips`, уровень пробоя лежит внутри тела — в результате открывается шорт (`CloseBySignal = false`) или происходит разворот в лонг (`CloseBySignal = true`).
5. Заявки отправляются по рынку с объемом `OrderVolume`. Объём позиции суммируется, поэтому повторные сигналы могут наращивать позицию.

## Управление рисками
- **Стоп-лосс / тейк-профит**: задаются в пунктах (`StopLossPips`, `TakeProfitPips`). Нулевое значение отключает соответствующий уровень. Проверка на срабатывание выполняется по максимумам и минимумам свечей.
- **Трейлинг-стоп**: активируется, если `TrailingStopPips > 0`. После того как прибыль превышает `TrailingStopPips + TrailingStepPips`, стоп подтягивается на расстояние `TrailingStopPips`. Параметр шага предотвращает излишне частые перестановки в боковом рынке.
- Все расстояния в пунктах переводятся в абсолютные цены через `PriceStep`. Для инструментов с 3 или 5 знаками после запятой размер пункта равен десяти шагам цены — как и в оригинальном советнике.

## Параметры
| Параметр | Описание |
| --- | --- |
| `OrderVolume` | Базовый объем каждой рыночной заявки. |
| `CloseBySignal` | При `true` стратегия закрывает позиции и открывает противоположную при появлении сигнала. |
| `BreakPointPips` | Расстояние от дневного открытия, необходимое для подтверждения пробоя. |
| `LastBarSizeMinPips` / `LastBarSizeMaxPips` | Допустимый диапазон размера тела сигнальной свечи. |
| `TrailingStopPips` | Дистанция трейлинг-стопа. `0` — отключить. |
| `TrailingStepPips` | Минимальное дополнительное движение перед каждым смещением стопа. |
| `StopLossPips` | Фиксированный стоп-лосс. `0` — без стопа. |
| `TakeProfitPips` | Фиксированный тейк-профит. `0` — без тейка. |
| `CandleType` | Тип внутридневных свечей для расчетов. |

## Примечания по использованию
- Стратегия автоматически подписывается на внутридневные и дневные свечи. Убедитесь, что поставщик данных поддерживает необходимые таймфреймы.
- Сигналы анализируются только после закрытия свечи, поэтому заявки отправляются по цене закрытия сигнального бара.
- Конвертация пунктов рассчитана на форекс-котировки. Для инструментов с нестандартным шагом цены скорректируйте значения параметров.
