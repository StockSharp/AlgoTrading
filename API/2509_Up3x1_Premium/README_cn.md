# UP3x1 Premium 策略
[English](README.md) | [Русский](README_ru.md)

UP3x1 Premium 策略是 MetaTrader 指标 *up3x1_premium_v2M* 的 StockSharp 版本。策略结合快/慢 EMA 交叉、宽幅 K 线过滤以及日线趋势背景，在捕捉动量突破的同时使用固定目标和移动止损控制风险。

## 工作流程

1. **趋势识别**
   - 在工作级别计算两条 EMA（默认 12 和 26 周期）。
   - 保存前两个 EMA 数值，用于重现原始 MQL 中的交叉判定。
   - 在日线级别计算一条 EMA，用于判断大周期方向。

2. **入场条件**
   - 出现下列任一情形即触发做多：
     - 快 EMA 从下向上穿越慢 EMA，且前两根 K 线开盘价逐步抬高。
     - 上一根 K 线为宽幅阳线，实体大于设定的阈值。
     - 当地时间午夜出现新 K 线时，如果上一日线大幅收低，则允许博弈反弹。
     - 当前价格高于日线 EMA，说明大周期偏多。
   - 做空条件为上述情形的镜像（快 EMA 下穿、宽幅阴线或午夜出现向下反转信号）。
   - 如果多空信号同时出现，则依据当前 EMA 相对位置来决定方向。

3. **出场管理**
   - 以下任一条件满足时平仓：
     - EMA 之间的距离缩小到 ±0.1% 以内，表明趋势动能减弱。
     - 价格触及设定的止盈或止损（以绝对价格单位定义）。
     - 启用移动止损时，止损被逐渐上移/下移并被触发。

4. **仓位控制**
   - 仅在空仓状态下开新仓，与原始 EA 保持一致。
   - `OrderVolume` 参数控制每次下单的合约数量。

## 参数说明

| 参数 | 说明 |
|------|------|
| `OrderVolume` | 每次交易的下单数量或手数。 |
| `FastEmaLength` / `SlowEmaLength` | 工作级别快/慢 EMA 的周期。 |
| `DailyEmaLength` | 日线 EMA 的周期。 |
| `TakeProfit` | 绝对止盈距离，0 表示关闭。 |
| `StopLoss` | 绝对止损距离，0 表示关闭。 |
| `TrailingStop` | 移动止损距离，价格达到阈值后开始跟随。 |
| `RangeThreshold` | 认定上一根 K 线为宽幅线所需的最小波动范围。 |
| `BodyThreshold` | 判定动量实体所需的最小 K 线实体。 |
| `DailyReversalThreshold` | 午夜过滤所需的前一日 K 线反转幅度。 |
| `CandleType` | 主交易逻辑使用的时间框架。 |
| `DailyCandleType` | 用于日线趋势过滤的高一级别时间框架。 |

## 使用建议

- 默认参数沿用原始 EA 中的常数（已从点值转换为绝对价格单位）。
- 请根据交易品种的最小跳动单位，调整止盈、止损、移动止损及宽幅/实体阈值。
- 在此移植版本中，日线 EMA 用于替代原脚本中“永远做多”的偏向，使交易更贴合高周期趋势。
- 在真实交易前，请务必先进行历史回测和模拟盘前向测试。
