# Стратегия UP3x1 Premium
[English](README.md) | [中文](README_cn.md)

Стратегия **UP3x1 Premium** — это порт советника MetaTrader *up3x1_premium_v2M* на платформу StockSharp. В ней сочетаются пересечения быстрых и медленных EMA, фильтр широких свечей и оценка дневного тренда. Такой набор позволяет отлавливать импульсные движения и управлять риском через фиксированные цели и трейлинг-стоп.

## Принцип работы

1. **Определение тренда**
   - Рассчитываются две EMA на рабочем таймфрейме (по умолчанию 12 и 26 периодов).
   - Хранятся значения EMA за два предыдущих бара, чтобы отслеживать пересечения, как в исходном MQL-скрипте.
   - Дополнительно считается дневная EMA для оценки старшего контекста.

2. **Условия входа**
   - **Лонг** открывается, если выполняется хотя бы одно условие:
     - Быстрая EMA пересекает медленную снизу вверх, а два предыдущих открытия показывают рост.
     - Предыдущая свеча — бычья, с широким диапазоном и телом больше заданного порога.
     - В момент формирования полуночной свечи предыдущий дневной бар закрылся значительно ниже открытия (признак капитуляции).
     - Текущая цена находится выше дневной EMA, что задаёт бычий фон.
   - **Шорт** запускается при зеркальных условиях (медвежье пересечение EMA, широкая медвежья свеча или ночной разворот в противоположную сторону).
   - Если сигналы в обе стороны активируются одновременно, используется текущее соотношение EMA для выбора направления.

3. **Выход из позиции**
   - Сделка закрывается, когда:
     - EMA сближаются менее чем на ±0.1 %, что сигнализирует о потере импульса.
     - Цена достигает заданного тейк-профита или стоп-лосса (значения указываются в абсолютных ценовых единицах).
     - Трейлинг-стоп (если включён) подтягивается за ценой и срабатывает.

4. **Управление позицией**
   - Сделки открываются только при нулевой позиции, что повторяет логику оригинального советника.
   - Размер заявки задаётся параметром `OrderVolume` и используется для всех рыночных ордеров.

## Параметры

| Параметр | Описание |
|----------|----------|
| `OrderVolume` | Объём сделки в лотах/контрактах. |
| `FastEmaLength` / `SlowEmaLength` | Периоды быстрых и медленных EMA на рабочем таймфрейме. |
| `DailyEmaLength` | Период EMA на дневных свечах. |
| `TakeProfit` | Абсолютная величина тейк-профита (0 — отключить). |
| `StopLoss` | Абсолютная величина стоп-лосса (0 — отключить). |
| `TrailingStop` | Расстояние трейлинг-стопа, которое следует за ценой. |
| `RangeThreshold` | Минимальный диапазон предыдущей свечи, чтобы считать её «широкой». |
| `BodyThreshold` | Минимальный размер тела свечи для импульсного сигнала. |
| `DailyReversalThreshold` | Минимальный разворот предыдущего дневного бара для полуночного фильтра. |
| `CandleType` | Рабочий таймфрейм основной логики. |
| `DailyCandleType` | Старший таймфрейм для дневного фильтра. |

## Рекомендации по использованию

- Значения по умолчанию соответствуют константам из оригинального советника (переведены из пунктов в абсолютные цены).
- Подбирайте параметры `TakeProfit`, `StopLoss`, `TrailingStop`, а также пороги диапазона и тела с учётом шага цены инструмента.
- Дневная EMA в портированной версии заменяет безусловный лонговый уклон MQL-скрипта и помогает торговать в сторону тренда старшего таймфрейма.
- Перед реальной торговлей обязательно протестируйте стратегию на истории и на демо-счёте.
