# Стратегия Stopreversal Trailing
[English](README.md) | [中文](README_cn.md)

Stopreversal Trailing воспроизводит эксперт MT5 `Exp_Stopreversal.mq5`. Используется пользовательский индикатор Stopreversal, который строит динамическую линию трейлинг-стопа вокруг выбранной цены свечи. Когда цена пробивает линию сверху, стратегия рассматривает это как бычий разворот, при необходимости закрывает короткую позицию и открывает новую длинную. Пробой сверху вниз формирует зеркальное медвежье действие. Обработка сигнала может быть отложена на заданное количество закрытых баров, чтобы полностью повторить поведение оригинального советника.

## Детали

- **Логика входа**: реакция на стрелки индикатора Stopreversal, появляющиеся при пересечении ценой адаптивного трейлинг-стопа.
- **Длинные/короткие позиции**: поддерживаются оба направления с независимыми флажками включения.
- **Логика выхода**: противоположные сигналы Stopreversal могут закрывать текущие позиции; доступны защитные стоп-лосс и тейк-профит.
- **Стопы**: фиксированные стоп-лосс и тейк-профит в шагах цены плюс разворот по индикатору.
- **Источник данных**: любая таймфреймная серия; по умолчанию используются свечи H4 как в исходном советнике.
- **Задержка сигнала**: параметр `SignalBar` откладывает исполнение ордера на указанное число закрытых баров (по умолчанию 1 бар).
- **Управление риском**: при запуске активируется сервис защиты позиций, доступны жёсткие стопы в шагах цены инструмента.
- **Параметры индикатора**: `Npips` задаёт расстояние между ценой и стопом, `PriceMode` определяет тип цены для расчётов.
- **Значения по умолчанию**:
  - `Volume` = 1
  - `StopLossSteps` = 1000
  - `TakeProfitSteps` = 2000
  - `BuyPositionOpen` = true
  - `SellPositionOpen` = true
  - `BuyPositionClose` = true
  - `SellPositionClose` = true
  - `Npips` = 0.004
  - `PriceMode` = Close
  - `SignalBar` = 1

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Тип свечей, используемый для расчёта Stopreversal и торговли. По умолчанию таймфрейм 4 часа. |
| `Volume` | Базовый объём ордера при открытии новой позиции. |
| `StopLossSteps` | Расстояние до стоп-лосса в шагах цены; 0 — отключить. |
| `TakeProfitSteps` | Расстояние до тейк-профита в шагах цены; 0 — отключить. |
| `BuyPositionOpen` | Включает открытие длинных позиций при бычьем сигнале. |
| `SellPositionOpen` | Включает открытие коротких позиций при медвежьем сигнале. |
| `BuyPositionClose` | Закрывает активные длинные позиции при появлении медвежьего сигнала. |
| `SellPositionClose` | Закрывает активные короткие позиции при появлении бычьего сигнала. |
| `Npips` | Доля, на которую расширяется или сужается расстояние до трейлинг-стопа. |
| `PriceMode` | Вариант используемой цены (close, open, high, low, median, typical, weighted, simple, quarter, trend-follow или Demark). |
| `SignalBar` | Количество полностью закрытых свечей до реакции на сигнал — аналог параметра MT5. |

## Фильтры

- **Категория**: разворот по тренду
- **Направление**: двунаправленная торговля
- **Индикаторы**: Stopreversal (трейлинг-стоп на базе ATR)
- **Стопы**: фиксированные стоп-лосс и тейк-профит, опционально
- **Таймфрейм**: настраиваемый (по умолчанию H4)
- **Сезонность**: нет
- **Нейросети**: нет
- **Дивергенция**: нет
- **Сложность**: средняя из-за пользовательской логики трейлинга
- **Уровень риска**: регулируется расстоянием стопов и параметром трейлинга
