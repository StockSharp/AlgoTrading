[English](README.md) | [中文](README_cn.md)

**Horizontal Line Levels** — это конверсия одноимённого советника MetaTrader 5. Стратегия непрерывно перестраивает две горизонтальные линии вокруг текущей цены и сообщает пользователю, когда рынок их пересекает. Реализация в StockSharp опирается на поток Level1 (лучший бид/аск) и повторяет связку OnTick/OnTimer оригинала, не выставляя торговых заявок.

## Основная идея

1. Подписаться на данные Level1 и сохранять последние значения лучшего бид и лучшего аск.
2. Перевести расстояние в «пунктах MetaTrader» в ценовой шаг инструмента StockSharp.
3. Смещать лучший аск вверх и лучший бид вниз на заданное количество пунктов, тем самым формируя виртуальные горизонтальные уровни.
4. Периодически (через таймер стратегии) проверять, не пересёк ли рынок один из уровней, и записывать предупреждение в журнал.

## Параметры

| Имя | Значение по умолчанию | Описание |
| --- | --- | --- |
| `TimerPeriodMinutes` | `1` | Количество минут между срабатываниями таймера. Значение должно быть строго положительным. |
| `OffsetPoints` | `50` | Расстояние в пунктах MetaTrader, которое добавляется к аску и вычитается из бида при построении уровней. |

## Подробности поведения

- **Подписка на данные**: метод `GetWorkingSecurities` запрашивает поток Level1, чтобы стратегия получала обновления бида и аска даже без свечей.
- **Инициализация**: как только доступны и бид, и аск, метод `RecalculateLevels` сохраняет текущие значения верхнего и нижнего уровней.
- **Таймер**: каждое срабатывание таймера восстанавливает уровни (если старт произошёл до поступления котировок) и формирует сообщения в журнале, когда цена выходит за границы.
- **Пересчёт пунктов**: вспомогательный метод `EnsurePointSize` конвертирует «пункты» MetaTrader в абсолютные изменения цены с использованием `Security.PriceStep`, что обеспечивает совпадение с оригиналом.
- **Отсутствие торговли**: стратегия не отправляет ордера; все уведомления публикуются через `AddInfoLog`, аналогично всплывающим окнам Alert в MetaTrader.
- **Остановка/сброс**: при остановке таймер отключается, а кешированные значения очищаются, чтобы при новом запуске начать работу с чистого листа.

## Типичное применение

1. Привяжите стратегию к нужному инструменту и задайте параметры `TimerPeriodMinutes` и `OffsetPoints` в интерфейсе Designer.
2. Запустите стратегию. После получения полной котировки в журнале появится запись вида `Horizontal levels updated. Upper: 1.12345, Lower: 1.12245.` — она подтверждает расчёт уровней.
3. Отслеживайте лог. При пробое верхнего уровня аском или нижнего уровня бидом стратегия запишет соответствующее уведомление.
4. Изменение параметров или повторный запуск приводит к пересчёту уровней с новыми значениями.

## Классификация

- **Категория**: Утилиты / Оповещения
- **Торговое направление**: Нет
- **Стиль исполнения**: Событийный мониторинг
- **Тип данных**: Level1 (bid/ask)
- **Сложность**: Базовая
- **Рекомендуемый таймфрейм**: Любой (только котировки)
- **Управление рисками**: Не требуется (сделки не открываются)

Такая адаптация сохраняет оповещающий характер оригинального советника и использует встроенные механизмы StockSharp — подписки на Level1 и таймер стратегии.
