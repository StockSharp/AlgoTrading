# Стратегия Resonance Hunter

## Обзор
Resonance Hunter — порт эксперта MetaTrader `Exp_ResonanceHunter` на платформу StockSharp. Для каждого слота стратегия отслеживает три коррелированных валютные пары и анализирует их осцилляторы Stochastic. Когда импульсы всех трёх осцилляторов совпадают по направлению, открывается позиция по основному инструменту, а второстепенные пары выступают фильтрами. Сделка закрывается при потере импульса ведущей пары или при срабатывании заданного стоп-лосса.

Предустановлены три слота:

1. EURUSD с фильтрами EURJPY и USDJPY.
2. GBPUSD с фильтрами GBPJPY и USDJPY.
3. AUDUSD с фильтрами AUDJPY и USDJPY.

Каждый слот можно включать/выключать отдельно и настраивать собственные таймфрейм и параметры индикатора.

## Параметры
Параметры сгруппированы по слотам (Slot 1–3) и включают:

| Параметр | Описание |
| --- | --- |
| `{Slot} Enabled` | Разрешает торговлю в выбранном слоте. |
| `{Slot} Primary` | Торгуемый инструмент, по нему же формируются сигналы на выход. |
| `{Slot} Secondary` | Вторая пара, участвующая в расчёте резонанса. |
| `{Slot} Confirmation` | Третья пара, подтверждающая сигнал. |
| `{Slot} Candle Type` | Таймфрейм, общий для всех трёх инструментов (по умолчанию 1 час). |
| `{Slot} K Period` | Окно расчёта %K. |
| `{Slot} D Period` | Период сглаживания %D. |
| `{Slot} Slowing` | Дополнительное сглаживание %K. |
| `{Slot} Volume` | Объём заявки в лотах; при развороте учитывается текущая позиция. |
| `{Slot} Stop Loss` | Стоп-лосс в пунктах MetaTrader. Ноль отключает защиту. |

## Логика торговли
1. Для каждого инструмента строится `StochasticOscillator` с выбранными параметрами на завершённых свечах.
2. Как только свежие свечи трёх инструментов имеют одинаковое время открытия, вычисляется разница `%K - %D`:
   * Положительное значение означает восходящий импульс, отрицательное — нисходящий.
   * Дополнительные правила из оригинального индикатора сверяют величины импульсов и корректируют сигналы.
3. **Лонг** открывается, когда все три импульса направлены вверх; **шорт** — когда все три направлены вниз.
4. Перед открытием новых сделок стратегия закрывает текущие позиции, если основная пара показывает противоположный импульс (аналог буферов `UpStop`/`DnStop`).
5. После входа рассчитывается защитный уровень по значению `{Slot} Stop Loss`. При каждой новой свече по основному инструменту проверяется достижение уровня и при пробое позиция закрывается.

Заявки отправляются через `BuyMarket`/`SellMarket`. Стратегия автоматически хеджирует уже открытую позицию по основному инструменту, что позволяет мгновенно разворачиваться.

## Примечания
* Для корректной работы необходима синхронизация свечей трёх инструментов внутри слота. При задержке одного из потоков сигнал переносится на следующий момент синхронизации.
* Защитный стоп реализован внутри стратегии (реальные стоп-заявки не выставляются), что повторяет поведение MetaTrader.
* Значения по умолчанию совпадают с оригинальным экспертом и могут оптимизироваться через `Param`.
