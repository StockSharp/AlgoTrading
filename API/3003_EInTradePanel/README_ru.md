# Стратегия eInTradePanel
[English](README.md) | [中文](README_cn.md)

Стратегия eInTradePanel автоматизирует работу одноимённой панели из MetaTrader. Она поддерживает все восемь режимов подачи заявок (рыночные, стоп, лимит и стоп-лимит на покупку и продажу), автоматически рассчитывает уровни срабатывания, входа, стоп-лосса и тейк-профита по текущему спреду и волатильности (ATR). Сопровождающие ордера реализованы через контроль свечей, поэтому решение корректно работает даже при отсутствии нативной поддержки SL/TP у брокера или источника данных.

## Ключевые особенности

- **Режимы входа** – доступны Buy, Sell, Buy/Sell Stop, Buy/Sell Limit и Buy/Sell Stop-Limit. Стоп-лимит заявки «вооружаются» при достижении триггерного уровня и затем размещают лимитную цену входа.
- **Динамические расстояния** – все отступы пропорциональны максимуму между фактическим спредом и синтетическим спредом на основе ATR (`ATR × AtrFactor`). При отсутствии данных ATR используется настраиваемое базовое количество тиков.
- **Адаптация к волатильности** – период ATR совпадает с оригинальной панелью (55), поэтому размеры уровней реагируют на смену рыночного режима без дополнительной настройки.
- **Истечение заявок** – необязательное время жизни (по умолчанию минимум 11 минут) автоматически отменяет «забытые» отложенные ордера.
- **Управление рисками** – каждую закрытую свечу стратегия проверяет на пробой стопа или цели и закрывает позицию рыночной заявкой при нарушении уровня.
- **Учёт котировок** – подписка на стакан обновляет лучшую цену Bid/Ask; при её отсутствии используется цена закрытия свечи.

## Параметры

| Имя | Описание |
| --- | --- |
| `Volume` | Объём сделки. |
| `Mode` | Режим входа (рыночный, стоп, лимит, стоп-лимит). |
| `Candle Type` | Тип свечей для ATR и логики выхода. |
| `Base Ticks` | Минимальный отступ в тиках при отсутствии ATR. |
| `Pending Multiplier` | Множитель для отложенных уровней. |
| `Trigger Multiplier` | Дополнительный множитель для триггера стоп-лимита. |
| `Stop Multiplier` | Множитель для стоп-лосса (0 – отключить). |
| `Take Multiplier` | Множитель для тейк-профита (0 – отключить). |
| `Use ATR` | Включить масштабирование расстояний по ATR. |
| `ATR Factor` | Доля ATR, используемая как оценка спреда. |
| `Expiration` | Время жизни отложенной заявки в минутах (0 – GTC). |
| `Min Expiration` | Минимально допустимое время жизни, аналог панельного ограничения. |

## Логика работы

1. **Подготовка данных** – подписка на выбранные свечи и расчёт ATR(55), обновление лучшего Bid/Ask через стакан.
2. **Расчёт расстояний** – по завершённой свече вычисляются базовый размер в тиках, уровни отложенных заявок, стоп-лосс и тейк-профит в соответствии с выбранным режимом.
3. **Выставление ордеров** –
   - Рыночные режимы исполняются при первой же закрытой свече, когда нет открытых позиций.
   - Стоп и лимит создают соответствующие отложенные заявки и, при необходимости, отменяются по истечении заданного времени.
   - Стоп-лимит отслеживает достижение триггера по High/Low свечи и после этого размещает лимитную заявку на вход.
4. **Сопровождение позиции** – при открытой позиции контролируются пробои стопа и цели по свечам; при достижении уровней позиция закрывается рыночным ордером.
5. **Сброс состояния** – при отсутствии позиции и активных ордеров уровни пересчитываются заново для следующей сделки.

Таким образом стратегия повторяет функциональность ручной панели, но полностью интегрирована в высокоуровневый API StockSharp.
