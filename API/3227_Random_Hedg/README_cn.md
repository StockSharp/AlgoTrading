# Random Hedg 策略

## 概述
**Random Hedg Strategy** 是将 MetaTrader 顾问 "Random Hedg" 迁移到 StockSharp 高阶 API 的版本。原策略会同时开出一笔买单和一笔卖单，然后通过固定止损、止盈、保本和跟踪止损来管理这两个方向。迁移版完整保留了这种核心机制，并把所有设置暴露为策略参数，便于在 StockSharp Designer 中调试或优化。

## 交易逻辑
1. **初始对冲** —— 当账户没有持仓时，策略立即按照设定的成交量同时发送买入与卖出市价单，两条腿都会获得按点数计算的止损与止盈。
2. **保本保护** —— 当价格向有利方向移动达到设定的点数后，止损会被移动到保本位置并加上一个可选偏移量：多单上移到入场价之上，空单下移到入场价之下，对应 EA 中的 "no loss" 功能。
3. **跟踪止损** —— 当浮盈超过设定距离后，止损开始跟随价格。多单止损跟随最高价减去跟踪距离，空单止损跟随最低价加上该距离。
4. **防守性离场** —— 任意一条腿触及止盈或止损都会立即平仓。还可以选择在 K 线收盘价跌破布林带下轨时同时平掉两条腿，对应原代码中的退出过滤器。
5. **循环重启** —— 当两条腿都平仓后，策略会重置内部状态，等待下一根 K 线重新建立新的对冲组合。

## 参数
- `HedgeVolume` —— 开仓时两条腿使用的合约数量（默认 0.1）。
- `StopLossPips` —— 止损距离（默认 200 点）。
- `TakeProfitPips` —— 止盈距离（默认 200 点）。
- `TrailingStopPips` —— 跟踪止损的步长（默认 40 点）。
- `BreakEvenTriggerPips` —— 触发保本移动所需的盈利距离（默认 10 点）。
- `BreakEvenOffsetPips` —— 执行保本移动时额外锁定的利润（默认 5 点）。
- `EnableTrailing` —— 是否启用跟踪止损。
- `EnableBreakEven` —— 是否启用保本功能。
- `EnableExitStrategy` —— 是否启用基于布林带的双腿清仓过滤器。
- `BollingerPeriod` —— 布林带的周期（默认 20 根 K 线）。
- `BollingerWidth` —— 布林带宽度倍数（默认 2）。
- `CandleType` —— 用于驱动逻辑的蜡烛序列（默认 30 分钟）。

## 实现说明
- 策略使用高阶 `Strategy` API，通过订阅蜡烛并使用 `BindEx` 实时计算布林带。
- 每条腿都会记录入场价、成交量以及动态的止损/止盈水平，从而在不依赖 MetaTrader 订单号的情况下复刻 MQL 中的资金管理逻辑。
- 使用独立的字段追踪待成交数量，从而在买卖连续成交时也能准确判断是开仓还是平仓。
- 需要支持对冲的账户类型，因为策略会同时持有多头和空头，与原始 EA 一致。
- MQL 版本中的资金目标和百分比止盈功能在此实现中被有意忽略。这些功能依赖于券商的余额数据，在实践中很少使用，因此 StockSharp 版本专注于价格行为管理。

## 文件
- `CS/RandomHedgStrategy.cs` —— 主要的 C# 实现，附带英文注释。
- `README.md` —— 英文文档。
- `README_ru.md` —— 俄语文档。
- `README_cn.md` —— 当前文件（中文说明）。
