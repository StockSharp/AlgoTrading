# Стратегия Random Hedg

## Обзор
**Random Hedg Strategy** — это порт советника MetaTrader "Random Hedg" на высокоуровневый API StockSharp. Оригинальный робот одновременно открывает рыночные позиции buy и sell, после чего сопровождает обе ноги при помощи фиксированного стоп-лосса, тейк-профита, перевода в безубыток и трейлинг-стопа. Перенос сохраняет эту логику и предоставляет все настройки через параметры стратегии, чтобы бот можно было настраивать и оптимизировать прямо в StockSharp Designer.

## Торговая логика
1. **Изначочный хедж** — когда стратегия находится в нуле, она сразу отправляет два рыночных ордера (покупку и продажу) одинакового объёма. Обе позиции получают стоп-лосс и тейк-профит в пунктах.
2. **Переход в безубыток** — после движения цены в нужную сторону на заданное количество пунктов стоп переносится в уровень безубытка с дополнительным шагом: для лонга стоп поднимается выше цены входа, для шорта опускается ниже. Это повторяет функцию "no loss" из оригинала.
3. **Трейлинг-стоп** — как только прибыль превышает заданную дистанцию, стоп следует за ценой. В длинной позиции стоп равен максимуму минус трейлинговое расстояние, в короткой — минимум плюс эта же величина.
4. **Защитные выходы** — любая нога закрывается при срабатывании тейк-профита или стоп-лосса. Дополнительно можно включить фильтр, который ликвидирует обе позиции, если свеча закрывается ниже нижней полосы Боллинджера (аналог exit-стратегии из MQL).
5. **Новый цикл** — после закрытия обеих ног стратегия очищает внутреннее состояние и ждёт следующей свечи, чтобы открыть новый хеджированный набор.

## Параметры
- `HedgeVolume` — объём, используемый для открытия обеих ног (по умолчанию 0.1 контракта).
- `StopLossPips` — расстояние защитного стоп-лосса (200 пунктов).
- `TakeProfitPips` — дистанция тейк-профита (200 пунктов).
- `TrailingStopPips` — шаг трейлинг-стопа (40 пунктов).
- `BreakEvenTriggerPips` — прибыль, необходимая для перевода стопа в безубыток (10 пунктов).
- `BreakEvenOffsetPips` — дополнительный зазор, фиксируемый при переходе в безубыток (5 пунктов).
- `EnableTrailing` — включает или отключает сопровождение трейлинг-стопом.
- `EnableBreakEven` — включает или отключает перевод в безубыток.
- `EnableExitStrategy` — активирует фильтр выхода по полосам Боллинджера.
- `BollingerPeriod` — период расчёта полос Боллинджера (20 свечей).
- `BollingerWidth` — коэффициент ширины полос Боллинджера (2).
- `CandleType` — тип свечей, по которым работает логика (по умолчанию таймфрейм 30 минут).

## Особенности реализации
- Используется высокоуровневый API `Strategy`: стратегия подписывается на свечи и применяет `BindEx` для расчёта индикатора Bollinger Bands на лету.
- Для каждой ноги хранится цена входа, объём и динамические уровни стопа/тейка. Это позволяет повторить управляющие механизмы MQL без привязки к тикетам MetaTrader.
- Объёмы заявок, ожидающих исполнения, учитываются отдельно, что помогает правильно классифицировать сделки как открытия или закрытия даже при последовательном исполнении buy и sell.
- Необходим хеджевый тип счёта, поскольку стратегия держит противоположные позиции одновременно, как и оригинальный советник.
- Денежные цели и процентные тейк-профиты из MQL-версии намеренно не реализованы: они опираются на брокерские особенности и редко использовались на практике. В версии для StockSharp упор сделан на управление по цене.

## Файлы
- `CS/RandomHedgStrategy.cs` — основной C# файл с подробными комментариями на английском языке.
- `README.md` — документация на английском языке.
- `README_ru.md` — текущий файл (русская версия описания).
- `README_cn.md` — перевод на китайский язык.
