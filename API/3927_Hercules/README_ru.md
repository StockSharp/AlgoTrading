# Стратегия Hercules

Hercules — порт советника MetaTrader **Hercules v1.3 (Majors)** на платформу StockSharp. Стратегия использует пересечение быстрой и медленной скользящих средних, набор фильтров на старших таймфреймах и сопровождает сделку двумя целями по прибыли.

## Логика торговли

* **Подготовка сигнала** — рассчитываются EMA(1) по ценам закрытия и SMA(72) по ценам открытия. Отслеживается пересечение, случившееся на последней или предпоследней свече. Цена пересечения усредняется, после чего формируется уровень триггера `TriggerPips` выше (для покупок) или ниже (для продаж).
* **Окно исполнения** — сигнал активен в течение двух полных свечей после пересечения. Сделка открывается только если текущая цена закрытия превысила уровень триггера внутри этого окна.
* **Фильтры**:
  * RSI на таймфрейме H1 (период `RsiPeriod`, цена типичная) должен быть выше `RsiUpper` для покупок и ниже `RsiLower` для продаж.
  * Цена закрытия должна пробить экстремум, набранный за `LookbackMinutes` минут на рабочем таймфрейме.
  * Дневной Envelope (SMA 24 с отклонением `DailyEnvelopeDeviation`%) требует, чтобы цена закрытия вышла за верхнюю/нижнюю границу по направлению сделки.
  * Четырёхчасовой Envelope (SMA 96 с отклонением `H4EnvelopeDeviation`%) добавляет дополнительное подтверждение тренда.
* **Управление риском** — стоп-лосс устанавливается на максимум/минимум свечи четырьмя барами ранее. Объём может быть фиксированным (`OrderVolume`) либо рассчитываться по `RiskPercent` от стоимости портфеля.
* **Сопровождение сделки** — на сигнал открываются две рыночные позиции равного объёма. Первая закрывается по `TakeProfitFirstPips`, вторая — по `TakeProfitSecondPips`. Трейлинг-стоп `TrailingStopPips` защищает обе позиции. После срабатывания стопа или обоих тейк-профитов включается блокировка новых входов на `BlackoutHours` часов.

## Параметры

| Параметр | Описание |
| --- | --- |
| `OrderVolume` | Объём каждой рыночной заявки до применения манименеджмента. |
| `UseMoneyManagement` | При включении пересчитывает объём исходя из `RiskPercent` и текущей дистанции до стопа. |
| `RiskPercent` | Процент капитала, который допускается рискнуть в сделке. |
| `TriggerPips` | Дистанция от цены пересечения, которую необходимо преодолеть перед входом. |
| `TrailingStopPips` | Ширина трейлинг-стопа в пунктах. |
| `TakeProfitFirstPips` | Дистанция первого тейк-профита. |
| `TakeProfitSecondPips` | Дистанция второго тейк-профита. |
| `FastPeriod` | Период быстрой EMA. |
| `SlowPeriod` | Период медленной SMA. |
| `RsiPeriod` | Период RSI на таймфрейме подтверждения. |
| `RsiUpper` / `RsiLower` | Граничные значения RSI для покупок и продаж. |
| `LookbackMinutes` | Длина окна (в минутах) для расчёта последних максимумов/минимумов. |
| `BlackoutHours` | Время блокировки новых сигналов после сделки. |
| `DailyEnvelopePeriod` / `DailyEnvelopeDeviation` | Параметры дневного Envelope. |
| `H4EnvelopePeriod` / `H4EnvelopeDeviation` | Параметры Envelope на H4. |
| `CandleType` | Основной таймфрейм расчётов. |
| `RsiTimeFrame` | Таймфрейм для расчёта RSI. |
| `DailyTimeFrame` | Таймфрейм для дневного Envelope. |
| `H4TimeFrame` | Таймфрейм для H4 Envelope. |

## Файлы

* `CS/HerculesStrategy.cs` — реализация стратегии на C#.
* `README.md` — описание на английском языке.
* `README_ru.md` — описание на русском языке.
* `README_cn.md` — описание на китайском языке.
