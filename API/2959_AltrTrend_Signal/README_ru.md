# Стратегия AltrTrend Signal v2.2
[English](README.md) | [中文](README_cn.md)

Стратегия является портом эксперт-советника **Exp_AltrTrend_Signal_v2_2** под StockSharp. Она полностью повторяет логику
адаптивного канала индикатора AltrTrend Signal и исполняет сигналы с задержкой по барам, как в оригинале. Значение ADX
сужает или расширяет канал, поэтому пробои возникают только при подтверждённой силе тренда.

## Как работает

1. На каждом завершённом баре заданного таймфрейма строится динамический канал. Его ширина определяется максимумом и минимумом
   цены внутри окна, которое растягивается или сжимается пропорционально предыдущему значению ADX (`KPeriod / ADX`).
2. Внутренние границы (`smin`, `smax`) смещаются к центру на величину `KPercent`. Для смены тренда цена должна закрыться вне
   этих границ.
3. Если тренд меняется с медвежьего на бычий и закрытие выше верхней границы, формируется сигнал покупки. Обратное условие даёт
   сигнал продажи. Заявки отправляются на баре, указанном параметром `SignalBar`, что соответствует поведению MQL5-версии.
4. Стоп-лосс и тейк-профит переводятся из пунктов в шаги цены, чтобы защитные выходы работали так же, как в исходном роботе.

## Детали

- **Вход в сделку**:
  - **Покупка**: предыдущий тренд был нисходящим или нейтральным, цена закрылась выше внутренней верхней границы, разрешены
    покупки. Короткие позиции закрываются автоматически, если это разрешено.
  - **Продажа**: предыдущий тренд был восходящим или нейтральным, цена закрылась ниже внутренней нижней границы, разрешены
    продажи. Длинные позиции закрываются автоматически при разрешении.
- **Выход из сделки**:
  - Обратный пробой границы при включённом разрешении на закрытие соответствующего направления.
  - Срабатывание стоп-лосса или тейк-профита в шагах цены.
- **Направление**: Торговля в обе стороны с независимыми переключателями открытия и закрытия.
- **Управление риском**:
  - `StopLossPoints` и `TakeProfitPoints` имитируют модуль MM оригинала, применяя фиксированные защитные расстояния после
    открытия рынка.
- **Настройки индикатора**:
  - `KPercent` определяет, насколько сильно границы канала сдвигаются к центру.
  - `KStop` сохраняет оригинальное значение стрелки для совместимости и логирования.
  - `KPeriod` задаёт базовое окно до модификации ADX.
  - `AdxPeriod` управляет длиной индекса направленного движения, влияющего на ширину канала.
  - `SignalBar` задаёт задержку исполнения сигнала в количестве завершённых свечей.
- **Рекомендуемые рынки**:
  - Лучше всего подходит для инструментов с ярко выраженными фазами тренда: валютные пары мажоры, золото, фьючерсы на индексы.
    Таймфрейм по умолчанию — H1, как в MQL5-шаблоне.

## Параметры

| Параметр | Описание |
|----------|----------|
| `CandleType` | Таймфрейм, на котором строится адаптивный канал. |
| `KPercent` | Процентное сжатие внутренних границ канала. |
| `KStop` | Множитель для расчёта проекции стрелки (для совместимости). |
| `KPeriod` | Базовое количество свечей до поправки ADX. |
| `AdxPeriod` | Период индекса направленного движения, регулирующего ширину канала. |
| `SignalBar` | Количество завершённых свечей до исполнения сигнала. |
| `AllowBuyEntries` / `AllowSellEntries` | Включение открытия позиций в каждом направлении. |
| `AllowBuyExits` / `AllowSellExits` | Разрешение автоматического закрытия позиций по обратному сигналу. |
| `StopLossPoints` | Дистанция стоп-лосса в шагах цены (0 — отключено). |
| `TakeProfitPoints` | Дистанция тейк-профита в шагах цены (0 — отключено). |

Порт сохраняет все переключатели и параметры управления риском исходного эксперта, что упрощает перенос результатов в StockSharp
Designer, Shell или Runner.