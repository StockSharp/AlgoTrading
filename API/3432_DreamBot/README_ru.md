# Стратегия DreamBot

## Обзор
DreamBot — это порт советника MetaTrader 4 «DreamBot» на платформу StockSharp. Стратегия анализирует осциллятор Force Index на часовых свечах и отслеживает моменты, когда импульс пересекает заданные бычий и медвежий уровни. Если Force Index пересекает бычий порог снизу вверх на предыдущей свече, открывается длинная позиция. Если индикатор пересекает медвежий порог сверху вниз, открывается короткая позиция. Сделки выполняются только при отсутствии открытых позиций, что повторяет оригинальную логику одного ордера.

## Торговая логика
- Подписка на свечи H1 и расчёт сглаженного Force Index (период по умолчанию 13).
- Хранение двух последних завершённых значений индикатора. Сигналы формируются по данным *предыдущих* свечей, аналогично вызовам `iForce` со сдвигами 1 и 2 в MT4.
- Открытие лонга, когда Force Index на предыдущей свече выше `BullsThreshold`, а значение двумя свечами ранее было ниже порога, и при этом позиция отсутствует.
- Открытие шорта, когда Force Index на предыдущей свече ниже `BearsThreshold`, а значение двумя свечами ранее было выше порога, и позиция отсутствует.
- Дополнительный трейлинг-стоп воспроизводит оригинал: после прибыли больше `TrailingStepPoints` стоп подтягивается на расстояние `TrailingStartPoints` от цены и следует за рынком.

## Управление рисками
- `StartProtection` добавляет классические стоп-лосс и тейк-профит, переводя значения в «пунктах» MetaTrader через шаг цены инструмента.
- Трейлинг реализован через рыночное закрытие: при пробое рассчитанного уровня стратегия немедленно отправляет рыночный ордер на выход.
- Учёт позиции ведётся по средневзвешенной цене входа, чтобы корректно работать с частичными исполнениями и реверсами.

## Параметры
| Параметр | Описание |
|----------|----------|
| `ForcePeriod` | Период сглаживания Force Index (по умолчанию 13). |
| `TakeProfitPoints` | Дистанция тейк-профита в пунктах MetaTrader. |
| `StopLossPoints` | Дистанция стоп-лосса в пунктах MetaTrader. |
| `BullsThreshold` | Порог Force Index, сигнализирующий о бычьем импульсе. |
| `BearsThreshold` | Порог Force Index, сигнализирующий о медвежьем импульсе. |
| `EnableTrailing` | Включает логику трейлинг-стопа. |
| `TrailingStartPoints` | Расстояние (в пунктах) между ценой и трейлинг-стопом после активации. |
| `TrailingStepPoints` | Прибыль (в пунктах), требуемая для активации трейлинга. |
| `CandleType` | Таймфрейм для расчёта Force Index (по умолчанию часовые свечи). |

## Примечания
- Проверка параметров блокирует ситуацию, когда `TrailingStepPoints` больше `TrailingStartPoints`, как и в оригинальном советнике.
- Ограничения брокера по минимальному стопу (`MODE_STOPLEVEL`) приближённо учитываются через шаг цены. При необходимости добавьте дополнительные проверки.
- Комментарии и сообщения журнала оставлены на английском языке в соответствии с требованиями инструкций по конверсии.
