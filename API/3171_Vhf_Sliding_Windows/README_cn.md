# VHF 滑动窗口策略

## 概述
- 根据 Vladimir Karputov 编写的 MetaTrader 5 专家顾问 **“VHF EA”** 改写。
- 通过垂直水平过滤器（Vertical Horizontal Filter，VHF）识别趋势行情与震荡行情。
- 适用于 StockSharp 支持的任意品种与周期，可通过参数调整所订阅的蜡烛类型。

## 交易逻辑
1. 订阅选定周期的蜡烛数据，在每根收盘蜡烛上计算周期为 `VhfPeriod` 的 VHF 指标。
2. 维护两组滑动窗口以跟踪最新的 VHF 数值：
   - **主窗口 (`MainWindowSize`)**：刻画较长区间内的 VHF 极值与中点。
   - **工作窗口 (`WorkingWindowSize`)**：捕捉短期内 VHF 相对高低的突破。
3. 当且仅当当前 VHF 同时高于两组窗口的中点时，才视为进入趋势行情。
4. 在趋势行情中，将最新收盘价与 `MainWindowSize` 根之前的收盘价进行比较：
   - 当前收盘价更高 → 默认开仓或持有多头；
   - 当前收盘价更低 → 默认开仓或持有空头；
   - 设置 `ReverseSignals` 可反向执行上述方向。
5. 一旦 VHF 回落到中点以下，即判定重新进入震荡区间，策略会平掉所有持仓。
6. 当方向翻转时，会一次性提交足够的市价委托，同时平掉旧仓位并建立新的反向仓位。

## 参数
| 参数 | 说明 | 默认值 | 备注 |
|------|------|--------|------|
| `MainWindowSize` | 主窗口内的 VHF 数量。 | `11` | 必须大于 `WorkingWindowSize`。 |
| `WorkingWindowSize` | 工作窗口内的 VHF 数量。 | `7` | 用于快速确认突破。 |
| `VhfPeriod` | VHF 指标的计算周期。 | `9` | 周期越小越敏感。 |
| `Volume` | 每次下单的手数。 | `1` | 方向翻转时会自动加上当前仓位的绝对值。 |
| `ReverseSignals` | 是否反向执行多空逻辑。 | `true` | 保持与原版 EA 相同的默认设置。 |
| `CandleType` | 使用的蜡烛周期/类型。 | `15 分钟` | 根据需要修改为其他周期。 |

## 仓位管理
- 始终以固定手数 `Volume` 下单，不包含止损或止盈。
- 调用了 `StartProtection()` 保护机制，确保在平台出现异常持仓时能够自动平仓。
- 退出完全依赖 VHF 对行情状态的判断，不额外计算风险报酬比。

## 实现细节
- 按照项目规范使用高级 API：通过蜡烛订阅与 `Bind` 方法连接指标。
- 在策略内部实现了与 MQL 版本一致的 VHF 指标算法。
- 日志会详细记录趋势切换与持仓变化，便于测试与回溯。
