# Стратегия «VHF Sliding Windows»

## Обзор
- Конвертация советника MetaTrader 5 **«VHF EA»** автора Владимира Карпутова.
- Использует индикатор Vertical Horizontal Filter (VHF) для определения, преобладает ли тренд или флет.
- Может работать на любом инструменте и таймфрейме в StockSharp — достаточно изменить параметр типа свечей.

## Логика торговли
1. Подписывается на поток выбранных свечей и на каждой завершённой свече пересчитывает VHF с периодом `VhfPeriod`.
2. Хранит две скользящие выборки значений VHF:
   - **Главное окно (`MainWindowSize`)** — определяет диапазон и середину индикатора за более длинный период.
   - **Рабочее окно (`WorkingWindowSize`)** — отслеживает локальные пробои относительно текущего диапазона.
3. Тренд считается активным только тогда, когда текущее значение VHF выше середины обоих окон.
4. В режиме тренда сравнивается текущая цена закрытия с ценой закрытия `MainWindowSize` свечей назад:
   - Цена выросла — по умолчанию открывается или поддерживается длинная позиция.
   - Цена упала — по умолчанию открывается или поддерживается короткая позиция.
   - Флаг `ReverseSignals` позволяет инвертировать направления.
5. Если VHF опускается обратно внутрь диапазона (значение не превышает обе середины), стратегия закрывает все позиции.
6. При смене направления отправляется одна рыночная заявка, объём которой закрывает старую позицию и открывает новую в противоположную сторону.

## Параметры
| Параметр | Описание | Значение по умолчанию | Примечания |
|----------|----------|-----------------------|------------|
| `MainWindowSize` | Размер главного окна VHF. | `11` | Должно быть строго больше `WorkingWindowSize`. |
| `WorkingWindowSize` | Размер рабочего окна VHF. | `7` | Ускоряет фиксацию изменений индикатора. |
| `VhfPeriod` | Период расчёта VHF. | `9` | Чем меньше период, тем чувствительнее индикатор. |
| `Volume` | Объём ордера (лоты). | `1` | При реверсе добавляется модуль текущей позиции. |
| `ReverseSignals` | Инвертировать сигналы на покупку/продажу. | `true` | Соответствует настройке оригинального советника. |
| `CandleType` | Тип и таймфрейм свечей. | `15 минут` | Можно задать любой поддерживаемый формат. |

## Управление позицией
- Используется фиксированный объём из параметра `Volume`, дополнительных стопов и целей не задаётся.
- Включена защита `StartProtection()`, чтобы автоматически ликвидировать непредвиденные остатки позиций.
- Выход из рынка основан исключительно на переходе VHF из тренда во флет.

## Особенности реализации
- Реализовано через высокоуровневое API: подписка на свечи и привязка индикатора методом `Bind`.
- В код встроен собственный индикатор VHF, повторяющий алгоритм версии MQL.
- Подробные сообщения журнала позволяют проследить смену режимов и сделок при отладке.

