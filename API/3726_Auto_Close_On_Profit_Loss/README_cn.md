# 盈亏自动平仓策略
[English](README.md) | [Русский](README_ru.md)

该工具型策略持续监控当前投资组合的浮动盈亏，当达到设定的盈利目标或亏损阈值时会自动平掉所有持仓。它是 MetaTrader "AutoCloseOnProfitLoss" 智能交易系统在 StockSharp 平台上的移植版本。

策略本身不会开仓，只负责管理已经存在的头寸。当满足配置好的货币化条件时，它会发送市价单关闭持仓，从而实现风险控制或锁定收益。

## 细节

- **入场条件**：无。策略不会主动开仓。
- **多空方向**：双向。投资组合中任意多头或空头持仓都可能被平仓。
- **出场条件**：
  - 当浮动利润大于等于 `TargetProfit` 且 `EnableProfitClose` 启用时，关闭所有持仓。
  - 当浮动亏损小于等于 `MaxLoss`（负值）且 `EnableLossClose` 启用时，关闭所有持仓。
  - 浮动盈亏以投资组合货币计算：优先使用组合的聚合利润值，否则累加每个持仓的 PnL。
- **止损**：通过 `MaxLoss` 参数实现的货币化止损。
- **默认值**：
  - `TargetProfit` = 100（投资组合货币单位）。
  - `MaxLoss` = -50（投资组合货币单位）。
  - `EnableProfitClose` = true。
  - `EnableLossClose` = true。
  - `ShowAlerts` = true（平仓时在策略日志中输出详细信息）。
  - `CandleType` = 1 分钟周期（仅用作定时检查的触发器）。
- **标签 / 筛选**：
  - 类别：工具 / 风险管理。
  - 方向：双向。
  - 指标：无。
  - 止损：货币化。
  - 复杂度：低。
  - 周期：可配置的定时 K 线（默认 1 分钟）。
  - 季节性：否。
  - 神经网络：否。
  - 背离：否。
  - 风险等级：由阈值设置决定。

## 实现说明

- 策略订阅可配置的蜡烛序列，仅用于周期性回调，以模拟原始 EA 的逐笔检查逻辑。
- 一旦满足平仓条件，会反复发送市价单，直到策略和投资组合中的所有证券全部平仓。
- 参数校验确保在启用盈利平仓时 `TargetProfit` 为正值，在启用亏损平仓时 `MaxLoss` 为负值，从源头避免配置错误。
