# Frank Ud 极简策略

本示例将经典的 **Frank Ud** MetaTrader 专家顾问移植到 StockSharp，并使用高阶策略 API 复刻其逻辑。原始 MQL 程序通过对冲模式维护一组做多网格和一组做空网格，当价格向最新仓位不利移动时不断加仓；一旦最新（也是手数最大的）订单获得固定点数利润，就立即同时平掉该方向的所有仓位。

## 核心思路

1. **双向对冲。** 策略分别维护多头和空头两个独立梯队，因此可以像 MT4 对冲账户一样同时持有多、空仓位。
2. **马丁加仓。** 任一方向的首单采用 `InitialVolume`（默认 0.1 手），此后每次加仓都会把当前最大手数翻倍。下单前会根据品种的 `MinVolume`、`MaxVolume`、`VolumeStep` 自动调整最终手数。
3. **间距控制。** 只有当价格相对已有最佳入场价至少反向移动 `ReEntryPips`（默认 41 点）时才允许再加一单。做多梯队等待卖价跌破 `最低买价 - ReEntryPips`，做空梯队等待买价突破 `最高卖价 + ReEntryPips`。
4. **收益锁定。** 每个梯队都以手数最大的订单作为“触发器”。当其浮动盈利超过 `TakeProfitPips`（默认 65 点），或价格触及原脚本设置的 `(TakeProfitPips + 25)` 点止盈位置时，该方向的所有仓位都会通过一笔市价单一次性平仓。
5. **保证金保护。** 在尝试加仓之前，策略会检查投资组合的可用保证金 `CurrentValue - BlockedValue` 是否仍高于 `Balance × MinimumFreeMarginRatio`（默认 0.5）。如果连接器无法提供这些指标，则退回到原始 EA 的固定手数模式。

## 参数说明

| 参数 | 作用 |
|------|------|
| `TakeProfitPips` | 以手数最大订单为基准的点数盈利阈值，超过后立即平掉该方向全部仓位。 |
| `ReEntryPips` | 价格相对最佳入场价必须达到的最小点数差，满足后才会继续加仓。 |
| `InitialVolume` | 每个梯队首单的基础手数，后续加仓会按马丁逻辑翻倍。 |
| `MinimumFreeMarginRatio` | 可用保证金占余额的最小比例，低于该值时禁止继续加仓；设为 0 可关闭此检查。 |

## 实现细节

- 策略仅依赖盘口报价：买价更新驱动空头逻辑，卖价更新驱动多头逻辑。
- 通过内部字典记录每笔订单的意图，以便在 `OnNewMyTrade` 中区分是开仓还是平仓，等价于 MQL 中对订单票号的数组管理。
- 持仓记录以列表保存每次成交的价格和手数，而非依赖聚合统计，从而保持原脚本查找最大手数及其入场价的方式。
- 原 EA 在每单止盈价上额外加的 25 点缓冲也作为补充退出条件保留下来。

> **提示：** 按需求暂不提供 Python 版本，因此目录中仅包含 C# 策略与多语言文档。
