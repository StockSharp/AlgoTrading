# OsMaSter V0 策略

## 概述
- 基于 MetaTrader 5 专家顾问 “OsMaSter v0”（MQL 文件 `OsMaSter v0.mq5`）转换。
- 借助 MACD 直方图（OsMA）形态来捕捉短期盘整后的动量反转。
- 通过参数 `CandleType` 指定交易品种和周期，策略只处理一个订阅源。
- 将以点（pip）为单位的止损与止盈自动换算成绝对价格偏移，换算时会考虑交易品种的最小价格步长与小数位数。

## 参数
| 名称 | 默认值 | 说明 |
| --- | --- | --- |
| `FastPeriod` | 9 | MACD 直方图的快速 EMA 长度。 |
| `SlowPeriod` | 26 | MACD 直方图的慢速 EMA 长度。 |
| `SignalPeriod` | 5 | 平滑直方图的信号 EMA 周期。 |
| `StopLossPips` | 30 | 止损距离（点）。设为 `0` 表示不使用。 |
| `TakeProfitPips` | 50 | 止盈距离（点）。设为 `0` 表示不使用。 |
| `TradeVolume` | 1 | 市价单的下单量（手数）。 |
| `CandleType` | 15 分钟 | 计算指标所使用的 K 线周期。 |

## 信号逻辑
1. 策略保存最近四个 MACD 直方图数值（`hist0` 为当前，`hist1`、`hist2`、`hist3` 依次向前追溯三根 K 线）。
2. **做多** 条件：`hist3 > hist2`、`hist2 < hist1` 且 `hist1 < hist0`，即在局部低点之后出现逐步抬高的直方图。
3. **做空** 条件：`hist3 < hist2`、`hist2 > hist1` 且 `hist1 > hist0`，即在局部高点之后出现逐步走低的直方图。
4. 同一时间仅允许一笔持仓，持仓未平仓之前的后续信号会被忽略。

## 仓位管理
- 通过 `BuyMarket()` / `SellMarket()` 按 `TradeVolume` 执行市价开仓。
- 调用 `StartProtection` 将点值参数转换为价格偏移：对于 3 或 5 位小数的外汇品种，pip=最小步长 × 10，其余品种使用最小步长本身。
- 策略不包含额外的离场逻辑，仓位由止盈、止损或手动操作平仓。

## 注意事项
- 请确认交易品种的 `PriceStep` 与 `Decimals` 属性设置正确，否则点值换算可能与交易商规格不符。
- 可根据市场特性调整周期与下单量，以适应不同的交易节奏。
- 因为持仓期间不会开启新仓，如果需要更频繁地交易，可考虑降低止损/止盈距离或改进退出规则。
