# Diff TF MA 策略

## 概述
- 该策略是 MetaTrader 指标 “Diff_TF_MA_EA” 的 StockSharp 版本。
- 信号来自两个时间框架的简单移动平均线 (SMA)：较高时间框架的 SMA 与经过时间比例换算后的交易时间框架 SMA 进行比较。
- 代码只处理已完成的 K 线，完全复刻交叉条件，并在开仓前关闭任何反向持仓。

## 参数
| 名称 | 说明 |
| --- | --- |
| `MaPeriod` | 在较高时间框架上计算的简单移动平均线长度。 |
| `CandleType` | 触发交易的基础时间框架。 |
| `HigherCandleType` | 用作参考的较高时间框架。 |
| `ReverseSignals` | 反转信号逻辑（看跌交叉买入，看涨交叉卖出）。 |
| `Volume` | 通过基类 `Strategy.Volume` 设置的下单数量。 |

## 交易逻辑
1. 同时订阅交易时间框架 (`CandleType`) 和较高时间框架 (`HigherCandleType`) 的 K 线。  
2. 在较高时间框架上按 `MaPeriod` 计算简单移动平均线。  
3. 按时间跨度比例换算出交易时间框架的等效长度，并在交易时间框架上计算第二条 SMA。  
4. 保存两条均线最近两个已完成数值，在每根完成的交易 K 线后检查交叉。  
5. 当较高时间框架均线向上穿越交易时间框架均线时（且 `ReverseSignals` 为 `false`），买入或反手做多。  
6. 当较高时间框架均线向下穿越交易时间框架均线时（且 `ReverseSignals` 为 `false`），卖出或反手做空。  
7. 下单时会补足相反仓位的数量，确保仓位平滑翻转。  

## 使用建议
- 一般应选择较高时间框架大于交易时间框架，这样换算长度才具有参考意义。
- 默认交易量为 `1`，如需其他手数请在启动前调整 `Strategy.Volume`。
- 原始 EA 中的止损、止盈设置未移植，可在 StockSharp 中另行添加风控组件。
- 打开 `ReverseSignals` 后，买卖条件互换，其他逻辑保持不变。
