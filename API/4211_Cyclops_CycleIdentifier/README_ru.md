# Стратегия Cyclops Cycle Identifier

## Обзор

Стратегия переносит советник MetaTrader **Cyclops v1.2** вместе с индикатором *CycleIdentifier* на высокоуровневый API StockSharp. Алгоритм сглаживает цены закрытия с помощью RMA (SMMA), оценивает средний диапазон движения через длинный ATR и отмечает развороты цикла, когда цена удаляется от последнего экстремума достаточно далеко. Крупные развороты (major) формируют точки входа, малые (minor) могут использоваться как сигналы выхода.

Дополнительный нулевой лаг-фильтр подтверждает направление сглаженного ряда. Источником фильтра может быть сама сглаженная цена или RSI Вайлдера, рассчитанный по той же серии. Также доступен фильтр импульса Momentum и возможность ограничивать торговлю по дню недели и часу.

## Логика сигналов

- **Определение циклов.** Внутренний автомат отслеживает последние минимумы и максимумы сглаженной цены. Если цена проходит расстояние, равное среднему диапазону × *Length*, фиксируется малый цикл; множитель *MajorCycleStrength* выделяет крупные развороты.
- **Входы.** Сигнал `MajorBuy` открывает длинную позицию, `MajorSell` — короткую. При смене направления текущая позиция закрывается перед открытием противоположной.
- **Выходы.** При включенном параметре *UseExitSignal* прибыльные позиции можно закрывать по сигналам `MinorSellExit` (для лонга) или `MinorBuyExit` (для шорта), если нет противоположного крупного сигнала.
- **Нулевой лаг-фильтр.** При активном *UseCycleFilter* требуется подтверждение наклона фильтра (рост для лонга, падение для шорта). Режим задается параметром *CycleFilterMode*.
- **Фильтр Momentum.** При *UseMomentumFilter* вход возможен только если Momentum ≥ *MomentumTriggerLong* для покупок и Momentum ≤ *MomentumTriggerShort* для продаж.

## Управление позицией

- **Фиксированные цели.** *TakeProfitPips* и *StopLossPips* задают опциональные уровни тейк-профита и стоп-лосса в пипсах.
- **Перевод в безубыток.** После прохождения *BreakEvenTrigger* пипсов стоп переносится в точку входа ± один пипс.
- **Трейлинг.** При достижении *TrailingStopTrigger* пипсов активируется трейлинг с расстоянием *TrailingStopPips*.
- **Торговая сессия.** Если *UseTimeRestriction* = true, новые входы разрешены только до `DayEnd` (0=воскресенье) и не позднее `HourEnd` на этом дне. Сопровождение открытых сделок продолжается.

## Параметры

| Параметр | Описание |
|----------|----------|
| `Volume` | Объем заявки при входе. |
| `PriceActionFilter` | Период SMMA, применяемой к цене закрытия. |
| `Length` | Множитель среднего диапазона для малых циклов. |
| `MajorCycleStrength` | Множитель для крупных разворотов. |
| `UseCycleFilter` | Включает проверку наклона нулевого лаг-фильтра. |
| `CycleFilterMode` | Источник фильтра: сглаженная цена (`Sma`) или RSI (`Rsi`). |
| `FilterStrengthSma` | Длина фильтра, если используется цена. |
| `FilterStrengthRsi` | Длина фильтра и период RSI в режиме `Rsi`. |
| `UseMomentumFilter` | Включает/отключает фильтр Momentum. |
| `MomentumPeriod` | Период индикатора Momentum. |
| `MomentumTriggerLong` | Минимальный Momentum для покупок. |
| `MomentumTriggerShort` | Максимальный Momentum для продаж. |
| `UseExitSignal` | Разрешает выходы по малым циклам при прибыли. |
| `UseTimeRestriction` | Ограничивает торговлю по дню и часу. |
| `DayEnd` | Последний торговый день недели. |
| `HourEnd` | Последний час входов в этот день. |
| `BreakEvenTrigger` | Порог в пипсах для перевода в безубыток. |
| `TrailingStopTrigger` | Порог в пипсах для запуска трейлинга. |
| `TrailingStopPips` | Расстояние трейлинг-стопа. |
| `TakeProfitPips` | Дистанция тейк-профита. |
| `StopLossPips` | Дистанция стоп-лосса. |
| `CandleType` | Таймфрейм, подающий данные стратегии. |

## Отличия от оригинального советника

- Средний диапазон рассчитывается через 250-периодный ATR, умноженный на *Length*, что эквивалентно усреднению High/Low в MQL.
- Фильтр Momentum использует фактическое значение индикатора (в исходном коде сравнивалась константа `bm`, из-за чего фильтр не работал).
- Нулевой лаг-фильтр использует те же рекурсивные коэффициенты, но в десятичной арифметике. Режим RSI применяет RSI Вайлдера с периодом *FilterStrengthRsi*.

## Рекомендации по использованию

1. Выберите инструмент и установите желаемый таймфрейм в параметре `CandleType`.
2. Настройте параметры риска и торгового окна в соответствии с брокером.
3. При необходимости включите *UseCycleFilter* и/или *UseMomentumFilter* для более строгого подтверждения сигналов.
4. Стратегия держит только одну позицию; противоположный сигнал сначала закрывает текущую, затем разрешает новый вход.
