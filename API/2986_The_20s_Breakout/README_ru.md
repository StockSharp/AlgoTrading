# Стратегия The 20s Breakout
[English](README.md) | [中文](README_cn.md)

## Общее описание
Данная стратегия — портированная на C# версия эксперта MetaTrader **Exp_The_20s_v020**. Она повторяет логику индикатора «The 20s», который отслеживает пробои после фазы сжатия волатильности. Алгоритм анализирует завершённые свечи выбранного таймфрейма и реагирует, когда цена пробивает 20%-е диапазоны вокруг предыдущей свечи. Реализация использует высокоуровневый API StockSharp и позволяет отдельно включать или отключать длинные и короткие операции.

## Логика сигналов
Индикатор наблюдает за последними барами и вычисляет опорные уровни на основе предыдущей свечи:

1. Определяется диапазон предыдущей свечи: `range = high[1] - low[1]`.
2. Строятся два пороговых уровня:
   - `top = high[1] - range * Ratio`
   - `bottom = low[1] + range * Ratio`
3. Текущая свеча сравнивается с этими уровнями и дистанцией `LevelPoints`, пересчитанной в цену через `PriceStep` инструмента.

Исходный код предусматривает два варианта расчёта:

- **Mode1 (по умолчанию)** – ищет ложный пробой внутри 20%-го диапазона на предыдущей свече и резкий откат на текущей. В зависимости от `IsDirect` стратегия либо покупает провал (`Direct = true`), либо продаёт его (`Direct = false`).
- **Mode2** – требует последовательность из трёх расширяющихся свечей перед сигналом. Если импульс идёт вниз и цена открывается ниже нижнего уровня, активируется один сценарий; если выше верхнего уровня — противоположный. Параметр `IsDirect` снова инвертирует направления, как и в оригинальном советнике.

Параметр `SignalBar` откладывает исполнение на заданное число баров (0 = текущая свеча, 1 = предыдущая и т. д.), что полностью соответствует механизму отложенных сигналов в MQL-версии.

## Управление сделками
- **Входы**: параметры `AllowLongEntry` и `AllowShortEntry` определяют, можно ли открывать новые позиции. Размер позиции задаётся через `OrderVolume`.
- **Развороты**: при появлении бычьего сигнала стратегия сначала закрывает короткую позицию (`AllowShortExit`), после чего при необходимости открывает длинную. Медвежий сигнал выполняет зеркальную последовательность для длинных позиций.
- **Стопы и цели**: `StopLossPoints` и `TakeProfitPoints` задаются в пунктах инструмента. Они переводятся в цену с помощью `PriceStep` и проверяются на каждой завершённой свече. При достижении любого уровня позиция закрывается.
- **Инверсия направлений**: значение `IsDirect = true` воспроизводит исходное направление сигналов. `false` меняет buy/sell местами, что полезно на инструментах с иной реакцией.

## Параметры
- `OrderVolume` – по умолчанию `1`. Объём новой позиции.
- `StopLossPoints` – по умолчанию `1000`. Размер защитного стопа в пунктах (`0` — отключен).
- `TakeProfitPoints` – по умолчанию `2000`. Размер цели в пунктах (`0` — отключена).
- `AllowLongEntry` / `AllowShortEntry` – разрешение на открытие длинных/коротких позиций.
- `AllowLongExit` / `AllowShortExit` – разрешение на закрытие позиций при противоположных сигналах.
- `SignalBar` – по умолчанию `1`. Задержка исполнения сигнала в барах.
- `LevelPoints` – по умолчанию `100`. Подтверждающее расстояние за пределами экстремумов предыдущей свечи.
- `Ratio` – по умолчанию `0.2`. Ширина 20%-го диапазона относительно предыдущей свечи.
- `IsDirect` – по умолчанию `false`. При `true` сохраняет исходное направление, при `false` инвертирует его.
- `Mode` – по умолчанию `Mode1`. Выбор одного из двух алгоритмов расчёта.
- `CandleType` – по умолчанию таймфрейм H1. Определяет поток свечей для анализа.

## Дополнительные замечания
- Расчёт выполняется только по завершённым свечам, что исключает преждевременные входы.
- Журнальные сообщения и комментарии в коде записаны на английском языке в соответствии со стилем примеров StockSharp.
- Стопы и тейк-профиты реализованы внутри стратегии, без создания отдельных заявок, поэтому логика одинаково работает в тестах и на реальном рынке.
- Стратегию можно применять на любом инструменте, главное — наличие корректного `PriceStep` для пересчёта пунктов в цену.
- Для более консервативной торговли можно комбинировать `Mode2` с увеличенным `SignalBar` на старших таймфреймах, как это делается в оригинальном советнике.
