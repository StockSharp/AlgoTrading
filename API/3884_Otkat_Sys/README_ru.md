# Стратегия Otkat Sys

Стратегия повторяет эксперта MetaTrader **1_Otkat_Sys**. Она анализирует открытие, закрытие, максимум и минимум прошедшего
торгового дня, чтобы принять решение об открытии позиции в течение первых трёх минут после полуночи (по времени брокера) со
вторника по четверг.

## Логика торговли

1. **Дневная статистика** – последняя завершённая дневная свеча сохраняется и используется для расчёта:
   - `Open - Close` и `Close - Open`, чтобы понять, был ли прошлый день медвежьим или бычьим.
   - `Close - Low` и `High - Close`, чтобы оценить глубину отката от экстремумов.
2. **Окно входа** – новые сделки оцениваются, когда свеча открывается в промежутке 00:00–00:03. Понедельник и пятница
   пропускаются, как и в исходном роботе.
3. **Фильтры направления** – четыре взаимоисключающих условия повторяют правила MQL:
   - Медвежий день (`Open - Close` выше порога коридора) + неглубокий откат (`Close - Low` ниже `Pullback - Tolerance`) → покупка.
   - Бычий день + сильный откат вверх (`High - Close` выше `Pullback + Tolerance`) → покупка.
   - Бычий день + слабый откат вверх (`High - Close` ниже `Pullback - Tolerance`) → продажа.
   - Медвежий день + сильный откат вниз (`Close - Low` выше `Pullback + Tolerance`) → продажа.
4. **Заявки** – вход выполняется рыночным ордером заданного объёма. Покупки ставят цель на расстоянии `TakeProfit + 3`
   пунктов (как в оригинале), продажи используют `TakeProfit` пунктов. Оба направления применяют одинаковый стоп-лосс.
5. **Временной выход** – любая открытая позиция закрывается после 22:45, повторяя вечернее закрытие позиций в MetaTrader.

Все пороговые параметры задаются в пунктах и автоматически переводятся в цены через `PriceStep` инструмента.

## Параметры

| Название | Описание |
| --- | --- |
| `EntryCandleType` | Таймфрейм окна входа (по умолчанию 1 минута). |
| `DailyCandleType` | Таймфрейм дневной статистики (по умолчанию 1 день). |
| `TakeProfit` | Цель по прибыли в пунктах. Для покупок добавляется буфер в 3 пункта. |
| `StopLoss` | Дистанция защитного стопа в пунктах. |
| `PullbackThreshold` | Базовый порог отката («Otkat») в пунктах. |
| `CorridorThreshold` | Порог коридора (`KoridorOC`). |
| `ToleranceThreshold` | Допуск к откату (`KoridorOt`). |
| `TradeVolume` | Объём сделки в лотах. |

Стратегия очищает внутреннее состояние при `Reset`, подписывается на свечи обоих таймфреймов и, при наличии области графика,
отображает свечи и маркеры сделок.
