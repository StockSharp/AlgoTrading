# Стратегия Volume Trader

## Общее описание
- Порт эксперта MetaTrader 5 **«Volume trader» (ID 21050)** автора Владимир Карпутов.
- Переписана на высокоуровневом API StockSharp без изменения базовой логики.
- Ориентирована на работу по направлению изменения тикового объёма внутри заданного торгового окна.

## Логика работы
1. Подписывается на свечи типа `CandleType` (по умолчанию таймфрейм 1 час) и считывает их тиковый объём `TotalVolume`.
2. После закрытия каждой свечи сравниваются объёмы **двух предыдущих** закрытых баров, что повторяет логику MQL5, запускаемую в момент рождения новой свечи.
3. Если последний объём выше, чем объём бара до него, и нет длинной позиции, стратегия покупает `Volume` контрактов и одновременно закрывает существующий шорт.
4. Если последний объём ниже, чем объём бара до него, и нет короткой позиции, стратегия продаёт `Volume` контрактов и одновременно закрывает существующий лонг.
5. Сигналы игнорируются, если время открытия следующей свечи выходит за пределы интервала `[StartHour, EndHour]`. Значения 09:00–18:00 повторяют исходные настройки.
6. Стоп-лосс и тейк-профит по умолчанию отсутствуют — позиции разворачиваются при появлении противоположного сигнала.

## Управление заявками
- Вход выполняется рыночными приказами через `BuyMarket` или `SellMarket`, что позволяет немедленно развернуть позицию на открытии новой свечи.
- При смене направления стратегия автоматически торгует объём, равный модулю текущей позиции плюс `Volume`, полностью закрывая старую позицию перед открытием новой.
- Дополнительных правил мани-менеджмента, помимо фиксированного параметра `Volume`, не предусмотрено.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `CandleType` | Таймфрейм 1 час | Свечная серия для расчёта тикового объёма. Настройте под используемый таймфрейм в MetaTrader. |
| `StartHour` | 9 | Начало торговой сессии (включительно), часы 0–23. Сигналы раньше этого времени игнорируются. |
| `EndHour` | 18 | Завершение торговой сессии (включительно), часы 0–23. Сигналы позже этого времени игнорируются. |
| `Volume` | 0.1 | Объём заявки для новых входов и переворота позиции. |

## Рекомендации по использованию
- Убедитесь, что источник данных передаёт тиковый объём в сообщениях свечей. При отсутствии тиковых данных стратегия будет опираться на фактический торговый объём.
- Приведите параметр `CandleType` к таймфрейму, на котором тестировалась оригинальная MQL-версия.
- При необходимости добавьте внешние ограничения по рискам (стоп-лосс, тейк-профит, дневной лимит потерь).
- В журнал (`LogInfo`) выводятся сообщения при открытии позиций, что упрощает анализ сигналов.

## Отличия от оригинала на MQL5
- Используется механизм подписки на свечи StockSharp вместо явного вызова `CopyTickVolume`.
- Фильтр по времени рассчитывается через `CloseTime` завершённой свечи, что соответствует проверке времени открытия следующего бара в исходном советнике.
- Заявки отправляются через высокоуровневые методы `BuyMarket`/`SellMarket` вместо прямого обращения к `CTrade`.
