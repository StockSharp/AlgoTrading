# Стратегия MACD Alert

## Общее описание
Стратегия является точной конверсией советника MetaTrader *MACD_Alert.mq4*. Оригинальный код вычислял основную линию MACD на пятиминутных свечах (EMA 12 и 26 с сигнальной EMA 9) и выводил системное оповещение, когда значение превышало `0.00060` либо опускалось ниже `-0.00060`. Версия для StockSharp подключается к выбранному ряду свечей, создаёт индикатор MACD с теми же параметрами и записывает сообщения в журнал стратегии каждый раз, когда одно из пороговых значений достигается.

Модуль носит исключительно информационный характер — он не выставляет заявки и не управляет позициями. Он предназначен для трейдеров, которые хотят своевременно получать сигналы о достижении экстремальных значений импульса.

## Ключевые особенности конверсии
- Используется высокоуровневый API (`SubscribeCandles` + `Bind`), поэтому свечи агрегируются движком, а индикатор получает готовые данные без ручной буферизации.
- Обрабатываются только завершённые свечи, что соответствует поведению оригинального эксперта, ориентировавшегося на закрытие бара.
- Базовые параметры (MACD 12/26/9, пороги ±0.00060, таймфрейм M5) сохранены, но доступны для изменения и оптимизации через параметры стратегии.
- Оповещения пишутся через `AddInfoLog`, благодаря чему видны как в графическом интерфейсе, так и в любой подключённой системе логирования.
- При наличии графиков дополнительно отображаются свечи и линия MACD, что упрощает визуальную проверку сигналов.

## Параметры
| Параметр | Тип | Описание |
| --- | --- | --- |
| `MacdFastPeriod` | `int` | Период быстрой EMA для MACD. По умолчанию `12`. |
| `MacdSlowPeriod` | `int` | Период медленной EMA для MACD. По умолчанию `26`. |
| `MacdSignalPeriod` | `int` | Период сигнальной EMA внутри MACD. По умолчанию `9`. |
| `UpperThreshold` | `decimal` | Значение MACD, при превышении которого формируется бычье оповещение. По умолчанию `0.00060`. |
| `LowerThreshold` | `decimal` | Значение MACD, при падении ниже которого формируется медвежье оповещение. По умолчанию `-0.00060`. |
| `EnableAlerts` | `bool` | Разрешает или запрещает запись оповещений. |
| `CandleType` | `DataType` | Ряд свечей, на котором рассчитывается MACD. По умолчанию пятиминутные свечи. |

## Логика оповещений
1. В `OnStarted` создаётся индикатор `MovingAverageConvergenceDivergence` с выбранными периодами и привязывается к подписке на свечи.
2. После закрытия каждой свечи стратегия считывает основную линию MACD.
3. Если значение больше либо равно `UpperThreshold`, в журнал добавляется сообщение `"MACD main line ... exceeded the upper threshold ..."`.
4. Если значение меньше либо равно `LowerThreshold`, записывается зеркальное медвежье сообщение.
5. Сигнальная линия и гистограмма тоже рассчитываются, но в данной реализации не используются — так же, как и в MetaTrader-версии.

Оповещения формируются по одной записи на свечу, что исключает избыточный поток сообщений и при этом полностью сохраняет смысл оригинальных `Alert()`.

## Сценарий использования
1. Выберите инструмент и укажите требуемый таймфрейм в параметре `CandleType` (по умолчанию используется M5).
2. При необходимости измените периоды MACD или пороговые уровни.
3. Запустите стратегию. После формирования индикатора оповещения будут записываться при каждом пересечении установленных порогов.
4. Подключите журнал стратегии к собственной системе уведомлений (почта, push-уведомления, бот и т.д.), если нужны внешние сигналы.

## Примеры сообщений
```
MACD main line 0.00074 exceeded the upper threshold 0.00060 at 2024-05-13 09:25:00.
MACD main line -0.00068 fell below the lower threshold -0.00060 at 2024-05-13 11:40:00.
```
Это прямые аналоги сообщений, которые выдавал вызов `Alert()` в MetaTrader.

## Возможные расширения
- Дополнить обработчик `ProcessCandle` логикой выставления заявок, если требуется автоматическая торговля по сигналам MACD.
- Динамически пересчитывать пороги на основе волатильности (например, умножая ATR на коэффициент) и задавать их через параметры стратегии.
- Подавать в `CandleType` свечи более высокого таймфрейма для отслеживания глобального импульса или, наоборот, перейти на тиковые бары для более частых оповещений.
- Сохранять журнал оповещений в базе данных либо отправлять в сторонние сервисы (Slack, Telegram, e-mail) для коллективной работы.
