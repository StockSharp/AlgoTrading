# Стратегия XROC2 VG с временным фильтром

Стратегия реализует эксперта MetaTrader **Exp_XROC2_VG_Tm** на базе высокоуровневого API StockSharp. Она строит две сглаженные кривые изменения цены (ROC) и открывает обратные позиции при их пересечениях. Дополнительно предусмотрены ограничения по времени торговли и фиксированные уровни риска, как в оригинальной реализации.

## Логика торговли

- Из цены закрытия рассчитываются два значения ROC с независимыми периодами.
- Каждое значение сглаживается выбранным типом скользящей средней.
- Сигналы оцениваются по смещённому индексу бара (`SignalShift`), что полностью повторяет поведение MQL-версии.
- Если на предыдущем баре быстрая линия была выше медленной, а на сигнальном баре опустилась ниже, стратегия закрывает короткую позицию и при необходимости открывает длинную.
- Если на предыдущем баре быстрая линия была ниже медленной, а на сигнальном баре поднялась выше, стратегия закрывает длинную позицию и может открыть короткую.
- Вне разрешённого торгового окна система принудительно закрывает позицию и не открывает новые сделки, пока торговля запрещена.

Переход между направлениями происходит только после полного закрытия предыдущей позиции, что соответствует логике `TradeAlgorithms.mqh`.

## Индикаторы

- **Быстрый ROC** — изменение цены за `RocPeriod1` баров, сглаженное методом `SmoothMethod1` с длиной `SmoothLength1`.
- **Медленный ROC** — аналогичный расчёт за `RocPeriod2` баров с параметрами `SmoothMethod2` и `SmoothLength2`.
- Доступные типы сглаживания: простая, экспоненциальная, сглаженная (RMA) и взвешенная скользящие средние. Методики JJMA, VIDYA и AMA заменены экспоненциальным сглаживанием из стандартной библиотеки StockSharp.

## Управление рисками

- Параметры `StopLoss` и `TakeProfit` задают необязательные уровни выхода в абсолютных ценовых единицах. При достижении уровня позиция закрывается рыночной заявкой.
- `OrderVolume` определяет объём каждой новой позиции.
- Закрытие по индикатору активно даже при отключённых защитных уровнях.

## Временной фильтр

- `UseTimeFilter` включает или выключает контроль торговой сессии.
- `StartTime` и `EndTime` задают временные границы. Если окончание раньше начала, окно разбивается на два участка по разные стороны от полуночи — так же, как в MQL.
- При выходе из торгового окна стратегия закрывает позицию до того, как проверит новые сигналы.

## Параметры

| Параметр | Описание |
| --- | --- |
| `CandleType` | Тип свечей для расчётов (по умолчанию 4 часа). |
| `RocPeriod1`, `RocPeriod2` | Периоды быстрого и медленного ROC. |
| `SmoothLength1`, `SmoothLength2` | Длины сглаживания для каждой линии. |
| `SmoothMethod1`, `SmoothMethod2` | Типы скользящих средних. |
| `RocType` | Формула расчёта ROC: моментум, процентное изменение или отношение. |
| `SignalShift` | Количество баров назад, из которых берутся сигнальные значения. |
| `AllowBuyOpen`, `AllowSellOpen` | Разрешение на открытие длинных и коротких позиций. |
| `AllowBuyClose`, `AllowSellClose` | Разрешение на закрытие длинных и коротких позиций по сигналу. |
| `UseTimeFilter` | Включение временного фильтра. |
| `StartTime`, `EndTime` | Начало и конец торговой сессии. |
| `OrderVolume` | Объём новой позиции. |
| `StopLoss`, `TakeProfit` | Необязательные абсолютные уровни стоп-лосса и тейк-профита. |

## Особенности реализации

- Вместо обращения к буферам индикатора хранятся короткие истории цен и сглаженных значений, что позволяет воспроизводить `SignalShift` без использования `GetValue`.
- Режимы JJMA, VIDYA и AMA заменены на экспоненциальное сглаживание, чтобы опираться только на стандартные индикаторы StockSharp.
- Весь код снабжён английскими комментариями, а пространство имён соответствует требованиям репозитория.
