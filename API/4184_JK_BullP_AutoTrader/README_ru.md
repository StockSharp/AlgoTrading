# Стратегия JK BullP AutoTrader

## Обзор
JK BullP AutoTrader — это советник для MetaTrader 4, построенный на индикаторе Elder Bulls Power. Он реагирует на ослабление
бычьего импульса либо на уход значения индикатора в отрицательную область. Порт на StockSharp сохраняет первоначальную логику и
добавляет удобные параметры, детальную обработку трейлинг-стопа и дружественные к платформе механизмы защиты.

## Логика торговли
1. Стратегия подписывается на настраиваемый поток свечей (по умолчанию часовые) и рассчитывает экспоненциальную среднюю (EMA) с
   периодом 13 для воссоздания базы индикатора Bulls Power.
2. Для каждой завершённой свечи Bulls Power вычисляется как разница между максимумом свечи и значением EMA.
3. Сравниваются два последовательных значения Bulls Power:
   - если предыдущее значение выше текущего и при этом текущее остаётся положительным, открывается короткая позиция;
   - если текущее значение опускается ниже нуля, открывается длинная позиция.
4. В любой момент времени может быть открыта только одна позиция — как и в оригинальном советнике, который блокировал новые заявки
   при наличии активных сделок.

## Управление рисками и выходы
- **Начальные стоп и тейк:** расстояния задаются в пунктах и конвертируются в ценовые единицы на основе шага цены инструмента.
  Защита активируется через `StartProtection`, что позволяет повторить работу параметров MetaTrader.
- **Трейлинг-стоп:** когда плавающая прибыль превышает заданное расстояние, уровень стопа двигается от свечи к свече. Вместо
  модификации существующих стоп-заявок (как в MetaTrader) порт закрывает позицию рыночной заявкой при пробое трейлингового
  уровня. Это гарантирует выход даже там, где защитные приказы недоступны.

## Параметры
| Имя | Описание | Значение по умолчанию |
| --- | --- | --- |
| `OrderVolume` | Объём рыночной заявки. | 8.5 |
| `TakeProfitPips` | Расстояние до тейк-профита в пунктах. | 500 |
| `StopLossPips` | Расстояние до стоп-лосса в пунктах. | 20 |
| `TrailingStopPips` | Прибыль в пунктах для активации и ведения трейлинг-стопа. | 10 |
| `EmaPeriod` | Период EMA, используемой в расчёте Bulls Power. | 13 |
| `CandleType` | Тип свечей, на основе которых ведутся расчёты (по умолчанию часовые). | Часовые свечи |

## Особенности реализации
- Неиспользуемые параметры исходного советника (`Patr`, `Prange`, `Kstop`, `kts`, `Vts`) опущены, поскольку они не влияли на
  оригинальную логику.
- Расстояния в пунктах опираются на `PriceStep`. При отсутствии шага цены используется значение `1` как консервативная оценка.
- Используется высокоуровневый API `Bind`, обработка ведётся только по завершённым свечам, а внутреннее состояние
  (`_previousBullsPower`) воссоздаёт обращение к данным со сдвигом из MT4.
- Трейлинг-логика автоматически сбрасывается после закрытия позиции, что исключает устаревшие уровни при новом входе.
