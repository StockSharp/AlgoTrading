# Стратегия Nina EA

## Обзор
Стратегия Nina EA — это трендовая система с единственной позицией, перенесённая из эксперта MetaTrader 4 «NinaEA». В оригинальной версии используется пользовательский индикатор **NINA**: робот вычисляет разницу между его бычьим и медвежьим буферами и открывает сделки, когда знак этой разницы меняется. В реализации на StockSharp индикатор заменён на встроенный **SuperTrend**, который также предоставляет отдельные буферы для направлений тренда. Переворот SuperTrend выступает аналогом нулевого пересечения: при смене тренда на бычий стратегия покупает, при смене на медвежий — продаёт.

Стратегия удерживает только одну позицию. Противоположный сигнал немедленно закрывает текущую сделку и открывает новую в обратном направлении. Дополнительно можно задать стоп-лосс в ценовых пунктах, что соответствует параметру `StopLoss` в оригинальном эксперте.

## Логика торговли
1. Подписаться на выбранный тип свечей и рассчитать SuperTrend с указанными периодом и множителем ATR.
2. Дождаться, когда стратегия и индикатор будут сформированы, прежде чем реагировать на сигналы.
3. На каждой завершённой свече:
   - Если цена достигает защитного стопа, закрыть позицию рыночной заявкой.
   - Если SuperTrend меняется с медвежьего на бычий, закрыть шорт (если он есть) и открыть лонг заданным объёмом.
   - Если SuperTrend меняется с бычьего на медвежий, закрыть лонг и открыть шорт.
   - Сохранить текущее направление тренда для фиксации следующего переворота.

Так воспроизводится логика MetaTrader, где выражение `nina = Buffer0 - Buffer1` и изменение его знака управляют выходами и входами.

## Управление позицией и рисками
- Одновременно активна только одна позиция; система всегда разворачивается, а не наращивает объём.
- Необязательный стоп-лосс в пунктах рассчитывается от цены входа: для лонга стоп ставится ниже, для шорта — выше. Нулевое значение отключает стоп.
- Вызов `StartProtection()` позволяет при необходимости подключить встроенные защитные механизмы StockSharp.

## Параметры
| Параметр | Значение по умолчанию | Описание |
|----------|-----------------------|----------|
| `Volume` | `0.1` | Объём заявки для каждого нового входа. |
| `AtrPeriod` | `10` | Период ATR, передаваемый в SuperTrend (соответствует `PeriodWATR`). |
| `AtrMultiplier` | `1` | Множитель ATR для SuperTrend (соответствует `Kwatr`). |
| `StopLossPoints` | `0` | Дистанция стоп-лосса в пунктах. Ноль отключает стоп, как и в оригинале, где заявки выставлялись без стоп-цены. |
| `CandleType` | `TimeFrame(1 minute)` | Тип свечей, по которым работает стратегия. |

## Особенности конвертации
- Пользовательский индикатор `NINA` заменён на SuperTrend, так как стратегии важен только знак разницы между двумя буферами. Свойство `IsUpTrend` у SuperTrend даёт ту же информацию без обращения к низкоуровневым буферам.
- Логика закрытия ордеров повторяет цикл `OrdersTotal()` из исходника: при смене знака сначала закрывается текущая позиция, затем открывается новая в противоположном направлении.
- Параметры MetaTrader (`highlow`, `cbars`, `from`, `maP`, `SMAspread`, `Slippage`), не влияющие на торговлю в исходном коде, опущены.

## Рекомендации по использованию
1. Запустите стратегию на нужном инструменте и выберите таймфрейм свечей, соответствующий тестам в MetaTrader.
2. Настройте параметры ATR, чтобы приблизить поведение к оригинальному индикатору.
3. Установите `StopLossPoints`, если нужен жёсткий ограничитель убытков; оставьте значение `0`, чтобы полагаться только на сигналы.
