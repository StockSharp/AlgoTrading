# Стратегия Dark Cloud Piercing CCI

## Обзор
Стратегия является портом советника MetaTrader Expert_ADC_PL_CCI на платформу StockSharp. Алгоритм ищет на графике свечные разворотные комбинации «Пронзание» и «Темное облако» и подтверждает их с помощью индикатора Commodity Channel Index (CCI). После появления корректного паттерна и экстремального значения CCI стратегия открывает позицию в направлении разворота, а закрывает её, когда CCI выходит из зоны экстремума.

## Индикаторы
- **Commodity Channel Index (CCI)** — отслеживает экстремальные значения импульса и формирует условия выхода.
- **Средний размер тела свечи (SMA)** — определяет «длинные» свечи, необходимые для паттернов.
- **Среднее значение закрытия (SMA)** — фильтрует тренд, повторяя использование скользящей средней в оригинальном MQL-коде.

## Правила торговли
### Вход
- **Покупка (Piercing Line):**
  1. Предыдущая свеча — длинная медвежья, её открытие выше закрытия.
  2. Текущая завершенная свеча — длинная бычья, открывается ниже минимума предыдущей и закрывается внутри её тела, выше середины, но ниже предыдущего открытия.
  3. Середина тела старшей свечи должна находиться ниже скользящей средней, подтверждая нисходящий импульс.
  4. Последнее завершенное значение CCI должно быть меньше или равно `-EntryConfirmationLevel` (по умолчанию `50`).
  5. При наличии короткой позиции она полностью закрывается перед открытием лонга.
- **Продажа (Dark Cloud Cover):** зеркальные условия — длинная бычья свеча, за которой следует длинная медвежья с гэпом вверх и закрытием ниже середины предыдущего тела при CCI ≥ `EntryConfirmationLevel`.

### Выход
- **Длинные позиции:** закрываются, когда CCI пересекает сверху вниз уровень `ExitLevel` или опускается ниже `-ExitLevel`.
- **Короткие позиции:** закрываются, когда CCI пересекает снизу вверх уровень `-ExitLevel` или `ExitLevel`.

### Размер позиции
- Используется базовый параметр `Volume`. При развороте позиции к объёму ордера добавляется абсолютное значение текущей позиции, чтобы выполнить полный переворот.

## Параметры
| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| `CandleType` | Тип и таймфрейм свечей для анализа. | Таймфрейм 1 час |
| `CciPeriod` | Период расчёта CCI. | `49` |
| `AverageBodyPeriod` | Период усреднения длины тел свечей. | `11` |
| `EntryConfirmationLevel` | Абсолютное значение CCI для подтверждения входа. | `50` |
| `ExitLevel` | Абсолютное значение CCI для выхода. | `80` |

## Примечания
- Стратегия обрабатывает только завершённые свечи.
- Стоп-лосс и тейк-профит не выставляются автоматически: выход осуществляется исключительно по сигналам, как и в оригинальном советнике.
- Для корректной работы необходимо задать минимальный шаг цены инструмента, поскольку условия свечных паттернов используют ценовые сравнения.
