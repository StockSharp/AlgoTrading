# CCI Expert 策略

## 概述

本策略是将 MetaTrader 的 “CCI-Expert” 专家顾问移植到 StockSharp 平台后的版本。策略只使用一个时间框架上的商品通道指数（CCI）指标，并严格等待三根已完成的 K 线后再做出开仓或平仓决定。

## 交易逻辑

1. 订阅所选的蜡烛序列，并按设定周期计算 CCI。
2. 检查最近三根已经结束的 CCI 数值：
   - **做多条件**：当前值和上一根值均高于 `+1`，而倒数第三根值低于 `+1`。
   - **做空条件**：当前值和上一根值均低于 `+1`，而倒数第三根值高于 `+1`。
3. 当没有持仓且点差过滤条件满足时，只开一笔市价仓位。
4. 只有在出现反向信号且该仓位已经处于盈利状态（当前收盘价优于进场价）时才会平仓。

## 风险控制

- 可以固定下单手数，也可以在 `FixedVolume` 为零时根据风险百分比与止损距离自动计算手数。
- 通过 `StartProtection` 自动设置以“点”为单位的止损和止盈挂单。
- `MaxSpreadPoints` 参数提供可选的点差过滤器，当前买卖价差超过阈值时暂停交易。

## 参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `FixedVolume` | 固定手数，设置为零时启用风险计算模式。 | 0.1 |
| `RiskPercent` | 当 `FixedVolume` 为零时，用于计算下单量的账户风险百分比。 | 0 |
| `TakeProfitPoints` | 止盈距离（点）。 | 150 |
| `StopLossPoints` | 止损距离（点）。 | 600 |
| `MaxSpreadPoints` | 允许的最大点差（点），为零表示关闭过滤。 | 30 |
| `CciPeriod` | CCI 指标周期。 | 14 |
| `CandleType` | 策略使用的蜡烛时间框架。 | 15 分钟 |

## 说明

- 与原始 EA 相同，CCI 的阈值固定在 `+1` 和 `-1`，因此只有在形成明确的三步结构后才会触发交易。
- 风险百分比模式需要交易所提供的 `PriceStep`、`StepPrice`、`VolumeStep` 等元数据才能正确换算点数和资金风险。
- 策略会在图表上绘制蜡烛、CCI 指标线以及自身成交，方便回测和实时监控。
