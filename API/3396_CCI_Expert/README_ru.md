# Стратегия CCI Expert

## Обзор

Данная стратегия представляет собой перенос робота MetaTrader «CCI-Expert» на платформу StockSharp. В расчётах используется индикатор Commodity Channel Index (CCI) на одной выбранной таймфреймной серии. Алгоритм действует последовательно и каждый раз ждёт закрытия трёх свечей, прежде чем открыть или закрыть позицию.

## Логика торговли

1. Подписываемся на выбранный тип свечей и рассчитываем CCI с заданным периодом.
2. Анализируем три последних завершённых значения CCI:
   - **Условия для покупки**: текущее и предыдущее значения выше `+1`, при этом значение два бара назад было ниже `+1`.
   - **Условия для продажи**: текущее и предыдущее значения ниже `+1`, а значение два бара назад было выше `+1`.
3. Открываем только одну рыночную позицию и лишь тогда, когда активных позиций нет и фильтр по спреду разрешает торговлю.
4. Закрываем открытую позицию только при появлении противоположного сигнала **и** наличии прибыли (цена закрытия выгоднее цены входа).

## Управление рисками

- Можно торговать фиксированным объёмом или рассчитывать его от процента риска и расстояния до стоп-лосса.
- Метод `StartProtection` автоматически выставляет уровни стоп-лосса и тейк-профита в ценовых пунктах.
- Дополнительный фильтр по спреду запрещает сделки, если текущая разница между бидом и аском превышает `MaxSpreadPoints`.

## Параметры

| Параметр | Описание | Значение по умолчанию |
|----------|----------|------------------------|
| `FixedVolume` | Фиксированный объём заявки. Ноль включает риск-ориентированный расчёт. | 0.1 |
| `RiskPercent` | Процент от стоимости портфеля, используемый для расчёта объёма при `FixedVolume = 0`. | 0 |
| `TakeProfitPoints` | Расстояние до тейк-профита в ценовых пунктах. | 150 |
| `StopLossPoints` | Расстояние до стоп-лосса в ценовых пунктах. | 600 |
| `MaxSpreadPoints` | Максимально допустимый спред (в пунктах). Ноль отключает фильтр. | 30 |
| `CciPeriod` | Период индикатора CCI. | 14 |
| `CandleType` | Таймфрейм свечей, используемых в стратегии. | 15 минут |

## Примечания

- Пороговые уровни CCI фиксированы на `+1` и `-1`, как и в исходном коде, поэтому сигнал появляется только после последовательности из трёх значений.
- Для расчёта риска по проценту необходимы корректные данные инструмента (`PriceStep`, `StepPrice`, `VolumeStep` и т. д.), полученные от площадки.
- На график выводятся свечи, линия CCI и собственные сделки для удобства визуального анализа.
